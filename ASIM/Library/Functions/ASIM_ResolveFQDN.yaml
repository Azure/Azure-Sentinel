Function:
  Title: An ASIM Function sets Hostname, Domain, DomainType and FQDN based for an FQDN or hostname provided as a parameter 
  Version: '0.1'
  LastUpdated: Apr 27th 2022
References:
- Title: ASIM
  Link: https://aka.ms/AboutASIM
- Title: KQL Invoke operator
  Link: https://docs.microsoft.com/azure/data-explorer/kusto/query/invokeoperator
Description: |
  This ASIM tabular function is intended for use in ASIM parsers and sets the Hostname entity fields based on an FQDN or hostname provided as a parameter. The function is invoked using the [invoke operator](https://docs.microsoft.com/azure/data-explorer/kusto/query/invokeoperator) and requires the source table to have a TimeGenerated field. The resulting fields have to be renamed to the needed final names, for example FQDN to DstFQDN.  
FunctionName: ASIM_ResolveFQDN
EquivalentBuiltInFunction: _ASIM_ResolveFQDN
FunctionParams:
  - Name: T:(TimeGenerated:datetime)
    Type: table
  - Name: Hostname
    Type: string

FunctionQuery: |
  let function = (T:(TimeGenerated:datetime), Hostname:string) {
    T
    | extend SplitHostname = split(Hostname,".")
    | extend 
        Domain = tostring(strcat_array(array_slice(SplitHostname, 1, -1), '.')),
        FQDN = iif (array_length(SplitHostname) > 1, Hostname, ''),
        DomainType = iif (array_length(SplitHostname) > 1, 'FQDN', '')
    | extend
        ExtractedHostname = tostring(SplitHostname[0])    
    | project-away SplitHostname
  };
  function(T, Hostname)