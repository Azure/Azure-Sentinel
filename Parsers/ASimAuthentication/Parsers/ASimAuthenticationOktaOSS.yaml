Parser:
  Title: Authentication ASIM parser for Okta
  Version: '0.4.0'
  LastUpdated: Jan 08, 2026
Product:
  Name: Okta
Normalization:
  Schema: Authentication
  Version: '0.1.3'
References:
  - Title: ASIM Authentication Schema
    Link: https://aka.ms/ASimAuthenticationDoc
  - Title: ASIM
    Link: https://aka.ms/AboutASIM
Description: |
  This ASIM parser supports normalizing Okta sign in logs, stored in the Okta_CL table, to the ASIM Authentication schema. 
ParserName: ASimAuthenticationOktaSSO
EquivalentBuiltInParser: _ASim_Authentication_OktaSSO
ParserParams:
  - Name: disabled
    Type: bool
    Default: false
ParserQuery: |
  let parser=(disabled: bool=false) {
    let OktaSuccessfulOutcome = dynamic(['SUCCESS', 'ALLOW']);
    let OktaFailedOutcome = dynamic(['FAILURE', 'SKIPPED', 'DENY']);
    let OktaSigninEvents=dynamic(['user.session.start', 'user.session.end']);
    let OutcomeReasonLookup = datatable(outcome_reason_s: string, EventResultDetails: string)
    [
        "LOCKED_OUT", "User locked",
        "INVALID_CREDENTIALS", "Incorrect password",
        "UNKNOWN_USER", "No such user",
        "VERIFICATION_ERROR", "Incorrect key",
        "SSO_AUTHENTICATION_FAILURE", "Logon violates policy",
        "PASSWORD_EXPIRED", "Password expired",
        "USER_ACCOUNT_EXPIRED", "Account expired",
        "DEL_AUTH_TIMEOUT", "Session expired",
        "PASSWORD_BASED_LOGIN_DISALLOWED", "Logon violates policy"
    ];
    let SrcDeviceTypeLookup = datatable(client_device_s: string, SrcDeviceType: string)
    [
        "Computer", "Computer",
        "Mobile", "Mobile Device",
        "Tablet", "Mobile Device"
    ];
    let ActorUserTypeLookup = datatable(ActorOriginalUserType: string, ActorUserType: string)
    [
        "User", "Regular",
        "SystemPrincipal", "System"
    ];
    let emptyOktaTable = datatable(
        TimeGenerated: datetime,
        outcome_result_s: string,
        eventType_s: string,
        legacyEventType_s: string,
        client_geographicalContext_geolocation_lat_d: double,
        client_geographicalContext_geolocation_lon_d: double,
        displayMessage_s: string,
        outcome_reason_s: string,
        uuid_g: string,
        actor_id_s: string,
        actor_alternateId_s: string,
        authenticationContext_externalSessionId_s: string,
        actor_type_s: string,
        client_userAgent_os_s: string,
        securityContext_isp_s: string,
        client_geographicalContext_city_s: string,
        client_geographicalContext_country_s: string,
        client_ipAddress_s: string,
        client_userAgent_browser_s: string,
        authenticationContext_credentialType_s: string,
        client_userAgent_rawUserAgent_s: string,
        client_geographicalContext_state_s: string,
        client_device_s: string
    )[];
    let OktaTable = union isfuzzy=true emptyOktaTable, Okta_CL;
    OktaTable
    | where not(disabled)
    | lookup OutcomeReasonLookup on outcome_reason_s
    | extend EventResultDetails = iif(outcome_result_s in (OktaFailedOutcome), coalesce(EventResultDetails, "Other"), "")
    | extend
        Type = "Okta_CL",
        EventProduct='Okta',
        EventVendor='Okta',
        EventSchema = 'Authentication',
        EventCount=int(1),
        EventSchemaVersion='0.1.3',
        EventResult = case (outcome_result_s in (OktaSuccessfulOutcome), 'Success', outcome_result_s in (OktaFailedOutcome), 'Failure', 'Partial'),
        EventStartTime=TimeGenerated,
        EventEndTime=TimeGenerated,
        EventType=iff(eventType_s hassuffix 'start', 'Logon', 'Logoff'),
        TargetUserIdType = "OktaId",
        ActingAppType = "Browser"
    | project-rename
        EventOriginalSubType=legacyEventType_s,
        EventMessage=displayMessage_s,
        EventOriginalResultDetails=outcome_reason_s,
        EventOriginalUid=uuid_g,
        TargetUserId = actor_id_s,
        TargetUsername = actor_alternateId_s,
        TargetSessionId = authenticationContext_externalSessionId_s,
        ActorOriginalUserType = actor_type_s,
        SrcGeoLatitude = client_geographicalContext_geolocation_lat_d,
        SrcGeoLongitude = client_geographicalContext_geolocation_lon_d,
        SrcDvcOs = client_userAgent_os_s,
        SrcIsp = securityContext_isp_s,
        SrcGeoCity = client_geographicalContext_city_s,
        SrcGeoCountry = client_geographicalContext_country_s,
        SrcIpAddr = client_ipAddress_s,
        ActingAppName = client_userAgent_browser_s,
        LogonMethod = authenticationContext_credentialType_s,
        HttpUserAgent = client_userAgent_rawUserAgent_s,
        SrcGeoRegion = client_geographicalContext_state_s
    | extend
        ActorUserId = TargetUserId,
        ActorUsername = TargetUsername,
        ActorUserIdType = TargetUserIdType
    | lookup ActorUserTypeLookup on ActorOriginalUserType
    | extend
        TargetUserType = ActorUserType,
        TargetUsernameType = _ASIM_GetUsernameType(TargetUsername),
        ActorUsernameType = _ASIM_GetUsernameType(ActorUsername)
    | lookup SrcDeviceTypeLookup on client_device_s
    | extend SrcDeviceType = coalesce(SrcDeviceType, "Other")
    | extend 
        User=TargetUsername,
        Dvc=EventVendor,
        IpAddr=SrcIpAddr
    | project
        TimeGenerated,
        Type,
        EventResultDetails,
        EventProduct,
        EventVendor,
        EventSchema,
        EventCount,
        EventSchemaVersion,
        EventResult,
        EventStartTime,
        EventEndTime,
        EventType,
        EventOriginalSubType,
        EventMessage,
        EventOriginalResultDetails,
        EventOriginalUid,
        TargetUserIdType,
        TargetUserId,
        TargetUsername,
        TargetSessionId,
        ActorOriginalUserType,
        SrcGeoLatitude,
        SrcGeoLongitude,
        SrcDvcOs,
        SrcIsp,
        SrcGeoCity,
        SrcGeoCountry,
        SrcIpAddr,
        ActingAppType,
        LogonMethod,
        HttpUserAgent,
        ActorUserId,
        ActorUsername,
        ActorUserIdType,
        ActorUserType,
        TargetUserType,
        TargetUsernameType,
        ActorUsernameType,
        SrcDeviceType,
        User,
        Dvc,
        IpAddr
  };
  parser(disabled = disabled)