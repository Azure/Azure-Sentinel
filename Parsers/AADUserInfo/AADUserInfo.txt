// Usage Instruction  : 
// Paste below query in log analytics, click on Save button and select as Function from drop down by specifying function name and alias as AADUserInfo.
// Function usually takes 10-15 minutes to activate. You can then use function alias from any other queries (e.g. AADUserInfo | take 10).
// Reference : Using functions in Azure monitor log queries : https://docs.microsoft.com/azure/azure-monitor/log-query/functions
AADUserInfo_CL
| summarize arg_max(TimeGenerated, *) by ObjectId_g
| project TimeGenerated,
            ExtensionProperty_createdDateTime=columnifexists('ExtensionProperty_createdDateTime_s', ""),	
            ExtensionProperty_userIdentities=columnifexists('ExtensionProperty_userIdentities_s', ""),
            ExtensionProperty_onPremisesDistinguishedName=columnifexists('ExtensionProperty_onPremisesDistinguishedName_s', ""),
            ObjectId=columnifexists('ObjectId_g', ""),
            ObjectType=columnifexists('ObjectType_s', ""),
            AccountEnabled=columnifexists('AccountEnabled_b', ""),
            DirSyncEnabled=columnifexists('DirSyncEnabled_b', ""),
            DisplayName=columnifexists('DisplayName_s', ""),
            GivenName=columnifexists('GivenName_s', ""),
            MailNickName=columnifexists('MailNickName_s', ""),
            OnPremisesSecurityIdentifier=columnifexists('OnPremisesSecurityIdentifier_s', ""),
            PasswordPolicies=columnifexists('PasswordPolicies_s', ""),
            ProxyAddresses=columnifexists('ProxyAddresses_s', ""),
            RefreshTokensValidFromDateTime=columnifexists('RefreshTokensValidFromDateTime_t', ""),
            SignInNames=columnifexists('SignInNames_s', ""),
            Surname=columnifexists('Surname_s', ""),
            UserPrincipalName=columnifexists('UserPrincipalName_s', ""),
            UserType=columnifexists('UserType_s', ""),
            CompanyName=columnifexists('CompanyName_s', ""),
            Department=columnifexists('Department_s', ""),
            JobTitle=columnifexists('JobTitle_s', ""),
            Mail=columnifexists('Mail_s', ""),
            SipProxyAddress=columnifexists('SipProxyAddress_s', ""),
            UsageLocation=columnifexists('UsageLocation_s', ""),
            PasswordProfile=columnifexists('PasswordProfile_s', ""),
            UserState=columnifexists('UserState_s', ""),
            City=columnifexists('City_s', ""),
            Mobile=columnifexists('Mobile_s', ""),
            PhysicalDeliveryOfficeName=columnifexists('PhysicalDeliveryOfficeName_s', ""),
            PostalCode=columnifexists('PostalCode_s', ""),
            State=columnifexists('State_s', ""),
            StreetAddress=columnifexists('StreetAddress_s', ""),
            Country=columnifexists('Country_s', "")
