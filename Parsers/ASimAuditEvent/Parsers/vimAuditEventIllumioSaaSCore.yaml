Parser:
  Title: Audit Event ASIM parser for Illumio SaaS Core audit events
  Version: '0.2.1'
  LastUpdated: Aug 20, 2024
Product:
  Name: Illumio Core
Normalization:
  Schema: AuditEvent
  Version: "0.1"
References:
  - Title: ASIM Audit Event Schema
    Link: https://aka.ms/ASimAuditEventDoc
  - Title: ASIM
    Link: https://aka.ms/AboutASIM
  - Title: Illumio Core API schema
    Link: https://docs.illumio.com/core/24.1/Content/Guides/events-administration/events-described/list-of-event-types.htm
Description: |
  This ASIM parser supports normalizing Illumio Core audit events logs ingested in 'Illumio_Auditable_Events_CL' table to the ASIM Audit Event schema.
ParserName: vimAuditEventIllumioSaaSCore
EquivalentBuiltInParser: _Im_AuditEvent_IllumioSaaSCore
ParserParams:
  - Name: starttime
    Type: datetime
    Default: datetime(null)
  - Name: endtime
    Type: datetime
    Default: datetime(null)
  - Name: srcipaddr_has_any_prefix
    Type: dynamic
    Default: dynamic([])
  - Name: actorusername_has_any
    Type: dynamic
    Default: dynamic([])
  - Name: operation_has_any
    Type: dynamic
    Default: dynamic([])
  - Name: eventtype_in
    Type: dynamic
    Default: dynamic([])
  - Name: eventresult
    Type: string
    Default: '*'
  - Name: object_has_any
    Type: dynamic
    Default: dynamic([])
  - Name: newvalue_has_any
    Type: dynamic
    Default: dynamic([])
  - Name: disabled
    Type: bool
    Default: false
ParserQuery: |
  let EventTypeLookup = datatable(
      event_type: string, // what Illumio sends
      Operation: string,
      ObjectType:string, // an enumerated list [ Configuration Atom, Policy Rule, Cloud Resource, Other],
      Object:string,
      EventType: string, // an enumerated list [ Set, Read, Create, Delete, Execute, Install, Clear, Enable, Disable, Other ] event type
  ) 
  [
    'access_restriction.create', 'Access restriction created', 'Cloud Resource', 'Access_restriction', 'Create',
    'access_restriction.delete', 'Access restriction deleted', 'Cloud Resource', 'Access_restriction', 'Delete',
    'access_restriction.update', 'Access restriction updated', 'Cloud Resource', 'Access_restriction', 'Set',
    'agent.activate', 'Agent paired', 'Cloud Resource', 'Agent', 'Other',
    'agent.activate_clone', 'Agent clone activated', 'Cloud Resource', 'Agent', 'Other',
    'agent.clone_detected', 'Agent clone detected', 'Cloud Resource', 'Agent', 'Other',
    'agent.deactivate', 'Agent unpaired', 'Cloud Resource', 'Agent', 'Other',
    'agent.generate_maintenance_token', 'Generate maintenance token for any agent', 'Cloud Resource', 'Agent', 'Other',
    'agent.goodbye', 'Agent disconnected', 'Cloud Resource', 'Agent', 'Other',
    'agent.machine_identifier', 'Agent machine identifiers updated', 'Cloud Resource', 'Agent', 'Other',
    'agent.refresh_token', 'Agent refreshed token', 'Cloud Resource', 'Agent', 'Other',
    'agent.refresh_policy', 'Success or failure to apply policy on VEN', 'Cloud Resource', 'Agent', 'Other',
    'agent.request_upgrade', 'VEN upgrade request sent', 'Cloud Resource', 'Agent', 'Other',
    'agent.service_not_available', 'Agent reported a service not running', 'Cloud Resource', 'Agent', 'Other',
    'agent.suspend', 'Agent suspended', 'Cloud Resource', 'Agent', 'Other',
    'agent.tampering', 'Agent firewall tampered', 'Cloud Resource', 'Agent', 'Other',
    'agent.unsuspend', 'Agent unsuspended', 'Cloud Resource', 'Agent', 'Other',
    'agent.update', 'Agent properties updated.', 'Cloud Resource', 'Agent', 'Set',
    'agent.update_interactive_users', 'Agent interactive users updated', 'Cloud Resource', 'Agent', 'Set',
    'agent.update_iptables_href', 'Agent updated existing iptables href', 'Cloud Resource', 'Agent', 'Set',
    'agent.update_running_containers', 'Agent updated existing containers', 'Cloud Resource', 'Agent', 'Set',
    'agent.upload_existing_ip_table_rules', 'Agent existing IP tables uploaded', 'Cloud Resource', 'Agent', 'Other',
    'agent.upload_support_report', 'Agent support report uploaded', 'Cloud Resource', 'Agent', 'Other',
    'agent_support_report_request.create', 'Agent support report request created', 'Cloud Resource', 'Agent_support_report_request', 'Create',
    'agent_support_report_request.delete', 'Agent support report request deleted', 'Cloud Resource', 'Agent_support_report_request', 'Delete',
    'agents.clear_conditions', 'Condition cleared from a list of VENs', 'Cloud Resource', 'Agents', 'Other',
    'agents.unpair', 'Multiple agents unpaired', 'Cloud Resource', 'Agents', 'Other',
    'api_key.create', 'API key created', 'Cloud Resource', 'Api_key', 'Create',
    'api_key.delete', 'API key deleted', 'Cloud Resource', 'Api_key', 'Delete',
    'api_key.update', 'API key updated', 'Cloud Resource', 'Api_key', 'Set',
    'auth_security_principal.create', 'RBAC auth security principal created', 'Cloud Resource', 'Auth_security_principal', 'Create',
    'auth_security_principal.delete', 'RBAC auth security principal deleted', 'Cloud Resource', 'Auth_security_principal', 'Delete',
    'auth_security_principal.update', 'RBAC auth security principal updated', 'Cloud Resource', 'Auth_security_principal', 'Set',
    'authentication_settings.update', 'Authentication settings updated', 'Other', 'Authentication_settings', 'Set',
    'cluster.create', 'PCE cluster created', 'Cloud Resource', 'Cluster', 'Create',
    'cluster.delete', 'PCE cluster deleted', 'Cloud Resource', 'Cluster', 'Delete',
    'cluster.update', 'PCE cluster updated', 'Cloud Resource', 'Cluster', 'Set',
    'container_workload.update', 'Container workload updated', 'Cloud Resource', 'Container_workload', 'Set',
    'container_cluster.create', 'Container cluster created', 'Cloud Resource', 'Container_cluster', 'Create',
    'container_cluster.delete', 'Container cluster deleted', 'Cloud Resource', 'Container_cluster', 'Delete',
    'container_cluster.update', 'Container cluster updated', 'Cloud Resource', 'Container_cluster', 'Set',
    'container_cluster.update_label_map', 'Container cluster label mappings updated all at once', 'Cloud Resource', 'Container_cluster', 'Set',
    'container_cluster.update_services', 'Container cluster services updated, created, or deleted by Kubelink', 'Cloud Resource', 'Container_cluster', 'Set',
    'container_workload_profile.create', 'Container workload profile created', 'Cloud Resource', 'Container_workload_profile', 'Create',
    'container_workload_profile.delete', 'Container workload profile deleted', 'Cloud Resource', 'Container_workload_profile', 'Delete',
    'container_workload_profile.update', 'Container workload profile updated', 'Cloud Resource', 'Container_workload_profile', 'Set',
    'database.temp_table_autocleanup_started', 'DB temp table cleanup started', 'Other', 'Database', 'Other',
    'database.temp_table_autocleanup_completed', 'DB temp table cleanup completed', 'Other', 'Database', 'Other',
    'domain.create', 'Domain created', 'Other', 'Domain', 'Create',
    'domain.delete', 'Domain deleted', 'Other', 'Domain', 'Delete',
    'domain.update', 'Domain updated', 'Other', 'Domain', 'Set',
    'enforcement_boundary.create', 'Enforcement boundary created', 'Cloud Resource', 'Enforcement_boundary', 'Create',
    'enforcement_boundary.delete', 'Enforcement boundary deleted', 'Cloud Resource', 'Enforcement_boundary', 'Delete',
    'enforcement_boundary.update', 'Enforcement boundary updated', 'Cloud Resource', 'Enforcement_boundary', 'Set',
    'event_settings.update', 'Event settings updated', 'Other', 'Event_settings', 'Set',
    'firewall_settings.update', 'Global policy settings updated', 'Other', 'Firewall_settings', 'Set',
    'group.create', 'Group created', 'Other', 'Group', 'Create',
    'group.update', 'Group updated', 'Other', 'Group', 'Set',
    'ip_list.create', 'IP list created', 'Cloud Resource', 'Ip_list', 'Create',
    'ip_list.delete', 'IP list deleted', 'Cloud Resource', 'Ip_list', 'Delete',
    'ip_list.update', 'IP list updated', 'Cloud Resource', 'Ip_list', 'Set',
    'ip_lists.delete', 'IP lists deleted', 'Cloud Resource', 'Ip_lists', 'Delete',
    'ip_tables_rule.create', 'IP tables rules created', 'Cloud Resource', 'Ip_tables_rule', 'Create',
    'ip_tables_rule.delete', 'IP tables rules deleted', 'Cloud Resource', 'Ip_tables_rule', 'Delete',
    'ip_tables_rule.update', 'IP tables rules updated', 'Cloud Resource', 'Ip_tables_rule', 'Set',
    'job.delete', 'Job deleted', 'Other', 'Job', 'Delete',
    'label.create', 'Label created', 'Cloud Resource', 'Label', 'Create',
    'label.delete', 'Label deleted', 'Cloud Resource', 'Label', 'Delete',
    'label.update', 'Label updated', 'Cloud Resource', 'Label', 'Set',
    'label_group.create', 'Label group created', 'Cloud Resource', 'Label_group', 'Create',
    'label_group.delete', 'Label group deleted', 'Cloud Resource', 'Label_group', 'Delete',
    'label_group.update', 'Label group updated', 'Cloud Resource', 'Label_group', 'Set',
    'labels.delete', 'Labels deleted', 'Cloud Resource', 'Labels', 'Delete',
    'ldap_config.create', 'LDAP configuration created', 'Other', 'Ldap_config', 'Create',
    'ldap_config.delete', 'LDAP configuration deleted', 'Other', 'Ldap_config', 'Delete',
    'ldap_config.update', 'LDAP configuration updated', 'Other', 'Ldap_config', 'Set',
    'ldap_config.verify_connection', 'LDAP server connection verified', 'Other', 'Ldap_config', 'Other',
    'license.delete', 'License deleted', 'Other', 'License', 'Delete',
    'license.update', 'License updated', 'Other', 'License', 'Set',
    'login_proxy_ldap_config.create', 'Interservice call to login service to create LDAP config', 'Other', 'Login_proxy_ldap_config', 'Create',
    'login_proxy_ldap_config.delete', 'Interservice call to login service to delete LDAP config', 'Other', 'Login_proxy_ldap_config', 'Delete',
    'login_proxy_ldap_config.update', 'Interservice call to login service to update LDAP config', 'Other', 'Login_proxy_ldap_config', 'Set',
    'login_proxy_ldap_config.verify_connection', 'Interservice call to login service to verify connection to the LDAP server', 'Other', 'Login_proxy_ldap_config', 'Other',
    'login_proxy_msp_tenants.create', 'New MSP tenant created', 'Other', 'Login_proxy_msp_tenants', 'Create',
    'login_proxy_msp_tenants.delete', 'MSP tenant deleted', 'Other', 'Login_proxy_msp_tenants', 'Delete',
    'login_proxy_msp_tenants.update', 'MSP tenant updated', 'Other', 'Login_proxy_msp_tenants', 'Set',
    'login_proxy_orgs.create', 'New managed organization created', 'Other', 'Login_proxy_orgs', 'Create',
    'login_proxy_orgs.delete', 'Managed organization deleted', 'Other', 'Login_proxy_orgs', 'Delete',
    'login_proxy_orgs.update', 'Managed organization updated', 'Other', 'Login_proxy_orgs', 'Set',
    'lost_agent.found', 'Lost agent found', 'Cloud Resource', 'Lost_agent', 'Other',
    'network.create', 'Network created', 'Cloud Resource', 'Network', 'Create',
    'network.delete', 'Network deleted', 'Cloud Resource', 'Network', 'Delete',
    'network.update', 'Network updated', 'Cloud Resource', 'Network', 'Set',
    'network_device.ack_enforcement_instructions_applied', 'Enforcement instruction applied to a network device', 'Cloud Resource', 'Network_device', 'Other',
    'network_device.assign_workload', 'Existing or new unmanaged workload assigned to a network device', 'Cloud Resource', 'Network_device', 'Other',
    'network_device.create', 'Network device created', 'Cloud Resource', 'Network_device', 'Create',
    'network_device.delete', 'Network device deleted', 'Cloud Resource', 'Network_device', 'Delete',
    'network_device.update', 'Network device updated', 'Cloud Resource', 'Network_device', 'Set',
    'network_devices.ack_multi_enforcement_instructions_applied', 'Enforcement instructions applied to multiple network devices', 'Cloud Resource', 'Network_devices', 'Other',
    'network_endpoint.create', 'Network endpoint created', 'Cloud Resource', 'Network_endpoint', 'Create',
    'network_endpoint.delete', 'Network endpoint deleted', 'Cloud Resource', 'Network_endpoint', 'Delete',
    'network_endpoint.update', 'Network endpoint updated', 'Cloud Resource', 'Network_endpoint', 'Set',
    'network_enforcement_node.activate', 'Network enforcement node activated', 'Cloud Resource', 'Network_enforcement_node', 'Other',
    'network_enforcement_node.clear_conditions', 'Network enforcement node conditions cleared', 'Cloud Resource', 'Network_enforcement_node', 'Other',
    'network_enforcement_node.deactivate', 'Network enforcement node deactivated', 'Cloud Resource', 'Network_enforcement_node', 'Other',
    'network_enforcement_node.degraded', 'Network enforcement node failed or primary lost connectivity to secondary', 'Cloud Resource', 'Network_enforcement_node', 'Other',
    'network_enforcement_node.missed_heartbeats', 'Network enforcement node did not heartbeat for more than 15 minutes', 'Cloud Resource', 'Network_enforcement_node', 'Other',
    'network_enforcement_node.missed_heartbeats_check', 'Network enforcement node missed heartbeats check', 'Cloud Resource', 'Network_enforcement_node', 'Other',
    'network_enforcement_node.network_devices_network_endpoints_workloads', 'Workload added to network endpoint', 'Cloud Resource', 'Network_enforcement_node', 'Other',
    'network_enforcement_node.policy_ack', 'Network enforcement node acknowledgment of policy', 'Cloud Resource', 'Network_enforcement_node', 'Other',
    'network_enforcement_node.request_policy', 'Network enforcement node policy requested', 'Cloud Resource', 'Network_enforcement_node', 'Other',
    'network_enforcement_node.update_status', 'Network enforcement node reports when switches are not reachable', 'Cloud Resource', 'Network_enforcement_node', 'Set',
    'network_enforcement_nodes.clear_conditions', 'A condition was cleared from a list of network enforcement nodes', 'Cloud Resource', 'Network_enforcement_nodes', 'Other',
    'nfc.activate', 'Network function controller created', 'Other', 'Nfc', 'Other',
    'nfc.delete', 'Network function controller deleted', 'Other', 'Nfc', 'Delete',
    'nfc.update_discovered_virtual_servers', 'Network function controller virtual servers discovered', 'Cloud Resource', 'Nfc', 'Set',
    'nfc.update_policy_status', 'Network function controller policy status', 'Other', 'Nfc', 'Set',
    'nfc.update_slb_state', 'Network function controller SLB state updated', 'Other', 'Nfc', 'Set',
    'org.create', 'Organization created', 'Other', 'Org', 'Create',
    'org.recalc_rules', 'Rules for organization recalculated', 'Other', 'Org', 'Other',
    'org.update', 'Organization information updated', 'Other', 'Org', 'Set',
    'pairing_profile.create', 'Pairing profile created', 'Cloud Resource', 'Pairing_profile', 'Create',
    'pairing_profile.create_pairing_key', 'Pairing profile pairing key created', 'Cloud Resource', 'Pairing_profile', 'Create',
    'pairing_profile.delete', 'Pairing profile deleted', 'Cloud Resource', 'Pairing_profile', 'Delete',
    'pairing_profile.update', 'Pairing profile updated', 'Cloud Resource', 'Pairing_profile', 'Set',
    'pairing_profile.delete_all_pairing_keys', 'Pairing keys deleted from pairing profile', 'Cloud Resource', 'Pairing_profile', 'Delete',
    'pairing_profiles.delete', 'Pairing profiles deleted', 'Cloud Resource', 'Pairing_profiles', 'Delete',
    'password_policy.create', 'Password policy created', 'Cloud Resource', 'Password_policy', 'Create',
    'password_policy.delete', 'Password policy deleted', 'Cloud Resource', 'Password_policy', 'Delete',
    'password_policy.update', 'Password policy updated', 'Cloud Resource', 'Password_policy', 'Set',
    'permission.create', 'RBAC permission created', 'Cloud Resource', 'Permission', 'Create',
    'permission.delete', 'RBAC permission deleted', 'Cloud Resource', 'Permission', 'Delete',
    'permission.update', 'RBAC permission updated', 'Cloud Resource', 'Permission', 'Set',
    'radius_config.create', 'Create domain RADIUS configuration', 'Cloud Resource', 'Radius_config', 'Create',
    'radius_config.delete', 'Delete domain RADIUS configuration', 'Cloud Resource', 'Radius_config', 'Delete',
    'radius_config.update', 'Update domain RADIUS configuration', 'Cloud Resource', 'Radius_config', 'Set',
    'radius_config.verify_shared_secret', 'Verify RADIUS shared secret', 'Cloud Resource', 'Radius_config', 'Other',
    'request.authentication_failed', 'API request authentication failed', 'Other', 'Request', 'Other',
    'request.authorization_failed', 'API request authorization failed', 'Other', 'Request', 'Other',
    'request.internal_server_error', 'API request failed due to internal server error', 'Other', 'Request', 'Other',
    'request.service_unavailable', 'API request failed due to unavailable service', 'Other', 'Request', 'Other',
    'request.unknown_server_error', 'API request failed due to unknown server error', 'Other', 'Request', 'Other',
    'resource.create', 'Login resource created', 'Other', 'Resource', 'Create',
    'resource.delete', 'Login resource deleted', 'Other', 'Resource', 'Delete',
    'resource.update', 'Login resource updated', 'Other', 'Resource', 'Set',
    'rule_set.create', 'Rule set created', 'Policy Rule', 'Rule_set', 'Create',
    'rule_set.delete', 'Rule set deleted', 'Policy Rule', 'Rule_set', 'Delete',
    'rule_set.update', 'Rule set updated', 'Policy Rule', 'Rule_set', 'Set',
    'rule_sets.delete', 'Rule sets deleted', 'Policy Rule', 'Rule_sets', 'Delete',
    'saml_acs.update', 'SAML assertion consumer services updated', 'Other', 'Saml_acs', 'Set',
    'saml_config.create', 'SAML configuration created', 'Cloud Resource', 'Saml_config', 'Create',
    'saml_config.delete', 'SAML configuration deleted', 'Cloud Resource', 'Saml_config', 'Delete',
    'saml_config.pce_signing_cert', 'Generate a new cert for signing SAML AuthN requests', 'Cloud Resource', 'Saml_config', 'Other',
    'saml_config.update', 'SAML configuration updated', 'Cloud Resource', 'Saml_config', 'Set',
    'saml_sp_config.create', 'SAML Service Provider created', 'Cloud Resource', 'Saml_sp_config', 'Create',
    'saml_sp_config.delete', 'SAML Service Provider deleted', 'Cloud Resource', 'Saml_sp_config', 'Delete',
    'saml_sp_config.update', 'SAML Service Provider updated', 'Cloud Resource', 'Saml_sp_config', 'Set',
    'sec_policy.create', 'Security policy created', 'Other', 'Sec_policy', 'Create',
    'sec_policy_pending.delete', 'Pending security policy deleted', 'Other', 'Sec_policy_pending', 'Delete',
    'sec_policy.restore', 'Security policy restored', 'Other', 'Sec_policy', 'Other',
    'sec_rule.create', 'Security policy rules created', 'Policy Rule', 'Sec_rule', 'Create',
    'sec_rule.delete', 'Security policy rules deleted', 'Policy Rule', 'Sec_rule', 'Delete',
    'sec_rule.update', 'Security policy rules updated', 'Policy Rule', 'Sec_rule', 'Set',
    'secure_connect_gateway.create', 'SecureConnect gateway created', 'Other', 'Secure_connect_gateway', 'Create',
    'secure_connect_gateway.delete', 'SecureConnect gateway deleted', 'Other', 'Secure_connect_gateway', 'Delete',
    'secure_connect_gateway.update', 'SecureConnect gateway updated', 'Other', 'Secure_connect_gateway', 'Set',
    'security_principal.create', 'RBAC security principal created', 'Other', 'Security_principal', 'Create',
    'security_principal.delete', 'RBAC security principal bulk deleted', 'Other', 'Security_principal', 'Delete',
    'security_principal.update', 'RBAC security principal bulk updated', 'Other', 'Security_principal', 'Set',
    'security_principals.bulk_create', 'RBAC security principals bulk created', 'Other', 'Security_principals', 'Other',
    'service.create', 'Service created', 'Other', 'Service', 'Create',
    'service.delete', 'Service deleted', 'Other', 'Service', 'Delete',
    'service.update', 'Service updated', 'Other', 'Service', 'Set',
    'service_account.create', 'Service account created', 'Other', 'Service_account', 'Create',
    'service_account.delete', 'Service account deleted', 'Other', 'Service_account', 'Delete',
    'service_account.update', 'Service account updated', 'Other', 'Service_account', 'Set',
    'service_binding.create', 'Service binding created', 'Other', 'Service_binding', 'Create',
    'service_binding.delete', 'Service binding created', 'Other', 'Service_binding', 'Delete',
    'service_bindings.delete', 'Service bindings deleted', 'Other', 'Service_bindings', 'Delete',
    'service_bindings.delete', 'Service binding deleted', 'Other', 'Service_bindings', 'Delete',
    'services.delete', 'Services deleted', 'Other', 'Services', 'Delete',
    'settings.update', 'Explorer settings updated', 'Other', 'Settings', 'Set',
    'slb.create', 'Server load balancer created', 'Other', 'Slb', 'Create',
    'slb.delete', 'Server load balancer deleted', 'Other', 'Slb', 'Delete',
    'slb.update', 'Server load balancer updated', 'Other', 'Slb', 'Set',
    'support_report.upload', 'Support report uploaded', 'Other', 'Support_report', 'Other',
    'syslog_destination.create', 'syslog remote destination created', 'Other', 'Syslog_destination', 'Create',
    'syslog_destination.delete', 'syslog remote destination deleted', 'Other', 'Syslog_destination', 'Delete',
    'syslog_destination.update', 'syslog remote destination updated', 'Other', 'Syslog_destination', 'Set',
    'system_task.agent_missed_heartbeats_check', 'Agent missed heartbeats', 'Cloud Resource', 'System_task', 'Other',
    'system_task.agent_missing_heartbeats_after_upgrade', 'VEN missing heartbeat after upgrade', 'Cloud Resource', 'System_task', 'Other',
    'system_task.agent_offline_check', 'Agents marked offline', 'Cloud Resource', 'System_task', 'Other',
    'system_task.agent_self_signed_certs_check', 'VEN self signed certificate housekeeping check', 'Cloud Resource', 'System_task', 'Other',
    'system_task.agent_settings_invalidation_error_state_check', 'VEN settings invalidation error state check', 'Cloud Resource', 'System_task', 'Other',
    'system_task.agent_uninstall_timeout', 'VEN uninstall timeout', 'Cloud Resource', 'System_task', 'Other',
    'system_task.clear_auth_recover_condition', 'Clear VEN authentication recovery condition', 'Other', 'System_task', 'Other',
    'system_task.compute_policy_for_unmanaged_workloads', 'Compute policy for unmanaged workloads', 'Cloud Resource', 'System_task', 'Other',
    'system_task.delete_expired_service_account_api_keys', 'An expired service account api_key was successfully deleted', 'Cloud Resource', 'System_task', 'Delete',
    'system_task.delete_old_cached_perspectives', 'Delete old cached perspectives', 'Other', 'System_task', 'Delete',
    'system_task.endpoint_offline_check', 'Endpoint marked offline', 'Other', 'System_task', 'Other',
    'system_task.provision_container_cluster_services', 'Container cluster services provisioned', 'Cloud Resource', 'System_task', 'Other',
    'system_task.prune_old_log_events', 'Event pruning completed', 'Other', 'System_task', 'Other',
    'system_task.remove_stale_zone_subsets', 'Stale zone subnets removed', 'Other', 'System_task', 'Other',
    'system_task.set_server_sync_check', 'Set server synced', 'Other', 'System_task', 'Other',
    'system_task.vacuum_deactivated_agent_and_deleted_workloads', 'Deactivated and deleted workloads have been vacuumed', 'Cloud Resource', 'System_task', 'Other',
    'traffic_collector_setting.create', 'Traffic collector setting created', 'Other', 'Traffic_collector_setting', 'Create',
    'traffic_collector_setting.delete', 'Traffic collector setting deleted', 'Other', 'Traffic_collector_setting', 'Delete',
    'traffic_collector_setting.update', 'Traffic collector setting updated', 'Other', 'Traffic_collector_setting', 'Set',
    'trusted_proxy_ips.update', 'Trusted proxy IPs created or updated', 'Other', 'Trusted_proxy_ips', 'Set',
    'user.accept_invitation', 'User invitation accepted', 'Cloud Resource', 'User', 'Other',
    'user.authenticate', 'User authenticated', 'Cloud Resource', 'User', 'Other',
    'user.create', 'User created', 'Cloud Resource', 'User', 'Create',
    'user.delete', 'User deleted', 'Cloud Resource', 'User', 'Delete',
    'user.invite', 'User invited', 'Cloud Resource', 'User', 'Other',
    'user.update', 'User information updated', 'Cloud Resource', 'User', 'Set',        
    'user.reset_password', 'User password reset', 'Cloud Resource', 'User', 'Other',
    'user.pce_session_terminated', 'User session terminated', 'Cloud Resource', 'User', 'Other',
    'user.login_session_terminated', 'User login session terminated', 'Cloud Resource', 'User', 'Other',
    'user.reset_password', 'User password reset', 'Cloud Resource', 'User', 'Other',
    'user.update', 'User information updated', 'Cloud Resource', 'User', 'Set',
    'user.update_password', 'User password updated', 'Cloud Resource', 'User', 'Set',
    'user.use_expired_password', 'User entered expired password', 'Cloud Resource', 'User', 'Other',
    'user.verify_mfa', 'User verified MFA', 'Cloud Resource', 'User', 'Other',
    'users.auth_token', 'Auth token returned for user authentication on PCE', 'Other', 'Users', 'Other',
    'user_local_profile.create', 'User local profile created', 'Other', 'User_local_profile', 'Create',
    'user_local_profile.delete', 'User local profile deleted', 'Other', 'User_local_profile', 'Delete',
    'user_local_profile.reinvite', 'User local profile reinvited', 'Other', 'User_local_profile', 'Other',
    'user_local_profile.update_password', 'User local password updated', 'Other', 'User_local_profile', 'Set',
    'ven_settings.update', 'VEN settings updated', 'Other', 'Ven_settings', 'Set',
    'ven_software.upgrade', 'VEN software release upgraded', 'Other', 'Ven_software', 'Set',
    'ven_software_release.create', 'VEN software release created', 'Other', 'Ven_software_release', 'Create',
    'ven_software_release.delete', 'VEN software release deleted', 'Other', 'Ven_software_release', 'Delete',
    'ven_software_release.deploy', 'VEN software release deployed', 'Other', 'Ven_software_release', 'Other',
    'ven_software_release.update', 'VEN software release updated', 'Other', 'Ven_software_release', 'Set',
    'ven_software_releases.set_default_version', 'Default VEN software version set', 'Other', 'Ven_software_releases', 'Other',
    'virtual_server.create', 'Virtual server created', 'Cloud Resource', 'Virtual_server', 'Create',
    'virtual_server.delete', 'Virtual server created', 'Cloud Resource', 'Virtual_server', 'Delete',
    'virtual_server.update', 'Virtual server updated', 'Cloud Resource', 'Virtual_server', 'Set',
    'virtual_service.create', 'Virtual service created', 'Cloud Resource', 'Virtual_service', 'Create',
    'virtual_service.delete', 'Virtual service deleted', 'Cloud Resource', 'Virtual_service', 'Delete',
    'virtual_service.update', 'Virtual service updated', 'Cloud Resource', 'Virtual_service', 'Set',
    'virtual_services.bulk_create', 'Virtual services created in bulk', 'Cloud Resource', 'Virtual_services', 'Other',
    'virtual_services.bulk_update', 'Virtual services updated in bulk', 'Cloud Resource', 'Virtual_services', 'Other',
    'vulnerability.create', 'Vulnerability record created', 'Other', 'Vulnerability', 'Create',
    'vulnerability.delete', 'Vulnerability record deleted', 'Other', 'Vulnerability', 'Delete',
    'vulnerability.update', 'Vulnerability record updated', 'Other', 'Vulnerability', 'Set',
    'vulnerability_report.delete', 'Vulnerability report deleted', 'Other', 'Vulnerability_report', 'Delete',
    'vulnerability_report.update', 'Vulnerability report updated', 'Other', 'Vulnerability_report', 'Set',
    'workload.create', 'Workload created', 'Cloud Resource', 'Workload', 'Create',
    'workload.delete', 'Workload deleted', 'Cloud Resource', 'Workload', 'Delete',
    'workload.online', 'Workload online', 'Cloud Resource', 'Workload', 'Other',
    'workload.recalc_rules', 'Workload policy recalculated', 'Cloud Resource', 'Workload', 'Other',
    'workload.redetect_network', 'Workload network redetected', 'Cloud Resource', 'Workload', 'Other',
    'workload.undelete', 'Workload undeleted', 'Cloud Resource', 'Workload', 'Other',
    'workload.update', 'Workload settings updated', 'Cloud Resource', 'Workload', 'Set',
    'workload.upgrade', 'Workload upgraded', 'Cloud Resource', 'Workload', 'Set',
    'workload_interface.create', 'Workload interface created', 'Cloud Resource', 'Workload_interface', 'Create',
    'workload_interface.delete', 'Workload interface deleted', 'Cloud Resource', 'Workload_interface', 'Delete',
    'workload_interface.update', 'Workload interface updated', 'Cloud Resource', 'Workload_interface', 'Set',
    'workload_interfaces.update', 'Workload interfaces updated', 'Cloud Resource', 'Workload_interfaces', 'Set',
    '', 'For example, IP address changes, new interface added, and interface shut down.', 'Other', '', 'Other',
    'workload_service_report.update', 'Workload service report updated', 'Cloud Resource', 'Workload_service_report', 'Set',
    'workload_settings.update', 'Workload settings updated', 'Cloud Resource', 'Workload_settings', 'Set',
    'workloads.apply_policy', 'Workloads policies applied', 'Cloud Resource', 'Workloads', 'Other',
    'workloads.bulk_create', 'Workloads created in bulk', 'Cloud Resource', 'Workloads', 'Other',
    'workloads.bulk_delete', 'Workloads deleted in bulk', 'Cloud Resource', 'Workloads', 'Other',
    'workloads.bulk_update', 'Workloads updated in bulk', 'Cloud Resource', 'Workloads', 'Other',
    'workloads.remove_labels', 'Workloads labels removed', 'Cloud Resource', 'Workloads', 'Other',
    'workloads.set_flow_reporting_frequency', 'Workload flow reporting frequency changed', 'Cloud Resource', 'Workloads', 'Other',
    'workloads.set_labels', 'Workload labels applied', 'Cloud Resource', 'Workloads', 'Other',
    'workloads.unpair', 'Workloads unpaired', 'Cloud Resource', 'Workloads', 'Other',
    'workloads.update', 'Workloads updated', 'Cloud Resource', 'Workloads', 'Set'
  ];
  let EventSeverityLookup = datatable(
      severity: string,
      EventSeverity: string
  )
      [
      "err", "High",
      "info", "Informational",
      "warning", "Medium"
  ];
  let EventResultLookup = datatable(
      status: string,
      EventResult: string
  )
      [
      "success", "Success",
      "failure", "Failure",
      "", "NA"
  ];
  let parser=  (
            starttime:datetime=datetime(null), 
            endtime:datetime=datetime(null),
            srcipaddr_has_any_prefix:dynamic=dynamic([]), 
            eventresult:string='*',
            actorusername_has_any:dynamic=dynamic([]),
            eventtype_in:dynamic=dynamic([]),
            operation_has_any:dynamic=dynamic([]), // not sure if this is required
            object_has_any:dynamic=dynamic([]), // not sure if this is required
            newvalue_has_any:dynamic=dynamic([]), // not mapped yet
            disabled:bool = false
    ){
      Illumio_Auditable_Events_CL 
      | where not(disabled) and (event_type !startswith "user") // filter out user auth events
        and ((isnull(starttime) or TimeGenerated >= starttime) and (isnull(endtime) or TimeGenerated <= endtime))      
        and (array_length(srcipaddr_has_any_prefix) == 0 or  has_any_ipv4_prefix(action.src_ip, srcipaddr_has_any_prefix))
      | lookup EventTypeLookup on event_type // fetch Object, ObjectType,EventType, Operation from lookup
      | lookup EventSeverityLookup on severity // fetch EventSeverity from lookup
      | lookup EventResultLookup on status // fetch EventResult from lookup
      | extend temp_resource_changes = parse_json(resource_changes)      
      | extend temp_notifications = parse_json(notifications)
      | extend
          NewValue = iff(isnotnull(temp_resource_changes), temp_resource_changes[0].changes, ''),
          EventMessage = iff(isnotnull(temp_resource_changes), temp_resource_changes[0].resource, ''),                
          SrcIpAddr = iff(action.src_ip == 'FILTERED', "", action.src_ip)
      | extend 
          ActorUsername = case(
              isnotnull(created_by.system), "System",
              isnotnull(created_by.user), created_by.user.username,
              isnotnull(created_by.agent), created_by.agent.hostname,
              "Unknown"
          )          
      | extend ActorUsernameType = "Simple"                     
      // ***** parser filter params *****
      | where (array_length(eventtype_in) == 0 or EventType in (eventtype_in)) 
      and (eventresult == "*" or EventResult =~ eventresult) and (array_length(actorusername_has_any) == 0 or ActorUsername has_any (actorusername_has_any))       
      and (array_length(operation_has_any) == 0 or Operation has_any (operation_has_any))
      and (array_length(object_has_any) == 0 or Object has_any (object_has_any))
      and (array_length(newvalue_has_any) == 0)
      // ***** parser filter params *****
      | extend
          EventCount = int(1),
          EventStartTime = TimeGenerated, 
          EventEndTime= TimeGenerated,
          EventProduct = 'Core',
          EventVendor = 'Illumio',
          EventSchemaVersion = '0.1.0',
          EventSchema = 'AuditEvent',
          Dvc = pce_fqdn,
          EventType = iff(isnull(EventType), event_type, EventType),
          EventOriginalUid = href,
          EventUid = _ItemId
      //aliases
      | extend          
          IpAddr = SrcIpAddr,
          User = ActorUsername,
          Value = NewValue          
      | project-away 
          event_type, // used by EventType          
          severity, // used by EventSeverity  
          temp_*,      
          resource_changes, // used by NewValue and EventMessage
          notifications,
          version, // simply drop version, no need to translate
          action, //used by src_ip
          status, // used by EventResult
          created_by, // used by ActorUsername and ActorType
          pce_fqdn, // used by Dvc
          href, // used by EventOriginalUid
          TenantId
  };
  parser (
      starttime = starttime,
      endtime = endtime,
      srcipaddr_has_any_prefix = srcipaddr_has_any_prefix,
      actorusername_has_any = actorusername_has_any,
      eventtype_in = eventtype_in,
      eventresult = eventresult,
      operation_has_any = operation_has_any,
      object_has_any=object_has_any,
      newvalue_has_any=newvalue_has_any,
      disabled=disabled
  )