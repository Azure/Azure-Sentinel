{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for Cisco Secure Endpoint"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Cisco Secure Endpoint",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "Cisco Secure Endpoint",
    "_solutionVersion": "3.0.1",
    "solutionId": "azuresentinel.azure-sentinel-solution-ciscosecureendpoint",
    "_solutionId": "[variables('solutionId')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "CiscoSecureEndpointOverviewWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','CiscoSecureEndpoint')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'CiscoSecureEndpoint')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('CiscoSecureEndpoint-Parser')))]",
      "parserVersion1": "1.0.0",
      "parserContentId1": "CiscoSecureEndpoint-Parser"
    },
    "huntingQueryObject1": {
      "huntingQueryVersion1": "1.0.0",
      "_huntingQuerycontentId1": "2b2415f3-6bfd-48df-8f9f-a1ccf67449f5",
      "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('2b2415f3-6bfd-48df-8f9f-a1ccf67449f5')))]"
    },
    "huntingQueryObject2": {
      "huntingQueryVersion2": "1.0.0",
      "_huntingQuerycontentId2": "f597ff7a-bddc-4cb1-83a8-62b0d7f4740d",
      "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('f597ff7a-bddc-4cb1-83a8-62b0d7f4740d')))]"
    },
    "huntingQueryObject3": {
      "huntingQueryVersion3": "1.0.0",
      "_huntingQuerycontentId3": "987681e4-3f0f-484c-95c1-88044b07759b",
      "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('987681e4-3f0f-484c-95c1-88044b07759b')))]"
    },
    "huntingQueryObject4": {
      "huntingQueryVersion4": "1.0.0",
      "_huntingQuerycontentId4": "d074fc1b-e276-48c8-9ef4-d691652a6625",
      "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('d074fc1b-e276-48c8-9ef4-d691652a6625')))]"
    },
    "huntingQueryObject5": {
      "huntingQueryVersion5": "1.0.0",
      "_huntingQuerycontentId5": "0c478995-c9c0-44ad-b3e9-428d54851b0c",
      "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('0c478995-c9c0-44ad-b3e9-428d54851b0c')))]"
    },
    "huntingQueryObject6": {
      "huntingQueryVersion6": "1.0.0",
      "_huntingQuerycontentId6": "fd6f8d2b-416d-4ee6-8289-961022205d7e",
      "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('fd6f8d2b-416d-4ee6-8289-961022205d7e')))]"
    },
    "huntingQueryObject7": {
      "huntingQueryVersion7": "1.0.0",
      "_huntingQuerycontentId7": "1eae0963-16be-4d49-9491-6fc54f8254fd",
      "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('1eae0963-16be-4d49-9491-6fc54f8254fd')))]"
    },
    "huntingQueryObject8": {
      "huntingQueryVersion8": "1.0.0",
      "_huntingQuerycontentId8": "31c92a55-375a-4199-8407-d2863476d85d",
      "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('31c92a55-375a-4199-8407-d2863476d85d')))]"
    },
    "huntingQueryObject9": {
      "huntingQueryVersion9": "1.0.0",
      "_huntingQuerycontentId9": "dc87c967-61d2-48e9-9fe1-26920944ca57",
      "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('dc87c967-61d2-48e9-9fe1-26920944ca57')))]"
    },
    "huntingQueryObject10": {
      "huntingQueryVersion10": "1.0.0",
      "_huntingQuerycontentId10": "3d3330e9-d11b-4b68-8861-251253950bd2",
      "huntingQueryTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('3d3330e9-d11b-4b68-8861-251253950bd2')))]"
    },
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "CiscoSecureEndpointLogsCCPDefinition",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "CiscoSecureEndpointLogsCCPDefinitionConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "uiConfigId2": "CiscoSecureEndpoint",
    "_uiConfigId2": "[variables('uiConfigId2')]",
    "dataConnectorContentId2": "CiscoSecureEndpoint",
    "_dataConnectorContentId2": "[variables('dataConnectorContentId2')]",
    "dataConnectorId2": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
    "_dataConnectorId2": "[variables('dataConnectorId2')]",
    "dataConnectorTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId2'))))]",
    "dataConnectorVersion2": "1.0.0",
    "_dataConnectorcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId2'),'-', variables('dataConnectorVersion2'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.1",
      "_analyticRulecontentId1": "4683ebce-07ad-4089-89e3-39d8fe83c011",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4683ebce-07ad-4089-89e3-39d8fe83c011')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4683ebce-07ad-4089-89e3-39d8fe83c011')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','4683ebce-07ad-4089-89e3-39d8fe83c011','-', '1.0.1')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "0f788a93-dc88-4f80-89ef-bef7cd0fef05",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '0f788a93-dc88-4f80-89ef-bef7cd0fef05')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('0f788a93-dc88-4f80-89ef-bef7cd0fef05')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','0f788a93-dc88-4f80-89ef-bef7cd0fef05','-', '1.0.0')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "b6df3e11-de70-4779-ac9a-276c454a9025",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'b6df3e11-de70-4779-ac9a-276c454a9025')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('b6df3e11-de70-4779-ac9a-276c454a9025')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','b6df3e11-de70-4779-ac9a-276c454a9025','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "bccdbc39-31d3-4e2b-9df2-e4c9eecba825",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'bccdbc39-31d3-4e2b-9df2-e4c9eecba825')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('bccdbc39-31d3-4e2b-9df2-e4c9eecba825')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','bccdbc39-31d3-4e2b-9df2-e4c9eecba825','-', '1.0.0')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.0",
      "_analyticRulecontentId5": "aea4468e-6322-48b6-bd83-f9d300cce855",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'aea4468e-6322-48b6-bd83-f9d300cce855')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('aea4468e-6322-48b6-bd83-f9d300cce855')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','aea4468e-6322-48b6-bd83-f9d300cce855','-', '1.0.0')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.0",
      "_analyticRulecontentId6": "225053c7-085b-4fca-a18f-c367f9228bf3",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '225053c7-085b-4fca-a18f-c367f9228bf3')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('225053c7-085b-4fca-a18f-c367f9228bf3')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','225053c7-085b-4fca-a18f-c367f9228bf3','-', '1.0.0')))]"
    },
    "analyticRuleObject7": {
      "analyticRuleVersion7": "1.0.0",
      "_analyticRulecontentId7": "b13489d7-feb1-4ad3-9a4c-09f6d64448fd",
      "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'b13489d7-feb1-4ad3-9a4c-09f6d64448fd')]",
      "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('b13489d7-feb1-4ad3-9a4c-09f6d64448fd')))]",
      "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','b13489d7-feb1-4ad3-9a4c-09f6d64448fd','-', '1.0.0')))]"
    },
    "analyticRuleObject8": {
      "analyticRuleVersion8": "1.0.0",
      "_analyticRulecontentId8": "64fece0a-44db-4bab-844d-fd503dc0aaba",
      "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '64fece0a-44db-4bab-844d-fd503dc0aaba')]",
      "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('64fece0a-44db-4bab-844d-fd503dc0aaba')))]",
      "_analyticRulecontentProductId8": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','64fece0a-44db-4bab-844d-fd503dc0aaba','-', '1.0.0')))]"
    },
    "analyticRuleObject9": {
      "analyticRuleVersion9": "1.0.0",
      "_analyticRulecontentId9": "c9629114-0f49-4b50-9f1b-345287b2eebf",
      "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'c9629114-0f49-4b50-9f1b-345287b2eebf')]",
      "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('c9629114-0f49-4b50-9f1b-345287b2eebf')))]",
      "_analyticRulecontentProductId9": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','c9629114-0f49-4b50-9f1b-345287b2eebf','-', '1.0.0')))]"
    },
    "analyticRuleObject10": {
      "analyticRuleVersion10": "1.0.0",
      "_analyticRulecontentId10": "eabb9c20-7b0b-4a77-81e8-b06944f351c6",
      "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'eabb9c20-7b0b-4a77-81e8-b06944f351c6')]",
      "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('eabb9c20-7b0b-4a77-81e8-b06944f351c6')))]",
      "_analyticRulecontentProductId10": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','eabb9c20-7b0b-4a77-81e8-b06944f351c6','-', '1.0.0')))]"
    },
    "analyticRuleObject11": {
      "analyticRuleVersion11": "1.0.0",
      "_analyticRulecontentId11": "d2c97cc9-1ccc-494d-bad4-564700451a2b",
      "analyticRuleId11": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'd2c97cc9-1ccc-494d-bad4-564700451a2b')]",
      "analyticRuleTemplateSpecName11": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('d2c97cc9-1ccc-494d-bad4-564700451a2b')))]",
      "_analyticRulecontentProductId11": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','d2c97cc9-1ccc-494d-bad4-564700451a2b','-', '1.0.0')))]"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Cisco Secure Endpoint Overview Workbook with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Sets the time name for analysis"
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"**NOTE**: This data connector depends on a parser based on Kusto Function **CiscoSecureEndpoint** to work as expected. [Follow steps to get this Kusto Function](https://aka.ms/sentinel-CiscoSecureEndpoint-parser)\"},\"name\":\"text - 8\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"cd8447d9-b096-4673-92d8-2a1e8291a125\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"description\":\"Sets the time name for analysis\",\"value\":{\"durationMs\":7776000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSecureEndpoint\\r\\n| make-series TotalEvents = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain};\",\"size\":0,\"title\":\"Events Over Time\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"graphSettings\":{\"type\":0}},\"customWidth\":\"60\",\"name\":\"query - 12\",\"styleSettings\":{\"maxWidth\":\"55\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSecureEndpoint\\r\\n| where isnotempty(EventMessage)\\r\\n| where isempty(EventSubType)\\r\\n| summarize count() by EventMessage\",\"size\":3,\"title\":\"Threats Types\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"30\",\"name\":\"query - 0\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSecureEndpoint\\r\\n| where isnotempty(ThreatName)\\r\\n| summarize dcount(DstHostname) \",\"size\":3,\"title\":\"Infected Hosts\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"name\":\"query - 0\"}]},\"name\":\"group - 1\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSecureEndpoint\\r\\n| where isnotempty(ThreatName) \\r\\n| where isnotempty(DstUsername)\\r\\n| summarize dcount(DstUsername)\",\"size\":3,\"title\":\"Infected Users\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"name\":\"query - 0\"}]},\"name\":\"group - 2\"}]},\"customWidth\":\"10\",\"name\":\"group - 9\",\"styleSettings\":{\"maxWidth\":\"100\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSecureEndpoint\\r\\n| where isnotempty(ThreatName)\\r\\n| summarize count() by DstHostname\\r\\n| top 10 by count_ \",\"size\":3,\"title\":\"Top Host with threats\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"34\",\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSecureEndpoint\\r\\n| where isnotempty(ThreatName)\\r\\n| summarize count() by User\\r\\n| top 10 by count_ \",\"size\":3,\"title\":\"Top User with infections\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"query - 3\",\"styleSettings\":{\"margin\":\"10\",\"padding\":\"10\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSecureEndpoint\\r\\n| where EventMessage =~ 'Vulnerable Application Detected'\\r\\n| summarize count() by SrcFileName\\r\\n| top 10 by count_\",\"size\":3,\"title\":\"Top Vulnerable Applications\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"33\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSecureEndpoint\\r\\n| where EventMessage =~ 'Threat Detected'\\r\\n| order by TimeGenerated desc\\r\\n| project EventTime=TimeGenerated, Host=DstHostname, ThreatName\",\"size\":3,\"title\":\"Latest Threats\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"40\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSecureEndpoint\\r\\n| where EventMessage in~ (@'Scan Completed, No Detections', @'Scan Completed With Detections')\\r\\n| order by TimeGenerated desc\\r\\n| project File=SrcFileName, Host=DstHostname, Status=strcat(iff(EventMessage =~ @'Scan Completed With Detections', '❌', '✅'))\",\"size\":0,\"title\":\"Latest files scanned\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":50,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 12\",\"styleSettings\":{\"maxWidth\":\"33\"}}],\"fromTemplateId\":\"sentinel-CiscoSecureEndpointOverviewWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=CiscoSecureEndpointOverviewWorkbook; logoFileName=cisco-logo-72px.svg; description=Sets the time name for analysis; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Cisco Secure Endpoint; templateRelativePath=Cisco Secure Endpoint Overview.json; subtitle=; provider=Cisco}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "CiscoSecureEndpoint",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "CiscoSecureEndpoint",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSecureEndpoint Data Parser with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for CiscoSecureEndpoint",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "CiscoSecureEndpoint",
                "query": "let CiscoSecureEndpoint_View = view () {\n  CiscoSecureEndpoint_CL\n  | extend \n      EventVendor = 'Cisco',\n      EventProduct = 'Cisco Secure Endpoint'\n  | extend\n      EventSubType = column_ifexists('audit_log_type_s', ''),\n      SrcUserName = column_ifexists('audit_log_user_s', ''),\n      DstMacAddr = column_ifexists('computer_network_addresses_s', ''),\n      DstHostname = column_ifexists('computer_hostname_s', ''),\n      DstUsername = column_ifexists('computer_user_s', ''),\n      DstIpAddr = column_ifexists('computer_external_ip_s', ''),\n      ConnectorGuid = column_ifexists('connector_guid_g', ''),\n      GroupGuid = column_ifexists('group_guids_s', ''),\n      DvcId = column_ifexists('id_d', ''),\n      EventOriginalId = column_ifexists('event_type_id_d', ''),\n      ThreatName = column_ifexists('detection_s', ''),\n      ThreatId = column_ifexists('detection_id_s', ''),\n      ThreatSeverity = column_ifexists('severity_s', ''),\n      DstDvcHostname = column_ifexists('new_attributes_name_s', ''),\n      DvcHostname = column_ifexists('new_attributes_hostname_s', ''),\n      DvcIpAddr = column_ifexists('new_attributes_ip_external_s', ''),\n      DstDvcOsId = column_ifexists('new_attributes_operating_system_id_d', ''),\n      EventProductVersion = column_ifexists('new_attributes_product_version_id_d', ''),\n      SrcDvcId = column_ifexists('computer_connector_guid_g', ''),\n      ComputerLinksComputer = column_ifexists('computer_links_computer_s', ''),\n      ComputerLinksTrajectory = column_ifexists('computer_links_trajectory_s', ''),\n      ComputerLinksGroup = column_ifexists('computer_links_group_s', ''),\n      IndicatorThreatType = column_ifexists('file_disposition_s', ''),\n      SrcFileName = column_ifexists('file_file_name_s', ''),\n      SrcFilePath = column_ifexists('file_file_path_s', ''),\n      SrcFileMD5 = column_ifexists('file_identity_md5_g', ''),\n      SrcFileSHA1 = column_ifexists('file_identity_sha1_s', ''),\n      SrcFileSHA256 = column_ifexists('file_identity_sha256_s', ''),\n      ParentProcessId = column_ifexists('file_parent_process_id_d', ''),\n      ParentProcessMD5 = column_ifexists('file_parent_identity_md5_g', ''),\n      ParentProcessSHA1 = column_ifexists('file_parent_identity_sha1_s', ''),\n      ParentProcessSHA256 = column_ifexists('file_parent_identity_sha256_s', ''),\n      ParentProcessName = column_ifexists('file_parent_file_name_s', ''),\n      ParentProcessFileDescription = column_ifexists('file_parent_disposition_s', '')\n  | extend\n      EventEndTime=iff(isnotempty(created_at_t), todatetime(created_at_t), todatetime(date_t)),\n      EventMessage=iff(isnotempty(event_s), event_s, event_type_s),\n      Hostname = DstHostname,\n      User = DstUsername\n  };\n  let CiscoSecureEndpointAudit_View = view () {\n  CiscoSecureEndpointAuditLogsV2_CL\n  | extend \n      EventVendor = 'Cisco',\n      EventProduct = 'Cisco Secure Endpoint'\n  | extend \n      EventSubType = column_ifexists('AuditLogType', ''),\n      SrcUserName = column_ifexists('AuditLogUser', ''),\n      DstDvcHostname = column_ifexists('NewAttributes.name', ''),\n      DvcHostname = column_ifexists('NewAttributes.hostname', ''),\n      DvcIpAddr = column_ifexists('NewAttributes.ip_external', ''),\n      DstDvcOsId = column_ifexists('NewAttributes.operating_system_id', ''),\n      EventProductVersion = column_ifexists('NewAttributes.product_version_id', ''),\n      EventEndTime = todatetime(column_ifexists('CreatedAt', '')),\n      EventMessage = column_ifexists('Event', '')\n  };\n  let CiscoSecureEndpointEvent_View = view () {\n  CiscoSecureEndpointEventsV2_CL\n  | extend \n      EventVendor = 'Cisco',\n      EventProduct = 'Cisco Secure Endpoint'\n  | extend\n      DstMacAddr = column_ifexists('ComputerNetworkAddresses', ''),\n      DstHostname = column_ifexists('ComputerHostname', ''),\n      DstUsername = column_ifexists('ComputerUser', ''),\n      DstIpAddr = column_ifexists('ComputerExternalIp', ''),\n      ConnectorGuid = column_ifexists('ConnectorGuid', ''),\n      GroupGuid = column_ifexists('GroupGuids', ''),\n      DvcId = column_ifexists('Id', ''),\n      ThreatName = column_ifexists('Detection', ''),\n      ThreatId = column_ifexists('DetectionId', ''),\n      ThreatSeverity = column_ifexists('Severity', ''),\n      EventOriginalId = column_ifexists('EventTypeId', ''),\n      SrcDvcId = column_ifexists('ComputerConnectorGuid', ''),\n      ComputerLinksComputer = column_ifexists('ComputerLinksComputer', ''),\n      ComputerLinksTrajectory = column_ifexists('ComputerLinksTrajectory', ''),\n      ComputerLinksGroup = column_ifexists('ComputerLinksGroup', ''),\n      IndicatorThreatType = column_ifexists('FileDisposition', ''),\n      SrcFileName = column_ifexists('FileFileName', ''),\n      SrcFilePath = column_ifexists('FileFilePath', ''),\n      SrcFileMD5 = column_ifexists('FileIdentityMd5', ''),\n      SrcFileSHA1 = column_ifexists('FileIdentitySha1', ''),\n      SrcFileSHA256 = column_ifexists('FileIdentitySha256', ''),\n      ParentProcessId = column_ifexists('FileParentProcessId', ''),\n      ParentProcessMD5 = column_ifexists('FileParentIdentityMd5', ''),\n      ParentProcessSHA1 = column_ifexists('FileParentIdentitySha1', ''),\n      ParentProcessSHA256 = column_ifexists('FileParentIdentitySha256', ''),\n      ParentProcessName = column_ifexists('FileParentFileName', ''),\n      ParentProcessFileDescription = column_ifexists('FileParentDisposition', ''),\n      EventEndTime = todatetime(column_ifexists('Date', '')),\n      EventMessage = column_ifexists('EventType', '')\n  | extend\n      Hostname = DstHostname,\n      User = DstUsername\n  };\n  union isfuzzy=true\n  (CiscoSecureEndpoint_View),\n  (CiscoSecureEndpointAudit_View),\n  (CiscoSecureEndpointEvent_View)\n  | project\n  EventVendor,\n  EventProduct,\n  EventSubType,\n  SrcUserName,\n  DstMacAddr,\n  DstHostname,\n  DstUsername,\n  DstIpAddr,\n  ConnectorGuid,\n  GroupGuid,\n  DvcId,\n  EventOriginalId,\n  ThreatName,\n  ThreatId,\n  ThreatSeverity,\n  DstDvcHostname,\n  DvcHostname,\n  DvcIpAddr,\n  DstDvcOsId,\n  EventProductVersion,\n  SrcDvcId,\n  ComputerLinksComputer,\n  ComputerLinksTrajectory,\n  ComputerLinksGroup,\n  IndicatorThreatType,\n  SrcFileName,\n  SrcFilePath,\n  SrcFileMD5,\n  SrcFileSHA1,\n  SrcFileSHA256,\n  ParentProcessId,\n  ParentProcessMD5,\n  ParentProcessSHA1,\n  ParentProcessSHA256,\n  ParentProcessName,\n  ParentProcessFileDescription,\n  EventEndTime,\n  EventMessage,\n  Hostname,\n  User\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'CiscoSecureEndpoint')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "Cisco Secure Endpoint",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "Parser for CiscoSecureEndpoint",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for CiscoSecureEndpoint",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "CiscoSecureEndpoint",
        "query": "let CiscoSecureEndpoint_View = view () {\n  CiscoSecureEndpoint_CL\n  | extend \n      EventVendor = 'Cisco',\n      EventProduct = 'Cisco Secure Endpoint'\n  | extend\n      EventSubType = column_ifexists('audit_log_type_s', ''),\n      SrcUserName = column_ifexists('audit_log_user_s', ''),\n      DstMacAddr = column_ifexists('computer_network_addresses_s', ''),\n      DstHostname = column_ifexists('computer_hostname_s', ''),\n      DstUsername = column_ifexists('computer_user_s', ''),\n      DstIpAddr = column_ifexists('computer_external_ip_s', ''),\n      ConnectorGuid = column_ifexists('connector_guid_g', ''),\n      GroupGuid = column_ifexists('group_guids_s', ''),\n      DvcId = column_ifexists('id_d', ''),\n      EventOriginalId = column_ifexists('event_type_id_d', ''),\n      ThreatName = column_ifexists('detection_s', ''),\n      ThreatId = column_ifexists('detection_id_s', ''),\n      ThreatSeverity = column_ifexists('severity_s', ''),\n      DstDvcHostname = column_ifexists('new_attributes_name_s', ''),\n      DvcHostname = column_ifexists('new_attributes_hostname_s', ''),\n      DvcIpAddr = column_ifexists('new_attributes_ip_external_s', ''),\n      DstDvcOsId = column_ifexists('new_attributes_operating_system_id_d', ''),\n      EventProductVersion = column_ifexists('new_attributes_product_version_id_d', ''),\n      SrcDvcId = column_ifexists('computer_connector_guid_g', ''),\n      ComputerLinksComputer = column_ifexists('computer_links_computer_s', ''),\n      ComputerLinksTrajectory = column_ifexists('computer_links_trajectory_s', ''),\n      ComputerLinksGroup = column_ifexists('computer_links_group_s', ''),\n      IndicatorThreatType = column_ifexists('file_disposition_s', ''),\n      SrcFileName = column_ifexists('file_file_name_s', ''),\n      SrcFilePath = column_ifexists('file_file_path_s', ''),\n      SrcFileMD5 = column_ifexists('file_identity_md5_g', ''),\n      SrcFileSHA1 = column_ifexists('file_identity_sha1_s', ''),\n      SrcFileSHA256 = column_ifexists('file_identity_sha256_s', ''),\n      ParentProcessId = column_ifexists('file_parent_process_id_d', ''),\n      ParentProcessMD5 = column_ifexists('file_parent_identity_md5_g', ''),\n      ParentProcessSHA1 = column_ifexists('file_parent_identity_sha1_s', ''),\n      ParentProcessSHA256 = column_ifexists('file_parent_identity_sha256_s', ''),\n      ParentProcessName = column_ifexists('file_parent_file_name_s', ''),\n      ParentProcessFileDescription = column_ifexists('file_parent_disposition_s', '')\n  | extend\n      EventEndTime=iff(isnotempty(created_at_t), todatetime(created_at_t), todatetime(date_t)),\n      EventMessage=iff(isnotempty(event_s), event_s, event_type_s),\n      Hostname = DstHostname,\n      User = DstUsername\n  };\n  let CiscoSecureEndpointAudit_View = view () {\n  CiscoSecureEndpointAuditLogsV2_CL\n  | extend \n      EventVendor = 'Cisco',\n      EventProduct = 'Cisco Secure Endpoint'\n  | extend \n      EventSubType = column_ifexists('AuditLogType', ''),\n      SrcUserName = column_ifexists('AuditLogUser', ''),\n      DstDvcHostname = column_ifexists('NewAttributes.name', ''),\n      DvcHostname = column_ifexists('NewAttributes.hostname', ''),\n      DvcIpAddr = column_ifexists('NewAttributes.ip_external', ''),\n      DstDvcOsId = column_ifexists('NewAttributes.operating_system_id', ''),\n      EventProductVersion = column_ifexists('NewAttributes.product_version_id', ''),\n      EventEndTime = todatetime(column_ifexists('CreatedAt', '')),\n      EventMessage = column_ifexists('Event', '')\n  };\n  let CiscoSecureEndpointEvent_View = view () {\n  CiscoSecureEndpointEventsV2_CL\n  | extend \n      EventVendor = 'Cisco',\n      EventProduct = 'Cisco Secure Endpoint'\n  | extend\n      DstMacAddr = column_ifexists('ComputerNetworkAddresses', ''),\n      DstHostname = column_ifexists('ComputerHostname', ''),\n      DstUsername = column_ifexists('ComputerUser', ''),\n      DstIpAddr = column_ifexists('ComputerExternalIp', ''),\n      ConnectorGuid = column_ifexists('ConnectorGuid', ''),\n      GroupGuid = column_ifexists('GroupGuids', ''),\n      DvcId = column_ifexists('Id', ''),\n      ThreatName = column_ifexists('Detection', ''),\n      ThreatId = column_ifexists('DetectionId', ''),\n      ThreatSeverity = column_ifexists('Severity', ''),\n      EventOriginalId = column_ifexists('EventTypeId', ''),\n      SrcDvcId = column_ifexists('ComputerConnectorGuid', ''),\n      ComputerLinksComputer = column_ifexists('ComputerLinksComputer', ''),\n      ComputerLinksTrajectory = column_ifexists('ComputerLinksTrajectory', ''),\n      ComputerLinksGroup = column_ifexists('ComputerLinksGroup', ''),\n      IndicatorThreatType = column_ifexists('FileDisposition', ''),\n      SrcFileName = column_ifexists('FileFileName', ''),\n      SrcFilePath = column_ifexists('FileFilePath', ''),\n      SrcFileMD5 = column_ifexists('FileIdentityMd5', ''),\n      SrcFileSHA1 = column_ifexists('FileIdentitySha1', ''),\n      SrcFileSHA256 = column_ifexists('FileIdentitySha256', ''),\n      ParentProcessId = column_ifexists('FileParentProcessId', ''),\n      ParentProcessMD5 = column_ifexists('FileParentIdentityMd5', ''),\n      ParentProcessSHA1 = column_ifexists('FileParentIdentitySha1', ''),\n      ParentProcessSHA256 = column_ifexists('FileParentIdentitySha256', ''),\n      ParentProcessName = column_ifexists('FileParentFileName', ''),\n      ParentProcessFileDescription = column_ifexists('FileParentDisposition', ''),\n      EventEndTime = todatetime(column_ifexists('Date', '')),\n      EventMessage = column_ifexists('EventType', '')\n  | extend\n      Hostname = DstHostname,\n      User = DstUsername\n  };\n  union isfuzzy=true\n  (CiscoSecureEndpoint_View),\n  (CiscoSecureEndpointAudit_View),\n  (CiscoSecureEndpointEvent_View)\n  | project\n  EventVendor,\n  EventProduct,\n  EventSubType,\n  SrcUserName,\n  DstMacAddr,\n  DstHostname,\n  DstUsername,\n  DstIpAddr,\n  ConnectorGuid,\n  GroupGuid,\n  DvcId,\n  EventOriginalId,\n  ThreatName,\n  ThreatId,\n  ThreatSeverity,\n  DstDvcHostname,\n  DvcHostname,\n  DvcIpAddr,\n  DstDvcOsId,\n  EventProductVersion,\n  SrcDvcId,\n  ComputerLinksComputer,\n  ComputerLinksTrajectory,\n  ComputerLinksGroup,\n  IndicatorThreatType,\n  SrcFileName,\n  SrcFilePath,\n  SrcFileMD5,\n  SrcFileSHA1,\n  SrcFileSHA256,\n  ParentProcessId,\n  ParentProcessMD5,\n  ParentProcessSHA1,\n  ParentProcessSHA256,\n  ParentProcessName,\n  ParentProcessFileDescription,\n  EventEndTime,\n  EventMessage,\n  Hostname,\n  User\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'CiscoSecureEndpoint')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "Cisco Secure Endpoint",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject1').huntingQueryTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEInfectedHosts_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject1').huntingQueryVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cisco_Secure_Endpoint_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cisco SE - Infected hosts",
                "category": "Hunting Queries",
                "query": "CiscoSecureEndpoint\n| where TimeGenerated > ago(24h)\n| where isnotempty(ThreatName)\n| order by TimeGenerated desc\n| extend HostCustomEntity = DstHostname\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for infected hosts."
                  },
                  {
                    "name": "tactics",
                    "value": "Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1204.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1),'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Hunting Query 1",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1)]",
                "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject1').huntingQueryVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
        "contentKind": "HuntingQuery",
        "displayName": "Cisco SE - Infected hosts",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject2').huntingQueryTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEInfectedUsers_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject2').huntingQueryVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cisco_Secure_Endpoint_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cisco SE - Infected users",
                "category": "Hunting Queries",
                "query": "CiscoSecureEndpoint\n| where TimeGenerated > ago(24h)\n| where isnotempty(ThreatName)\n| order by TimeGenerated desc\n| extend AccountCustomEntity = User\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for infected users."
                  },
                  {
                    "name": "tactics",
                    "value": "Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1204.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2),'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Hunting Query 2",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2)]",
                "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject2').huntingQueryVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
        "contentKind": "HuntingQuery",
        "displayName": "Cisco SE - Infected users",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject3').huntingQueryTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSELoginsToConsole_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject3').huntingQueryVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cisco_Secure_Endpoint_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cisco SE - User Logins",
                "category": "Hunting Queries",
                "query": "CiscoSecureEndpoint\n| where TimeGenerated > ago(24h)\n| where EventSubType =~ 'User'\n| where EventMessage =~ 'login'\n| extend AccountCustomEntity = SrcUserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for user logins to management console."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3),'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Hunting Query 3",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3)]",
                "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject3').huntingQueryVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
        "contentKind": "HuntingQuery",
        "displayName": "Cisco SE - User Logins",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject4').huntingQueryTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEMaliciousFiles_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject4').huntingQueryVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cisco_Secure_Endpoint_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cisco SE - Malicious files",
                "category": "Hunting Queries",
                "query": "CiscoSecureEndpoint\n| where TimeGenerated > ago(24h)\n| where IndicatorThreatType =~ 'Malicious'\n| order by TimeGenerated desc\n| extend FileCustomEntity = SrcFileName, HostCustomEntity = DstHostname\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for malicious files."
                  },
                  {
                    "name": "tactics",
                    "value": "Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1204.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4),'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Hunting Query 4",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4)]",
                "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject4').huntingQueryVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
        "contentKind": "HuntingQuery",
        "displayName": "Cisco SE - Malicious files",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject5').huntingQueryTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEModifiedAgent_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject5').huntingQueryVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cisco_Secure_Endpoint_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cisco SE - Modified agents on hosts",
                "category": "Hunting Queries",
                "query": "CiscoSecureEndpoint\n| where TimeGenerated > ago(24h)\n| where EventSubType =~ 'Agent'\n| where EventMessage !~ 'create'\n| extend HostCustomEntity = DstHostname\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for hosts with modified agent settings."
                  },
                  {
                    "name": "tactics",
                    "value": "DefenseEvasion"
                  },
                  {
                    "name": "techniques",
                    "value": "T1562"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5),'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Hunting Query 5",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5)]",
                "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject5').huntingQueryVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
        "contentKind": "HuntingQuery",
        "displayName": "Cisco SE - Modified agents on hosts",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject6').huntingQueryTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSERareFilesScanned_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject6').huntingQueryVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cisco_Secure_Endpoint_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cisco SE - Rare scanned files",
                "category": "Hunting Queries",
                "query": "CiscoSecureEndpoint\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'Scan Started'\n| summarize count() by SrcFileName\n| top 20 by count_ asc\n| extend FileCustomEntity = SrcFileName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for rare scanned files."
                  },
                  {
                    "name": "tactics",
                    "value": "Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1204.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6),'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Hunting Query 6",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6)]",
                "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject6').huntingQueryVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
        "contentKind": "HuntingQuery",
        "displayName": "Cisco SE - Rare scanned files",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject7').huntingQueryTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEScannedFiles_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject7').huntingQueryVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cisco_Secure_Endpoint_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cisco SE - Scanned files",
                "category": "Hunting Queries",
                "query": "CiscoSecureEndpoint\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'Scan Started'\n| order by TimeGenerated desc\n| extend FileCustomEntity = SrcFileName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for scanned files."
                  },
                  {
                    "name": "tactics",
                    "value": "Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1204.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7),'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Hunting Query 7",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7)]",
                "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject7').huntingQueryVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
        "contentKind": "HuntingQuery",
        "displayName": "Cisco SE - Scanned files",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject8').huntingQueryTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSESuspiciousPSDownloads_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject8').huntingQueryVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cisco_Secure_Endpoint_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cisco SE - Suspicious powershel downloads",
                "category": "Hunting Queries",
                "query": "CiscoSecureEndpoint\n| where TimeGenerated > ago(24h)\n| where ThreatName has 'PowerShell Download String'\n| order by TimeGenerated desc\n| extend HostCustomEntity = DstHostname\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for suspicious powershell downloads."
                  },
                  {
                    "name": "tactics",
                    "value": "Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1204.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8),'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Hunting Query 8",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8)]",
                "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject8').huntingQueryVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
        "contentKind": "HuntingQuery",
        "displayName": "Cisco SE - Suspicious powershel downloads",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject9').huntingQueryTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEUncommonApplicationBehavior_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject9').huntingQueryVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cisco_Secure_Endpoint_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cisco SE - Uncommon application behavior",
                "category": "Hunting Queries",
                "query": "CiscoSecureEndpoint\n| where TimeGenerated > ago(24h)\n| where ThreatName has 'launched a shell'\n| order by TimeGenerated desc\n| extend HostCustomEntity = DstHostname\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for uncommon application behavior events."
                  },
                  {
                    "name": "tactics",
                    "value": "Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1204.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9),'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Hunting Query 9",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9)]",
                "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject9').huntingQueryVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
        "contentKind": "HuntingQuery",
        "displayName": "Cisco SE - Uncommon application behavior",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject10').huntingQueryTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEVulnerableApplications_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject10').huntingQueryVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cisco_Secure_Endpoint_Hunting_Query_10",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cisco SE - Vulnerable applications",
                "category": "Hunting Queries",
                "query": "CiscoSecureEndpoint\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'Vulnerable Application Detected'\n| summarize by DstHostname\n| extend HostCustomEntity = DstHostname\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for vulnerable applications on hosts."
                  },
                  {
                    "name": "tactics",
                    "value": "Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1204.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject10')._huntingQuerycontentId10),'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Hunting Query 10",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject10')._huntingQuerycontentId10)]",
                "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject10').huntingQueryVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
        "contentKind": "HuntingQuery",
        "displayName": "Cisco SE - Vulnerable applications",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject10')._huntingQuerycontentId10,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject10')._huntingQuerycontentId10,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "Cisco Secure Endpoint (via Codeless Connector Framework)",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "CiscoSecureEndpointLogsCCPDefinition",
                  "title": "Cisco Secure Endpoint (via Codeless Connector Framework)",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": "The Cisco Secure Endpoint (formerly AMP for Endpoints) data connector provides the capability to ingest Cisco Secure Endpoint [audit logs](https://developer.cisco.com/docs/secure-endpoint/auditlog/) and [events](https://developer.cisco.com/docs/secure-endpoint/v1-api-reference-event/) into Microsoft Sentinel.",
                  "graphQueries": [
                    {
                      "metricName": "Total audit logs received",
                      "legend": "Cisco Secure Endpoint Audit logs",
                      "baseQuery": "CiscoSecureEndpointAuditLogsV2_CL"
                    },
                    {
                      "metricName": "Total events received",
                      "legend": "Cisco Secure Endpoint Events",
                      "baseQuery": "CiscoSecureEndpointEventsV2_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Get a Sample of Cisco Secure Endpoint Audit Logs",
                      "query": "CiscoSecureEndpointAuditLogsV2_CL\n | take 10"
                    },
                    {
                      "description": "Get a Sample of Cisco Secure Endpoint Events",
                      "query": "CiscoSecureEndpointEventsV2_CL\n | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "CiscoSecureEndpointAuditLogsV2_CL",
                      "lastDataReceivedQuery": "CiscoSecureEndpointAuditLogsV2_CL\n | summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
                    },
                    {
                      "name": "CiscoSecureEndpointEventsV2_CL",
                      "lastDataReceivedQuery": "CiscoSecureEndpointEventsV2_CL\n | summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Cisco Secure Endpoint API Credentials/Regions",
                        "description": "To create API Credentials and to understand the regions, follow the document link provided here. [Click here](https://github.com/v-gudivya/Cisco-Secure-Endpoint/blob/main/README.md)."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "To ingest data from Cisco Secure Endpoint to Microsoft Sentinel, you have to click on Add Account button below, then you get a pop up to fill the details like Email, Organization, Client ID, API Key and Region, provide the required information and click on Connect. You can see the connected organizations/emails in the below grid.\n>",
                      "instructions": [
                        {
                          "type": "DataConnectorsGrid",
                          "parameters": {
                            "mapping": [
                              {
                                "columnName": "Organization",
                                "columnValue": "properties.addOnAttributes.Organization"
                              },
                              {
                                "columnName": "Email",
                                "columnValue": "properties.addOnAttributes.Email"
                              },
                              {
                                "columnName": "Endpoint",
                                "columnValue": "properties.request.apiEndpoint"
                              }
                            ],
                            "menuItems": [
                              "DeleteConnector"
                            ]
                          }
                        },
                        {
                          "type": "ContextPane",
                          "parameters": {
                            "isPrimary": true,
                            "label": "Add Account",
                            "title": "Add Account",
                            "subtitle": "Add Account",
                            "contextPaneType": "DataConnectorsContextPane",
                            "instructionSteps": [
                              {
                                "instructions": [
                                  {
                                    "type": "Textbox",
                                    "parameters": {
                                      "label": "Cisco Secure Endpoint Email",
                                      "placeholder": "Enter your Cisco Email",
                                      "type": "text",
                                      "name": "email",
                                      "required": true
                                    }
                                  },
                                  {
                                    "type": "Textbox",
                                    "parameters": {
                                      "label": "Cisco Secure Endpoint Organization",
                                      "placeholder": "Enter the name of your Organization",
                                      "type": "text",
                                      "name": "organization",
                                      "required": true
                                    }
                                  },
                                  {
                                    "type": "Textbox",
                                    "parameters": {
                                      "label": "Cisco Secure Endpoint Client ID",
                                      "placeholder": "Enter your Client ID",
                                      "type": "text",
                                      "name": "username",
                                      "required": true
                                    }
                                  },
                                  {
                                    "type": "Textbox",
                                    "parameters": {
                                      "label": "Cisco Secure Endpoint API Key",
                                      "placeholder": "Enter your API Key",
                                      "type": "password",
                                      "name": "apiKey",
                                      "required": true
                                    }
                                  },
                                  {
                                    "type": "Textbox",
                                    "parameters": {
                                      "label": "Cisco Secure Endpoint Region",
                                      "placeholder": "Enter the region you want to connect",
                                      "type": "text",
                                      "name": "region",
                                      "required": true,
                                      "description": "For example, if your region is https://api.apjc.amp.cisco.com then enter only apjc.amp in the above field. Follow the link provided in the Cisco Secure Endpoint API Credentials/Regions section for better understanding of the regions."
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      ],
                      "title": "Connect Cisco Secure Endpoint to Microsoft Sentinel"
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "CiscoSecureEndpointDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-CiscoSecureEndpointAuditLogs": {
                    "columns": [
                      {
                        "name": "event",
                        "type": "string"
                      },
                      {
                        "name": "audit_log_type",
                        "type": "string"
                      },
                      {
                        "name": "audit_log_id",
                        "type": "string"
                      },
                      {
                        "name": "audit_log_user",
                        "type": "string"
                      },
                      {
                        "name": "created_at",
                        "type": "datetime"
                      },
                      {
                        "name": "item",
                        "type": "string"
                      },
                      {
                        "name": "message",
                        "type": "string"
                      },
                      {
                        "name": "old_attributes",
                        "type": "string"
                      },
                      {
                        "name": "new_attributes",
                        "type": "string"
                      }
                    ]
                  },
                  "Custom-CiscoSecureEndpointEvents": {
                    "columns": [
                      {
                        "name": "id",
                        "type": "real"
                      },
                      {
                        "name": "timestamp",
                        "type": "real"
                      },
                      {
                        "name": "timestamp_nanoseconds",
                        "type": "real"
                      },
                      {
                        "name": "date",
                        "type": "datetime"
                      },
                      {
                        "name": "event_type",
                        "type": "string"
                      },
                      {
                        "name": "event_type_id",
                        "type": "real"
                      },
                      {
                        "name": "detection",
                        "type": "string"
                      },
                      {
                        "name": "detection_id",
                        "type": "string"
                      },
                      {
                        "name": "connector_guid",
                        "type": "string"
                      },
                      {
                        "name": "group_guids",
                        "type": "string"
                      },
                      {
                        "name": "severity",
                        "type": "string"
                      },
                      {
                        "name": "tactics",
                        "type": "string"
                      },
                      {
                        "name": "techniques",
                        "type": "string"
                      },
                      {
                        "name": "hostname",
                        "type": "string"
                      },
                      {
                        "name": "vulnerabilities",
                        "type": "string"
                      },
                      {
                        "name": "start_timestamp",
                        "type": "real"
                      },
                      {
                        "name": "start_date",
                        "type": "datetime"
                      },
                      {
                        "name": "error",
                        "type": "dynamic"
                      },
                      {
                        "name": "computer",
                        "type": "dynamic"
                      },
                      {
                        "name": "file",
                        "type": "dynamic"
                      },
                      {
                        "name": "scan",
                        "type": "dynamic"
                      },
                      {
                        "name": "bp_data",
                        "type": "dynamic"
                      },
                      {
                        "name": "policy",
                        "type": "dynamic"
                      },
                      {
                        "name": "product_update",
                        "type": "dynamic"
                      },
                      {
                        "name": "isolation",
                        "type": "dynamic"
                      },
                      {
                        "name": "forensic_snapshot",
                        "type": "dynamic"
                      },
                      {
                        "name": "device_control",
                        "type": "dynamic"
                      },
                      {
                        "name": "endpoint_ioc_scan",
                        "type": "dynamic"
                      },
                      {
                        "name": "orbital",
                        "type": "dynamic"
                      },
                      {
                        "name": "command_line",
                        "type": "dynamic"
                      },
                      {
                        "name": "cloud_ioc",
                        "type": "dynamic"
                      },
                      {
                        "name": "threat_hunting",
                        "type": "dynamic"
                      },
                      {
                        "name": "network_info",
                        "type": "dynamic"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-CiscoSecureEndpointAuditLogs"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend TimeGenerated = created_at | project-rename Event = event, AuditLogType = audit_log_type, AuditLogId = audit_log_id, AuditLogUser = audit_log_user, CreatedAt = created_at, Item = item, Message = message, OldAttributes = old_attributes, NewAttributes = new_attributes",
                    "outputStream": "Custom-CiscoSecureEndpointAuditLogsV2_CL"
                  },
                  {
                    "streams": [
                      "Custom-CiscoSecureEndpointEvents"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend Error = parse_json(error) | extend Computer = parse_json(computer) | extend File = parse_json(file) | extend Scan = parse_json(scan) | extend BpData = parse_json(bp_data) | extend Policy = parse_json(policy) | extend ProductUpdate = parse_json(product_update) | extend Isolation = parse_json(isolation) | extend ForensicSnapshot = parse_json(forensic_snapshot) | extend DeviceControl = parse_json(device_control) | extend EndpointIocScan = parse_json(endpoint_ioc_scan) | extend Orbital = parse_json(orbital) | extend CommandLine = parse_json(command_line) | extend CloudIoc = parse_json(cloud_ioc) | extend ThreatHunting = parse_json(threat_hunting) | extend NetworkInfo = parse_json(network_info) | extend Id = id, Timestamp = timestamp, TimestampNanoseconds = timestamp_nanoseconds, TimeGenerated = ['date'], Date = ['date'], EventType = event_type, EventTypeId = event_type_id, Detection = detection, DetectionId = detection_id, ConnectorGuid = connector_guid, GroupGuids = group_guids, Severity = severity, Tactics = tactics, Techniques = techniques, Hostname = hostname, Vulnerabilities = vulnerabilities, StartTimestamp = start_timestamp, StartDate = start_date, ErrorErrorCode = todouble(Error['error_code']), ErrorDescription = tostring(Error['description']), ComputerConnectorGuid = tostring(Computer['connector_guid']), ComputerHostname = tostring(Computer['hostname']), ComputerExternalIp = tostring(Computer['external_ip']), ComputerUser = tostring(Computer['user']), ComputerActive = tobool(Computer['active']), ComputerNetworkAddresses = tostring(Computer['network_addresses']), ComputerLinksComputer = tostring(Computer['links']['computer']), ComputerLinksTrajectory = tostring(Computer['links']['trajectory']), ComputerLinksGroup = tostring(Computer['links']['group']), FileDisposition = tostring(File['disposition']), FileFileName = tostring(File['file_name']), FileFilePath = tostring(File['file_path']), FileIdentitySha256 = tostring(File['identity']['sha256']), FileIdentitySha1 = tostring(File['identity']['sha1']), FileIdentityMd5 = tostring(File['identity']['md5']), FileParentProcessId = todouble(File['parent']['process_id']), FileParentDisposition = tostring(File['parent']['disposition']), FileParentFileName = tostring(File['parent']['file_name']), FileParentIdentitySha256 = tostring(File['parent']['identity']['sha256']), FileParentIdentitySha1 = tostring(File['parent']['identity']['sha1']), FileParentIdentityMd5 = tostring(File['parent']['identity']['md5']), FileAttackDetailsApplication = tostring(File['attack_details']['application']), FileAttackDetailsAttackedModule = tostring(File['attack_details']['attacked_module']), FileAttackDetailsBaseAddress = tostring(File['attack_details']['base_address']), FileAttackDetailsSuspiciousFiles = tostring(File['attack_details']['suspicious_files']), FileAttackDetailsIndicators = tostring(File['attack_details']['indicators']), FileArchivedFileDisposition = tostring(File['archived_file']['disposition']), FileArchivedFileIdentitySha256 = tostring(File['archived_file']['identity']['sha256']), ScanDescription = tostring(Scan['description']), ScanClean = tobool(Scan['clean']), ScanScannedFiles = todouble(Scan['scanned_files']), ScanScannedProcesses = todouble(Scan['scanned_processes']), ScanScannedPaths = todouble(Scan['scanned_paths']), ScanMaliciousDetections = todouble(Scan['malicious_detections']), BpDataPackageManagerPendingVersion = todouble(BpData['package_manager_pending_version']), BpDataPackageManagerSerialNumber = todouble(BpData['package_manager_serial_number']), BpDataSts = todouble(BpData['sts']), BpDataPackageName = tostring(BpData['package_name']), BpDataPackageManagerCurrentVersion = todouble(BpData['package_manager_current_version']), BpDataNormalizedSeverityId = todouble(BpData['normalized']['severity_id']), BpDataAudit = tobool(BpData['audit']), BpDataDetection = tostring(BpData['detection']), BpDataEndTs = todouble(BpData['end_ts']), BpDataEngine = tostring(BpData['engine']), BpDataId = tostring(BpData['id']), BpDataName = tostring(BpData['name']), BpDataRemediated = tobool(BpData['remediated']), BpDataSeverity = tostring(BpData['severity']), BpDataSilent = tobool(BpData['silent']), BpDataStartTs = todouble(BpData['start_ts']), BpDataTactics = tostring(BpData['tactics']), BpDataTechniques = tostring(BpData['techniques']), BpDataType = tostring(BpData['type']), BpDataObservablesFile = tostring(BpData['observables']['file']), BpDataDetailsActions = tostring(BpData['details']['actions']), BpDataDetailsEngEpoch = todouble(BpData['details']['eng_epoch']), BpDataDetailsEngVer = tostring(BpData['details']['eng_ver']), BpDataDetailsSchema = tostring(BpData['details']['schema']), BpDataDetailsSchemaEpoch = todouble(BpData['details']['schema_epoch']), BpDataDetailsSigId = todouble(BpData['details']['sig_id']), BpDataDetailsSigRev = todouble(BpData['details']['sig_rev']), BpDataDetailsSigSetVersion = todouble(BpData['details']['sig_set_version']), BpDataDetailsMatchedActivityEvents = tostring(BpData['details']['matched_activity']['events']), BpDataDetailsMatchedActivityLimited = tobool(BpData['details']['matched_activity']['limited']), BpDataDetailsMatchedActivityMatched = todouble(BpData['details']['matched_activity']['matched']), BpDataDeviceAgentList = tostring(BpData['device']['agent_list']), BpDataDeviceHostname = tostring(BpData['device']['hostname']), BpDataDeviceNetworkInterfaces = tostring(BpData['device']['network_interfaces']), BpDataDeviceOsMachineUuid = tostring(BpData['device']['os_machine_uuid']), BpDataDeviceTypeId = todouble(BpData['device']['type_id']), BpDataDeviceHwInfoBiosManufacturer = tostring(BpData['device']['hw_info']['bios_manufacturer']), BpDataDeviceHwInfoBiosVer = tostring(BpData['device']['hw_info']['bios_ver']), BpDataDeviceHwInfoCpuBits = todouble(BpData['device']['hw_info']['cpu_bits']), BpDataDeviceHwInfoCpuType = tostring(BpData['device']['hw_info']['cpu_type']), BpDataDeviceHwInfoSerialNumber = tostring(BpData['device']['hw_info']['serial_number']), BpDataDeviceHwInfoUuid = tostring(BpData['device']['hw_info']['uuid']), BpDataDeviceHwInfoVendorName = tostring(BpData['device']['hw_info']['vendor_name']), BpDataDeviceOsBuild = tostring(BpData['device']['os']['build']), BpDataDeviceOsEdition = tostring(BpData['device']['os']['edition']), BpDataDeviceOsName = tostring(BpData['device']['os']['name']), BpDataDeviceOsTypeId = todouble(BpData['device']['os']['type_id']), BpDataDeviceOsVersion = tostring(BpData['device']['os']['version']), BpDataNormalizedName = tostring(BpData['normalized']['name']), BpDataNormalizedObservablesAll = tostring(BpData['normalized']['observables']['all']), BpDataNormalizedObservablesFileName = tostring(BpData['normalized']['observables']['file']['name']), BpDataNormalizedObservablesFilePath = tostring(BpData['normalized']['observables']['file']['path']), BpDataErrorCode = todouble(BpData['error_code']), BpDataDemo = tobool(BpData['demo']), BpDataPackageUri = tostring(BpData['package_uri']), BpDataErrorSource = tostring(BpData['source']), BpDataEcx = tostring(BpData['ecx']), PolicySerialNumber = todouble(Policy['serial_number']), ProductUpdateCurrentVersion = tostring(ProductUpdate['current_version']), ProductUpdateUpdateVersion = tostring(ProductUpdate['update_version']), IsolationDuration = todouble(Isolation['duration']), IsolationUser = tostring(Isolation['user']), ForensicSnapshotUrl = tostring(ForensicSnapshot['url']), DeviceControlDataPackageManagerSerialNumber = tostring(DeviceControl['data']['package_manager_serial_number']), DeviceControlDataPackageName = tostring(DeviceControl['data']['package_name']), DeviceControlDataSts = todouble(DeviceControl['data']['sts']), DeviceControlDataNormalizedSeverityId = todouble(DeviceControl['data']['normalized']['severity_id']), DeviceControlDataDemo = tobool(DeviceControl['data']['demo']), DeviceControlDataType = tostring(DeviceControl['data']['type']), DeviceControlDataEngine = tostring(DeviceControl['data']['engine']), DeviceControlDataAudit = tobool(DeviceControl['data']['audit']), DeviceControlDataDetection = tostring(DeviceControl['data']['detection']), DeviceControlDataId = tostring(DeviceControl['data']['id']), DeviceControlDataSilent = tobool(DeviceControl['data']['silent']), DeviceControlDataDetailsEngVersion = tostring(DeviceControl['data']['details']['eng_version']), DeviceControlDataDetailsRulesetVersion = tostring(DeviceControl['data']['details']['ruleset_version']), DeviceControlDataDetailsPhase = tostring(DeviceControl['data']['details']['phase']), DeviceControlDataDetailsRulesetId = tostring(DeviceControl['data']['details']['ruleset_id']), DeviceControlDataDetailsAccess = tostring(DeviceControl['data']['details']['access']), DeviceControlDataDetailsRulesetRev = todouble(DeviceControl['data']['details']['ruleset_rev']), DeviceControlDataDetailsDeviceDataHardwareId = tostring(DeviceControl['data']['details']['device_data']['hardware_id']), DeviceControlDataDetailsDeviceDataVendorId = tostring(DeviceControl['data']['details']['device_data']['vendor_id']), DeviceControlDataDetailsDeviceDataInstanceId = tostring(DeviceControl['data']['details']['device_data']['instance_id']), DeviceControlDataDetailsDeviceDataDeviceSubClass = todouble(DeviceControl['data']['details']['device_data']['device_subClass']), DeviceControlDataDetailsDeviceDataSetupClassId = tostring(DeviceControl['data']['details']['device_data']['setup_class_id']), DeviceControlDataDetailsDeviceDataProductName = tostring(DeviceControl['data']['details']['device_data']['product_name']), DeviceControlDataDetailsDeviceDataDeviceClass = todouble(DeviceControl['data']['details']['device_data']['device_class']), DeviceControlDataDetailsDeviceDataSetupClassName = tostring(DeviceControl['data']['details']['device_data']['setup_class_name']), DeviceControlDataDetailsDeviceDataDeviceProtocol = todouble(DeviceControl['data']['details']['device_data']['device_protocol']), DeviceControlDataDetailsDeviceDataUsbSpec = tostring(DeviceControl['data']['details']['device_data']['usb_spec']), DeviceControlDataDetailsDeviceDataSerialNumberId = tostring(DeviceControl['data']['details']['device_data']['serial_number_id']), DeviceControlDataDetailsDeviceDataProductId = tostring(DeviceControl['data']['details']['device_data']['product_id']), DeviceControlDataDetailsDeviceDataVendorName = tostring(DeviceControl['data']['details']['device_data']['vendor_name']), DeviceControlDataDetailsMatchedRulePriority = todouble(DeviceControl['data']['details']['matched_rule']['priority']), DeviceControlDataDetailsMatchedRuleId = tostring(DeviceControl['data']['details']['matched_rule']['rule_id']), DeviceControlDataDetailsMatchedRuleDisplayName = tostring(DeviceControl['data']['details']['matched_rule']['display_name']), DeviceControlInstanceId = tostring(DeviceControl['instance_id']), DeviceControlDeviceId = tostring(DeviceControl['device_id']), DeviceControlVendorName = tostring(DeviceControl['vendor_name']), DeviceControlVendorId = tostring(DeviceControl['vendor_id']), DeviceControlProductName = tostring(DeviceControl['product_name']), DeviceControlProductId = tostring(DeviceControl['product_id']), DeviceControlSerialNumberId = tostring(DeviceControl['serial_number_id']), DeviceControlAccess = tostring(DeviceControl['access']), DeviceControlRuleId = tostring(DeviceControl['rule_id']), DeviceControlConfigurationId = tostring(DeviceControl['configuration_id']), DeviceControlConfigurationRevision = todouble(DeviceControl['configuration_revision']), EndpointIocScanClean = tobool(EndpointIocScan['clean']), EndpointIocScanDescription = tostring(EndpointIocScan['description']), EndpointIocScanScannedObjects = todouble(EndpointIocScan['scanned_objects']), EndpointIocScanMatchedObjects = todouble(EndpointIocScan['matched_objects']), EndpointIocScanMaliciousDetections = todouble(EndpointIocScan['malicious_detections']), OrbitalVersion = tostring(Orbital['version']), OrbitalOldVersion = tostring(Orbital['old_version']), CommandLineArguments = tostring(CommandLine['arguments']), CloudIocDescription = tostring(CloudIoc['description']), CloudIocShortDescription = tostring(CloudIoc['short_description']), ThreatHuntingIncidentReportGuid = tostring(ThreatHunting['report_guid']), ThreatHuntingIncidentHuntGuid = tostring(ThreatHunting['hunt_guid']), ThreatHuntingIncidentTitle = tostring(ThreatHunting['title']), ThreatHuntingIncidentSummary = tostring(ThreatHunting['summary']), ThreatHuntingIncidentRemediation = tostring(ThreatHunting['remediation']), ThreatHuntingIncidentStartTime = todouble(ThreatHunting['start_time']), ThreatHuntingIncidentEndTime = todouble(ThreatHunting['end_time']), ThreatHuntingTactics = tostring(ThreatHunting['tactics']), ThreatHuntingTechniques = tostring(ThreatHunting['techniques']), ThreatHuntingSeverity = tostring(ThreatHunting['severity']), NetworkInfoDirtyUrl = tostring(NetworkInfo['dirty_url']), NetworkInfoRemoteIp = tostring(NetworkInfo['remote_ip']), NetworkInfoRemotePort = todouble(NetworkInfo['remote_port']), NetworkInfoLocalIp = tostring(NetworkInfo['local_ip']), NetworkInfoLocalPort = todouble(NetworkInfo['local_port']), NetworkInfoNfmDirection = tostring(NetworkInfo['nfm']['direction']), NetworkInfoNfmProtocol = tostring(NetworkInfo['nfm']['protocol']), NetworkInfoParentProcessId = todouble(NetworkInfo['parent']['process_id']), NetworkInfoParentDisposition = tostring(NetworkInfo['parent']['disposition']), NetworkInfoParentFileName = tostring(NetworkInfo['parent']['file_name']), NetworkInfoParentIdentitySha256 = tostring(NetworkInfo['parent']['identity']['sha256']), NetworkInfoParentIdentitySha1 = tostring(NetworkInfo['parent']['identity']['sha1']), NetworkInfoParentIdentityMd5 = tostring(NetworkInfo['parent']['identity']['md5']) | project-away error, computer, file, scan, bp_data, policy, product_update, isolation, forensic_snapshot, device_control, endpoint_ioc_scan, orbital, command_line, cloud_ioc, threat_hunting, network_info",
                    "outputStream": "Custom-CiscoSecureEndpointEventsV2_CL"
                  }
                ]
              }
            },
            {
              "name": "CiscoSecureEndpointAuditLogsV2_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "CiscoSecureEndpointAuditLogsV2_CL",
                  "columns": [
                    {
                      "name": "Event",
                      "type": "string"
                    },
                    {
                      "name": "AuditLogType",
                      "type": "string"
                    },
                    {
                      "name": "AuditLogId",
                      "type": "string"
                    },
                    {
                      "name": "AuditLogUser",
                      "type": "string"
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "CreatedAt",
                      "type": "datetime"
                    },
                    {
                      "name": "Item",
                      "type": "string"
                    },
                    {
                      "name": "Message",
                      "type": "string"
                    },
                    {
                      "name": "OldAttributes",
                      "type": "string"
                    },
                    {
                      "name": "NewAttributes",
                      "type": "string"
                    }
                  ]
                }
              }
            },
            {
              "name": "CiscoSecureEndpointEventsV2_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "CiscoSecureEndpointEventsV2_CL",
                  "columns": [
                    {
                      "name": "Id",
                      "type": "real"
                    },
                    {
                      "name": "Timestamp",
                      "type": "real"
                    },
                    {
                      "name": "TimestampNanoseconds",
                      "type": "real"
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "Date",
                      "type": "datetime"
                    },
                    {
                      "name": "EventType",
                      "type": "string"
                    },
                    {
                      "name": "EventTypeId",
                      "type": "real"
                    },
                    {
                      "name": "Detection",
                      "type": "string"
                    },
                    {
                      "name": "DetectionId",
                      "type": "string"
                    },
                    {
                      "name": "ConnectorGuid",
                      "type": "string"
                    },
                    {
                      "name": "GroupGuids",
                      "type": "string"
                    },
                    {
                      "name": "Severity",
                      "type": "string"
                    },
                    {
                      "name": "Tactics",
                      "type": "string"
                    },
                    {
                      "name": "Techniques",
                      "type": "string"
                    },
                    {
                      "name": "Hostname",
                      "type": "string"
                    },
                    {
                      "name": "Vulnerabilities",
                      "type": "string"
                    },
                    {
                      "name": "StartTimestamp",
                      "type": "real"
                    },
                    {
                      "name": "StartDate",
                      "type": "datetime"
                    },
                    {
                      "name": "ErrorErrorCode",
                      "type": "real"
                    },
                    {
                      "name": "ErrorDescription",
                      "type": "string"
                    },
                    {
                      "name": "ComputerConnectorGuid",
                      "type": "string"
                    },
                    {
                      "name": "ComputerHostname",
                      "type": "string"
                    },
                    {
                      "name": "ComputerExternalIp",
                      "type": "string"
                    },
                    {
                      "name": "ComputerUser",
                      "type": "string"
                    },
                    {
                      "name": "ComputerActive",
                      "type": "boolean"
                    },
                    {
                      "name": "ComputerNetworkAddresses",
                      "type": "string"
                    },
                    {
                      "name": "ComputerLinksComputer",
                      "type": "string"
                    },
                    {
                      "name": "ComputerLinksTrajectory",
                      "type": "string"
                    },
                    {
                      "name": "ComputerLinksGroup",
                      "type": "string"
                    },
                    {
                      "name": "FileDisposition",
                      "type": "string"
                    },
                    {
                      "name": "FileFileName",
                      "type": "string"
                    },
                    {
                      "name": "FileFilePath",
                      "type": "string"
                    },
                    {
                      "name": "FileIdentitySha256",
                      "type": "string"
                    },
                    {
                      "name": "FileIdentitySha1",
                      "type": "string"
                    },
                    {
                      "name": "FileIdentityMd5",
                      "type": "string"
                    },
                    {
                      "name": "FileParentProcessId",
                      "type": "real"
                    },
                    {
                      "name": "FileParentDisposition",
                      "type": "string"
                    },
                    {
                      "name": "FileParentFileName",
                      "type": "string"
                    },
                    {
                      "name": "FileParentIdentitySha256",
                      "type": "string"
                    },
                    {
                      "name": "FileParentIdentitySha1",
                      "type": "string"
                    },
                    {
                      "name": "FileParentIdentityMd5",
                      "type": "string"
                    },
                    {
                      "name": "FileAttackDetailsApplication",
                      "type": "string"
                    },
                    {
                      "name": "FileAttackDetailsAttackedModule",
                      "type": "string"
                    },
                    {
                      "name": "FileAttackDetailsBaseAddress",
                      "type": "string"
                    },
                    {
                      "name": "FileAttackDetailsSuspiciousFiles",
                      "type": "string"
                    },
                    {
                      "name": "FileAttackDetailsIndicators",
                      "type": "string"
                    },
                    {
                      "name": "FileArchivedFileDisposition",
                      "type": "string"
                    },
                    {
                      "name": "FileArchivedFileIdentitySha256",
                      "type": "string"
                    },
                    {
                      "name": "ScanDescription",
                      "type": "string"
                    },
                    {
                      "name": "ScanClean",
                      "type": "boolean"
                    },
                    {
                      "name": "ScanScannedFiles",
                      "type": "real"
                    },
                    {
                      "name": "ScanScannedProcesses",
                      "type": "real"
                    },
                    {
                      "name": "ScanScannedPaths",
                      "type": "real"
                    },
                    {
                      "name": "ScanMaliciousDetections",
                      "type": "real"
                    },
                    {
                      "name": "BpDataPackageManagerPendingVersion",
                      "type": "real"
                    },
                    {
                      "name": "BpDataPackageManagerSerialNumber",
                      "type": "real"
                    },
                    {
                      "name": "BpDataSts",
                      "type": "real"
                    },
                    {
                      "name": "BpDataPackageName",
                      "type": "string"
                    },
                    {
                      "name": "BpDataPackageManagerCurrentVersion",
                      "type": "real"
                    },
                    {
                      "name": "BpDataNormalizedSeverityId",
                      "type": "real"
                    },
                    {
                      "name": "BpDataAudit",
                      "type": "boolean"
                    },
                    {
                      "name": "BpDataDetection",
                      "type": "string"
                    },
                    {
                      "name": "BpDataEndTs",
                      "type": "real"
                    },
                    {
                      "name": "BpDataEngine",
                      "type": "string"
                    },
                    {
                      "name": "BpDataId",
                      "type": "string"
                    },
                    {
                      "name": "BpDataName",
                      "type": "string"
                    },
                    {
                      "name": "BpDataRemediated",
                      "type": "boolean"
                    },
                    {
                      "name": "BpDataSeverity",
                      "type": "string"
                    },
                    {
                      "name": "BpDataSilent",
                      "type": "boolean"
                    },
                    {
                      "name": "BpDataStartTs",
                      "type": "real"
                    },
                    {
                      "name": "BpDataTactics",
                      "type": "string"
                    },
                    {
                      "name": "BpDataTechniques",
                      "type": "string"
                    },
                    {
                      "name": "BpDataType",
                      "type": "string"
                    },
                    {
                      "name": "BpDataObservablesFile",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDetailsActions",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDetailsEngEpoch",
                      "type": "real"
                    },
                    {
                      "name": "BpDataDetailsEngVer",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDetailsSchema",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDetailsSchemaEpoch",
                      "type": "real"
                    },
                    {
                      "name": "BpDataDetailsSigId",
                      "type": "real"
                    },
                    {
                      "name": "BpDataDetailsSigRev",
                      "type": "real"
                    },
                    {
                      "name": "BpDataDetailsSigSetVersion",
                      "type": "real"
                    },
                    {
                      "name": "BpDataDetailsMatchedActivityEvents",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDetailsMatchedActivityLimited",
                      "type": "boolean"
                    },
                    {
                      "name": "BpDataDetailsMatchedActivityMatched",
                      "type": "real"
                    },
                    {
                      "name": "BpDataDeviceAgentList",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceHostname",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceNetworkInterfaces",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceOsMachineUuid",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceTypeId",
                      "type": "real"
                    },
                    {
                      "name": "BpDataDeviceHwInfoBiosManufacturer",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceHwInfoBiosVer",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceHwInfoCpuBits",
                      "type": "real"
                    },
                    {
                      "name": "BpDataDeviceHwInfoCpuType",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceHwInfoSerialNumber",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceHwInfoUuid",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceHwInfoVendorName",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceOsBuild",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceOsEdition",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceOsName",
                      "type": "string"
                    },
                    {
                      "name": "BpDataDeviceOsTypeId",
                      "type": "real"
                    },
                    {
                      "name": "BpDataDeviceOsVersion",
                      "type": "string"
                    },
                    {
                      "name": "BpDataNormalizedName",
                      "type": "string"
                    },
                    {
                      "name": "BpDataNormalizedObservablesAll",
                      "type": "string"
                    },
                    {
                      "name": "BpDataNormalizedObservablesFileName",
                      "type": "string"
                    },
                    {
                      "name": "BpDataNormalizedObservablesFilePath",
                      "type": "string"
                    },
                    {
                      "name": "BpDataErrorCode",
                      "type": "real"
                    },
                    {
                      "name": "BpDataDemo",
                      "type": "boolean"
                    },
                    {
                      "name": "BpDataPackageUri",
                      "type": "string"
                    },
                    {
                      "name": "BpDataErrorSource",
                      "type": "string"
                    },
                    {
                      "name": "BpDataEcx",
                      "type": "string"
                    },
                    {
                      "name": "PolicySerialNumber",
                      "type": "real"
                    },
                    {
                      "name": "ProductUpdateCurrentVersion",
                      "type": "string"
                    },
                    {
                      "name": "ProductUpdateUpdateVersion",
                      "type": "string"
                    },
                    {
                      "name": "IsolationDuration",
                      "type": "real"
                    },
                    {
                      "name": "IsolationUser",
                      "type": "string"
                    },
                    {
                      "name": "ForensicSnapshotUrl",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataPackageManagerSerialNumber",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataPackageName",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataSts",
                      "type": "real"
                    },
                    {
                      "name": "DeviceControlDataNormalizedSeverityId",
                      "type": "real"
                    },
                    {
                      "name": "DeviceControlDataDemo",
                      "type": "boolean"
                    },
                    {
                      "name": "DeviceControlDataType",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataEngine",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataAudit",
                      "type": "boolean"
                    },
                    {
                      "name": "DeviceControlDataDetection",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataSilent",
                      "type": "boolean"
                    },
                    {
                      "name": "DeviceControlDataDetailsEngVersion",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsRulesetVersion",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsPhase",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsRulesetId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsAccess",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsRulesetRev",
                      "type": "real"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataHardwareId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataVendorId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataInstanceId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataDeviceSubClass",
                      "type": "real"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataSetupClassId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataProductName",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataDeviceClass",
                      "type": "real"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataSetupClassName",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataDeviceProtocol",
                      "type": "real"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataUsbSpec",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataSerialNumberId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataProductId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsDeviceDataVendorName",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsMatchedRulePriority",
                      "type": "real"
                    },
                    {
                      "name": "DeviceControlDataDetailsMatchedRuleId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDataDetailsMatchedRuleDisplayName",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlInstanceId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlDeviceId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlVendorName",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlVendorId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlProductName",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlProductId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlSerialNumberId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlAccess",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlRuleId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlConfigurationId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceControlConfigurationRevision",
                      "type": "real"
                    },
                    {
                      "name": "EndpointIocScanClean",
                      "type": "boolean"
                    },
                    {
                      "name": "EndpointIocScanDescription",
                      "type": "string"
                    },
                    {
                      "name": "EndpointIocScanScannedObjects",
                      "type": "real"
                    },
                    {
                      "name": "EndpointIocScanMatchedObjects",
                      "type": "real"
                    },
                    {
                      "name": "EndpointIocScanMaliciousDetections",
                      "type": "real"
                    },
                    {
                      "name": "OrbitalVersion",
                      "type": "string"
                    },
                    {
                      "name": "OrbitalOldVersion",
                      "type": "string"
                    },
                    {
                      "name": "CommandLineArguments",
                      "type": "string"
                    },
                    {
                      "name": "CloudIocDescription",
                      "type": "string"
                    },
                    {
                      "name": "CloudIocShortDescription",
                      "type": "string"
                    },
                    {
                      "name": "ThreatHuntingIncidentReportGuid",
                      "type": "string"
                    },
                    {
                      "name": "ThreatHuntingIncidentHuntGuid",
                      "type": "string"
                    },
                    {
                      "name": "ThreatHuntingIncidentTitle",
                      "type": "string"
                    },
                    {
                      "name": "ThreatHuntingIncidentSummary",
                      "type": "string"
                    },
                    {
                      "name": "ThreatHuntingIncidentRemediation",
                      "type": "string"
                    },
                    {
                      "name": "ThreatHuntingIncidentStartTime",
                      "type": "real"
                    },
                    {
                      "name": "ThreatHuntingIncidentEndTime",
                      "type": "real"
                    },
                    {
                      "name": "ThreatHuntingTactics",
                      "type": "string"
                    },
                    {
                      "name": "ThreatHuntingTechniques",
                      "type": "string"
                    },
                    {
                      "name": "ThreatHuntingSeverity",
                      "type": "string"
                    },
                    {
                      "name": "NetworkInfoDirtyUrl",
                      "type": "string"
                    },
                    {
                      "name": "NetworkInfoRemoteIp",
                      "type": "string"
                    },
                    {
                      "name": "NetworkInfoRemotePort",
                      "type": "real"
                    },
                    {
                      "name": "NetworkInfoLocalIp",
                      "type": "string"
                    },
                    {
                      "name": "NetworkInfoLocalPort",
                      "type": "real"
                    },
                    {
                      "name": "NetworkInfoNfmDirection",
                      "type": "string"
                    },
                    {
                      "name": "NetworkInfoNfmProtocol",
                      "type": "string"
                    },
                    {
                      "name": "NetworkInfoParentProcessId",
                      "type": "real"
                    },
                    {
                      "name": "NetworkInfoParentDisposition",
                      "type": "string"
                    },
                    {
                      "name": "NetworkInfoParentFileName",
                      "type": "string"
                    },
                    {
                      "name": "NetworkInfoParentIdentitySha256",
                      "type": "string"
                    },
                    {
                      "name": "NetworkInfoParentIdentitySha1",
                      "type": "string"
                    },
                    {
                      "name": "NetworkInfoParentIdentityMd5",
                      "type": "string"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "CiscoSecureEndpointLogsCCPDefinition",
          "title": "Cisco Secure Endpoint (via Codeless Connector Framework)",
          "publisher": "Microsoft",
          "descriptionMarkdown": "The Cisco Secure Endpoint (formerly AMP for Endpoints) data connector provides the capability to ingest Cisco Secure Endpoint [audit logs](https://developer.cisco.com/docs/secure-endpoint/auditlog/) and [events](https://developer.cisco.com/docs/secure-endpoint/v1-api-reference-event/) into Microsoft Sentinel.",
          "graphQueries": [
            {
              "metricName": "Total audit logs received",
              "legend": "Cisco Secure Endpoint Audit logs",
              "baseQuery": "CiscoSecureEndpointAuditLogsV2_CL"
            },
            {
              "metricName": "Total events received",
              "legend": "Cisco Secure Endpoint Events",
              "baseQuery": "CiscoSecureEndpointEventsV2_CL"
            }
          ],
          "sampleQueries": [
            {
              "description": "Get a Sample of Cisco Secure Endpoint Audit Logs",
              "query": "CiscoSecureEndpointAuditLogsV2_CL\n | take 10"
            },
            {
              "description": "Get a Sample of Cisco Secure Endpoint Events",
              "query": "CiscoSecureEndpointEventsV2_CL\n | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "CiscoSecureEndpointAuditLogsV2_CL",
              "lastDataReceivedQuery": "CiscoSecureEndpointAuditLogsV2_CL\n | summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
            },
            {
              "name": "CiscoSecureEndpointEventsV2_CL",
              "lastDataReceivedQuery": "CiscoSecureEndpointEventsV2_CL\n | summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "name": "Cisco Secure Endpoint API Credentials/Regions",
                "description": "To create API Credentials and to understand the regions, follow the document link provided here. [Click here](https://github.com/v-gudivya/Cisco-Secure-Endpoint/blob/main/README.md)."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "To ingest data from Cisco Secure Endpoint to Microsoft Sentinel, you have to click on Add Account button below, then you get a pop up to fill the details like Email, Organization, Client ID, API Key and Region, provide the required information and click on Connect. You can see the connected organizations/emails in the below grid.\n>",
              "instructions": [
                {
                  "type": "DataConnectorsGrid",
                  "parameters": {
                    "mapping": [
                      {
                        "columnName": "Organization",
                        "columnValue": "properties.addOnAttributes.Organization"
                      },
                      {
                        "columnName": "Email",
                        "columnValue": "properties.addOnAttributes.Email"
                      },
                      {
                        "columnName": "Endpoint",
                        "columnValue": "properties.request.apiEndpoint"
                      }
                    ],
                    "menuItems": [
                      "DeleteConnector"
                    ]
                  }
                },
                {
                  "type": "ContextPane",
                  "parameters": {
                    "isPrimary": true,
                    "label": "Add Account",
                    "title": "Add Account",
                    "subtitle": "Add Account",
                    "contextPaneType": "DataConnectorsContextPane",
                    "instructionSteps": [
                      {
                        "instructions": [
                          {
                            "type": "Textbox",
                            "parameters": {
                              "label": "Cisco Secure Endpoint Email",
                              "placeholder": "Enter your Cisco Email",
                              "type": "text",
                              "name": "email",
                              "required": true
                            }
                          },
                          {
                            "type": "Textbox",
                            "parameters": {
                              "label": "Cisco Secure Endpoint Organization",
                              "placeholder": "Enter the name of your Organization",
                              "type": "text",
                              "name": "organization",
                              "required": true
                            }
                          },
                          {
                            "type": "Textbox",
                            "parameters": {
                              "label": "Cisco Secure Endpoint Client ID",
                              "placeholder": "Enter your Client ID",
                              "type": "text",
                              "name": "username",
                              "required": true
                            }
                          },
                          {
                            "type": "Textbox",
                            "parameters": {
                              "label": "Cisco Secure Endpoint API Key",
                              "placeholder": "Enter your API Key",
                              "type": "password",
                              "name": "apiKey",
                              "required": true
                            }
                          },
                          {
                            "type": "Textbox",
                            "parameters": {
                              "label": "Cisco Secure Endpoint Region",
                              "placeholder": "Enter the region you want to connect",
                              "type": "text",
                              "name": "region",
                              "required": true,
                              "description": "For example, if your region is https://api.apjc.amp.cisco.com then enter only apjc.amp in the above field. Follow the link provided in the Cisco Secure Endpoint API Credentials/Regions section for better understanding of the regions."
                            }
                          }
                        ]
                      }
                    ]
                  }
                }
              ],
              "title": "Connect Cisco Secure Endpoint to Microsoft Sentinel"
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "Cisco Secure Endpoint (via Codeless Connector Framework)",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "connectorDefinitionName": {
              "defaultValue": "Cisco Secure Endpoint (via Codeless Connector Framework)",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "email": {
              "defaultValue": "email",
              "type": "securestring",
              "minLength": 1
            },
            "organization": {
              "defaultValue": "organization",
              "type": "securestring",
              "minLength": 1
            },
            "username": {
              "defaultValue": "username",
              "type": "securestring",
              "minLength": 1
            },
            "apiKey": {
              "defaultValue": "apiKey",
              "type": "securestring",
              "minLength": 1
            },
            "region": {
              "defaultValue": "region",
              "type": "securestring",
              "minLength": 1
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'), '/Microsoft.SecurityInsights', '/CiscoSecureEndpointCCPAuditLogsPoller', parameters('organization'), parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "CiscoSecureEndpointLogsCCPDefinition",
                "dataType": "CiscoSecureEndpointAuditLogsV2_CL",
                "addOnAttributes": {
                  "Organization": "[[parameters('organization')]",
                  "Email": "[[parameters('email')]"
                },
                "dcrConfig": {
                  "streamName": "Custom-CiscoSecureEndpointAuditLogs",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                  "type": "Basic",
                  "userName": "[[parameters('username')]",
                  "password": "[[parameters('apiKey')]"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://api.',parameters('region'),'.cisco.com/v1/audit_logs')]",
                  "httpMethod": "GET",
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "queryWindowInMin": 10,
                  "retryCount": 3,
                  "headers": {
                    "Accept": "application/json"
                  },
                  "queryParameters": {
                    "start_time": "{_QueryWindowStartTime}",
                    "end_time": "{_QueryWindowEndTime}"
                  }
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.data"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "$.metadata.links.next"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'), '/Microsoft.SecurityInsights', '/CiscoSecureEndpointCCPEventsPoller', parameters('organization'), parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "CiscoSecureEndpointLogsCCPDefinition",
                "dataType": "CiscoSecureEndpointEventsV2_CL",
                "addOnAttributes": {
                  "Organization": "[[parameters('organization')]",
                  "Email": "[[parameters('email')]"
                },
                "dcrConfig": {
                  "streamName": "Custom-CiscoSecureEndpointEvents",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                  "type": "Basic",
                  "userName": "[[parameters('username')]",
                  "password": "[[parameters('apiKey')]"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://api.',parameters('region'),'.cisco.com/v1/events')]",
                  "httpMethod": "GET",
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "queryWindowInMin": 10,
                  "retryCount": 3,
                  "headers": {
                    "Accept": "application/json"
                  },
                  "queryParameters": {
                    "start_date": "{_QueryWindowStartTime}"
                  }
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.data"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "$.metadata.links.next"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Cisco Secure Endpoint data connector with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId2')]",
                  "title": "[DEPRECATED] Cisco Secure Endpoint (AMP) (using Azure Functions)",
                  "publisher": "Cisco",
                  "descriptionMarkdown": "The Cisco Secure Endpoint (formerly AMP for Endpoints) data connector provides the capability to ingest Cisco Secure Endpoint [audit logs](https://api-docs.amp.cisco.com/api_resources/AuditLog?api_host=api.amp.cisco.com&api_version=v1) and [events](https://api-docs.amp.cisco.com/api_actions/details?api_action=GET+%2Fv1%2Fevents&api_host=api.amp.cisco.com&api_resource=Event&api_version=v1) into Microsoft Sentinel.\n\n<p><span style='color:red; font-weight:bold;'>NOTE</span>: This data connector has been deprecated, consider moving to the CCF data connector available in the solution which replaces ingestion via the <a href='https://learn.microsoft.com/en-us/azure/azure-monitor/logs/custom-logs-migrate' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>.</p>",
                  "additionalRequirementBanner": ">This data connector depends on a parser based on a Kusto Function to work as expected [**CiscoSecureEndpoint**](https://aka.ms/sentinel-ciscosecureendpoint-parser) which is deployed with the Microsoft Sentinel Solution.",
                  "graphQueries": [
                    {
                      "metricName": "Cisco Secure Endpoint logs",
                      "legend": "CiscoSecureEndpoint_CL",
                      "baseQuery": "CiscoSecureEndpoint_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All Cisco Secure Endpoint logs",
                      "query": "CiscoSecureEndpoint_CL\n| sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "CiscoSecureEndpoint_CL",
                      "lastDataReceivedQuery": "CiscoSecureEndpoint_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "CiscoSecureEndpoint_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(1d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "Cisco Secure Endpoint API credentials",
                        "description": "Cisco Secure Endpoint Client ID and API Key are required. [See the documentation to learn more about Cisco Secure Endpoint API](https://api-docs.amp.cisco.com/api_resources?api_host=api.amp.cisco.com&api_version=v1). [API domain](https://api-docs.amp.cisco.com) must be provided as well."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This connector uses Azure Functions to connect to the Cisco Secure Endpoint API to pull logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                    },
                    {
                      "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                    },
                    {
                      "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**CiscoSecureEndpoint**](https://aka.ms/sentinel-ciscosecureendpoint-parser) which is deployed with the Microsoft Sentinel Solution."
                    },
                    {
                      "description": "**STEP 1 - Obtaining Cisco Secure Endpoint API credentials**\n\n1. Follow the instructions in the [documentation](https://api-docs.amp.cisco.com/api_resources?api_host=api.amp.cisco.com&api_version=v1) to generate Client ID and API Key."
                    },
                    {
                      "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following), as well as Azure Blob Storage connection string and container name, readily available.",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Primary Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "description": "Use this method for automated deployment of the data connector using an ARM Template.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-ciscosecureendpoint-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Cisco Secure Endpoint Api Host**, **Cisco Secure Endpoint Client Id**, **Cisco Secure Endpoint Api Key**, **Microsoft Sentinel Workspace Id**, **Microsoft Sentinel Shared Key**\n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**.\n5. Click **Purchase** to deploy.",
                      "title": "Option 1 - Azure Resource Manager (ARM) Template"
                    },
                    {
                      "description": "Use the following step-by-step instructions to deploy the data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                      "title": "Option 2 - Manual Deployment of Azure Functions"
                    },
                    {
                      "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/create-first-function-vs-code-python) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-ciscosecureendpoint-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions.\n\n\te. **Select a runtime:** Choose Python 3.11.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
                    },
                    {
                      "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select **+ New application setting**.\n3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tCISCO_SE_API_API_HOST\n\t\tCISCO_SE_API_CLIENT_ID\n\t\tCISCO_SE_API_KEY\n\t\tWORKSPACE_ID\n\t\tSHARED_KEY\n\t\tlogAnalyticsUri (Optional)\n - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://WORKSPACE_ID.ods.opinsights.azure.us`. \n4. Once all application settings have been entered, click **Save**."
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
                "contentId": "[variables('_dataConnectorContentId2')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "contentKind": "DataConnector",
        "displayName": "[DEPRECATED] Cisco Secure Endpoint (AMP) (using Azure Functions)",
        "contentProductId": "[variables('_dataConnectorcontentProductId2')]",
        "id": "[variables('_dataConnectorcontentProductId2')]",
        "version": "[variables('dataConnectorVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId2')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion2')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco Secure Endpoint",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "[DEPRECATED] Cisco Secure Endpoint (AMP) (using Azure Functions)",
          "publisher": "Cisco",
          "descriptionMarkdown": "The Cisco Secure Endpoint (formerly AMP for Endpoints) data connector provides the capability to ingest Cisco Secure Endpoint [audit logs](https://api-docs.amp.cisco.com/api_resources/AuditLog?api_host=api.amp.cisco.com&api_version=v1) and [events](https://api-docs.amp.cisco.com/api_actions/details?api_action=GET+%2Fv1%2Fevents&api_host=api.amp.cisco.com&api_resource=Event&api_version=v1) into Microsoft Sentinel.\n\n<p><span style='color:red; font-weight:bold;'>NOTE</span>: This data connector has been deprecated, consider moving to the CCF data connector available in the solution which replaces ingestion via the <a href='https://learn.microsoft.com/en-us/azure/azure-monitor/logs/custom-logs-migrate' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>.</p>",
          "graphQueries": [
            {
              "metricName": "Cisco Secure Endpoint logs",
              "legend": "CiscoSecureEndpoint_CL",
              "baseQuery": "CiscoSecureEndpoint_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "CiscoSecureEndpoint_CL",
              "lastDataReceivedQuery": "CiscoSecureEndpoint_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "CiscoSecureEndpoint_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(1d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "All Cisco Secure Endpoint logs",
              "query": "CiscoSecureEndpoint_CL\n| sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "Cisco Secure Endpoint API credentials",
                "description": "Cisco Secure Endpoint Client ID and API Key are required. [See the documentation to learn more about Cisco Secure Endpoint API](https://api-docs.amp.cisco.com/api_resources?api_host=api.amp.cisco.com&api_version=v1). [API domain](https://api-docs.amp.cisco.com) must be provided as well."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This connector uses Azure Functions to connect to the Cisco Secure Endpoint API to pull logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
            },
            {
              "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
            },
            {
              "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**CiscoSecureEndpoint**](https://aka.ms/sentinel-ciscosecureendpoint-parser) which is deployed with the Microsoft Sentinel Solution."
            },
            {
              "description": "**STEP 1 - Obtaining Cisco Secure Endpoint API credentials**\n\n1. Follow the instructions in the [documentation](https://api-docs.amp.cisco.com/api_resources?api_host=api.amp.cisco.com&api_version=v1) to generate Client ID and API Key."
            },
            {
              "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following), as well as Azure Blob Storage connection string and container name, readily available.",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Primary Key"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "description": "Use this method for automated deployment of the data connector using an ARM Template.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-ciscosecureendpoint-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Cisco Secure Endpoint Api Host**, **Cisco Secure Endpoint Client Id**, **Cisco Secure Endpoint Api Key**, **Microsoft Sentinel Workspace Id**, **Microsoft Sentinel Shared Key**\n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**.\n5. Click **Purchase** to deploy.",
              "title": "Option 1 - Azure Resource Manager (ARM) Template"
            },
            {
              "description": "Use the following step-by-step instructions to deploy the data connector manually with Azure Functions (Deployment via Visual Studio Code).",
              "title": "Option 2 - Manual Deployment of Azure Functions"
            },
            {
              "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/create-first-function-vs-code-python) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-ciscosecureendpoint-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions.\n\n\te. **Select a runtime:** Choose Python 3.11.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
            },
            {
              "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select **+ New application setting**.\n3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tCISCO_SE_API_API_HOST\n\t\tCISCO_SE_API_CLIENT_ID\n\t\tCISCO_SE_API_KEY\n\t\tWORKSPACE_ID\n\t\tSHARED_KEY\n\t\tlogAnalyticsUri (Optional)\n - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://WORKSPACE_ID.ods.opinsights.azure.us`. \n4. Once all application settings have been entered, click **Save**."
            }
          ],
          "id": "[variables('_uiConfigId2')]",
          "additionalRequirementBanner": ">This data connector depends on a parser based on a Kusto Function to work as expected [**CiscoSecureEndpoint**](https://aka.ms/sentinel-ciscosecureendpoint-parser) which is deployed with the Microsoft Sentinel Solution."
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoEndpointHighAlert_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Find events from Cisco Secure Endpoint that are of High severity in the last hour.",
                "displayName": "Cisco SE High Events Last Hour",
                "enabled": false,
                "query": "let endtime = 1h;\nCiscoSecureEndpoint_CL\n| where TimeGenerated >= ago(endtime)\n| where severity_s == \"High\"\n| project NetworkAddresses = parse_json(computer_network_addresses_s), computer_hostname_s, date_t, event_type_s, computer_links_trajectory_s\n| summarize CountInLastHour = count() by computer_hostname_s, date_t, event_type_s, tostring(NetworkAddresses.ip), computer_links_trajectory_s\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint_CL"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "Execution",
                  "InitialAccess"
                ],
                "subTechniques": [
                  "T1204.002"
                ],
                "techniques": [
                  "T1204",
                  "T1190"
                ],
                "entityMappings": [
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "NetworkAddresses_ip"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "computer_hostname_s"
                      }
                    ]
                  },
                  {
                    "entityType": "URL",
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "computer_links_trajectory_s"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE High Events Last Hour",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEC2Connection_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule is triggered when connection to known C2 is detected from host.",
                "displayName": "Cisco SE - Connection to known C2 server",
                "enabled": false,
                "query": "CiscoSecureEndpoint\n| where EventMessage has 'Suspected botnet connection'\n| extend HostCustomEntity = DstHostname, MalwareCustomEntity = ThreatName\n",
                "queryFrequency": "PT15M",
                "queryPeriod": "PT15M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "CommandAndControl"
                ],
                "techniques": [
                  "T1071"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "HostCustomEntity"
                      }
                    ]
                  },
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "MalwareCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE - Connection to known C2 server",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEDropperActivity_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects possible dropper activity on host.",
                "displayName": "Cisco SE - Dropper activity on host",
                "enabled": false,
                "query": "CiscoSecureEndpoint\n| where EventMessage has 'Potential Dropper Infection'\n| extend HostCustomEntity = DstHostname, MalwareCustomEntity = ThreatName\n",
                "queryFrequency": "PT15M",
                "queryPeriod": "PT15M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "Execution"
                ],
                "subTechniques": [
                  "T1204.002"
                ],
                "techniques": [
                  "T1204"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "HostCustomEntity"
                      }
                    ]
                  },
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "MalwareCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE - Dropper activity on host",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEGenIoC_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule is triggered when generic IOC is observed on host.",
                "displayName": "Cisco SE - Generic IOC",
                "enabled": false,
                "query": "CiscoSecureEndpoint\n| where EventMessage has 'Generic IOC'\n| extend HostCustomEntity = DstHostname, MalwareCustomEntity = ThreatName\n",
                "queryFrequency": "PT15M",
                "queryPeriod": "PT15M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "Execution"
                ],
                "subTechniques": [
                  "T1204.002"
                ],
                "techniques": [
                  "T1204"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "HostCustomEntity"
                      }
                    ]
                  },
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "MalwareCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE - Generic IOC",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEMalwareExecution_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects malware execution on host.",
                "displayName": "Cisco SE - Malware execusion on host",
                "enabled": false,
                "query": "CiscoSecureEndpoint\n| where EventMessage has 'Executed Malware'\n| extend HostCustomEntity = DstHostname, MalwareCustomEntity = ThreatName\n",
                "queryFrequency": "PT15M",
                "queryPeriod": "PT15M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "Execution"
                ],
                "subTechniques": [
                  "T1204.002"
                ],
                "techniques": [
                  "T1204"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "HostCustomEntity"
                      }
                    ]
                  },
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "MalwareCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE - Malware execusion on host",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEMalwareOutbreak_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects possible malware outbreak.",
                "displayName": "Cisco SE - Malware outbreak",
                "enabled": false,
                "query": "let threshold = 2;\nCiscoSecureEndpoint\n| where isnotempty(ThreatName)\n| summarize infected = makeset(DstHostname) by ThreatName, bin(TimeGenerated, 10m)\n| where array_length(infected) >= threshold\n| extend MalwareCustomEntity = ThreatName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "MalwareCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE - Malware outbreak",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject7').analyticRuleTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEMultipleMalwareOnHost_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject7').analyticRuleVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule triggers when multiple malware where detected on host.",
                "displayName": "Cisco SE - Multiple malware on host",
                "enabled": false,
                "query": "let threshold = 2;\nCiscoSecureEndpoint\n| where isnotempty(ThreatName)\n| summarize infected = makeset(ThreatName) by DstHostname, bin(TimeGenerated, 10m)\n| where array_length(infected) >= threshold\n| extend HostCustomEntity = DstHostname\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "HostCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject7').analyticRuleId7,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 7",
                "parentId": "[variables('analyticRuleObject7').analyticRuleId7]",
                "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject7').analyticRuleVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE - Multiple malware on host",
        "contentProductId": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "id": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject8').analyticRuleTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEPolicyUpdateFailure_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject8').analyticRuleVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects policy updates failures.",
                "displayName": "Cisco SE - Policy update failure",
                "enabled": false,
                "query": "CiscoSecureEndpoint\n| where EventMessage =~ 'Policy Update Failure'\n| extend HostCustomEntity = DstHostname\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "techniques": [
                  "T1562"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "HostCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject8').analyticRuleId8,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 8",
                "parentId": "[variables('analyticRuleObject8').analyticRuleId8]",
                "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject8').analyticRuleVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE - Policy update failure",
        "contentProductId": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "id": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject9').analyticRuleTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSERansomwareActivityOnHost copy_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject9').analyticRuleVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule is triggered when possible ransomware activity is detected on host.",
                "displayName": "Cisco SE - Ransomware Activity",
                "enabled": false,
                "query": "CiscoSecureEndpoint\n| where EventMessage has 'Suspected ransomware'\n| extend HostCustomEntity = DstHostname, MalwareCustomEntity = ThreatName\n",
                "queryFrequency": "PT15M",
                "queryPeriod": "PT15M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1486"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "HostCustomEntity"
                      }
                    ]
                  },
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "MalwareCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject9').analyticRuleId9,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 9",
                "parentId": "[variables('analyticRuleObject9').analyticRuleId9]",
                "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject9').analyticRuleVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE - Ransomware Activity",
        "contentProductId": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "id": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject10').analyticRuleTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEUnexpectedBinary_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject10').analyticRuleVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects binary files in uncommon locations.",
                "displayName": "Cisco SE - Unexpected binary file",
                "enabled": false,
                "query": "CiscoSecureEndpoint\n| where isnotempty(SrcFileName)\n| where SrcFilePath contains @'AppData\\Local\\Temp' or SrcFilePath contains @'OUTLOOK_TEMP'\n| extend ext = extract(@\"(.*\\/)?(.*)\", 2, tostring(SrcFilePath))\n| where ext contains 'dll' or ext contains @'ps1' or ext contains @'exe'\n| extend HostCustomEntity = DstHostname\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "HostCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject10').analyticRuleId10,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 10",
                "parentId": "[variables('analyticRuleObject10').analyticRuleId10]",
                "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject10').analyticRuleVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE - Unexpected binary file",
        "contentProductId": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "id": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject11').analyticRuleTemplateSpecName11]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoSEWebshell_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject11').analyticRuleVersion11]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects possible webshell on host.",
                "displayName": "Cisco SE - Possible webshell",
                "enabled": false,
                "query": "CiscoSecureEndpoint\n| where EventMessage has 'Possible webshell'\n| extend HostCustomEntity = DstHostname, MalwareCustomEntity = ThreatName\n",
                "queryFrequency": "PT15M",
                "queryPeriod": "PT15M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CiscoSecureEndpoint"
                    ],
                    "connectorId": "CiscoSecureEndpoint"
                  }
                ],
                "tactics": [
                  "CommandAndControl"
                ],
                "techniques": [
                  "T1102"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "HostCustomEntity"
                      }
                    ]
                  },
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "MalwareCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject11').analyticRuleId11,'/'))))]",
              "properties": {
                "description": "Cisco Secure Endpoint Analytics Rule 11",
                "parentId": "[variables('analyticRuleObject11').analyticRuleId11]",
                "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject11').analyticRuleVersion11]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Secure Endpoint",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco SE - Possible webshell",
        "contentProductId": "[variables('analyticRuleObject11')._analyticRulecontentProductId11]",
        "id": "[variables('analyticRuleObject11')._analyticRulecontentProductId11]",
        "version": "[variables('analyticRuleObject11').analyticRuleVersion11]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.1",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Cisco Secure Endpoint",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Cisco%20Secure%20Endpoint/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The Cisco Secure Endpoint (formerly AMP for Endpoints) data connector provides the capability to ingest Cisco Secure Endpoint <a href=\"https://developer.cisco.com/docs/secure-endpoint/auditlog/\">audit logs</a> and <a href=\"https://developer.cisco.com/docs/secure-endpoint/v1-api-reference-event/\">events</a> into Microsoft Sentinel.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ol type=\"a\">\n<li><p><a href=\"https://aka.ms/Log-Ingestion-API\">Log Ingestion API in Azure Monitor</a></p>\n</li>\n<li><p><a href=\"https://aka.ms/Sentinel-CCP_Platform\">Microsoft Sentinel Codeless Connector Framework</a></p>\n</li>\n</ol>\n<p><span style='color:red; font-weight:bold;'>NOTE</span>: Microsoft recommends installation of \"CiscoSecureEndpointLogsCCPDefinition\" (via Codeless Connector Framework). This connector is build on the Codeless Connector Framework (CCF), which uses the Log Ingestion API, which replaces ingestion via the <a href='https://aka.ms/Sentinel-Logs_migration' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>. CCF-based data connectors also support <a href='https://aka.ms/Sentinel-DCR_Overview' style='color:#1890F1;'>Data Collection Rules</a> (DCRs) offering transformations and enrichment.</p>\n<p><span style='color:red; font-weight:bold;'>Important</span>: While the updated connector(s) can coexist with their legacy versions, running them together will result in duplicated data ingestion. You can disable the older versions of these connectors to avoid duplication of data..</p>\n<p><strong>Data Connectors:</strong> 2, <strong>Parsers:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 11, <strong>Hunting Queries:</strong> 10</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/cisco-logo-72px.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco Secure Endpoint",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
              "version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
              "version": "[variables('huntingQueryObject2').huntingQueryVersion2]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
              "version": "[variables('huntingQueryObject3').huntingQueryVersion3]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
              "version": "[variables('huntingQueryObject4').huntingQueryVersion4]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
              "version": "[variables('huntingQueryObject5').huntingQueryVersion5]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
              "version": "[variables('huntingQueryObject6').huntingQueryVersion6]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
              "version": "[variables('huntingQueryObject7').huntingQueryVersion7]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
              "version": "[variables('huntingQueryObject8').huntingQueryVersion8]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
              "version": "[variables('huntingQueryObject9').huntingQueryVersion9]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
              "version": "[variables('huntingQueryObject10').huntingQueryVersion10]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId2')]",
              "version": "[variables('dataConnectorVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
              "version": "[variables('analyticRuleObject11').analyticRuleVersion11]"
            }
          ]
        },
        "firstPublishDate": "2021-10-28",
        "lastPublishDate": "2022-02-02",
        "providers": [
          "Cisco"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection",
            "Networking"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
