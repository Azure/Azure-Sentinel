{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Aws.svg\" width=\"75px\" height=\"75px\">\n\n**Note:** Please refer to the following before installing the solution: \n\n• Review the solution [Release Notes](https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Amazon%20Web%20Services/ReleaseNotes.md)\n\n • There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing.\n\nThe Amazon Web Services solution for Microsoft Sentinel allows you to enable Security monitoring of AWS services by allowing ingestion of logs from the AWS CloudTrail platform, VPC Flow Logs, AWS GuardDuty and AWS CloudWatch. \n\n**Data Connectors:** 3, **Workbooks:** 2, **Analytic Rules:** 57, **Hunting Queries:** 36\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks",
            "Microsoft.Logic/workflows"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "dataconnectors",
        "label": "Data Connectors",
        "bladeTitle": "Data Connectors",
        "elements": [
          {
            "name": "dataconnectors1-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Solution installs the data connector for Amazon Web Services. You can get Amazon Web Services custom log data in your Microsoft Sentinel workspace. After installing the solution, configure and enable this data connector by following guidance in Manage solution view."
            }
          },
          {
            "name": "dataconnectors-link2",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more about connecting data sources",
                "uri": "https://docs.microsoft.com/azure/sentinel/connect-data-sources"
              }
            }
          }
        ]
      },
      {
        "name": "workbooks",
        "label": "Workbooks",
        "subLabel": {
          "preValidation": "Configure the workbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Workbooks",
        "elements": [
          {
            "name": "workbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs workbook(s) to help you gain insights into the telemetry collected in Microsoft Sentinel. After installing the solution, start using the workbook in Manage solution view."
            }
          },
          {
            "name": "workbooks-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-monitor-your-data"
              }
            }
          },
          {
            "name": "workbook1",
            "type": "Microsoft.Common.Section",
            "label": "AWS Network Activities",
            "elements": [
              {
                "name": "workbook1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Gain insights into AWS network related resource activities, including the creation, update, and deletions of security groups, network ACLs and routes, gateways, elastic load balancers, VPCs, subnets, and network interfaces."
                }
              }
            ]
          },
          {
            "name": "workbook2",
            "type": "Microsoft.Common.Section",
            "label": "AWS User Activities",
            "elements": [
              {
                "name": "workbook2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Gain insights into AWS user activities, including failed sign-in attempts, IP addresses, regions, user agents, and identity types, as well as potential malicious user activities with assumed roles."
                }
              }
            ]
          }
        ]
      },
      {
        "name": "analytics",
        "label": "Analytics",
        "subLabel": {
          "preValidation": "Configure the analytics",
          "postValidation": "Done"
        },
        "bladeTitle": "Analytics",
        "elements": [
          {
            "name": "analytics-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs the following analytic rule templates. After installing the solution, create and enable analytic rules in Manage solution view."
            }
          },
          {
            "name": "analytics-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "analytic1",
            "type": "Microsoft.Common.Section",
            "label": "Changes to internet facing AWS RDS Database instances",
            "elements": [
              {
                "name": "analytic1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Amazon Relational Database Service (RDS) is scalable relational database in the cloud.\nIf your organization have one or more AWS RDS Databases running, monitoring changes to especially internet facing AWS RDS (Relational Database Service)\nOnce alerts triggered, validate if changes observed are authorized and adhere to change control policy.\nMore information: https://medium.com/@GorillaStack/the-most-important-aws-cloudtrail-security-events-to-track-a5b9873f8255 \nand RDS API Reference Docs: https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_Operations.html"
                }
              }
            ]
          },
          {
            "name": "analytic2",
            "type": "Microsoft.Common.Section",
            "label": "Changes to Amazon VPC settings",
            "elements": [
              {
                "name": "analytic2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Amazon Virtual Private Cloud (Amazon VPC) lets you provision a logically isolated section of the AWS Cloud where you can launch AWS resources in a virtual network that you define.\nThis identifies changes to Amazon VPC (Virtual Private Cloud) settings such as new ACL entries,routes, routetable or Gateways.\nMore information: https://medium.com/@GorillaStack/the-most-important-aws-cloudtrail-security-events-to-track-a5b9873f8255 \nand AWS VPC API Docs: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/OperationList-query-vpc.html"
                }
              }
            ]
          },
          {
            "name": "analytic3",
            "type": "Microsoft.Common.Section",
            "label": "Changes made to AWS CloudTrail logs",
            "elements": [
              {
                "name": "analytic3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Attackers often try to hide their steps by deleting or stopping the collection of logs that could show their activity.\nThis alert identifies any manipulation of AWS CloudTrail, Cloudwatch/EventBridge or VPC Flow logs.\nMore Information: AWS CloudTrail API: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_Operations.html \nAWS Cloudwatch/Eventbridge API: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_Operations.html \nAWS DelteteFlowLogs API : https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html "
                }
              }
            ]
          },
          {
            "name": "analytic4",
            "type": "Microsoft.Common.Section",
            "label": "AWS Config Service Resource Deletion Attempts",
            "elements": [
              {
                "name": "analytic4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects attempts to remove a part of the AWS Config Service.The Threat Actor may manipulate the Config services decrease the visibility into the security posture of an account and / or its workload instances."
                }
              }
            ]
          },
          {
            "name": "analytic5",
            "type": "Microsoft.Common.Section",
            "label": "Login to AWS Management Console without MFA",
            "elements": [
              {
                "name": "analytic5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Multi-Factor Authentication (MFA) helps you to prevent credential compromise. This alert identifies logins to the AWS Management Console without MFA.\nYou can limit this detection to trigger for adminsitrative accounts if you do not have MFA enabled on all accounts.\nThis is done by looking at the eventName ConsoleLogin and if the AdditionalEventData field indicates MFA was NOT used and the ResponseElements field indicates NOT a Failure. Thereby indicating that a non-MFA login was successful."
                }
              }
            ]
          },
          {
            "name": "analytic6",
            "type": "Microsoft.Common.Section",
            "label": "Monitor AWS Credential abuse or hijacking",
            "elements": [
              {
                "name": "analytic6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Looking for GetCallerIdentity Events where the UserID Type is AssumedRole\nAn attacker who has assumed the role of a legitimate account can call the GetCallerIdentity function to determine what account they are using.\nA legitimate user using legitimate credentials would not need to call GetCallerIdentity since they should already know what account they are using.\nMore Information: https://duo.com/decipher/trailblazer-hunts-compromised-credentials-in-aws \nAWS STS GetCallerIdentity API: https://docs.aws.amazon.com/STS/latest/APIReference/API_GetCallerIdentity.html "
                }
              }
            ]
          },
          {
            "name": "analytic7",
            "type": "Microsoft.Common.Section",
            "label": "Full Admin policy created and then attached to Roles, Users or Groups",
            "elements": [
              {
                "name": "analytic7-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identity and Access Management (IAM) securely manages access to AWS services and resources. \nIdentifies when a policy is created with Full Administrators Access (Allow-Action:*,Resource:*). \nThis policy can be attached to role,user or group and may be used by an adversary to escalate a normal user privileges to an adminsitrative level.\nAWS IAM Policy Grammar: https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_grammar.html \nand AWS IAM API at https://docs.aws.amazon.com/IAM/latest/APIReference/API_Operations.html"
                }
              }
            ]
          },
          {
            "name": "analytic8",
            "type": "Microsoft.Common.Section",
            "label": "Changes to AWS Security Group ingress and egress settings",
            "elements": [
              {
                "name": "analytic8-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "A Security Group acts as a virtual firewall of an instance to control inbound and outbound traffic.\n Hence, ingress and egress settings changes to AWS Security Group should be monitored as these can expose the enviornment to new attack vectors.\nMore information: https://medium.com/@GorillaStack/the-most-important-aws-cloudtrail-security-events-to-track-a5b9873f8255. "
                }
              }
            ]
          },
          {
            "name": "analytic9",
            "type": "Microsoft.Common.Section",
            "label": "Changes to AWS Elastic Load Balancer security groups",
            "elements": [
              {
                "name": "analytic9-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Elastic Load Balancer distributes incoming traffic across multiple instances in multiple availability Zones. This increases the fault tolerance of your applications.\n Unwanted changes to Elastic Load Balancer specific security groups could open your environment to attack and  hence needs monitoring.\n More information: https://medium.com/@GorillaStack/the-most-important-aws-cloudtrail-security-events-to-track-a5b9873f8255 \n and https://aws.amazon.com/elasticloadbalancing/. "
                }
              }
            ]
          },
          {
            "name": "analytic10",
            "type": "Microsoft.Common.Section",
            "label": "NRT Login to AWS Management Console without MFA",
            "elements": [
              {
                "name": "analytic10-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Multi-Factor Authentication (MFA) helps you to prevent credential compromise. This alert identifies logins to the AWS Management Console without MFA.\nYou can limit this detection to trigger for administrative accounts if you do not have MFA enabled on all accounts.\nThis is done by looking at the eventName ConsoleLogin and if the AdditionalEventData field indicates MFA was NOT used and the ResponseElements field indicates NOT a Failure. Thereby indicating that a non-MFA login was successful."
                }
              }
            ]
          },
          {
            "name": "analytic11",
            "type": "Microsoft.Common.Section",
            "label": "AWS Guard Duty Alert",
            "elements": [
              {
                "name": "analytic11-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Amazon GuardDuty is a threat detection service that continuously monitors your AWS accounts and workloads for malicious activity and delivers detailed security findings for visibility and remediation. This templates create an alert for each Amazon GuardDuty finding."
                }
              }
            ]
          },
          {
            "name": "analytic12",
            "type": "Microsoft.Common.Section",
            "label": "ECR image scan findings high or critical",
            "elements": [
              {
                "name": "analytic12-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "AWS ECR Image scan detected critical or high-severity vulnerabilities in your container image."
                }
              }
            ]
          },
          {
            "name": "analytic13",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious command sent to EC2",
            "elements": [
              {
                "name": "analytic13-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An attacker with the necessary permissions could be executing code remotely on a machine and saving the output to his own S3 bucket. Verify this action with the user identity."
                }
              }
            ]
          },
          {
            "name": "analytic14",
            "type": "Microsoft.Common.Section",
            "label": "Successful API executed from a Tor exit node",
            "elements": [
              {
                "name": "analytic14-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "A successful API execution was detected from an IP address categorized as a TOR exit node by Threat Intelligence."
                }
              }
            ]
          },
          {
            "name": "analytic15",
            "type": "Microsoft.Common.Section",
            "label": "GuardDuty detector disabled or suspended",
            "elements": [
              {
                "name": "analytic15-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "GuardDuty Detector was disabled or suspended, possibly by an attacker trying to avoid detection of its malicious activities. Verify with the user identity that this activity is legitimate."
                }
              }
            ]
          },
          {
            "name": "analytic16",
            "type": "Microsoft.Common.Section",
            "label": "CloudFormation policy created then used for privilege escalation",
            "elements": [
              {
                "name": "analytic16-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new Cloudformation policy and usage of one of the attach policy events (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic17",
            "type": "Microsoft.Common.Section",
            "label": "Creation of CRUD DynamoDB policy and then privilege escalation.",
            "elements": [
              {
                "name": "analytic17-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new CRUD DynamoDB policy and usage of one of the attach policy operations (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic18",
            "type": "Microsoft.Common.Section",
            "label": "Creation of new CRUD IAM policy and then privilege escalation.",
            "elements": [
              {
                "name": "analytic18-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new CRUD IAM policy and usage of one of the attach policy operations (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic19",
            "type": "Microsoft.Common.Section",
            "label": "Creation of CRUD KMS policy and then privilege escalation",
            "elements": [
              {
                "name": "analytic19-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new CRUD KMS policy and usage of one of the attach policy operations (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic20",
            "type": "Microsoft.Common.Section",
            "label": "Created CRUD S3 policy and then privilege escalation",
            "elements": [
              {
                "name": "analytic20-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new CRUD S3 policy and afterwards used one of the attach policy operations (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic21",
            "type": "Microsoft.Common.Section",
            "label": "Creation of CRUD Lambda policy and then privilege escalation",
            "elements": [
              {
                "name": "analytic21-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new CRUD Lambda policy and usage of the attach policy events (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic22",
            "type": "Microsoft.Common.Section",
            "label": "Creation of DataPipeline policy and then privilege escalation.",
            "elements": [
              {
                "name": "analytic22-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new Datapipeline policy and usage of the attach policy operations (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic23",
            "type": "Microsoft.Common.Section",
            "label": "Creation of EC2 policy and then privilege escalation",
            "elements": [
              {
                "name": "analytic23-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new EC2 policy and afterwards used one of the attach policy operations (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic24",
            "type": "Microsoft.Common.Section",
            "label": "Creation of Glue policy and then privilege escalation",
            "elements": [
              {
                "name": "analytic24-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new Glue policy and usage one of the attach policy operations (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic25",
            "type": "Microsoft.Common.Section",
            "label": "Creation of Lambda policy and then privilege escalation",
            "elements": [
              {
                "name": "analytic25-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new Lambda policy and usage of one of the attach policy operations (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic26",
            "type": "Microsoft.Common.Section",
            "label": "Creation of SSM policy and then privilege escalation",
            "elements": [
              {
                "name": "analytic26-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected creation of new SSM policy and afterwards used one of the attach policy operations (AttachUserPolicy/AttachRolePolicy/AttachGroupPolicy). This might indicate a privilege escalation technique that attackers could use."
                }
              }
            ]
          },
          {
            "name": "analytic27",
            "type": "Microsoft.Common.Section",
            "label": "Creating keys with encrypt policy without MFA",
            "elements": [
              {
                "name": "analytic27-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detection of KMS keys where action kms:Encrypt is accessible for everyone (also outside of your organization). This is an idicator that your account is compromised and the attacker uses the encryption key to compromise another company."
                }
              }
            ]
          },
          {
            "name": "analytic28",
            "type": "Microsoft.Common.Section",
            "label": "Automatic image scanning disabled for ECR",
            "elements": [
              {
                "name": "analytic28-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Image Scanning for ECR was disabled, which could lead to missing vulnerable container images in your environment. Attackers could disable the Image Scanning for defense evasion purposes."
                }
              }
            ]
          },
          {
            "name": "analytic29",
            "type": "Microsoft.Common.Section",
            "label": "Changes made to AWS CloudTrail logs",
            "elements": [
              {
                "name": "analytic29-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Attackers often try to hide their steps by deleting or stopping the collection of logs that could show their activity. \nThis alert identifies any manipulation of AWS CloudTrail, Cloudwatch/EventBridge or VPC Flow logs.\nMore Information: AWS CloudTrail API: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_Operations.html \nAWS Cloudwatch/Eventbridge API: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_Operations.html \nAWS DelteteFlowLogs API : https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html "
                }
              }
            ]
          },
          {
            "name": "analytic30",
            "type": "Microsoft.Common.Section",
            "label": "Network ACL with all the open ports to a specified CIDR",
            "elements": [
              {
                "name": "analytic30-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected network ACL with all the ports open to a specified CIDR. This could lead to potential lateral movements or initial access attacks. Make sure to mitigate this risk."
                }
              }
            ]
          },
          {
            "name": "analytic31",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious overly permissive KMS key policy created",
            "elements": [
              {
                "name": "analytic31-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An overly permissive key policy was created, resulting in KMS keys where the kms:Encrypt action is accessible to everyone (even outside of the organization). This could mean that your account is compromised and that the attacker is using the encryption key to compromise other organizations."
                }
              }
            ]
          },
          {
            "name": "analytic32",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation with AdministratorAccess managed policy",
            "elements": [
              {
                "name": "analytic32-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy on AdministratorAccess managed policy. Attackers could use these events for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic33",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation with admin managed policy",
            "elements": [
              {
                "name": "analytic33-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy on admin managed policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic34",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation with FullAccess managed policy",
            "elements": [
              {
                "name": "analytic34-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy on FullAccess managed policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic35",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via CloudFormation policy",
            "elements": [
              {
                "name": "analytic35-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy on CloudFormation policy. Attackers could use these events for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic36",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via CRUD DynamoDB policy",
            "elements": [
              {
                "name": "analytic36-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy by CRUD DynamoDB Policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic37",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via CRUD IAM policy",
            "elements": [
              {
                "name": "analytic37-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy by CRUD IAM policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic38",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via CRUD KMS policy",
            "elements": [
              {
                "name": "analytic38-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy by CRUD KMS policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic39",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via CRUD Lambda policy",
            "elements": [
              {
                "name": "analytic39-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy by CRUD Lambda policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic40",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via CRUD S3 policy",
            "elements": [
              {
                "name": "analytic40-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy by CRUD S3 Policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic41",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via DataPipeline policy",
            "elements": [
              {
                "name": "analytic41-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy on Datapipeline policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic42",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via EC2 policy",
            "elements": [
              {
                "name": "analytic42-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy on EC2 policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic43",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via Glue policy",
            "elements": [
              {
                "name": "analytic43-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy on Glue policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic44",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via Lambda policy",
            "elements": [
              {
                "name": "analytic44-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy on Lambda policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic45",
            "type": "Microsoft.Common.Section",
            "label": "Privilege escalation via SSM policy",
            "elements": [
              {
                "name": "analytic45-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected usage of AttachUserPolicy/AttachGroupPolicy/AttachRolePolicy on SSM Policy. Attackers could use these operations for privilege escalation. Verify these actions with the user."
                }
              }
            ]
          },
          {
            "name": "analytic46",
            "type": "Microsoft.Common.Section",
            "label": "RDS instance publicly exposed",
            "elements": [
              {
                "name": "analytic46-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected publicly exposed RDS instance, which could lead to a leakage of sensitive data."
                }
              }
            ]
          },
          {
            "name": "analytic47",
            "type": "Microsoft.Common.Section",
            "label": "Successful brute force attack on S3 Bucket.",
            "elements": [
              {
                "name": "analytic47-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "A successful brute force attack on an S3 bucket was detected. Verify these actions, and if needed, remediate the compromise."
                }
              }
            ]
          },
          {
            "name": "analytic48",
            "type": "Microsoft.Common.Section",
            "label": "S3 bucket access point publicly exposed",
            "elements": [
              {
                "name": "analytic48-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected S3 bucket publicly exposed via access point, which could lead to sensitive information leakage to the public. Verify the S3 object configurations."
                }
              }
            ]
          },
          {
            "name": "analytic49",
            "type": "Microsoft.Common.Section",
            "label": "S3 bucket exposed via ACL",
            "elements": [
              {
                "name": "analytic49-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected S3 bucket publicly exposed via ACL, which could lead for sensitive information leakage to the public. Verify the S3 object configurations."
                }
              }
            ]
          },
          {
            "name": "analytic50",
            "type": "Microsoft.Common.Section",
            "label": "S3 bucket exposed via policy",
            "elements": [
              {
                "name": "analytic50-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected S3 bucket publicly exposed via policy, this could lead for sensitive information leakage to the public. Verify the S3 object configurations."
                }
              }
            ]
          },
          {
            "name": "analytic51",
            "type": "Microsoft.Common.Section",
            "label": "S3 object publicly exposed",
            "elements": [
              {
                "name": "analytic51-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected S3 bucket that's publicly exposed, which could lead to sensitive information leakage to the public. Verify the S3 object configurations."
                }
              }
            ]
          },
          {
            "name": "analytic52",
            "type": "Microsoft.Common.Section",
            "label": "S3 bucket suspicious ransomware activity",
            "elements": [
              {
                "name": "analytic52-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Suspicious S3 bucket activity indicating ransomware was detected.\nAn attacker might download all the objects in a compromised S3 bucket, encrypt them with his own key, then upload them back to the same bucket, overwriting the existing ones."
                }
              }
            ]
          },
          {
            "name": "analytic53",
            "type": "Microsoft.Common.Section",
            "label": "SAML update identity provider",
            "elements": [
              {
                "name": "analytic53-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Attackers could update the SAML provider in order to create unauthorized but valid tokens and represent them to services that trust SAML tokens from the environment. These tokens can then be used to access resources. More about this API at https://docs.aws.amazon.com/IAM/latest/APIReference/API_UpdateSAMLProvider.html "
                }
              }
            ]
          },
          {
            "name": "analytic54",
            "type": "Microsoft.Common.Section",
            "label": "Policy version set to default",
            "elements": [
              {
                "name": "analytic54-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An attacker with SetDefaultPolicyVersion permissions could escalate privileges through existing policy versions that are not currently in use. More about this API at https://docs.aws.amazon.com/IAM/latest/APIReference/API_SetDefaultPolicyVersion.html "
                }
              }
            ]
          },
          {
            "name": "analytic55",
            "type": "Microsoft.Common.Section",
            "label": "SSM document is publicly exposed",
            "elements": [
              {
                "name": "analytic55-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected a SSM document that is publicly exposed, which could lead to sensitive information leakage to the public. Verify the object configurations."
                }
              }
            ]
          },
          {
            "name": "analytic56",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious AWS CLI Command Execution",
            "elements": [
              {
                "name": "analytic56-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This detection focuses on identifying potentially suspicious activities involving the execution of AWS Command Line Interface (CLI) commands, particularly focusing on reconnaissance operations."
                }
              }
            ]
          },
          {
            "name": "analytic57",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious AWS EC2 Compute Resource Deployments",
            "elements": [
              {
                "name": "analytic57-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This detection focused on Suspicious deployment of AWS EC2 resource (virtual machine) scale sets was detected. This behavior might indicate that the threat actor is deploying computing resources for cryptocurrency mining activities.This detection centers around identifying suspicious instances of AWS EC2 resource deployment, particularly scale sets. Such behavior raises concerns of potential threat actor involvement, potentially indicative of efforts to deploy computing resources for the purpose of cryptocurrency mining activities"
                }
              }
            ]
          }
        ]
      },
      {
        "name": "huntingqueries",
        "label": "Hunting Queries",
        "bladeTitle": "Hunting Queries",
        "elements": [
          {
            "name": "huntingqueries-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs the following hunting queries. After installing the solution, run these hunting queries to hunt for threats in Manage solution view. "
            }
          },
          {
            "name": "huntingqueries-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/hunting"
              }
            }
          },
          {
            "name": "huntingquery1",
            "type": "Microsoft.Common.Section",
            "label": "Changes made to AWS IAM policy",
            "elements": [
              {
                "name": "huntingquery1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query looks for when an API call is made to change an IAM, particularly those related to new policies being \nattached to users and roles, as well as changes to access methods and changes to account level policies. This hunting query depends on AWS AWSS3 data connector (AWSCloudTrail AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery2",
            "type": "Microsoft.Common.Section",
            "label": "IAM Privilege Escalation by Instance Profile attachment",
            "elements": [
              {
                "name": "huntingquery2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An instance profile is a container for an IAM role that you can use to pass role information to an EC2 instance when the instance start.\nIdentifies when existing role is removed and new/existing high privileged role is added to instance profile. \nAny instance with this instance profile attached is able to perform privileged operations.\nAWS Instance Profile: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html \nand CloudGoat - IAM PrivilegeEscalation by Attachment: https://github.com/RhinoSecurityLabs/cloudgoat/tree/master/scenarios/iam_privesc_by_attachment  This hunting query depends on AWS AWSS3 data connector (AWSCloudTrail AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery3",
            "type": "Microsoft.Common.Section",
            "label": "Privileged role attached to Instance",
            "elements": [
              {
                "name": "huntingquery3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identity and Access Management (IAM) securely manages access to AWS services and resources. \nIdentifies when a Privileged role is attached to an existing instance or new instance at deployment. This instance may be used by an adversary to escalate a normal user privileges to an adminsitrative level.\nand AWS API AddRoleToInstanceProfile at https://docs.aws.amazon.com/IAM/latest/APIReference/API_AddRoleToInstanceProfile.html  This hunting query depends on AWS AWSS3 data connector (AWSCloudTrail AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery4",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious credential token access of valid IAM Roles",
            "elements": [
              {
                "name": "huntingquery4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Adversaries may generate temporary credentials of existing privileged IAM roles to access AWS resources that were not previously accessible to perform malicious actions. The credentials may be generated by trusted IAM user or via AWS Cloud Instance Metadata API.\nThis query will look for AWS STS API Assume Role operations for RoleArn (Role Amazon Resource Names) which was not historically seen.\nYou can also limit the query to only sensitive IAM Roles which needs to be monitored.\nRead more about ingest custom logs using Logstash at https://github.com/Azure/Azure-Sentinel/wiki/Ingest-Custom-Logs-LogStash \nAWS API AssumeRole at https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html and AWS Instance Metadata API at https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html  This hunting query depends on AWS AWSS3 data connector (AWSCloudTrail AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery5",
            "type": "Microsoft.Common.Section",
            "label": "Unused or Unsupported Cloud Regions",
            "elements": [
              {
                "name": "huntingquery5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Adversaries may create cloud instances in unused geographic service regions in order to evade detection.\nAccess is usually obtained through compromising accounts used to manage cloud infrastructure.\nRefer: https://attack.mitre.org/techniques/T1535/ This hunting query depends on AWS AWSS3 data connector (AWSCloudTrail AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery6",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious EC2 launched without a key pair",
            "elements": [
              {
                "name": "huntingquery6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An attacker with limited permissions, or a sophisticated attacker disguising his activity, may have launched an EC2 instance without a key pair, allowing him to execute code on the machine using the UserData attribute (for example, by executing a reverse shell). This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery7",
            "type": "Microsoft.Common.Section",
            "label": "IAM assume role policy brute force",
            "elements": [
              {
                "name": "huntingquery7-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Several failed \"assume role\" attempts occurred on existing roles in the account. This could be an attacker trying to escalate privileges and move laterally by assuming roles in a compromised account. Verify with the user identity that the activity is legitimate. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery8",
            "type": "Microsoft.Common.Section",
            "label": "Bucket versioning suspended",
            "elements": [
              {
                "name": "huntingquery8-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected Bucket versioning suspended event. Attackers could use this technique to be able to ransom buckets without the option for the victim to have a backup. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery9",
            "type": "Microsoft.Common.Section",
            "label": "New access key created to user",
            "elements": [
              {
                "name": "huntingquery9-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An attacker with the CreateAccessKey permissions on other users can create an access Key ID and secret access key belonging to another user in the AWS environment for privilege escalation. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery10",
            "type": "Microsoft.Common.Section",
            "label": "CreateLoginProfile detected",
            "elements": [
              {
                "name": "huntingquery10-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An attacker could use CreateLoginProfile permissions on other users for privilege escalation by creating a password to a victim user without a login profile to use to login to the AWS Console. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery11",
            "type": "Microsoft.Common.Section",
            "label": "ECR image scan findings low",
            "elements": [
              {
                "name": "huntingquery11-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "AWS ECR Image scan detected low severity vulnerabilities in your container image. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery12",
            "type": "Microsoft.Common.Section",
            "label": "ECR image scan findings medium",
            "elements": [
              {
                "name": "huntingquery12-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "AWS ECR image scan detected medium severity vulnerabilities in your container image. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery13",
            "type": "Microsoft.Common.Section",
            "label": "Excessive execution of discovery events",
            "elements": [
              {
                "name": "huntingquery13-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Several enumeration API calls were executed by the same identity. This could be an attacker trying to enumerate the compromised user/token permissions. Verify with the user identity that this activity is legitimate. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery14",
            "type": "Microsoft.Common.Section",
            "label": "Failed brute force on S3 bucket",
            "elements": [
              {
                "name": "huntingquery14-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected failed brute attempt on S3 bucket. If it is not an anonymous principle, verify with the user. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery15",
            "type": "Microsoft.Common.Section",
            "label": "Multiple failed login attempts to an existing user without MFA",
            "elements": [
              {
                "name": "huntingquery15-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Failed brute force attempt detected on an existing user without MFA configurations. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery16",
            "type": "Microsoft.Common.Section",
            "label": "IAM AccessDenied discovery events",
            "elements": [
              {
                "name": "huntingquery16-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "The following detection identifies excessive AccessDenied events within an hour timeframe. It is possible that an access key to AWS may have been stolen and is being misused to perform discovery events. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery17",
            "type": "Microsoft.Common.Section",
            "label": "Changes made to AWS IAM objects",
            "elements": [
              {
                "name": "huntingquery17-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identity and Access Management (IAM) securely manages access to AWS services and resources.\nThis query looks for when an API call is made to change an IAM, particularly those related to new objects being created or deleted. If these turn out to be noisy, filter out the most common for your environment. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery18",
            "type": "Microsoft.Common.Section",
            "label": "Lambda function throttled",
            "elements": [
              {
                "name": "huntingquery18-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected Lambda function throttled. Attacker could use this technique to result in Denial of Service. More about this API at https://docs.aws.amazon.com/lambda/latest/dg/API_PutFunctionConcurrency.html  This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery19",
            "type": "Microsoft.Common.Section",
            "label": "Lambda layer imported from external account",
            "elements": [
              {
                "name": "huntingquery19-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected an external account adding lambda layer, which attackers could use to inject a backdoor inside the lambda function. If this is the case, make sure to remove the layer from the function. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery20",
            "type": "Microsoft.Common.Section",
            "label": "Lambda UpdateFunctionCode",
            "elements": [
              {
                "name": "huntingquery20-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This analytic is designed to detect an IAM user updating AWS lambda code via AWS CLI to gain persistent, further access into your AWS environment and to facilitate panting backdoors. An attacker may upload malicious code/binary to a lambda function which will be executed automatically when the function is triggered. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery21",
            "type": "Microsoft.Common.Section",
            "label": "Login profile updated",
            "elements": [
              {
                "name": "huntingquery21-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An attacker could use UpdateLoginProfile permissions for privilege escalation by changing the victim user password. More about this API at https://docs.aws.amazon.com/IAM/latest/APIReference/API_UpdateLoginProfile.html  This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery22",
            "type": "Microsoft.Common.Section",
            "label": "Modification of route-table attributes",
            "elements": [
              {
                "name": "huntingquery22-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An attacker could modify route-table attributes in order to access resources he couldn't access before. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery23",
            "type": "Microsoft.Common.Section",
            "label": "Modification of subnet attributes",
            "elements": [
              {
                "name": "huntingquery23-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An attacker could modify subnet attributes in order to access resources he couldn't access before. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery24",
            "type": "Microsoft.Common.Section",
            "label": "Modification of vpc attributes",
            "elements": [
              {
                "name": "huntingquery24-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An attacker could modify vpc attributesin order to access resources he couldn't access before. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery25",
            "type": "Microsoft.Common.Section",
            "label": "Network ACL deleted",
            "elements": [
              {
                "name": "huntingquery25-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "An attacker could delete a network ACL and gain access to an instance from anywhere. Verify this action with the entity. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery26",
            "type": "Microsoft.Common.Section",
            "label": "New AccessKey created for Root user",
            "elements": [
              {
                "name": "huntingquery26-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Attackers with the CreateAccessKey permissions for other users can create an access Key ID and secret access key belonging to another user in the AWS environment for privilege escalation. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery27",
            "type": "Microsoft.Common.Section",
            "label": "CreatePolicyVersion with excessive permissions",
            "elements": [
              {
                "name": "huntingquery27-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "A policy with excessive permissions detected. Attacker could use that policy to escalate privileges and for malicious activities. Verify the policy creation with the entity. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery28",
            "type": "Microsoft.Common.Section",
            "label": "RDS instance master password changed",
            "elements": [
              {
                "name": "huntingquery28-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected change of the RDS Master password. Verify if this was intentional, or if it was caused by a malicious actor. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery29",
            "type": "Microsoft.Common.Section",
            "label": "Risky role name created",
            "elements": [
              {
                "name": "huntingquery29-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detections of risky role names could indicate that a malicious framework was executed in your environment. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery30",
            "type": "Microsoft.Common.Section",
            "label": "S3 bucket has been deleted",
            "elements": [
              {
                "name": "huntingquery30-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected deletion of a S3 bucket. An attacker could delete S3 objects for impact and Denail of service purposes. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery31",
            "type": "Microsoft.Common.Section",
            "label": "S3 bucket encryption modified",
            "elements": [
              {
                "name": "huntingquery31-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detected modification of bucket encryption. An attacker could modify encryption of existing buckets for denial of service attacks. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery32",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious activity of STS token related to EC2",
            "elements": [
              {
                "name": "huntingquery32-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Suspicious activity of the STS token of an EC2 machine hosted by ECS (for example, by SSRF) indicates a possible token hijacking. An attacker may have stolen the token and could abuse its permissions to escalate privileges and move laterally in the cloud account. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery33",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious activity of STS token related to ECS",
            "elements": [
              {
                "name": "huntingquery33-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Suspicious activity of the STS token of an EC2 machine hosted by ECS (for example, by SSRF) indicates a possible token hijacking. An attacker may have stolen the token and could abuse its permissions to escalate privileges and move laterally in the cloud account. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery34",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious activity of STS token related to Glue",
            "elements": [
              {
                "name": "huntingquery34-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Suspicious activity of the STS token of a Glue endpoint machine hosted by ECS (for example, by SSRF) indicates a possible token hijacking. An attacker may have stolen the token and could abuse its permissions to escalate privileges and move laterally in the cloud account. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery35",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious activity of STS Token related to Kubernetes worker node",
            "elements": [
              {
                "name": "huntingquery35-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Suspicious activity of the STS token of an EC2 machine hosted by EKS (for example, by SSRF) indicates a possible token hijacking. An attacker may have stolen the token and could abuse its permissions to escalate privileges and move laterally in the cloud account. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery36",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious activity of STS token related to Lambda",
            "elements": [
              {
                "name": "huntingquery36-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Suspicious activity of the STS token of a Lambda function (for example, by SSRF) indicates a possible token hijacking. An attacker may have stolen the token and could abuse its permissions to escalate privileges and move laterally in the cloud account. This hunting query depends on AWS data connector (AWSCloudTrail Parser or Table)"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(toLower(filter.id), toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]"
    }
  }
}
