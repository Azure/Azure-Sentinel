[
    {
        "type": "Microsoft.SecurityInsights/dataConnectors",
        "apiVersion": "2021-10-01-preview",
        "name": "SOCPrimeAuditLogs",
        "location": "{{location}}",
        "kind": "RestApiPoller",
        "properties": {
            "connectorDefinitionName": "SOCPrimeAuditLogsDataConnector",
            "dataType": "SOCPrimeAuditLogs_CL",
            "auth": {
                "type": "APIKey",
                "ApiKey": "[[parameters('apitoken')]",
                "ApiKeyName": "client_secret_id"
            },
            "request": {
                "apiEndpoint": "https://api.tdm.socprime.com/v1/audit-logs",
                "headers": {
                    "Accept": "application/json",
                    "User-Agent": "SOCPrime_UA"
                },
                "httpMethod": "Get",
                "queryWindowInMin": 10,
                "retryCount": 3,
                "rateLimitQPS": 1,
                "StartTimeAttributeName": "date_from",
                "EndTimeAttributeName": "date_to"
                
            },
            "response": {
                "format": "json",
                "eventsJsonPaths": [
                    "$.events"
                ]
            },
            "dcrConfig": {
                "streamName": "Custom-SOCPrimeAuditLogsStreamAgent",
                "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
            },
            "paging": {
            "pagingType": "NextPageToken",
            "pageSizeParameterName": "size",
            "pageSize": 100,
            "nextPageTokenJsonPath" : "$.next_page_token",
            "nextPageParaName": "next_page_token"
        }
        }
    }

]
