id: 072ee087-17e1-474d-b162-bbe38bcab9f9
name: Malware Detected
description: |
  'Creates an incident when a Symantec Endpoint Proection agent detects malware and the malware was not cleaned.'
severity: Medium
requiredDataConnectors:
  - connectorId: SymantecEndpointProtection
    dataTypes: 
      - Syslog
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - Execution 
query: |

  SymantecEndpointProtection
  | where LogType == "Agent Risk Logs"
  | where CategorySet == "Malware"
  | where ActualAction !contains "Cleaned"
  | summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated) by SrcIpAddr, SrcHostName, UserName, FilePath, ActualAction, CategorySet, CategoryType 
  | extend timestamp = StartTimeUtc, IPCustomEntity = SrcIpAddr, HostCustomEntity = SrcHostName, AccountCustomEntity = UserName
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: AccountCustomEntity
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: IPCustomEntity
  - entityType: Host
    fieldMappings:
      - identifier: FullName
        columnName: HostCustomEntity
