{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for PaloAltoPrismaCloud"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Palo Alto Prisma",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "PaloAltoPrismaCloud",
    "_solutionVersion": "3.0.4",
    "solutionId": "azuresentinel.azure-sentinel-solution-paloaltoprisma",
    "_solutionId": "[variables('solutionId')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "PaloAltoPrismaCloudWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.1",
      "_analyticRulecontentId1": "777d4993-31bb-4d45-b949-84f58e09fa2f",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '777d4993-31bb-4d45-b949-84f58e09fa2f')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('777d4993-31bb-4d45-b949-84f58e09fa2f')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','777d4993-31bb-4d45-b949-84f58e09fa2f','-', '1.0.1')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.1",
      "_analyticRulecontentId2": "4264e133-eec2-438f-af85-05e869308f94",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4264e133-eec2-438f-af85-05e869308f94')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4264e133-eec2-438f-af85-05e869308f94')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','4264e133-eec2-438f-af85-05e869308f94','-', '1.0.1')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.1",
      "_analyticRulecontentId3": "df89f4bf-720e-41c5-a209-15e41e400d35",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'df89f4bf-720e-41c5-a209-15e41e400d35')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('df89f4bf-720e-41c5-a209-15e41e400d35')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','df89f4bf-720e-41c5-a209-15e41e400d35','-', '1.0.1')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.1",
      "_analyticRulecontentId4": "6098b34a-1e6b-440a-9e3b-fb4d5944ade1",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6098b34a-1e6b-440a-9e3b-fb4d5944ade1')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6098b34a-1e6b-440a-9e3b-fb4d5944ade1')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6098b34a-1e6b-440a-9e3b-fb4d5944ade1','-', '1.0.1')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.1",
      "_analyticRulecontentId5": "bd602b90-f7f9-4ae9-bf8c-3672a24deb39",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'bd602b90-f7f9-4ae9-bf8c-3672a24deb39')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('bd602b90-f7f9-4ae9-bf8c-3672a24deb39')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','bd602b90-f7f9-4ae9-bf8c-3672a24deb39','-', '1.0.1')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.1",
      "_analyticRulecontentId6": "617b02d8-0f47-4f3c-afed-1926a45e7b28",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '617b02d8-0f47-4f3c-afed-1926a45e7b28')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('617b02d8-0f47-4f3c-afed-1926a45e7b28')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','617b02d8-0f47-4f3c-afed-1926a45e7b28','-', '1.0.1')))]"
    },
    "analyticRuleObject7": {
      "analyticRuleVersion7": "1.0.2",
      "_analyticRulecontentId7": "c5bf680f-fa37-47c3-9f38-e839a9b99c05",
      "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'c5bf680f-fa37-47c3-9f38-e839a9b99c05')]",
      "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('c5bf680f-fa37-47c3-9f38-e839a9b99c05')))]",
      "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','c5bf680f-fa37-47c3-9f38-e839a9b99c05','-', '1.0.2')))]"
    },
    "analyticRuleObject8": {
      "analyticRuleVersion8": "1.0.1",
      "_analyticRulecontentId8": "ac76d9c0-17a3-4aaa-a341-48f4c0b1c882",
      "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'ac76d9c0-17a3-4aaa-a341-48f4c0b1c882')]",
      "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('ac76d9c0-17a3-4aaa-a341-48f4c0b1c882')))]",
      "_analyticRulecontentProductId8": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','ac76d9c0-17a3-4aaa-a341-48f4c0b1c882','-', '1.0.1')))]"
    },
    "analyticRuleObject9": {
      "analyticRuleVersion9": "1.0.1",
      "_analyticRulecontentId9": "7f78fa52-9833-41de-b5c5-76e61b8af9c1",
      "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '7f78fa52-9833-41de-b5c5-76e61b8af9c1')]",
      "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('7f78fa52-9833-41de-b5c5-76e61b8af9c1')))]",
      "_analyticRulecontentProductId9": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','7f78fa52-9833-41de-b5c5-76e61b8af9c1','-', '1.0.1')))]"
    },
    "analyticRuleObject10": {
      "analyticRuleVersion10": "1.0.1",
      "_analyticRulecontentId10": "119a574d-f37a-403a-a67a-4d6f5083d9cf",
      "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '119a574d-f37a-403a-a67a-4d6f5083d9cf')]",
      "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('119a574d-f37a-403a-a67a-4d6f5083d9cf')))]",
      "_analyticRulecontentProductId10": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','119a574d-f37a-403a-a67a-4d6f5083d9cf','-', '1.0.1')))]"
    },
    "analyticRuleObject11": {
      "analyticRuleVersion11": "1.0.1",
      "_analyticRulecontentId11": "4f688252-bf9b-4136-87bf-d540b5be1050",
      "analyticRuleId11": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4f688252-bf9b-4136-87bf-d540b5be1050')]",
      "analyticRuleTemplateSpecName11": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4f688252-bf9b-4136-87bf-d540b5be1050')))]",
      "_analyticRulecontentProductId11": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','4f688252-bf9b-4136-87bf-d540b5be1050','-', '1.0.1')))]"
    },
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','PaloAltoPrismaCloud Data Parser')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'PaloAltoPrismaCloud Data Parser')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('PaloAltoPrismaCloud-Parser')))]",
      "parserVersion1": "1.0.0",
      "parserContentId1": "PaloAltoPrismaCloud-Parser"
    },
    "huntingQueryObject1": {
      "huntingQueryVersion1": "1.0.0",
      "_huntingQuerycontentId1": "f2e509e5-6eda-4626-a167-2875eb9c48af",
      "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('f2e509e5-6eda-4626-a167-2875eb9c48af')))]"
    },
    "huntingQueryObject2": {
      "huntingQueryVersion2": "1.0.0",
      "_huntingQuerycontentId2": "21b4c55b-3a86-40a4-81c4-31945e8f7562",
      "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('21b4c55b-3a86-40a4-81c4-31945e8f7562')))]"
    },
    "huntingQueryObject3": {
      "huntingQueryVersion3": "1.0.0",
      "_huntingQuerycontentId3": "4c17ad45-fe78-4639-98cc-3b2fd173b053",
      "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('4c17ad45-fe78-4639-98cc-3b2fd173b053')))]"
    },
    "huntingQueryObject4": {
      "huntingQueryVersion4": "1.0.0",
      "_huntingQuerycontentId4": "23a0867f-a522-4b34-acf4-0eadf75fc1e7",
      "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('23a0867f-a522-4b34-acf4-0eadf75fc1e7')))]"
    },
    "huntingQueryObject5": {
      "huntingQueryVersion5": "1.0.0",
      "_huntingQuerycontentId5": "dde04bfe-7237-4205-a447-258201e369e4",
      "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('dde04bfe-7237-4205-a447-258201e369e4')))]"
    },
    "huntingQueryObject6": {
      "huntingQueryVersion6": "1.0.0",
      "_huntingQuerycontentId6": "fd92609a-71bd-4da7-8388-e80147757e63",
      "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('fd92609a-71bd-4da7-8388-e80147757e63')))]"
    },
    "huntingQueryObject7": {
      "huntingQueryVersion7": "1.0.0",
      "_huntingQuerycontentId7": "4a09caf2-08a2-4c1d-981d-bb734de12a29",
      "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('4a09caf2-08a2-4c1d-981d-bb734de12a29')))]"
    },
    "huntingQueryObject8": {
      "huntingQueryVersion8": "1.0.0",
      "_huntingQuerycontentId8": "08ab5107-5c4e-4baf-b0f4-bf75c044f8b1",
      "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('08ab5107-5c4e-4baf-b0f4-bf75c044f8b1')))]"
    },
    "huntingQueryObject9": {
      "huntingQueryVersion9": "1.0.0",
      "_huntingQuerycontentId9": "d0a145c5-546d-48df-a5d7-8866f3bbe24f",
      "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('d0a145c5-546d-48df-a5d7-8866f3bbe24f')))]"
    },
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "PaloAltoPrismaCloudCSPMCCPDefinition",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "PaloAltoPrismaCloudCSPMCCPDefinitionConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "PrismaCloudCSPMCustomConnector": "PrismaCloudCSPMCustomConnector",
    "_PrismaCloudCSPMCustomConnector": "[variables('PrismaCloudCSPMCustomConnector')]",
    "TemplateEmptyArray": "[json('[]')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "PrismaCloudCSPMCustomConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1'))))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','lc','-', uniqueString(concat(variables('_solutionId'),'-','LogicAppsCustomConnector','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "PrismaCloudCSPM-Enrichment": "PrismaCloudCSPM-Enrichment",
    "_PrismaCloudCSPM-Enrichment": "[variables('PrismaCloudCSPM-Enrichment')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "PrismaCloudCSPM-Enrichment",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "PrismaCloudCSPM-Remediation": "PrismaCloudCSPM-Remediation",
    "_PrismaCloudCSPM-Remediation": "[variables('PrismaCloudCSPM-Remediation')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "PrismaCloudCSPM-Remediation",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]",
    "prismaId": "string",
    "_prismaId": "[variables('prismaId')]",
    "assetId": "94e06523e93b9b0f15ed03da031c95d5",
    "_assetId": "[variables('assetId')]",
    "accountID": "any",
    "_accountID": "[variables('accountID')]",
    "resourceID": "string",
    "_resourceID": "[variables('resourceID')]",
    "imageID": "string",
    "_imageID": "[variables('imageID')]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudOverview Workbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Sets the time name for analysis."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Palo Alto Prisma Cloud Overview\\n---\\n**NOTE**: This workbook depends on a parser based on a Kusto Function to work as expected [**PaloAltoPrismaCloud**](https://aka.ms/sentinel-PaloAltoPrismaCloud-parser) which is deployed with the Microsoft sentinel Solution.\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"600df9d4-1fb8-4255-a77e-27f5d12a5097\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\n| make-series TotalEvents = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain};\",\"size\":0,\"title\":\"Events over time\",\"color\":\"grayBlue\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\",\"tileSettings\":{\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"query - 2\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where isnotempty(ResourceRegion)\\r\\n| summarize count() by ResourceRegion\",\"size\":3,\"title\":\"Events by Region\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where isnotempty(ResourceCloudType)\\r\\n| summarize count() by ResourceCloudType\",\"size\":3,\"title\":\"Events by Cloud type\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"query - 1\"}]},\"customWidth\":\"50\",\"name\":\"group - 3\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| summarize Low = countif(AlertSeverity =~ \\\"low\\\"), Medium = countif(AlertSeverity == \\\"medium\\\"), High = countif(AlertSeverity == \\\"high\\\") by bin_at(TimeGenerated, 1h, now())\",\"size\":0,\"title\":\"Alerts over time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"}]}},\"customWidth\":\"55\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where Status =~ 'open'\\r\\n| project AlertId, AlertSeverity, AlertMessage\",\"size\":0,\"title\":\"Open Alerts\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"40\",\"name\":\"query - 2\",\"styleSettings\":{\"margin\":\"20px\"}}]},\"name\":\"group - 4\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where isnotempty(SrcIpAddr)\\r\\n| summarize count() by SrcIpAddr\\r\\n| top 10 by count_ desc\",\"size\":3,\"title\":\"Top Sources\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"30\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let u1 = PaloAltoPrismaCloud\\r\\n| where isnotempty(PolicyLastModifiedBy)\\r\\n| project User = PolicyLastModifiedBy;\\r\\nlet u2 = PaloAltoPrismaCloud\\r\\n| where isnotempty(UserName)\\r\\n| project User = UserName;\\r\\nlet users = union u1, u2;\\r\\nusers\\r\\n| summarize Actions = count() by User\\r\\n| top 10 by Actions desc\\r\\n\\r\\n\",\"size\":3,\"title\":\"Top Users\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Actions\",\"formatter\":4,\"formatOptions\":{\"palette\":\"blue\"}}]}},\"customWidth\":\"30\",\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where ResourceType =~ 'Login'\\r\\n| extend TimeFromNow = now() - TimeGenerated\\r\\n| extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n| project User= UserName, ['Source IP'] = SrcIpAddr, ['Login Result'] = strcat(iff(EventResult == 'Success', '✔️', '❌'), ' ', EventResult), ['Login Time'] = TimeAgo\",\"size\":0,\"title\":\"User Logins\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"35\",\"name\":\"query - 2\"}]},\"name\":\"group - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where isnotempty(AlertMessage)\\r\\n| top 10 by TimeGenerated desc\\r\\n| extend NumSeverity = case(AlertSeverity =~ 'low', 1, AlertSeverity =~ 'medium', 2, 3)\\r\\n| project ['Alert Time'] = TimeGenerated, ['Alert Message'] = AlertMessage, ['Severity'] = NumSeverity, ResourceRegionId, ResourceId\",\"size\":0,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":3,\"palette\":\"orangeRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}]}},\"name\":\"query - 6\"}],\"fromTemplateId\":\"sentinel-PaloAltoPrismaCloudWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=PaloAltoPrismaCloudWorkbook; logoFileName=paloalto_logo.svg; description=Sets the time name for analysis.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Palo Alto Prisma; templateRelativePath=PaloAltoPrismaCloudOverview.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "PaloAltoPrismaCloudAlert_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "PaloAltoPrismaCloudAudit_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "PaloAltoPrismaCloud",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAclAccessKeysNotRotated_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects access keys which were not rotated for 90 days.",
                "displayName": "Palo Alto Prisma Cloud - Access keys are not rotated for 90 days",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where AlertMessage has 'access keys are not rotated for 90 days'\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Access keys are not rotated for 90 days",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAclAllowAllOut_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects network ACLs with outbound rule to allow all traffic.",
                "displayName": "Palo Alto Prisma Cloud - Network ACL allow all outbound traffic",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where AlertMessage has 'Network ACLs with Outbound rule to allow All Traffic'\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Network ACL allow all outbound traffic",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAclAllowInToAdminPort_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects Network ACLs allow ingress traffic to server administration ports.",
                "displayName": "Palo Alto Prisma Cloud - Network ACL allow ingress traffic to server administration ports",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where AlertMessage has 'Network ACLs allow ingress traffic to server administration ports'\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Network ACL allow ingress traffic to server administration ports",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAclInAllowAll_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects Network ACLs with Inbound rule to allow All Traffic.",
                "displayName": "Palo Alto Prisma Cloud - Network ACLs Inbound rule to allow All Traffic",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where AlertMessage has 'Network ACLs with Inbound rule to allow All Traffic'\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Network ACLs Inbound rule to allow All Traffic",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAnomalousApiKeyActivity_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects anomalous API key usage activity.",
                "displayName": "Palo Alto Prisma Cloud - Anomalous access key usage",
                "enabled": false,
                "query": "let threshold = 10;\nPaloAltoPrismaCloud\n| where ResourceType =~ 'Login'\n| where EventResult =~ 'Failed'\n| where EventMessage has 'access key'\n| summarize count() by UserName, bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Anomalous access key usage",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudHighRiskScoreAlert_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects alerts with high risk score value.",
                "displayName": "Palo Alto Prisma Cloud - High risk score alert",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| extend r_score = 0.85 * toint(RiskDetailRiskScoreMaxScore)\n| extend i_RiskDetailRiskScoreScore = toint(RiskDetailRiskScoreScore)\n| where i_RiskDetailRiskScoreScore > r_score\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - High risk score alert",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject7').analyticRuleTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudHighSeverityAlertOpenedForXDays_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject7').analyticRuleVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects high severity alert which is opened for several days.",
                "displayName": "Palo Alto Prisma Cloud - High severity alert opened for several days",
                "enabled": false,
                "query": "let ResolvedAlerts = PaloAltoPrismaCloud\n| summarize result = make_set(Status) by AlertId\n| where result has 'resolved'\n| project AlertId;\nPaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where AlertSeverity =~ 'high' \n| where Status =~ 'open'\n| where AlertId !in (ResolvedAlerts)\n| extend alert_time = now() - TimeGenerated\n| where alert_time > 1d\n| extend ['Opened Days'] = strcat('Alert opened for ', strcat(toint(alert_time / 1d), ' days'))\n| distinct AlertId, AlertMessage, AlertSeverity, ['Opened Days'], ResourceId, UserName\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "P1D",
                "queryPeriod": "P14D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject7').analyticRuleId7,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 7",
                "parentId": "[variables('analyticRuleObject7').analyticRuleId7]",
                "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject7').analyticRuleVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - High severity alert opened for several days",
        "contentProductId": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "id": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject8').analyticRuleTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudIamAdminGroup_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject8').analyticRuleVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects IAM Groups with Administrator Access Permissions.",
                "displayName": "Palo Alto Prisma Cloud - IAM Group with Administrator Access Permissions",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where AlertMessage has 'IAM Groups with Administrator Access Permissions'\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject8').analyticRuleId8,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 8",
                "parentId": "[variables('analyticRuleObject8').analyticRuleId8]",
                "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject8').analyticRuleVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - IAM Group with Administrator Access Permissions",
        "contentProductId": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "id": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject9').analyticRuleTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudInactiveUser_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject9').analyticRuleVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects users inactive for 30 days.",
                "displayName": "Palo Alto Prisma Cloud - Inactive user",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Status =~ 'open'\n| where AlertMessage has 'Inactive users for more than 30 days'\n| extend AccountCustomEntity = ResourceId\n",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject9').analyticRuleId9,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 9",
                "parentId": "[variables('analyticRuleObject9').analyticRuleId9]",
                "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject9').analyticRuleVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Inactive user",
        "contentProductId": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "id": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject10').analyticRuleTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudMaxRiskScoreAlert_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject10').analyticRuleVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects alerts with maximum risk score value.",
                "displayName": "Palo Alto Prisma Cloud - Maximum risk score alert",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where RiskDetailRiskScoreScore == RiskDetailRiskScoreMaxScore\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject10').analyticRuleId10,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 10",
                "parentId": "[variables('analyticRuleObject10').analyticRuleId10]",
                "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject10').analyticRuleVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Maximum risk score alert",
        "contentProductId": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "id": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject11').analyticRuleTemplateSpecName11]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudMultipleFailedLoginsUser_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject11').analyticRuleVersion11]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects multiple failed logins for the same user account.",
                "displayName": "Palo Alto Prisma Cloud - Multiple failed logins for user",
                "enabled": false,
                "query": "let threshold = 10;\nPaloAltoPrismaCloud\n| where ResourceType =~ 'Login'\n| where EventResult =~ 'Failed'\n| where EventMessage !has 'access key'\n| summarize count() by UserName, bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "CredentialAccess"
                ],
                "techniques": [
                  "T1110"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject11').analyticRuleId11,'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 11",
                "parentId": "[variables('analyticRuleObject11').analyticRuleId11]",
                "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject11').analyticRuleVersion11]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Multiple failed logins for user",
        "contentProductId": "[variables('analyticRuleObject11')._analyticRulecontentProductId11]",
        "id": "[variables('analyticRuleObject11')._analyticRulecontentProductId11]",
        "version": "[variables('analyticRuleObject11').analyticRuleVersion11]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloud Data Parser with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "PaloAltoPrismaCloud Data Parser",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "PaloAltoPrismaCloud",
                "query": "let Audit_view = view () { \nPaloAltoPrismaCloudAudit_CL\n| extend \n    EventType='PaloAltoPrismaCloudAudit',\n    user=iff(isnotempty(column_ifexists('user_s', '')), column_ifexists('user_s', ''), column_ifexists('user_g', '')),\n    resourceName=iff(isnotempty(column_ifexists('resourceName_s', '')), column_ifexists('resourceName_s', ''), column_ifexists('resourceName_g', '')),\n    timestamp_d=column_ifexists('timestamp_d', ''),\n    IPAddress=column_ifexists('IPAddress', ''),\n    ResourceType=column_ifexists('ResourceType', ''),\n    action_s=column_ifexists('action_s', ''),\n    result_s=column_ifexists('result_s', '')\n| project-rename  \n    UserName=user,\n    ResourceName=resourceName,\n    EventEndTime=timestamp_d,\n    SrcIpAddr=IPAddress,\n    EventMessage=action_s,\n    EventResult=result_s\n| project-away\n    user_s,\n    resourceName_s\n};\nlet Alert_view = view () { \nPaloAltoPrismaCloudAlert_CL\n| extend \n    EventType='PaloAltoPrismaCloudAlert',\n    reason_s=column_ifexists('reason_s', ''),\n    policy_name_s=column_ifexists('policy_name_s', ''),\n    policy_description_s=column_ifexists('policy_description_s', ''),\n    policy_severity_s=column_ifexists('policy_severity_s', ''),\n    policy_recommendation_s=column_ifexists('policy_recommendation_s', ''),\n    policy_labels_s=column_ifexists('policy_labels_s', ''),\n    policy_lastModifiedOn_d=column_ifexists('policy_lastModifiedOn_d', ''),\n    policy_lastModifiedBy_s=column_ifexists('policy_lastModifiedBy_s', ''),\n    policy_deleted_b=column_ifexists('policy_deleted_b', ''),\n    policy_remediation_description_s=column_ifexists('policy_remediation_description_s', ''),\n    policy_remediation_impact_s=column_ifexists('policy_remediation_impact_s', ''),\n    policy_remediation_cliScriptTemplate_s=column_ifexists('policy_remediation_cliScriptTemplate_s', ''),\n    history_s=column_ifexists('history_s', ''),\n    resource_data_mfa_active_b=column_ifexists('resource_data_mfa_active_b', ''),\n    resource_data_cert_1_active_b=column_ifexists('resource_data_cert_1_active_b', ''),\n    resource_data_cert_2_active_b=column_ifexists('resource_data_cert_2_active_b', ''),\n    resource_data_password_enabled_s=column_ifexists('resource_data_password_enabled_s', ''),\n    resource_data_password_last_used_s=column_ifexists('resource_data_password_last_used_s', ''),\n    resource_data_user_creation_time_t=column_ifexists('resource_data_user_creation_time_t', ''),\n    resource_data_access_key_1_active_b=column_ifexists('resource_data_access_key_1_active_b', ''),\n    resource_data_access_key_2_active_b=column_ifexists('resource_data_access_key_2_active_b', ''),\n    resource_data_cert_1_last_rotated_s=column_ifexists('resource_data_cert_1_last_rotated_s', ''),\n    resource_data_cert_2_last_rotated_s=column_ifexists('resource_data_cert_2_last_rotated_s', ''),\n    resource_data_password_last_changed_s=column_ifexists('resource_data_password_last_changed_s', ''),\n    resource_data_password_next_rotation_s=column_ifexists('resource_data_password_next_rotation_s', ''),\n    resource_data_access_key_1_last_rotated_t=column_ifexists('resource_data_access_key_1_last_rotated_t', ''),\n    resource_data_access_key_2_last_rotated_s=column_ifexists('resource_data_access_key_2_last_rotated_s', ''),\n    resource_data_access_key_1_last_used_date_t=column_ifexists('resource_data_access_key_1_last_used_date_t', ''),\n    resource_data_access_key_2_last_used_date_s=column_ifexists('resource_data_access_key_2_last_used_date_s', ''),\n    resource_data_access_key_1_last_used_region_s=column_ifexists('resource_data_access_key_1_last_used_region_s', ''),\n    resource_data_access_key_2_last_used_region_s=column_ifexists('resource_data_access_key_2_last_used_region_s', ''),\n    resource_data_access_key_1_last_used_service_s=column_ifexists('resource_data_access_key_1_last_used_service_s', ''),\n    resource_data_access_key_2_last_used_service_s=column_ifexists('resource_data_access_key_2_last_used_service_s', ''),\n    resource_rrn_s=column_ifexists('resource_rrn_s', ''),\n    resource_name_s=column_ifexists('resource_name_s', ''),\n    resource_account_s=column_ifexists('resource_account_s', ''),\n    resource_accountId_s=column_ifexists('resource_accountId_s', ''),\n    resource_cloudAccountGroups_s=column_ifexists('resource_cloudAccountGroups_s', ''),\n    resource_region_s=column_ifexists('resource_region_s', ''),\n    resource_regionId_s=column_ifexists('resource_regionId_s', ''),\n    resource_resourceType_s=column_ifexists('resource_resourceType_s', ''),\n    resource_resourceApiName_s=column_ifexists('resource_resourceApiName_s', ''),\n    resource_url_s=column_ifexists('resource_url_s', ''),\n    resource_data_arn_s=column_ifexists('resource_data_arn_s', ''),\n    resource_data_user_s=column_ifexists('resource_data_user_s', ''),\n    resource_additionalInfo_accessKeyAge_s=column_ifexists('resource_additionalInfo_accessKeyAge_s', ''),\n    resource_additionalInfo_inactiveSinceTs_s=column_ifexists('resource_additionalInfo_inactiveSinceTs_s', ''),\n    resource_cloudType_s=column_ifexists('resource_cloudType_s', ''),\n    resource_resourceTs_d=column_ifexists('resource_resourceTs_d', ''),\n    id_s=column_ifexists('id_s', ''),\n    policy_policyId_g=column_ifexists('policy_policyId_g', ''),\n    policy_policyType_s=column_ifexists('policy_policyType_s', ''),\n    policy_systemDefault_b=column_ifexists('policy_systemDefault_b', ''),\n    policy_remediable_b=column_ifexists('policy_remediable_b', ''),\n    alertRules_s=column_ifexists('alertRules_s', ''),\n    riskDetail_riskScore_score_d=column_ifexists('riskDetail_riskScore_score_d', ''),\n    riskDetail_riskScore_maxScore_d=column_ifexists('riskDetail_riskScore_maxScore_d', ''),\n    riskDetail_rating_s=column_ifexists('riskDetail_rating_s', ''),\n    riskDetail_score_s=column_ifexists('riskDetail_score_s', ''),\n    status_s=column_ifexists('status_s', ''),\n    firstSeen_d=column_ifexists('firstSeen_d', ''),\n    lastSeen_d=column_ifexists('lastSeen_d', ''),\n    alertTime_d=column_ifexists('alertTime_d', ''),\n    resource_id=iff(isnotempty(column_ifexists('resource_id_s', '')), column_ifexists('resource_id_s', ''), column_ifexists('resource_id_g', ''))\n| project-rename\n    Reason=reason_s,\n    AlertMessage=policy_name_s,\n    AlertDescription=policy_description_s,\n    AlertSeverity=policy_severity_s,\n    PolicyRecommendation=policy_recommendation_s,\n    PolicyLabels=policy_labels_s,\n    PolicyLastModifiedOn=policy_lastModifiedOn_d,\n    PolicyLastModifiedBy=policy_lastModifiedBy_s,\n    PolicyDeleted=policy_deleted_b,\n    PolicyRemediationDescription=policy_remediation_description_s,\n    PolicyRemediationImpact=policy_remediation_impact_s,\n    PolicyRemediationCliScriptTemplate=policy_remediation_cliScriptTemplate_s,\n    ResourceId=resource_id,\n    History=history_s,\n    ResourceDataMfaActive=resource_data_mfa_active_b,\n    ResourceDataCert1Active=resource_data_cert_1_active_b,\n    ResourceDataCert2Active=resource_data_cert_2_active_b,\n    ResourceDataPasswordEnabled=resource_data_password_enabled_s,\n    ResourceDataPasswordLastUsed=resource_data_password_last_used_s,\n    ResourceDataUserCreationTime=resource_data_user_creation_time_t,\n    ResourceDataAccessKey1Active=resource_data_access_key_1_active_b,\n    ResourceDataAccessKey2Active=resource_data_access_key_2_active_b,\n    ResourceDataCert1LastRotated=resource_data_cert_1_last_rotated_s,\n    ResourceDataCert2LastRotated=resource_data_cert_2_last_rotated_s,\n    ResourceDataPasswordLastChanged=resource_data_password_last_changed_s,\n    ResourceDataPasswordNextRotation=resource_data_password_next_rotation_s,\n    ResourceDataAccessKey1LastRotated=resource_data_access_key_1_last_rotated_t,\n    ResourceDataAccessKey2LastRotated=resource_data_access_key_2_last_rotated_s,\n    ResourceDataAccessKey1LastUsedDate=resource_data_access_key_1_last_used_date_t,\n    ResourceDataAccessKey2LastUsedDate=resource_data_access_key_2_last_used_date_s,\n    ResourceDataAccessKey1LastUsedRegion=resource_data_access_key_1_last_used_region_s,\n    ResourceDataAccessKey2LastUsedRegion=resource_data_access_key_2_last_used_region_s,\n    ResourceDataAccessKey1LastUsedService=resource_data_access_key_1_last_used_service_s,\n    ResourceDataAccessKey2LastUsedService=resource_data_access_key_2_last_used_service_s,\n    ResourceRrn=resource_rrn_s,\n    ResourceName=resource_name_s,\n    ResourceAccount=resource_account_s,\n    ResourceAccountId=resource_accountId_s,\n    ResourceCloudAccountGroups=resource_cloudAccountGroups_s,\n    ResourceRegion=resource_region_s,\n    ResourceRegionId=resource_regionId_s,\n    ResourceResourceType=resource_resourceType_s,\n    ResourceResourceApiName=resource_resourceApiName_s,\n    ResourceUrl=resource_url_s,\n    ResourceDataArn=resource_data_arn_s,\n    ResourceDataUser=resource_data_user_s,\n    ResourceAdditionalInfoAccessKeyAge=resource_additionalInfo_accessKeyAge_s,\n    ResourceAdditionalInfoInactiveSinceTs=resource_additionalInfo_inactiveSinceTs_s,\n    ResourceCloudType=resource_cloudType_s,\n    ResourceResourceTs=resource_resourceTs_d,\n    AlertId=id_s,\n    PolicyPolicyId=policy_policyId_g,\n    PolicyPolicyType=policy_policyType_s,\n    PolicySystemDefault=policy_systemDefault_b,\n    PolicyRemediable=policy_remediable_b,\n    AlertRules=alertRules_s,\n    RiskDetailRiskScoreScore=riskDetail_riskScore_score_d,\n    RiskDetailRiskScoreMaxScore=riskDetail_riskScore_maxScore_d,\n    RiskDetailRating=riskDetail_rating_s,\n    RiskDetailScore=riskDetail_score_s,\n    Status=status_s,\n    FirstSeen=firstSeen_d,\n    LastSeen=lastSeen_d,\n    AlertTime=alertTime_d\n| project-away\n    resource_id_s\n};\nlet AuditLog_view = view () {\nPaloAltoPrismaCloudAuditV2_CL\n| extend \n    EventType='PaloAltoPrismaCloudAudit',\n    user=iff(isnotempty(column_ifexists('User', '')), column_ifexists('User', ''), column_ifexists('User', '')),\n    ResourceName=iff(isnotempty(column_ifexists('ResourceName', '')), column_ifexists('ResourceName', ''), column_ifexists('ResourceName', '')),\n    timestamp_d=column_ifexists('TimeGenerated', ''),\n    IPAddress=column_ifexists('IPAddress', ''),\n    ResourceType=column_ifexists('ResourceType', ''),\n    action_s=column_ifexists('Action', ''),\n    result_s=column_ifexists('Result', '')\n| project-rename  \n    UserName=user,\n    EventEndTime=timestamp_d,\n    SrcIpAddr=IPAddress,\n    EventMessage=action_s,\n    EventResult=result_s\n| project-away\n    User\n};\nlet AlertLog_view = view () { \nPaloAltoPrismaCloudAlertV2_CL\n| extend \n    EventType='PaloAltoPrismaCloudAlert',\n    Reason=column_ifexists('Reason', ''),\n    policy_name_s=column_ifexists('PolicyName', ''),\n    policy_description_s=column_ifexists('PolicyDescription', ''),\n    policy_severity_s=column_ifexists('PolicySeverity', ''),\n    PolicyRecommendation=column_ifexists('PolicyRecommendation', ''),\n    PolicyLabels=column_ifexists('PolicyLabels', ''),\n    PolicyLastModifiedOn=column_ifexists('PolicyLastModifiedOn', ''),\n    PolicyLastModifiedBy=column_ifexists('PolicyLastModifiedBy', ''),\n    PolicyDeleted=column_ifexists('PolicyDeleted', ''),\n    PolicyRemediationDescription=column_ifexists('PolicyRemediationDescription', ''),\n    PolicyRemediationImpact=column_ifexists('PolicyRemediationImpact', ''),\n    policy_remediation_cliScriptTemplate_s=column_ifexists('PolicyRemediationcliScriptTemplate', ''),\n    History=column_ifexists('History', ''),\n    ResourceDataMfaActive=column_ifexists('ResourceDataMfaActive', ''),\n    ResourceDataCert1Active=column_ifexists('ResourceDataCert1Active', ''),\n    ResourceDataCert2Active=column_ifexists('ResourceDataCert2Active', ''),\n    ResourceDataPasswordEnabled=column_ifexists('ResourceDataPasswordEnabled', ''),\n    resource_data_password_last_used_s=column_ifexists('ResourceDatapasswordLastUsed', ''),\n    ResourceDataUserCreationTime=column_ifexists('ResourceDataUserCreationTime', ''),\n    resource_data_access_key_1_active_b=column_ifexists('ResourceDataAccesskey1Active', ''),\n    resource_data_access_key_2_active_b=column_ifexists('ResourceDataAccesskey2Active', ''),\n    resource_data_cert_1_last_rotated_s=column_ifexists('ResourceDatacert1LastRotated', ''),\n    resource_data_cert_2_last_rotated_s=column_ifexists('ResourceDatacert2LastRotated', ''),\n    resource_data_password_last_changed_s=column_ifexists('ResourceDatapasswordLastChanged', ''),\n    ResourceDataPasswordNextRotation=column_ifexists('ResourceDataPasswordNextRotation', ''),\n    resource_data_access_key_1_last_rotated_t=column_ifexists('ResourceDataAccesskey1LastRotated', ''),\n    resource_data_access_key_2_last_rotated_s=column_ifexists('ResourceDataAccesskey2LastRotated', ''),\n    resource_data_access_key_1_last_used_date_t=column_ifexists('ResourceDataAccesskey1LastUsedDate', ''),\n    resource_data_access_key_2_last_used_date_s=column_ifexists('ResourceDataAccesskey2LastUsedDate', ''),\n    resource_data_access_key_1_last_used_region_s=column_ifexists('ResourceDataAccesskey1LastUsedRegion', ''),\n    resource_data_access_key_2_last_used_region_s=column_ifexists('ResourceDataAccesskey2LastUsedRegion', ''),\n    resource_data_access_key_1_last_used_service_s=column_ifexists('ResourceDataAccesskey1LastUsedService', ''),\n    resource_data_access_key_2_last_used_service_s=column_ifexists('ResourceDataAccesskey2LastUsedService', ''),\n    resource_rrn_s=column_ifexists('Resourcerrn', ''),\n    ResourceName=column_ifexists('ResourceName', ''),\n    ResourceAccount=column_ifexists('ResourceAccount', ''),\n    ResourceAccountId=column_ifexists('ResourceAccountId', ''),\n    ResourceCloudAccountGroups=column_ifexists('ResourceCloudAccountGroups', ''),\n    ResourceRegion=column_ifexists('ResourceRegion', ''),\n    ResourceRegionId=column_ifexists('ResourceRegionId', ''),\n    ResourceResourceType=column_ifexists('ResourceResourceType', ''),\n    ResourceResourceApiName=column_ifexists('ResourceResourceApiName', ''),\n    resource_url_s=column_ifexists('Resourceurl', ''),\n    ResourceDataArn=column_ifexists('ResourceDataArn', ''),\n    ResourceDataUser=column_ifexists('ResourceDataUser', ''),\n    ResourceAdditionalInfoAccessKeyAge=column_ifexists('ResourceAdditionalInfoAccessKeyAge', ''),\n    ResourceAdditionalInfoInactiveSinceTs=column_ifexists('ResourceAdditionalInfoInactiveSinceTs', ''),\n    resource_cloudType_s=column_ifexists('ResourceDataCloudType', ''),\n    resource_resourceTs_d=column_ifexists('ResourceDataResourceTs', ''),\n    id_s=column_ifexists('ID', ''),\n    PolicyPolicyId=column_ifexists('PolicyPolicyId', ''),\n    PolicyPolicyType=column_ifexists('PolicyPolicyType', ''),\n    PolicySystemDefault=column_ifexists('PolicySystemDefault', ''),\n    PolicyRemediable=column_ifexists('PolicyaiRemediable', ''),\n    AlertRules=column_ifexists('AlertRules', ''),\n    RiskDetailRiskScoreScore=column_ifexists('RiskDetailRiskScoreScore', ''),\n    RiskDetailRiskScoreMaxScore=column_ifexists('RiskDetailRiskScoreMaxScore', ''),\n    RiskDetailRating=column_ifexists('RiskDetailRating', ''),\n    RiskDetailScore=column_ifexists('RiskDetailScore', ''),\n    Status=column_ifexists('Status', ''),\n    FirstSeen=column_ifexists('FirstSeen', ''),\n    LastSeen=column_ifexists('LastSeen', ''),\n    AlertTime=column_ifexists('AlertTime', ''),\n    ResourceId=iff(isnotempty(column_ifexists('ResourceId', '')), column_ifexists('ResourceId', ''), column_ifexists('ResourceId', ''))\n| project-rename\n    AlertMessage=policy_name_s,\n    AlertDescription=policy_description_s,\n    AlertSeverity=policy_severity_s,\n    PolicyRemediationCliScriptTemplate=policy_remediation_cliScriptTemplate_s,\n    ResourceDataPasswordLastUsed=resource_data_password_last_used_s,\n    ResourceDataAccessKey1Active=resource_data_access_key_1_active_b,\n    ResourceDataAccessKey2Active=resource_data_access_key_2_active_b,\n    ResourceDataCert1LastRotated=resource_data_cert_1_last_rotated_s,\n    ResourceDataCert2LastRotated=resource_data_cert_2_last_rotated_s,\n    ResourceDataPasswordLastChanged=resource_data_password_last_changed_s,\n    ResourceDataAccessKey1LastRotated=resource_data_access_key_1_last_rotated_t,\n    ResourceDataAccessKey2LastRotated=resource_data_access_key_2_last_rotated_s,\n    ResourceDataAccessKey1LastUsedDate=resource_data_access_key_1_last_used_date_t,\n    ResourceDataAccessKey2LastUsedDate=resource_data_access_key_2_last_used_date_s,\n    ResourceDataAccessKey1LastUsedRegion=resource_data_access_key_1_last_used_region_s,\n    ResourceDataAccessKey2LastUsedRegion=resource_data_access_key_2_last_used_region_s,\n    ResourceDataAccessKey1LastUsedService=resource_data_access_key_1_last_used_service_s,\n    ResourceDataAccessKey2LastUsedService=resource_data_access_key_2_last_used_service_s,\n    ResourceRrn=resource_rrn_s,\n    ResourceUrl=resource_url_s,\n    ResourceCloudType=resource_cloudType_s,\n    ResourceResourceTs=resource_resourceTs_d,\n    AlertId=id_s\n};\nunion isfuzzy=true (Alert_view), (Audit_view), (AlertLog_view),(AuditLog_view)\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'PaloAltoPrismaCloud Data Parser')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "PaloAltoPrismaCloud",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "PaloAltoPrismaCloud Data Parser",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "PaloAltoPrismaCloud Data Parser",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "PaloAltoPrismaCloud",
        "query": "let Audit_view = view () { \nPaloAltoPrismaCloudAudit_CL\n| extend \n    EventType='PaloAltoPrismaCloudAudit',\n    user=iff(isnotempty(column_ifexists('user_s', '')), column_ifexists('user_s', ''), column_ifexists('user_g', '')),\n    resourceName=iff(isnotempty(column_ifexists('resourceName_s', '')), column_ifexists('resourceName_s', ''), column_ifexists('resourceName_g', '')),\n    timestamp_d=column_ifexists('timestamp_d', ''),\n    IPAddress=column_ifexists('IPAddress', ''),\n    ResourceType=column_ifexists('ResourceType', ''),\n    action_s=column_ifexists('action_s', ''),\n    result_s=column_ifexists('result_s', '')\n| project-rename  \n    UserName=user,\n    ResourceName=resourceName,\n    EventEndTime=timestamp_d,\n    SrcIpAddr=IPAddress,\n    EventMessage=action_s,\n    EventResult=result_s\n| project-away\n    user_s,\n    resourceName_s\n};\nlet Alert_view = view () { \nPaloAltoPrismaCloudAlert_CL\n| extend \n    EventType='PaloAltoPrismaCloudAlert',\n    reason_s=column_ifexists('reason_s', ''),\n    policy_name_s=column_ifexists('policy_name_s', ''),\n    policy_description_s=column_ifexists('policy_description_s', ''),\n    policy_severity_s=column_ifexists('policy_severity_s', ''),\n    policy_recommendation_s=column_ifexists('policy_recommendation_s', ''),\n    policy_labels_s=column_ifexists('policy_labels_s', ''),\n    policy_lastModifiedOn_d=column_ifexists('policy_lastModifiedOn_d', ''),\n    policy_lastModifiedBy_s=column_ifexists('policy_lastModifiedBy_s', ''),\n    policy_deleted_b=column_ifexists('policy_deleted_b', ''),\n    policy_remediation_description_s=column_ifexists('policy_remediation_description_s', ''),\n    policy_remediation_impact_s=column_ifexists('policy_remediation_impact_s', ''),\n    policy_remediation_cliScriptTemplate_s=column_ifexists('policy_remediation_cliScriptTemplate_s', ''),\n    history_s=column_ifexists('history_s', ''),\n    resource_data_mfa_active_b=column_ifexists('resource_data_mfa_active_b', ''),\n    resource_data_cert_1_active_b=column_ifexists('resource_data_cert_1_active_b', ''),\n    resource_data_cert_2_active_b=column_ifexists('resource_data_cert_2_active_b', ''),\n    resource_data_password_enabled_s=column_ifexists('resource_data_password_enabled_s', ''),\n    resource_data_password_last_used_s=column_ifexists('resource_data_password_last_used_s', ''),\n    resource_data_user_creation_time_t=column_ifexists('resource_data_user_creation_time_t', ''),\n    resource_data_access_key_1_active_b=column_ifexists('resource_data_access_key_1_active_b', ''),\n    resource_data_access_key_2_active_b=column_ifexists('resource_data_access_key_2_active_b', ''),\n    resource_data_cert_1_last_rotated_s=column_ifexists('resource_data_cert_1_last_rotated_s', ''),\n    resource_data_cert_2_last_rotated_s=column_ifexists('resource_data_cert_2_last_rotated_s', ''),\n    resource_data_password_last_changed_s=column_ifexists('resource_data_password_last_changed_s', ''),\n    resource_data_password_next_rotation_s=column_ifexists('resource_data_password_next_rotation_s', ''),\n    resource_data_access_key_1_last_rotated_t=column_ifexists('resource_data_access_key_1_last_rotated_t', ''),\n    resource_data_access_key_2_last_rotated_s=column_ifexists('resource_data_access_key_2_last_rotated_s', ''),\n    resource_data_access_key_1_last_used_date_t=column_ifexists('resource_data_access_key_1_last_used_date_t', ''),\n    resource_data_access_key_2_last_used_date_s=column_ifexists('resource_data_access_key_2_last_used_date_s', ''),\n    resource_data_access_key_1_last_used_region_s=column_ifexists('resource_data_access_key_1_last_used_region_s', ''),\n    resource_data_access_key_2_last_used_region_s=column_ifexists('resource_data_access_key_2_last_used_region_s', ''),\n    resource_data_access_key_1_last_used_service_s=column_ifexists('resource_data_access_key_1_last_used_service_s', ''),\n    resource_data_access_key_2_last_used_service_s=column_ifexists('resource_data_access_key_2_last_used_service_s', ''),\n    resource_rrn_s=column_ifexists('resource_rrn_s', ''),\n    resource_name_s=column_ifexists('resource_name_s', ''),\n    resource_account_s=column_ifexists('resource_account_s', ''),\n    resource_accountId_s=column_ifexists('resource_accountId_s', ''),\n    resource_cloudAccountGroups_s=column_ifexists('resource_cloudAccountGroups_s', ''),\n    resource_region_s=column_ifexists('resource_region_s', ''),\n    resource_regionId_s=column_ifexists('resource_regionId_s', ''),\n    resource_resourceType_s=column_ifexists('resource_resourceType_s', ''),\n    resource_resourceApiName_s=column_ifexists('resource_resourceApiName_s', ''),\n    resource_url_s=column_ifexists('resource_url_s', ''),\n    resource_data_arn_s=column_ifexists('resource_data_arn_s', ''),\n    resource_data_user_s=column_ifexists('resource_data_user_s', ''),\n    resource_additionalInfo_accessKeyAge_s=column_ifexists('resource_additionalInfo_accessKeyAge_s', ''),\n    resource_additionalInfo_inactiveSinceTs_s=column_ifexists('resource_additionalInfo_inactiveSinceTs_s', ''),\n    resource_cloudType_s=column_ifexists('resource_cloudType_s', ''),\n    resource_resourceTs_d=column_ifexists('resource_resourceTs_d', ''),\n    id_s=column_ifexists('id_s', ''),\n    policy_policyId_g=column_ifexists('policy_policyId_g', ''),\n    policy_policyType_s=column_ifexists('policy_policyType_s', ''),\n    policy_systemDefault_b=column_ifexists('policy_systemDefault_b', ''),\n    policy_remediable_b=column_ifexists('policy_remediable_b', ''),\n    alertRules_s=column_ifexists('alertRules_s', ''),\n    riskDetail_riskScore_score_d=column_ifexists('riskDetail_riskScore_score_d', ''),\n    riskDetail_riskScore_maxScore_d=column_ifexists('riskDetail_riskScore_maxScore_d', ''),\n    riskDetail_rating_s=column_ifexists('riskDetail_rating_s', ''),\n    riskDetail_score_s=column_ifexists('riskDetail_score_s', ''),\n    status_s=column_ifexists('status_s', ''),\n    firstSeen_d=column_ifexists('firstSeen_d', ''),\n    lastSeen_d=column_ifexists('lastSeen_d', ''),\n    alertTime_d=column_ifexists('alertTime_d', ''),\n    resource_id=iff(isnotempty(column_ifexists('resource_id_s', '')), column_ifexists('resource_id_s', ''), column_ifexists('resource_id_g', ''))\n| project-rename\n    Reason=reason_s,\n    AlertMessage=policy_name_s,\n    AlertDescription=policy_description_s,\n    AlertSeverity=policy_severity_s,\n    PolicyRecommendation=policy_recommendation_s,\n    PolicyLabels=policy_labels_s,\n    PolicyLastModifiedOn=policy_lastModifiedOn_d,\n    PolicyLastModifiedBy=policy_lastModifiedBy_s,\n    PolicyDeleted=policy_deleted_b,\n    PolicyRemediationDescription=policy_remediation_description_s,\n    PolicyRemediationImpact=policy_remediation_impact_s,\n    PolicyRemediationCliScriptTemplate=policy_remediation_cliScriptTemplate_s,\n    ResourceId=resource_id,\n    History=history_s,\n    ResourceDataMfaActive=resource_data_mfa_active_b,\n    ResourceDataCert1Active=resource_data_cert_1_active_b,\n    ResourceDataCert2Active=resource_data_cert_2_active_b,\n    ResourceDataPasswordEnabled=resource_data_password_enabled_s,\n    ResourceDataPasswordLastUsed=resource_data_password_last_used_s,\n    ResourceDataUserCreationTime=resource_data_user_creation_time_t,\n    ResourceDataAccessKey1Active=resource_data_access_key_1_active_b,\n    ResourceDataAccessKey2Active=resource_data_access_key_2_active_b,\n    ResourceDataCert1LastRotated=resource_data_cert_1_last_rotated_s,\n    ResourceDataCert2LastRotated=resource_data_cert_2_last_rotated_s,\n    ResourceDataPasswordLastChanged=resource_data_password_last_changed_s,\n    ResourceDataPasswordNextRotation=resource_data_password_next_rotation_s,\n    ResourceDataAccessKey1LastRotated=resource_data_access_key_1_last_rotated_t,\n    ResourceDataAccessKey2LastRotated=resource_data_access_key_2_last_rotated_s,\n    ResourceDataAccessKey1LastUsedDate=resource_data_access_key_1_last_used_date_t,\n    ResourceDataAccessKey2LastUsedDate=resource_data_access_key_2_last_used_date_s,\n    ResourceDataAccessKey1LastUsedRegion=resource_data_access_key_1_last_used_region_s,\n    ResourceDataAccessKey2LastUsedRegion=resource_data_access_key_2_last_used_region_s,\n    ResourceDataAccessKey1LastUsedService=resource_data_access_key_1_last_used_service_s,\n    ResourceDataAccessKey2LastUsedService=resource_data_access_key_2_last_used_service_s,\n    ResourceRrn=resource_rrn_s,\n    ResourceName=resource_name_s,\n    ResourceAccount=resource_account_s,\n    ResourceAccountId=resource_accountId_s,\n    ResourceCloudAccountGroups=resource_cloudAccountGroups_s,\n    ResourceRegion=resource_region_s,\n    ResourceRegionId=resource_regionId_s,\n    ResourceResourceType=resource_resourceType_s,\n    ResourceResourceApiName=resource_resourceApiName_s,\n    ResourceUrl=resource_url_s,\n    ResourceDataArn=resource_data_arn_s,\n    ResourceDataUser=resource_data_user_s,\n    ResourceAdditionalInfoAccessKeyAge=resource_additionalInfo_accessKeyAge_s,\n    ResourceAdditionalInfoInactiveSinceTs=resource_additionalInfo_inactiveSinceTs_s,\n    ResourceCloudType=resource_cloudType_s,\n    ResourceResourceTs=resource_resourceTs_d,\n    AlertId=id_s,\n    PolicyPolicyId=policy_policyId_g,\n    PolicyPolicyType=policy_policyType_s,\n    PolicySystemDefault=policy_systemDefault_b,\n    PolicyRemediable=policy_remediable_b,\n    AlertRules=alertRules_s,\n    RiskDetailRiskScoreScore=riskDetail_riskScore_score_d,\n    RiskDetailRiskScoreMaxScore=riskDetail_riskScore_maxScore_d,\n    RiskDetailRating=riskDetail_rating_s,\n    RiskDetailScore=riskDetail_score_s,\n    Status=status_s,\n    FirstSeen=firstSeen_d,\n    LastSeen=lastSeen_d,\n    AlertTime=alertTime_d\n| project-away\n    resource_id_s\n};\nlet AuditLog_view = view () {\nPaloAltoPrismaCloudAuditV2_CL\n| extend \n    EventType='PaloAltoPrismaCloudAudit',\n    user=iff(isnotempty(column_ifexists('User', '')), column_ifexists('User', ''), column_ifexists('User', '')),\n    ResourceName=iff(isnotempty(column_ifexists('ResourceName', '')), column_ifexists('ResourceName', ''), column_ifexists('ResourceName', '')),\n    timestamp_d=column_ifexists('TimeGenerated', ''),\n    IPAddress=column_ifexists('IPAddress', ''),\n    ResourceType=column_ifexists('ResourceType', ''),\n    action_s=column_ifexists('Action', ''),\n    result_s=column_ifexists('Result', '')\n| project-rename  \n    UserName=user,\n    EventEndTime=timestamp_d,\n    SrcIpAddr=IPAddress,\n    EventMessage=action_s,\n    EventResult=result_s\n| project-away\n    User\n};\nlet AlertLog_view = view () { \nPaloAltoPrismaCloudAlertV2_CL\n| extend \n    EventType='PaloAltoPrismaCloudAlert',\n    Reason=column_ifexists('Reason', ''),\n    policy_name_s=column_ifexists('PolicyName', ''),\n    policy_description_s=column_ifexists('PolicyDescription', ''),\n    policy_severity_s=column_ifexists('PolicySeverity', ''),\n    PolicyRecommendation=column_ifexists('PolicyRecommendation', ''),\n    PolicyLabels=column_ifexists('PolicyLabels', ''),\n    PolicyLastModifiedOn=column_ifexists('PolicyLastModifiedOn', ''),\n    PolicyLastModifiedBy=column_ifexists('PolicyLastModifiedBy', ''),\n    PolicyDeleted=column_ifexists('PolicyDeleted', ''),\n    PolicyRemediationDescription=column_ifexists('PolicyRemediationDescription', ''),\n    PolicyRemediationImpact=column_ifexists('PolicyRemediationImpact', ''),\n    policy_remediation_cliScriptTemplate_s=column_ifexists('PolicyRemediationcliScriptTemplate', ''),\n    History=column_ifexists('History', ''),\n    ResourceDataMfaActive=column_ifexists('ResourceDataMfaActive', ''),\n    ResourceDataCert1Active=column_ifexists('ResourceDataCert1Active', ''),\n    ResourceDataCert2Active=column_ifexists('ResourceDataCert2Active', ''),\n    ResourceDataPasswordEnabled=column_ifexists('ResourceDataPasswordEnabled', ''),\n    resource_data_password_last_used_s=column_ifexists('ResourceDatapasswordLastUsed', ''),\n    ResourceDataUserCreationTime=column_ifexists('ResourceDataUserCreationTime', ''),\n    resource_data_access_key_1_active_b=column_ifexists('ResourceDataAccesskey1Active', ''),\n    resource_data_access_key_2_active_b=column_ifexists('ResourceDataAccesskey2Active', ''),\n    resource_data_cert_1_last_rotated_s=column_ifexists('ResourceDatacert1LastRotated', ''),\n    resource_data_cert_2_last_rotated_s=column_ifexists('ResourceDatacert2LastRotated', ''),\n    resource_data_password_last_changed_s=column_ifexists('ResourceDatapasswordLastChanged', ''),\n    ResourceDataPasswordNextRotation=column_ifexists('ResourceDataPasswordNextRotation', ''),\n    resource_data_access_key_1_last_rotated_t=column_ifexists('ResourceDataAccesskey1LastRotated', ''),\n    resource_data_access_key_2_last_rotated_s=column_ifexists('ResourceDataAccesskey2LastRotated', ''),\n    resource_data_access_key_1_last_used_date_t=column_ifexists('ResourceDataAccesskey1LastUsedDate', ''),\n    resource_data_access_key_2_last_used_date_s=column_ifexists('ResourceDataAccesskey2LastUsedDate', ''),\n    resource_data_access_key_1_last_used_region_s=column_ifexists('ResourceDataAccesskey1LastUsedRegion', ''),\n    resource_data_access_key_2_last_used_region_s=column_ifexists('ResourceDataAccesskey2LastUsedRegion', ''),\n    resource_data_access_key_1_last_used_service_s=column_ifexists('ResourceDataAccesskey1LastUsedService', ''),\n    resource_data_access_key_2_last_used_service_s=column_ifexists('ResourceDataAccesskey2LastUsedService', ''),\n    resource_rrn_s=column_ifexists('Resourcerrn', ''),\n    ResourceName=column_ifexists('ResourceName', ''),\n    ResourceAccount=column_ifexists('ResourceAccount', ''),\n    ResourceAccountId=column_ifexists('ResourceAccountId', ''),\n    ResourceCloudAccountGroups=column_ifexists('ResourceCloudAccountGroups', ''),\n    ResourceRegion=column_ifexists('ResourceRegion', ''),\n    ResourceRegionId=column_ifexists('ResourceRegionId', ''),\n    ResourceResourceType=column_ifexists('ResourceResourceType', ''),\n    ResourceResourceApiName=column_ifexists('ResourceResourceApiName', ''),\n    resource_url_s=column_ifexists('Resourceurl', ''),\n    ResourceDataArn=column_ifexists('ResourceDataArn', ''),\n    ResourceDataUser=column_ifexists('ResourceDataUser', ''),\n    ResourceAdditionalInfoAccessKeyAge=column_ifexists('ResourceAdditionalInfoAccessKeyAge', ''),\n    ResourceAdditionalInfoInactiveSinceTs=column_ifexists('ResourceAdditionalInfoInactiveSinceTs', ''),\n    resource_cloudType_s=column_ifexists('ResourceDataCloudType', ''),\n    resource_resourceTs_d=column_ifexists('ResourceDataResourceTs', ''),\n    id_s=column_ifexists('ID', ''),\n    PolicyPolicyId=column_ifexists('PolicyPolicyId', ''),\n    PolicyPolicyType=column_ifexists('PolicyPolicyType', ''),\n    PolicySystemDefault=column_ifexists('PolicySystemDefault', ''),\n    PolicyRemediable=column_ifexists('PolicyaiRemediable', ''),\n    AlertRules=column_ifexists('AlertRules', ''),\n    RiskDetailRiskScoreScore=column_ifexists('RiskDetailRiskScoreScore', ''),\n    RiskDetailRiskScoreMaxScore=column_ifexists('RiskDetailRiskScoreMaxScore', ''),\n    RiskDetailRating=column_ifexists('RiskDetailRating', ''),\n    RiskDetailScore=column_ifexists('RiskDetailScore', ''),\n    Status=column_ifexists('Status', ''),\n    FirstSeen=column_ifexists('FirstSeen', ''),\n    LastSeen=column_ifexists('LastSeen', ''),\n    AlertTime=column_ifexists('AlertTime', ''),\n    ResourceId=iff(isnotempty(column_ifexists('ResourceId', '')), column_ifexists('ResourceId', ''), column_ifexists('ResourceId', ''))\n| project-rename\n    AlertMessage=policy_name_s,\n    AlertDescription=policy_description_s,\n    AlertSeverity=policy_severity_s,\n    PolicyRemediationCliScriptTemplate=policy_remediation_cliScriptTemplate_s,\n    ResourceDataPasswordLastUsed=resource_data_password_last_used_s,\n    ResourceDataAccessKey1Active=resource_data_access_key_1_active_b,\n    ResourceDataAccessKey2Active=resource_data_access_key_2_active_b,\n    ResourceDataCert1LastRotated=resource_data_cert_1_last_rotated_s,\n    ResourceDataCert2LastRotated=resource_data_cert_2_last_rotated_s,\n    ResourceDataPasswordLastChanged=resource_data_password_last_changed_s,\n    ResourceDataAccessKey1LastRotated=resource_data_access_key_1_last_rotated_t,\n    ResourceDataAccessKey2LastRotated=resource_data_access_key_2_last_rotated_s,\n    ResourceDataAccessKey1LastUsedDate=resource_data_access_key_1_last_used_date_t,\n    ResourceDataAccessKey2LastUsedDate=resource_data_access_key_2_last_used_date_s,\n    ResourceDataAccessKey1LastUsedRegion=resource_data_access_key_1_last_used_region_s,\n    ResourceDataAccessKey2LastUsedRegion=resource_data_access_key_2_last_used_region_s,\n    ResourceDataAccessKey1LastUsedService=resource_data_access_key_1_last_used_service_s,\n    ResourceDataAccessKey2LastUsedService=resource_data_access_key_2_last_used_service_s,\n    ResourceRrn=resource_rrn_s,\n    ResourceUrl=resource_url_s,\n    ResourceCloudType=resource_cloudType_s,\n    ResourceResourceTs=resource_resourceTs_d,\n    AlertId=id_s\n};\nunion isfuzzy=true (Alert_view), (Audit_view), (AlertLog_view),(AuditLog_view)\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'PaloAltoPrismaCloud Data Parser')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "PaloAltoPrismaCloud",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject1').huntingQueryTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAccessKeysUsed_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject1').huntingQueryVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Access keys used",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(30d)\n| where ResourceType =~ 'Login'\n| where EventMessage has 'access key'\n| summarize by UserName, SrcIpAddr\n| extend IPCustomEntity = SrcIpAddr\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for access keys used for programmatic access."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 1",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1)]",
                "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject1').huntingQueryVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Access keys used",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject2').huntingQueryTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudFailedLoginsSources_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject2').huntingQueryVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Top sources of failed logins",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where ResourceType =~ 'Login'\n| where EventMessage !has 'access key'\n| summarize count() by SrcIpAddr\n| order by count_ desc\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for top source IP addresses of failed logins."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 2",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2)]",
                "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject2').huntingQueryVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Top sources of failed logins",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject3').huntingQueryTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudFailedLoginsUsers_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject3').huntingQueryVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Top users by failed logins",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where ResourceType =~ 'Login'\n| where EventMessage !has 'access key'\n| summarize count() by UserName\n| order by count_ desc\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for users who have large number of failed logins."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 3",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3)]",
                "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject3').huntingQueryVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Top users by failed logins",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject4').huntingQueryTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudHighRiskScoreOpenedAlerts_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject4').huntingQueryVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - High risk score opened alerts",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| extend r_score = 0.85 * toint(RiskDetailRiskScoreMaxScore)\n| extend i_RiskDetailRiskScoreScore = toint(RiskDetailRiskScoreScore)\n| where i_RiskDetailRiskScoreScore > r_score\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for alerts with high risk score value."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 4",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4)]",
                "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject4').huntingQueryVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - High risk score opened alerts",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject5').huntingQueryTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudHighSeverityAlerts_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject5').huntingQueryVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - High severity alerts",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where Reason =~ 'NEW_ALERT'\n| where AlertSeverity =~ 'high'\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for high severity alerts."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 5",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5)]",
                "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject5').huntingQueryVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - High severity alerts",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject6').huntingQueryTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudNewUsers_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject6').huntingQueryVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - New users",
                "category": "Hunting Queries",
                "query": "let known_users = \nPaloAltoPrismaCloud\n| where TimeGenerated between (ago(30d) .. (1d))\n| where ResourceType =~ 'Login'\n| where EventMessage !has 'access key'\n| summarize makeset(UserName);\nPaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where ResourceType =~ 'Login'\n| where EventMessage !has 'access key'\n| where UserName !in (known_users)\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for new users."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 6",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6)]",
                "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject6').huntingQueryVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - New users",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject7').huntingQueryTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudOpenedAlerts_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject7').huntingQueryVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Opened alerts",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches opened alerts."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 7",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7)]",
                "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject7').huntingQueryVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Opened alerts",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject8').huntingQueryTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudTopResources_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject8').huntingQueryVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Top recources with alerts",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where Reason =~ 'NEW_ALERT'\n| summarize count() by ResourceName\n| order by count_ desc\n| extend AccountCustomEntity = ResourceName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for resources which appeared in different alerts."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 8",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8)]",
                "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject8').huntingQueryVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Top recources with alerts",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject9').huntingQueryTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudUpdatedResources_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject9').huntingQueryVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Updated resources",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where Reason =~ 'RESOURCE_UPDATED'\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches recently updated resources."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 9",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9)]",
                "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject9').huntingQueryVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Updated resources",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "Palo Alto Prisma Cloud CSPM (via Codeless Connector Framework)",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "PaloAltoPrismaCloudCSPMCCPDefinition",
                  "title": "Palo Alto Prisma Cloud CSPM (via Codeless Connector Framework)",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": "The Palo Alto Prisma Cloud CSPM data connector allows you to connect to your Palo Alto Prisma Cloud CSPM instance and ingesting Alerts (https://pan.dev/prisma-cloud/api/cspm/alerts/) & Audit Logs(https://pan.dev/prisma-cloud/api/cspm/audit-logs/) into Microsoft Sentinel.",
                  "graphQueriesTableName": "PaloAltoPrismaCloudAlertV2_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total Alerts received",
                      "legend": "Prisma Alert ",
                      "baseQuery": "{{graphQueriesTableName}}"
                    },
                    {
                      "metricName": "Total Audit received",
                      "legend": "Prisma Audit ",
                      "baseQuery": "PaloAltoPrismaCloudAuditV2_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Get Sample of Prisma Alerts Events",
                      "query": "{{graphQueriesTableName}}\n | take 10"
                    },
                    {
                      "description": "Get Sample of Prisma Alerts Events",
                      "query": "PaloAltoPrismaCloudAuditV2_CL\n | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n   | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "PaloAltoPrismaCloudAuditV2_CL",
                      "lastDataReceivedQuery": "PaloAltoPrismaCloudAuditV2_CL\n   | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "availability": {
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "To get more information on how to obtain the Prisma Cloud Access Key, Secret Key, and Base URL, please refer to the[connector tutorial](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAltoPrismaCloud/Data%20Connectors/Readme.md), provide the required information below and click on Connect.\n>",
                      "instructions": [
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Prisma Cloud Access Key",
                            "placeholder": "Enter Access Key",
                            "type": "text",
                            "name": "username"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Prisma Cloud Secret Key",
                            "placeholder": "Enter Secret Key",
                            "type": "password",
                            "name": "password"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Prisma Cloud Base URL",
                            "placeholder": "https://api2.eu.prismacloud.io",
                            "type": "text",
                            "name": "baseurl"
                          }
                        },
                        {
                          "parameters": {
                            "label": "toggle",
                            "name": "toggle"
                          },
                          "type": "ConnectionToggleButton"
                        },
                        {
                          "type": "DataConnectorsGrid",
                          "parameters": {
                            "mapping": [
                              {
                                "columnName": "PaloAltoPrismaCloudCSPM Api Endpoints",
                                "columnValue": "properties.request.apiEndpoint"
                              }
                            ]
                          }
                        }
                      ],
                      "title": "Connect Palo Alto Prisma Cloud CSPM Events to Microsoft Sentinel"
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "PaloAltoPrismaCloudCSPMDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-PaloAltoPrismaCloudAlert": {
                    "columns": [
                      {
                        "name": "id",
                        "type": "string"
                      },
                      {
                        "name": "status",
                        "type": "string"
                      },
                      {
                        "name": "reason",
                        "type": "string"
                      },
                      {
                        "name": "firstSeen",
                        "type": "real"
                      },
                      {
                        "name": "lastSeen",
                        "type": "real"
                      },
                      {
                        "name": "alertTime",
                        "type": "real"
                      },
                      {
                        "name": "lastUpdated",
                        "type": "real"
                      },
                      {
                        "name": "policyId",
                        "type": "string"
                      },
                      {
                        "name": "saveSearchId",
                        "type": "string"
                      },
                      {
                        "name": "metadata",
                        "type": "dynamic"
                      },
                      {
                        "name": "policy",
                        "type": "dynamic"
                      },
                      {
                        "name": "resource",
                        "type": "dynamic"
                      },
                      {
                        "name": "riskDetail",
                        "type": "dynamic"
                      },
                      {
                        "name": "alertRules",
                        "type": "string"
                      },
                      {
                        "name": "history",
                        "type": "string"
                      },
                      {
                        "name": "investigateOptions",
                        "type": "string"
                      }
                    ]
                  },
                  "Custom-PaloAltoPrismaCloudAudit": {
                    "columns": [
                      {
                        "name": "user",
                        "type": "string"
                      },
                      {
                        "name": "ipAddress",
                        "type": "string"
                      },
                      {
                        "name": "actionType",
                        "type": "string"
                      },
                      {
                        "name": "resourceName",
                        "type": "string"
                      },
                      {
                        "name": "action",
                        "type": "string"
                      },
                      {
                        "name": "resourceType",
                        "type": "string"
                      },
                      {
                        "name": "result",
                        "type": "string"
                      },
                      {
                        "name": "timestamp",
                        "type": "real"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-PaloAltoPrismaCloudAlert"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend ID =tostring(id) | extend Status =tostring(status) | extend Reason =tostring(reason) | extend FirstSeen = datetime_add('millisecond', tolong(firstSeen) * 1000, datetime(1970-01-01)) | extend LastSeen = datetime_add('millisecond', tolong(lastSeen) * 1000, datetime(1970-01-01)) | extend AlertTime = datetime_add('millisecond', tolong(alertTime) * 1000, datetime(1970-01-01)) | extend TimeGenerated = datetime_add('millisecond', tolong(lastUpdated) * 1000, datetime(1970-01-01)) | extend PolicyId=tostring(policyId) | extend policy = parse_json(policy)| extend resource= parse_json(resource)| extend metadata= parse_json(metadata)| extend riskDetail= parse_json(riskDetail)| extend SaveSearchId=tostring(saveSearchId) | extend Policy=todynamic(policy) | extend PolicyPolicyId=tostring(policy.policyId) | extend PolicyPolicyType=tostring(policy.policyType) | extend PolicyName=tostring(policy.name)| extend PolicyDescription=tostring(policy.description)| extend PolicySeverity=tostring(policy.severity)| extend PolicyRecommendation=tostring(policy.recommendation)| extend PolicyLabels=tostring(policy.labels)| extend PolicyDeleted=tobool(policy.deleted)| extend PolicyLastModifiedOn= datetime_add('millisecond', tolong(policy.lastModifiedOn) * 1000, datetime(1970-01-01))| extend PolicyLastModifiedBy= datetime_add('millisecond', tolong(policy.lastModifiedBy) * 1000, datetime(1970-01-01))| extend PolicySystemDefault=tobool(policy.systemDefault) | extend PolicyRemediationDescription =tostring(policy.remediation.description) | extend PolicyRemediationImpact=tostring(policy.remediation.impact) | extend PolicyRemediationcliScriptTemplate=tostring(policy.remediation.cliScriptTemplate) | extend PolicyaiRemediable=tobool(policy.aiRemediable) | extend PolicyFindingTypes=tostring(policy.findingTypes) | extend PolicyhasSearchExecutionSupport=tobool(policy.hasSearchExecutionSupport) | extend PolicyRemediable=tostring(policy.remediable) | extend MetadataRemediable=tobool(metadata.remediable) | extend Metadata=todynamic(metadata)| extend AlertRules=tostring(alertRules) | extend History=tostring(history) | extend Resource=todynamic(resource) | extend Resourcerrn=tostring(resource.rrn) | extend ResourceId=tostring(resource.id) | extend ResourceName=tostring(resource.name) | extend ResourceAccount=tostring(resource.account) | extend ResourceAccountId=tostring(resource.accountId) | extend ResourceCloudAccountGroups=tostring(resource.cloudAccountGroups) | extend ResourceRegion=tostring(resource.region) | extend ResourceRegionId=tostring(resource.regionId)| extend ResourceDataArn=tostring(resource.data.arn) | extend ResourceDataUser=tostring(resource.data.user)| extend ResourceResourceType=tostring(resource.resourceType) | extend ResourceDataUserCreationTime= datetime_add('millisecond', tolong(resource.data.user.creationtime) * 1000, datetime(1970-01-01))| extend ResourceResourceApiName=tostring(resource.resourceApiName) | extend ResourceCloudServiceName=tostring(resource.cloudServiceName) | extend Resourceurl=tostring(resource.url) | extend ResourceDataTags=tostring(resource.data.tags) | extend ResourceDataAccesskey1Active=tobool(resource.data.access_key_1_active) | extend ResourceDataAccesskey1LastRotated= datetime_add('millisecond', tolong(resource.data.access_key_1_last_rotated) * 1000, datetime(1970-01-01)) | extend ResourceDataAccesskey1LastUsedDate= datetime_add('millisecond', tolong(resource.data.access_key_1_last_used_date) * 1000, datetime(1970-01-01)) | extend ResourceDataAccesskey1LastUsedRegion=tostring(resource.data.access_key_1_last_used_region) | extend  ResourceDataAccesskey1LastUsedService=tostring(resource.data.access_key_1_last_used_service) | extend ResourceDataAccesskey2Active=tobool(resource.data.access_key_2_active) | extend ResourceDataAccesskey2LastRotated= datetime_add('millisecond', tolong(resource.data.access_key_2_last_rotated) * 1000, datetime(1970-01-01)) | extend ResourceDataAccesskey2LastUsedDate= datetime_add('millisecond', tolong(resource.data.access_key_2_last_used_date) * 1000, datetime(1970-01-01)) | extend ResourceDataAccesskey2LastUsedRegion=tostring(resource.data.access_key_2_last_used_region) | extend ResourceDataAccesskey2LastUsedService=tostring(resource.data.access_key_2_last_used_service) | extend ResourceDataCert1Active=tobool(resource.data.cert_1_active) | extend ResourceDatacert1LastRotated= datetime_add('millisecond', tolong(resource.data.cert_1_last_rotated) * 1000, datetime(1970-01-01)) | extend ResourceDataCert2Active=tobool(resource.data.cert_2_active) | extend ResourceDatacert2LastRotated= datetime_add('millisecond', tolong(resource.data.cert_2_last_rotated) * 1000, datetime(1970-01-01)) | extend ResourceDataMfaActive=tobool(resource.data.mfa_active) | extend ResourceDataPasswordEnabled=tobool(resource.data.password_enabled) | extend ResourceDatapasswordLastChanged= datetime_add('millisecond', tolong(resource.data.password_last_changed) * 1000, datetime(1970-01-01)) | extend ResourceDatapasswordLastUsed= datetime_add('millisecond', tolong(resource.data.password_last_used) * 1000, datetime(1970-01-01)) | extend ResourceDataPasswordNextRotation= datetime_add('millisecond', tolong(resource.data.password_next_rotation) * 1000, datetime(1970-01-01)) | extend ResourceDataState=tostring(resource.data.state) | extend ResourceDatavpcId=tostring(resource.data.vpcId) | extend ResourceDataIsShared=tobool(resource.data.isShared) | extend ResourceDataGroupName=tostring(resource.data.groupName) | extend ResourceDataipPermissions=tostring(resource.data.ipPermissions) | extend ResourceDataipPermissionsEgress=tostring(resource.data.ipPermissionsEgress) | extend ResourceDataSecurityGroupArn=tostring(resource.data.securityGroupArn) | extend ResourceDataOwnerId=tostring(resource.data.ownerId) | extend ResourceDataSubnetId=tostring(resource.data.subnetId) | extend ResourceDatacidrBlock=tostring(resource.data.cidrBlock) | extend ResourceDataSubnetArn=tostring(resource.data.subnetArn) | extend ResourceDataDefaultForAz=tobool(resource.data.defaultForAz) | extend ResourceDataAvailabilityZone=tostring(resource.data.availabilityZone) | extend ResourceDataAvailabilityZoneId=tostring(resource.data.availabilityZoneId) | extend ResourceDataMapPublicIpOnLaunch=tobool(resource.data.mapPublicIpOnLaunch) | extend ResourceDataBlockPublicAccessStates=tostring(resource.data.blockPublicAccessStates) | extend ResourceDataMapCustomerOwnedIpOnLaunch=tostring(resource.data.mapCustomerOwnedIpOnLaunch) | extend ResourceDataAssignIpv6AddressOnCreation=tostring(resource.data.assignIpv6AddressOnCreation) | extend ResourceDataipv6CidrBlockAssociationSet=tostring(resource.data.ipv6CidrBlockAssociationSet) | extend ResourceDataAdditionalInfo=tostring(resource.data.additionalInfo) | extend ResourceDataCloudType=tostring(resource.data.cloudType) | extend ResourceDataResourceTs= datetime_add('millisecond', tolong(resource.data.resourceTs) * 1000, datetime(1970-01-01)) | extend ResourceDataUnifiedAssetId=tostring(resource.data.unifiedAssetId) | extend ResourceDataResourceConfigJsonAvailable=tobool(resource.data.resourceConfigJsonAvailable) | extend ResourceDataResourceDetailsAvailable=tobool(resource.data.resourceDetailsAvailable) | extend InvestigateOptions=tostring(investigateOptions) | extend ResourceAdditionalInfoAccessKeyAge= datetime_add('millisecond', tolong(resource.additionalInfo.accessKeyAge) * 1000, datetime(1970-01-01)) | extend ResourceAdditionalInfoInactiveSinceTs= datetime_add('millisecond', tolong(resource.additionalInfo.inactiveSinceTs) * 1000, datetime(1970-01-01)) | extend RiskDetailRiskScoreScore=tostring(riskDetail.riskScore.score) | extend RiskDetailRiskScoreMaxScore=tostring(riskDetail.riskScore.maxScore) | extend RiskDetailRating=tostring(riskDetail.rating) | extend RiskDetailScore=tostring(riskDetail.score) | project ID,Status,Reason,FirstSeen,LastSeen,AlertTime,TimeGenerated,PolicyId,SaveSearchId,Policy,PolicyPolicyId,PolicyPolicyType,PolicySystemDefault,PolicyRemediationDescription,PolicyRemediationImpact,PolicyRemediationcliScriptTemplate,PolicyaiRemediable,PolicyFindingTypes,PolicyhasSearchExecutionSupport,PolicyRemediable,MetadataRemediable,PolicyName,Metadata,AlertRules,PolicyDescription,PolicySeverity,PolicyRecommendation,PolicyLabels,PolicyDeleted,PolicyLastModifiedOn,PolicyLastModifiedBy,History,Resource,Resourcerrn,ResourceId,ResourceName,ResourceAccount,ResourceAccountId,ResourceCloudAccountGroups,ResourceRegion,ResourceRegionId,ResourceResourceType,ResourceResourceApiName,ResourceCloudServiceName,ResourceDataArn,ResourceDataUser,ResourceDataUserCreationTime,Resourceurl,ResourceDataTags,ResourceDataAccesskey1Active,ResourceDataAccesskey1LastRotated,ResourceDataAccesskey1LastUsedDate,ResourceDataAccesskey1LastUsedRegion,ResourceDataAccesskey1LastUsedService,ResourceDataAccesskey2Active,ResourceDataAccesskey2LastRotated,ResourceDataAccesskey2LastUsedDate,ResourceDataAccesskey2LastUsedRegion,ResourceDataAccesskey2LastUsedService,ResourceDataCert1Active,ResourceDatacert1LastRotated,ResourceDataCert2Active,ResourceDatacert2LastRotated,ResourceDataMfaActive,ResourceDataPasswordEnabled,ResourceDatapasswordLastChanged,ResourceDatapasswordLastUsed,ResourceDataPasswordNextRotation,ResourceDataState,ResourceDatavpcId,ResourceDataIsShared,ResourceDataGroupName,ResourceDataipPermissions,ResourceDataipPermissionsEgress,ResourceDataSecurityGroupArn,ResourceDataOwnerId,ResourceDataSubnetId,ResourceDatacidrBlock,ResourceDataSubnetArn,ResourceDataDefaultForAz,ResourceDataAvailabilityZone,ResourceDataAvailabilityZoneId,ResourceDataMapPublicIpOnLaunch,ResourceDataBlockPublicAccessStates,ResourceDataMapCustomerOwnedIpOnLaunch, ResourceDataAssignIpv6AddressOnCreation,ResourceDataipv6CidrBlockAssociationSet,ResourceDataAdditionalInfo,ResourceDataCloudType,ResourceDataResourceTs,ResourceDataUnifiedAssetId,ResourceDataResourceConfigJsonAvailable,ResourceDataResourceDetailsAvailable,InvestigateOptions,ResourceAdditionalInfoAccessKeyAge,ResourceAdditionalInfoInactiveSinceTs,RiskDetailRiskScoreScore,RiskDetailRiskScoreMaxScore,RiskDetailRating,RiskDetailScore",
                    "outputStream": "Custom-PaloAltoPrismaCloudAlertV2_CL"
                  },
                  {
                    "streams": [
                      "Custom-PaloAltoPrismaCloudAudit"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend User =tostring(user) | extend IPAddress =tostring(ipAddress) | extend ActionType=tostring(actionType) | extend TimeGenerated = datetime_add('millisecond', tolong(timestamp) * 1000, datetime(1970-01-01)) | extend ResourceName=tostring(resourceName) | extend Action=tostring(action) | extend ResourceType=tostring(resourceType) | extend Result=tostring(result) | project User,IPAddress,ActionType,TimeGenerated,ResourceName,Action,ResourceType,Result",
                    "outputStream": "Custom-PaloAltoPrismaCloudAuditV2_CL"
                  }
                ]
              }
            },
            {
              "name": "PaloAltoPrismaCloudAlertV2_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "PaloAltoPrismaCloudAlertV2_CL",
                  "columns": [
                    {
                      "name": "ID",
                      "type": "string"
                    },
                    {
                      "name": "Status",
                      "type": "string"
                    },
                    {
                      "name": "Reason",
                      "type": "string"
                    },
                    {
                      "name": "FirstSeen",
                      "type": "datetime"
                    },
                    {
                      "name": "LastSeen",
                      "type": "datetime"
                    },
                    {
                      "name": "AlertTime",
                      "type": "datetime"
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "PolicyId",
                      "type": "string"
                    },
                    {
                      "name": "SaveSearchId",
                      "type": "string"
                    },
                    {
                      "name": "Policy",
                      "type": "dynamic"
                    },
                    {
                      "name": "Metadata",
                      "type": "dynamic"
                    },
                    {
                      "name": "PolicyPolicyId",
                      "type": "string"
                    },
                    {
                      "name": "PolicyPolicyType",
                      "type": "string"
                    },
                    {
                      "name": "PolicySystemDefault",
                      "type": "bool"
                    },
                    {
                      "name": "PolicyRemediationDescription",
                      "type": "string"
                    },
                    {
                      "name": "PolicyRemediationImpact",
                      "type": "string"
                    },
                    {
                      "name": "PolicyRemediationcliScriptTemplate",
                      "type": "string"
                    },
                    {
                      "name": "PolicyaiRemediable",
                      "type": "bool"
                    },
                    {
                      "name": "PolicyFindingTypes",
                      "type": "string"
                    },
                    {
                      "name": "PolicyhasSearchExecutionSupport",
                      "type": "bool"
                    },
                    {
                      "name": "PolicyName",
                      "type": "string"
                    },
                    {
                      "name": "PolicyDescription",
                      "type": "string"
                    },
                    {
                      "name": "PolicySeverity",
                      "type": "string"
                    },
                    {
                      "name": "PolicyRecommendation",
                      "type": "string"
                    },
                    {
                      "name": "PolicyLabels",
                      "type": "string"
                    },
                    {
                      "name": "PolicyDeleted",
                      "type": "bool"
                    },
                    {
                      "name": "PolicyLastModifiedOn",
                      "type": "datetime"
                    },
                    {
                      "name": "PolicyLastModifiedBy",
                      "type": "datetime"
                    },
                    {
                      "name": "PolicyRemediable",
                      "type": "string"
                    },
                    {
                      "name": "MetadataRemediable",
                      "type": "bool"
                    },
                    {
                      "name": "AlertRules",
                      "type": "string"
                    },
                    {
                      "name": "History",
                      "type": "string"
                    },
                    {
                      "name": "Resource",
                      "type": "dynamic"
                    },
                    {
                      "name": "Resourcerrn",
                      "type": "string"
                    },
                    {
                      "name": "ResourceId",
                      "type": "string"
                    },
                    {
                      "name": "ResourceName",
                      "type": "string"
                    },
                    {
                      "name": "ResourceAccount",
                      "type": "string"
                    },
                    {
                      "name": "ResourceAccountId",
                      "type": "string"
                    },
                    {
                      "name": "ResourceCloudAccountGroups",
                      "type": "string"
                    },
                    {
                      "name": "ResourceRegion",
                      "type": "string"
                    },
                    {
                      "name": "ResourceRegionId",
                      "type": "string"
                    },
                    {
                      "name": "ResourceResourceType",
                      "type": "string"
                    },
                    {
                      "name": "ResourceResourceApiName",
                      "type": "string"
                    },
                    {
                      "name": "ResourceCloudServiceName",
                      "type": "string"
                    },
                    {
                      "name": "Resourceurl",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataArn",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataUser",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataUserCreationTime",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDataTags",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataAccesskey1Active",
                      "type": "bool"
                    },
                    {
                      "name": "ResourceDataAccesskey1LastRotated",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDataAccesskey1LastUsedDate",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDataAccesskey1LastUsedRegion",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataAccesskey1LastUsedService",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataAccesskey2Active",
                      "type": "bool"
                    },
                    {
                      "name": "ResourceDataAccesskey2LastRotated",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDataAccesskey2LastUsedDate",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDataAccesskey2LastUsedRegion",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataAccesskey2LastUsedService",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataCert1Active",
                      "type": "bool"
                    },
                    {
                      "name": "ResourceDatacert1LastRotated",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDataCert2Active",
                      "type": "bool"
                    },
                    {
                      "name": "ResourceDatacert2LastRotated",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDataMfaActive",
                      "type": "bool"
                    },
                    {
                      "name": "ResourceDataPasswordEnabled",
                      "type": "bool"
                    },
                    {
                      "name": "ResourceDatapasswordLastChanged",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDatapasswordLastUsed",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDataPasswordNextRotation",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDataState",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDatavpcId",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataIsShared",
                      "type": "bool"
                    },
                    {
                      "name": "ResourceDataGroupName",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataipPermissions",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataipPermissionsEgress",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataSecurityGroupArn",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataOwnerId",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataSubnetId",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDatacidrBlock",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataSubnetArn",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataDefaultForAz",
                      "type": "bool"
                    },
                    {
                      "name": "ResourceDataAvailabilityZone",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataAvailabilityZoneId",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataMapPublicIpOnLaunch",
                      "type": "bool"
                    },
                    {
                      "name": "ResourceDataBlockPublicAccessStates",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataMapCustomerOwnedIpOnLaunch",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataAssignIpv6AddressOnCreation",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataipv6CidrBlockAssociationSet",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataAdditionalInfo",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataCloudType",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataResourceTs",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceDataUnifiedAssetId",
                      "type": "string"
                    },
                    {
                      "name": "ResourceDataResourceConfigJsonAvailable",
                      "type": "bool"
                    },
                    {
                      "name": "ResourceDataResourceDetailsAvailable",
                      "type": "bool"
                    },
                    {
                      "name": "InvestigateOptions",
                      "type": "string"
                    },
                    {
                      "name": "ResourceAdditionalInfoAccessKeyAge",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceAdditionalInfoInactiveSinceTs",
                      "type": "datetime"
                    },
                    {
                      "name": "RiskDetailRiskScoreScore",
                      "type": "string"
                    },
                    {
                      "name": "RiskDetailRiskScoreMaxScore",
                      "type": "string"
                    },
                    {
                      "name": "RiskDetailRating",
                      "type": "string"
                    },
                    {
                      "name": "RiskDetailScore",
                      "type": "string"
                    }
                  ]
                }
              }
            },
            {
              "name": "PaloAltoPrismaCloudAuditV2_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "PaloAltoPrismaCloudAuditV2_CL",
                  "columns": [
                    {
                      "name": "User",
                      "type": "string"
                    },
                    {
                      "name": "IPAddress",
                      "type": "string"
                    },
                    {
                      "name": "ActionType",
                      "type": "string"
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "ResourceName",
                      "type": "string"
                    },
                    {
                      "name": "Action",
                      "type": "string"
                    },
                    {
                      "name": "ResourceType",
                      "type": "string"
                    },
                    {
                      "name": "Result",
                      "type": "string"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "PaloAltoPrismaCloudCSPMCCPDefinition",
          "title": "Palo Alto Prisma Cloud CSPM (via Codeless Connector Framework)",
          "publisher": "Microsoft",
          "descriptionMarkdown": "The Palo Alto Prisma Cloud CSPM data connector allows you to connect to your Palo Alto Prisma Cloud CSPM instance and ingesting Alerts (https://pan.dev/prisma-cloud/api/cspm/alerts/) & Audit Logs(https://pan.dev/prisma-cloud/api/cspm/audit-logs/) into Microsoft Sentinel.",
          "graphQueriesTableName": "PaloAltoPrismaCloudAlertV2_CL",
          "graphQueries": [
            {
              "metricName": "Total Alerts received",
              "legend": "Prisma Alert ",
              "baseQuery": "{{graphQueriesTableName}}"
            },
            {
              "metricName": "Total Audit received",
              "legend": "Prisma Audit ",
              "baseQuery": "PaloAltoPrismaCloudAuditV2_CL"
            }
          ],
          "sampleQueries": [
            {
              "description": "Get Sample of Prisma Alerts Events",
              "query": "{{graphQueriesTableName}}\n | take 10"
            },
            {
              "description": "Get Sample of Prisma Alerts Events",
              "query": "PaloAltoPrismaCloudAuditV2_CL\n | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n   | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "PaloAltoPrismaCloudAuditV2_CL",
              "lastDataReceivedQuery": "PaloAltoPrismaCloudAuditV2_CL\n   | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "availability": {
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "To get more information on how to obtain the Prisma Cloud Access Key, Secret Key, and Base URL, please refer to the[connector tutorial](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAltoPrismaCloud/Data%20Connectors/Readme.md), provide the required information below and click on Connect.\n>",
              "instructions": [
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "Prisma Cloud Access Key",
                    "placeholder": "Enter Access Key",
                    "type": "text",
                    "name": "username"
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "Prisma Cloud Secret Key",
                    "placeholder": "Enter Secret Key",
                    "type": "password",
                    "name": "password"
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "Prisma Cloud Base URL",
                    "placeholder": "https://api2.eu.prismacloud.io",
                    "type": "text",
                    "name": "baseurl"
                  }
                },
                {
                  "parameters": {
                    "label": "toggle",
                    "name": "toggle"
                  },
                  "type": "ConnectionToggleButton"
                },
                {
                  "type": "DataConnectorsGrid",
                  "parameters": {
                    "mapping": [
                      {
                        "columnName": "PaloAltoPrismaCloudCSPM Api Endpoints",
                        "columnValue": "properties.request.apiEndpoint"
                      }
                    ]
                  }
                }
              ],
              "title": "Connect Palo Alto Prisma Cloud CSPM Events to Microsoft Sentinel"
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "Palo Alto Prisma Cloud CSPM (via Codeless Connector Framework)",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "connectorDefinitionName": {
              "defaultValue": "Palo Alto Prisma Cloud CSPM (via Codeless Connector Framework)",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "username": {
              "defaultValue": "username",
              "type": "securestring",
              "minLength": 1
            },
            "password": {
              "defaultValue": "password",
              "type": "securestring",
              "minLength": 1
            },
            "baseurl": {
              "defaultValue": "baseurl",
              "type": "securestring",
              "minLength": 1
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'PaloAltoPrismaCloudAlert', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "PaloAltoPrismaCloudCSPMCCPDefinition",
                "dataType": "PaloAltoPrismaCloudAlertV2_CL",
                "dcrConfig": {
                  "streamName": "Custom-PaloAltoPrismaCloudAlert",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                  "type": "JwtToken",
                  "userName": {
                    "key": "username",
                    "value": "[[parameters('username')]"
                  },
                  "password": {
                    "key": "password",
                    "value": "[[parameters('password')]"
                  },
                  "IsJsonRequest": true,
                  "JwtTokenJsonPath": "$.token",
                  "TokenEndpoint": "[[concat(parameters('baseurl'),'/login')]"
                },
                "request": {
                  "apiEndpoint": "[[concat(parameters('baseurl'),'/v2/alert')]",
                  "queryWindowInMin": 10,
                  "httpMethod": "POST",
                  "queryTimeFormat": "UnixTimestampInMills",
                  "retryCount": 3,
                  "timeoutInSeconds": 60,
                  "headers": {
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "isPostPayloadJson": true,
                  "queryParametersTemplate": "{\"detailed\": true,\"filters\": [{\"name\": \"timeRange.type\",\"operator\": \"=\",\"value\": \"ALERT_STATUS_UPDATED\"}],\"timeRange\": {\"type\": \"absolute\",\"value\": {\"endTime\": {_QueryWindowEndTime},\"startTime\": {_QueryWindowStartTime}}}}"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.items"
                  ]
                },
                "paging": {
                  "pagingType": "NextPageToken",
                  "NextPageTokenJsonPath": "$.items.next_page_token",
                  "NextPageParaName": "$.request_data.next_page_token"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'PaloAltoPrismaCloudAudit', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "PaloAltoPrismaCloudCSPMCCPDefinition",
                "dataType": "PaloAltoPrismaCloudAuditV2_CL",
                "dcrConfig": {
                  "streamName": "Custom-PaloAltoPrismaCloudAudit",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                  "type": "JwtToken",
                  "userName": {
                    "key": "username",
                    "value": "[[parameters('username')]"
                  },
                  "password": {
                    "key": "password",
                    "value": "[[parameters('password')]"
                  },
                  "IsJsonRequest": true,
                  "JwtTokenJsonPath": "$.token",
                  "TokenEndpoint": "[[concat(parameters('baseurl'),'/login')]"
                },
                "request": {
                  "apiEndpoint": "[[concat(parameters('baseurl'),'/audit/redlock')]",
                  "queryWindowInMin": 10,
                  "httpMethod": "GET",
                  "queryTimeFormat": "UnixTimestampInMills",
                  "retryCount": 3,
                  "timeoutInSeconds": 60,
                  "headers": {
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "isPostPayloadJson": true,
                  "queryParameters": {
                    "timeType": "relative",
                    "timeAmount": "10",
                    "timeUnit": "minute"
                  }
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ]
                },
                "paging": {
                  "pagingType": "NextPageToken",
                  "NextPageTokenJsonPath": "null"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PrismaCloudCSPMCustomConnector Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "CustomConnectorName": {
              "defaultValue": "PrismaCloudCSPMCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same in all Prisma Cloud automation playbooks as well"
              }
            },
            "PrismaCloudAPIURL": {
              "type": "String",
              "metadata": {
                "description": "Check documentation of prisma cloud for Actual API url (https://prisma.pan.dev/api/cloud/api-urls) . Note: Do NOT prefix with https:// or http:// etc"
              }
            }
          },
          "variables": {
            "api_host": "[[replace(replace(parameters('PrismaCloudAPIURL'),'https://',''),'http://','')]",
            "ServiceName": "[[concat('https://', variables('api_host'))]",
            "operationId-RefreshToken": "RefreshToken",
            "_operationId-RefreshToken": "[[variables('operationId-RefreshToken')]",
            "operationId-LoginGenerateToken": "LoginGenerateToken",
            "_operationId-LoginGenerateToken": "[[variables('operationId-LoginGenerateToken')]",
            "operationId-AssetInventoryViewV2": "AssetInventoryViewV2",
            "_operationId-AssetInventoryViewV2": "[[variables('operationId-AssetInventoryViewV2')]",
            "operationId-AssetInventoryTrendViewV2": "AssetInventoryTrendViewV2",
            "_operationId-AssetInventoryTrendViewV2": "[[variables('operationId-AssetInventoryTrendViewV2')]",
            "operationId-AssetsResourceScan": "AssetsResourceScan",
            "_operationId-AssetsResourceScan": "[[variables('operationId-AssetsResourceScan')]",
            "operationId-AssetsEnrichment": "AssetsEnrichment",
            "_operationId-AssetsEnrichment": "[[variables('operationId-AssetsEnrichment')]",
            "operationId-ListAlerts": "ListAlerts",
            "_operationId-ListAlerts": "[[variables('operationId-ListAlerts')]",
            "operationId-GetAlertInfo": "GetAlertInfo",
            "_operationId-GetAlertInfo": "[[variables('operationId-GetAlertInfo')]",
            "operationId-GetAnomalyTrustedList": "GetAnomalyTrustedList",
            "_operationId-GetAnomalyTrustedList": "[[variables('operationId-GetAnomalyTrustedList')]",
            "operationId-AddEntriesToAnomalyTrustedList": "AddEntriesToAnomalyTrustedList",
            "_operationId-AddEntriesToAnomalyTrustedList": "[[variables('operationId-AddEntriesToAnomalyTrustedList')]",
            "operationId-ListRemediationCommand": "ListRemediationCommand",
            "_operationId-ListRemediationCommand": "[[variables('operationId-ListRemediationCommand')]",
            "operationId-RemediateAlert": "RemediateAlert",
            "_operationId-RemediateAlert": "[[variables('operationId-RemediateAlert')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId1": "PrismaCloudCSPMCustomConnector",
            "playbookId1": "[[resourceId('Microsoft.Web/customApis', parameters('CustomConnectorName'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('CustomConnectorName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "capabilities": "[variables('TemplateEmptyArray')]",
                "description": "[[concat(parameters('CustomConnectorName'),' connects to Prisma Cloud CSPM services end point to runs any Prisma supported API get/post/patch calls and gives response back in JSON format. \n\nNote: For better understanding , check https://prisma.pan.dev/api/cloud/cspm/')]",
                "displayName": "[[parameters('CustomConnectorName')]",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANMAAAEACAYAAAAp2kPsAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAJOgAACToAYJjBRwAAAOWaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0OCA3OS4xNjM4NTgsIDIwMTkvMDMvMDYtMDM6MTg6MzYgICAgICAgICI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczpkYW09Imh0dHA6Ly93d3cuZGF5LmNvbS9kYW0vMS4wIgogICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIGRhbTpQaHlzaWNhbGhlaWdodGluaW5jaGVzPSIzLjU1NjM2NTcyODM3ODI5NiIKICAgZGFtOlBoeXNpY2Fsd2lkdGhpbmluY2hlcz0iMTcuNjE1MTIzNzQ4Nzc5Mjk3IgogICBkYW06RmlsZWZvcm1hdD0iUE5HIgogICBkYW06UHJvZ3Jlc3NpdmU9Im5vIgogICBkYW06Qml0c3BlcnBpeGVsPSIzMiIKICAgZGFtOk1JTUV0eXBlPSJpbWFnZS9wbmciCiAgIGRhbTpQaHlzaWNhbHdpZHRoaW5kcGk9IjcyIgogICBkYW06UGh5c2ljYWxoZWlnaHRpbmRwaT0iNzIiCiAgIGRhbTpOdW1iZXJvZmltYWdlcz0iMSIKICAgZGFtOk51bWJlcm9mdGV4dHVhbGNvbW1lbnRzPSIwIgogICB0aWZmOkltYWdlTGVuZ3RoPSIyNTYiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMTI2OCIKICAgZGM6Zm9ybWF0PSJpbWFnZS9wbmciCiAgIGRjOm1vZGlmaWVkPSIyMDIxLTA2LTE1VDA1OjE1OjAxLjQxMy0wNzowMCIvPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PnDSuR8AAAoUSURBVHhe7d1LjlzlHYbxcoOAGAMW8iBSIhkpA4ZkCbADlgArSFiB8QpwVkCWwA6AHcCQQSQsORIDhAwYEoOJ49d1Du6ursu5fJf/5flJFlU9Qb48evuc8nd85fETG6Rw/9HjzRcPft28ff2F4Sso6Wz4L4JTSO98+d3ms/u/DF9BacSUwBjSFw8eDV9BDcQUHCG1Q0yBEVJbxBQUIbVHTAERUh/EFAwh9UNMgRBSX8QUBCH1R0wBEJINxOQcIdlBTI4Rki3E5BQh2UNMDhGSTcTkDCHZRUyOEJJtxOQEIdlHTA4Qkg/EZBwh+UFMhhGSL8RkFCH5Q0wGEZJPxGQMIflFTIYQkm/EZAQh+UdMBhBSDMTUGSHFQUwdEVIsxNQJIcVDTB0QUkzE1BghxUVMDRFSbMTUCCHFR0wNEFIOxFQZIeVBTBURUi7EVAkh5UNMFRBSTsRUGCHlRUwFEVJuxFQIIYGYCiAkCDGtREgYEdMKhITziGkhQsIuYlqAkLAPMc1ESDiEmGYgJBxDTBMREk4hpgkICVMQ0wmEhKmI6YiIId19+L/hFUojpgMihnT9+Subz+7/svn6v78NX0FJxLRH1G/t/vanq5s3Xnpuc/vuT8NXUBIx7Ygaklbp739++enrf37zH9apAmI6J/LNBq2SghqxTuUR0yBySOdXaaR1ivhz7YmYnogckuyu0uiDf/04vEIJ6WOKHpJuOOyu0kh39vQDZaSOKXpIcuvmy3tXacS1UzlpY8oQklbpvT/+YXi3H+tUTsqYMoQkWqUpWKcy0sWUJaQpqzTSMn3y7cPhHZZKFVOWkOSjv7wyvJqGO3vrpYkpU0hvX39h8+6NF4d30+hvROizJyyXIqZMIcnUa6VdXDutEz6mbCFplfRjCdZpndAxZQtJlq7SSOukXzfMFzamjCGtWaWR1unOPb7dWyJkTBlDkrl38A75x79/Zp0WCBdT1pD0mdJfrz0/vFtHv4as03yhYsoakqy9VtrFOs0XJqbMIWmV9DceSmKd5gsRU+aQpPQqjbROHG+fzn1M2UOqsUoj/dryQe50rmPKHpLOKZW6g3cID1+Zzm1M2UOSQ8fRS2OdpnEZEyHtf0hKLazTNO5iIqStVqs0Yp1OcxUTIW21XKWR1onj7ce5iYmQnrl181rTVRqxTse5iImQntk+uuvq8K4tHr5ynPmYCOmiWh/QTsU6HWY6JkK6aM5DUmphnQ4zGxMhXdZ7lUY8fGU/kzER0mUWVmmk3xeOt19mLiZC2u/jN18dXtnAtdNlpmIipP1KHEcvjYevXGYmJkI6zMq10i7W6SITMRHSYRZXacQ6XdQ9JkI6zuoqjXRnT7+H6BwTIR1neZVG+j3kePtWt5gI6TRrd/AO4eErW11iIqTTah5HL4112moeEyFNY/1aaRfr1DgmQprG0yqNWKeGMRHSdN5WaaTPnTIfb28SEyFNp5C8rdJ5mT/IrR4TIU3X4zh6aZkfvlI1JkKap/VDUmrJuk7VYiKkeSKs0ijrOlWJiZDmi7JKo/e/+mF4lUfxmAhpvkirNMp4vL1oTIS0jJ4XHmmVRtmunYrFREjLWDqOXlq2dSoSEyEt5/UD2qkyrdPqmAhpucirNMq0TqtiIqR1oq/SKMudvcUxEdI6+pfRo6/SKMvx9kUxEdJ6tf/FP2syXDvNjomQ1vNwHL20DOs0KyZCKiPLtdKu6Os0OSZCKiPjKo20Tnfu/Ty8i2dSTIRUTtZVGt2+++Dpn6eITsZESOXo7l3WVRrpz1PU4+1HYyKksrKv0ijqw1cOxkRIZXl8SEotUddpb0yEVB6rdFHEdboUEyGVxypdpj9n0f4FwgsxEVJ5OqfEKu0X7Xj77zERUh06js4qHRbpg9ynMRFSHRGPo5cWaZ3OCKmeaA9JqSXKOp0RUh2s0nRapwh/Bs8IqQ5WaZ4Id/b2fs6EdXTDgVWaJ8LxdmKqQLfCWaX5vF87EVNhGR6SUov3dSKmwviAdh3P60RMBbFK62mZvB5vP+N7+3KyPSSlFq/rdPbpW69zsVyADv29e+PF4R3W8PrwlTM9v42g1uNaqSyP6/T0momg1sn8kJRaPK7T7zcgCGo5VqkOrZP+7qgXF+7mEdR8rFI920eD+fl279KtcYKahzt4dXk63r73cyaCmkafKenXCvUoJC/rtDcmIajTuFZqw8s6HYxJCOowHpLSjpd1OhqTENR+rFJbWifrx9tPxiQEdRGr1J7WyfoHuZNiEoLa0s+fO3h9WH/4yuSYhKA4jt6b5XWaFZNkDko/Z46j92V5nWbHJFmDYpVssPrwlUUxSbagWCU7Pvn2ocnj7YtjkkxB3bp5jVUyxOK106qYJENQ20d3XR3ewQKLD19ZHZNED4oPaG2ytk5FYpKoQfGQFLusrVOxmCRiUKySbZbu7BWNSSIFxSrZp2flWzneXjwmiRLUx2++OryCZVaunarEJN6D4ji6H1YevlItJvEcFNdKvlhYp6oxicegWCV/LKxT9ZjEW1Cskk+6s9fzeHuTmMRLUKySX72PtzeLSTwExR0833o+fKVpTGI5KI6j+9dznZrHJFaD4lophl7r1CUmsRYUqxSHQrp998Hwrp1uMYmloFilWO7ca/9osK4xiYWgFBKrFE/rD3K7xyQ9g9L/k+PoMbV++IqJmKRXUDwkJbaW62QmJmkdFKsUX8t1MhWTtAyKVcrh/a9+GF7VdeXxE8NrU3To650vv6v6eYEekvLac7li+vz7X4dXuehvttS+yWQ2JmkRVDa6c/nhG9eGdyjJ3Ld551m4bQ5MZTomISh4YT4mISh44CImIShY5yYmIShY5iomIShY5S4mIShY5DImIShY4zYmIShY4jomIShY4T4mIShYECImISj0FiYmISj0FComISj0Ei4mISj0EDImISi0FjYmISi0FDomISi0Ej4mISi0kCImISjUliYmISjUlComISjUki4mISjUkDImISiUljYmISiUlDomISiUkj4mISiUQEwDgsJaxHQOQWENYtpBUFiKmPYgKCxBTAcQFOYipiMICnMQ0wkEhamIaQKCwhTENBFB4RRimoGgcAwxzURQOISYFiAo7ENMCxEUdhHTCgSF84hpJYLCiJgKICgIMRVCUCCmgggqN2IqjKDyIqYKCConYqqEoPIhpooIKhdiqoyg8iCmBggqB2JqhKDiI6aGCCo2YmqMoOIipg4IKiZi6oSg4iGmjggqFmLqjKDiICYDCCoGYjKCoPwjJkMIyjdiMoag/CImgwjKJ2IyiqD8ISbDCMoXYjKOoPwgJgcIygdicoKg7CMmRwjKNmJyhqDsIiaHCMomYnKKoOwhJscIyhZico6g7CCmAAjKBmIKgqD6I6ZACKovYgqGoPohpoAIqg9iCoqg2iOmwAiqLWIKjqDaIaYECKoNYkriWVD8ltex2fwfs//NjmqcgcgAAAAASUVORK5CYII=",
                "backendService": {
                  "serviceUrl": "[[variables('ServiceName')]"
                },
                "apiType": "Rest",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "version": "1.0.0",
                    "title": "Prisma Cloud",
                    "description": "This custom connector connects to Prisma Cloud CSPM services end point to runs any Prisma supported API get/post/patch calls and gives response back in JSON format. \n\nNote: For better understanding , check https://prisma.pan.dev/api/cloud/cspm/')]"
                  },
                  "host": "[[replace(replace(parameters('PrismaCloudAPIURL'),'https://',''),'http://','')]",
                  "basePath": "/",
                  "schemes": [
                    "https"
                  ],
                  "consumes": "[variables('TemplateEmptyArray')]",
                  "produces": [
                    "application/json"
                  ],
                  "paths": {
                    "/auth_token/extend": {
                      "get": {
                        "summary": "Refresh Token",
                        "description": "Refresh Token",
                        "operationId": "[[variables('_operationId-RefreshToken')]",
                        "parameters": [
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json; charset=UTF-8",
                            "description": "accept"
                          },
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/login": {
                      "post": {
                        "summary": "Login Generate Token",
                        "description": "Login Generate Token",
                        "operationId": "[[variables('_operationId-LoginGenerateToken')]",
                        "parameters": [
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json; charset=UTF-8",
                            "description": "content-type"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "customerName": {
                                  "type": "string",
                                  "description": "customerName"
                                },
                                "password": {
                                  "type": "string",
                                  "description": "password",
                                  "title": "[variables('blanks')]",
                                  "format": "password"
                                },
                                "prismaId": {
                                  "type": "string",
                                  "description": "prismaId"
                                },
                                "username": {
                                  "type": "string",
                                  "description": "username",
                                  "title": "[variables('blanks')]"
                                }
                              },
                              "default": {
                                "customerName": "string",
                                "password": "string",
                                "prismaId": "[variables('_prismaId')]",
                                "username": "string"
                              },
                              "required": [
                                "password",
                                "username"
                              ]
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "message": {
                                  "type": "string",
                                  "description": "message"
                                },
                                "token": {
                                  "type": "string",
                                  "description": "token"
                                },
                                "customerNames": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "customerName": {
                                        "type": "string",
                                        "description": "customerName"
                                      },
                                      "prismaId": {
                                        "type": "string",
                                        "description": "prismaId"
                                      },
                                      "tosAccepted": {
                                        "type": "boolean",
                                        "description": "tosAccepted"
                                      }
                                    }
                                  },
                                  "description": "customerNames"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "/v2/inventory": {
                      "get": {
                        "summary": "Asset Inventory View V2",
                        "description": "Asset Inventory View V2",
                        "operationId": "[[variables('_operationId-AssetInventoryViewV2')]",
                        "parameters": [
                          {
                            "name": "timeType",
                            "default": "relative",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeAmount",
                            "default": "40",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeUnit",
                            "default": "hour",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json; charset=UTF-8",
                            "description": "accept"
                          },
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/v2/inventory/trend": {
                      "get": {
                        "summary": "Asset Inventory Trend View V2",
                        "description": "Asset Inventory Trend View V2",
                        "operationId": "[[variables('_operationId-AssetInventoryTrendViewV2')]",
                        "parameters": [
                          {
                            "name": "timeType",
                            "default": "relative",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeAmount",
                            "default": "40",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeUnit",
                            "default": "hour",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json; charset=UTF-8",
                            "description": "accept"
                          },
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/resource/scan_info": {
                      "get": {
                        "summary": "Assets Resource Scan",
                        "description": "Assets Resource Scan",
                        "operationId": "[[variables('_operationId-AssetsResourceScan')]",
                        "parameters": [
                          {
                            "name": "timeType",
                            "default": "to_now",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeAmount",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "timeUnit",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.account",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.type",
                            "default": "azure",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.region",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "account.group",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.complianceStandard",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.complianceRequirement",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.complianceSection",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "limit",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "scan.status",
                            "default": "all",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "pageToken",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "timestamp": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "timestamp"
                                },
                                "totalMatchedCount": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "totalMatchedCount"
                                },
                                "pageSize": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "pageSize"
                                },
                                "resources": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "string",
                                        "description": "id"
                                      },
                                      "name": {
                                        "type": "string",
                                        "description": "name"
                                      },
                                      "accountId": {
                                        "type": "string",
                                        "description": "accountId"
                                      },
                                      "accountName": {
                                        "type": "string",
                                        "description": "accountName"
                                      },
                                      "regionId": {
                                        "type": "string",
                                        "description": "regionId"
                                      },
                                      "regionName": {
                                        "type": "string",
                                        "description": "regionName"
                                      },
                                      "cloudType": {
                                        "type": "string",
                                        "description": "cloudType"
                                      },
                                      "rrn": {
                                        "type": "string",
                                        "description": "rrn"
                                      },
                                      "overallPassed": {
                                        "type": "boolean",
                                        "description": "overallPassed"
                                      },
                                      "scannedPolicies": {
                                        "type": "array",
                                        "items": {
                                          "type": "object",
                                          "properties": {
                                            "id": {
                                              "type": "string",
                                              "description": "id"
                                            },
                                            "name": {
                                              "type": "string",
                                              "description": "name"
                                            },
                                            "severity": {
                                              "type": "string",
                                              "description": "severity"
                                            },
                                            "labels": {
                                              "type": "array",
                                              "items": {
                                                "type": "string"
                                              },
                                              "description": "labels"
                                            },
                                            "passed": {
                                              "type": "boolean",
                                              "description": "passed"
                                            }
                                          }
                                        },
                                        "description": "scannedPolicies"
                                      },
                                      "alertStatus": {
                                        "type": "object",
                                        "properties": {
                                          "high": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "high"
                                          },
                                          "medium": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "medium"
                                          },
                                          "low": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "low"
                                          },
                                          "critical": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "critical"
                                          },
                                          "informational": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "informational"
                                          }
                                        },
                                        "description": "alertStatus"
                                      },
                                      "appNames": {
                                        "type": "array",
                                        "items": {
                                          "type": "string"
                                        },
                                        "description": "appNames"
                                      },
                                      "unifiedAssetId": {
                                        "type": "string",
                                        "description": "unifiedAssetId"
                                      },
                                      "resourceDetailsAvailable": {
                                        "type": "boolean",
                                        "description": "resourceDetailsAvailable"
                                      },
                                      "resourceConfigJsonAvailable": {
                                        "type": "boolean",
                                        "description": "resourceConfigJsonAvailable"
                                      },
                                      "assetType": {
                                        "type": "string",
                                        "description": "assetType"
                                      }
                                    }
                                  },
                                  "description": "resources"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "/uai/v1/asset": {
                      "post": {
                        "summary": "Assets Enrichment",
                        "description": "Assets Enrichment",
                        "operationId": "[[variables('_operationId-AssetsEnrichment')]",
                        "parameters": [
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "assetId": {
                                  "type": "string",
                                  "description": "assetId",
                                  "title": "[variables('blanks')]"
                                },
                                "type": {
                                  "type": "string",
                                  "description": "type",
                                  "title": "[variables('blanks')]",
                                  "enum": [
                                    "EXTERNAL_FINDING",
                                    "ASSET",
                                    "ALERTS",
                                    "RAW_CONFIG",
                                    "NETWORK",
                                    "TIMELINE",
                                    "EXTERNAL_INTEGRATION",
                                    "ASSET_DATA_INDICATORS",
                                    "RELATIONSHIPS"
                                  ]
                                }
                              },
                              "default": {
                                "assetId": "[variables('_assetId')]",
                                "type": "ALERTS"
                              },
                              "required": [
                                "type",
                                "assetId"
                              ]
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/alert": {
                      "get": {
                        "summary": "List Alerts",
                        "description": "List Alerts",
                        "operationId": "[[variables('_operationId-ListAlerts')]",
                        "parameters": [
                          {
                            "name": "timeType",
                            "default": "relative",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeAmount",
                            "default": "30",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeUnit",
                            "default": "day",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "detailed",
                            "default": "false",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "alert.id",
                            "default": "P-301",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.account",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "account.group",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.type",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.region",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.id",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.name",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.severity",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.label",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.type",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "alertRule.name",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "resource.id",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "resource.name",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "resource.type",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "fields",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/alert/{id}": {
                      "get": {
                        "summary": "Get Alert Info",
                        "description": "Get Alert Info",
                        "operationId": "[[variables('_operationId-GetAlertInfo')]",
                        "parameters": [
                          {
                            "name": "detailed",
                            "default": "true",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "id",
                            "default": "{{id}}",
                            "in": "path",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/anomalies/trusted_list": {
                      "get": {
                        "summary": "Get Anomaly Trusted List",
                        "description": "Get Anomaly Trusted List",
                        "operationId": "[[variables('_operationId-GetAnomalyTrustedList')]",
                        "parameters": [
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      },
                      "post": {
                        "summary": "Add Entries to Anomaly Trusted List",
                        "description": "Add Entries to Anomaly Trusted List",
                        "operationId": "[[variables('_operationId-AddEntriesToAnomalyTrustedList')]",
                        "parameters": [
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "description": "name"
                                },
                                "description": {
                                  "type": "string",
                                  "description": "description"
                                },
                                "applicablePolicies": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "description": "applicablePolicies"
                                },
                                "trustedListType": {
                                  "type": "string",
                                  "description": "trustedListType"
                                },
                                "accountID": {
                                  "type": "string",
                                  "description": "accountID"
                                },
                                "vpc": {
                                  "type": "string",
                                  "description": "vpc"
                                },
                                "trustedListEntries": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "ipCIDR": {
                                        "type": "string",
                                        "description": "ipCIDR"
                                      },
                                      "resourceID": {
                                        "type": "string",
                                        "description": "resourceID"
                                      },
                                      "imageID": {
                                        "type": "string",
                                        "description": "imageID"
                                      },
                                      "tagKey": {
                                        "type": "string",
                                        "description": "tagKey"
                                      },
                                      "tagValue": {
                                        "type": "string",
                                        "description": "tagValue"
                                      },
                                      "service": {
                                        "type": "string",
                                        "description": "service"
                                      },
                                      "port": {
                                        "type": "string",
                                        "description": "port"
                                      },
                                      "subject": {
                                        "type": "string",
                                        "description": "subject"
                                      },
                                      "domain": {
                                        "type": "string",
                                        "description": "domain"
                                      },
                                      "protocol": {
                                        "type": "string",
                                        "description": "protocol"
                                      }
                                    }
                                  },
                                  "description": "trustedListEntries"
                                }
                              },
                              "default": {
                                "name": "string",
                                "description": "string",
                                "applicablePolicies": [
                                  "string"
                                ],
                                "trustedListType": "ip, resource, image, tag, service, port, subject, domain, protocol",
                                "accountID": "[variables('_accountID')]",
                                "vpc": "any",
                                "trustedListEntries": [
                                  {
                                    "ipCIDR": "string",
                                    "resourceID": "[variables('_resourceID')]",
                                    "imageID": "[variables('_imageID')]",
                                    "tagKey": "string",
                                    "tagValue": "string",
                                    "service": "string",
                                    "port": "string",
                                    "subject": "string",
                                    "domain": "string",
                                    "protocol": "string"
                                  }
                                ]
                              }
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/alert/remediation": {
                      "post": {
                        "summary": "List Remediation command",
                        "description": "List Remediation command",
                        "operationId": "[[variables('_operationId-ListRemediationCommand')]",
                        "parameters": [
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json; charset=UTF-8",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "alerts": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "description": "alerts"
                                },
                                "filter": {
                                  "type": "object",
                                  "properties": {
                                    "timeRange": {
                                      "type": "object",
                                      "properties": {
                                        "relativeTimeType": {
                                          "type": "string",
                                          "description": "relativeTimeType"
                                        },
                                        "type": {
                                          "type": "string",
                                          "description": "type"
                                        },
                                        "value": {
                                          "type": "string",
                                          "description": "value"
                                        }
                                      },
                                      "description": "timeRange"
                                    }
                                  },
                                  "description": "filter"
                                }
                              },
                              "default": {
                                "alerts": [
                                  "P-653"
                                ],
                                "filter": {
                                  "timeRange": {
                                    "relativeTimeType": "BACKWARD",
                                    "type": "to_now",
                                    "value": "epoch"
                                  }
                                }
                              }
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/alert/remediation/{id}": {
                      "patch": {
                        "summary": "Remediate Alert",
                        "description": "Remediate Alert",
                        "operationId": "[[variables('_operationId-RemediateAlert')]",
                        "parameters": [
                          {
                            "name": "id",
                            "default": "{{id}}",
                            "in": "path",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    }
                  },
                  "security": "[variables('TemplateEmptyArray')]",
                  "tags": "[variables('TemplateEmptyArray')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "LogicAppsCustomConnector",
        "displayName": "PrismaCloudCSPMCustomConnector",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PrismaCloudCSPM-Enrichment Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "PrismaCloudCSPM-Enrichment",
              "type": "string"
            },
            "Keyvault name": {
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where secret key is stored"
              }
            },
            "PrismaSecretName": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Prisma Secret Key Name"
              }
            },
            "PrismaUserID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for PrismaUserID"
              }
            },
            "CustomConnectorName": {
              "defaultValue": "PrismaCloudCSPMCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same in all Prisma Cloud automation playbooks as well"
              }
            }
          },
          "variables": {
            "PrismacloudcspmcustomconnectorConnectionName": "[[concat('Prismacloudcspmcustomconnector-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-4": "[[variables('connection-4')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "PrismaSecretName": {
                      "defaultValue": "[[parameters('PrismaSecretName')]",
                      "type": "string"
                    },
                    "PrismaUserID": {
                      "defaultValue": "[[parameters('PrismaUserID')]",
                      "type": "string"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Condition_2_-_check_if_triggered_has_entities": {
                      "actions": {
                        "Assets_Resource_Scan": {
                          "runAfter": {
                            "Login_Generate_Token": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/resource/scan_info",
                            "queries": {
                              "cloud.type": "azure",
                              "scan.status": "all",
                              "timeType": "to_now"
                            }
                          }
                        },
                        "Condition_2_-_checking_if_provided_entities_are_there_in_Prisma_cloud": {
                          "actions": {
                            "Add_comment_to_incident_(V3)_3": {
                              "runAfter": {
                                "Create_HTML_table_2": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "incidentArmId": "@triggerBody()?['object']?['id']",
                                  "message": "<p>Assets Enrichment information :<br>\n@{body('Create_HTML_table_2')}<br>\n<br>\n---------------------------------------------------------------------------------------<br>\nAlerts details<br>\n<br>\n@{body('Create_HTML_table')}</p>"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/Incidents/Comment"
                              }
                            },
                            "Create_HTML_table": {
                              "runAfter": {
                                "For_each_-_storing_alert_info_in_variable": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Table",
                              "inputs": {
                                "format": "HTML",
                                "from": "@variables('alerts_detail')"
                              }
                            },
                            "Create_HTML_table_2": {
                              "runAfter": {
                                "Create_HTML_table": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Table",
                              "inputs": {
                                "format": "HTML",
                                "from": "@variables('collect_asset_scan_details')"
                              }
                            },
                            "For_each_-_collect_alerts_id_in_array": {
                              "foreach": "@body('Parse_JSON_-_parsing_collected_assets_details')",
                              "actions": {
                                "Assets_Enrichment": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "assetId": "@items('For_each_-_collect_alerts_id_in_array')['unifiedAssetId']",
                                      "type": "ALERTS"
                                    },
                                    "headers": {
                                      "content-type": "application/json",
                                      "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/uai/v1/asset"
                                  }
                                },
                                "For_each_2": {
                                  "foreach": "@body('Parse_JSON_-_Parsing_output_of_assets_Enrichment')?['data']?['asset']?['alerts']",
                                  "actions": {
                                    "Append_to_array_variable_3": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "collect_alerts",
                                        "value": "@items('For_each_2')?['id']"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Parse_JSON_-_Parsing_output_of_assets_Enrichment": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "Parse_JSON_-_Parsing_output_of_assets_Enrichment": {
                                  "runAfter": {
                                    "Assets_Enrichment": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@body('Assets_Enrichment')",
                                    "schema": {
                                      "properties": {
                                        "data": {
                                          "properties": {
                                            "asset": {
                                              "properties": {
                                                "alerts": {
                                                  "items": {
                                                    "properties": {
                                                      "id": {
                                                        "type": "string"
                                                      },
                                                      "severity": {
                                                        "type": "string"
                                                      }
                                                    },
                                                    "required": [
                                                      "id",
                                                      "severity"
                                                    ],
                                                    "type": "object"
                                                  },
                                                  "type": "array"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "errors": {
                                          "type": "array"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "For_each_-_storing_asset_scan_selected_data": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "For_each_-_storing_alert_info_in_variable": {
                              "foreach": "@variables('collect_alerts')",
                              "actions": {
                                "Append_to_array_variable_4_-_alert_details": {
                                  "runAfter": {
                                    "Parse_JSON_-_get_alert_info_result": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "alerts_detail",
                                    "value": {
                                      "Alert ID": "@body('Parse_JSON_-_get_alert_info_result')?['id']",
                                      "Alert status": "@body('Parse_JSON_-_get_alert_info_result')?['status']",
                                      "Alert_policy": "@body('Parse_JSON_-_get_alert_info_result')?['policy']?['name']",
                                      "Alert_severity": "@body('Parse_JSON_-_get_alert_info_result')?['policy']?['severity']",
                                      "Asset Owner": "@join(body('Parse_JSON_-_get_alert_info_result')?['resource']?['cloudAccountOwners'],' ')",
                                      "Cloud account Group": "@join(body('Parse_JSON_-_get_alert_info_result')?['resource']?['cloudAccountGroups'],' ')",
                                      "Labels": "@join(body('Parse_JSON_-_get_alert_info_result')?['policy']?['labels'],' ')",
                                      "Policy Type": "@body('Parse_JSON_-_get_alert_info_result')?['policy']?['policyType']",
                                      "Recommendation": "@body('Parse_JSON_-_get_alert_info_result')?['policy']?['recommendation']",
                                      "Resource Name": "@body('Parse_JSON_-_get_alert_info_result')?['resource']?['name']",
                                      "Resource account": "@body('Parse_JSON_-_get_alert_info_result')?['resource']?['account']"
                                    }
                                  }
                                },
                                "Get_Alert_Info": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "headers": {
                                      "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/alert/@{encodeURIComponent(items('For_each_-_storing_alert_info_in_variable'))}",
                                    "queries": {
                                      "detailed": "true"
                                    }
                                  }
                                },
                                "Parse_JSON_-_get_alert_info_result": {
                                  "runAfter": {
                                    "Get_Alert_Info": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@body('Get_Alert_Info')",
                                    "schema": {
                                      "properties": {
                                        "alertRules": {
                                          "items": {
                                            "properties": {
                                              "alertRuleNotificationConfig": {
                                                "type": "array"
                                              },
                                              "allowAutoRemediate": {
                                                "type": "boolean"
                                              },
                                              "enabled": {
                                                "type": "boolean"
                                              },
                                              "name": {
                                                "type": "string"
                                              },
                                              "notifyOnDismissed": {
                                                "type": "boolean"
                                              },
                                              "notifyOnOpen": {
                                                "type": "boolean"
                                              },
                                              "notifyOnResolved": {
                                                "type": "boolean"
                                              },
                                              "notifyOnSnoozed": {
                                                "type": "boolean"
                                              },
                                              "policyScanConfigId": {
                                                "type": "string"
                                              },
                                              "scanAll": {
                                                "type": "boolean"
                                              },
                                              "target": {
                                                "properties": {
                                                  "accountGroups": {
                                                    "type": "array"
                                                  },
                                                  "excludedAccounts": {
                                                    "type": "array"
                                                  },
                                                  "regions": {
                                                    "type": "array"
                                                  },
                                                  "tags": {
                                                    "type": "array"
                                                  }
                                                },
                                                "type": "object"
                                              }
                                            },
                                            "required": [
                                              "policyScanConfigId",
                                              "name",
                                              "enabled",
                                              "scanAll",
                                              "target",
                                              "alertRuleNotificationConfig",
                                              "allowAutoRemediate",
                                              "notifyOnOpen",
                                              "notifyOnSnoozed",
                                              "notifyOnDismissed",
                                              "notifyOnResolved"
                                            ],
                                            "type": "object"
                                          },
                                          "type": "array"
                                        },
                                        "alertTime": {
                                          "type": "integer"
                                        },
                                        "firstSeen": {
                                          "type": "integer"
                                        },
                                        "history": {
                                          "items": {
                                            "properties": {
                                              "modifiedBy": {
                                                "type": "string"
                                              },
                                              "modifiedOn": {
                                                "type": "integer"
                                              },
                                              "reason": {
                                                "type": "string"
                                              },
                                              "status": {
                                                "type": "string"
                                              }
                                            },
                                            "required": [
                                              "modifiedBy",
                                              "modifiedOn",
                                              "status",
                                              "reason"
                                            ],
                                            "type": "object"
                                          },
                                          "type": "array"
                                        },
                                        "id": {
                                          "type": "string"
                                        },
                                        "investigateOptions": {
                                          "properties": {
                                            "alertId": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "lastSeen": {
                                          "type": "integer"
                                        },
                                        "metadata": {
                                          "properties": {
                                            "saveSearchId": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "networkAnomaly": {
                                          "type": "boolean"
                                        },
                                        "policy": {
                                          "properties": {
                                            "complianceMetadata": {
                                              "items": {
                                                "properties": {
                                                  "complianceId": {
                                                    "type": "string"
                                                  },
                                                  "customAssigned": {
                                                    "type": "boolean"
                                                  },
                                                  "policyId": {
                                                    "type": "string"
                                                  },
                                                  "requirementId": {
                                                    "type": "string"
                                                  },
                                                  "requirementName": {
                                                    "type": "string"
                                                  },
                                                  "requirementViewOrder": {
                                                    "type": "integer"
                                                  },
                                                  "sectionDescription": {
                                                    "type": "string"
                                                  },
                                                  "sectionId": {
                                                    "type": "string"
                                                  },
                                                  "sectionLabel": {
                                                    "type": "string"
                                                  },
                                                  "sectionViewOrder": {
                                                    "type": "integer"
                                                  },
                                                  "standardDescription": {
                                                    "type": "string"
                                                  },
                                                  "standardName": {
                                                    "type": "string"
                                                  },
                                                  "systemDefault": {
                                                    "type": "boolean"
                                                  }
                                                },
                                                "required": [
                                                  "standardName",
                                                  "standardDescription",
                                                  "requirementId",
                                                  "requirementName",
                                                  "sectionId",
                                                  "sectionDescription",
                                                  "policyId",
                                                  "complianceId",
                                                  "sectionLabel",
                                                  "sectionViewOrder",
                                                  "requirementViewOrder",
                                                  "systemDefault",
                                                  "customAssigned"
                                                ],
                                                "type": "object"
                                              },
                                              "type": "array"
                                            },
                                            "deleted": {
                                              "type": "boolean"
                                            },
                                            "description": {
                                              "type": "string"
                                            },
                                            "labels": {
                                              "items": {
                                                "type": "string"
                                              },
                                              "type": "array"
                                            },
                                            "lastModifiedBy": {
                                              "type": "string"
                                            },
                                            "lastModifiedOn": {
                                              "type": "integer"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "policyId": {
                                              "type": "string"
                                            },
                                            "policyType": {
                                              "type": "string"
                                            },
                                            "recommendation": {
                                              "type": "string"
                                            },
                                            "remediable": {
                                              "type": "boolean"
                                            },
                                            "severity": {
                                              "type": "string"
                                            },
                                            "systemDefault": {
                                              "type": "boolean"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "reason": {
                                          "type": "string"
                                        },
                                        "resource": {
                                          "properties": {
                                            "account": {
                                              "type": "string"
                                            },
                                            "accountId": {
                                              "type": "string"
                                            },
                                            "additionalInfo": {
                                              "type": "object"
                                            },
                                            "cloudAccountGroups": {
                                              "items": {
                                                "type": "string"
                                              },
                                              "type": "array"
                                            },
                                            "cloudAccountOwners": {
                                              "items": {
                                                "type": "string"
                                              },
                                              "type": "array"
                                            },
                                            "cloudServiceName": {
                                              "type": "string"
                                            },
                                            "cloudType": {
                                              "type": "string"
                                            },
                                            "data": {
                                              "properties": {
                                                "Extensions": {
                                                  "properties": {
                                                    "MDE.Linux": {
                                                      "properties": {
                                                        "autoUpgradeMinorVersion": {
                                                          "type": "boolean"
                                                        },
                                                        "forceUpdateTag": {
                                                          "type": "string"
                                                        },
                                                        "protectedSettings": {
                                                          "type": "object"
                                                        },
                                                        "provisioningState": {
                                                          "type": "string"
                                                        },
                                                        "publisher": {
                                                          "type": "string"
                                                        },
                                                        "settings": {
                                                          "properties": {
                                                            "azureResourceId": {
                                                              "type": "string"
                                                            },
                                                            "forceReOnboarding": {
                                                              "type": "boolean"
                                                            },
                                                            "vNextEnabled": {
                                                              "type": "boolean"
                                                            }
                                                          },
                                                          "type": "object"
                                                        },
                                                        "type": {
                                                          "type": "string"
                                                        },
                                                        "typeHandlerVersion": {
                                                          "type": "string"
                                                        },
                                                        "virtualMachineExtensionType": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "OmsAgentForLinux": {
                                                      "properties": {
                                                        "autoUpgradeMinorVersion": {
                                                          "type": "boolean"
                                                        },
                                                        "enableAutomaticUpgrade": {
                                                          "type": "boolean"
                                                        },
                                                        "protectedSettings": {
                                                          "type": "object"
                                                        },
                                                        "provisioningState": {
                                                          "type": "string"
                                                        },
                                                        "publisher": {
                                                          "type": "string"
                                                        },
                                                        "settings": {
                                                          "properties": {
                                                            "workspaceId": {
                                                              "type": "string"
                                                            }
                                                          },
                                                          "type": "object"
                                                        },
                                                        "type": {
                                                          "type": "string"
                                                        },
                                                        "typeHandlerVersion": {
                                                          "type": "string"
                                                        },
                                                        "virtualMachineExtensionType": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "enablevmaccess": {
                                                      "properties": {
                                                        "autoUpgradeMinorVersion": {
                                                          "type": "boolean"
                                                        },
                                                        "protectedSettings": {
                                                          "type": "object"
                                                        },
                                                        "provisioningState": {
                                                          "type": "string"
                                                        },
                                                        "publisher": {
                                                          "type": "string"
                                                        },
                                                        "settings": {
                                                          "type": "object"
                                                        },
                                                        "type": {
                                                          "type": "string"
                                                        },
                                                        "typeHandlerVersion": {
                                                          "type": "string"
                                                        },
                                                        "virtualMachineExtensionType": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "id": {
                                                  "type": "string"
                                                },
                                                "location": {
                                                  "type": "string"
                                                },
                                                "locks": {
                                                  "type": "object"
                                                },
                                                "powerState": {
                                                  "type": "string"
                                                },
                                                "properties.networkProfile": {
                                                  "properties": {
                                                    "networkInterfaces": {
                                                      "items": {
                                                        "properties": {
                                                          "id": {
                                                            "type": "string"
                                                          },
                                                          "ipConfigurations": {
                                                            "items": {
                                                              "properties": {
                                                                "id": {
                                                                  "type": "string"
                                                                },
                                                                "name": {
                                                                  "type": "string"
                                                                },
                                                                "primary": {
                                                                  "type": "boolean"
                                                                },
                                                                "privateIpAddress": {
                                                                  "type": "string"
                                                                },
                                                                "publicIpAddress": {
                                                                  "type": "string"
                                                                },
                                                                "publicIpAddressId": {
                                                                  "type": "string"
                                                                },
                                                                "subnet": {
                                                                  "type": "string"
                                                                }
                                                              },
                                                              "required": [
                                                                "id",
                                                                "name",
                                                                "subnet",
                                                                "primary",
                                                                "publicIpAddress",
                                                                "privateIpAddress",
                                                                "publicIpAddressId"
                                                              ],
                                                              "type": "object"
                                                            },
                                                            "type": "array"
                                                          },
                                                          "privateIpAddress": {
                                                            "type": "string"
                                                          },
                                                          "publicIpAddress": {
                                                            "type": "string"
                                                          },
                                                          "publicIpAddressId": {
                                                            "type": "string"
                                                          }
                                                        },
                                                        "required": [
                                                          "id",
                                                          "publicIpAddress",
                                                          "ipConfigurations",
                                                          "privateIpAddress",
                                                          "publicIpAddressId"
                                                        ],
                                                        "type": "object"
                                                      },
                                                      "type": "array"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "properties.osProfile": {
                                                  "properties": {
                                                    "adminUsername": {
                                                      "type": "string"
                                                    },
                                                    "allowExtensionOperations": {
                                                      "type": "boolean"
                                                    },
                                                    "computerName": {
                                                      "type": "string"
                                                    },
                                                    "linuxConfiguration": {
                                                      "properties": {
                                                        "disablePasswordAuthentication": {
                                                          "type": "boolean"
                                                        },
                                                        "provisionVMAgent": {
                                                          "type": "boolean"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "secrets": {
                                                      "type": "array"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "properties.storageProfile": {
                                                  "properties": {
                                                    "dataDisks": {
                                                      "type": "array"
                                                    },
                                                    "imageReference": {
                                                      "properties": {
                                                        "offer": {
                                                          "type": "string"
                                                        },
                                                        "publisher": {
                                                          "type": "string"
                                                        },
                                                        "sku": {
                                                          "type": "string"
                                                        },
                                                        "version": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "osDisk": {
                                                      "properties": {
                                                        "caching": {
                                                          "type": "string"
                                                        },
                                                        "createOption": {
                                                          "type": "string"
                                                        },
                                                        "deleteOption": {
                                                          "type": "string"
                                                        },
                                                        "diskSizeGB": {
                                                          "type": "integer"
                                                        },
                                                        "managedDisk": {
                                                          "properties": {
                                                            "storageAccountType": {
                                                              "type": "string"
                                                            }
                                                          },
                                                          "type": "object"
                                                        },
                                                        "name": {
                                                          "type": "string"
                                                        },
                                                        "osType": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "tags": {
                                                  "type": "object"
                                                },
                                                "vmId": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "id": {
                                              "type": "string"
                                            },
                                            "internalResourceId": {
                                              "type": "string"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "region": {
                                              "type": "string"
                                            },
                                            "regionId": {
                                              "type": "string"
                                            },
                                            "resourceApiName": {
                                              "type": "string"
                                            },
                                            "resourceConfigJsonAvailable": {
                                              "type": "boolean"
                                            },
                                            "resourceDetailsAvailable": {
                                              "type": "boolean"
                                            },
                                            "resourceTs": {
                                              "type": "integer"
                                            },
                                            "resourceType": {
                                              "type": "string"
                                            },
                                            "rrn": {
                                              "type": "string"
                                            },
                                            "unifiedAssetId": {
                                              "type": "string"
                                            },
                                            "url": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "saveSearchId": {
                                          "type": "string"
                                        },
                                        "status": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "For_each_-_collect_alerts_id_in_array": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "For_each_-_storing_asset_scan_selected_data": {
                              "foreach": "@variables('collect_unifiedid')",
                              "actions": {
                                "Append_to_array_variable_4_-_storing_the_data_in_variable": {
                                  "runAfter": {
                                    "Parse_JSON_-_parsing_selected_asset_scan_data": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "collect_asset_scan_details",
                                    "value": {
                                      "Asset Name": "@body('Parse_JSON_-_parsing_selected_asset_scan_data')?['name']",
                                      "Breached Policies": "@replace(string(body('Parse_JSON_-_parsing_selected_asset_scan_data')?['scannedPolicies']),'\"',' ')",
                                      "Vulnerability Status": "@replace(string(body('Parse_JSON_-_parsing_selected_asset_scan_data')?['vulnerabilityStatus']),'\\\"','')",
                                      "assetType": "@body('Parse_JSON_-_parsing_selected_asset_scan_data')?['assetType']"
                                    }
                                  }
                                },
                                "Parse_JSON_-_parsing_selected_asset_scan_data": {
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@items('For_each_-_storing_asset_scan_selected_data')",
                                    "schema": {
                                      "properties": {
                                        "accountId": {
                                          "type": "string"
                                        },
                                        "accountName": {
                                          "type": "string"
                                        },
                                        "alertStatus": {
                                          "properties": {
                                            "critical": {
                                              "type": "integer"
                                            },
                                            "high": {
                                              "type": "integer"
                                            },
                                            "informational": {
                                              "type": "integer"
                                            },
                                            "low": {
                                              "type": "integer"
                                            },
                                            "medium": {
                                              "type": "integer"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "appNames": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "assetType": {
                                          "type": "string"
                                        },
                                        "cloudType": {
                                          "type": "string"
                                        },
                                        "id": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        },
                                        "overallPassed": {
                                          "type": "boolean"
                                        },
                                        "regionId": {
                                          "type": "string"
                                        },
                                        "regionName": {
                                          "type": "string"
                                        },
                                        "resourceConfigJsonAvailable": {
                                          "type": "boolean"
                                        },
                                        "resourceDetailsAvailable": {
                                          "type": "boolean"
                                        },
                                        "rrn": {
                                          "type": "string"
                                        },
                                        "scannedPolicies": {
                                          "items": {
                                            "properties": {
                                              "id": {
                                                "type": "string"
                                              },
                                              "labels": {
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              },
                                              "name": {
                                                "type": "string"
                                              },
                                              "passed": {
                                                "type": "boolean"
                                              },
                                              "severity": {
                                                "type": "string"
                                              }
                                            },
                                            "required": [
                                              "id",
                                              "name",
                                              "severity",
                                              "labels",
                                              "passed"
                                            ],
                                            "type": "object"
                                          },
                                          "type": "array"
                                        },
                                        "unifiedAssetId": {
                                          "type": "string"
                                        },
                                        "vulnerabilityStatus": {
                                          "properties": {
                                            "critical": {
                                              "type": "integer"
                                            },
                                            "high": {
                                              "type": "integer"
                                            },
                                            "low": {
                                              "type": "integer"
                                            },
                                            "medium": {
                                              "type": "integer"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_-_parsing_collected_assets_details": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "Parse_JSON_-_parsing_collected_assets_details": {
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@variables('collect_unifiedid')",
                                "schema": {
                                  "items": {
                                    "properties": {
                                      "accountId": {
                                        "type": "string"
                                      },
                                      "accountName": {
                                        "type": "string"
                                      },
                                      "alertStatus": {
                                        "properties": {
                                          "critical": {
                                            "type": "integer"
                                          },
                                          "high": {
                                            "type": "integer"
                                          },
                                          "informational": {
                                            "type": "integer"
                                          },
                                          "low": {
                                            "type": "integer"
                                          },
                                          "medium": {
                                            "type": "integer"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "appNames": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "assetType": {
                                        "type": "string"
                                      },
                                      "cloudType": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "overallPassed": {
                                        "type": "boolean"
                                      },
                                      "regionId": {
                                        "type": "string"
                                      },
                                      "regionName": {
                                        "type": "string"
                                      },
                                      "resourceConfigJsonAvailable": {
                                        "type": "boolean"
                                      },
                                      "resourceDetailsAvailable": {
                                        "type": "boolean"
                                      },
                                      "rrn": {
                                        "type": "string"
                                      },
                                      "scannedPolicies": {
                                        "items": {
                                          "properties": {
                                            "id": {
                                              "type": "string"
                                            },
                                            "labels": {
                                              "items": {
                                                "type": "string"
                                              },
                                              "type": "array"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "passed": {
                                              "type": "boolean"
                                            },
                                            "severity": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "id",
                                            "name",
                                            "severity",
                                            "labels",
                                            "passed"
                                          ],
                                          "type": "object"
                                        },
                                        "type": "array"
                                      },
                                      "unifiedAssetId": {
                                        "type": "string"
                                      },
                                      "vulnerabilityStatus": {
                                        "properties": {
                                          "critical": {
                                            "type": "integer"
                                          },
                                          "high": {
                                            "type": "integer"
                                          },
                                          "low": {
                                            "type": "integer"
                                          },
                                          "medium": {
                                            "type": "integer"
                                          }
                                        },
                                        "type": "object"
                                      }
                                    },
                                    "required": [
                                      "id",
                                      "name",
                                      "accountId",
                                      "accountName",
                                      "regionId",
                                      "regionName",
                                      "cloudType",
                                      "rrn",
                                      "overallPassed",
                                      "scannedPolicies",
                                      "alertStatus",
                                      "appNames",
                                      "unifiedAssetId",
                                      "resourceDetailsAvailable",
                                      "resourceConfigJsonAvailable",
                                      "assetType"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "For_each_2_-_collecting_assetID": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Add_comment_to_incident_(V3)_2": {
                                "type": "ApiConnection",
                                "inputs": {
                                  "body": {
                                    "incidentArmId": "@triggerBody()?['object']?['id']",
                                    "message": "<p>Provided entites are not available in Prisma Cloud</p>"
                                  },
                                  "host": {
                                    "connection": {
                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                    }
                                  },
                                  "method": "post",
                                  "path": "/Incidents/Comment"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(variables('collect_unifiedid'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "For_each_2_-_collecting_assetID": {
                          "foreach": "@body('Assets_Resource_Scan')?['resources']",
                          "actions": {
                            "Condition": {
                              "actions": {
                                "Append_to_array_variable_2": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "collect_unifiedid",
                                    "value": "@items('For_each_2_-_collecting_assetID')"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "contains": [
                                      "@variables('collect_entities')",
                                      "@items('For_each_2_-_collecting_assetID')?['name']"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "runAfter": {
                            "Assets_Resource_Scan": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Login_Generate_Token": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "password": "@body('Get_secret')?['value']",
                              "username": "@parameters('PrismaUserID')"
                            },
                            "headers": {
                              "content-type": "application/json; charset=UTF-8"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/login"
                          }
                        }
                      },
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>No entities mapped to host asset field.</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('collect_entities'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "For_each_-_collecting_entities_in_one_array": {
                      "foreach": "@body('Parse_JSON_-_entities')",
                      "actions": {
                        "Append_to_array_variable": {
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "collect_entities",
                            "value": "@items('For_each_-_collecting_entities_in_one_array')?['properties']?['hostName']"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_-_collecting_entities": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Get_secret": {
                      "runAfter": {
                        "For_each_-_collecting_entities_in_one_array": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('PrismaSecretName'))}/value"
                      }
                    },
                    "Initialize_variable-_collecting_unified_id's": {
                      "runAfter": {
                        "Initialize_variable_-_collect_asset_scan_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collect_unifiedid",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_alerts": {
                      "runAfter": {
                        "Parse_JSON_-_entities": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collect_alerts",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_alerts_details_": {
                      "runAfter": {
                        "Initialize_variable_-_collect_alerts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "alerts_detail",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_asset_scan_details": {
                      "runAfter": {
                        "Initialize_variable_-_collect_alerts_details_": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collect_asset_scan_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collecting_entities": {
                      "runAfter": {
                        "Initialize_variable-_collecting_unified_id's": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collect_entities",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Parse_JSON_-_entities": {
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "schema": {
                          "items": {
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "kind": {
                                "type": "string"
                              },
                              "properties": {
                                "properties": {
                                  "friendlyName": {
                                    "type": "string"
                                  },
                                  "hostName": {
                                    "type": "string"
                                  }
                                },
                                "type": "object"
                              },
                              "type": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "kind",
                              "properties",
                              "type"
                            ],
                            "type": "object"
                          },
                          "type": "array"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "PrismaCloudCSPMCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PrismacloudcspmcustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "PrismaCloudCSPM-Enrichment",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('PrismacloudcspmcustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-4')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_PrismaCloudCSPMCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Fetch Security Posture from Prisma Cloud",
            "description": "This playbook provides/updates the compliance security posture details of asset in comments section of triggered incident so that SOC analysts can directly take corrective measure to prevent the attack",
            "prerequisites": [
              "1. PrismaCloudCSPM Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription.",
              "2. API Key and User ID . To get this, login into your Prisma cloud instance dashboard and navigate to Settings --> Access Control --> Access Keys --> Add",
              "3. [Important step]Store the API secret key in Key vault then provide the keyvault name and key name of the stored secret during deployment"
            ],
            "postDeployment": [
              "1. During deployment you need to provide your Key vault name , User ID and API key name of stored secret key."
            ],
            "lastUpdateTime": "2023-02-03T00:00:00Z",
            "entities": [
              "host"
            ],
            "tags": [
              "Enrichment",
              "Notification",
              "CSPM",
              "PrismaCloud",
              "Compliance",
              "Posture"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "PrismaCloudCSPM-Enrichment",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PrismaCloudCSPM-Remediation Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "PrismaCloudCSPM-Remediation",
              "type": "string"
            },
            "Keyvault name": {
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where secret key is stored"
              }
            },
            "PrismaSecretName": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Prisma Secret Key Name"
              }
            },
            "PrismaUserID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Prisma User ID"
              }
            },
            "TeamsID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for TeamsID"
              }
            },
            "ChannelID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Teams ChannelID"
              }
            },
            "CustomConnectorName": {
              "defaultValue": "PrismaCloudCSPMCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same in all Prisma Cloud automation playbooks as well"
              }
            }
          },
          "variables": {
            "PrismacloudcspmcustomconnectorConnectionName": "[[concat('Prismacloudcspmcustomconnector-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[[concat('Teams-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-4": "[[variables('connection-4')]",
            "connection-5": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Teams')]",
            "_connection-5": "[[variables('connection-5')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "ChannelID": {
                      "defaultValue": "[[parameters('ChannelID')]",
                      "type": "string"
                    },
                    "PrismaSecretName": {
                      "defaultValue": "[[parameters('PrismaSecretName')]",
                      "type": "string"
                    },
                    "PrismaUserID": {
                      "defaultValue": "[[parameters('PrismaUserID')]",
                      "type": "string"
                    },
                    "TeamsID": {
                      "defaultValue": "[[parameters('TeamsID')]",
                      "type": "string"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Condition_-_check_if_any_entity_is_collected": {
                      "actions": {
                        "Add_comment_to_incident_(V3)_2": {
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>Remediable Alert Summary:<br>\n<br>\n@{body('Create_HTML_table')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Create_HTML_table": {
                          "runAfter": {
                            "For_each_2_-_fetching_response_from_teams_channel_and_taking_action": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('Collect_response')"
                          }
                        },
                        "For_each_-_valid_alert_list": {
                          "foreach": "@variables('collect_entities')",
                          "actions": {
                            "For_each": {
                              "foreach": "@body('Parse_JSON_-_list_alerts_response')",
                              "actions": {
                                "Condition": {
                                  "actions": {
                                    "Append_to_array_variable_-_collect_alerts_info_with_remediation_command": {
                                      "runAfter": {
                                        "Parse_JSON_-_List_remediation_command_response": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "collected_alerts",
                                        "value": {
                                          "Account": "@items('For_each')?['resource']?['account']",
                                          "Alert id": "@items('For_each')['id']",
                                          "Policy Name": "@items('For_each')?['policy']?['name']",
                                          "Resource Name": "@items('For_each')?['resource']?['name']",
                                          "Script Impact": "@{body('Parse_JSON_-_List_remediation_command_response')?['scriptImpact']} ",
                                          "alertIdVsCliScript": "@replace(string(body('Parse_JSON_-_List_remediation_command_response')?['alertIdVsCliScript']),'\"','')",
                                          "cli Description": "@body('Parse_JSON_-_List_remediation_command_response')?['cliDescription']"
                                        }
                                      }
                                    },
                                    "Parse_JSON_-_List_remediation_command_response": {
                                      "type": "ParseJson",
                                      "inputs": {
                                        "content": "@body('List_Remediation_command')",
                                        "schema": {
                                          "properties": {
                                            "alertIdVsCliScript": {
                                              "type": "object"
                                            },
                                            "cliDescription": {
                                              "type": "string"
                                            },
                                            "scriptImpact": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "List_Remediation_command": [
                                      "Succeeded",
                                      "Failed"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Append_to_array_variable_2_-_collect_alerts_info_with_remediation_command": {
                                        "runAfter": {
                                          "Parse_JSON_2_-_List_Remediation_command_response": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "AppendToArrayVariable",
                                        "inputs": {
                                          "name": "collected_alerts",
                                          "value": {
                                            "Account": "@items('For_each')?['resource']?['account']",
                                            "Alert id": "@items('For_each')['id']",
                                            "Policy Name": "@items('For_each')?['policy']?['name']",
                                            "Resource Name": "@items('For_each')?['resource']?['name']",
                                            "Script Impact": "@{body('Parse_JSON_2_-_List_Remediation_command_response')?['scriptImpact']} ",
                                            "alertIdVsCliScript": "@replace(string(body('Parse_JSON_2_-_List_Remediation_command_response')?['alertIdVsCliScript']),'\"','')",
                                            "cli Description": "@body('Parse_JSON_2_-_List_Remediation_command_response')?['cliDescription']"
                                          }
                                        }
                                      },
                                      "Parse_JSON_2_-_List_Remediation_command_response": {
                                        "type": "ParseJson",
                                        "inputs": {
                                          "content": "@body('List_Remediation_command')",
                                          "schema": {
                                            "properties": {
                                              "alertIdVsCliScript": {
                                                "type": "object"
                                              },
                                              "cliDescription": {
                                                "type": "string"
                                              },
                                              "scriptImpact": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "equals": [
                                          "@actions('List_Remediation_command').outputs.statusCode",
                                          200
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "List_Remediation_command": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "alerts": [
                                        "@items('For_each')['id']"
                                      ],
                                      "filter": {
                                        "timeRange": {
                                          "relativeTimeType": "BACKWARD",
                                          "type": "to_now",
                                          "value": "epoch"
                                        }
                                      }
                                    },
                                    "headers": {
                                      "content-type": "application/json; charset=UTF-8",
                                      "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/alert/remediation"
                                  }
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_-_list_alerts_response": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "List_Alerts": {
                              "type": "ApiConnection",
                              "inputs": {
                                "headers": {
                                  "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/alert",
                                "queries": {
                                  "detailed": "false",
                                  "fields": "alert.id, alert.status, alert.time, cloud.accountId, cloud.account, cloud.region, resource.id, resource.name,policy.name",
                                  "resource.name": "@{items('For_each_-_valid_alert_list')}",
                                  "timeAmount": "90",
                                  "timeType": "relative",
                                  "timeUnit": "day"
                                }
                              }
                            },
                            "Parse_JSON_-_list_alerts_response": {
                              "runAfter": {
                                "List_Alerts": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@body('List_Alerts')",
                                "schema": {
                                  "items": {
                                    "properties": {
                                      "alertRules": {
                                        "type": "array"
                                      },
                                      "alertTime": {
                                        "type": "integer"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "policy": {
                                        "properties": {
                                          "name": {
                                            "type": "string"
                                          },
                                          "remediable": {
                                            "type": "boolean"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "resource": {
                                        "properties": {
                                          "account": {
                                            "type": "string"
                                          },
                                          "accountId": {
                                            "type": "string"
                                          },
                                          "id": {
                                            "type": "string"
                                          },
                                          "name": {
                                            "type": "string"
                                          },
                                          "region": {
                                            "type": "string"
                                          },
                                          "resourceConfigJsonAvailable": {
                                            "type": "boolean"
                                          },
                                          "resourceDetailsAvailable": {
                                            "type": "boolean"
                                          },
                                          "resourceTs": {
                                            "type": "integer"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "status": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "id",
                                      "status",
                                      "alertTime",
                                      "policy",
                                      "alertRules",
                                      "resource"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Login_Generate_Token": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "For_each_2_-_fetching_response_from_teams_channel_and_taking_action": {
                          "foreach": "@body('Parse_JSON_-_parsing_collected_alerts')",
                          "actions": {
                            "Condition_to_check_for_non_remediable_alerts": {
                              "actions": {
                                "Parse_JSON_-_Output_of_teams_adaptive_card_2": {
                                  "runAfter": {
                                    "Post_adaptive_card_and_wait_for_a_response_2": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@body('Post_adaptive_card_and_wait_for_a_response_2')",
                                    "schema": {
                                      "properties": {
                                        "data": {
                                          "properties": {
                                            "incidentStatus": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "messageId": {
                                          "type": "string"
                                        },
                                        "messageLink": {
                                          "type": "string"
                                        },
                                        "responder": {
                                          "properties": {
                                            "displayName": {
                                              "type": "string"
                                            },
                                            "email": {
                                              "type": "string"
                                            },
                                            "objectId": {
                                              "type": "string"
                                            },
                                            "tenantId": {
                                              "type": "string"
                                            },
                                            "userPrincipalName": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "responseTime": {
                                          "type": "string"
                                        },
                                        "submitActionId": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "Post_adaptive_card_and_wait_for_a_response_2": {
                                  "type": "ApiConnectionWebhook",
                                  "inputs": {
                                    "body": {
                                      "body": {
                                        "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"large\",\n            \"weight\": \"bolder\",\n            \"text\": \"Suspicious Asset - Prisma cloud CSPM\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Asset Name : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}\",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Prisma CSPM Report\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Alert ID :  @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Policy Name : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Policy Name']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Account :  @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Account']}\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Azure Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"Close incident - False Positive\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"Close incident - True Positive\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Close incident - Benign Positive\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel incident severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Provided Alert is not remediable by Prisma Cloud\",\n            \"size\": \"Medium\",\n            \"weight\": \"Bolder\"\n        }\n    ],\n\"actions\": [\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Submit\",\n        },\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Ignore\"\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                        "recipient": {
                                          "channelId": "@parameters('ChannelID')",
                                          "groupId": "@parameters('TeamsID')"
                                        }
                                      },
                                      "notificationUrl": "@{listCallbackUrl()}"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['teams']['connectionId']"
                                      }
                                    },
                                    "path": "/v1.0/teams/conversation/gatherinput/poster/Flow bot/location/@{encodeURIComponent('Channel')}/$subscriptions"
                                  }
                                }
                              },
                              "else": {
                                "actions": {
                                  "Parse_JSON_-_Output_of_teams_adaptive_card": {
                                    "runAfter": {
                                      "Post_adaptive_card_and_wait_for_a_response": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "ParseJson",
                                    "inputs": {
                                      "content": "@body('Post_adaptive_card_and_wait_for_a_response')",
                                      "schema": {
                                        "properties": {
                                          "data": {
                                            "properties": {
                                              "incidentStatus": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "messageId": {
                                            "type": "string"
                                          },
                                          "messageLink": {
                                            "type": "string"
                                          },
                                          "responder": {
                                            "properties": {
                                              "displayName": {
                                                "type": "string"
                                              },
                                              "email": {
                                                "type": "string"
                                              },
                                              "objectId": {
                                                "type": "string"
                                              },
                                              "tenantId": {
                                                "type": "string"
                                              },
                                              "userPrincipalName": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "responseTime": {
                                            "type": "string"
                                          },
                                          "submitActionId": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      }
                                    }
                                  },
                                  "Post_adaptive_card_and_wait_for_a_response": {
                                    "type": "ApiConnectionWebhook",
                                    "inputs": {
                                      "body": {
                                        "body": {
                                          "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"large\",\n            \"weight\": \"bolder\",\n            \"text\": \"Suspicious Asset - Prisma cloud CSPM\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Asset Name : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}\",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Prisma CSPM Report\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Alert ID :  @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Policy Name : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Policy Name']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Account :  @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Account']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Remediation Details :  \",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"cli Description : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['cli Description']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Script Impact :@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Script Impact']} \",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"alertIdVsCliScript : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['alertIdVsCliScript']}\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Azure Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"Close incident - False Positive\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"Close incident - True Positive\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Close incident - Benign Positive\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel incident severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Prisma Cloud CSPM Actions\",\n            \"size\": \"Medium\",\n            \"weight\": \"Bolder\"\n        }\n    ],\n    \"actions\": [\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Run Remediation steps on asset\",\n        },\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Submit without Running Remediation steps\",\n        },\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Ignore\"\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                          "recipient": {
                                            "channelId": "@parameters('ChannelID')",
                                            "groupId": "@parameters('TeamsID')"
                                          }
                                        },
                                        "notificationUrl": "@{listCallbackUrl()}"
                                      },
                                      "host": {
                                        "connection": {
                                          "name": "@parameters('$connections')['teams']['connectionId']"
                                        }
                                      },
                                      "path": "/v1.0/teams/conversation/gatherinput/poster/Flow bot/location/@{encodeURIComponent('Channel')}/$subscriptions"
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Script Impact']",
                                      " "
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Condition_to_check_for_submit_responses": {
                              "actions": {
                                "Append_to_collect_response_variable": {
                                  "runAfter": {
                                    "Update_an_adaptive_card_in_a_chat_or_channel": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "Collect_response",
                                    "value": {
                                      "Alert id": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}",
                                      "Asset": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}",
                                      "Response Given": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']}",
                                      "Response submitter": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']}",
                                      "Status": "Alert Cant be Remediated or choosen not to"
                                    }
                                  }
                                },
                                "Update_an_adaptive_card_in_a_chat_or_channel": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"large\",\n            \"weight\": \"bolder\",\n            \"text\": \"Suspicious Asset @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}  - Microsoft Sentinel\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Response - @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']} @{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']} by @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']} \",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Alert - @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}\",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                      "messageId": "@{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['messageId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['messageId']}",
                                      "recipient": {
                                        "channelId": "@parameters('ChannelID')",
                                        "groupId": "@parameters('TeamsID')"
                                      }
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['teams']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/v1.0/teams/conversation/updateAdaptivecard/poster/Flow bot/location/@{encodeURIComponent('Channel')}"
                                  }
                                }
                              },
                              "runAfter": {
                                "Condition_to_check_for_non_remediable_alerts": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Condition_2": {
                                    "actions": {
                                      "Append_to_collect_response_variable_2": {
                                        "runAfter": {
                                          "Update_an_adaptive_card_in_a_chat_or_channel_2": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "AppendToArrayVariable",
                                        "inputs": {
                                          "name": "Collect_response",
                                          "value": {
                                            "Alert id": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}",
                                            "Asset": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}",
                                            "Response Given": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']}",
                                            "Response submitter": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']}",
                                            "Status": "Alert Ignored"
                                          }
                                        }
                                      },
                                      "Update_an_adaptive_card_in_a_chat_or_channel_2": {
                                        "type": "ApiConnection",
                                        "inputs": {
                                          "body": {
                                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"large\",\n            \"weight\": \"bolder\",\n            \"text\": \"Suspicious Asset @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}  - Microsoft Sentinel\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Response - @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']} @{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']} by @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']} \",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Alert - @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}\",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                            "messageId": "@{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['messageId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['messageId']}",
                                            "recipient": {
                                              "channelId": "@parameters('ChannelID')",
                                              "groupId": "@parameters('TeamsID')"
                                            }
                                          },
                                          "host": {
                                            "connection": {
                                              "name": "@parameters('$connections')['teams']['connectionId']"
                                            }
                                          },
                                          "method": "post",
                                          "path": "/v1.0/teams/conversation/updateAdaptivecard/poster/Flow bot/location/@{encodeURIComponent('Channel')}"
                                        }
                                      }
                                    },
                                    "else": {
                                      "actions": {
                                        "Append_to_collect_response_variable_3": {
                                          "runAfter": {
                                            "Remediate_Alert": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToArrayVariable",
                                          "inputs": {
                                            "name": "Collect_response",
                                            "value": {
                                              "Alert id": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}",
                                              "Asset": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}",
                                              "Response Given": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']}",
                                              "Response submitter": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']}",
                                              "Status": "Alert remediated succesfully"
                                            }
                                          }
                                        },
                                        "Remediate_Alert": {
                                          "runAfter": {
                                            "Update_an_adaptive_card_in_a_chat_or_channel_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "headers": {
                                              "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                                              }
                                            },
                                            "method": "patch",
                                            "path": "/alert/remediation/@{encodeURIComponent(items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id'])}"
                                          }
                                        },
                                        "Update_an_adaptive_card_in_a_chat_or_channel_3": {
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"large\",\n            \"weight\": \"bolder\",\n            \"text\": \"Suspicious Asset @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}  - Microsoft Sentinel\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Response - @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']} @{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']} by @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']} \",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Alert - @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}\",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                              "messageId": "@{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['messageId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['messageId']}",
                                              "recipient": {
                                                "channelId": "@parameters('ChannelID')",
                                                "groupId": "@parameters('TeamsID')"
                                              }
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['teams']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/v1.0/teams/conversation/updateAdaptivecard/poster/Flow bot/location/@{encodeURIComponent('Channel')}"
                                          }
                                        }
                                      }
                                    },
                                    "expression": {
                                      "or": [
                                        {
                                          "equals": [
                                            "@body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']",
                                            "Ignore"
                                          ]
                                        },
                                        {
                                          "equals": [
                                            "@body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']",
                                            "Ignore"
                                          ]
                                        }
                                      ]
                                    },
                                    "type": "If"
                                  }
                                }
                              },
                              "expression": {
                                "or": [
                                  {
                                    "equals": [
                                      "@body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']",
                                      "Submit"
                                    ]
                                  },
                                  {
                                    "equals": [
                                      "@body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']",
                                      "Submit without Running Remediation steps"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON_-_parsing_collected_alerts": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Login_Generate_Token": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "password": "@body('Get_secret')?['value']",
                              "username": "@parameters('PrismaUserID')"
                            },
                            "headers": {
                              "content-type": "application/json; charset=UTF-8"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/login"
                          }
                        },
                        "Parse_JSON_-_parsing_collected_alerts": {
                          "runAfter": {
                            "For_each_-_valid_alert_list": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@variables('collected_alerts')",
                            "schema": {
                              "items": {
                                "properties": {
                                  "Account": {
                                    "type": "string"
                                  },
                                  "Alert id": {
                                    "type": "string"
                                  },
                                  "Policy Name": {
                                    "type": "string"
                                  },
                                  "Resource Name": {
                                    "type": "string"
                                  },
                                  "Script Impact": {
                                    "type": "string"
                                  },
                                  "alertIdVsCliScript": {
                                    "type": "string"
                                  },
                                  "cli Description": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "Account",
                                  "Alert id",
                                  "Policy Name",
                                  "Resource Name",
                                  "Script Impact",
                                  "alertIdVsCliScript",
                                  "cli Description"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>No Entity is Mapped to \"hostname\" in analytic rule.<br>\n<br>\nNote : Assets column should be mapped to Hostname in entity mapping</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('collect_entities'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "For_each_-_collect_all_entity_in_one_array": {
                      "foreach": "@body('Parse_JSON_-_entities_')",
                      "actions": {
                        "Append_to_array_variable": {
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "collect_entities",
                            "value": "@items('For_each_-_collect_all_entity_in_one_array')?['properties']?['hostName']"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_-_collect_response": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Get_secret": {
                      "runAfter": {
                        "For_each_-_collect_all_entity_in_one_array": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('PrismaSecretName'))}/value"
                      }
                    },
                    "Initialize_variable_-_collect_alerts": {
                      "runAfter": {
                        "Initialize_variable_-_collect_entity": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collected_alerts",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_entity": {
                      "runAfter": {
                        "Parse_JSON_-_entities_": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collect_entities",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_response": {
                      "runAfter": {
                        "Initialize_variable_-_collect_alerts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Collect_response",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Parse_JSON_-_entities_": {
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "schema": {
                          "items": {
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "kind": {
                                "type": "string"
                              },
                              "properties": {
                                "properties": {
                                  "friendlyName": {
                                    "type": "string"
                                  },
                                  "hostName": {
                                    "type": "string"
                                  }
                                },
                                "type": "object"
                              },
                              "type": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "kind",
                              "properties",
                              "type"
                            ],
                            "type": "object"
                          },
                          "type": "array"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "PrismaCloudCSPMCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PrismacloudcspmcustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "teams": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[[variables('TeamsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Teams')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('PrismacloudcspmcustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-4')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('TeamsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('TeamsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-5')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_PrismaCloudCSPMCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Remediate assets on prisma cloud",
            "description": "This playbook provides/updates the compliance security posture details of asset in comments section of triggered incident so that SOC analysts can directly take corrective measure to prevent the attack",
            "prerequisites": [
              "1. PrismaCloudCSPM Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription.",
              "2. API Key and User ID . To get this, login into your Prisma cloud instance dashboard and navigate to Settings --> Access Control --> Access Keys --> Add",
              "3. TeamsID and channelID of your tenant is needed for posting messages on Microsoft teams",
              "4. [Important step]Store the API secret key in Key vault then provide the keyvault name and key name of the stored secret during deployment"
            ],
            "postDeployment": [
              "1. During deployment you need to provide your Key vault name ,TeamsID , channelID , User ID and API key name of stored secret key."
            ],
            "lastUpdateTime": "2023-02-03T00:00:00Z",
            "entities": [
              "host"
            ],
            "tags": [
              "Remediation",
              "Notification",
              "CSPM",
              "PrismaCloud",
              "Compliance",
              "Posture",
              "Policy"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "PrismaCloudCSPM-Remediation",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.4",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "PaloAltoPrismaCloud",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/PaloAltoPrismaCloud/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.paloaltonetworks.com/prisma/cloud\">Palo Alto Prisma Cloud</a> CSPM solution provides the capability to ingest Prisma Cloud CSPM alerts and audit logs into Microsoft Sentinel using the Prisma Cloud CSPM API. Refer to Prisma Cloud CSPM API documentation for more information.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<p>• <a href=\"https://docs.microsoft.com/azure/azure-monitor/logs/data-collector-api\">Azure Monitor HTTP Data Collector API</a></p>\n<p><strong>Data Connectors:</strong> 1, <strong>Parsers:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 11, <strong>Hunting Queries:</strong> 9, <strong>Custom Azure Logic Apps Connectors:</strong> 1, <strong>Playbooks:</strong> 2</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/PaloAltoPrismaCloud/logo/Palo-alto-logo.png\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "PaloAltoPrismaCloud",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
              "version": "[variables('analyticRuleObject11').analyticRuleVersion11]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
              "version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
              "version": "[variables('huntingQueryObject2').huntingQueryVersion2]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
              "version": "[variables('huntingQueryObject3').huntingQueryVersion3]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
              "version": "[variables('huntingQueryObject4').huntingQueryVersion4]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
              "version": "[variables('huntingQueryObject5').huntingQueryVersion5]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
              "version": "[variables('huntingQueryObject6').huntingQueryVersion6]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
              "version": "[variables('huntingQueryObject7').huntingQueryVersion7]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
              "version": "[variables('huntingQueryObject8').huntingQueryVersion8]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
              "version": "[variables('huntingQueryObject9').huntingQueryVersion9]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            },
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_PrismaCloudCSPMCustomConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_PrismaCloudCSPM-Enrichment')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_PrismaCloudCSPM-Remediation')]",
              "version": "[variables('playbookVersion3')]"
            }
          ]
        },
        "firstPublishDate": "2021-04-16",
        "providers": [
          "Palo Alto Networks"
        ],
        "categories": {
          "domains": [
            "Security - Cloud Security"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
