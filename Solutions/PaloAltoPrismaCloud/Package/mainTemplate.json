{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for PaloAltoPrismaCloud"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Palo Alto Prisma",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "solutionId": "azuresentinel.azure-sentinel-solution-paloaltoprisma",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "PaloAltoPrismaCloud",
    "_solutionVersion": "3.0.0",
    "uiConfigId1": "PaloAltoPrismaCloud",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "PaloAltoPrismaCloud",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "parserName1": "PaloAltoPrismaCloud Data Parser",
    "_parserName1": "[concat(parameters('workspace'),'/',variables('parserName1'))]",
    "parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
    "_parserId1": "[variables('parserId1')]",
    "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId1'))))]",
    "parserVersion1": "1.0.0",
    "parserContentId1": "PaloAltoPrismaCloud-Parser",
    "_parserContentId1": "[variables('parserContentId1')]",
    "_parsercontentProductId1": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('_parserContentId1'),'-', variables('parserVersion1'))))]",
    "PrismaCloudCSPMCustomConnector": "PrismaCloudCSPMCustomConnector",
    "_PrismaCloudCSPMCustomConnector": "[variables('PrismaCloudCSPMCustomConnector')]",
    "TemplateEmptyArray": "[json('[]')]",
    "blanks": "[replace('b', 'b', '')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "PrismaCloudCSPMCustomConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1'))))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','lc','-', uniqueString(concat(variables('_solutionId'),'-','LogicAppsCustomConnector','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "PrismaCloudCSPM-Enrichment": "PrismaCloudCSPM-Enrichment",
    "_PrismaCloudCSPM-Enrichment": "[variables('PrismaCloudCSPM-Enrichment')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "PrismaCloudCSPM-Enrichment",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "PrismaCloudCSPM-Remediation": "PrismaCloudCSPM-Remediation",
    "_PrismaCloudCSPM-Remediation": "[variables('PrismaCloudCSPM-Remediation')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "PrismaCloudCSPM-Remediation",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "PaloAltoPrismaCloudWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "analyticRuleVersion1": "1.0.1",
    "analyticRulecontentId1": "777d4993-31bb-4d45-b949-84f58e09fa2f",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1'))))]",
    "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId1'),'-', variables('analyticRuleVersion1'))))]",
    "analyticRuleVersion2": "1.0.1",
    "analyticRulecontentId2": "4264e133-eec2-438f-af85-05e869308f94",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2'))))]",
    "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId2'),'-', variables('analyticRuleVersion2'))))]",
    "analyticRuleVersion3": "1.0.1",
    "analyticRulecontentId3": "df89f4bf-720e-41c5-a209-15e41e400d35",
    "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
    "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
    "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3'))))]",
    "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId3'),'-', variables('analyticRuleVersion3'))))]",
    "analyticRuleVersion4": "1.0.1",
    "analyticRulecontentId4": "6098b34a-1e6b-440a-9e3b-fb4d5944ade1",
    "_analyticRulecontentId4": "[variables('analyticRulecontentId4')]",
    "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId4'))]",
    "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId4'))))]",
    "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId4'),'-', variables('analyticRuleVersion4'))))]",
    "analyticRuleVersion5": "1.0.1",
    "analyticRulecontentId5": "bd602b90-f7f9-4ae9-bf8c-3672a24deb39",
    "_analyticRulecontentId5": "[variables('analyticRulecontentId5')]",
    "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId5'))]",
    "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId5'))))]",
    "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId5'),'-', variables('analyticRuleVersion5'))))]",
    "analyticRuleVersion6": "1.0.1",
    "analyticRulecontentId6": "617b02d8-0f47-4f3c-afed-1926a45e7b28",
    "_analyticRulecontentId6": "[variables('analyticRulecontentId6')]",
    "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId6'))]",
    "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId6'))))]",
    "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId6'),'-', variables('analyticRuleVersion6'))))]",
    "analyticRuleVersion7": "1.0.1",
    "analyticRulecontentId7": "c5bf680f-fa37-47c3-9f38-e839a9b99c05",
    "_analyticRulecontentId7": "[variables('analyticRulecontentId7')]",
    "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId7'))]",
    "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId7'))))]",
    "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId7'),'-', variables('analyticRuleVersion7'))))]",
    "analyticRuleVersion8": "1.0.1",
    "analyticRulecontentId8": "ac76d9c0-17a3-4aaa-a341-48f4c0b1c882",
    "_analyticRulecontentId8": "[variables('analyticRulecontentId8')]",
    "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId8'))]",
    "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId8'))))]",
    "_analyticRulecontentProductId8": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId8'),'-', variables('analyticRuleVersion8'))))]",
    "analyticRuleVersion9": "1.0.1",
    "analyticRulecontentId9": "7f78fa52-9833-41de-b5c5-76e61b8af9c1",
    "_analyticRulecontentId9": "[variables('analyticRulecontentId9')]",
    "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId9'))]",
    "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId9'))))]",
    "_analyticRulecontentProductId9": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId9'),'-', variables('analyticRuleVersion9'))))]",
    "analyticRuleVersion10": "1.0.1",
    "analyticRulecontentId10": "119a574d-f37a-403a-a67a-4d6f5083d9cf",
    "_analyticRulecontentId10": "[variables('analyticRulecontentId10')]",
    "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId10'))]",
    "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId10'))))]",
    "_analyticRulecontentProductId10": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId10'),'-', variables('analyticRuleVersion10'))))]",
    "analyticRuleVersion11": "1.0.1",
    "analyticRulecontentId11": "4f688252-bf9b-4136-87bf-d540b5be1050",
    "_analyticRulecontentId11": "[variables('analyticRulecontentId11')]",
    "analyticRuleId11": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId11'))]",
    "analyticRuleTemplateSpecName11": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId11'))))]",
    "_analyticRulecontentProductId11": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId11'),'-', variables('analyticRuleVersion11'))))]",
    "huntingQueryVersion1": "1.0.0",
    "huntingQuerycontentId1": "f2e509e5-6eda-4626-a167-2875eb9c48af",
    "_huntingQuerycontentId1": "[variables('huntingQuerycontentId1')]",
    "huntingQueryId1": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId1'))]",
    "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId1'))))]",
    "_huntingQuerycontentProductId1": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId1'),'-', variables('huntingQueryVersion1'))))]",
    "huntingQueryVersion2": "1.0.0",
    "huntingQuerycontentId2": "21b4c55b-3a86-40a4-81c4-31945e8f7562",
    "_huntingQuerycontentId2": "[variables('huntingQuerycontentId2')]",
    "huntingQueryId2": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId2'))]",
    "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId2'))))]",
    "_huntingQuerycontentProductId2": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId2'),'-', variables('huntingQueryVersion2'))))]",
    "huntingQueryVersion3": "1.0.0",
    "huntingQuerycontentId3": "4c17ad45-fe78-4639-98cc-3b2fd173b053",
    "_huntingQuerycontentId3": "[variables('huntingQuerycontentId3')]",
    "huntingQueryId3": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId3'))]",
    "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId3'))))]",
    "_huntingQuerycontentProductId3": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId3'),'-', variables('huntingQueryVersion3'))))]",
    "huntingQueryVersion4": "1.0.0",
    "huntingQuerycontentId4": "23a0867f-a522-4b34-acf4-0eadf75fc1e7",
    "_huntingQuerycontentId4": "[variables('huntingQuerycontentId4')]",
    "huntingQueryId4": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId4'))]",
    "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId4'))))]",
    "_huntingQuerycontentProductId4": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId4'),'-', variables('huntingQueryVersion4'))))]",
    "huntingQueryVersion5": "1.0.0",
    "huntingQuerycontentId5": "dde04bfe-7237-4205-a447-258201e369e4",
    "_huntingQuerycontentId5": "[variables('huntingQuerycontentId5')]",
    "huntingQueryId5": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId5'))]",
    "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId5'))))]",
    "_huntingQuerycontentProductId5": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId5'),'-', variables('huntingQueryVersion5'))))]",
    "huntingQueryVersion6": "1.0.0",
    "huntingQuerycontentId6": "fd92609a-71bd-4da7-8388-e80147757e63",
    "_huntingQuerycontentId6": "[variables('huntingQuerycontentId6')]",
    "huntingQueryId6": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId6'))]",
    "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId6'))))]",
    "_huntingQuerycontentProductId6": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId6'),'-', variables('huntingQueryVersion6'))))]",
    "huntingQueryVersion7": "1.0.0",
    "huntingQuerycontentId7": "4a09caf2-08a2-4c1d-981d-bb734de12a29",
    "_huntingQuerycontentId7": "[variables('huntingQuerycontentId7')]",
    "huntingQueryId7": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId7'))]",
    "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId7'))))]",
    "_huntingQuerycontentProductId7": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId7'),'-', variables('huntingQueryVersion7'))))]",
    "huntingQueryVersion8": "1.0.0",
    "huntingQuerycontentId8": "08ab5107-5c4e-4baf-b0f4-bf75c044f8b1",
    "_huntingQuerycontentId8": "[variables('huntingQuerycontentId8')]",
    "huntingQueryId8": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId8'))]",
    "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId8'))))]",
    "_huntingQuerycontentProductId8": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId8'),'-', variables('huntingQueryVersion8'))))]",
    "huntingQueryVersion9": "1.0.0",
    "huntingQuerycontentId9": "d0a145c5-546d-48df-a5d7-8866f3bbe24f",
    "_huntingQuerycontentId9": "[variables('huntingQuerycontentId9')]",
    "huntingQueryId9": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId9'))]",
    "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId9'))))]",
    "_huntingQuerycontentProductId9": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId9'),'-', variables('huntingQueryVersion9'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]",
    "prismaId": "string",
    "_prismaId": "[variables('prismaId')]",
    "assetId": "94e06523e93b9b0f15ed03da031c95d5",
    "_assetId": "[variables('assetId')]",
    "accountID": "any",
    "_accountID": "[variables('accountID')]",
    "resourceID": "string",
    "_resourceID": "[variables('resourceID')]",
    "imageID": "string",
    "_imageID": "[variables('imageID')]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloud data connector with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Palo Alto Prisma Cloud CSPM (using Azure Functions)",
                  "publisher": "Palo Alto",
                  "descriptionMarkdown": "The Palo Alto Prisma Cloud CSPM data connector provides the capability to ingest [Prisma Cloud CSPM alerts](https://prisma.pan.dev/api/cloud/cspm/alerts#operation/get-alerts) and [audit logs](https://prisma.pan.dev/api/cloud/cspm/audit-logs#operation/rl-audit-logs) into Microsoft sentinel using the Prisma Cloud CSPM API. Refer to [Prisma Cloud CSPM API documentation](https://prisma.pan.dev/api/cloud/cspm) for more information.",
                  "additionalRequirementBanner": "This data connector depends on a parser based on a Kusto Function to work as expected [**PaloAltoPrismaCloud**](https://aka.ms/sentinel-PaloAltoPrismaCloud-parser) which is deployed with the Microsoft sentinel Solution.",
                  "graphQueries": [
                    {
                      "metricName": "Prisma Cloud alerts",
                      "legend": "PaloAltoPrismaCloudAlert_CL",
                      "baseQuery": "PaloAltoPrismaCloudAlert_CL"
                    },
                    {
                      "metricName": "Prisma Cloud audit logs",
                      "legend": "PaloAltoPrismaCloudAudit_CL",
                      "baseQuery": "PaloAltoPrismaCloudAudit_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All Prisma Cloud alerts",
                      "query": "PaloAltoPrismaCloudAlert_CL\n| sort by TimeGenerated desc"
                    },
                    {
                      "description": "All Prisma Cloud audit logs",
                      "query": "PaloAltoPrismaCloudAudit_CL\n| sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "PaloAltoPrismaCloudAlert_CL",
                      "lastDataReceivedQuery": "PaloAltoPrismaCloudAlert_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "PaloAltoPrismaCloudAudit_CL",
                      "lastDataReceivedQuery": "PaloAltoPrismaCloudAudit_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "PaloAltoPrismaCloudAlert_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(3d)",
                        "PaloAltoPrismaCloudAudit_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(3d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "Palo Alto Prisma Cloud API Credentials",
                        "description": "**Prisma Cloud API Url**, **Prisma Cloud Access Key ID**, **Prisma Cloud Secret Key** are required for Prisma Cloud API connection. See the documentation to learn more about [creating Prisma Cloud Access Key](https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin/manage-prisma-cloud-administrators/create-access-keys.html) and about [obtaining Prisma Cloud API Url](https://prisma.pan.dev/api/cloud/api-urls)"
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This connector uses Azure Functions to connect to the Palo Alto Prisma Cloud REST API to pull logs into Microsoft sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                    },
                    {
                      "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                    },
                    {
                      "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**PaloAltoPrismaCloud**](https://aka.ms/sentinel-PaloAltoPrismaCloud-parser) which is deployed with the Microsoft sentinel Solution."
                    },
                    {
                      "description": "**STEP 1 - Configuration of the Prisma Cloud**\n\nFollow the documentation to [create Prisma Cloud Access Key](https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin/manage-prisma-cloud-administrators/create-access-keys.html) and [obtain Prisma Cloud API Url](https://api.docs.prismacloud.io/reference)\n\n NOTE: Please use SYSTEM ADMIN role for giving access to Prisma Cloud API because only SYSTEM ADMIN role is allowed to View Prisma Cloud Audit Logs. Refer to [Prisma Cloud Administrator Permissions (paloaltonetworks.com)](https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin/manage-prisma-cloud-administrators/prisma-cloud-admin-permissions) for more details of administrator permissions."
                    },
                    {
                      "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Prisma Cloud data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following), as well as Prisma Cloud API credentials, readily available.",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Primary Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "instructions": [
                        {
                          "parameters": {
                            "instructionSteps": [
                              {
                                "title": "Option 1 - Azure Resource Manager (ARM) Template",
                                "description": "Use this method for automated deployment of the Prisma Cloud data connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-PaloAltoPrismaCloud-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Prisma Cloud API Url**, **Prisma Cloud Access Key ID**, **Prisma Cloud Secret Key**, **Microsoft sentinel Workspace Id**, **Microsoft sentinel Shared Key**\n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**.\n5. Click **Purchase** to deploy."
                              },
                              {
                                "title": "Option 2 - Manual Deployment of Azure Functions",
                                "description": "Use the following step-by-step instructions to deploy the Prisma Cloud data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                                "instructions": [
                                  {
                                    "parameters": {
                                      "instructionSteps": [
                                        {
                                          "title": "Step 1 - Deploy a Function App",
                                          "description": "**NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/create-first-function-vs-code-python) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-PaloAltoPrismaCloud-functionapp) file. Extract archive to your local development computer.\n2. Follow the [function app manual deployment instructions](https://github.com/Azure/Azure-Sentinel/blob/master/DataConnectors/AzureFunctionsManualDeployment.md#function-app-manual-deployment-instructions) to deploy the Azure Functions app using VSCode.\n3. After successful deployment of the function app, follow next steps for configuring it."
                                        },
                                        {
                                          "title": "Step 2 - Configure the Function App",
                                          "description": "1. Go to Azure Portal for the Function App configuration.\n2. In the Function App, select the Function App Name and select **Configuration**.\n3. In the **Application settings** tab, select **+ New application setting**.\n4. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tPrismaCloudAPIUrl\n\t\tPrismaCloudAccessKeyID\n\t\tPrismaCloudSecretKey\n\t\tAzureSentinelWorkspaceId\n\t\tAzureSentinelSharedKey\n\t\tlogAnalyticsUri (Optional)\n - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://WORKSPACE_ID.ods.opinsights.azure.us`. \n5. Once all application settings have been entered, click **Save**."
                                        }
                                      ]
                                    },
                                    "type": "InstructionStepsGroup"
                                  }
                                ]
                              }
                            ]
                          },
                          "type": "InstructionStepsGroup"
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "Palo Alto Prisma Cloud CSPM (using Azure Functions)",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "PaloAltoPrismaCloud",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Palo Alto Prisma Cloud CSPM (using Azure Functions)",
          "publisher": "Palo Alto",
          "descriptionMarkdown": "The Palo Alto Prisma Cloud CSPM data connector provides the capability to ingest [Prisma Cloud CSPM alerts](https://prisma.pan.dev/api/cloud/cspm/alerts#operation/get-alerts) and [audit logs](https://prisma.pan.dev/api/cloud/cspm/audit-logs#operation/rl-audit-logs) into Microsoft sentinel using the Prisma Cloud CSPM API. Refer to [Prisma Cloud CSPM API documentation](https://prisma.pan.dev/api/cloud/cspm) for more information.",
          "graphQueries": [
            {
              "metricName": "Prisma Cloud alerts",
              "legend": "PaloAltoPrismaCloudAlert_CL",
              "baseQuery": "PaloAltoPrismaCloudAlert_CL"
            },
            {
              "metricName": "Prisma Cloud audit logs",
              "legend": "PaloAltoPrismaCloudAudit_CL",
              "baseQuery": "PaloAltoPrismaCloudAudit_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "PaloAltoPrismaCloudAlert_CL",
              "lastDataReceivedQuery": "PaloAltoPrismaCloudAlert_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "PaloAltoPrismaCloudAudit_CL",
              "lastDataReceivedQuery": "PaloAltoPrismaCloudAudit_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "PaloAltoPrismaCloudAlert_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(3d)",
                "PaloAltoPrismaCloudAudit_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(3d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "All Prisma Cloud alerts",
              "query": "PaloAltoPrismaCloudAlert_CL\n| sort by TimeGenerated desc"
            },
            {
              "description": "All Prisma Cloud audit logs",
              "query": "PaloAltoPrismaCloudAudit_CL\n| sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "Palo Alto Prisma Cloud API Credentials",
                "description": "**Prisma Cloud API Url**, **Prisma Cloud Access Key ID**, **Prisma Cloud Secret Key** are required for Prisma Cloud API connection. See the documentation to learn more about [creating Prisma Cloud Access Key](https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin/manage-prisma-cloud-administrators/create-access-keys.html) and about [obtaining Prisma Cloud API Url](https://prisma.pan.dev/api/cloud/api-urls)"
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This connector uses Azure Functions to connect to the Palo Alto Prisma Cloud REST API to pull logs into Microsoft sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
            },
            {
              "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
            },
            {
              "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**PaloAltoPrismaCloud**](https://aka.ms/sentinel-PaloAltoPrismaCloud-parser) which is deployed with the Microsoft sentinel Solution."
            },
            {
              "description": "**STEP 1 - Configuration of the Prisma Cloud**\n\nFollow the documentation to [create Prisma Cloud Access Key](https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin/manage-prisma-cloud-administrators/create-access-keys.html) and [obtain Prisma Cloud API Url](https://api.docs.prismacloud.io/reference)\n\n NOTE: Please use SYSTEM ADMIN role for giving access to Prisma Cloud API because only SYSTEM ADMIN role is allowed to View Prisma Cloud Audit Logs. Refer to [Prisma Cloud Administrator Permissions (paloaltonetworks.com)](https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin/manage-prisma-cloud-administrators/prisma-cloud-admin-permissions) for more details of administrator permissions."
            },
            {
              "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Prisma Cloud data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following), as well as Prisma Cloud API credentials, readily available.",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Primary Key"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "instructions": [
                {
                  "parameters": {
                    "instructionSteps": [
                      {
                        "title": "Option 1 - Azure Resource Manager (ARM) Template",
                        "description": "Use this method for automated deployment of the Prisma Cloud data connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-PaloAltoPrismaCloud-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Prisma Cloud API Url**, **Prisma Cloud Access Key ID**, **Prisma Cloud Secret Key**, **Microsoft sentinel Workspace Id**, **Microsoft sentinel Shared Key**\n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**.\n5. Click **Purchase** to deploy."
                      },
                      {
                        "title": "Option 2 - Manual Deployment of Azure Functions",
                        "description": "Use the following step-by-step instructions to deploy the Prisma Cloud data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                        "instructions": [
                          {
                            "parameters": {
                              "instructionSteps": [
                                {
                                  "title": "Step 1 - Deploy a Function App",
                                  "description": "**NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/create-first-function-vs-code-python) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-PaloAltoPrismaCloud-functionapp) file. Extract archive to your local development computer.\n2. Follow the [function app manual deployment instructions](https://github.com/Azure/Azure-Sentinel/blob/master/DataConnectors/AzureFunctionsManualDeployment.md#function-app-manual-deployment-instructions) to deploy the Azure Functions app using VSCode.\n3. After successful deployment of the function app, follow next steps for configuring it."
                                },
                                {
                                  "title": "Step 2 - Configure the Function App",
                                  "description": "1. Go to Azure Portal for the Function App configuration.\n2. In the Function App, select the Function App Name and select **Configuration**.\n3. In the **Application settings** tab, select **+ New application setting**.\n4. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tPrismaCloudAPIUrl\n\t\tPrismaCloudAccessKeyID\n\t\tPrismaCloudSecretKey\n\t\tAzureSentinelWorkspaceId\n\t\tAzureSentinelSharedKey\n\t\tlogAnalyticsUri (Optional)\n - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://WORKSPACE_ID.ods.opinsights.azure.us`. \n5. Once all application settings have been entered, click **Save**."
                                }
                              ]
                            },
                            "type": "InstructionStepsGroup"
                          }
                        ]
                      }
                    ]
                  },
                  "type": "InstructionStepsGroup"
                }
              ]
            }
          ],
          "id": "[variables('_uiConfigId1')]",
          "additionalRequirementBanner": "This data connector depends on a parser based on a Kusto Function to work as expected [**PaloAltoPrismaCloud**](https://aka.ms/sentinel-PaloAltoPrismaCloud-parser) which is deployed with the Microsoft sentinel Solution."
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloud Data Parser with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName1')]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "PaloAltoPrismaCloud Data Parser",
                "category": "Samples",
                "functionAlias": "PaloAltoPrismaCloud",
                "query": "\nlet Audit_view = view () { \n    PaloAltoPrismaCloudAudit_CL\n    | extend \n        EventType='PaloAltoPrismaCloudAudit',\n        user=iff(isnotempty(column_ifexists('user_s', '')), column_ifexists('user_s', ''), column_ifexists('user_g', '')),\n        resourceName=iff(isnotempty(column_ifexists('resourceName_s', '')), column_ifexists('resourceName_s', ''), column_ifexists('resourceName_g', '')),\n        timestamp_d=column_ifexists('timestamp_d', ''),\n        IPAddress=column_ifexists('IPAddress', ''),\n        ResourceType=column_ifexists('ResourceType', ''),\n        action_s=column_ifexists('action_s', ''),\n        result_s=column_ifexists('result_s', '')\n    | project-rename  \n        UserName=user,\n        ResourceName=resourceName,\n        EventEndTime=timestamp_d,\n        SrcIpAddr=IPAddress,\n        EventMessage=action_s,\n        EventResult=result_s\n    | project-away\n        user_s,\n        resourceName_s\n};\nlet Alert_view = view () { \n    PaloAltoPrismaCloudAlert_CL\n    | extend \n        EventType='PaloAltoPrismaCloudAlert',\n        reason_s=column_ifexists('reason_s', ''),\n        policy_name_s=column_ifexists('policy_name_s', ''),\n        policy_description_s=column_ifexists('policy_description_s', ''),\n        policy_severity_s=column_ifexists('policy_severity_s', ''),\n        policy_recommendation_s=column_ifexists('policy_recommendation_s', ''),\n        policy_labels_s=column_ifexists('policy_labels_s', ''),\n        policy_lastModifiedOn_d=column_ifexists('policy_lastModifiedOn_d', ''),\n        policy_lastModifiedBy_s=column_ifexists('policy_lastModifiedBy_s', ''),\n        policy_deleted_b=column_ifexists('policy_deleted_b', ''),\n        policy_remediation_description_s=column_ifexists('policy_remediation_description_s', ''),\n        policy_remediation_impact_s=column_ifexists('policy_remediation_impact_s', ''),\n        policy_remediation_cliScriptTemplate_s=column_ifexists('policy_remediation_cliScriptTemplate_s', ''),\n        history_s=column_ifexists('history_s', ''),\n        resource_data_mfa_active_b=column_ifexists('resource_data_mfa_active_b', ''),\n        resource_data_cert_1_active_b=column_ifexists('resource_data_cert_1_active_b', ''),\n        resource_data_cert_2_active_b=column_ifexists('resource_data_cert_2_active_b', ''),\n        resource_data_password_enabled_s=column_ifexists('resource_data_password_enabled_s', ''),\n        resource_data_password_last_used_s=column_ifexists('resource_data_password_last_used_s', ''),\n        resource_data_user_creation_time_t=column_ifexists('resource_data_user_creation_time_t', ''),\n        resource_data_access_key_1_active_b=column_ifexists('resource_data_access_key_1_active_b', ''),\n        resource_data_access_key_2_active_b=column_ifexists('resource_data_access_key_2_active_b', ''),\n        resource_data_cert_1_last_rotated_s=column_ifexists('resource_data_cert_1_last_rotated_s', ''),\n        resource_data_cert_2_last_rotated_s=column_ifexists('resource_data_cert_2_last_rotated_s', ''),\n        resource_data_password_last_changed_s=column_ifexists('resource_data_password_last_changed_s', ''),\n        resource_data_password_next_rotation_s=column_ifexists('resource_data_password_next_rotation_s', ''),\n        resource_data_access_key_1_last_rotated_t=column_ifexists('resource_data_access_key_1_last_rotated_t', ''),\n        resource_data_access_key_2_last_rotated_s=column_ifexists('resource_data_access_key_2_last_rotated_s', ''),\n        resource_data_access_key_1_last_used_date_t=column_ifexists('resource_data_access_key_1_last_used_date_t', ''),\n        resource_data_access_key_2_last_used_date_s=column_ifexists('resource_data_access_key_2_last_used_date_s', ''),\n        resource_data_access_key_1_last_used_region_s=column_ifexists('resource_data_access_key_1_last_used_region_s', ''),\n        resource_data_access_key_2_last_used_region_s=column_ifexists('resource_data_access_key_2_last_used_region_s', ''),\n        resource_data_access_key_1_last_used_service_s=column_ifexists('resource_data_access_key_1_last_used_service_s', ''),\n        resource_data_access_key_2_last_used_service_s=column_ifexists('resource_data_access_key_2_last_used_service_s', ''),\n        resource_rrn_s=column_ifexists('resource_rrn_s', ''),\n        resource_name_s=column_ifexists('resource_name_s', ''),\n        resource_account_s=column_ifexists('resource_account_s', ''),\n        resource_accountId_s=column_ifexists('resource_accountId_s', ''),\n        resource_cloudAccountGroups_s=column_ifexists('resource_cloudAccountGroups_s', ''),\n        resource_region_s=column_ifexists('resource_region_s', ''),\n        resource_regionId_s=column_ifexists('resource_regionId_s', ''),\n        resource_resourceType_s=column_ifexists('resource_resourceType_s', ''),\n        resource_resourceApiName_s=column_ifexists('resource_resourceApiName_s', ''),\n        resource_url_s=column_ifexists('resource_url_s', ''),\n        resource_data_arn_s=column_ifexists('resource_data_arn_s', ''),\n        resource_data_user_s=column_ifexists('resource_data_user_s', ''),\n        resource_additionalInfo_accessKeyAge_s=column_ifexists('resource_additionalInfo_accessKeyAge_s', ''),\n        resource_additionalInfo_inactiveSinceTs_s=column_ifexists('resource_additionalInfo_inactiveSinceTs_s', ''),\n        resource_cloudType_s=column_ifexists('resource_cloudType_s', ''),\n        resource_resourceTs_d=column_ifexists('resource_resourceTs_d', ''),\n        id_s=column_ifexists('id_s', ''),\n        policy_policyId_g=column_ifexists('policy_policyId_g', ''),\n        policy_policyType_s=column_ifexists('policy_policyType_s', ''),\n        policy_systemDefault_b=column_ifexists('policy_systemDefault_b', ''),\n        policy_remediable_b=column_ifexists('policy_remediable_b', ''),\n        alertRules_s=column_ifexists('alertRules_s', ''),\n        riskDetail_riskScore_score_d=column_ifexists('riskDetail_riskScore_score_d', ''),\n        riskDetail_riskScore_maxScore_d=column_ifexists('riskDetail_riskScore_maxScore_d', ''),\n        riskDetail_rating_s=column_ifexists('riskDetail_rating_s', ''),\n        riskDetail_score_s=column_ifexists('riskDetail_score_s', ''),\n        status_s=column_ifexists('status_s', ''),\n        firstSeen_d=column_ifexists('firstSeen_d', ''),\n        lastSeen_d=column_ifexists('lastSeen_d', ''),\n        alertTime_d=column_ifexists('alertTime_d', ''),\n        resource_id=iff(isnotempty(column_ifexists('resource_id_s', '')), column_ifexists('resource_id_s', ''), column_ifexists('resource_id_g', ''))\n    | project-rename\n        Reason=reason_s,\n        AlertMessage=policy_name_s,\n        AlertDescription=policy_description_s,\n        AlertSeverity=policy_severity_s,\n        PolicyRecommendation=policy_recommendation_s,\n        PolicyLabels=policy_labels_s,\n        PolicyLastModifiedOn=policy_lastModifiedOn_d,\n        PolicyLastModifiedBy=policy_lastModifiedBy_s,\n        PolicyDeleted=policy_deleted_b,\n        PolicyRemediationDescription=policy_remediation_description_s,\n        PolicyRemediationImpact=policy_remediation_impact_s,\n        PolicyRemediationCliScriptTemplate=policy_remediation_cliScriptTemplate_s,\n        ResourceId=resource_id,\n        History=history_s,\n        ResourceDataMfaActive=resource_data_mfa_active_b,\n        ResourceDataCert1Active=resource_data_cert_1_active_b,\n        ResourceDataCert2Active=resource_data_cert_2_active_b,\n        ResourceDataPasswordEnabled=resource_data_password_enabled_s,\n        ResourceDataPasswordLastUsed=resource_data_password_last_used_s,\n        ResourceDataUserCreationTime=resource_data_user_creation_time_t,\n        ResourceDataAccessKey1Active=resource_data_access_key_1_active_b,\n        ResourceDataAccessKey2Active=resource_data_access_key_2_active_b,\n        ResourceDataCert1LastRotated=resource_data_cert_1_last_rotated_s,\n        ResourceDataCert2LastRotated=resource_data_cert_2_last_rotated_s,\n        ResourceDataPasswordLastChanged=resource_data_password_last_changed_s,\n        ResourceDataPasswordNextRotation=resource_data_password_next_rotation_s,\n        ResourceDataAccessKey1LastRotated=resource_data_access_key_1_last_rotated_t,\n        ResourceDataAccessKey2LastRotated=resource_data_access_key_2_last_rotated_s,\n        ResourceDataAccessKey1LastUsedDate=resource_data_access_key_1_last_used_date_t,\n        ResourceDataAccessKey2LastUsedDate=resource_data_access_key_2_last_used_date_s,\n        ResourceDataAccessKey1LastUsedRegion=resource_data_access_key_1_last_used_region_s,\n        ResourceDataAccessKey2LastUsedRegion=resource_data_access_key_2_last_used_region_s,\n        ResourceDataAccessKey1LastUsedService=resource_data_access_key_1_last_used_service_s,\n        ResourceDataAccessKey2LastUsedService=resource_data_access_key_2_last_used_service_s,\n        ResourceRrn=resource_rrn_s,\n        ResourceName=resource_name_s,\n        ResourceAccount=resource_account_s,\n        ResourceAccountId=resource_accountId_s,\n        ResourceCloudAccountGroups=resource_cloudAccountGroups_s,\n        ResourceRegion=resource_region_s,\n        ResourceRegionId=resource_regionId_s,\n        ResourceResourceType=resource_resourceType_s,\n        ResourceResourceApiName=resource_resourceApiName_s,\n        ResourceUrl=resource_url_s,\n        ResourceDataArn=resource_data_arn_s,\n        ResourceDataUser=resource_data_user_s,\n        ResourceAdditionalInfoAccessKeyAge=resource_additionalInfo_accessKeyAge_s,\n        ResourceAdditionalInfoInactiveSinceTs=resource_additionalInfo_inactiveSinceTs_s,\n        ResourceCloudType=resource_cloudType_s,\n        ResourceResourceTs=resource_resourceTs_d,\n        AlertId=id_s,\n        PolicyPolicyId=policy_policyId_g,\n        PolicyPolicyType=policy_policyType_s,\n        PolicySystemDefault=policy_systemDefault_b,\n        PolicyRemediable=policy_remediable_b,\n        AlertRules=alertRules_s,\n        RiskDetailRiskScoreScore=riskDetail_riskScore_score_d,\n        RiskDetailRiskScoreMaxScore=riskDetail_riskScore_maxScore_d,\n        RiskDetailRating=riskDetail_rating_s,\n        RiskDetailScore=riskDetail_score_s,\n        Status=status_s,\n        FirstSeen=firstSeen_d,\n        LastSeen=lastSeen_d,\n        AlertTime=alertTime_d\n    | project-away\n        resource_id_s\n};\nunion isfuzzy=true Alert_view, Audit_view",
                "functionParameters": "",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "PaloAltoPrismaCloud Data Parser"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName1')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
                "contentId": "[variables('_parserContentId1')]",
                "kind": "Parser",
                "version": "[variables('parserVersion1')]",
                "source": {
                  "name": "PaloAltoPrismaCloud",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_parserContentId1')]",
        "contentKind": "Parser",
        "displayName": "PaloAltoPrismaCloud Data Parser",
        "contentProductId": "[variables('_parsercontentProductId1')]",
        "id": "[variables('_parsercontentProductId1')]",
        "version": "[variables('parserVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName1')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "PaloAltoPrismaCloud Data Parser",
        "category": "Samples",
        "functionAlias": "PaloAltoPrismaCloud",
        "query": "\nlet Audit_view = view () { \n    PaloAltoPrismaCloudAudit_CL\n    | extend \n        EventType='PaloAltoPrismaCloudAudit',\n        user=iff(isnotempty(column_ifexists('user_s', '')), column_ifexists('user_s', ''), column_ifexists('user_g', '')),\n        resourceName=iff(isnotempty(column_ifexists('resourceName_s', '')), column_ifexists('resourceName_s', ''), column_ifexists('resourceName_g', '')),\n        timestamp_d=column_ifexists('timestamp_d', ''),\n        IPAddress=column_ifexists('IPAddress', ''),\n        ResourceType=column_ifexists('ResourceType', ''),\n        action_s=column_ifexists('action_s', ''),\n        result_s=column_ifexists('result_s', '')\n    | project-rename  \n        UserName=user,\n        ResourceName=resourceName,\n        EventEndTime=timestamp_d,\n        SrcIpAddr=IPAddress,\n        EventMessage=action_s,\n        EventResult=result_s\n    | project-away\n        user_s,\n        resourceName_s\n};\nlet Alert_view = view () { \n    PaloAltoPrismaCloudAlert_CL\n    | extend \n        EventType='PaloAltoPrismaCloudAlert',\n        reason_s=column_ifexists('reason_s', ''),\n        policy_name_s=column_ifexists('policy_name_s', ''),\n        policy_description_s=column_ifexists('policy_description_s', ''),\n        policy_severity_s=column_ifexists('policy_severity_s', ''),\n        policy_recommendation_s=column_ifexists('policy_recommendation_s', ''),\n        policy_labels_s=column_ifexists('policy_labels_s', ''),\n        policy_lastModifiedOn_d=column_ifexists('policy_lastModifiedOn_d', ''),\n        policy_lastModifiedBy_s=column_ifexists('policy_lastModifiedBy_s', ''),\n        policy_deleted_b=column_ifexists('policy_deleted_b', ''),\n        policy_remediation_description_s=column_ifexists('policy_remediation_description_s', ''),\n        policy_remediation_impact_s=column_ifexists('policy_remediation_impact_s', ''),\n        policy_remediation_cliScriptTemplate_s=column_ifexists('policy_remediation_cliScriptTemplate_s', ''),\n        history_s=column_ifexists('history_s', ''),\n        resource_data_mfa_active_b=column_ifexists('resource_data_mfa_active_b', ''),\n        resource_data_cert_1_active_b=column_ifexists('resource_data_cert_1_active_b', ''),\n        resource_data_cert_2_active_b=column_ifexists('resource_data_cert_2_active_b', ''),\n        resource_data_password_enabled_s=column_ifexists('resource_data_password_enabled_s', ''),\n        resource_data_password_last_used_s=column_ifexists('resource_data_password_last_used_s', ''),\n        resource_data_user_creation_time_t=column_ifexists('resource_data_user_creation_time_t', ''),\n        resource_data_access_key_1_active_b=column_ifexists('resource_data_access_key_1_active_b', ''),\n        resource_data_access_key_2_active_b=column_ifexists('resource_data_access_key_2_active_b', ''),\n        resource_data_cert_1_last_rotated_s=column_ifexists('resource_data_cert_1_last_rotated_s', ''),\n        resource_data_cert_2_last_rotated_s=column_ifexists('resource_data_cert_2_last_rotated_s', ''),\n        resource_data_password_last_changed_s=column_ifexists('resource_data_password_last_changed_s', ''),\n        resource_data_password_next_rotation_s=column_ifexists('resource_data_password_next_rotation_s', ''),\n        resource_data_access_key_1_last_rotated_t=column_ifexists('resource_data_access_key_1_last_rotated_t', ''),\n        resource_data_access_key_2_last_rotated_s=column_ifexists('resource_data_access_key_2_last_rotated_s', ''),\n        resource_data_access_key_1_last_used_date_t=column_ifexists('resource_data_access_key_1_last_used_date_t', ''),\n        resource_data_access_key_2_last_used_date_s=column_ifexists('resource_data_access_key_2_last_used_date_s', ''),\n        resource_data_access_key_1_last_used_region_s=column_ifexists('resource_data_access_key_1_last_used_region_s', ''),\n        resource_data_access_key_2_last_used_region_s=column_ifexists('resource_data_access_key_2_last_used_region_s', ''),\n        resource_data_access_key_1_last_used_service_s=column_ifexists('resource_data_access_key_1_last_used_service_s', ''),\n        resource_data_access_key_2_last_used_service_s=column_ifexists('resource_data_access_key_2_last_used_service_s', ''),\n        resource_rrn_s=column_ifexists('resource_rrn_s', ''),\n        resource_name_s=column_ifexists('resource_name_s', ''),\n        resource_account_s=column_ifexists('resource_account_s', ''),\n        resource_accountId_s=column_ifexists('resource_accountId_s', ''),\n        resource_cloudAccountGroups_s=column_ifexists('resource_cloudAccountGroups_s', ''),\n        resource_region_s=column_ifexists('resource_region_s', ''),\n        resource_regionId_s=column_ifexists('resource_regionId_s', ''),\n        resource_resourceType_s=column_ifexists('resource_resourceType_s', ''),\n        resource_resourceApiName_s=column_ifexists('resource_resourceApiName_s', ''),\n        resource_url_s=column_ifexists('resource_url_s', ''),\n        resource_data_arn_s=column_ifexists('resource_data_arn_s', ''),\n        resource_data_user_s=column_ifexists('resource_data_user_s', ''),\n        resource_additionalInfo_accessKeyAge_s=column_ifexists('resource_additionalInfo_accessKeyAge_s', ''),\n        resource_additionalInfo_inactiveSinceTs_s=column_ifexists('resource_additionalInfo_inactiveSinceTs_s', ''),\n        resource_cloudType_s=column_ifexists('resource_cloudType_s', ''),\n        resource_resourceTs_d=column_ifexists('resource_resourceTs_d', ''),\n        id_s=column_ifexists('id_s', ''),\n        policy_policyId_g=column_ifexists('policy_policyId_g', ''),\n        policy_policyType_s=column_ifexists('policy_policyType_s', ''),\n        policy_systemDefault_b=column_ifexists('policy_systemDefault_b', ''),\n        policy_remediable_b=column_ifexists('policy_remediable_b', ''),\n        alertRules_s=column_ifexists('alertRules_s', ''),\n        riskDetail_riskScore_score_d=column_ifexists('riskDetail_riskScore_score_d', ''),\n        riskDetail_riskScore_maxScore_d=column_ifexists('riskDetail_riskScore_maxScore_d', ''),\n        riskDetail_rating_s=column_ifexists('riskDetail_rating_s', ''),\n        riskDetail_score_s=column_ifexists('riskDetail_score_s', ''),\n        status_s=column_ifexists('status_s', ''),\n        firstSeen_d=column_ifexists('firstSeen_d', ''),\n        lastSeen_d=column_ifexists('lastSeen_d', ''),\n        alertTime_d=column_ifexists('alertTime_d', ''),\n        resource_id=iff(isnotempty(column_ifexists('resource_id_s', '')), column_ifexists('resource_id_s', ''), column_ifexists('resource_id_g', ''))\n    | project-rename\n        Reason=reason_s,\n        AlertMessage=policy_name_s,\n        AlertDescription=policy_description_s,\n        AlertSeverity=policy_severity_s,\n        PolicyRecommendation=policy_recommendation_s,\n        PolicyLabels=policy_labels_s,\n        PolicyLastModifiedOn=policy_lastModifiedOn_d,\n        PolicyLastModifiedBy=policy_lastModifiedBy_s,\n        PolicyDeleted=policy_deleted_b,\n        PolicyRemediationDescription=policy_remediation_description_s,\n        PolicyRemediationImpact=policy_remediation_impact_s,\n        PolicyRemediationCliScriptTemplate=policy_remediation_cliScriptTemplate_s,\n        ResourceId=resource_id,\n        History=history_s,\n        ResourceDataMfaActive=resource_data_mfa_active_b,\n        ResourceDataCert1Active=resource_data_cert_1_active_b,\n        ResourceDataCert2Active=resource_data_cert_2_active_b,\n        ResourceDataPasswordEnabled=resource_data_password_enabled_s,\n        ResourceDataPasswordLastUsed=resource_data_password_last_used_s,\n        ResourceDataUserCreationTime=resource_data_user_creation_time_t,\n        ResourceDataAccessKey1Active=resource_data_access_key_1_active_b,\n        ResourceDataAccessKey2Active=resource_data_access_key_2_active_b,\n        ResourceDataCert1LastRotated=resource_data_cert_1_last_rotated_s,\n        ResourceDataCert2LastRotated=resource_data_cert_2_last_rotated_s,\n        ResourceDataPasswordLastChanged=resource_data_password_last_changed_s,\n        ResourceDataPasswordNextRotation=resource_data_password_next_rotation_s,\n        ResourceDataAccessKey1LastRotated=resource_data_access_key_1_last_rotated_t,\n        ResourceDataAccessKey2LastRotated=resource_data_access_key_2_last_rotated_s,\n        ResourceDataAccessKey1LastUsedDate=resource_data_access_key_1_last_used_date_t,\n        ResourceDataAccessKey2LastUsedDate=resource_data_access_key_2_last_used_date_s,\n        ResourceDataAccessKey1LastUsedRegion=resource_data_access_key_1_last_used_region_s,\n        ResourceDataAccessKey2LastUsedRegion=resource_data_access_key_2_last_used_region_s,\n        ResourceDataAccessKey1LastUsedService=resource_data_access_key_1_last_used_service_s,\n        ResourceDataAccessKey2LastUsedService=resource_data_access_key_2_last_used_service_s,\n        ResourceRrn=resource_rrn_s,\n        ResourceName=resource_name_s,\n        ResourceAccount=resource_account_s,\n        ResourceAccountId=resource_accountId_s,\n        ResourceCloudAccountGroups=resource_cloudAccountGroups_s,\n        ResourceRegion=resource_region_s,\n        ResourceRegionId=resource_regionId_s,\n        ResourceResourceType=resource_resourceType_s,\n        ResourceResourceApiName=resource_resourceApiName_s,\n        ResourceUrl=resource_url_s,\n        ResourceDataArn=resource_data_arn_s,\n        ResourceDataUser=resource_data_user_s,\n        ResourceAdditionalInfoAccessKeyAge=resource_additionalInfo_accessKeyAge_s,\n        ResourceAdditionalInfoInactiveSinceTs=resource_additionalInfo_inactiveSinceTs_s,\n        ResourceCloudType=resource_cloudType_s,\n        ResourceResourceTs=resource_resourceTs_d,\n        AlertId=id_s,\n        PolicyPolicyId=policy_policyId_g,\n        PolicyPolicyType=policy_policyType_s,\n        PolicySystemDefault=policy_systemDefault_b,\n        PolicyRemediable=policy_remediable_b,\n        AlertRules=alertRules_s,\n        RiskDetailRiskScoreScore=riskDetail_riskScore_score_d,\n        RiskDetailRiskScoreMaxScore=riskDetail_riskScore_maxScore_d,\n        RiskDetailRating=riskDetail_rating_s,\n        RiskDetailScore=riskDetail_score_s,\n        Status=status_s,\n        FirstSeen=firstSeen_d,\n        LastSeen=lastSeen_d,\n        AlertTime=alertTime_d\n    | project-away\n        resource_id_s\n};\nunion isfuzzy=true Alert_view, Audit_view",
        "functionParameters": "",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "PaloAltoPrismaCloud Data Parser"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId1')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
        "contentId": "[variables('_parserContentId1')]",
        "kind": "Parser",
        "version": "[variables('parserVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "PaloAltoPrismaCloud",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PrismaCloudCSPMCustomConnector Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "CustomConnectorName": {
              "defaultValue": "PrismaCloudCSPMCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same in all Prisma Cloud automation playbooks as well"
              }
            },
            "PrismaCloudAPIURL": {
              "type": "String",
              "metadata": {
                "description": "Check documentation of prisma cloud for Actual API url (https://prisma.pan.dev/api/cloud/api-urls) . Note: Do NOT prefix with https:// or http:// etc"
              }
            }
          },
          "variables": {
            "api_host": "[[replace(replace(parameters('PrismaCloudAPIURL'),'https://',''),'http://','')]",
            "ServiceName": "[[concat('https://', variables('api_host'))]",
            "operationId-RefreshToken": "RefreshToken",
            "_operationId-RefreshToken": "[[variables('operationId-RefreshToken')]",
            "operationId-LoginGenerateToken": "LoginGenerateToken",
            "_operationId-LoginGenerateToken": "[[variables('operationId-LoginGenerateToken')]",
            "operationId-AssetInventoryViewV2": "AssetInventoryViewV2",
            "_operationId-AssetInventoryViewV2": "[[variables('operationId-AssetInventoryViewV2')]",
            "operationId-AssetInventoryTrendViewV2": "AssetInventoryTrendViewV2",
            "_operationId-AssetInventoryTrendViewV2": "[[variables('operationId-AssetInventoryTrendViewV2')]",
            "operationId-AssetsResourceScan": "AssetsResourceScan",
            "_operationId-AssetsResourceScan": "[[variables('operationId-AssetsResourceScan')]",
            "operationId-AssetsEnrichment": "AssetsEnrichment",
            "_operationId-AssetsEnrichment": "[[variables('operationId-AssetsEnrichment')]",
            "operationId-ListAlerts": "ListAlerts",
            "_operationId-ListAlerts": "[[variables('operationId-ListAlerts')]",
            "operationId-GetAlertInfo": "GetAlertInfo",
            "_operationId-GetAlertInfo": "[[variables('operationId-GetAlertInfo')]",
            "operationId-GetAnomalyTrustedList": "GetAnomalyTrustedList",
            "_operationId-GetAnomalyTrustedList": "[[variables('operationId-GetAnomalyTrustedList')]",
            "operationId-AddEntriesToAnomalyTrustedList": "AddEntriesToAnomalyTrustedList",
            "_operationId-AddEntriesToAnomalyTrustedList": "[[variables('operationId-AddEntriesToAnomalyTrustedList')]",
            "operationId-ListRemediationCommand": "ListRemediationCommand",
            "_operationId-ListRemediationCommand": "[[variables('operationId-ListRemediationCommand')]",
            "operationId-RemediateAlert": "RemediateAlert",
            "_operationId-RemediateAlert": "[[variables('operationId-RemediateAlert')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId1": "PrismaCloudCSPMCustomConnector",
            "playbookId1": "[[resourceId('Microsoft.Web/customApis', parameters('CustomConnectorName'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('CustomConnectorName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "capabilities": "[variables('TemplateEmptyArray')]",
                "description": "[[concat(parameters('CustomConnectorName'),' connects to Prisma Cloud CSPM services end point to runs any Prisma supported API get/post/patch calls and gives response back in JSON format. \n\nNote: For better understanding , check https://prisma.pan.dev/api/cloud/cspm/')]",
                "displayName": "[[parameters('CustomConnectorName')]",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANMAAAEACAYAAAAp2kPsAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAJOgAACToAYJjBRwAAAOWaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0OCA3OS4xNjM4NTgsIDIwMTkvMDMvMDYtMDM6MTg6MzYgICAgICAgICI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczpkYW09Imh0dHA6Ly93d3cuZGF5LmNvbS9kYW0vMS4wIgogICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIGRhbTpQaHlzaWNhbGhlaWdodGluaW5jaGVzPSIzLjU1NjM2NTcyODM3ODI5NiIKICAgZGFtOlBoeXNpY2Fsd2lkdGhpbmluY2hlcz0iMTcuNjE1MTIzNzQ4Nzc5Mjk3IgogICBkYW06RmlsZWZvcm1hdD0iUE5HIgogICBkYW06UHJvZ3Jlc3NpdmU9Im5vIgogICBkYW06Qml0c3BlcnBpeGVsPSIzMiIKICAgZGFtOk1JTUV0eXBlPSJpbWFnZS9wbmciCiAgIGRhbTpQaHlzaWNhbHdpZHRoaW5kcGk9IjcyIgogICBkYW06UGh5c2ljYWxoZWlnaHRpbmRwaT0iNzIiCiAgIGRhbTpOdW1iZXJvZmltYWdlcz0iMSIKICAgZGFtOk51bWJlcm9mdGV4dHVhbGNvbW1lbnRzPSIwIgogICB0aWZmOkltYWdlTGVuZ3RoPSIyNTYiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMTI2OCIKICAgZGM6Zm9ybWF0PSJpbWFnZS9wbmciCiAgIGRjOm1vZGlmaWVkPSIyMDIxLTA2LTE1VDA1OjE1OjAxLjQxMy0wNzowMCIvPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PnDSuR8AAAoUSURBVHhe7d1LjlzlHYbxcoOAGAMW8iBSIhkpA4ZkCbADlgArSFiB8QpwVkCWwA6AHcCQQSQsORIDhAwYEoOJ49d1Du6ursu5fJf/5flJFlU9Qb48evuc8nd85fETG6Rw/9HjzRcPft28ff2F4Sso6Wz4L4JTSO98+d3ms/u/DF9BacSUwBjSFw8eDV9BDcQUHCG1Q0yBEVJbxBQUIbVHTAERUh/EFAwh9UNMgRBSX8QUBCH1R0wBEJINxOQcIdlBTI4Rki3E5BQh2UNMDhGSTcTkDCHZRUyOEJJtxOQEIdlHTA4Qkg/EZBwh+UFMhhGSL8RkFCH5Q0wGEZJPxGQMIflFTIYQkm/EZAQh+UdMBhBSDMTUGSHFQUwdEVIsxNQJIcVDTB0QUkzE1BghxUVMDRFSbMTUCCHFR0wNEFIOxFQZIeVBTBURUi7EVAkh5UNMFRBSTsRUGCHlRUwFEVJuxFQIIYGYCiAkCDGtREgYEdMKhITziGkhQsIuYlqAkLAPMc1ESDiEmGYgJBxDTBMREk4hpgkICVMQ0wmEhKmI6YiIId19+L/hFUojpgMihnT9+Subz+7/svn6v78NX0FJxLRH1G/t/vanq5s3Xnpuc/vuT8NXUBIx7Ygaklbp739++enrf37zH9apAmI6J/LNBq2SghqxTuUR0yBySOdXaaR1ivhz7YmYnogckuyu0uiDf/04vEIJ6WOKHpJuOOyu0kh39vQDZaSOKXpIcuvmy3tXacS1UzlpY8oQklbpvT/+YXi3H+tUTsqYMoQkWqUpWKcy0sWUJaQpqzTSMn3y7cPhHZZKFVOWkOSjv7wyvJqGO3vrpYkpU0hvX39h8+6NF4d30+hvROizJyyXIqZMIcnUa6VdXDutEz6mbCFplfRjCdZpndAxZQtJlq7SSOukXzfMFzamjCGtWaWR1unOPb7dWyJkTBlDkrl38A75x79/Zp0WCBdT1pD0mdJfrz0/vFtHv4as03yhYsoakqy9VtrFOs0XJqbMIWmV9DceSmKd5gsRU+aQpPQqjbROHG+fzn1M2UOqsUoj/dryQe50rmPKHpLOKZW6g3cID1+Zzm1M2UOSQ8fRS2OdpnEZEyHtf0hKLazTNO5iIqStVqs0Yp1OcxUTIW21XKWR1onj7ce5iYmQnrl181rTVRqxTse5iImQntk+uuvq8K4tHr5ynPmYCOmiWh/QTsU6HWY6JkK6aM5DUmphnQ4zGxMhXdZ7lUY8fGU/kzER0mUWVmmk3xeOt19mLiZC2u/jN18dXtnAtdNlpmIipP1KHEcvjYevXGYmJkI6zMq10i7W6SITMRHSYRZXacQ6XdQ9JkI6zuoqjXRnT7+H6BwTIR1neZVG+j3kePtWt5gI6TRrd/AO4eErW11iIqTTah5HL4112moeEyFNY/1aaRfr1DgmQprG0yqNWKeGMRHSdN5WaaTPnTIfb28SEyFNp5C8rdJ5mT/IrR4TIU3X4zh6aZkfvlI1JkKap/VDUmrJuk7VYiKkeSKs0ijrOlWJiZDmi7JKo/e/+mF4lUfxmAhpvkirNMp4vL1oTIS0jJ4XHmmVRtmunYrFREjLWDqOXlq2dSoSEyEt5/UD2qkyrdPqmAhpucirNMq0TqtiIqR1oq/SKMudvcUxEdI6+pfRo6/SKMvx9kUxEdJ6tf/FP2syXDvNjomQ1vNwHL20DOs0KyZCKiPLtdKu6Os0OSZCKiPjKo20Tnfu/Ty8i2dSTIRUTtZVGt2+++Dpn6eITsZESOXo7l3WVRrpz1PU4+1HYyKksrKv0ijqw1cOxkRIZXl8SEotUddpb0yEVB6rdFHEdboUEyGVxypdpj9n0f4FwgsxEVJ5OqfEKu0X7Xj77zERUh06js4qHRbpg9ynMRFSHRGPo5cWaZ3OCKmeaA9JqSXKOp0RUh2s0nRapwh/Bs8IqQ5WaZ4Id/b2fs6EdXTDgVWaJ8LxdmKqQLfCWaX5vF87EVNhGR6SUov3dSKmwviAdh3P60RMBbFK62mZvB5vP+N7+3KyPSSlFq/rdPbpW69zsVyADv29e+PF4R3W8PrwlTM9v42g1uNaqSyP6/T0momg1sn8kJRaPK7T7zcgCGo5VqkOrZP+7qgXF+7mEdR8rFI920eD+fl279KtcYKahzt4dXk63r73cyaCmkafKenXCvUoJC/rtDcmIajTuFZqw8s6HYxJCOowHpLSjpd1OhqTENR+rFJbWifrx9tPxiQEdRGr1J7WyfoHuZNiEoLa0s+fO3h9WH/4yuSYhKA4jt6b5XWaFZNkDko/Z46j92V5nWbHJFmDYpVssPrwlUUxSbagWCU7Pvn2ocnj7YtjkkxB3bp5jVUyxOK106qYJENQ20d3XR3ewQKLD19ZHZNED4oPaG2ytk5FYpKoQfGQFLusrVOxmCRiUKySbZbu7BWNSSIFxSrZp2flWzneXjwmiRLUx2++OryCZVaunarEJN6D4ji6H1YevlItJvEcFNdKvlhYp6oxicegWCV/LKxT9ZjEW1Cskk+6s9fzeHuTmMRLUKySX72PtzeLSTwExR0833o+fKVpTGI5KI6j+9dznZrHJFaD4lophl7r1CUmsRYUqxSHQrp998Hwrp1uMYmloFilWO7ca/9osK4xiYWgFBKrFE/rD3K7xyQ9g9L/k+PoMbV++IqJmKRXUDwkJbaW62QmJmkdFKsUX8t1MhWTtAyKVcrh/a9+GF7VdeXxE8NrU3To650vv6v6eYEekvLac7li+vz7X4dXuehvttS+yWQ2JmkRVDa6c/nhG9eGdyjJ3Ld551m4bQ5MZTomISh4YT4mISh44CImIShY5yYmIShY5iomIShY5S4mIShY5DImIShY4zYmIShY4jomIShY4T4mIShYECImISj0FiYmISj0FComISj0Ei4mISj0EDImISi0FjYmISi0FDomISi0Ej4mISi0kCImISjUliYmISjUlComISjUki4mISjUkDImISiUljYmISiUlDomISiUkj4mISiUQEwDgsJaxHQOQWENYtpBUFiKmPYgKCxBTAcQFOYipiMICnMQ0wkEhamIaQKCwhTENBFB4RRimoGgcAwxzURQOISYFiAo7ENMCxEUdhHTCgSF84hpJYLCiJgKICgIMRVCUCCmgggqN2IqjKDyIqYKCConYqqEoPIhpooIKhdiqoyg8iCmBggqB2JqhKDiI6aGCCo2YmqMoOIipg4IKiZi6oSg4iGmjggqFmLqjKDiICYDCCoGYjKCoPwjJkMIyjdiMoag/CImgwjKJ2IyiqD8ISbDCMoXYjKOoPwgJgcIygdicoKg7CMmRwjKNmJyhqDsIiaHCMomYnKKoOwhJscIyhZico6g7CCmAAjKBmIKgqD6I6ZACKovYgqGoPohpoAIqg9iCoqg2iOmwAiqLWIKjqDaIaYECKoNYkriWVD8ltex2fwfs//NjmqcgcgAAAAASUVORK5CYII=",
                "backendService": {
                  "serviceUrl": "[[variables('ServiceName')]"
                },
                "apiType": "Rest",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "version": "1.0.0",
                    "title": "Prisma Cloud",
                    "description": "This custom connector connects to Prisma Cloud CSPM services end point to runs any Prisma supported API get/post/patch calls and gives response back in JSON format. \n\nNote: For better understanding , check https://prisma.pan.dev/api/cloud/cspm/')]"
                  },
                  "host": "[[replace(replace(parameters('PrismaCloudAPIURL'),'https://',''),'http://','')]",
                  "basePath": "/",
                  "schemes": [
                    "https"
                  ],
                  "consumes": "[variables('TemplateEmptyArray')]",
                  "produces": [
                    "application/json"
                  ],
                  "paths": {
                    "/auth_token/extend": {
                      "get": {
                        "summary": "Refresh Token",
                        "description": "Refresh Token",
                        "operationId": "[[variables('_operationId-RefreshToken')]",
                        "parameters": [
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json; charset=UTF-8",
                            "description": "accept"
                          },
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/login": {
                      "post": {
                        "summary": "Login Generate Token",
                        "description": "Login Generate Token",
                        "operationId": "[[variables('_operationId-LoginGenerateToken')]",
                        "parameters": [
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json; charset=UTF-8",
                            "description": "content-type"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "customerName": {
                                  "type": "string",
                                  "description": "customerName"
                                },
                                "password": {
                                  "type": "string",
                                  "description": "password",
                                  "title": "[variables('blanks')]",
                                  "format": "password"
                                },
                                "prismaId": {
                                  "type": "string",
                                  "description": "prismaId"
                                },
                                "username": {
                                  "type": "string",
                                  "description": "username",
                                  "title": "[variables('blanks')]"
                                }
                              },
                              "default": {
                                "customerName": "string",
                                "password": "string",
                                "prismaId": "[variables('_prismaId')]",
                                "username": "string"
                              },
                              "required": [
                                "password",
                                "username"
                              ]
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "message": {
                                  "type": "string",
                                  "description": "message"
                                },
                                "token": {
                                  "type": "string",
                                  "description": "token"
                                },
                                "customerNames": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "customerName": {
                                        "type": "string",
                                        "description": "customerName"
                                      },
                                      "prismaId": {
                                        "type": "string",
                                        "description": "prismaId"
                                      },
                                      "tosAccepted": {
                                        "type": "boolean",
                                        "description": "tosAccepted"
                                      }
                                    }
                                  },
                                  "description": "customerNames"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "/v2/inventory": {
                      "get": {
                        "summary": "Asset Inventory View V2",
                        "description": "Asset Inventory View V2",
                        "operationId": "[[variables('_operationId-AssetInventoryViewV2')]",
                        "parameters": [
                          {
                            "name": "timeType",
                            "default": "relative",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeAmount",
                            "default": "40",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeUnit",
                            "default": "hour",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json; charset=UTF-8",
                            "description": "accept"
                          },
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/v2/inventory/trend": {
                      "get": {
                        "summary": "Asset Inventory Trend View V2",
                        "description": "Asset Inventory Trend View V2",
                        "operationId": "[[variables('_operationId-AssetInventoryTrendViewV2')]",
                        "parameters": [
                          {
                            "name": "timeType",
                            "default": "relative",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeAmount",
                            "default": "40",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeUnit",
                            "default": "hour",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json; charset=UTF-8",
                            "description": "accept"
                          },
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/resource/scan_info": {
                      "get": {
                        "summary": "Assets Resource Scan",
                        "description": "Assets Resource Scan",
                        "operationId": "[[variables('_operationId-AssetsResourceScan')]",
                        "parameters": [
                          {
                            "name": "timeType",
                            "default": "to_now",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeAmount",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "timeUnit",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.account",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.type",
                            "default": "azure",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.region",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "account.group",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.complianceStandard",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.complianceRequirement",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.complianceSection",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "limit",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "scan.status",
                            "default": "all",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "pageToken",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "timestamp": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "timestamp"
                                },
                                "totalMatchedCount": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "totalMatchedCount"
                                },
                                "pageSize": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "pageSize"
                                },
                                "resources": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "string",
                                        "description": "id"
                                      },
                                      "name": {
                                        "type": "string",
                                        "description": "name"
                                      },
                                      "accountId": {
                                        "type": "string",
                                        "description": "accountId"
                                      },
                                      "accountName": {
                                        "type": "string",
                                        "description": "accountName"
                                      },
                                      "regionId": {
                                        "type": "string",
                                        "description": "regionId"
                                      },
                                      "regionName": {
                                        "type": "string",
                                        "description": "regionName"
                                      },
                                      "cloudType": {
                                        "type": "string",
                                        "description": "cloudType"
                                      },
                                      "rrn": {
                                        "type": "string",
                                        "description": "rrn"
                                      },
                                      "overallPassed": {
                                        "type": "boolean",
                                        "description": "overallPassed"
                                      },
                                      "scannedPolicies": {
                                        "type": "array",
                                        "items": {
                                          "type": "object",
                                          "properties": {
                                            "id": {
                                              "type": "string",
                                              "description": "id"
                                            },
                                            "name": {
                                              "type": "string",
                                              "description": "name"
                                            },
                                            "severity": {
                                              "type": "string",
                                              "description": "severity"
                                            },
                                            "labels": {
                                              "type": "array",
                                              "items": {
                                                "type": "string"
                                              },
                                              "description": "labels"
                                            },
                                            "passed": {
                                              "type": "boolean",
                                              "description": "passed"
                                            }
                                          }
                                        },
                                        "description": "scannedPolicies"
                                      },
                                      "alertStatus": {
                                        "type": "object",
                                        "properties": {
                                          "high": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "high"
                                          },
                                          "medium": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "medium"
                                          },
                                          "low": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "low"
                                          },
                                          "critical": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "critical"
                                          },
                                          "informational": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "informational"
                                          }
                                        },
                                        "description": "alertStatus"
                                      },
                                      "appNames": {
                                        "type": "array",
                                        "items": {
                                          "type": "string"
                                        },
                                        "description": "appNames"
                                      },
                                      "unifiedAssetId": {
                                        "type": "string",
                                        "description": "unifiedAssetId"
                                      },
                                      "resourceDetailsAvailable": {
                                        "type": "boolean",
                                        "description": "resourceDetailsAvailable"
                                      },
                                      "resourceConfigJsonAvailable": {
                                        "type": "boolean",
                                        "description": "resourceConfigJsonAvailable"
                                      },
                                      "assetType": {
                                        "type": "string",
                                        "description": "assetType"
                                      }
                                    }
                                  },
                                  "description": "resources"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "/uai/v1/asset": {
                      "post": {
                        "summary": "Assets Enrichment",
                        "description": "Assets Enrichment",
                        "operationId": "[[variables('_operationId-AssetsEnrichment')]",
                        "parameters": [
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "assetId": {
                                  "type": "string",
                                  "description": "assetId",
                                  "title": "[variables('blanks')]"
                                },
                                "type": {
                                  "type": "string",
                                  "description": "type",
                                  "title": "[variables('blanks')]",
                                  "enum": [
                                    "EXTERNAL_FINDING",
                                    "ASSET",
                                    "ALERTS",
                                    "RAW_CONFIG",
                                    "NETWORK",
                                    "TIMELINE",
                                    "EXTERNAL_INTEGRATION",
                                    "ASSET_DATA_INDICATORS",
                                    "RELATIONSHIPS"
                                  ]
                                }
                              },
                              "default": {
                                "assetId": "[variables('_assetId')]",
                                "type": "ALERTS"
                              },
                              "required": [
                                "type",
                                "assetId"
                              ]
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/alert": {
                      "get": {
                        "summary": "List Alerts",
                        "description": "List Alerts",
                        "operationId": "[[variables('_operationId-ListAlerts')]",
                        "parameters": [
                          {
                            "name": "timeType",
                            "default": "relative",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeAmount",
                            "default": "30",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "timeUnit",
                            "default": "day",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "detailed",
                            "default": "false",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "alert.id",
                            "default": "P-301",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.account",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "account.group",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.type",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "cloud.region",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.id",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.name",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.severity",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.label",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "policy.type",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "alertRule.name",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "resource.id",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "resource.name",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "resource.type",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "fields",
                            "default": "SOME_STRING_VALUE",
                            "in": "query",
                            "type": "string",
                            "required": false
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/alert/{id}": {
                      "get": {
                        "summary": "Get Alert Info",
                        "description": "Get Alert Info",
                        "operationId": "[[variables('_operationId-GetAlertInfo')]",
                        "parameters": [
                          {
                            "name": "detailed",
                            "default": "true",
                            "in": "query",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "id",
                            "default": "{{id}}",
                            "in": "path",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/anomalies/trusted_list": {
                      "get": {
                        "summary": "Get Anomaly Trusted List",
                        "description": "Get Anomaly Trusted List",
                        "operationId": "[[variables('_operationId-GetAnomalyTrustedList')]",
                        "parameters": [
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      },
                      "post": {
                        "summary": "Add Entries to Anomaly Trusted List",
                        "description": "Add Entries to Anomaly Trusted List",
                        "operationId": "[[variables('_operationId-AddEntriesToAnomalyTrustedList')]",
                        "parameters": [
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "description": "name"
                                },
                                "description": {
                                  "type": "string",
                                  "description": "description"
                                },
                                "applicablePolicies": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "description": "applicablePolicies"
                                },
                                "trustedListType": {
                                  "type": "string",
                                  "description": "trustedListType"
                                },
                                "accountID": {
                                  "type": "string",
                                  "description": "accountID"
                                },
                                "vpc": {
                                  "type": "string",
                                  "description": "vpc"
                                },
                                "trustedListEntries": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "ipCIDR": {
                                        "type": "string",
                                        "description": "ipCIDR"
                                      },
                                      "resourceID": {
                                        "type": "string",
                                        "description": "resourceID"
                                      },
                                      "imageID": {
                                        "type": "string",
                                        "description": "imageID"
                                      },
                                      "tagKey": {
                                        "type": "string",
                                        "description": "tagKey"
                                      },
                                      "tagValue": {
                                        "type": "string",
                                        "description": "tagValue"
                                      },
                                      "service": {
                                        "type": "string",
                                        "description": "service"
                                      },
                                      "port": {
                                        "type": "string",
                                        "description": "port"
                                      },
                                      "subject": {
                                        "type": "string",
                                        "description": "subject"
                                      },
                                      "domain": {
                                        "type": "string",
                                        "description": "domain"
                                      },
                                      "protocol": {
                                        "type": "string",
                                        "description": "protocol"
                                      }
                                    }
                                  },
                                  "description": "trustedListEntries"
                                }
                              },
                              "default": {
                                "name": "string",
                                "description": "string",
                                "applicablePolicies": [
                                  "string"
                                ],
                                "trustedListType": "ip, resource, image, tag, service, port, subject, domain, protocol",
                                "accountID": "[variables('_accountID')]",
                                "vpc": "any",
                                "trustedListEntries": [
                                  {
                                    "ipCIDR": "string",
                                    "resourceID": "[variables('_resourceID')]",
                                    "imageID": "[variables('_imageID')]",
                                    "tagKey": "string",
                                    "tagValue": "string",
                                    "service": "string",
                                    "port": "string",
                                    "subject": "string",
                                    "domain": "string",
                                    "protocol": "string"
                                  }
                                ]
                              }
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/alert/remediation": {
                      "post": {
                        "summary": "List Remediation command",
                        "description": "List Remediation command",
                        "operationId": "[[variables('_operationId-ListRemediationCommand')]",
                        "parameters": [
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json; charset=UTF-8",
                            "description": "content-type"
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "alerts": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "description": "alerts"
                                },
                                "filter": {
                                  "type": "object",
                                  "properties": {
                                    "timeRange": {
                                      "type": "object",
                                      "properties": {
                                        "relativeTimeType": {
                                          "type": "string",
                                          "description": "relativeTimeType"
                                        },
                                        "type": {
                                          "type": "string",
                                          "description": "type"
                                        },
                                        "value": {
                                          "type": "string",
                                          "description": "value"
                                        }
                                      },
                                      "description": "timeRange"
                                    }
                                  },
                                  "description": "filter"
                                }
                              },
                              "default": {
                                "alerts": [
                                  "P-653"
                                ],
                                "filter": {
                                  "timeRange": {
                                    "relativeTimeType": "BACKWARD",
                                    "type": "to_now",
                                    "value": "epoch"
                                  }
                                }
                              }
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/alert/remediation/{id}": {
                      "patch": {
                        "summary": "Remediate Alert",
                        "description": "Remediate Alert",
                        "operationId": "[[variables('_operationId-RemediateAlert')]",
                        "parameters": [
                          {
                            "name": "id",
                            "default": "{{id}}",
                            "in": "path",
                            "type": "string",
                            "required": true
                          },
                          {
                            "name": "x-redlock-auth",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "{{token}}",
                            "description": "x-redlock-auth"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    }
                  },
                  "security": "[variables('TemplateEmptyArray')]",
                  "tags": "[variables('TemplateEmptyArray')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "LogicAppsCustomConnector",
        "displayName": "PrismaCloudCSPMCustomConnector",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PrismaCloudCSPM-Enrichment Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "PrismaCloudCSPM-Enrichment",
              "type": "string"
            },
            "Keyvault name": {
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where secret key is stored"
              }
            },
            "PrismaSecretName": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Prisma Secret Key Name"
              }
            },
            "PrismaUserID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for PrismaUserID"
              }
            },
            "CustomConnectorName": {
              "defaultValue": "PrismaCloudCSPMCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same in all Prisma Cloud automation playbooks as well"
              }
            }
          },
          "variables": {
            "PrismacloudcspmcustomconnectorConnectionName": "[[concat('Prismacloudcspmcustomconnector-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-4": "[[variables('connection-4')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "PrismaSecretName": {
                      "defaultValue": "[[parameters('PrismaSecretName')]",
                      "type": "string"
                    },
                    "PrismaUserID": {
                      "defaultValue": "[[parameters('PrismaUserID')]",
                      "type": "string"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Condition_2_-_check_if_triggered_has_entities": {
                      "actions": {
                        "Assets_Resource_Scan": {
                          "runAfter": {
                            "Login_Generate_Token": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/resource/scan_info",
                            "queries": {
                              "cloud.type": "azure",
                              "scan.status": "all",
                              "timeType": "to_now"
                            }
                          }
                        },
                        "Condition_2_-_checking_if_provided_entities_are_there_in_Prisma_cloud": {
                          "actions": {
                            "Add_comment_to_incident_(V3)_3": {
                              "runAfter": {
                                "Create_HTML_table_2": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "incidentArmId": "@triggerBody()?['object']?['id']",
                                  "message": "<p>Assets Enrichment information :<br>\n@{body('Create_HTML_table_2')}<br>\n<br>\n---------------------------------------------------------------------------------------<br>\nAlerts details<br>\n<br>\n@{body('Create_HTML_table')}</p>"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/Incidents/Comment"
                              }
                            },
                            "Create_HTML_table": {
                              "runAfter": {
                                "For_each_-_storing_alert_info_in_variable": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Table",
                              "inputs": {
                                "format": "HTML",
                                "from": "@variables('alerts_detail')"
                              }
                            },
                            "Create_HTML_table_2": {
                              "runAfter": {
                                "Create_HTML_table": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Table",
                              "inputs": {
                                "format": "HTML",
                                "from": "@variables('collect_asset_scan_details')"
                              }
                            },
                            "For_each_-_collect_alerts_id_in_array": {
                              "foreach": "@body('Parse_JSON_-_parsing_collected_assets_details')",
                              "actions": {
                                "Assets_Enrichment": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "assetId": "@items('For_each_-_collect_alerts_id_in_array')['unifiedAssetId']",
                                      "type": "ALERTS"
                                    },
                                    "headers": {
                                      "content-type": "application/json",
                                      "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/uai/v1/asset"
                                  }
                                },
                                "For_each_2": {
                                  "foreach": "@body('Parse_JSON_-_Parsing_output_of_assets_Enrichment')?['data']?['asset']?['alerts']",
                                  "actions": {
                                    "Append_to_array_variable_3": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "collect_alerts",
                                        "value": "@items('For_each_2')?['id']"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Parse_JSON_-_Parsing_output_of_assets_Enrichment": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "Parse_JSON_-_Parsing_output_of_assets_Enrichment": {
                                  "runAfter": {
                                    "Assets_Enrichment": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@body('Assets_Enrichment')",
                                    "schema": {
                                      "properties": {
                                        "data": {
                                          "properties": {
                                            "asset": {
                                              "properties": {
                                                "alerts": {
                                                  "items": {
                                                    "properties": {
                                                      "id": {
                                                        "type": "string"
                                                      },
                                                      "severity": {
                                                        "type": "string"
                                                      }
                                                    },
                                                    "required": [
                                                      "id",
                                                      "severity"
                                                    ],
                                                    "type": "object"
                                                  },
                                                  "type": "array"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "errors": {
                                          "type": "array"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "For_each_-_storing_asset_scan_selected_data": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "For_each_-_storing_alert_info_in_variable": {
                              "foreach": "@variables('collect_alerts')",
                              "actions": {
                                "Append_to_array_variable_4_-_alert_details": {
                                  "runAfter": {
                                    "Parse_JSON_-_get_alert_info_result": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "alerts_detail",
                                    "value": {
                                      "Alert ID": "@body('Parse_JSON_-_get_alert_info_result')?['id']",
                                      "Alert status": "@body('Parse_JSON_-_get_alert_info_result')?['status']",
                                      "Alert_policy": "@body('Parse_JSON_-_get_alert_info_result')?['policy']?['name']",
                                      "Alert_severity": "@body('Parse_JSON_-_get_alert_info_result')?['policy']?['severity']",
                                      "Asset Owner": "@join(body('Parse_JSON_-_get_alert_info_result')?['resource']?['cloudAccountOwners'],' ')",
                                      "Cloud account Group": "@join(body('Parse_JSON_-_get_alert_info_result')?['resource']?['cloudAccountGroups'],' ')",
                                      "Labels": "@join(body('Parse_JSON_-_get_alert_info_result')?['policy']?['labels'],' ')",
                                      "Policy Type": "@body('Parse_JSON_-_get_alert_info_result')?['policy']?['policyType']",
                                      "Recommendation": "@body('Parse_JSON_-_get_alert_info_result')?['policy']?['recommendation']",
                                      "Resource Name": "@body('Parse_JSON_-_get_alert_info_result')?['resource']?['name']",
                                      "Resource account": "@body('Parse_JSON_-_get_alert_info_result')?['resource']?['account']"
                                    }
                                  }
                                },
                                "Get_Alert_Info": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "headers": {
                                      "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/alert/@{encodeURIComponent(items('For_each_-_storing_alert_info_in_variable'))}",
                                    "queries": {
                                      "detailed": "true"
                                    }
                                  }
                                },
                                "Parse_JSON_-_get_alert_info_result": {
                                  "runAfter": {
                                    "Get_Alert_Info": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@body('Get_Alert_Info')",
                                    "schema": {
                                      "properties": {
                                        "alertRules": {
                                          "items": {
                                            "properties": {
                                              "alertRuleNotificationConfig": {
                                                "type": "array"
                                              },
                                              "allowAutoRemediate": {
                                                "type": "boolean"
                                              },
                                              "enabled": {
                                                "type": "boolean"
                                              },
                                              "name": {
                                                "type": "string"
                                              },
                                              "notifyOnDismissed": {
                                                "type": "boolean"
                                              },
                                              "notifyOnOpen": {
                                                "type": "boolean"
                                              },
                                              "notifyOnResolved": {
                                                "type": "boolean"
                                              },
                                              "notifyOnSnoozed": {
                                                "type": "boolean"
                                              },
                                              "policyScanConfigId": {
                                                "type": "string"
                                              },
                                              "scanAll": {
                                                "type": "boolean"
                                              },
                                              "target": {
                                                "properties": {
                                                  "accountGroups": {
                                                    "type": "array"
                                                  },
                                                  "excludedAccounts": {
                                                    "type": "array"
                                                  },
                                                  "regions": {
                                                    "type": "array"
                                                  },
                                                  "tags": {
                                                    "type": "array"
                                                  }
                                                },
                                                "type": "object"
                                              }
                                            },
                                            "required": [
                                              "policyScanConfigId",
                                              "name",
                                              "enabled",
                                              "scanAll",
                                              "target",
                                              "alertRuleNotificationConfig",
                                              "allowAutoRemediate",
                                              "notifyOnOpen",
                                              "notifyOnSnoozed",
                                              "notifyOnDismissed",
                                              "notifyOnResolved"
                                            ],
                                            "type": "object"
                                          },
                                          "type": "array"
                                        },
                                        "alertTime": {
                                          "type": "integer"
                                        },
                                        "firstSeen": {
                                          "type": "integer"
                                        },
                                        "history": {
                                          "items": {
                                            "properties": {
                                              "modifiedBy": {
                                                "type": "string"
                                              },
                                              "modifiedOn": {
                                                "type": "integer"
                                              },
                                              "reason": {
                                                "type": "string"
                                              },
                                              "status": {
                                                "type": "string"
                                              }
                                            },
                                            "required": [
                                              "modifiedBy",
                                              "modifiedOn",
                                              "status",
                                              "reason"
                                            ],
                                            "type": "object"
                                          },
                                          "type": "array"
                                        },
                                        "id": {
                                          "type": "string"
                                        },
                                        "investigateOptions": {
                                          "properties": {
                                            "alertId": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "lastSeen": {
                                          "type": "integer"
                                        },
                                        "metadata": {
                                          "properties": {
                                            "saveSearchId": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "networkAnomaly": {
                                          "type": "boolean"
                                        },
                                        "policy": {
                                          "properties": {
                                            "complianceMetadata": {
                                              "items": {
                                                "properties": {
                                                  "complianceId": {
                                                    "type": "string"
                                                  },
                                                  "customAssigned": {
                                                    "type": "boolean"
                                                  },
                                                  "policyId": {
                                                    "type": "string"
                                                  },
                                                  "requirementId": {
                                                    "type": "string"
                                                  },
                                                  "requirementName": {
                                                    "type": "string"
                                                  },
                                                  "requirementViewOrder": {
                                                    "type": "integer"
                                                  },
                                                  "sectionDescription": {
                                                    "type": "string"
                                                  },
                                                  "sectionId": {
                                                    "type": "string"
                                                  },
                                                  "sectionLabel": {
                                                    "type": "string"
                                                  },
                                                  "sectionViewOrder": {
                                                    "type": "integer"
                                                  },
                                                  "standardDescription": {
                                                    "type": "string"
                                                  },
                                                  "standardName": {
                                                    "type": "string"
                                                  },
                                                  "systemDefault": {
                                                    "type": "boolean"
                                                  }
                                                },
                                                "required": [
                                                  "standardName",
                                                  "standardDescription",
                                                  "requirementId",
                                                  "requirementName",
                                                  "sectionId",
                                                  "sectionDescription",
                                                  "policyId",
                                                  "complianceId",
                                                  "sectionLabel",
                                                  "sectionViewOrder",
                                                  "requirementViewOrder",
                                                  "systemDefault",
                                                  "customAssigned"
                                                ],
                                                "type": "object"
                                              },
                                              "type": "array"
                                            },
                                            "deleted": {
                                              "type": "boolean"
                                            },
                                            "description": {
                                              "type": "string"
                                            },
                                            "labels": {
                                              "items": {
                                                "type": "string"
                                              },
                                              "type": "array"
                                            },
                                            "lastModifiedBy": {
                                              "type": "string"
                                            },
                                            "lastModifiedOn": {
                                              "type": "integer"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "policyId": {
                                              "type": "string"
                                            },
                                            "policyType": {
                                              "type": "string"
                                            },
                                            "recommendation": {
                                              "type": "string"
                                            },
                                            "remediable": {
                                              "type": "boolean"
                                            },
                                            "severity": {
                                              "type": "string"
                                            },
                                            "systemDefault": {
                                              "type": "boolean"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "reason": {
                                          "type": "string"
                                        },
                                        "resource": {
                                          "properties": {
                                            "account": {
                                              "type": "string"
                                            },
                                            "accountId": {
                                              "type": "string"
                                            },
                                            "additionalInfo": {
                                              "type": "object"
                                            },
                                            "cloudAccountGroups": {
                                              "items": {
                                                "type": "string"
                                              },
                                              "type": "array"
                                            },
                                            "cloudAccountOwners": {
                                              "items": {
                                                "type": "string"
                                              },
                                              "type": "array"
                                            },
                                            "cloudServiceName": {
                                              "type": "string"
                                            },
                                            "cloudType": {
                                              "type": "string"
                                            },
                                            "data": {
                                              "properties": {
                                                "Extensions": {
                                                  "properties": {
                                                    "MDE.Linux": {
                                                      "properties": {
                                                        "autoUpgradeMinorVersion": {
                                                          "type": "boolean"
                                                        },
                                                        "forceUpdateTag": {
                                                          "type": "string"
                                                        },
                                                        "protectedSettings": {
                                                          "type": "object"
                                                        },
                                                        "provisioningState": {
                                                          "type": "string"
                                                        },
                                                        "publisher": {
                                                          "type": "string"
                                                        },
                                                        "settings": {
                                                          "properties": {
                                                            "azureResourceId": {
                                                              "type": "string"
                                                            },
                                                            "forceReOnboarding": {
                                                              "type": "boolean"
                                                            },
                                                            "vNextEnabled": {
                                                              "type": "boolean"
                                                            }
                                                          },
                                                          "type": "object"
                                                        },
                                                        "type": {
                                                          "type": "string"
                                                        },
                                                        "typeHandlerVersion": {
                                                          "type": "string"
                                                        },
                                                        "virtualMachineExtensionType": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "OmsAgentForLinux": {
                                                      "properties": {
                                                        "autoUpgradeMinorVersion": {
                                                          "type": "boolean"
                                                        },
                                                        "enableAutomaticUpgrade": {
                                                          "type": "boolean"
                                                        },
                                                        "protectedSettings": {
                                                          "type": "object"
                                                        },
                                                        "provisioningState": {
                                                          "type": "string"
                                                        },
                                                        "publisher": {
                                                          "type": "string"
                                                        },
                                                        "settings": {
                                                          "properties": {
                                                            "workspaceId": {
                                                              "type": "string"
                                                            }
                                                          },
                                                          "type": "object"
                                                        },
                                                        "type": {
                                                          "type": "string"
                                                        },
                                                        "typeHandlerVersion": {
                                                          "type": "string"
                                                        },
                                                        "virtualMachineExtensionType": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "enablevmaccess": {
                                                      "properties": {
                                                        "autoUpgradeMinorVersion": {
                                                          "type": "boolean"
                                                        },
                                                        "protectedSettings": {
                                                          "type": "object"
                                                        },
                                                        "provisioningState": {
                                                          "type": "string"
                                                        },
                                                        "publisher": {
                                                          "type": "string"
                                                        },
                                                        "settings": {
                                                          "type": "object"
                                                        },
                                                        "type": {
                                                          "type": "string"
                                                        },
                                                        "typeHandlerVersion": {
                                                          "type": "string"
                                                        },
                                                        "virtualMachineExtensionType": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "id": {
                                                  "type": "string"
                                                },
                                                "location": {
                                                  "type": "string"
                                                },
                                                "locks": {
                                                  "type": "object"
                                                },
                                                "powerState": {
                                                  "type": "string"
                                                },
                                                "properties.networkProfile": {
                                                  "properties": {
                                                    "networkInterfaces": {
                                                      "items": {
                                                        "properties": {
                                                          "id": {
                                                            "type": "string"
                                                          },
                                                          "ipConfigurations": {
                                                            "items": {
                                                              "properties": {
                                                                "id": {
                                                                  "type": "string"
                                                                },
                                                                "name": {
                                                                  "type": "string"
                                                                },
                                                                "primary": {
                                                                  "type": "boolean"
                                                                },
                                                                "privateIpAddress": {
                                                                  "type": "string"
                                                                },
                                                                "publicIpAddress": {
                                                                  "type": "string"
                                                                },
                                                                "publicIpAddressId": {
                                                                  "type": "string"
                                                                },
                                                                "subnet": {
                                                                  "type": "string"
                                                                }
                                                              },
                                                              "required": [
                                                                "id",
                                                                "name",
                                                                "subnet",
                                                                "primary",
                                                                "publicIpAddress",
                                                                "privateIpAddress",
                                                                "publicIpAddressId"
                                                              ],
                                                              "type": "object"
                                                            },
                                                            "type": "array"
                                                          },
                                                          "privateIpAddress": {
                                                            "type": "string"
                                                          },
                                                          "publicIpAddress": {
                                                            "type": "string"
                                                          },
                                                          "publicIpAddressId": {
                                                            "type": "string"
                                                          }
                                                        },
                                                        "required": [
                                                          "id",
                                                          "publicIpAddress",
                                                          "ipConfigurations",
                                                          "privateIpAddress",
                                                          "publicIpAddressId"
                                                        ],
                                                        "type": "object"
                                                      },
                                                      "type": "array"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "properties.osProfile": {
                                                  "properties": {
                                                    "adminUsername": {
                                                      "type": "string"
                                                    },
                                                    "allowExtensionOperations": {
                                                      "type": "boolean"
                                                    },
                                                    "computerName": {
                                                      "type": "string"
                                                    },
                                                    "linuxConfiguration": {
                                                      "properties": {
                                                        "disablePasswordAuthentication": {
                                                          "type": "boolean"
                                                        },
                                                        "provisionVMAgent": {
                                                          "type": "boolean"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "secrets": {
                                                      "type": "array"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "properties.storageProfile": {
                                                  "properties": {
                                                    "dataDisks": {
                                                      "type": "array"
                                                    },
                                                    "imageReference": {
                                                      "properties": {
                                                        "offer": {
                                                          "type": "string"
                                                        },
                                                        "publisher": {
                                                          "type": "string"
                                                        },
                                                        "sku": {
                                                          "type": "string"
                                                        },
                                                        "version": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "osDisk": {
                                                      "properties": {
                                                        "caching": {
                                                          "type": "string"
                                                        },
                                                        "createOption": {
                                                          "type": "string"
                                                        },
                                                        "deleteOption": {
                                                          "type": "string"
                                                        },
                                                        "diskSizeGB": {
                                                          "type": "integer"
                                                        },
                                                        "managedDisk": {
                                                          "properties": {
                                                            "storageAccountType": {
                                                              "type": "string"
                                                            }
                                                          },
                                                          "type": "object"
                                                        },
                                                        "name": {
                                                          "type": "string"
                                                        },
                                                        "osType": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "tags": {
                                                  "type": "object"
                                                },
                                                "vmId": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "id": {
                                              "type": "string"
                                            },
                                            "internalResourceId": {
                                              "type": "string"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "region": {
                                              "type": "string"
                                            },
                                            "regionId": {
                                              "type": "string"
                                            },
                                            "resourceApiName": {
                                              "type": "string"
                                            },
                                            "resourceConfigJsonAvailable": {
                                              "type": "boolean"
                                            },
                                            "resourceDetailsAvailable": {
                                              "type": "boolean"
                                            },
                                            "resourceTs": {
                                              "type": "integer"
                                            },
                                            "resourceType": {
                                              "type": "string"
                                            },
                                            "rrn": {
                                              "type": "string"
                                            },
                                            "unifiedAssetId": {
                                              "type": "string"
                                            },
                                            "url": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "saveSearchId": {
                                          "type": "string"
                                        },
                                        "status": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "For_each_-_collect_alerts_id_in_array": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "For_each_-_storing_asset_scan_selected_data": {
                              "foreach": "@variables('collect_unifiedid')",
                              "actions": {
                                "Append_to_array_variable_4_-_storing_the_data_in_variable": {
                                  "runAfter": {
                                    "Parse_JSON_-_parsing_selected_asset_scan_data": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "collect_asset_scan_details",
                                    "value": {
                                      "Asset Name": "@body('Parse_JSON_-_parsing_selected_asset_scan_data')?['name']",
                                      "Breached Policies": "@replace(string(body('Parse_JSON_-_parsing_selected_asset_scan_data')?['scannedPolicies']),'\"',' ')",
                                      "Vulnerability Status": "@replace(string(body('Parse_JSON_-_parsing_selected_asset_scan_data')?['vulnerabilityStatus']),'\\\"','')",
                                      "assetType": "@body('Parse_JSON_-_parsing_selected_asset_scan_data')?['assetType']"
                                    }
                                  }
                                },
                                "Parse_JSON_-_parsing_selected_asset_scan_data": {
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@items('For_each_-_storing_asset_scan_selected_data')",
                                    "schema": {
                                      "properties": {
                                        "accountId": {
                                          "type": "string"
                                        },
                                        "accountName": {
                                          "type": "string"
                                        },
                                        "alertStatus": {
                                          "properties": {
                                            "critical": {
                                              "type": "integer"
                                            },
                                            "high": {
                                              "type": "integer"
                                            },
                                            "informational": {
                                              "type": "integer"
                                            },
                                            "low": {
                                              "type": "integer"
                                            },
                                            "medium": {
                                              "type": "integer"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "appNames": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "assetType": {
                                          "type": "string"
                                        },
                                        "cloudType": {
                                          "type": "string"
                                        },
                                        "id": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        },
                                        "overallPassed": {
                                          "type": "boolean"
                                        },
                                        "regionId": {
                                          "type": "string"
                                        },
                                        "regionName": {
                                          "type": "string"
                                        },
                                        "resourceConfigJsonAvailable": {
                                          "type": "boolean"
                                        },
                                        "resourceDetailsAvailable": {
                                          "type": "boolean"
                                        },
                                        "rrn": {
                                          "type": "string"
                                        },
                                        "scannedPolicies": {
                                          "items": {
                                            "properties": {
                                              "id": {
                                                "type": "string"
                                              },
                                              "labels": {
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              },
                                              "name": {
                                                "type": "string"
                                              },
                                              "passed": {
                                                "type": "boolean"
                                              },
                                              "severity": {
                                                "type": "string"
                                              }
                                            },
                                            "required": [
                                              "id",
                                              "name",
                                              "severity",
                                              "labels",
                                              "passed"
                                            ],
                                            "type": "object"
                                          },
                                          "type": "array"
                                        },
                                        "unifiedAssetId": {
                                          "type": "string"
                                        },
                                        "vulnerabilityStatus": {
                                          "properties": {
                                            "critical": {
                                              "type": "integer"
                                            },
                                            "high": {
                                              "type": "integer"
                                            },
                                            "low": {
                                              "type": "integer"
                                            },
                                            "medium": {
                                              "type": "integer"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_-_parsing_collected_assets_details": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "Parse_JSON_-_parsing_collected_assets_details": {
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@variables('collect_unifiedid')",
                                "schema": {
                                  "items": {
                                    "properties": {
                                      "accountId": {
                                        "type": "string"
                                      },
                                      "accountName": {
                                        "type": "string"
                                      },
                                      "alertStatus": {
                                        "properties": {
                                          "critical": {
                                            "type": "integer"
                                          },
                                          "high": {
                                            "type": "integer"
                                          },
                                          "informational": {
                                            "type": "integer"
                                          },
                                          "low": {
                                            "type": "integer"
                                          },
                                          "medium": {
                                            "type": "integer"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "appNames": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "assetType": {
                                        "type": "string"
                                      },
                                      "cloudType": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "overallPassed": {
                                        "type": "boolean"
                                      },
                                      "regionId": {
                                        "type": "string"
                                      },
                                      "regionName": {
                                        "type": "string"
                                      },
                                      "resourceConfigJsonAvailable": {
                                        "type": "boolean"
                                      },
                                      "resourceDetailsAvailable": {
                                        "type": "boolean"
                                      },
                                      "rrn": {
                                        "type": "string"
                                      },
                                      "scannedPolicies": {
                                        "items": {
                                          "properties": {
                                            "id": {
                                              "type": "string"
                                            },
                                            "labels": {
                                              "items": {
                                                "type": "string"
                                              },
                                              "type": "array"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "passed": {
                                              "type": "boolean"
                                            },
                                            "severity": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "id",
                                            "name",
                                            "severity",
                                            "labels",
                                            "passed"
                                          ],
                                          "type": "object"
                                        },
                                        "type": "array"
                                      },
                                      "unifiedAssetId": {
                                        "type": "string"
                                      },
                                      "vulnerabilityStatus": {
                                        "properties": {
                                          "critical": {
                                            "type": "integer"
                                          },
                                          "high": {
                                            "type": "integer"
                                          },
                                          "low": {
                                            "type": "integer"
                                          },
                                          "medium": {
                                            "type": "integer"
                                          }
                                        },
                                        "type": "object"
                                      }
                                    },
                                    "required": [
                                      "id",
                                      "name",
                                      "accountId",
                                      "accountName",
                                      "regionId",
                                      "regionName",
                                      "cloudType",
                                      "rrn",
                                      "overallPassed",
                                      "scannedPolicies",
                                      "alertStatus",
                                      "appNames",
                                      "unifiedAssetId",
                                      "resourceDetailsAvailable",
                                      "resourceConfigJsonAvailable",
                                      "assetType"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "For_each_2_-_collecting_assetID": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Add_comment_to_incident_(V3)_2": {
                                "type": "ApiConnection",
                                "inputs": {
                                  "body": {
                                    "incidentArmId": "@triggerBody()?['object']?['id']",
                                    "message": "<p>Provided entites are not available in Prisma Cloud</p>"
                                  },
                                  "host": {
                                    "connection": {
                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                    }
                                  },
                                  "method": "post",
                                  "path": "/Incidents/Comment"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(variables('collect_unifiedid'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "For_each_2_-_collecting_assetID": {
                          "foreach": "@body('Assets_Resource_Scan')?['resources']",
                          "actions": {
                            "Condition": {
                              "actions": {
                                "Append_to_array_variable_2": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "collect_unifiedid",
                                    "value": "@items('For_each_2_-_collecting_assetID')"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "contains": [
                                      "@variables('collect_entities')",
                                      "@items('For_each_2_-_collecting_assetID')?['name']"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "runAfter": {
                            "Assets_Resource_Scan": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Login_Generate_Token": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "password": "@body('Get_secret')?['value']",
                              "username": "@parameters('PrismaUserID')"
                            },
                            "headers": {
                              "content-type": "application/json; charset=UTF-8"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/login"
                          }
                        }
                      },
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>No entities mapped to host asset field.</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('collect_entities'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "For_each_-_collecting_entities_in_one_array": {
                      "foreach": "@body('Parse_JSON_-_entities')",
                      "actions": {
                        "Append_to_array_variable": {
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "collect_entities",
                            "value": "@items('For_each_-_collecting_entities_in_one_array')?['properties']?['hostName']"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_-_collecting_entities": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Get_secret": {
                      "runAfter": {
                        "For_each_-_collecting_entities_in_one_array": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('PrismaSecretName'))}/value"
                      }
                    },
                    "Initialize_variable-_collecting_unified_id's": {
                      "runAfter": {
                        "Initialize_variable_-_collect_asset_scan_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collect_unifiedid",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_alerts": {
                      "runAfter": {
                        "Parse_JSON_-_entities": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collect_alerts",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_alerts_details_": {
                      "runAfter": {
                        "Initialize_variable_-_collect_alerts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "alerts_detail",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_asset_scan_details": {
                      "runAfter": {
                        "Initialize_variable_-_collect_alerts_details_": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collect_asset_scan_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collecting_entities": {
                      "runAfter": {
                        "Initialize_variable-_collecting_unified_id's": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collect_entities",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Parse_JSON_-_entities": {
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "schema": {
                          "items": {
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "kind": {
                                "type": "string"
                              },
                              "properties": {
                                "properties": {
                                  "friendlyName": {
                                    "type": "string"
                                  },
                                  "hostName": {
                                    "type": "string"
                                  }
                                },
                                "type": "object"
                              },
                              "type": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "kind",
                              "properties",
                              "type"
                            ],
                            "type": "object"
                          },
                          "type": "array"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "PrismaCloudCSPMCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PrismacloudcspmcustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "PrismaCloudCSPM-Enrichment",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('PrismacloudcspmcustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-4')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_PrismaCloudCSPMCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Fetch Security Posture from Prisma Cloud",
            "description": "This playbook provides/updates the compliance security posture details of asset in comments section of triggered incident so that SOC analysts can directly take corrective measure to prevent the attack",
            "prerequisites": [
              "1. PrismaCloudCSPM Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription.",
              "2. API Key and User ID . To get this, login into your Prisma cloud instance dashboard and navigate to Settings --> Access Control --> Access Keys --> Add",
              "3. [Important step]Store the API secret key in Key vault then provide the keyvault name and key name of the stored secret during deployment"
            ],
            "postDeployment": [
              "1. During deployment you need to provide your Key vault name , User ID and API key name of stored secret key."
            ],
            "lastUpdateTime": "2023-02-03T00:00:00Z",
            "entities": [
              "host"
            ],
            "tags": [
              "Enrichment",
              "Notification",
              "CSPM",
              "PrismaCloud",
              "Compliance",
              "Posture"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "PrismaCloudCSPM-Enrichment",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PrismaCloudCSPM-Remediation Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "PrismaCloudCSPM-Remediation",
              "type": "string"
            },
            "Keyvault name": {
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where secret key is stored"
              }
            },
            "PrismaSecretName": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Prisma Secret Key Name"
              }
            },
            "PrismaUserID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Prisma User ID"
              }
            },
            "TeamsID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for TeamsID"
              }
            },
            "ChannelID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Teams ChannelID"
              }
            },
            "CustomConnectorName": {
              "defaultValue": "PrismaCloudCSPMCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same in all Prisma Cloud automation playbooks as well"
              }
            }
          },
          "variables": {
            "PrismacloudcspmcustomconnectorConnectionName": "[[concat('Prismacloudcspmcustomconnector-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[[concat('Teams-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-4": "[[variables('connection-4')]",
            "connection-5": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Teams')]",
            "_connection-5": "[[variables('connection-5')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "ChannelID": {
                      "defaultValue": "[[parameters('ChannelID')]",
                      "type": "string"
                    },
                    "PrismaSecretName": {
                      "defaultValue": "[[parameters('PrismaSecretName')]",
                      "type": "string"
                    },
                    "PrismaUserID": {
                      "defaultValue": "[[parameters('PrismaUserID')]",
                      "type": "string"
                    },
                    "TeamsID": {
                      "defaultValue": "[[parameters('TeamsID')]",
                      "type": "string"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Condition_-_check_if_any_entity_is_collected": {
                      "actions": {
                        "Add_comment_to_incident_(V3)_2": {
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>Remediable Alert Summary:<br>\n<br>\n@{body('Create_HTML_table')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Create_HTML_table": {
                          "runAfter": {
                            "For_each_2_-_fetching_response_from_teams_channel_and_taking_action": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('Collect_response')"
                          }
                        },
                        "For_each_-_valid_alert_list": {
                          "foreach": "@variables('collect_entities')",
                          "actions": {
                            "For_each": {
                              "foreach": "@body('Parse_JSON_-_list_alerts_response')",
                              "actions": {
                                "Condition": {
                                  "actions": {
                                    "Append_to_array_variable_-_collect_alerts_info_with_remediation_command": {
                                      "runAfter": {
                                        "Parse_JSON_-_List_remediation_command_response": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "collected_alerts",
                                        "value": {
                                          "Account": "@items('For_each')?['resource']?['account']",
                                          "Alert id": "@items('For_each')['id']",
                                          "Policy Name": "@items('For_each')?['policy']?['name']",
                                          "Resource Name": "@items('For_each')?['resource']?['name']",
                                          "Script Impact": "@{body('Parse_JSON_-_List_remediation_command_response')?['scriptImpact']} ",
                                          "alertIdVsCliScript": "@replace(string(body('Parse_JSON_-_List_remediation_command_response')?['alertIdVsCliScript']),'\"','')",
                                          "cli Description": "@body('Parse_JSON_-_List_remediation_command_response')?['cliDescription']"
                                        }
                                      }
                                    },
                                    "Parse_JSON_-_List_remediation_command_response": {
                                      "type": "ParseJson",
                                      "inputs": {
                                        "content": "@body('List_Remediation_command')",
                                        "schema": {
                                          "properties": {
                                            "alertIdVsCliScript": {
                                              "type": "object"
                                            },
                                            "cliDescription": {
                                              "type": "string"
                                            },
                                            "scriptImpact": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "List_Remediation_command": [
                                      "Succeeded",
                                      "Failed"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Append_to_array_variable_2_-_collect_alerts_info_with_remediation_command": {
                                        "runAfter": {
                                          "Parse_JSON_2_-_List_Remediation_command_response": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "AppendToArrayVariable",
                                        "inputs": {
                                          "name": "collected_alerts",
                                          "value": {
                                            "Account": "@items('For_each')?['resource']?['account']",
                                            "Alert id": "@items('For_each')['id']",
                                            "Policy Name": "@items('For_each')?['policy']?['name']",
                                            "Resource Name": "@items('For_each')?['resource']?['name']",
                                            "Script Impact": "@{body('Parse_JSON_2_-_List_Remediation_command_response')?['scriptImpact']} ",
                                            "alertIdVsCliScript": "@replace(string(body('Parse_JSON_2_-_List_Remediation_command_response')?['alertIdVsCliScript']),'\"','')",
                                            "cli Description": "@body('Parse_JSON_2_-_List_Remediation_command_response')?['cliDescription']"
                                          }
                                        }
                                      },
                                      "Parse_JSON_2_-_List_Remediation_command_response": {
                                        "type": "ParseJson",
                                        "inputs": {
                                          "content": "@body('List_Remediation_command')",
                                          "schema": {
                                            "properties": {
                                              "alertIdVsCliScript": {
                                                "type": "object"
                                              },
                                              "cliDescription": {
                                                "type": "string"
                                              },
                                              "scriptImpact": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "equals": [
                                          "@actions('List_Remediation_command').outputs.statusCode",
                                          200
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "List_Remediation_command": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "alerts": [
                                        "@items('For_each')['id']"
                                      ],
                                      "filter": {
                                        "timeRange": {
                                          "relativeTimeType": "BACKWARD",
                                          "type": "to_now",
                                          "value": "epoch"
                                        }
                                      }
                                    },
                                    "headers": {
                                      "content-type": "application/json; charset=UTF-8",
                                      "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/alert/remediation"
                                  }
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_-_list_alerts_response": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "List_Alerts": {
                              "type": "ApiConnection",
                              "inputs": {
                                "headers": {
                                  "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/alert",
                                "queries": {
                                  "detailed": "false",
                                  "fields": "alert.id, alert.status, alert.time, cloud.accountId, cloud.account, cloud.region, resource.id, resource.name,policy.name",
                                  "resource.name": "@{items('For_each_-_valid_alert_list')}",
                                  "timeAmount": "90",
                                  "timeType": "relative",
                                  "timeUnit": "day"
                                }
                              }
                            },
                            "Parse_JSON_-_list_alerts_response": {
                              "runAfter": {
                                "List_Alerts": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@body('List_Alerts')",
                                "schema": {
                                  "items": {
                                    "properties": {
                                      "alertRules": {
                                        "type": "array"
                                      },
                                      "alertTime": {
                                        "type": "integer"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "policy": {
                                        "properties": {
                                          "name": {
                                            "type": "string"
                                          },
                                          "remediable": {
                                            "type": "boolean"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "resource": {
                                        "properties": {
                                          "account": {
                                            "type": "string"
                                          },
                                          "accountId": {
                                            "type": "string"
                                          },
                                          "id": {
                                            "type": "string"
                                          },
                                          "name": {
                                            "type": "string"
                                          },
                                          "region": {
                                            "type": "string"
                                          },
                                          "resourceConfigJsonAvailable": {
                                            "type": "boolean"
                                          },
                                          "resourceDetailsAvailable": {
                                            "type": "boolean"
                                          },
                                          "resourceTs": {
                                            "type": "integer"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "status": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "id",
                                      "status",
                                      "alertTime",
                                      "policy",
                                      "alertRules",
                                      "resource"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Login_Generate_Token": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "For_each_2_-_fetching_response_from_teams_channel_and_taking_action": {
                          "foreach": "@body('Parse_JSON_-_parsing_collected_alerts')",
                          "actions": {
                            "Condition_to_check_for_non_remediable_alerts": {
                              "actions": {
                                "Parse_JSON_-_Output_of_teams_adaptive_card_2": {
                                  "runAfter": {
                                    "Post_adaptive_card_and_wait_for_a_response_2": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@body('Post_adaptive_card_and_wait_for_a_response_2')",
                                    "schema": {
                                      "properties": {
                                        "data": {
                                          "properties": {
                                            "incidentStatus": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "messageId": {
                                          "type": "string"
                                        },
                                        "messageLink": {
                                          "type": "string"
                                        },
                                        "responder": {
                                          "properties": {
                                            "displayName": {
                                              "type": "string"
                                            },
                                            "email": {
                                              "type": "string"
                                            },
                                            "objectId": {
                                              "type": "string"
                                            },
                                            "tenantId": {
                                              "type": "string"
                                            },
                                            "userPrincipalName": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "responseTime": {
                                          "type": "string"
                                        },
                                        "submitActionId": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "Post_adaptive_card_and_wait_for_a_response_2": {
                                  "type": "ApiConnectionWebhook",
                                  "inputs": {
                                    "body": {
                                      "body": {
                                        "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"large\",\n            \"weight\": \"bolder\",\n            \"text\": \"Suspicious Asset - Prisma cloud CSPM\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Asset Name : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}\",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Prisma CSPM Report\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Alert ID :  @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Policy Name : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Policy Name']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Account :  @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Account']}\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Azure Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"Close incident - False Positive\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"Close incident - True Positive\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Close incident - Benign Positive\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel incident severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Provided Alert is not remediable by Prisma Cloud\",\n            \"size\": \"Medium\",\n            \"weight\": \"Bolder\"\n        }\n    ],\n\"actions\": [\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Submit\",\n        },\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Ignore\"\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                        "recipient": {
                                          "channelId": "@parameters('ChannelID')",
                                          "groupId": "@parameters('TeamsID')"
                                        }
                                      },
                                      "notificationUrl": "@{listCallbackUrl()}"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['teams']['connectionId']"
                                      }
                                    },
                                    "path": "/v1.0/teams/conversation/gatherinput/poster/Flow bot/location/@{encodeURIComponent('Channel')}/$subscriptions"
                                  }
                                }
                              },
                              "else": {
                                "actions": {
                                  "Parse_JSON_-_Output_of_teams_adaptive_card": {
                                    "runAfter": {
                                      "Post_adaptive_card_and_wait_for_a_response": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "ParseJson",
                                    "inputs": {
                                      "content": "@body('Post_adaptive_card_and_wait_for_a_response')",
                                      "schema": {
                                        "properties": {
                                          "data": {
                                            "properties": {
                                              "incidentStatus": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "messageId": {
                                            "type": "string"
                                          },
                                          "messageLink": {
                                            "type": "string"
                                          },
                                          "responder": {
                                            "properties": {
                                              "displayName": {
                                                "type": "string"
                                              },
                                              "email": {
                                                "type": "string"
                                              },
                                              "objectId": {
                                                "type": "string"
                                              },
                                              "tenantId": {
                                                "type": "string"
                                              },
                                              "userPrincipalName": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "responseTime": {
                                            "type": "string"
                                          },
                                          "submitActionId": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      }
                                    }
                                  },
                                  "Post_adaptive_card_and_wait_for_a_response": {
                                    "type": "ApiConnectionWebhook",
                                    "inputs": {
                                      "body": {
                                        "body": {
                                          "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"large\",\n            \"weight\": \"bolder\",\n            \"text\": \"Suspicious Asset - Prisma cloud CSPM\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Asset Name : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}\",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Prisma CSPM Report\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Alert ID :  @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Policy Name : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Policy Name']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Account :  @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Account']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Remediation Details :  \",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"cli Description : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['cli Description']}\",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"Script Impact :@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Script Impact']} \",\n                            \"wrap\": true\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \"alertIdVsCliScript : @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['alertIdVsCliScript']}\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Azure Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"Close incident - False Positive\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"Close incident - True Positive\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Close incident - Benign Positive\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel incident severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Prisma Cloud CSPM Actions\",\n            \"size\": \"Medium\",\n            \"weight\": \"Bolder\"\n        }\n    ],\n    \"actions\": [\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Run Remediation steps on asset\",\n        },\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Submit without Running Remediation steps\",\n        },\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Ignore\"\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                          "recipient": {
                                            "channelId": "@parameters('ChannelID')",
                                            "groupId": "@parameters('TeamsID')"
                                          }
                                        },
                                        "notificationUrl": "@{listCallbackUrl()}"
                                      },
                                      "host": {
                                        "connection": {
                                          "name": "@parameters('$connections')['teams']['connectionId']"
                                        }
                                      },
                                      "path": "/v1.0/teams/conversation/gatherinput/poster/Flow bot/location/@{encodeURIComponent('Channel')}/$subscriptions"
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Script Impact']",
                                      " "
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Condition_to_check_for_submit_responses": {
                              "actions": {
                                "Append_to_collect_response_variable": {
                                  "runAfter": {
                                    "Update_an_adaptive_card_in_a_chat_or_channel": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "Collect_response",
                                    "value": {
                                      "Alert id": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}",
                                      "Asset": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}",
                                      "Response Given": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']}",
                                      "Response submitter": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']}",
                                      "Status": "Alert Cant be Remediated or choosen not to"
                                    }
                                  }
                                },
                                "Update_an_adaptive_card_in_a_chat_or_channel": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"large\",\n            \"weight\": \"bolder\",\n            \"text\": \"Suspicious Asset @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}  - Microsoft Sentinel\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Response - @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']} @{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']} by @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']} \",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Alert - @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}\",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                      "messageId": "@{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['messageId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['messageId']}",
                                      "recipient": {
                                        "channelId": "@parameters('ChannelID')",
                                        "groupId": "@parameters('TeamsID')"
                                      }
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['teams']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/v1.0/teams/conversation/updateAdaptivecard/poster/Flow bot/location/@{encodeURIComponent('Channel')}"
                                  }
                                }
                              },
                              "runAfter": {
                                "Condition_to_check_for_non_remediable_alerts": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Condition_2": {
                                    "actions": {
                                      "Append_to_collect_response_variable_2": {
                                        "runAfter": {
                                          "Update_an_adaptive_card_in_a_chat_or_channel_2": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "AppendToArrayVariable",
                                        "inputs": {
                                          "name": "Collect_response",
                                          "value": {
                                            "Alert id": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}",
                                            "Asset": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}",
                                            "Response Given": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']}",
                                            "Response submitter": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']}",
                                            "Status": "Alert Ignored"
                                          }
                                        }
                                      },
                                      "Update_an_adaptive_card_in_a_chat_or_channel_2": {
                                        "type": "ApiConnection",
                                        "inputs": {
                                          "body": {
                                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"large\",\n            \"weight\": \"bolder\",\n            \"text\": \"Suspicious Asset @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}  - Microsoft Sentinel\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Response - @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']} @{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']} by @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']} \",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Alert - @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}\",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                            "messageId": "@{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['messageId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['messageId']}",
                                            "recipient": {
                                              "channelId": "@parameters('ChannelID')",
                                              "groupId": "@parameters('TeamsID')"
                                            }
                                          },
                                          "host": {
                                            "connection": {
                                              "name": "@parameters('$connections')['teams']['connectionId']"
                                            }
                                          },
                                          "method": "post",
                                          "path": "/v1.0/teams/conversation/updateAdaptivecard/poster/Flow bot/location/@{encodeURIComponent('Channel')}"
                                        }
                                      }
                                    },
                                    "else": {
                                      "actions": {
                                        "Append_to_collect_response_variable_3": {
                                          "runAfter": {
                                            "Remediate_Alert": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToArrayVariable",
                                          "inputs": {
                                            "name": "Collect_response",
                                            "value": {
                                              "Alert id": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}",
                                              "Asset": "@{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}",
                                              "Response Given": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']}",
                                              "Response submitter": " @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']}",
                                              "Status": "Alert remediated succesfully"
                                            }
                                          }
                                        },
                                        "Remediate_Alert": {
                                          "runAfter": {
                                            "Update_an_adaptive_card_in_a_chat_or_channel_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "headers": {
                                              "x-redlock-auth": "@body('Login_Generate_Token')?['token']"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                                              }
                                            },
                                            "method": "patch",
                                            "path": "/alert/remediation/@{encodeURIComponent(items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id'])}"
                                          }
                                        },
                                        "Update_an_adaptive_card_in_a_chat_or_channel_3": {
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"large\",\n            \"weight\": \"bolder\",\n            \"text\": \"Suspicious Asset @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Resource Name']}  - Microsoft Sentinel\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Response - @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']} @{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']} by @{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['responder']?['email']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['responder']?['email']} \",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"text\": \" Alert - @{items('For_each_2_-_fetching_response_from_teams_channel_and_taking_action')['Alert id']}\",\n                            \"wrap\": true,\n                            \"weight\": \"Bolder\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                              "messageId": "@{body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['messageId']}@{body('Parse_JSON_-_Output_of_teams_adaptive_card')?['messageId']}",
                                              "recipient": {
                                                "channelId": "@parameters('ChannelID')",
                                                "groupId": "@parameters('TeamsID')"
                                              }
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['teams']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/v1.0/teams/conversation/updateAdaptivecard/poster/Flow bot/location/@{encodeURIComponent('Channel')}"
                                          }
                                        }
                                      }
                                    },
                                    "expression": {
                                      "or": [
                                        {
                                          "equals": [
                                            "@body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']",
                                            "Ignore"
                                          ]
                                        },
                                        {
                                          "equals": [
                                            "@body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']",
                                            "Ignore"
                                          ]
                                        }
                                      ]
                                    },
                                    "type": "If"
                                  }
                                }
                              },
                              "expression": {
                                "or": [
                                  {
                                    "equals": [
                                      "@body('Parse_JSON_-_Output_of_teams_adaptive_card_2')?['submitActionId']",
                                      "Submit"
                                    ]
                                  },
                                  {
                                    "equals": [
                                      "@body('Parse_JSON_-_Output_of_teams_adaptive_card')?['submitActionId']",
                                      "Submit without Running Remediation steps"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON_-_parsing_collected_alerts": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Login_Generate_Token": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "password": "@body('Get_secret')?['value']",
                              "username": "@parameters('PrismaUserID')"
                            },
                            "headers": {
                              "content-type": "application/json; charset=UTF-8"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['PrismaCloudCSPMCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/login"
                          }
                        },
                        "Parse_JSON_-_parsing_collected_alerts": {
                          "runAfter": {
                            "For_each_-_valid_alert_list": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@variables('collected_alerts')",
                            "schema": {
                              "items": {
                                "properties": {
                                  "Account": {
                                    "type": "string"
                                  },
                                  "Alert id": {
                                    "type": "string"
                                  },
                                  "Policy Name": {
                                    "type": "string"
                                  },
                                  "Resource Name": {
                                    "type": "string"
                                  },
                                  "Script Impact": {
                                    "type": "string"
                                  },
                                  "alertIdVsCliScript": {
                                    "type": "string"
                                  },
                                  "cli Description": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "Account",
                                  "Alert id",
                                  "Policy Name",
                                  "Resource Name",
                                  "Script Impact",
                                  "alertIdVsCliScript",
                                  "cli Description"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>No Entity is Mapped to \"hostname\" in analytic rule.<br>\n<br>\nNote : Assets column should be mapped to Hostname in entity mapping</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('collect_entities'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "For_each_-_collect_all_entity_in_one_array": {
                      "foreach": "@body('Parse_JSON_-_entities_')",
                      "actions": {
                        "Append_to_array_variable": {
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "collect_entities",
                            "value": "@items('For_each_-_collect_all_entity_in_one_array')?['properties']?['hostName']"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_-_collect_response": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Get_secret": {
                      "runAfter": {
                        "For_each_-_collect_all_entity_in_one_array": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('PrismaSecretName'))}/value"
                      }
                    },
                    "Initialize_variable_-_collect_alerts": {
                      "runAfter": {
                        "Initialize_variable_-_collect_entity": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collected_alerts",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_entity": {
                      "runAfter": {
                        "Parse_JSON_-_entities_": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "collect_entities",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_response": {
                      "runAfter": {
                        "Initialize_variable_-_collect_alerts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Collect_response",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Parse_JSON_-_entities_": {
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "schema": {
                          "items": {
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "kind": {
                                "type": "string"
                              },
                              "properties": {
                                "properties": {
                                  "friendlyName": {
                                    "type": "string"
                                  },
                                  "hostName": {
                                    "type": "string"
                                  }
                                },
                                "type": "object"
                              },
                              "type": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "kind",
                              "properties",
                              "type"
                            ],
                            "type": "object"
                          },
                          "type": "array"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "PrismaCloudCSPMCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PrismacloudcspmcustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "teams": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[[variables('TeamsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Teams')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('PrismacloudcspmcustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('PrismacloudcspmcustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-4')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('TeamsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('TeamsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-5')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_PrismaCloudCSPMCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Remediate assets on prisma cloud",
            "description": "This playbook provides/updates the compliance security posture details of asset in comments section of triggered incident so that SOC analysts can directly take corrective measure to prevent the attack",
            "prerequisites": [
              "1. PrismaCloudCSPM Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription.",
              "2. API Key and User ID . To get this, login into your Prisma cloud instance dashboard and navigate to Settings --> Access Control --> Access Keys --> Add",
              "3. TeamsID and channelID of your tenant is needed for posting messages on Microsoft teams",
              "4. [Important step]Store the API secret key in Key vault then provide the keyvault name and key name of the stored secret during deployment"
            ],
            "postDeployment": [
              "1. During deployment you need to provide your Key vault name ,TeamsID , channelID , User ID and API key name of stored secret key."
            ],
            "lastUpdateTime": "2023-02-03T00:00:00Z",
            "entities": [
              "host"
            ],
            "tags": [
              "Remediation",
              "Notification",
              "CSPM",
              "PrismaCloud",
              "Compliance",
              "Posture",
              "Policy"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "PrismaCloudCSPM-Remediation",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudOverviewWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Sets the time name for analysis."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Palo Alto Prisma Cloud Overview\\n---\\n**NOTE**: This workbook depends on a parser based on a Kusto Function to work as expected [**PaloAltoPrismaCloud**](https://aka.ms/sentinel-PaloAltoPrismaCloud-parser) which is deployed with the Microsoft sentinel Solution.\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"600df9d4-1fb8-4255-a77e-27f5d12a5097\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\n| make-series TotalEvents = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain};\",\"size\":0,\"title\":\"Events over time\",\"color\":\"grayBlue\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\",\"tileSettings\":{\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"query - 2\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where isnotempty(ResourceRegion)\\r\\n| summarize count() by ResourceRegion\",\"size\":3,\"title\":\"Events by Region\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where isnotempty(ResourceCloudType)\\r\\n| summarize count() by ResourceCloudType\",\"size\":3,\"title\":\"Events by Cloud type\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"query - 1\"}]},\"customWidth\":\"50\",\"name\":\"group - 3\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| summarize Low = countif(AlertSeverity =~ \\\"low\\\"), Medium = countif(AlertSeverity == \\\"medium\\\"), High = countif(AlertSeverity == \\\"high\\\") by bin_at(TimeGenerated, 1h, now())\",\"size\":0,\"title\":\"Alerts over time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"}]}},\"customWidth\":\"55\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where Status =~ 'open'\\r\\n| project AlertId, AlertSeverity, AlertMessage\",\"size\":0,\"title\":\"Open Alerts\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"40\",\"name\":\"query - 2\",\"styleSettings\":{\"margin\":\"20px\"}}]},\"name\":\"group - 4\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where isnotempty(SrcIpAddr)\\r\\n| summarize count() by SrcIpAddr\\r\\n| top 10 by count_ desc\",\"size\":3,\"title\":\"Top Sources\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"30\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let u1 = PaloAltoPrismaCloud\\r\\n| where isnotempty(PolicyLastModifiedBy)\\r\\n| project User = PolicyLastModifiedBy;\\r\\nlet u2 = PaloAltoPrismaCloud\\r\\n| where isnotempty(UserName)\\r\\n| project User = UserName;\\r\\nlet users = union u1, u2;\\r\\nusers\\r\\n| summarize Actions = count() by User\\r\\n| top 10 by Actions desc\\r\\n\\r\\n\",\"size\":3,\"title\":\"Top Users\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Actions\",\"formatter\":4,\"formatOptions\":{\"palette\":\"blue\"}}]}},\"customWidth\":\"30\",\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where ResourceType =~ 'Login'\\r\\n| extend TimeFromNow = now() - TimeGenerated\\r\\n| extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n| project User= UserName, ['Source IP'] = SrcIpAddr, ['Login Result'] = strcat(iff(EventResult == 'Success', '', ''), ' ', EventResult), ['Login Time'] = TimeAgo\",\"size\":0,\"title\":\"User Logins\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"35\",\"name\":\"query - 2\"}]},\"name\":\"group - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"PaloAltoPrismaCloud\\r\\n| where isnotempty(AlertMessage)\\r\\n| top 10 by TimeGenerated desc\\r\\n| extend NumSeverity = case(AlertSeverity =~ 'low', 1, AlertSeverity =~ 'medium', 2, 3)\\r\\n| project ['Alert Time'] = TimeGenerated, ['Alert Message'] = AlertMessage, ['Severity'] = NumSeverity, ResourceRegionId, ResourceId\",\"size\":0,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":3,\"palette\":\"orangeRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}]}},\"name\":\"query - 6\"}],\"fromTemplateId\":\"sentinel-PaloAltoPrismaCloudWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=PaloAltoPrismaCloudWorkbook; logoFileName=paloalto_logo.svg; description=Sets the time name for analysis.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Palo Alto Prisma; templateRelativePath=PaloAltoPrismaCloudOverview.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "PaloAltoPrismaCloudAlert_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "PaloAltoPrismaCloudAudit_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "PaloAltoPrismaCloud",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAclAccessKeysNotRotated_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects access keys which were not rotated for 90 days.",
                "displayName": "Palo Alto Prisma Cloud - Access keys are not rotated for 90 days",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where AlertMessage has 'access keys are not rotated for 90 days'\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId1')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Access keys are not rotated for 90 days",
        "contentProductId": "[variables('_analyticRulecontentProductId1')]",
        "id": "[variables('_analyticRulecontentProductId1')]",
        "version": "[variables('analyticRuleVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAclAllowAllOut_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects network ACLs with outbound rule to allow all traffic.",
                "displayName": "Palo Alto Prisma Cloud - Network ACL allow all outbound traffic",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where AlertMessage has 'Network ACLs with Outbound rule to allow All Traffic'\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId2')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Network ACL allow all outbound traffic",
        "contentProductId": "[variables('_analyticRulecontentProductId2')]",
        "id": "[variables('_analyticRulecontentProductId2')]",
        "version": "[variables('analyticRuleVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAclAllowInToAdminPort_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId3')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects Network ACLs allow ingress traffic to server administration ports.",
                "displayName": "Palo Alto Prisma Cloud - Network ACL allow ingress traffic to server administration ports",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where AlertMessage has 'Network ACLs allow ingress traffic to server administration ports'\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 3",
                "parentId": "[variables('analyticRuleId3')]",
                "contentId": "[variables('_analyticRulecontentId3')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId3')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Network ACL allow ingress traffic to server administration ports",
        "contentProductId": "[variables('_analyticRulecontentProductId3')]",
        "id": "[variables('_analyticRulecontentProductId3')]",
        "version": "[variables('analyticRuleVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAclInAllowAll_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId4')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects Network ACLs with Inbound rule to allow All Traffic.",
                "displayName": "Palo Alto Prisma Cloud - Network ACLs Inbound rule to allow All Traffic",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where AlertMessage has 'Network ACLs with Inbound rule to allow All Traffic'\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId4'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 4",
                "parentId": "[variables('analyticRuleId4')]",
                "contentId": "[variables('_analyticRulecontentId4')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId4')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Network ACLs Inbound rule to allow All Traffic",
        "contentProductId": "[variables('_analyticRulecontentProductId4')]",
        "id": "[variables('_analyticRulecontentProductId4')]",
        "version": "[variables('analyticRuleVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAnomalousApiKeyActivity_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId5')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects anomalous API key usage activity.",
                "displayName": "Palo Alto Prisma Cloud - Anomalous access key usage",
                "enabled": false,
                "query": "let threshold = 10;\nPaloAltoPrismaCloud\n| where ResourceType =~ 'Login'\n| where EventResult =~ 'Failed'\n| where EventMessage has 'access key'\n| summarize count() by UserName, bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId5'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 5",
                "parentId": "[variables('analyticRuleId5')]",
                "contentId": "[variables('_analyticRulecontentId5')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId5')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Anomalous access key usage",
        "contentProductId": "[variables('_analyticRulecontentProductId5')]",
        "id": "[variables('_analyticRulecontentProductId5')]",
        "version": "[variables('analyticRuleVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudHighRiskScoreAlert_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId6')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects alerts with high risk score value.",
                "displayName": "Palo Alto Prisma Cloud - High risk score alert",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| extend r_score = 0.85 * toint(RiskDetailRiskScoreMaxScore)\n| extend i_RiskDetailRiskScoreScore = toint(RiskDetailRiskScoreScore)\n| where i_RiskDetailRiskScoreScore > r_score\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId6'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 6",
                "parentId": "[variables('analyticRuleId6')]",
                "contentId": "[variables('_analyticRulecontentId6')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId6')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - High risk score alert",
        "contentProductId": "[variables('_analyticRulecontentProductId6')]",
        "id": "[variables('_analyticRulecontentProductId6')]",
        "version": "[variables('analyticRuleVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudHighSeverityAlertOpenedForXDays_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId7')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects high severity alert which is opened for several days.",
                "displayName": "Palo Alto Prisma Cloud - High severity alert opened for several days",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where AlertSeverity =~ 'high'\n| where Status =~ 'open'\n| extend alert_time = now() - TimeGenerated\n| where alert_time > 1d\n| extend ['Opened Days'] = strcat('Alert opened for ', strcat(toint(alert_time / 1d), ' days'))\n| project AlertMessage, AlertSeverity, ['Opened Days'], ResourceId, UserName\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId7'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 7",
                "parentId": "[variables('analyticRuleId7')]",
                "contentId": "[variables('_analyticRulecontentId7')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId7')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - High severity alert opened for several days",
        "contentProductId": "[variables('_analyticRulecontentProductId7')]",
        "id": "[variables('_analyticRulecontentProductId7')]",
        "version": "[variables('analyticRuleVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudIamAdminGroup_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId8')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects IAM Groups with Administrator Access Permissions.",
                "displayName": "Palo Alto Prisma Cloud - IAM Group with Administrator Access Permissions",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where AlertMessage has 'IAM Groups with Administrator Access Permissions'\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId8'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 8",
                "parentId": "[variables('analyticRuleId8')]",
                "contentId": "[variables('_analyticRulecontentId8')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId8')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - IAM Group with Administrator Access Permissions",
        "contentProductId": "[variables('_analyticRulecontentProductId8')]",
        "id": "[variables('_analyticRulecontentProductId8')]",
        "version": "[variables('analyticRuleVersion8')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudInactiveUser_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId9')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects users inactive for 30 days.",
                "displayName": "Palo Alto Prisma Cloud - Inactive user",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Status =~ 'open'\n| where AlertMessage has 'Inactive users for more than 30 days'\n| extend AccountCustomEntity = ResourceId\n",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId9'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 9",
                "parentId": "[variables('analyticRuleId9')]",
                "contentId": "[variables('_analyticRulecontentId9')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId9')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Inactive user",
        "contentProductId": "[variables('_analyticRulecontentProductId9')]",
        "id": "[variables('_analyticRulecontentProductId9')]",
        "version": "[variables('analyticRuleVersion9')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudMaxRiskScoreAlert_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId10')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects alerts with maximum risk score value.",
                "displayName": "Palo Alto Prisma Cloud - Maximum risk score alert",
                "enabled": false,
                "query": "PaloAltoPrismaCloud\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| where RiskDetailRiskScoreScore == RiskDetailRiskScoreMaxScore\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId10'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 10",
                "parentId": "[variables('analyticRuleId10')]",
                "contentId": "[variables('_analyticRulecontentId10')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId10')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Maximum risk score alert",
        "contentProductId": "[variables('_analyticRulecontentProductId10')]",
        "id": "[variables('_analyticRulecontentProductId10')]",
        "version": "[variables('analyticRuleVersion10')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName11')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudMultipleFailedLoginsUser_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion11')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId11')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects multiple failed logins for the same user account.",
                "displayName": "Palo Alto Prisma Cloud - Multiple failed logins for user",
                "enabled": false,
                "query": "let threshold = 10;\nPaloAltoPrismaCloud\n| where ResourceType =~ 'Login'\n| where EventResult =~ 'Failed'\n| where EventMessage !has 'access key'\n| summarize count() by UserName, bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend AccountCustomEntity = UserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "PaloAltoPrismaCloud"
                    ],
                    "connectorId": "PaloAltoPrismaCloud"
                  }
                ],
                "tactics": [
                  "CredentialAccess"
                ],
                "techniques": [
                  "T1110"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId11'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Analytics Rule 11",
                "parentId": "[variables('analyticRuleId11')]",
                "contentId": "[variables('_analyticRulecontentId11')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion11')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId11')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Palo Alto Prisma Cloud - Multiple failed logins for user",
        "contentProductId": "[variables('_analyticRulecontentProductId11')]",
        "id": "[variables('_analyticRulecontentProductId11')]",
        "version": "[variables('analyticRuleVersion11')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudAccessKeysUsed_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Access keys used",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(30d)\n| where ResourceType =~ 'Login'\n| where EventMessage has 'access key'\n| summarize by UserName, SrcIpAddr\n| extend IPCustomEntity = SrcIpAddr\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for access keys used for programmatic access."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId1'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 1",
                "parentId": "[variables('huntingQueryId1')]",
                "contentId": "[variables('_huntingQuerycontentId1')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId1')]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Access keys used",
        "contentProductId": "[variables('_huntingQuerycontentProductId1')]",
        "id": "[variables('_huntingQuerycontentProductId1')]",
        "version": "[variables('huntingQueryVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudFailedLoginsSources_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Top sources of failed logins",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where ResourceType =~ 'Login'\n| where EventMessage !has 'access key'\n| summarize count() by SrcIpAddr\n| order by count_ desc\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for top source IP addresses of failed logins."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId2'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 2",
                "parentId": "[variables('huntingQueryId2')]",
                "contentId": "[variables('_huntingQuerycontentId2')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId2')]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Top sources of failed logins",
        "contentProductId": "[variables('_huntingQuerycontentProductId2')]",
        "id": "[variables('_huntingQuerycontentProductId2')]",
        "version": "[variables('huntingQueryVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudFailedLoginsUsers_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Top users by failed logins",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where ResourceType =~ 'Login'\n| where EventMessage !has 'access key'\n| summarize count() by UserName\n| order by count_ desc\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for users who have large number of failed logins."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId3'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 3",
                "parentId": "[variables('huntingQueryId3')]",
                "contentId": "[variables('_huntingQuerycontentId3')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId3')]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Top users by failed logins",
        "contentProductId": "[variables('_huntingQuerycontentProductId3')]",
        "id": "[variables('_huntingQuerycontentProductId3')]",
        "version": "[variables('huntingQueryVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudHighRiskScoreOpenedAlerts_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - High risk score opened alerts",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| extend r_score = 0.85 * toint(RiskDetailRiskScoreMaxScore)\n| extend i_RiskDetailRiskScoreScore = toint(RiskDetailRiskScoreScore)\n| where i_RiskDetailRiskScoreScore > r_score\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for alerts with high risk score value."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId4'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 4",
                "parentId": "[variables('huntingQueryId4')]",
                "contentId": "[variables('_huntingQuerycontentId4')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId4')]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - High risk score opened alerts",
        "contentProductId": "[variables('_huntingQuerycontentProductId4')]",
        "id": "[variables('_huntingQuerycontentProductId4')]",
        "version": "[variables('huntingQueryVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudHighSeverityAlerts_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - High severity alerts",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where Reason =~ 'NEW_ALERT'\n| where AlertSeverity =~ 'high'\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for high severity alerts."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId5'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 5",
                "parentId": "[variables('huntingQueryId5')]",
                "contentId": "[variables('_huntingQuerycontentId5')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId5')]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - High severity alerts",
        "contentProductId": "[variables('_huntingQuerycontentProductId5')]",
        "id": "[variables('_huntingQuerycontentProductId5')]",
        "version": "[variables('huntingQueryVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudNewUsers_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - New users",
                "category": "Hunting Queries",
                "query": "let known_users = \nPaloAltoPrismaCloud\n| where TimeGenerated between (ago(30d) .. (1d))\n| where ResourceType =~ 'Login'\n| where EventMessage !has 'access key'\n| summarize makeset(UserName);\nPaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where ResourceType =~ 'Login'\n| where EventMessage !has 'access key'\n| where UserName !in (known_users)\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for new users."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId6'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 6",
                "parentId": "[variables('huntingQueryId6')]",
                "contentId": "[variables('_huntingQuerycontentId6')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId6')]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - New users",
        "contentProductId": "[variables('_huntingQuerycontentProductId6')]",
        "id": "[variables('_huntingQuerycontentProductId6')]",
        "version": "[variables('huntingQueryVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudOpenedAlerts_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Opened alerts",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where Reason =~ 'NEW_ALERT'\n| where Status =~ 'open'\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches opened alerts."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId7'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 7",
                "parentId": "[variables('huntingQueryId7')]",
                "contentId": "[variables('_huntingQuerycontentId7')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId7')]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Opened alerts",
        "contentProductId": "[variables('_huntingQuerycontentProductId7')]",
        "id": "[variables('_huntingQuerycontentProductId7')]",
        "version": "[variables('huntingQueryVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudTopResources_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Top recources with alerts",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where Reason =~ 'NEW_ALERT'\n| summarize count() by ResourceName\n| order by count_ desc\n| extend AccountCustomEntity = ResourceName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for resources which appeared in different alerts."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId8'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 8",
                "parentId": "[variables('huntingQueryId8')]",
                "contentId": "[variables('_huntingQuerycontentId8')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId8')]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Top recources with alerts",
        "contentProductId": "[variables('_huntingQuerycontentProductId8')]",
        "id": "[variables('_huntingQuerycontentProductId8')]",
        "version": "[variables('huntingQueryVersion8')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PaloAltoPrismaCloudUpdatedResources_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "PaloAltoPrismaCloud_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Palo Alto Prisma Cloud - Updated resources",
                "category": "Hunting Queries",
                "query": "PaloAltoPrismaCloud\n| where TimeGenerated > ago(24h)\n| where Reason =~ 'RESOURCE_UPDATED'\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches recently updated resources."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId9'),'/'))))]",
              "properties": {
                "description": "PaloAltoPrismaCloud Hunting Query 9",
                "parentId": "[variables('huntingQueryId9')]",
                "contentId": "[variables('_huntingQuerycontentId9')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAltoPrismaCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId9')]",
        "contentKind": "HuntingQuery",
        "displayName": "Palo Alto Prisma Cloud - Updated resources",
        "contentProductId": "[variables('_huntingQuerycontentProductId9')]",
        "id": "[variables('_huntingQuerycontentProductId9')]",
        "version": "[variables('huntingQueryVersion9')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "PaloAltoPrismaCloud",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> <em>There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</em></p>\n<p>The <a href=\"https://www.paloaltonetworks.com/prisma/cloud\">Palo Alto Prisma Cloud</a> CSPM solution provides the capability to ingest Prisma Cloud CSPM alerts and audit logs into Microsoft Sentinel using the Prisma Cloud CSPM API. Refer to Prisma Cloud CSPM API documentation for more information.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ol type=\"a\">\n<li><p><a href=\"https://docs.microsoft.com/azure/azure-monitor/logs/data-collector-api\">Azure Monitor HTTP Data Collector API</a></p>\n</li>\n<li><p><a href=\"https://azure.microsoft.com/services/functions/#overview\">Azure Functions</a></p>\n</li>\n</ol>\n<p><strong>Data Connectors:</strong> 1, <strong>Parsers:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 11, <strong>Hunting Queries:</strong> 9, <strong>Custom Azure Logic Apps Connectors:</strong> 1, <strong>Playbooks:</strong> 2</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/PaloAltoPrismaCloud/logo/Palo-alto-logo.png\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "PaloAltoPrismaCloud",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId1')]",
              "version": "[variables('parserVersion1')]"
            },
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_PrismaCloudCSPMCustomConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_PrismaCloudCSPM-Enrichment')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_PrismaCloudCSPM-Remediation')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId3')]",
              "version": "[variables('analyticRuleVersion3')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId4')]",
              "version": "[variables('analyticRuleVersion4')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId5')]",
              "version": "[variables('analyticRuleVersion5')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId6')]",
              "version": "[variables('analyticRuleVersion6')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId7')]",
              "version": "[variables('analyticRuleVersion7')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId8')]",
              "version": "[variables('analyticRuleVersion8')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId9')]",
              "version": "[variables('analyticRuleVersion9')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId10')]",
              "version": "[variables('analyticRuleVersion10')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId11')]",
              "version": "[variables('analyticRuleVersion11')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId1')]",
              "version": "[variables('huntingQueryVersion1')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId2')]",
              "version": "[variables('huntingQueryVersion2')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId3')]",
              "version": "[variables('huntingQueryVersion3')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId4')]",
              "version": "[variables('huntingQueryVersion4')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId5')]",
              "version": "[variables('huntingQueryVersion5')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId6')]",
              "version": "[variables('huntingQueryVersion6')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId7')]",
              "version": "[variables('huntingQueryVersion7')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId8')]",
              "version": "[variables('huntingQueryVersion8')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId9')]",
              "version": "[variables('huntingQueryVersion9')]"
            }
          ]
        },
        "firstPublishDate": "2021-04-16",
        "providers": [
          "Palo Alto Networks"
        ],
        "categories": {
          "domains": [
            "Security - Cloud Security"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
