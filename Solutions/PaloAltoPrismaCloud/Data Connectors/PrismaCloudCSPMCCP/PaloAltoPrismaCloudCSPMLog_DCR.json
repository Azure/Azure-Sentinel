[
    {
        "name": "PaloAltoPrismaCloudCSPMDCR",
        "apiVersion": "2021-09-01-preview",
        "type": "Microsoft.Insights/dataCollectionRules",
        "location": "{{location}}",
        "properties": {
            "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
            "streamDeclarations": [
                {
                    "Custom-PaloAltoPrismaCloudAlert": {
                        "columns": [
                            {
                                "name": "id",
                                "type": "string"
                            },
                            {
                                "name": "status",
                                "type": "datetime"
                            },
                            {
                                "name": "reason",
                                "type": "string"
                            },
                            {
                                "name": "firstSeen",
                                "type": "real"
                            },
                            {
                                "name": "lastSeen",
                                "type": "real"
                            },
                            {
                                "name": "alertTime",
                                "type": "real"
                            },
                            {
                                "name": "lastUpdated",
                                "type": "datetime"
                            },
                            {
                                "name": "policy",
                                "type": "dynamic"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            },
                            {
                                "name": "resource",
                                "type": "dynamic"
                            }
                        ]
                    }
                },
                {
                    "Custom-PaloAltoPrismaCloudAudit": {
                        "columns": [
                            {
                                "name": "timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "user",
                                "type": "string"
                            },
                            {
                                "name": "ipAddress",
                                "type": "string"
                            },
                            {
                                "name": "actionType",
                                "type": "string"
                            },
                            {
                                "name": "resourceName",
                                "type": "string"
                            },
                            {
                                "name": "action",
                                "type": "string"
                            },
                            {
                                "name": "resourceType",
                                "type": "string"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            },
                            {
                                "name": "result",
                                "type": "string"
                            }
                        ],
                        "destinations": {
                            "logAnalytics": [
                                {
                                    "workspaceResourceId": "{{workspaceResourceId}}",
                                    "name": "clv2ws1"
                                }
                            ]
                        },
                        "dataFlows": [
                            {
                                "streams": [
                                    "Custom-PaloAltoPrismaCloudAlert"
                                ],
                                "destinations": [
                                    "clv2ws1"
                                ],
                                "transformKql": "source | extend policy = parse_json(policy) | extend PolicyPolicyId = tostring(policy.policyId) | extend PolicySystemDefault = tobool(policy.systemDefault) | extend PolicySeverity = tostring(policy.severity) | extend PolicyRecommendation = tostring(policy.recommendation) | extend PolicyRemediable = tostring(policy.remediable) | project TimeGenerated, PolicyPolicyId, id, PolicySystemDefault, PolicySeverity, PolicyRecommendation, PolicyRemediable, Id, Status, Reason, firstSeen, LastSeen, AlertTime, LastUpdated",
                                "outputStream": "Custom-PaloAltoPrismaCloudAlertV2_CL"
                            },
                            {
                                "streams": [
                                    "Custom-PaloAltoPrismaCloudAudit"
                                ],
                                "destinations": [
                                    "clv2ws1"
                                ],
                                "transformKql": "source",
                                "outputStream": "Custom-PaloAltoPrismaCloudAuditV2_CL"
                            }
                        ]
                    }
                }
            ]
        }
    }
]