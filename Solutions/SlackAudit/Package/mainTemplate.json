{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for SlackAudit"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "SlackAudit",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "SlackAudit",
    "_solutionVersion": "3.0.1",
    "solutionId": "azuresentinel.azure-sentinel-solution-slackaudit",
    "_solutionId": "[variables('solutionId')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "SlackAudit",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "04528635-a5f1-438b-ab74-21ca7bc3aa32",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '04528635-a5f1-438b-ab74-21ca7bc3aa32')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('04528635-a5f1-438b-ab74-21ca7bc3aa32')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','04528635-a5f1-438b-ab74-21ca7bc3aa32','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "3db0cb83-5fa4-4310-a8a0-d8d66183f0bd",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '3db0cb83-5fa4-4310-a8a0-d8d66183f0bd')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('3db0cb83-5fa4-4310-a8a0-d8d66183f0bd')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','3db0cb83-5fa4-4310-a8a0-d8d66183f0bd','-', '1.0.0')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "93a91c37-032c-4380-847c-957c001957ad",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '93a91c37-032c-4380-847c-957c001957ad')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('93a91c37-032c-4380-847c-957c001957ad')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','93a91c37-032c-4380-847c-957c001957ad','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "279316e8-8965-47d2-9788-b94dc352c853",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '279316e8-8965-47d2-9788-b94dc352c853')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('279316e8-8965-47d2-9788-b94dc352c853')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','279316e8-8965-47d2-9788-b94dc352c853','-', '1.0.0')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.0",
      "_analyticRulecontentId5": "132b98a5-07e9-401a-9b6f-453e52a53979",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '132b98a5-07e9-401a-9b6f-453e52a53979')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('132b98a5-07e9-401a-9b6f-453e52a53979')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','132b98a5-07e9-401a-9b6f-453e52a53979','-', '1.0.0')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.1",
      "_analyticRulecontentId6": "3b11f06e-4afd-4ae6-8477-c61136619ac8",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '3b11f06e-4afd-4ae6-8477-c61136619ac8')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('3b11f06e-4afd-4ae6-8477-c61136619ac8')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','3b11f06e-4afd-4ae6-8477-c61136619ac8','-', '1.0.1')))]"
    },
    "analyticRuleObject7": {
      "analyticRuleVersion7": "1.0.0",
      "_analyticRulecontentId7": "be6c5fc9-2ac3-43e6-8fb0-cb139e04e43e",
      "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'be6c5fc9-2ac3-43e6-8fb0-cb139e04e43e')]",
      "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('be6c5fc9-2ac3-43e6-8fb0-cb139e04e43e')))]",
      "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','be6c5fc9-2ac3-43e6-8fb0-cb139e04e43e','-', '1.0.0')))]"
    },
    "analyticRuleObject8": {
      "analyticRuleVersion8": "1.0.0",
      "_analyticRulecontentId8": "9d85feb3-7f54-4181-b143-68abb1a86823",
      "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '9d85feb3-7f54-4181-b143-68abb1a86823')]",
      "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('9d85feb3-7f54-4181-b143-68abb1a86823')))]",
      "_analyticRulecontentProductId8": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','9d85feb3-7f54-4181-b143-68abb1a86823','-', '1.0.0')))]"
    },
    "analyticRuleObject9": {
      "analyticRuleVersion9": "1.0.0",
      "_analyticRulecontentId9": "e6e99dcb-4dff-48d2-8012-206ca166b36b",
      "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'e6e99dcb-4dff-48d2-8012-206ca166b36b')]",
      "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('e6e99dcb-4dff-48d2-8012-206ca166b36b')))]",
      "_analyticRulecontentProductId9": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','e6e99dcb-4dff-48d2-8012-206ca166b36b','-', '1.0.0')))]"
    },
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "SlackAuditLogsCCPDefinition",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "SlackAuditLogsCCPDefinitionConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "uiConfigId2": "SlackAuditAPI",
    "_uiConfigId2": "[variables('uiConfigId2')]",
    "dataConnectorContentId2": "SlackAuditAPI",
    "_dataConnectorContentId2": "[variables('dataConnectorContentId2')]",
    "dataConnectorId2": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
    "_dataConnectorId2": "[variables('dataConnectorId2')]",
    "dataConnectorTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId2'))))]",
    "dataConnectorVersion2": "1.0.0",
    "_dataConnectorcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId2'),'-', variables('dataConnectorVersion2'))))]",
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','SlackAudit Data Parser')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'SlackAudit Data Parser')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('SlackAudit-Parser')))]",
      "parserVersion1": "1.0.0",
      "parserContentId1": "SlackAudit-Parser"
    },
    "huntingQueryObject1": {
      "huntingQueryVersion1": "1.0.0",
      "_huntingQuerycontentId1": "cefd7f18-9359-4a99-bd18-965983bb724d",
      "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('cefd7f18-9359-4a99-bd18-965983bb724d')))]"
    },
    "huntingQueryObject2": {
      "huntingQueryVersion2": "1.0.0",
      "_huntingQuerycontentId2": "f2b2cd0d-6190-44aa-8e0e-265de45ee379",
      "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('f2b2cd0d-6190-44aa-8e0e-265de45ee379')))]"
    },
    "huntingQueryObject3": {
      "huntingQueryVersion3": "1.0.0",
      "_huntingQuerycontentId3": "7865b00c-26c8-46db-9422-bb9e4ee696ac",
      "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('7865b00c-26c8-46db-9422-bb9e4ee696ac')))]"
    },
    "huntingQueryObject4": {
      "huntingQueryVersion4": "1.0.0",
      "_huntingQuerycontentId4": "b62b5a97-41e5-47cb-9b90-aa079f65f0c0",
      "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('b62b5a97-41e5-47cb-9b90-aa079f65f0c0')))]"
    },
    "huntingQueryObject5": {
      "huntingQueryVersion5": "1.0.0",
      "_huntingQuerycontentId5": "d65400c2-50a3-46cc-b3e6-1cb72b953e72",
      "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('d65400c2-50a3-46cc-b3e6-1cb72b953e72')))]"
    },
    "huntingQueryObject6": {
      "huntingQueryVersion6": "1.0.0",
      "_huntingQuerycontentId6": "31e54776-f2db-4465-b951-410880e009ad",
      "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('31e54776-f2db-4465-b951-410880e009ad')))]"
    },
    "huntingQueryObject7": {
      "huntingQueryVersion7": "1.0.0",
      "_huntingQuerycontentId7": "aa9bc100-012a-4348-820d-06606fc11299",
      "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('aa9bc100-012a-4348-820d-06606fc11299')))]"
    },
    "huntingQueryObject8": {
      "huntingQueryVersion8": "1.0.0",
      "_huntingQuerycontentId8": "85850974-acbf-47bd-a635-4e3511b553c0",
      "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('85850974-acbf-47bd-a635-4e3511b553c0')))]"
    },
    "huntingQueryObject9": {
      "huntingQueryVersion9": "1.0.0",
      "_huntingQuerycontentId9": "7adbe474-debf-47c2-9d76-49efd4d2953b",
      "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('7adbe474-debf-47c2-9d76-49efd4d2953b')))]"
    },
    "huntingQueryObject10": {
      "huntingQueryVersion10": "1.0.0",
      "_huntingQuerycontentId10": "ef815b70-e6f6-427b-ac9f-56d73472c4c3",
      "huntingQueryTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('ef815b70-e6f6-427b-ac9f-56d73472c4c3')))]"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAudit Workbook with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Sets the time name for analysis"
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\">**NOTE:** This workbook uses a parser based on a Kusto Function to normalize fields. [Follow these steps](https://aka.ms/sentinel-SlackAuditAPI-parser) to create the Kusto function alias **SlackAudit**.\"},\"name\":\"text - 0\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"e34269c3-8c77-4e2c-aacb-b86537b2fa1d\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Slack User Activity\",\"subTarget\":\"slack_user_activity\",\"preText\":\"Slack User Activity\",\"style\":\"link\"},{\"id\":\"6d5f697d-6098-4196-bba8-843fefeeb2de\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Slack App Activity\",\"subTarget\":\"slack_app_activity\",\"style\":\"link\"},{\"id\":\"0be65784-c532-422e-9086-58b4de769e34\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Slack File Activity\",\"subTarget\":\"slack_file_activity\",\"style\":\"link\"},{\"id\":\"3ea7ee87-1041-4002-8169-8491ff5d0435\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Slack Channels Activity\",\"subTarget\":\"slack_channels_activity\",\"style\":\"link\"}]},\"name\":\"links - 10\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"6b5965ee-e865-485e-b361-22f71c9ae4f1\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":2419200000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit \\n| extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n | where Action startswith \\\"user\\\" | summarize count() by Action\",\"size\":3,\"title\":\"Users Action Chart\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_user_activity\"},\"customWidth\":\"33\",\"name\":\"Users Action Chart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action == \\\"user_login\\\"\\n|make-series Trend = count(SrcUserEmail) on evt_time from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SrcUserEmail;\",\"size\":0,\"title\":\"Successful Logins over Time\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"tileSettings\":{\"showBorder\":false}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_user_activity\"},\"customWidth\":\"33\",\"name\":\"Successful Logins over Time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action == \\\"user_login_failed\\\"\\n|make-series Trend = count(SrcUserEmail) on evt_time from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SrcUserEmail;\",\"size\":3,\"title\":\"Failed Logins over Time\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"tileSettings\":{\"showBorder\":false}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_user_activity\"},\"customWidth\":\"33\",\"name\":\"Failed Logins over Time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action == \\\"user_login\\\"\\n| summarize Login = count() by Time=evt_time, Email=ActorUserEmail, Context_Domain_Location=ContextLocationDomain, IP=ContextIpAddress, ContextLocationName = ContextLocationName | sort by Time \",\"size\":3,\"title\":\"Login Activity\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":20}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_user_activity\"},\"customWidth\":\"50\",\"name\":\"Login Activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action == \\\"user_created\\\"\\n| project Time=evt_time, Email=ActorUserEmail, Context_Domain_Location=ContextLocationDomain, IP=ContextIpAddress, ContextLocationName = ContextLocationName,Created_User=EntityUserEmail, Action, ActionDescription | sort by Time\",\"size\":3,\"title\":\"Users Created\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":20}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_user_activity\"},\"customWidth\":\"50\",\"name\":\"Users Created\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let Guest_Created_list = \\nSlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action == \\\"guest_created\\\" | summarize make_list(EntityUserEmail);\\nlet Guest_Actions =\\n SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where ActorUserEmail in (Guest_Created_list)\\n | extend UserAct = strcat(ActorUserEmail,\\\" - \\\",Action);\\n Guest_Actions | make-series Trend = count() on evt_time from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by UserAct\",\"size\":0,\"title\":\"New Guest Users Activity Timechart\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"graphSettings\":{\"type\":0},\"mapSettings\":{\"locInfo\":\"LatLong\"}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_user_activity\"},\"customWidth\":\"50\",\"name\":\"New Guest Users Activity Timechart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action == \\\"user_deactivated\\\"\\n| project Time=evt_time, Email=ActorUserEmail, Context_Domain_Location=ContextLocationDomain, IP=ContextIpAddress, ContextLocationName = ContextLocationName,Deactivated_User=EntityUserEmail, Action, ActionDescription | sort by Time\",\"size\":0,\"title\":\"Users Deactivated\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_user_activity\"},\"customWidth\":\"50\",\"name\":\"Users Deactivated\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let Guest_Created_list = \\nSlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action == \\\"guest_created\\\" | summarize make_list(EntityUserEmail);\\nlet Guest_Actions =\\n SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n| where ActorUserEmail in (Guest_Created_list);\\n Guest_Actions | project Time=evt_time, GuestEmail=ActorUserEmail, Context_Domain_Location=ContextLocationDomain, IP=ContextIpAddress, ContextLocationName = ContextLocationName, Action, ActionDescription | sort by Time\",\"size\":0,\"title\":\"New Guest Users Activity \",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_user_activity\"},\"customWidth\":\"50\",\"name\":\"New Guest Users Activity \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"app_installed\\\" or Action == \\\"app_approved\\\" or Action == \\\"app_restricted\\\"\\n | extend Action = case(Action == \\\"app_installed\\\", \\\"Applications Installed\\\", \\n                       Action == \\\"app_approved\\\", \\\"Applications Approved\\\", \\n                       \\\"Applications Restricted\\\")\\n | summarize count() by Action\",\"size\":1,\"title\":\"Application Actions\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Action\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_app_activity\"},\"customWidth\":\"100\",\"name\":\"Application Actions\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"app_installed\\\"\\n |  project Time=evt_time, ActorUserEmail, Context_Domain_Location=ContextLocationDomain, IP=ContextIpAddress, ContextLocationName = ContextLocationName, Action, ActionDescription, AppScopes =EntityAppScopes, App=EntityAppName \\n | summarize Count=count() by App | sort by Count desc\",\"size\":0,\"title\":\"Apps Installed Chart\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_app_activity\"},\"customWidth\":\"50\",\"name\":\"Apps Installed Chart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"app_installed\\\"\\n |  project Time=evt_time, ActorUserEmail, Context_Domain_Location=ContextLocationDomain, IP=ContextIpAddress, ContextLocationName = ContextLocationName, Action, ActionDescription, AppScopes =EntityAppScopes, App=EntityAppName | sort by Time\",\"size\":0,\"title\":\"Apps Installed\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_app_activity\"},\"customWidth\":\"50\",\"name\":\"Apps Installed\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"app_restricted\\\"\\n |  project Time=evt_time, ActorUserEmail, Context_Domain_Location=ContextLocationDomain, IP=ContextIpAddress, ContextLocationName = ContextLocationName, Action, ActionDescription, AppScopes =EntityAppScopes, App=EntityAppName | sort by Time\",\"size\":0,\"title\":\"Apps Restricted\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_app_activity\"},\"customWidth\":\"50\",\"name\":\"Apps Restricted\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"app_restricted\\\"\\n |  project Time=evt_time, ActorUserEmail, Context_Domain_Location=ContextLocationDomain, IP=ContextIpAddress, ContextLocationName = ContextLocationName, Action, ActionDescription, AppScopes =EntityAppScopes, App=EntityAppName \\n | summarize Count=count() by App | sort by Count desc\",\"size\":0,\"title\":\"Apps Restricted Chart\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_app_activity\"},\"customWidth\":\"50\",\"name\":\"Apps Restricted Chart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"app_approved\\\"\\n |  project Time=evt_time, ActorUserEmail, Context_Domain_Location=ContextLocationDomain, IP=ContextIpAddress, ContextLocationName = ContextLocationName, Action, ActionDescription, AppScopes =EntityAppScopes, App=EntityAppName | sort by Time\",\"size\":0,\"title\":\"Apps Approved\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_app_activity\"},\"customWidth\":\"50\",\"name\":\"Apps Approved\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"app_approved\\\"\\n |  project Time=evt_time, ActorUserEmail, Context_Domain_Location=ContextLocationDomain, IP=ContextIpAddress, ContextLocationName = ContextLocationName, Action, ActionDescription, AppScopes =EntityAppScopes, App=EntityAppName \\n | summarize Count=count() by App | sort by Count desc\",\"size\":0,\"title\":\"Apps Approved Chart\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_app_activity\"},\"customWidth\":\"50\",\"name\":\"Apps Approved Chart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"file_downloaded\\\" or Action == \\\"file_uploaded\\\" or Action == \\\"file_shared\\\" or Action == \\\"file_public_link_created\\\" or Action == \\\"file_public_link_revoked\\\" or Action == \\\"file_downloaded_blocked\\\"\\n | extend Action = case(Action == \\\"file_downloaded\\\", \\\"Downloaded\\\", Action == \\\"file_uploaded\\\", \\\"Uploaded\\\", Action == \\\"file_shared\\\",\\\"Shared\\\", Action == \\\"file_public_link_created\\\", \\\"Public Link Created\\\",Action == \\\"file_public_link_revoked\\\", \\\"Public Link Revoked\\\",\\\"Download Blocked\\\" )\\n | summarize count() by Action | sort by count_ desc\",\"size\":1,\"title\":\"File Actions\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Action\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"name\":\"File Actions\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"file_downloaded\\\"\\n | make-series Trend = count() on evt_time from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ActorUserEmail;\",\"size\":0,\"title\":\"File Downloads Activity TImechart\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"customWidth\":\"50\",\"name\":\"File Downloads Activity TImechart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"file_downloaded\\\"\\n | project Time =evt_time, Workspace=ContextLocationName, [\\\"File Title\\\"] = EntityFileTitle, User = ActorUserName, Action, ActionDescription\\n | sort by Time desc | take 100\",\"size\":0,\"title\":\"File Downloads Activity\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"customWidth\":\"50\",\"name\":\"File Downloads Activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where Action == \\\"file_uploaded\\\"\\n | make-series Trend = count() on evt_time from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ActorUserEmail;\",\"size\":0,\"title\":\"File Uploads Activity Timechart\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"customWidth\":\"50\",\"name\":\"File Uploads Activity Timechart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"file_uploaded\\\"\\n | project Time =evt_time, Workspace=ContextLocationName, [\\\"File Title\\\"] = EntityFileTitle, User = ActorUserName, Action, ActionDescription\\n | sort by Time desc | take 100\",\"size\":0,\"title\":\"File Uploads Activity\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"customWidth\":\"50\",\"name\":\"File Uploads Activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"file_shared\\\"\\n | make-series Trend = count() on evt_time from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ActorUserEmail;\",\"size\":0,\"title\":\"Shared Files Activity Timechart\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"customWidth\":\"50\",\"name\":\"Shared Files Activity Timechart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"file_shared\\\"\\n | project Time =evt_time, Workspace=ContextLocationName, [\\\"File Title\\\"] = EntityFileTitle, User = ActorUserName, Action, ActionDescription\\n | sort by Time desc | take 100\",\"size\":0,\"title\":\"Shared Files Activity\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"customWidth\":\"50\",\"name\":\"Shared Files Activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"file_public_link_created\\\"\\n | make-series Trend = count() on evt_time from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ActorUserEmail;\",\"size\":0,\"title\":\"File Public Link Created Activity Timechart\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"customWidth\":\"50\",\"name\":\"File Public Link Created Activity Timechart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"file_public_link_created\\\"\\n | project Time =evt_time, Workspace=ContextLocationName, [\\\"File Title\\\"] = EntityFileTitle, User = ActorUserName, Action, ActionDescription\\n | sort by Time desc | take 100\",\"size\":0,\"title\":\"File Public Link Created Activity\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"customWidth\":\"50\",\"name\":\"File Public Link Created Activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"file_public_link_revoked\\\"\\n | make-series Trend = count() on evt_time from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ActorUserEmail;\",\"size\":0,\"title\":\"File Public Link Revoked Activity Timechart\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"customWidth\":\"50\",\"name\":\"File Public Link Revoked Activity Timechart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" SlackAudit\\n | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n | where evt_time {TimeRange}\\n | where Action == \\\"file_public_link_revoked\\\"\\n | project Time =evt_time, Workspace=ContextLocationName, [\\\"File Title\\\"] = EntityFileTitle, User = ActorUserName, Action, ActionDescription\\n | sort by Time desc | take 100\",\"size\":0,\"title\":\"File Public Link Revoked Activity\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_file_activity\"},\"customWidth\":\"50\",\"name\":\"File Public Link Revoked Activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"\\nSlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where Action contains \\\"_channel_\\\"\\n| summarize count() by ActionDescription | sort by count_ desc\",\"size\":1,\"title\":\"Channels Activity\",\"timeContext\":{\"durationMs\":172800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"ActionDescription\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_channels_activity\"},\"name\":\"Channels Activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action contains \\\"private_channel\\\"\\n| summarize count() by ActionDescription\",\"size\":0,\"title\":\"Private Channels Activity\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_channels_activity\"},\"customWidth\":\"50\",\"name\":\"Private Channels Activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action contains \\\"private_channel\\\"\\n| project Time=evt_time, ActorUser=ActorUserEmail, Action, ActionDescription, [\\\"Channel Name\\\"]= EntityChannelName, ContextLocationDomain, Ip=ContextIpAddress, EntityChannelIsShared,EntityChannelIsOrgShared\\n| sort by Time\",\"size\":0,\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_channels_activity\"},\"customWidth\":\"50\",\"name\":\"PrivateChannelActivity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action contains \\\"public_channel\\\"\\n| summarize count() by ActionDescription\",\"size\":0,\"title\":\"Public Channels Activity\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_channels_activity\"},\"customWidth\":\"50\",\"name\":\"Public Channels Activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action contains \\\"public_channel\\\"\\n| project Time=evt_time, ActorUser=ActorUserEmail, Action, ActionDescription, [\\\"Channel Name\\\"]= EntityChannelName, ContextLocationDomain, Ip=ContextIpAddress, EntityChannelIsShared,EntityChannelIsOrgShared\\n| sort by Time\",\"size\":0,\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_channels_activity\"},\"customWidth\":\"50\",\"name\":\"PublicChannelActivity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action contains \\\"guest_channel\\\"\\n| summarize count() by ActionDescription\",\"size\":0,\"title\":\"Guest Channels Activity\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_channels_activity\"},\"customWidth\":\"50\",\"name\":\"Guest Channels Activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SlackAudit | extend evt_time = unixtime_seconds_todatetime(EventEndTime)\\n| where evt_time {TimeRange}\\n| where Action contains \\\"guest_channel\\\"\\n| project Time=evt_time, ActorUser=ActorUserEmail, Action, ActionDescription, [\\\"Channel Name\\\"]= EntityChannelName, ContextLocationDomain, Ip=ContextIpAddress, EntityChannelIsShared,EntityChannelIsOrgShared\\n| sort by Time\",\"size\":0,\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"slack_channels_activity\"},\"customWidth\":\"50\",\"name\":\"GuestChannelActivity\"}],\"fromTemplateId\":\"sentinel-SlackAudit\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=SlackAudit; logoFileName=slacklogo.svg; description=Sets the time name for analysis; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=SlackAudit; templateRelativePath=SlackAudit.json; subtitle=; provider=Slack}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "SlackAudit_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SlackAuditAPI",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditEmptyUA_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This query shows connections to the Slack Workspace with empty User Agent.",
                "displayName": "SlackAudit - Empty User Agent",
                "enabled": false,
                "query": "SlackAudit\n| where isempty(UserAgentOriginal)\n| extend AccountCustomEntity = SrcUserName\n",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SlackAudit_CL"
                    ],
                    "connectorId": "SlackAuditAPI"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "AccountCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "SlackAudit Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "SlackAudit - Empty User Agent",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditMultipleArchivedFilesUploadedInShortTimePeriod_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This query helps to detect when a user uploads multiple archived files in short period of time.",
                "displayName": "SlackAudit - Multiple archived files uploaded in short period of time",
                "enabled": false,
                "query": "let threshold = 10;\nSlackAudit\n| where DvcAction =~ 'file_uploaded'\n| extend FE = extract(@'.*\\.(.*)$', 1, EntityFileName)\n| where FE in~ ('tar', 'bz2', 'gz', 'tgz', 'Z', 'tbz2', 'zst', 'zip', 'zipx', '7z', 'rar', 'sfx')\n| summarize count() by SrcUserName, bucket = bin(TimeGenerated, 15m)\n| where count_ > threshold\n| extend AccountCustomEntity = SrcUserName\n",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SlackAudit_CL"
                    ],
                    "connectorId": "SlackAuditAPI"
                  }
                ],
                "tactics": [
                  "Exfiltration"
                ],
                "techniques": [
                  "T1567"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "AccountCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "SlackAudit Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "SlackAudit - Multiple archived files uploaded in short period of time",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditMultipleFailedLoginsForUser_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This query helps to detect bruteforce of a user account.",
                "displayName": "SlackAudit - Multiple failed logins for user",
                "enabled": false,
                "query": "let threshold = 10;\nSlackAudit\n| where DvcAction =~ 'user_login_failed'\n| summarize count() by SrcUserName, bucket = bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend AccountCustomEntity = SrcUserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SlackAudit_CL"
                    ],
                    "connectorId": "SlackAuditAPI"
                  }
                ],
                "tactics": [
                  "CredentialAccess"
                ],
                "techniques": [
                  "T1110"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "AccountCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "SlackAudit Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "SlackAudit - Multiple failed logins for user",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditSensitiveFile_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects public links for files which potentialy may contain sensitive data such as passwords, authentication tokens, secret keys.",
                "displayName": "SlackAudit - Public link created for file which can contain sensitive information.",
                "enabled": false,
                "query": "SlackAudit\n| where Action =~ 'file_public_link_created'\n| where EntityFileName == 'id_rsa' or EntityFileName contains 'password' or EntityFileName contains 'key' or EntityFileName contains '_key' or EntityFileName contains '.ssh' or EntityFileName endswith '.npmrc' or EntityFileName endswith '.muttrc' or EntityFileName contains 'config.json' or EntityFileName contains '.gitconfig' or EntityFileName endswith '.netrc' or EntityFileName endswith 'package.json' or EntityFileName endswith 'Gemfile' or EntityFileName endswith 'bower.json' or EntityFileName endswith 'config.gypi' or EntityFileName endswith 'travis.yml'\n| extend AccountCustomEntity = SrcUserName\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SlackAudit_CL"
                    ],
                    "connectorId": "SlackAuditAPI"
                  }
                ],
                "tactics": [
                  "Exfiltration"
                ],
                "techniques": [
                  "T1048"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "AccountCustomEntity"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "SlackAudit Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "SlackAudit - Public link created for file which can contain sensitive information.",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditSuspiciousFileDownloaded_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects potentialy suspicious downloads.",
                "displayName": "SlackAudit - Suspicious file downloaded.",
                "enabled": false,
                "query": "SlackAudit\n| where DvcAction =~ 'file_downloaded'\n| extend fe = split(EntityFileName, '.')\n| where array_length(fe) > 2\n| where fe[1] matches regex @\"\\D+\"\n| where strlen(fe[1]) < 5\n| project EntityFileName, SrcUserName\n| extend AccountCustomEntity = SrcUserName\n| extend FileCustomEntity = EntityFileName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SlackAudit_CL"
                    ],
                    "connectorId": "SlackAuditAPI"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1189"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "AccountCustomEntity"
                      }
                    ]
                  },
                  {
                    "entityType": "File",
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "FileCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "SlackAudit Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "SlackAudit - Suspicious file downloaded.",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditUnknownUA_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This query helps to detect who trying to connect to the Slack Workspace with unknown User Agent.",
                "displayName": "SlackAudit - Unknown User Agent",
                "enabled": false,
                "query": "let lbperiod = 14d;\nlet known_UAs = SlackAudit\n| where TimeGenerated > ago(lbperiod)\n| where isnotempty(UserAgentOriginal)\n| summarize makeset(UserAgentOriginal);\nSlackAudit\n| where UserAgentOriginal !in (known_UAs)\n| extend AccountCustomEntity = SrcUserName\n",
                "queryFrequency": "PT24H",
                "queryPeriod": "P14D",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SlackAudit_CL"
                    ],
                    "connectorId": "SlackAuditAPI"
                  }
                ],
                "tactics": [
                  "CommandAndControl"
                ],
                "techniques": [
                  "T1071"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "AccountCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "SlackAudit Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "SlackAudit - Unknown User Agent",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject7').analyticRuleTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditUserChangedToAdminOrOwner_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject7').analyticRuleVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This query helps to detect a change in the users role to admin or owner.",
                "displayName": "SlackAudit - User role changed to admin or owner",
                "enabled": false,
                "query": "SlackAudit\n| where DvcAction in~ ('role_change_to_admin', 'role_change_to_owner')\n| extend AccountCustomEntity = SrcUserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SlackAudit_CL"
                    ],
                    "connectorId": "SlackAuditAPI"
                  }
                ],
                "tactics": [
                  "Persistence",
                  "PrivilegeEscalation"
                ],
                "techniques": [
                  "T1098",
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "AccountCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject7').analyticRuleId7,'/'))))]",
              "properties": {
                "description": "SlackAudit Analytics Rule 7",
                "parentId": "[variables('analyticRuleObject7').analyticRuleId7]",
                "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject7').analyticRuleVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
        "contentKind": "AnalyticsRule",
        "displayName": "SlackAudit - User role changed to admin or owner",
        "contentProductId": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "id": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject8').analyticRuleTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditUserEmailChanged_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject8').analyticRuleVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when user email linked to account changes.",
                "displayName": "SlackAudit - User email linked to account changed.",
                "enabled": false,
                "query": "SlackAudit\n| where TimeGenerated between (ago(14d) .. (1d))\n| summarize max(TimeGenerated) by SrcUserName, SrcUserEmail\n| join (SlackAudit \n      | where Action =~ 'user_login'\n      | project SrcIpAddr, SrcUserName, NewUserEmail = SrcUserEmail) on SrcUserName\n| where NewUserEmail != SrcUserEmail\n| extend AccountCustomEntity = SrcUserName\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P14D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SlackAudit_CL"
                    ],
                    "connectorId": "SlackAuditAPI"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "AccountCustomEntity"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject8').analyticRuleId8,'/'))))]",
              "properties": {
                "description": "SlackAudit Analytics Rule 8",
                "parentId": "[variables('analyticRuleObject8').analyticRuleId8]",
                "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject8').analyticRuleVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
        "contentKind": "AnalyticsRule",
        "displayName": "SlackAudit - User email linked to account changed.",
        "contentProductId": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "id": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject9').analyticRuleTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditUserLoginAfterDeactivated_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject9').analyticRuleVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when user email linked to account changes.",
                "displayName": "SlackAudit - User login after deactivated.",
                "enabled": false,
                "query": "let lbperiod_max_d = 14d;\nlet lbperiod_min_d = 1d;\nlet lb_time_max_h = 24h;\nSlackAudit\n| where TimeGenerated between (ago(lbperiod_max_d) .. (lbperiod_min_d))\n| where Action =~ 'user_deactivated'\n| summarize deactivation_time = max(TimeGenerated) by EntityUserEmail, EntityUserId\n| project deactivation_time, EntityUserEmail, EntityUserId\n| join (SlackAudit\n      | where TimeGenerated > ago(lb_time_max_h)\n      | where Action =~ 'user_login'\n      | summarize new_login_time = max(TimeGenerated) by SrcUserEmail, SrcUserIdentity\n      | project new_login_time, SrcUserEmail, EntityUserId = SrcUserIdentity) on EntityUserId\n| where EntityUserEmail == SrcUserEmail\n| where deactivation_time < new_login_time\n| extend AccountCustomEntity = SrcUserEmail\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P14D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SlackAudit_CL"
                    ],
                    "connectorId": "SlackAuditAPI"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Persistence",
                  "PrivilegeEscalation"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "AccountCustomEntity"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject9').analyticRuleId9,'/'))))]",
              "properties": {
                "description": "SlackAudit Analytics Rule 9",
                "parentId": "[variables('analyticRuleObject9').analyticRuleId9]",
                "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject9').analyticRuleVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
        "contentKind": "AnalyticsRule",
        "displayName": "SlackAudit - User login after deactivated.",
        "contentProductId": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "id": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "SlackAudit (via Codeless Connector Platform) (Preview)",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "SlackAuditLogsCCPDefinition",
                  "title": "SlackAudit (via Codeless Connector Platform) (Preview)",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": "The SlackAudit data connector provides the capability to ingest [Slack Audit logs](https://api.slack.com/admins/audit-logs) into Microsoft Sentinel through the REST API. Refer to [API documentation](https://api.slack.com/admins/audit-logs-call) for more information.",
                  "graphQueriesTableName": "SlackAuditV2_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total events received",
                      "legend": "SlackAudit Logs",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Get Sample of SlackAudit logs",
                      "query": "{{graphQueriesTableName}}\n | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": true,
                          "action": false
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "instructions": [
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "\nTo Generate the Access Token and Action Name Limit, create a new application in Slack, then add necessary scopes and configure the redirect URL. For detailed instructions on generating the access token and action name limit, refer the [link](https://github.com/v-gsrihitha/v-gsrihitha/blob/main/SlackAudit/Readme.md)."
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "SlackAudit API Key",
                            "placeholder": "Enter the API KEY",
                            "name": "apiKey",
                            "type": "password"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "SlackAudit Action Type",
                            "placeholder": "Enter the Action Type",
                            "name": "action",
                            "type": "string"
                          }
                        },
                        {
                          "parameters": {
                            "label": "toggle",
                            "name": "toggle"
                          },
                          "type": "ConnectionToggleButton"
                        }
                      ],
                      "title": "Connect SlackAudit to Microsoft Sentinel\n\n"
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "SlackAuditDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-SlackAudit_CL": {
                    "columns": [
                      {
                        "name": "id",
                        "type": "string"
                      },
                      {
                        "name": "date_create",
                        "type": "real"
                      },
                      {
                        "name": "action",
                        "type": "string"
                      },
                      {
                        "name": "actor",
                        "type": "dynamic"
                      },
                      {
                        "name": "entity",
                        "type": "dynamic"
                      },
                      {
                        "name": "context",
                        "type": "dynamic"
                      },
                      {
                        "name": "details",
                        "type": "dynamic"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-SlackAudit_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend Id = tostring(id), Actor = tostring(actor), Entity = tostring(entity), Context = tostring(context), Details = tostring(details), Action = tostring(action) | extend TimeGenerated = datetime_add('millisecond', tolong(date_create) * 1000, datetime(1970-01-01)) | extend ActionDescription = case(Action == \"workspace_created\", \"A workspace in an organization was created.\", Action == \"workspace_deleted\", \"A workspace in an organization was deleted.\", Action == \"workspace_accepted_migration\", \"An administrator on a workspace has accepted an invitation to migrate to a Grid organization.\", Action == \"workspace_declined_migration\", \"An administrator on a workspace has declined an invitation to migrate to a Grid organization.\", Action == \"migration_scheduled\", \"A migration was scheduled.\", Action == \"organization_verified\", \"Slack has confirmed the identity of your organization. The organization will now be denoted with a verified badge.\", Action == \"organization_unverified\", \"Slack has flagged a change in your organization’s identity and has unverified it.\", Action == \"organization_public_url_updated\", \"Your organization’s public URL has been changed.\", Action == \"organization_created\", \"An Enterprise Grid organization was created.\", Action == \"organization_deleted\", \"An Enterprise Grid organization was deleted.\", Action == \"organization_accepted_migration\", \"The Org Owner accepted a workspace invitation to join their organization.\", Action == \"organization_declined_migration\", \"The Org Owner declined a workspace invitation to join their organization.\", Action == \"billing_address_added\", \"A billing address was added. Includes a details parameter noting the timestamp the TOS was accepted.\", Action == \"emoji_added\", \"An emoji was added. Includes a details parameter with the name of the emoji.\", Action == \"emoji_removed\", \"An emoji was removed. Includes a details parameter with the name of the emoji.\", Action == \"emoji_aliased\", \"An emoji was given an alias. Includes a details parameter with the name of the alias.\", Action == \"emoji_renamed\", \"An emoji was renamed. Includes a details parameter with the previous and new names of the emoji.\", Action == \"message_tombstoned\", \"A message was tombstoned.\", Action == \"message_restored\", \"A message was restored.\", Action == \"manual_export_started\", \"A workspace admin or owner has started a standard export on a workspace.\", Action == \"manual_export_completed\", \"A standard export on a workspace has finished.\", Action == \"corporate_exports_approved\", \"The corporate export feature has been approved for use on a workspace.\", Action == \"corporate_exports_enabled\", \"The corporate export feature has been enabled for a workspace.\", Action == \"scheduled_export_started\", \"A scheduled corporate export has started.\", Action == \"scheduled_export_completed\", \"A scheduled corporate export has finished.\", Action == \"channels_export_started\", \"A channel export has begun.\", Action == \"channels_export_completed\", \"A channel export is complete.\", Action == \"pref.allow_calls\", \"A preference indicating whether Slack Calls can be used in this workspace has changed.\", Action == \"pref.allow_message_deletion\", \"Someone altered this workspace's settings around whether messages can be deleted or not.\", Action == \"pref.app_dir_only\", \"Whether only Slack App Directory apps can be installed or not in this workspace has changed.\", Action == \"pref.app_whitelist_enabled\", \"Someone's carefully carved or culled the list of apps this workspace has whitelisted.\", Action == \"pref.can_receive_shared_channels_invites\", \"Whether this workspace can receive invites to share channels with other workspaces has changed.\", Action == \"pref.commands_only_regular\", \"The setting determining whether restricted users are restricted from using slash commands was changed.\", Action == \"pref.custom_tos\", \"This workspace's settings on having a custom terms of service have changed.\", Action == \"pref.disallow_public_file_urls\", \"This workspace has modified their public file URL settings for files uploaded within it.\", Action == \"pref.dm_retention_changed\", \"The direct message (DM) retention setting changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.dnd_enabled\", \"Do not disturb settings have been enabled for a workspace.\", Action == \"pref.dnd_end_hour\", \"The exact ending hour for workspace do not disturb settings has been set.\", Action == \"pref.dnd_start_hour\", \"The exact starting hour for workspace do not disturb settings has been set.\", Action == \"pref.emoji_only_admins\", \"Someone modified the list of emoji-administrating admins.\", Action == \"pref.enterprise_default_channels\", \"Someone modified the list of default channels across the enterprise grid.\", Action == \"pref.enterprise_team_creation_request\", \"Someone has requested that your organization allow a new workspace to be created.\", Action == \"pref.file_retention_changed\", \"The file retention setting changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.msg_edit_window_mins\", \"Someone edited the edit messaging window for a workspace!\", Action == \"pref.private_channel_retention_changed\", \"The group (private channel) retention setting changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.public_channel_retention_changed\", \"The channel retention setting type changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.retention_override_changed\", \"The retention override setting, allowing workspace members to set their own retention period for private channels and DMs, changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.sign_in_with_slack_disabled\", \"This workspace changed their preference around allowing Sign in with Slack.\", Action == \"pref.slackbot_responses_disabled\", \"The settings around whether Slackbot's witty responses are enabled or disabled changed.\", Action == \"pref.slackbot_responses_only_admins\", \"There's a secret cabal of admins for those witty Slackbot responses and that list was changed.\", Action == \"pref.sso_setting_changed\", \"The Single Sign On (SSO) restriction changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.stats_only_admins\", \"The list of admins that can work with workspace statistics only has changed.\", Action == \"pref.two_factor_auth_changed\", \"The two-factor authentication requirement changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.username_policy\", \"A workspace's username policy preference changed.\", Action == \"pref.who_can_archive_channels\", \"Who can archive channels indeed?\", Action == \"pref.who_can_create_delete_user_groups\", \"The list of who can create or delete user groups changed.\", Action == \"pref.who_can_create_private_channels\", \"The list of those who can create private channels changed.\", Action == \"pref.who_can_create_public_channels\", \"The same as above, but for public channels.\", Action == \"pref.who_can_edit_user_groups\", \"The list of those who can edit user groups changed.\", Action == \"pref.who_can_manage_channel_posting_prefs\", \"Someone's been changing who can manage channel posting preferences.\", Action == \"pref.who_can_manage_ext_shared_channels\", \"The list of who can manage externally shared channels has changed for this workspace.\", Action == \"pref.who_can_manage_guests\", \"The list of who can manage guests now has changed for this workspace.\", Action == \"pref.who_can_manage_shared_channels\", \"Settings around who can remove users from shared channels has changed for a workspace.\", Action == \"pref.who_can_remove_from_private_channels\", \"Settings around who can remove users from private channels has changed for a workspace.\", Action == \"pref.who_can_remove_from_public_channels\", \"Settings around who can remove users from public channels has changed for a workspace.\", Action == \"ekm_enrolled\", \"The workspace is now enrolled/managed by EKM.\", Action == \"ekm_unenrolled\", \"The workspace is no longer enrolled or managed by EKM.\", Action == \"ekm_key_added\", \"An EKM key was added for the workspace.\", Action == \"ekm_key_removed\", \"An EKM key was removed for the workspace.\", Action == \"ekm_clear_cache_set\", \"A revocation event has triggered a new TTL for cached data in this workspace.\", Action == \"ekm_logging_config_set\", \"Logging settings for this workspace's EKM configuration have changed.\", Action == \"ekm_slackbot_enroll_notification_sent\", \"Slack sent notifications about this workspace being enrolled in EKM.\", Action == \"ekm_slackbot_unenroll_notification_sent\", \"Slack sent notifications about this workspace no longer being enrolled in EKM.\", Action == \"ekm_slackbot_rekey_notification_sent\", \"Slack sent notifications about this workspace's EKM configuration being rekeyed.\", Action == \"ekm_slackbot_logging_notification_sent\", \"Slack sent notifications about logging changes to EKM in this workspace.\", Action == \"user_channel_join\", \"A user has joined a channel.\", Action == \"user_channel_leave\", \"A user has left a channel.\", Action == \"guest_channel_join\", \"A guest user has joined a channel.\", Action == \"guest_channel_leave\", \"A guest user has left a channel.\", Action == \"guest_created\", \"A guest user was invited to a channel.\", Action == \"channel_moved\", \"A channel has been moved to a different workspace.\", Action == \"public_channel_created\", \"A public channel was created.\", Action == \"private_channel_created\", \"A private channel was created.\", Action == \"public_channel_archive\", \"A public channel was archived.\", Action == \"private_channel_archive\", \"A private channel was archived.\", Action == \"public_channel_unarchive\", \"A public channel was unarchived.\", Action == \"private_channel_unarchive\", \"A private channel was unarchived.\", Action == \"public_channel_deleted\", \"A public channel was deleted.\", Action == \"private_channel_deleted\", \"A private channel was deleted.\", Action == \"mpim_converted_to_private\", \"A multi-party direct message was converted to a private channel.\", Action == \"public_channel_converted_to_private\", \"A channel which was once public is now private.\", Action == \"channel_email_address_created\", \"An email forwarding address was created for a channel.\", Action == \"channel_email_address_deleted\", \"An email forwarding address was deleted from channel.\", Action == \"external_shared_channel_connected\", \"A shared channel with another workspace has been connected with this one.\", Action == \"external_shared_channel_disconnected\", \"A shared channel with another workspace is no longer connected with this one.\", Action == \"external_shared_channel_reconnected\", \"A previously connected and then disconnected shared channel with another workspace is once again shared with this one.\", Action == \"external_shared_channel_invite_sent\", \"An invitation to join a shared channel was sent.\", Action == \"external_shared_channel_invite_accepted\", \"An invitation to join a shared channel was accepted! Nice.\", Action == \"external_shared_channel_invite_approved\", \"An invitation to join a shared channel was approved by an admin.\", Action == \"external_shared_channel_invite_created\", \"An invitation url to join a shared channel was created.\", Action == \"external_shared_channel_invite_declined\", \"An invitation to join a shared channel was declined.\", Action == \"external_shared_channel_invite_expired\", \"An invitation to join a shared channel expired.\", Action == \"external_shared_channel_invite_revoked\", \"An invitation to join a shared channel was revoked.\", Action == \"role_change_to_owner\", \"A team member was made an owner.\", Action == \"role_change_to_admin\", \"A team member was made an admin.\", Action == \"role_change_to_user\", \"A team member was a user.\", Action == \"role_change_to_guest\", \"A team member was made a guest.\", Action == \"owner_transferred\", \"An owner was transferred.\", Action == \"user_created\", \"A team member was created.\", Action == \"user_deactivated\", \"A team member was deactivated.\", Action == \"user_reactivated\", \"A team member was reactivated.\", Action == \"user_login_failed\", \"A login attempt failed for a user.\", Action == \"guest_created\", \"A guest user was created.\", Action == \"guest_deactivated\", \"A guest user was deactivated.\", Action == \"guest_reactivated\", \"A guest user was reactivated.\", Action == \"guest_expiration_set\", \"A guest user's expiration date was set.\", Action == \"guest_expired\", \"A guest user's expiration date passed.\", Action == \"guest_expiration_cleared\", \"A guest user's expiration date was cleared.\", Action == \"user_login\", \"A team member logged into the system.\", Action == \"user_logout\", \"A team member logged out of the system.\", Action == \"custom_tos_accepted\", \"The team member has accepted the custom terms of service.\", Action == \"app_approved\", \"An app was approved for use in the workspace.\", Action == \"app_restricted\", \"An app has been restricted from the workspace.\", Action == \"app_installed\", \"An app has been installed in the workspace.\", Action == \"app_scopes_expanded\", \"An app's access scopes have been expanded.\", Action == \"app_resources_added\", \"App resources were added to the workspace.\", Action == \"app_uninstalled\", \"An app was uninstalled from the workspace.\", Action == \"app_token_preserved\", \"App token was preserved for the workspace.\", Action == \"file_downloaded\", \"A file was downloaded.\", Action == \"file_downloaded_blocked\", \"A file download was blocked.\", Action == \"file_uploaded\", \"A file was uploaded.\", Action == \"file_public_link_created\", \"A public link for a file was created.\", Action == \"file_public_link_revoked\", \"A public link for a file was revoked.\", Action == \"file_shared\", \"A file was shared.\", Action == \"workflow_v2_published\", \"A workflow was published.\",\" \")| project Id, DateCreate = date_create, Action, ActionDescription, Actor, Entity, Context, Details, TimeGenerated",
                    "outputStream": "Custom-SlackAuditV2_CL"
                  }
                ]
              }
            },
            {
              "name": "SlackAuditV2_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "SlackAuditV2_CL",
                  "columns": [
                    {
                      "name": "Id",
                      "type": "string"
                    },
                    {
                      "name": "DateCreate",
                      "type": "real"
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "Action",
                      "type": "string"
                    },
                    {
                      "name": "Entity",
                      "type": "dynamic"
                    },
                    {
                      "name": "Actor",
                      "type": "dynamic"
                    },
                    {
                      "name": "Context",
                      "type": "dynamic"
                    },
                    {
                      "name": "Details",
                      "type": "dynamic"
                    },
                    {
                      "name": "ActionDescription",
                      "type": "dynamic"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "SlackAuditLogsCCPDefinition",
          "title": "SlackAudit (via Codeless Connector Platform) (Preview)",
          "publisher": "Microsoft",
          "descriptionMarkdown": "The SlackAudit data connector provides the capability to ingest [Slack Audit logs](https://api.slack.com/admins/audit-logs) into Microsoft Sentinel through the REST API. Refer to [API documentation](https://api.slack.com/admins/audit-logs-call) for more information.",
          "graphQueriesTableName": "SlackAuditV2_CL",
          "graphQueries": [
            {
              "metricName": "Total events received",
              "legend": "SlackAudit Logs",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "Get Sample of SlackAudit logs",
              "query": "{{graphQueriesTableName}}\n | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true,
                  "action": false
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "instructions": [
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "\nTo Generate the Access Token and Action Name Limit, create a new application in Slack, then add necessary scopes and configure the redirect URL. For detailed instructions on generating the access token and action name limit, refer the [link](https://github.com/v-gsrihitha/v-gsrihitha/blob/main/SlackAudit/Readme.md)."
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "SlackAudit API Key",
                    "placeholder": "Enter the API KEY",
                    "name": "apiKey",
                    "type": "password"
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "SlackAudit Action Type",
                    "placeholder": "Enter the Action Type",
                    "name": "action",
                    "type": "string"
                  }
                },
                {
                  "parameters": {
                    "label": "toggle",
                    "name": "toggle"
                  },
                  "type": "ConnectionToggleButton"
                }
              ],
              "title": "Connect SlackAudit to Microsoft Sentinel\n\n"
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "SlackAudit (via Codeless Connector Platform) (Preview)",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "apikey": {
              "defaultValue": "-NA-",
              "type": "securestring",
              "minLength": 4
            },
            "action": {
              "defaultValue": "-NA-",
              "type": "securestring",
              "minLength": 1
            },
            "connectorDefinitionName": {
              "defaultValue": "SlackAudit (via Codeless Connector Platform) (Preview)",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SlackAuditLogs', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "SlackAuditLogsCCPDefinition",
                "dataType": "SlackAuditV2_CL",
                "dcrConfig": {
                  "streamName": "Custom-SlackAudit_CL",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                  "type": "APIKey",
                  "APIKeyName": "Authorization",
                  "ApiKey": "[[parameters('apikey')]",
                  "APIKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://api.slack.com/audit/v1/logs?action=',parameters('action'))]",
                  "httpMethod": "GET",
                  "queryWindowInMin": 5,
                  "queryTimeFormat": "UnixTimestamp",
                  "headers": {
                    "Accept": "application/json",
                    "User-Agent": "Scuba-Microsoft"
                  },
                  "queryParameters": {
                    "limit": "999",
                    "oldest": "{_QueryWindowStartTime}",
                    "latest": "{_QueryWindowEndTime}"
                  }
                },
                "paging": {
                  "pagingType": "NextPageToken",
                  "nextPageParaName": "cursor",
                  "nextPageTokenJsonPath": "$.response_metadata.next_cursor",
                  "condition": {
                    "check": "data.response_metadata && data.response_metadata.next_cursor",
                    "nextCursorProcessing": "data.response_metadata.next_cursor.replace(/=$/, '%3D')"
                  }
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.entries"
                  ],
                  "format": "json"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAudit data connector with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId2')]",
                  "title": "[DEPRECATED] Slack Audit (using Azure Functions)",
                  "publisher": "Slack",
                  "descriptionMarkdown": "The [Slack](https://slack.com) Audit data connector provides the capability to ingest [Slack Audit Records](https://api.slack.com/admins/audit-logs) events into Microsoft Sentinel through the REST API. Refer to [API documentation](https://api.slack.com/admins/audit-logs#the_audit_event) for more information. The connector provides ability to get events which helps to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems and more.<p><span style='color:red; font-weight:bold;'>NOTE</span>: This data connector has been deprecated, consider moving to the CCP data connector available in the solution which replaces ingestion via the <a href='https://learn.microsoft.com/en-us/azure/azure-monitor/logs/custom-logs-migrate' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>.</p>",
                  "additionalRequirementBanner": "These queries and workbooks are dependent on a parser based on Kusto to work as expected. Follow the steps to use this Kusto functions alias **SlackAudit** in queries and workbooks [Follow steps to get this Kusto functions>](https://aka.ms/sentinel-SlackAuditAPI-parser).",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "SlackAudit_CL",
                      "baseQuery": "SlackAudit_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Slack Audit Events - All Activities.",
                      "query": "SlackAudit\n | sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "SlackAudit_CL",
                      "lastDataReceivedQuery": "SlackAudit_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "SlackAudit_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "REST API Credentials/permissions",
                        "description": "**SlackAPIBearerToken** is required for REST API. [See the documentation to learn more about API](https://api.slack.com/web#authentication). Check all [requirements and follow  the instructions](https://api.slack.com/web#authentication) for obtaining credentials."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This connector uses Azure Functions to connect to the Slack REST API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                    },
                    {
                      "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                    },
                    {
                      "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected. [Follow these steps](https://aka.ms/sentinel-SlackAuditAPI-parser) to create the Kusto functions alias, **SlackAudit**"
                    },
                    {
                      "description": "**STEP 1 - Configuration steps for the Slack API**\n\n [Follow the instructions](https://api.slack.com/web#authentication) to obtain the credentials. \n"
                    },
                    {
                      "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Slack Audit data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following).",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Primary Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "instructions": [
                        {
                          "parameters": {
                            "instructionSteps": [
                              {
                                "title": "Option 1 - Azure Resource Manager (ARM) Template",
                                "description": "Use this method for automated deployment of the Slack Audit data connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-SlackAuditAPI-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n> **NOTE:** Within the same resource group, you can't mix Windows and Linux apps in the same region. Select existing resource group without Windows apps in it or create new resource group.\n3. Enter the **SlackAPIBearerToken** and deploy. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy."
                              },
                              {
                                "title": "Option 2 - Manual Deployment of Azure Functions",
                                "description": "Use the following step-by-step instructions to deploy the Slack Audit data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                                "instructions": [
                                  {
                                    "parameters": {
                                      "instructionSteps": [
                                        {
                                          "title": "Step 1 - Deploy a Function App",
                                          "description": "1. Download the [Azure Function App](https://aka.ms/sentinel-SlackAuditAPI-functionapp) file. Extract archive to your local development computer.\n2. Follow the [function app manual deployment instructions](https://github.com/Azure/Azure-Sentinel/blob/master/DataConnectors/AzureFunctionsManualDeployment.md#function-app-manual-deployment-instructions) to deploy the Azure Functions app using VSCode.\n3. After successful deployment of the function app, follow next steps for configuring it."
                                        },
                                        {
                                          "title": "Step 2 - Configure the Function App",
                                          "description": "1. Go to Azure Portal for the Function App configuration.\n2. In the Function App, select the Function App Name and select **Configuration**.\n3. In the **Application settings** tab, select ** New application setting**.\n4. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tSlackAPIBearerToken\n\t\tWorkspaceID\n\t\tWorkspaceKey\n\t\tlogAnalyticsUri (optional)\n> - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`.\n3. Once all application settings have been entered, click **Save**."
                                        }
                                      ]
                                    },
                                    "type": "InstructionStepsGroup"
                                  }
                                ]
                              }
                            ]
                          },
                          "type": "InstructionStepsGroup"
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
                "contentId": "[variables('_dataConnectorContentId2')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "contentKind": "DataConnector",
        "displayName": "[DEPRECATED] Slack Audit (using Azure Functions)",
        "contentProductId": "[variables('_dataConnectorcontentProductId2')]",
        "id": "[variables('_dataConnectorcontentProductId2')]",
        "version": "[variables('dataConnectorVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId2')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion2')]",
        "source": {
          "kind": "Solution",
          "name": "SlackAudit",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "[DEPRECATED] Slack Audit (using Azure Functions)",
          "publisher": "Slack",
          "descriptionMarkdown": "The [Slack](https://slack.com) Audit data connector provides the capability to ingest [Slack Audit Records](https://api.slack.com/admins/audit-logs) events into Microsoft Sentinel through the REST API. Refer to [API documentation](https://api.slack.com/admins/audit-logs#the_audit_event) for more information. The connector provides ability to get events which helps to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems and more.<p><span style='color:red; font-weight:bold;'>NOTE</span>: This data connector has been deprecated, consider moving to the CCP data connector available in the solution which replaces ingestion via the <a href='https://learn.microsoft.com/en-us/azure/azure-monitor/logs/custom-logs-migrate' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>.</p>",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "SlackAudit_CL",
              "baseQuery": "SlackAudit_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "SlackAudit_CL",
              "lastDataReceivedQuery": "SlackAudit_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "SlackAudit_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Slack Audit Events - All Activities.",
              "query": "SlackAudit\n | sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "REST API Credentials/permissions",
                "description": "**SlackAPIBearerToken** is required for REST API. [See the documentation to learn more about API](https://api.slack.com/web#authentication). Check all [requirements and follow  the instructions](https://api.slack.com/web#authentication) for obtaining credentials."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This connector uses Azure Functions to connect to the Slack REST API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
            },
            {
              "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
            },
            {
              "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected. [Follow these steps](https://aka.ms/sentinel-SlackAuditAPI-parser) to create the Kusto functions alias, **SlackAudit**"
            },
            {
              "description": "**STEP 1 - Configuration steps for the Slack API**\n\n [Follow the instructions](https://api.slack.com/web#authentication) to obtain the credentials. \n"
            },
            {
              "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Slack Audit data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following).",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Primary Key"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "instructions": [
                {
                  "parameters": {
                    "instructionSteps": [
                      {
                        "title": "Option 1 - Azure Resource Manager (ARM) Template",
                        "description": "Use this method for automated deployment of the Slack Audit data connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-SlackAuditAPI-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n> **NOTE:** Within the same resource group, you can't mix Windows and Linux apps in the same region. Select existing resource group without Windows apps in it or create new resource group.\n3. Enter the **SlackAPIBearerToken** and deploy. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy."
                      },
                      {
                        "title": "Option 2 - Manual Deployment of Azure Functions",
                        "description": "Use the following step-by-step instructions to deploy the Slack Audit data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                        "instructions": [
                          {
                            "parameters": {
                              "instructionSteps": [
                                {
                                  "title": "Step 1 - Deploy a Function App",
                                  "description": "1. Download the [Azure Function App](https://aka.ms/sentinel-SlackAuditAPI-functionapp) file. Extract archive to your local development computer.\n2. Follow the [function app manual deployment instructions](https://github.com/Azure/Azure-Sentinel/blob/master/DataConnectors/AzureFunctionsManualDeployment.md#function-app-manual-deployment-instructions) to deploy the Azure Functions app using VSCode.\n3. After successful deployment of the function app, follow next steps for configuring it."
                                },
                                {
                                  "title": "Step 2 - Configure the Function App",
                                  "description": "1. Go to Azure Portal for the Function App configuration.\n2. In the Function App, select the Function App Name and select **Configuration**.\n3. In the **Application settings** tab, select ** New application setting**.\n4. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tSlackAPIBearerToken\n\t\tWorkspaceID\n\t\tWorkspaceKey\n\t\tlogAnalyticsUri (optional)\n> - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`.\n3. Once all application settings have been entered, click **Save**."
                                }
                              ]
                            },
                            "type": "InstructionStepsGroup"
                          }
                        ]
                      }
                    ]
                  },
                  "type": "InstructionStepsGroup"
                }
              ]
            }
          ],
          "id": "[variables('_uiConfigId2')]",
          "additionalRequirementBanner": "These queries and workbooks are dependent on a parser based on Kusto to work as expected. Follow the steps to use this Kusto functions alias **SlackAudit** in queries and workbooks [Follow steps to get this Kusto functions>](https://aka.ms/sentinel-SlackAuditAPI-parser)."
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAudit Data Parser with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit Data Parser",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "SlackAudit",
                "query": "let SlackAudit_view = view () {\nSlackAudit_CL\n| extend\n      DetailsMobileOnly=column_ifexists('details_mobile_only_b', ''),\n  \t\tDetailsWebOnly=column_ifexists('details_web_only_b', ''),\n  \t\tDetailsKickerId=column_ifexists('details_kicker_id_s', ''),\n  \t\tDetailsKickerName=column_ifexists('details_kicker_name_s', ''),\n  \t\tDetailsKickerEmail=column_ifexists('details_kicker_email_s', ''),\n  \t\tDetailsKickerTeam=column_ifexists('details_kicker_team_s', ''),\n  \t\tDetailsAppOwnerId=column_ifexists('details_app_owner_id_s', ''),\n  \t\tDetailsGranularBotToken=column_ifexists('details_granular_bot_token_b', ''),\n  \t\tDetailsNewScopes=column_ifexists('details_new_scopes_s', ''),\n  \t\tDetailsPreviousScopes=column_ifexists('details_previous_scopes_s', ''),\n  \t\tEntityUsergroupId=column_ifexists('entity_usergroup_id_s', ''),\n  \t\tEntityUsergroupName=column_ifexists('entity_usergroup_name_s', ''),\n  \t\tDetailsKickerType=column_ifexists('details_kicker_type_s', ''),\n  \t\tDetailsKickerUserId=column_ifexists('details_kicker_user_id_s', ''),\n  \t\tDetailsKickerUserName=column_ifexists('details_kicker_user_name_s', ''),\n  \t\tDetailsKickerUserEmail=column_ifexists('details_kicker_user_email_s', ''),\n  \t\tDetailsKickerUserTeam=column_ifexists('details_kicker_user_team_s', ''),\n  \t\tDetailsInviterId=column_ifexists('details_inviter_id_s', ''),\n  \t\tDetailsInviterName=column_ifexists('details_inviter_name_s', ''),\n  \t\tDetailsInviterEmail=column_ifexists('details_inviter_email_s', ''),\n  \t\tDetailsInviterTeam=column_ifexists('details_inviter_team_s', ''),\n  \t\tDetailsInviterType=column_ifexists('details_inviter_type_s', ''),\n  \t\tDetailsInviterUserId=column_ifexists('details_inviter_user_id_s', ''),\n  \t\tDetailsInviterUserName=column_ifexists('details_inviter_user_name_s', ''),\n  \t\tDetailsInviterUserEmail=column_ifexists('details_inviter_user_email_s', ''),\n  \t\tDetailsInviterUserTeam=column_ifexists('details_inviter_user_team_s', ''),\n  \t\tDetailsIsWorkflow=column_ifexists('details_is_workflow_b', ''),\n  \t\tEntityAppId=column_ifexists('entity_app_id_s', ''),\n  \t\tEntityAppName=column_ifexists('entity_app_name_s', ''),\n  \t\tEntityAppIsDistributed=column_ifexists('entity_app_is_distributed_b', ''),\n  \t\tEntityAppIsDirectoryApproved=column_ifexists('entity_app_is_directory_approved_b', ''),\n  \t\tEntityAppIsWorkflowApp=column_ifexists('entity_app_is_workflow_app_b', ''),\n  \t\tEntityAppScopes=column_ifexists('entity_app_scopes_s', ''),\n  \t\tDetailsIsInternalIntegration=column_ifexists('details_is_internal_integration_b', ''),\n  \t\tDetailsBotScopes=column_ifexists('details_bot_scopes_s', ''),\n  \t\tEntityChannelId=column_ifexists('entity_channel_id_s', ''),\n  \t\tEntityChannelPrivacy=column_ifexists('entity_channel_privacy_s', ''),\n  \t\tEntityChannelName=column_ifexists('entity_channel_name_s', ''),\n  \t\tEntityChannelIsShared=column_ifexists('entity_channel_is_shared_b', ''),\n  \t\tEntityChannelIsOrgShared=column_ifexists('entity_channel_is_org_shared_b', ''),\n  \t\tDetailsType=column_ifexists('details_type_s', ''),\n  \t\tEntityUserId=column_ifexists('entity_user_id_s', ''),\n  \t\tEntityUserName=column_ifexists('entity_user_name_s', ''),\n  \t\tEntityUserEmail=column_ifexists('entity_user_email_s', ''),\n  \t\tEntityUserTeam=column_ifexists('entity_user_team_s', ''),\n  \t\tId=column_ifexists('id_g', ''),\n  \t\tDateCreate=column_ifexists('date_create_d', ''),\n  \t\tAction=column_ifexists('action_s', ''),\n  \t\tActorType=column_ifexists('actor_type_s', ''),\n  \t\tActorUserId=column_ifexists('actor_user_id_s', ''),\n  \t\tActorUserName=column_ifexists('actor_user_name_s', ''),\n  \t\tActorUserEmail=column_ifexists('actor_user_email_s', ''),\n  \t\tActorUserTeam=column_ifexists('actor_user_team_s', ''),\n  \t\tEntityType=column_ifexists('entity_type_s', ''),\n  \t\tEntityFileId=column_ifexists('entity_file_id_s', ''),\n  \t\tEntityFileName=column_ifexists('entity_file_name_s', ''),\n  \t\tEntityFileFiletype=column_ifexists('entity_file_filetype_s', ''),\n  \t\tEntityFileTitle=column_ifexists('entity_file_title_s', ''),\n  \t\tContextLocationType=column_ifexists('context_location_type_s', ''),\n  \t\tContextLocationId=column_ifexists('context_location_id_s', ''),\n  \t\tContextLocationName=column_ifexists('context_location_name_s', ''),\n  \t\tContextLocationDomain=column_ifexists('context_location_domain_s', ''),\n  \t\tContextUA=column_ifexists('context_ua_s', ''),\n  \t\tContextIpAddress=column_ifexists('context_ip_address_s', ''),\n  \t\tContextSessionId=column_ifexists('context_session_id_d', ''),\n  \t\tActionDescription=column_ifexists('action_description_s', '')\n};\nlet SlackAuditV1_view = view () {\nSlackAuditNativePoller_CL\n| extend\n      DetailsMobileOnly=column_ifexists('details_mobile_only_b', ''), \n  \t\tDetailsWebOnly=column_ifexists('details_web_only_b', ''),\n  \t\tDetailsKickerId=column_ifexists('details_kicker_id_s', ''),\n  \t\tDetailsKickerName=column_ifexists('details_kicker_name_s', ''),\n  \t\tDetailsKickerEmail=column_ifexists('details_kicker_email_s', ''),\n  \t\tDetailsKickerTeam=column_ifexists('details_kicker_team_s', ''),\n  \t\tDetailsAppOwnerId=column_ifexists('details_app_owner_id_s', ''),\n  \t\tDetailsGranularBotToken=column_ifexists('details_granular_bot_token_b', ''),\n  \t\tDetailsNewScopes=column_ifexists('details_new_scopes_s', ''),\n  \t\tDetailsPreviousScopes=column_ifexists('details_previous_scopes_s', ''),\n  \t\tEntityUsergroupId=column_ifexists('entity_usergroup_id_s', ''),\n  \t\tEntityUsergroupName=column_ifexists('entity_usergroup_name_s', ''),\n  \t\tDetailsKickerType=column_ifexists('details_kicker_type_s', ''),\n  \t\tDetailsKickerUserId=column_ifexists('details_kicker_user_id_s', ''),\n  \t\tDetailsKickerUserName=column_ifexists('details_kicker_user_name_s', ''),\n  \t\tDetailsKickerUserEmail=column_ifexists('details_kicker_user_email_s', ''),\n  \t\tDetailsKickerUserTeam=column_ifexists('details_kicker_user_team_s', ''),\n  \t\tDetailsInviterId=column_ifexists('details_inviter_id_s', ''),\n  \t\tDetailsInviterName=column_ifexists('details_inviter_name_s', ''),\n  \t\tDetailsInviterEmail=column_ifexists('details_inviter_email_s', ''),\n  \t\tDetailsInviterTeam=column_ifexists('details_inviter_team_s', ''),\n  \t\tDetailsInviterType=column_ifexists('details_inviter_type_s', ''),\n  \t\tDetailsInviterUserId=column_ifexists('details_inviter_user_id_s', ''),\n  \t\tDetailsInviterUserName=column_ifexists('details_inviter_user_name_s', ''),\n  \t\tDetailsInviterUserEmail=column_ifexists('details_inviter_user_email_s', ''),\n  \t\tDetailsInviterUserTeam=column_ifexists('details_inviter_user_team_s', ''),\n  \t\tDetailsIsWorkflow=column_ifexists('details_is_workflow_b', ''),\n  \t\tEntityAppId=column_ifexists('entity_app_id_s', ''),\n  \t\tEntityAppName=column_ifexists('entity_app_name_s', ''),\n  \t\tEntityAppIsDistributed=column_ifexists('entity_app_is_distributed_b', ''),\n  \t\tEntityAppIsDirectoryApproved=column_ifexists('entity_app_is_directory_approved_b', ''),\n  \t\tEntityAppIsWorkflowApp=column_ifexists('entity_app_is_workflow_app_b', ''),\n  \t\tEntityAppScopes=column_ifexists('entity_app_scopes_s', ''),\n  \t\tDetailsIsInternalIntegration=column_ifexists('details_is_internal_integration_b', ''),\n  \t\tDetailsBotScopes=column_ifexists('details_bot_scopes_s', ''),\n  \t\tEntityChannelId=column_ifexists('entity_channel_id_s', ''),\n  \t\tEntityChannelPrivacy=column_ifexists('entity_channel_privacy_s', ''),\n  \t\tEntityChannelName=column_ifexists('entity_channel_name_s', ''),\n  \t\tEntityChannelIsShared=column_ifexists('entity_channel_is_shared_b', ''),\n  \t\tEntityChannelIsOrgShared=column_ifexists('entity_channel_is_org_shared_b', ''),\n  \t\tDetailsType=column_ifexists('details_type_s', ''),\n  \t\tEntityUserId=column_ifexists('entity_user_id_s', ''),\n  \t\tEntityUserName=column_ifexists('entity_user_name_s', ''),\n  \t\tEntityUserEmail=column_ifexists('entity_user_email_s', ''),\n  \t\tEntityUserTeam=column_ifexists('entity_user_team_s', ''),\n  \t\tId=column_ifexists('id_g', ''),\n  \t\tDateCreate=column_ifexists('date_create_d', ''),\n  \t\tAction=column_ifexists('action_s', ''),\n  \t\tActorType=column_ifexists('actor_type_s', ''),\n  \t\tActorUserId=column_ifexists('actor_user_id_s', ''),\n  \t\tActorUserName=column_ifexists('actor_user_name_s', ''),\n  \t\tActorUserEmail=column_ifexists('actor_user_email_s', ''),\n  \t\tActorUserTeam=column_ifexists('actor_user_team_s', ''),\n  \t\tEntityType=column_ifexists('entity_type_s', ''),\n  \t\tEntityFileId=column_ifexists('entity_file_id_s', ''),\n  \t\tEntityFileName=column_ifexists('entity_file_name_s', ''),\n  \t\tEntityFileFiletype=column_ifexists('entity_file_filetype_s', ''),\n  \t\tEntityFileTitle=column_ifexists('entity_file_title_s', ''),\n  \t\tContextLocationType=column_ifexists('context_location_type_s', ''),\n  \t\tContextLocationId=column_ifexists('context_location_id_s', ''),\n  \t\tContextLocationName=column_ifexists('context_location_name_s', ''),\n  \t\tContextLocationDomain=column_ifexists('context_location_domain_s', ''),\n  \t\tContextUA=column_ifexists('context_ua_s', ''),\n  \t\tContextIpAddress=column_ifexists('context_ip_address_s', ''),\n  \t  ContextSessionId=column_ifexists('context_session_id_d', ''),\n  \t\tActionDescription=column_ifexists('action_description_s', ''),\n      EventId=column_ifexists('id_g', ''),\n      EventEndTime=column_ifexists('date_create_d', ''),\n      DvcAction=column_ifexists('action_s', ''),\n      SrcUserIdentity=column_ifexists('actor_user_id_s', ''),\n      SrcUserName=column_ifexists('actor_user_name_s', ''),\n      SrcUserEmail=column_ifexists('actor_user_email_s', ''),\n      UserAgentOriginal=column_ifexists('context_ua_s', ''),\n      SrcIpAddr=column_ifexists('context_ip_address_s', ''),\n      DvcActionDesc=column_ifexists('action_description_s', '')\n};\nlet SlackAuditV2_view = view () {\nSlackAuditV2_CL\n| extend actor = todynamic(Actor)\n| extend entity = todynamic(Entity)\n| extend context = todynamic(Context)\n| extend details = todynamic(Details)\n| extend\n      Id=column_ifexists('Id', ''),\n      DateCreate=column_ifexists('DateCreate', ''),\n      Action=column_ifexists('Action', ''),\n      DetailsMobileOnly=tobool(details.mobile.only),\n      DetailsWebOnly=tobool(details.web.only),\n      DetailsKickerId=tostring(details.kicker.id),\n      DetailsKickerName=tostring(details.kicker.name),\n      DetailsKickerEmail=tostring(details.kicker.email),\n      DetailsKickerTeam=tostring(details.kicker.team),\n      DetailsAppOwnerId=tostring(details.app.owner.id),\n      DetailsGranularBotToken=tobool(details.granular.bot.token),\n      DetailsNewScopes=tostring(details.new.scopes),\n      DetailsPreviousScopes=tostring(details.previous.scopes),\n      EntityUsergroupId=tostring(entity.usergroup.id),\n      EntityUsergroupName=tostring(entity.usergroup.name),\n      DetailsKickerType=tostring(details.kicker.type),\n      DetailsKickerUserId=tostring(details.kicker.user.id),\n      DetailsKickerUserName=tostring(details.kicker.user.name),\n      DetailsKickerUserEmail=tostring(details.kicker.user.email),\n      DetailsKickerUserTeam=tostring(details.kicker.user.team),\n      DetailsInviterId=tostring(details.inviter.id),\n      DetailsInviterName=tostring(details.inviter.name),\n      DetailsInviterEmail=tostring(details.inviter.email),\n      DetailsInviterTeam=tostring(details.inviter.team),\n      DetailsInviterType=tostring(details.inviter.type),\n      DetailsInviterUserId=tostring(details.inviter.user.id),\n      DetailsInviterUserName=tostring(details.inviter.user.name),\n      DetailsInviterUserEmail=tostring(details.inviter.user.email),\n      DetailsInviterUserTeam=tostring(details.inviter.user.team),\n      DetailsIsWorkflow=tobool(details.is.workflow),\n      EntityAppId=tostring(entity.app.id),\n      EntityAppName=tostring(entity.app.name),\n      EntityAppIsDistributed=tobool(entity.app.is.distributed),\n      EntityAppIsDirectoryApproved=tobool(entity.app.is.directory.approved),\n      EntityAppIsWorkflowApp=tobool(entity.app.is.workflow.app),\n      EntityAppScopes=tostring(entity.app.scopes),\n      DetailsIsInternalIntegration=tobool(details.is.internal.integration),\n      DetailsBotScopes=tostring(details.bot.scopes),\n      EntityChannelId=tostring(entity.channel.id),\n      EntityChannelPrivacy=tostring(entity.channel.privacy),\n      EntityChannelName=tostring(entity.channel.name),\n      EntityChannelIsShared=tobool(entity.channel.is.shared),\n      EntityChannelIsOrgShared=tobool(entity.channel.is.org.shared),\n      DetailsType=tostring(details.type),\n      EntityUserId=tostring(entity.user.id),\n      EntityUserName=tostring(entity.user.name),\n      EntityUserEmail=tostring(entity.user.email),\n      EntityUserTeam=tostring(entity.user.team),\n      ActorType=tostring(actor.type),\n      ActorUserId=tostring(actor.user.id),\n      ActorUserName=tostring(actor.user.name),\n      ActorUserEmail=tostring(actor.user.email),\n      ActorUserTeam=tostring(actor.user.team),\n      EntityType=tostring(entity.type),\n      EntityFileId=tostring(entity.file.id),\n      EntityFileName=tostring(entity.file.name),\n      EntityFileFiletype=tostring(entity.file.filetype),\n      EntityFileTitle=tostring(entity['file']['title']),\n      ContextLocationType=tostring(context.location.type),\n      ContextLocationId=tostring(context.location.id),\n      ContextLocationName=tostring(context.location.name),\n      ContextLocationDomain=tostring(context.location.domain),\n      ContextUA=tostring(context.ua),\n      ContextIpAddress=tostring(context.ip.address),\n      ContextSessionId=todouble(context.session.id),\n      ActionDescription=column_ifexists('ActionDescription', ''),\n      EventId=column_ifexists('Id', ''),\n      EventEndTime=column_ifexists('DateCreate', ''),\n      DvcAction=column_ifexists('Action', ''),\n      SrcUserIdentity=tostring(actor.user.id),\n      SrcUserName=tostring(actor.user.name),\n      SrcUserEmail=tostring(actor.user.email),\n      UserAgentOriginal=tostring(context.ua),\n      SrcIpAddr=tostring(context.ip.address),\n      DvcActionDesc=column_ifexists('ActionDescription', '')\n};\nunion isfuzzy=true\n(SlackAudit_view),\n(SlackAuditV1_view),\n(SlackAuditV2_view) \n| project TimeGenerated, DetailsMobileOnly,DetailsWebOnly, DetailsKickerId, DetailsKickerName, DetailsKickerEmail, DetailsKickerTeam,DetailsAppOwnerId, DetailsGranularBotToken, DetailsNewScopes, DetailsPreviousScopes, EntityUsergroupId, EntityUsergroupName, DetailsKickerType, DetailsKickerUserId, DetailsKickerUserName, DetailsKickerUserEmail, DetailsKickerUserTeam, DetailsInviterId, DetailsInviterName, DetailsInviterEmail, DetailsInviterTeam, DetailsInviterType, DetailsInviterUserId, DetailsInviterUserName, DetailsInviterUserEmail, DetailsInviterUserTeam, DetailsIsWorkflow, EntityAppId, EntityAppName, EntityAppIsDistributed, EntityAppIsDirectoryApproved, EntityAppIsWorkflowApp, EntityAppScopes, DetailsIsInternalIntegration, DetailsBotScopes, EntityChannelId, EntityChannelPrivacy, EntityChannelName, EntityChannelIsShared, EntityChannelIsOrgShared, DetailsType, EntityUserId, EntityUserName, EntityUserEmail, EntityUserTeam, Id, DateCreate, Action, ActorType, ActorUserId, ActorUserName, ActorUserEmail, ActorUserTeam, EntityType, EntityFileId, EntityFileName, EntityFileFiletype, EntityFileTitle, ContextLocationType, ContextLocationId, ContextLocationName, ContextLocationDomain, ContextUA, ContextIpAddress, ContextSessionId, ActionDescription, EventId, EventEndTime, DvcAction, SrcUserIdentity, SrcUserName, SrcUserEmail, UserAgentOriginal, SrcIpAddr, DvcActionDesc\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'SlackAudit Data Parser')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "SlackAudit",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "SlackAudit Data Parser",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "SlackAudit Data Parser",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "SlackAudit",
        "query": "let SlackAudit_view = view () {\nSlackAudit_CL\n| extend\n      DetailsMobileOnly=column_ifexists('details_mobile_only_b', ''),\n  \t\tDetailsWebOnly=column_ifexists('details_web_only_b', ''),\n  \t\tDetailsKickerId=column_ifexists('details_kicker_id_s', ''),\n  \t\tDetailsKickerName=column_ifexists('details_kicker_name_s', ''),\n  \t\tDetailsKickerEmail=column_ifexists('details_kicker_email_s', ''),\n  \t\tDetailsKickerTeam=column_ifexists('details_kicker_team_s', ''),\n  \t\tDetailsAppOwnerId=column_ifexists('details_app_owner_id_s', ''),\n  \t\tDetailsGranularBotToken=column_ifexists('details_granular_bot_token_b', ''),\n  \t\tDetailsNewScopes=column_ifexists('details_new_scopes_s', ''),\n  \t\tDetailsPreviousScopes=column_ifexists('details_previous_scopes_s', ''),\n  \t\tEntityUsergroupId=column_ifexists('entity_usergroup_id_s', ''),\n  \t\tEntityUsergroupName=column_ifexists('entity_usergroup_name_s', ''),\n  \t\tDetailsKickerType=column_ifexists('details_kicker_type_s', ''),\n  \t\tDetailsKickerUserId=column_ifexists('details_kicker_user_id_s', ''),\n  \t\tDetailsKickerUserName=column_ifexists('details_kicker_user_name_s', ''),\n  \t\tDetailsKickerUserEmail=column_ifexists('details_kicker_user_email_s', ''),\n  \t\tDetailsKickerUserTeam=column_ifexists('details_kicker_user_team_s', ''),\n  \t\tDetailsInviterId=column_ifexists('details_inviter_id_s', ''),\n  \t\tDetailsInviterName=column_ifexists('details_inviter_name_s', ''),\n  \t\tDetailsInviterEmail=column_ifexists('details_inviter_email_s', ''),\n  \t\tDetailsInviterTeam=column_ifexists('details_inviter_team_s', ''),\n  \t\tDetailsInviterType=column_ifexists('details_inviter_type_s', ''),\n  \t\tDetailsInviterUserId=column_ifexists('details_inviter_user_id_s', ''),\n  \t\tDetailsInviterUserName=column_ifexists('details_inviter_user_name_s', ''),\n  \t\tDetailsInviterUserEmail=column_ifexists('details_inviter_user_email_s', ''),\n  \t\tDetailsInviterUserTeam=column_ifexists('details_inviter_user_team_s', ''),\n  \t\tDetailsIsWorkflow=column_ifexists('details_is_workflow_b', ''),\n  \t\tEntityAppId=column_ifexists('entity_app_id_s', ''),\n  \t\tEntityAppName=column_ifexists('entity_app_name_s', ''),\n  \t\tEntityAppIsDistributed=column_ifexists('entity_app_is_distributed_b', ''),\n  \t\tEntityAppIsDirectoryApproved=column_ifexists('entity_app_is_directory_approved_b', ''),\n  \t\tEntityAppIsWorkflowApp=column_ifexists('entity_app_is_workflow_app_b', ''),\n  \t\tEntityAppScopes=column_ifexists('entity_app_scopes_s', ''),\n  \t\tDetailsIsInternalIntegration=column_ifexists('details_is_internal_integration_b', ''),\n  \t\tDetailsBotScopes=column_ifexists('details_bot_scopes_s', ''),\n  \t\tEntityChannelId=column_ifexists('entity_channel_id_s', ''),\n  \t\tEntityChannelPrivacy=column_ifexists('entity_channel_privacy_s', ''),\n  \t\tEntityChannelName=column_ifexists('entity_channel_name_s', ''),\n  \t\tEntityChannelIsShared=column_ifexists('entity_channel_is_shared_b', ''),\n  \t\tEntityChannelIsOrgShared=column_ifexists('entity_channel_is_org_shared_b', ''),\n  \t\tDetailsType=column_ifexists('details_type_s', ''),\n  \t\tEntityUserId=column_ifexists('entity_user_id_s', ''),\n  \t\tEntityUserName=column_ifexists('entity_user_name_s', ''),\n  \t\tEntityUserEmail=column_ifexists('entity_user_email_s', ''),\n  \t\tEntityUserTeam=column_ifexists('entity_user_team_s', ''),\n  \t\tId=column_ifexists('id_g', ''),\n  \t\tDateCreate=column_ifexists('date_create_d', ''),\n  \t\tAction=column_ifexists('action_s', ''),\n  \t\tActorType=column_ifexists('actor_type_s', ''),\n  \t\tActorUserId=column_ifexists('actor_user_id_s', ''),\n  \t\tActorUserName=column_ifexists('actor_user_name_s', ''),\n  \t\tActorUserEmail=column_ifexists('actor_user_email_s', ''),\n  \t\tActorUserTeam=column_ifexists('actor_user_team_s', ''),\n  \t\tEntityType=column_ifexists('entity_type_s', ''),\n  \t\tEntityFileId=column_ifexists('entity_file_id_s', ''),\n  \t\tEntityFileName=column_ifexists('entity_file_name_s', ''),\n  \t\tEntityFileFiletype=column_ifexists('entity_file_filetype_s', ''),\n  \t\tEntityFileTitle=column_ifexists('entity_file_title_s', ''),\n  \t\tContextLocationType=column_ifexists('context_location_type_s', ''),\n  \t\tContextLocationId=column_ifexists('context_location_id_s', ''),\n  \t\tContextLocationName=column_ifexists('context_location_name_s', ''),\n  \t\tContextLocationDomain=column_ifexists('context_location_domain_s', ''),\n  \t\tContextUA=column_ifexists('context_ua_s', ''),\n  \t\tContextIpAddress=column_ifexists('context_ip_address_s', ''),\n  \t\tContextSessionId=column_ifexists('context_session_id_d', ''),\n  \t\tActionDescription=column_ifexists('action_description_s', '')\n};\nlet SlackAuditV1_view = view () {\nSlackAuditNativePoller_CL\n| extend\n      DetailsMobileOnly=column_ifexists('details_mobile_only_b', ''), \n  \t\tDetailsWebOnly=column_ifexists('details_web_only_b', ''),\n  \t\tDetailsKickerId=column_ifexists('details_kicker_id_s', ''),\n  \t\tDetailsKickerName=column_ifexists('details_kicker_name_s', ''),\n  \t\tDetailsKickerEmail=column_ifexists('details_kicker_email_s', ''),\n  \t\tDetailsKickerTeam=column_ifexists('details_kicker_team_s', ''),\n  \t\tDetailsAppOwnerId=column_ifexists('details_app_owner_id_s', ''),\n  \t\tDetailsGranularBotToken=column_ifexists('details_granular_bot_token_b', ''),\n  \t\tDetailsNewScopes=column_ifexists('details_new_scopes_s', ''),\n  \t\tDetailsPreviousScopes=column_ifexists('details_previous_scopes_s', ''),\n  \t\tEntityUsergroupId=column_ifexists('entity_usergroup_id_s', ''),\n  \t\tEntityUsergroupName=column_ifexists('entity_usergroup_name_s', ''),\n  \t\tDetailsKickerType=column_ifexists('details_kicker_type_s', ''),\n  \t\tDetailsKickerUserId=column_ifexists('details_kicker_user_id_s', ''),\n  \t\tDetailsKickerUserName=column_ifexists('details_kicker_user_name_s', ''),\n  \t\tDetailsKickerUserEmail=column_ifexists('details_kicker_user_email_s', ''),\n  \t\tDetailsKickerUserTeam=column_ifexists('details_kicker_user_team_s', ''),\n  \t\tDetailsInviterId=column_ifexists('details_inviter_id_s', ''),\n  \t\tDetailsInviterName=column_ifexists('details_inviter_name_s', ''),\n  \t\tDetailsInviterEmail=column_ifexists('details_inviter_email_s', ''),\n  \t\tDetailsInviterTeam=column_ifexists('details_inviter_team_s', ''),\n  \t\tDetailsInviterType=column_ifexists('details_inviter_type_s', ''),\n  \t\tDetailsInviterUserId=column_ifexists('details_inviter_user_id_s', ''),\n  \t\tDetailsInviterUserName=column_ifexists('details_inviter_user_name_s', ''),\n  \t\tDetailsInviterUserEmail=column_ifexists('details_inviter_user_email_s', ''),\n  \t\tDetailsInviterUserTeam=column_ifexists('details_inviter_user_team_s', ''),\n  \t\tDetailsIsWorkflow=column_ifexists('details_is_workflow_b', ''),\n  \t\tEntityAppId=column_ifexists('entity_app_id_s', ''),\n  \t\tEntityAppName=column_ifexists('entity_app_name_s', ''),\n  \t\tEntityAppIsDistributed=column_ifexists('entity_app_is_distributed_b', ''),\n  \t\tEntityAppIsDirectoryApproved=column_ifexists('entity_app_is_directory_approved_b', ''),\n  \t\tEntityAppIsWorkflowApp=column_ifexists('entity_app_is_workflow_app_b', ''),\n  \t\tEntityAppScopes=column_ifexists('entity_app_scopes_s', ''),\n  \t\tDetailsIsInternalIntegration=column_ifexists('details_is_internal_integration_b', ''),\n  \t\tDetailsBotScopes=column_ifexists('details_bot_scopes_s', ''),\n  \t\tEntityChannelId=column_ifexists('entity_channel_id_s', ''),\n  \t\tEntityChannelPrivacy=column_ifexists('entity_channel_privacy_s', ''),\n  \t\tEntityChannelName=column_ifexists('entity_channel_name_s', ''),\n  \t\tEntityChannelIsShared=column_ifexists('entity_channel_is_shared_b', ''),\n  \t\tEntityChannelIsOrgShared=column_ifexists('entity_channel_is_org_shared_b', ''),\n  \t\tDetailsType=column_ifexists('details_type_s', ''),\n  \t\tEntityUserId=column_ifexists('entity_user_id_s', ''),\n  \t\tEntityUserName=column_ifexists('entity_user_name_s', ''),\n  \t\tEntityUserEmail=column_ifexists('entity_user_email_s', ''),\n  \t\tEntityUserTeam=column_ifexists('entity_user_team_s', ''),\n  \t\tId=column_ifexists('id_g', ''),\n  \t\tDateCreate=column_ifexists('date_create_d', ''),\n  \t\tAction=column_ifexists('action_s', ''),\n  \t\tActorType=column_ifexists('actor_type_s', ''),\n  \t\tActorUserId=column_ifexists('actor_user_id_s', ''),\n  \t\tActorUserName=column_ifexists('actor_user_name_s', ''),\n  \t\tActorUserEmail=column_ifexists('actor_user_email_s', ''),\n  \t\tActorUserTeam=column_ifexists('actor_user_team_s', ''),\n  \t\tEntityType=column_ifexists('entity_type_s', ''),\n  \t\tEntityFileId=column_ifexists('entity_file_id_s', ''),\n  \t\tEntityFileName=column_ifexists('entity_file_name_s', ''),\n  \t\tEntityFileFiletype=column_ifexists('entity_file_filetype_s', ''),\n  \t\tEntityFileTitle=column_ifexists('entity_file_title_s', ''),\n  \t\tContextLocationType=column_ifexists('context_location_type_s', ''),\n  \t\tContextLocationId=column_ifexists('context_location_id_s', ''),\n  \t\tContextLocationName=column_ifexists('context_location_name_s', ''),\n  \t\tContextLocationDomain=column_ifexists('context_location_domain_s', ''),\n  \t\tContextUA=column_ifexists('context_ua_s', ''),\n  \t\tContextIpAddress=column_ifexists('context_ip_address_s', ''),\n  \t  ContextSessionId=column_ifexists('context_session_id_d', ''),\n  \t\tActionDescription=column_ifexists('action_description_s', ''),\n      EventId=column_ifexists('id_g', ''),\n      EventEndTime=column_ifexists('date_create_d', ''),\n      DvcAction=column_ifexists('action_s', ''),\n      SrcUserIdentity=column_ifexists('actor_user_id_s', ''),\n      SrcUserName=column_ifexists('actor_user_name_s', ''),\n      SrcUserEmail=column_ifexists('actor_user_email_s', ''),\n      UserAgentOriginal=column_ifexists('context_ua_s', ''),\n      SrcIpAddr=column_ifexists('context_ip_address_s', ''),\n      DvcActionDesc=column_ifexists('action_description_s', '')\n};\nlet SlackAuditV2_view = view () {\nSlackAuditV2_CL\n| extend actor = todynamic(Actor)\n| extend entity = todynamic(Entity)\n| extend context = todynamic(Context)\n| extend details = todynamic(Details)\n| extend\n      Id=column_ifexists('Id', ''),\n      DateCreate=column_ifexists('DateCreate', ''),\n      Action=column_ifexists('Action', ''),\n      DetailsMobileOnly=tobool(details.mobile.only),\n      DetailsWebOnly=tobool(details.web.only),\n      DetailsKickerId=tostring(details.kicker.id),\n      DetailsKickerName=tostring(details.kicker.name),\n      DetailsKickerEmail=tostring(details.kicker.email),\n      DetailsKickerTeam=tostring(details.kicker.team),\n      DetailsAppOwnerId=tostring(details.app.owner.id),\n      DetailsGranularBotToken=tobool(details.granular.bot.token),\n      DetailsNewScopes=tostring(details.new.scopes),\n      DetailsPreviousScopes=tostring(details.previous.scopes),\n      EntityUsergroupId=tostring(entity.usergroup.id),\n      EntityUsergroupName=tostring(entity.usergroup.name),\n      DetailsKickerType=tostring(details.kicker.type),\n      DetailsKickerUserId=tostring(details.kicker.user.id),\n      DetailsKickerUserName=tostring(details.kicker.user.name),\n      DetailsKickerUserEmail=tostring(details.kicker.user.email),\n      DetailsKickerUserTeam=tostring(details.kicker.user.team),\n      DetailsInviterId=tostring(details.inviter.id),\n      DetailsInviterName=tostring(details.inviter.name),\n      DetailsInviterEmail=tostring(details.inviter.email),\n      DetailsInviterTeam=tostring(details.inviter.team),\n      DetailsInviterType=tostring(details.inviter.type),\n      DetailsInviterUserId=tostring(details.inviter.user.id),\n      DetailsInviterUserName=tostring(details.inviter.user.name),\n      DetailsInviterUserEmail=tostring(details.inviter.user.email),\n      DetailsInviterUserTeam=tostring(details.inviter.user.team),\n      DetailsIsWorkflow=tobool(details.is.workflow),\n      EntityAppId=tostring(entity.app.id),\n      EntityAppName=tostring(entity.app.name),\n      EntityAppIsDistributed=tobool(entity.app.is.distributed),\n      EntityAppIsDirectoryApproved=tobool(entity.app.is.directory.approved),\n      EntityAppIsWorkflowApp=tobool(entity.app.is.workflow.app),\n      EntityAppScopes=tostring(entity.app.scopes),\n      DetailsIsInternalIntegration=tobool(details.is.internal.integration),\n      DetailsBotScopes=tostring(details.bot.scopes),\n      EntityChannelId=tostring(entity.channel.id),\n      EntityChannelPrivacy=tostring(entity.channel.privacy),\n      EntityChannelName=tostring(entity.channel.name),\n      EntityChannelIsShared=tobool(entity.channel.is.shared),\n      EntityChannelIsOrgShared=tobool(entity.channel.is.org.shared),\n      DetailsType=tostring(details.type),\n      EntityUserId=tostring(entity.user.id),\n      EntityUserName=tostring(entity.user.name),\n      EntityUserEmail=tostring(entity.user.email),\n      EntityUserTeam=tostring(entity.user.team),\n      ActorType=tostring(actor.type),\n      ActorUserId=tostring(actor.user.id),\n      ActorUserName=tostring(actor.user.name),\n      ActorUserEmail=tostring(actor.user.email),\n      ActorUserTeam=tostring(actor.user.team),\n      EntityType=tostring(entity.type),\n      EntityFileId=tostring(entity.file.id),\n      EntityFileName=tostring(entity.file.name),\n      EntityFileFiletype=tostring(entity.file.filetype),\n      EntityFileTitle=tostring(entity['file']['title']),\n      ContextLocationType=tostring(context.location.type),\n      ContextLocationId=tostring(context.location.id),\n      ContextLocationName=tostring(context.location.name),\n      ContextLocationDomain=tostring(context.location.domain),\n      ContextUA=tostring(context.ua),\n      ContextIpAddress=tostring(context.ip.address),\n      ContextSessionId=todouble(context.session.id),\n      ActionDescription=column_ifexists('ActionDescription', ''),\n      EventId=column_ifexists('Id', ''),\n      EventEndTime=column_ifexists('DateCreate', ''),\n      DvcAction=column_ifexists('Action', ''),\n      SrcUserIdentity=tostring(actor.user.id),\n      SrcUserName=tostring(actor.user.name),\n      SrcUserEmail=tostring(actor.user.email),\n      UserAgentOriginal=tostring(context.ua),\n      SrcIpAddr=tostring(context.ip.address),\n      DvcActionDesc=column_ifexists('ActionDescription', '')\n};\nunion isfuzzy=true\n(SlackAudit_view),\n(SlackAuditV1_view),\n(SlackAuditV2_view) \n| project TimeGenerated, DetailsMobileOnly,DetailsWebOnly, DetailsKickerId, DetailsKickerName, DetailsKickerEmail, DetailsKickerTeam,DetailsAppOwnerId, DetailsGranularBotToken, DetailsNewScopes, DetailsPreviousScopes, EntityUsergroupId, EntityUsergroupName, DetailsKickerType, DetailsKickerUserId, DetailsKickerUserName, DetailsKickerUserEmail, DetailsKickerUserTeam, DetailsInviterId, DetailsInviterName, DetailsInviterEmail, DetailsInviterTeam, DetailsInviterType, DetailsInviterUserId, DetailsInviterUserName, DetailsInviterUserEmail, DetailsInviterUserTeam, DetailsIsWorkflow, EntityAppId, EntityAppName, EntityAppIsDistributed, EntityAppIsDirectoryApproved, EntityAppIsWorkflowApp, EntityAppScopes, DetailsIsInternalIntegration, DetailsBotScopes, EntityChannelId, EntityChannelPrivacy, EntityChannelName, EntityChannelIsShared, EntityChannelIsOrgShared, DetailsType, EntityUserId, EntityUserName, EntityUserEmail, EntityUserTeam, Id, DateCreate, Action, ActorType, ActorUserId, ActorUserName, ActorUserEmail, ActorUserTeam, EntityType, EntityFileId, EntityFileName, EntityFileFiletype, EntityFileTitle, ContextLocationType, ContextLocationId, ContextLocationName, ContextLocationDomain, ContextUA, ContextIpAddress, ContextSessionId, ActionDescription, EventId, EventEndTime, DvcAction, SrcUserIdentity, SrcUserName, SrcUserEmail, UserAgentOriginal, SrcIpAddr, DvcActionDesc\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'SlackAudit Data Parser')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "SlackAudit",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject1').huntingQueryTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditApplicationsInstalled_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject1').huntingQueryVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SlackAudit_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit - Applications installed",
                "category": "Hunting Queries",
                "query": "SlackAudit\n| where TimeGenerated > ago(24h)\n| where DvcAction =~ 'app_installed'\n| summarize by SrcUserName, EntityAppName\n| extend AccountCustomEntity = SrcUserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This query searches for application installation events."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1),'/'))))]",
              "properties": {
                "description": "SlackAudit Hunting Query 1",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1)]",
                "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject1').huntingQueryVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
        "contentKind": "HuntingQuery",
        "displayName": "SlackAudit - Applications installed",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject2').huntingQueryTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditDeactivatedUsers_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject2').huntingQueryVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SlackAudit_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit - Deactivated users",
                "category": "Hunting Queries",
                "query": "SlackAudit\n| where TimeGenerated > ago(24h)\n| where DvcAction =~ 'user_deactivated'\n| summarize by SrcUserName\n| extend AccountCustomEntity = SrcUserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This query searches for deactivated user accounts."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1531"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2),'/'))))]",
              "properties": {
                "description": "SlackAudit Hunting Query 2",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2)]",
                "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject2').huntingQueryVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
        "contentKind": "HuntingQuery",
        "displayName": "SlackAudit - Deactivated users",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject3').huntingQueryTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditDownloadedFilesByUser_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject3').huntingQueryVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SlackAudit_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit - Downloaded files stats",
                "category": "Hunting Queries",
                "query": "SlackAudit\n| where TimeGenerated > ago(24h)\n| where Action =~ 'file_downloaded'\n| summarize filelist = makeset(EntityFileName) by SrcUserName\n| project filelist, fcount = array_length(filelist), SrcUserName\n| top 10 by fcount\n| extend AccountCustomEntity = SrcUserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This query shows top users by downloads over time."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1189,T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3),'/'))))]",
              "properties": {
                "description": "SlackAudit Hunting Query 3",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3)]",
                "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject3').huntingQueryVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
        "contentKind": "HuntingQuery",
        "displayName": "SlackAudit - Downloaded files stats",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject4').huntingQueryTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditFailedLoginsUnknownUsername_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject4').huntingQueryVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SlackAudit_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit - Failed logins with unknown username",
                "category": "Hunting Queries",
                "query": "let lbtime = 24h;\nlet lbperiod = 30d;\nlet known_users = SlackAudit\n| where TimeGenerated > ago(lbperiod)\n| where DvcAction =~ 'user_login'\n| where isnotempty(SrcUserName)\n| summarize makeset(SrcUserName);\nSlackAudit\n| where TimeGenerated > ago(lbtime)\n| where DvcAction =~ 'user_login_failed'\n| where isnotempty(SrcUserName)\n| where SrcUserName !in (known_users)\n| project SrcUserName, SrcIpAddr\n| extend AccountCustomEntity = SrcUserName\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This query shows failed login attempts where username is unknown."
                  },
                  {
                    "name": "tactics",
                    "value": "CredentialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1110"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4),'/'))))]",
              "properties": {
                "description": "SlackAudit Hunting Query 4",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4)]",
                "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject4').huntingQueryVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
        "contentKind": "HuntingQuery",
        "displayName": "SlackAudit - Failed logins with unknown username",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject5').huntingQueryTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditNewUsers_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject5').huntingQueryVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SlackAudit_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit - New User created",
                "category": "Hunting Queries",
                "query": "SlackAudit\n| where TimeGenerated > ago(24h)\n| where DvcAction =~ 'user_created'\n| extend AccountCustomEntity = SrcUserName\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This query shows new user created."
                  },
                  {
                    "name": "tactics",
                    "value": "Persistence"
                  },
                  {
                    "name": "techniques",
                    "value": "T1136"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5),'/'))))]",
              "properties": {
                "description": "SlackAudit Hunting Query 5",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5)]",
                "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject5').huntingQueryVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
        "contentKind": "HuntingQuery",
        "displayName": "SlackAudit - New User created",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject6').huntingQueryTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditSuspiciousFilesDownloaded_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject6').huntingQueryVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SlackAudit_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit - Suspicious files downloaded",
                "category": "Hunting Queries",
                "query": "SlackAudit\n| where DvcAction =~ 'file_downloaded'\n| extend fe = split(EntityFileName, '.')\n| where array_length(fe) > 2\n| where fe[1] matches regex @\"\\D+\"\n| where strlen(fe[1]) < 5\n| project EntityFileName, SrcUserName\n| extend AccountCustomEntity = SrcUserName\n| extend FileCustomEntity = EntityFileName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This query searches for potentialy suspicious files downloads."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1189"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6),'/'))))]",
              "properties": {
                "description": "SlackAudit Hunting Query 6",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6)]",
                "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject6').huntingQueryVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
        "contentKind": "HuntingQuery",
        "displayName": "SlackAudit - Suspicious files downloaded",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject7').huntingQueryTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditUploadedFilesByUser_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject7').huntingQueryVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SlackAudit_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit - Uploaded files stats",
                "category": "Hunting Queries",
                "query": "SlackAudit\n| where TimeGenerated > ago(24h)\n| where Action =~ 'file_uploaded'\n| summarize filelist = makeset(EntityFileName) by SrcUserName\n| project filelist, fcount = array_length(filelist), SrcUserName\n| top 10 by fcount\n| extend AccountCustomEntity = SrcUserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This query shows top users by uploads over time."
                  },
                  {
                    "name": "tactics",
                    "value": "Exfiltration"
                  },
                  {
                    "name": "techniques",
                    "value": "T1048"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7),'/'))))]",
              "properties": {
                "description": "SlackAudit Hunting Query 7",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7)]",
                "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject7').huntingQueryVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
        "contentKind": "HuntingQuery",
        "displayName": "SlackAudit - Uploaded files stats",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject8').huntingQueryTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditUserLoginsByIP_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject8').huntingQueryVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SlackAudit_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit - User logins by IP",
                "category": "Hunting Queries",
                "query": "SlackAudit\n| where TimeGenerated > ago(24h)\n| where DvcAction =~ 'user_login'\n| summarize makeset(SrcIpAddr) by SrcUserName\n| extend AccountCustomEntity = SrcUserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This query shows user IP table statistics for login events."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,Persistence"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8),'/'))))]",
              "properties": {
                "description": "SlackAudit Hunting Query 8",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8)]",
                "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject8').huntingQueryVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
        "contentKind": "HuntingQuery",
        "displayName": "SlackAudit - User logins by IP",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject9').huntingQueryTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditUserPermissionsChanged_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject9').huntingQueryVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SlackAudit_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit - User Permission Changed",
                "category": "Hunting Queries",
                "query": "SlackAudit\n| where TimeGenerated > ago(24h)\n| where DvcAction in~ ('user_added_to_usergroup', 'user_removed_from_usergroup')\n| extend AccountCustomEntity = SrcUserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for user permissions changes events."
                  },
                  {
                    "name": "tactics",
                    "value": "PrivilegeEscalation"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9),'/'))))]",
              "properties": {
                "description": "SlackAudit Hunting Query 9",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9)]",
                "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject9').huntingQueryVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
        "contentKind": "HuntingQuery",
        "displayName": "SlackAudit - User Permission Changed",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject10').huntingQueryTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlackAuditUsersJoinedChannelsWithoutInvites_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject10').huntingQueryVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SlackAudit_Hunting_Query_10",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "SlackAudit - Users joined channels without invites",
                "category": "Hunting Queries",
                "query": "SlackAudit\n| where TimeGenerated > ago(24h)\n| where DvcAction =~ 'user_channel_join'\n| where DetailsType =~ 'JOINED'\n| extend AccountCustomEntity = SrcUserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for users which joined channels without invites."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,Persistence"
                  },
                  {
                    "name": "techniques",
                    "value": "T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject10')._huntingQuerycontentId10),'/'))))]",
              "properties": {
                "description": "SlackAudit Hunting Query 10",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject10')._huntingQuerycontentId10)]",
                "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject10').huntingQueryVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "SlackAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
        "contentKind": "HuntingQuery",
        "displayName": "SlackAudit - Users joined channels without invites",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject10')._huntingQuerycontentId10,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject10')._huntingQuerycontentId10,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.1",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "SlackAudit",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/SlackAudit/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://slack.com/intl/en-in/\">Slack</a> Audit solution provides the capability to ingest <a href=\"https://api.slack.com/admins/audit-logs\">Slack Audit Records</a> events into Microsoft Sentinel through the REST API. Refer to <a href=\"https://api.slack.com/admins/audit-logs-call\">API documentation</a> for more information.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ol type=\"a\">\n<li><p><a href=\"https://docs.microsoft.com/azure/azure-monitor/logs/data-collector-api\">Azure Monitor HTTP Data Collector API</a></p>\n</li>\n<li><p><a href=\"https://docs.microsoft.com/azure/azure-monitor/logs/data-collector-api\">Azure Functions</a><p><span style='color:red; font-weight:bold;'>NOTE</span>: Microsoft recommends installation of SlackAudit (via Codeless Connector Platform). This connector is build on the Codeless Connector Platform (CCP), which uses the Log Ingestion API, which replaces ingestion via the <a href='https://learn.microsoft.com/en-us/azure/azure-monitor/logs/custom-logs-migrate' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>. CCP-based data connectors also support <a href='https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/data-collection-rule-overview' style='color:#1890F1;'>Data Collection Rules</a> (DCRs) offering transformations and enrichment.</p> <p><span style='color:red; font-weight:bold;'>Important</span>: While the updated connector(s) can coexist with their legacy versions, running them together will result in duplicated data ingestion. You can disable the older versions of these connectors to avoid duplication of data..</p></p>\n</li>\n</ol>\n<p><strong>Data Connectors:</strong> 2, <strong>Parsers:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 9, <strong>Hunting Queries:</strong> 10</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/SlackAudit/Data%20Connectors/Logo/slacklogo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "SlackAudit",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId2')]",
              "version": "[variables('dataConnectorVersion2')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
              "version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
              "version": "[variables('huntingQueryObject2').huntingQueryVersion2]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
              "version": "[variables('huntingQueryObject3').huntingQueryVersion3]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
              "version": "[variables('huntingQueryObject4').huntingQueryVersion4]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
              "version": "[variables('huntingQueryObject5').huntingQueryVersion5]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
              "version": "[variables('huntingQueryObject6').huntingQueryVersion6]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
              "version": "[variables('huntingQueryObject7').huntingQueryVersion7]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
              "version": "[variables('huntingQueryObject8').huntingQueryVersion8]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
              "version": "[variables('huntingQueryObject9').huntingQueryVersion9]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
              "version": "[variables('huntingQueryObject10').huntingQueryVersion10]"
            }
          ]
        },
        "firstPublishDate": "2021-03-24",
        "providers": [
          "Slack"
        ],
        "categories": {
          "domains": [
            "Application"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
