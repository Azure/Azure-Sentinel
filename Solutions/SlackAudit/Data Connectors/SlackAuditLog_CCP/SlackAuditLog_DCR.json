[
    {
        "name": "SlackAuditDCR",
        "apiVersion": "2021-09-01-preview",
        "type": "Microsoft.Insights/dataCollectionRules",
        "location": "{{location}}",
        "properties": {
            "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
            "streamDeclarations": {
                "Custom-SlackAudit_CL": {
                    "columns": [
                        {
                            "name": "id",
                            "type": "string"
                        },
                        {
                            "name": "date_create",
                            "type": "real"
                        },
                        {
                            "name": "action",
                            "type": "string"
                        },
                        {
                            "name": "actor",
                            "type": "dynamic"
                        },
                        {
                            "name": "entity",
                            "type": "dynamic"
                        },
                        {
                            "name": "context",
                            "type": "dynamic"
                        },
                        {
                            "name": "details",
                            "type": "dynamic"
                        }
                    ]
                }
            },
            "destinations": {
                "logAnalytics": [
                    {
                        "workspaceResourceId": "{{workspaceResourceId}}",
                        "name": "clv2ws1"
                    }
                ]
            },
            "dataFlows": [
                {
                    "streams": [
                        "Custom-SlackAudit_CL"
                    ],
                    "destinations": [
                        "clv2ws1"
                    ],
                  "transformKql": "source | extend Id = tostring(id), Actor = tostring(actor), Entity = tostring(entity), Context = tostring(context), Details = tostring(details), Action = tostring(action) | extend TimeGenerated = datetime_add('millisecond', tolong(date_create) * 1000, datetime(1970-01-01)) | extend ActionDescription = case(Action == \"workspace_created\", \"A workspace in an organization was created.\", Action == \"workspace_deleted\", \"A workspace in an organization was deleted.\", Action == \"workspace_accepted_migration\", \"An administrator on a workspace has accepted an invitation to migrate to a Grid organization.\", Action == \"workspace_declined_migration\", \"An administrator on a workspace has declined an invitation to migrate to a Grid organization.\", Action == \"migration_scheduled\", \"A migration was scheduled.\", Action == \"organization_verified\", \"Slack has confirmed the identity of your organization. The organization will now be denoted with a verified badge.\", Action == \"organization_unverified\", \"Slack has flagged a change in your organization’s identity and has unverified it.\", Action == \"organization_public_url_updated\", \"Your organization’s public URL has been changed.\", Action == \"organization_created\", \"An Enterprise Grid organization was created.\", Action == \"organization_deleted\", \"An Enterprise Grid organization was deleted.\", Action == \"organization_accepted_migration\", \"The Org Owner accepted a workspace invitation to join their organization.\", Action == \"organization_declined_migration\", \"The Org Owner declined a workspace invitation to join their organization.\", Action == \"billing_address_added\", \"A billing address was added. Includes a details parameter noting the timestamp the TOS was accepted.\", Action == \"emoji_added\", \"An emoji was added. Includes a details parameter with the name of the emoji.\", Action == \"emoji_removed\", \"An emoji was removed. Includes a details parameter with the name of the emoji.\", Action == \"emoji_aliased\", \"An emoji was given an alias. Includes a details parameter with the name of the alias.\", Action == \"emoji_renamed\", \"An emoji was renamed. Includes a details parameter with the previous and new names of the emoji.\", Action == \"message_tombstoned\", \"A message was tombstoned.\", Action == \"message_restored\", \"A message was restored.\", Action == \"manual_export_started\", \"A workspace admin or owner has started a standard export on a workspace.\", Action == \"manual_export_completed\", \"A standard export on a workspace has finished.\", Action == \"corporate_exports_approved\", \"The corporate export feature has been approved for use on a workspace.\", Action == \"corporate_exports_enabled\", \"The corporate export feature has been enabled for a workspace.\", Action == \"scheduled_export_started\", \"A scheduled corporate export has started.\", Action == \"scheduled_export_completed\", \"A scheduled corporate export has finished.\", Action == \"channels_export_started\", \"A channel export has begun.\", Action == \"channels_export_completed\", \"A channel export is complete.\", Action == \"pref.allow_calls\", \"A preference indicating whether Slack Calls can be used in this workspace has changed.\", Action == \"pref.allow_message_deletion\", \"Someone altered this workspace's settings around whether messages can be deleted or not.\", Action == \"pref.app_dir_only\", \"Whether only Slack App Directory apps can be installed or not in this workspace has changed.\", Action == \"pref.app_whitelist_enabled\", \"Someone's carefully carved or culled the list of apps this workspace has whitelisted.\", Action == \"pref.can_receive_shared_channels_invites\", \"Whether this workspace can receive invites to share channels with other workspaces has changed.\", Action == \"pref.commands_only_regular\", \"The setting determining whether restricted users are restricted from using slash commands was changed.\", Action == \"pref.custom_tos\", \"This workspace's settings on having a custom terms of service have changed.\", Action == \"pref.disallow_public_file_urls\", \"This workspace has modified their public file URL settings for files uploaded within it.\", Action == \"pref.dm_retention_changed\", \"The direct message (DM) retention setting changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.dnd_enabled\", \"Do not disturb settings have been enabled for a workspace.\", Action == \"pref.dnd_end_hour\", \"The exact ending hour for workspace do not disturb settings has been set.\", Action == \"pref.dnd_start_hour\", \"The exact starting hour for workspace do not disturb settings has been set.\", Action == \"pref.emoji_only_admins\", \"Someone modified the list of emoji-administrating admins.\", Action == \"pref.enterprise_default_channels\", \"Someone modified the list of default channels across the enterprise grid.\", Action == \"pref.enterprise_team_creation_request\", \"Someone has requested that your organization allow a new workspace to be created.\", Action == \"pref.file_retention_changed\", \"The file retention setting changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.msg_edit_window_mins\", \"Someone edited the edit messaging window for a workspace!\", Action == \"pref.private_channel_retention_changed\", \"The group (private channel) retention setting changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.public_channel_retention_changed\", \"The channel retention setting type changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.retention_override_changed\", \"The retention override setting, allowing workspace members to set their own retention period for private channels and DMs, changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.sign_in_with_slack_disabled\", \"This workspace changed their preference around allowing Sign in with Slack.\", Action == \"pref.slackbot_responses_disabled\", \"The settings around whether Slackbot's witty responses are enabled or disabled changed.\", Action == \"pref.slackbot_responses_only_admins\", \"There's a secret cabal of admins for those witty Slackbot responses and that list was changed.\", Action == \"pref.sso_setting_changed\", \"The Single Sign On (SSO) restriction changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.stats_only_admins\", \"The list of admins that can work with workspace statistics only has changed.\", Action == \"pref.two_factor_auth_changed\", \"The two-factor authentication requirement changed. Includes a details parameter noting the previous and new values.\", Action == \"pref.username_policy\", \"A workspace's username policy preference changed.\", Action == \"pref.who_can_archive_channels\", \"Who can archive channels indeed?\", Action == \"pref.who_can_create_delete_user_groups\", \"The list of who can create or delete user groups changed.\", Action == \"pref.who_can_create_private_channels\", \"The list of those who can create private channels changed.\", Action == \"pref.who_can_create_public_channels\", \"The same as above, but for public channels.\", Action == \"pref.who_can_edit_user_groups\", \"The list of those who can edit user groups changed.\", Action == \"pref.who_can_manage_channel_posting_prefs\", \"Someone's been changing who can manage channel posting preferences.\", Action == \"pref.who_can_manage_ext_shared_channels\", \"The list of who can manage externally shared channels has changed for this workspace.\", Action == \"pref.who_can_manage_guests\", \"The list of who can manage guests now has changed for this workspace.\", Action == \"pref.who_can_manage_shared_channels\", \"Settings around who can remove users from shared channels has changed for a workspace.\", Action == \"pref.who_can_remove_from_private_channels\", \"Settings around who can remove users from private channels has changed for a workspace.\", Action == \"pref.who_can_remove_from_public_channels\", \"Settings around who can remove users from public channels has changed for a workspace.\", Action == \"ekm_enrolled\", \"The workspace is now enrolled/managed by EKM.\", Action == \"ekm_unenrolled\", \"The workspace is no longer enrolled or managed by EKM.\", Action == \"ekm_key_added\", \"An EKM key was added for the workspace.\", Action == \"ekm_key_removed\", \"An EKM key was removed for the workspace.\", Action == \"ekm_clear_cache_set\", \"A revocation event has triggered a new TTL for cached data in this workspace.\", Action == \"ekm_logging_config_set\", \"Logging settings for this workspace's EKM configuration have changed.\", Action == \"ekm_slackbot_enroll_notification_sent\", \"Slack sent notifications about this workspace being enrolled in EKM.\", Action == \"ekm_slackbot_unenroll_notification_sent\", \"Slack sent notifications about this workspace no longer being enrolled in EKM.\", Action == \"ekm_slackbot_rekey_notification_sent\", \"Slack sent notifications about this workspace's EKM configuration being rekeyed.\", Action == \"ekm_slackbot_logging_notification_sent\", \"Slack sent notifications about logging changes to EKM in this workspace.\", Action == \"user_channel_join\", \"A user has joined a channel.\", Action == \"user_channel_leave\", \"A user has left a channel.\", Action == \"guest_channel_join\", \"A guest user has joined a channel.\", Action == \"guest_channel_leave\", \"A guest user has left a channel.\", Action == \"guest_created\", \"A guest user was invited to a channel.\", Action == \"channel_moved\", \"A channel has been moved to a different workspace.\", Action == \"public_channel_created\", \"A public channel was created.\", Action == \"private_channel_created\", \"A private channel was created.\", Action == \"public_channel_archive\", \"A public channel was archived.\", Action == \"private_channel_archive\", \"A private channel was archived.\", Action == \"public_channel_unarchive\", \"A public channel was unarchived.\", Action == \"private_channel_unarchive\", \"A private channel was unarchived.\", Action == \"public_channel_deleted\", \"A public channel was deleted.\", Action == \"private_channel_deleted\", \"A private channel was deleted.\", Action == \"mpim_converted_to_private\", \"A multi-party direct message was converted to a private channel.\", Action == \"public_channel_converted_to_private\", \"A channel which was once public is now private.\", Action == \"channel_email_address_created\", \"An email forwarding address was created for a channel.\", Action == \"channel_email_address_deleted\", \"An email forwarding address was deleted from channel.\", Action == \"external_shared_channel_connected\", \"A shared channel with another workspace has been connected with this one.\", Action == \"external_shared_channel_disconnected\", \"A shared channel with another workspace is no longer connected with this one.\", Action == \"external_shared_channel_reconnected\", \"A previously connected and then disconnected shared channel with another workspace is once again shared with this one.\", Action == \"external_shared_channel_invite_sent\", \"An invitation to join a shared channel was sent.\", Action == \"external_shared_channel_invite_accepted\", \"An invitation to join a shared channel was accepted! Nice.\", Action == \"external_shared_channel_invite_approved\", \"An invitation to join a shared channel was approved by an admin.\", Action == \"external_shared_channel_invite_created\", \"An invitation url to join a shared channel was created.\", Action == \"external_shared_channel_invite_declined\", \"An invitation to join a shared channel was declined.\", Action == \"external_shared_channel_invite_expired\", \"An invitation to join a shared channel expired.\", Action == \"external_shared_channel_invite_revoked\", \"An invitation to join a shared channel was revoked.\", Action == \"role_change_to_owner\", \"A team member was made an owner.\", Action == \"role_change_to_admin\", \"A team member was made an admin.\", Action == \"role_change_to_user\", \"A team member was a user.\", Action == \"role_change_to_guest\", \"A team member was made a guest.\", Action == \"owner_transferred\", \"An owner was transferred.\", Action == \"user_created\", \"A team member was created.\", Action == \"user_deactivated\", \"A team member was deactivated.\", Action == \"user_reactivated\", \"A team member was reactivated.\", Action == \"user_login_failed\", \"A login attempt failed for a user.\", Action == \"guest_created\", \"A guest user was created.\", Action == \"guest_deactivated\", \"A guest user was deactivated.\", Action == \"guest_reactivated\", \"A guest user was reactivated.\", Action == \"guest_expiration_set\", \"A guest user's expiration date was set.\", Action == \"guest_expired\", \"A guest user's expiration date passed.\", Action == \"guest_expiration_cleared\", \"A guest user's expiration date was cleared.\", Action == \"user_login\", \"A team member logged into the system.\", Action == \"user_logout\", \"A team member logged out of the system.\", Action == \"custom_tos_accepted\", \"The team member has accepted the custom terms of service.\", Action == \"app_approved\", \"An app was approved for use in the workspace.\", Action == \"app_restricted\", \"An app has been restricted from the workspace.\", Action == \"app_installed\", \"An app has been installed in the workspace.\", Action == \"app_scopes_expanded\", \"An app's access scopes have been expanded.\", Action == \"app_resources_added\", \"App resources were added to the workspace.\", Action == \"app_uninstalled\", \"An app was uninstalled from the workspace.\", Action == \"app_token_preserved\", \"App token was preserved for the workspace.\", Action == \"file_downloaded\", \"A file was downloaded.\", Action == \"file_downloaded_blocked\", \"A file download was blocked.\", Action == \"file_uploaded\", \"A file was uploaded.\", Action == \"file_public_link_created\", \"A public link for a file was created.\", Action == \"file_public_link_revoked\", \"A public link for a file was revoked.\", Action == \"file_shared\", \"A file was shared.\", Action == \"workflow_v2_published\", \"A workflow was published.\",\" \")| project Id, DateCreate = date_create, Action, ActionDescription, Actor, Entity, Context, Details, TimeGenerated",
                  "outputStream": "Custom-SlackAuditV2_CL"
                }
            ]
        }
    }
]