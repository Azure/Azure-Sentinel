id: 9392A06F-63A4-4A5D-8CA3-647064B13C28
name: Darktrace Model Alert
kind: NRT
description: |
  Creates a Sentinel Alert from a Darktrace Model Alert. You will need to edit
  this Analytic Rule if you would like it to create Sentinel Incidents.
severity: High
requiredDataConnectors:
  - connectorId: DarktraceLogIngestionAPIConnector
    dataTypes:
      - DarktraceModelAlerts_CL
tactics: []
relevantTechniques: []
query: |
  DarktraceModelAlerts_CL
  | extend SentinelSeverity = case(category == "Informational", "Low",
  category == "Suspicious", "Medium", "High")
  | extend ProviderName = "Darktrace"
  | mv-apply item = mitreTechniques on (
      extend techniqueId = tostring(item.techniqueId)
      | summarize techniqueIdArray = make_list(techniqueId, 5)
  )
eventGroupingSettings:
  aggregationKind: AlertPerResult
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: sourceIp
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: destIp
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: destHost
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: sourceHost
customDetails:
  DeviceHostname: deviceHostname
  DeviceCredentials: deviceCredentials
  Compliance: compliance
  Score: score
  CustomLabel: customLabel
  Category: category
alertDetailsOverride:
  alertDisplayNameFormat: 'Darktrace Model Alert: {{modelName}}  '
  alertDescriptionFormat: '{{message}}'
  alertSeverityColumnName: SentinelSeverity
  alertDynamicProperties:
    - alertProperty: AlertLink
      value: alertUrl
    - alertProperty: ProductName
      value: darktraceProduct
    - alertProperty: ProviderName
      value: ProviderName
    - alertProperty: Techniques
      value: techniqueIdArray
incidentConfiguration:
  createIncident: false
  groupingConfiguration:
    enabled: false
    reopenClosedIncident: false
    lookbackDuration: PT5H
    matchingMethod: AllEntities
version: 1.0.0