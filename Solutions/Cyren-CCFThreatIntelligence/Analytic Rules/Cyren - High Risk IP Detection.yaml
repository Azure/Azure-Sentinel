id: c3d4e5f6-a7b8-9012-cdef-345678901234
name: Cyren - High Risk IP Detection
version: 1.0.0
kind: Scheduled
description: |-
  Detects IPs with high risk scores (>=80) from Cyren threat intelligence.
  High risk IPs are associated with malicious activities and should be investigated.
  
  Ref: https://cyren.com/
severity: High
requiredDataConnectors:
  - connectorId: CyrenThreatIntel
    dataTypes:
      - Cyren_Indicators_CL
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: GreaterThan
triggerThreshold: 0
tactics:
  - CommandAndControl
  - Impact
relevantTechniques:
  - T1071
  - T1105
query: |-
  Cyren_Indicators_CL
  | where TimeGenerated > ago(1h)
  | where isnotempty(ip_s)
  | where risk_d >= 80
  | summarize 
      DetectionCount = count(),
      Categories = make_set(category_s),
      FirstSeen = min(firstSeen_t),
      LastSeen = max(lastSeen_t),
      Sources = make_set(source_s)
      by IP = ip_s
  | extend Severity = case(
      DetectionCount >= 10, "High",
      DetectionCount >= 5, "Medium",
      "Low"
  )
  | project 
      IP,
      DetectionCount,
      Categories,
      FirstSeen,
      LastSeen,
      Sources,
      Severity
suppressionEnabled: false
incidentConfiguration:
  createIncident: true
  groupingConfiguration:
    enabled: true
    reopenClosedIncident: false
    lookbackDuration: 5h
    matchingMethod: Selected
    groupByEntities:
      - IP
suppressionDuration: 5h
eventGroupingSettings:
  aggregationKind: AlertPerResult
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: IP
