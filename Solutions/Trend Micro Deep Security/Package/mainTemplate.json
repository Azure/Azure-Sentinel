{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Trend Micro",
    "comments": "Solution template for Trend Micro Deep Security"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Trend Micro Deep Security ATT&CK Related Activity",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook2-name": {
      "type": "string",
      "defaultValue": "Trend Micro Deep Security Events",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "Trend Micro Deep Security",
    "_solutionVersion": "3.0.0",
    "solutionId": "trendmicro.trend_micro_deep_security_mss",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "TrendMicro",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "TrendMicro",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "TrendMicroDeepSecurityAttackActivityWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "workbookVersion2": "1.0.0",
    "workbookContentId2": "TrendMicroDeepSecurityOverviewWorkbook",
    "workbookId2": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId2'))]",
    "workbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId2'))))]",
    "_workbookContentId2": "[variables('workbookContentId2')]",
    "_workbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId2'),'-', variables('workbookVersion2'))))]",
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','TrendMicroDeepSecurity')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'TrendMicroDeepSecurity')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('TrendMicroDeepSecurity-Parser')))]",
      "parserVersion1": "1.0.0",
      "parserContentId1": "TrendMicroDeepSecurity-Parser"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Trend Micro Deep Security data connector with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "[Deprecated] Trend Micro Deep Security via Legacy",
                  "publisher": "Trend Micro",
                  "descriptionMarkdown": "The Trend Micro Deep Security connector allows you to easily connect your Deep Security logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives you more insight into your organization's networks/systems and improves your security operation capabilities.",
                  "additionalRequirementBanner": "These queries and workbooks are dependent on Kusto functions based on Kusto to work as expected. Follow the steps to use the Kusto functions alias \"TrendMicroDeepSecurity\" \nin queries and workbooks. [Follow steps to get this Kusto function.](https://aka.ms/TrendMicroDeepSecurityFunction)",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "TrendMicroDeepSecurity",
                      "baseQuery": "\nTrendMicroDeepSecurity\n"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Intrusion Prevention Events",
                      "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Intrusion Prevention\"\n            | sort by TimeGenerated"
                    },
                    {
                      "description": "Integrity Monitoring Events",
                      "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Integrity Monitoring\"\n            | sort by TimeGenerated"
                    },
                    {
                      "description": "Firewall Events",
                      "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Firewall Events\"\n            | sort by TimeGenerated"
                    },
                    {
                      "description": "Log Inspection Events",
                      "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Log Inspection\"\n            | sort by TimeGenerated"
                    },
                    {
                      "description": "Anti-Malware Events",
                      "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Anti-Malware\"\n            | sort by TimeGenerated"
                    },
                    {
                      "description": "Web Reputation Events",
                      "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Web Reputation\"\n            | sort by TimeGenerated"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "\nTrendMicroDeepSecurity\n\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "CommonSecurityLog (TrendMicroDeepSecurity)",
                      "lastDataReceivedQuery": "\nTrendMicroDeepSecurity\n\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
                      "innerSteps": [
                        {
                          "title": "1.1 Select or create a Linux machine",
                          "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds."
                        },
                        {
                          "title": "1.2 Install the CEF collector on the Linux machine",
                          "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 TCP.\n\n> 1. Make sure that you have Python on your machine using the following command: python -version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                          "instructions": [
                            {
                              "parameters": {
                                "fillWith": [
                                  "WorkspaceId",
                                  "PrimaryKey"
                                ],
                                "label": "Run the following command to install and apply the CEF collector:",
                                "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                              },
                              "type": "CopyableLabel"
                            }
                          ]
                        }
                      ],
                      "title": "1. Linux Syslog agent configuration"
                    },
                    {
                      "description": "1. Set your security solution to send Syslog messages in CEF format to the proxy machine. Make sure to send the logs to port 514 TCP on the machine's IP address.\n2. Forward Trend Micro Deep Security events to the Syslog agent.\n3. Define a new Syslog Configuration that uses the CEF format by referencing [this knowledge article](https://aka.ms/Sentinel-trendmicro-kblink)  for additional information.\n4. Configure the Deep Security Manager to use this new configuration to forward events to the Syslog agent using [these instructions](https://aka.ms/Sentinel-trendMicro-connectorInstructions).\n5. Make sure to save the [TrendMicroDeepSecurity](https://aka.ms/TrendMicroDeepSecurityFunction) function so that it queries the Trend Micro Deep Security data properly.",
                      "title": "2. Forward Trend Micro Deep Security logs to Syslog agent"
                    },
                    {
                      "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python -version\n\n>2. You must have elevated permissions (sudo) on your machine",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Run the following command to validate your connectivity:",
                            "value": "sudo wget -O cef_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py {0}"
                          },
                          "type": "CopyableLabel"
                        }
                      ],
                      "title": "3. Validate connection"
                    },
                    {
                      "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
                      "title": "4. Secure your machine "
                    }
                  ],
                  "metadata": {
                    "id": "abf0937a-e5be-4587-a805-fd5dbcffd6cd",
                    "version": "1.0.0",
                    "kind": "dataConnector",
                    "source": {
                      "kind": "community"
                    },
                    "author": {
                      "name": "Trend Micro"
                    },
                    "support": {
                      "name": "Trend Micro",
                      "link": "https://success.trendmicro.com/technical-support",
                      "tier": "developer"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Trend Micro Deep Security",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Trend Micro"
                },
                "support": {
                  "name": "Trend Micro",
                  "tier": "Partner",
                  "link": "https://success.trendmicro.com/dcx/s/?language=en_US"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "[Deprecated] Trend Micro Deep Security via Legacy",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Trend Micro Deep Security",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Trend Micro"
        },
        "support": {
          "name": "Trend Micro",
          "tier": "Partner",
          "link": "https://success.trendmicro.com/dcx/s/?language=en_US"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "[Deprecated] Trend Micro Deep Security via Legacy",
          "publisher": "Trend Micro",
          "descriptionMarkdown": "The Trend Micro Deep Security connector allows you to easily connect your Deep Security logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives you more insight into your organization's networks/systems and improves your security operation capabilities.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "TrendMicroDeepSecurity",
              "baseQuery": "\nTrendMicroDeepSecurity\n"
            }
          ],
          "dataTypes": [
            {
              "name": "CommonSecurityLog (TrendMicroDeepSecurity)",
              "lastDataReceivedQuery": "\nTrendMicroDeepSecurity\n\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "\nTrendMicroDeepSecurity\n\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Intrusion Prevention Events",
              "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Intrusion Prevention\"\n            | sort by TimeGenerated"
            },
            {
              "description": "Integrity Monitoring Events",
              "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Integrity Monitoring\"\n            | sort by TimeGenerated"
            },
            {
              "description": "Firewall Events",
              "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Firewall Events\"\n            | sort by TimeGenerated"
            },
            {
              "description": "Log Inspection Events",
              "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Log Inspection\"\n            | sort by TimeGenerated"
            },
            {
              "description": "Anti-Malware Events",
              "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Anti-Malware\"\n            | sort by TimeGenerated"
            },
            {
              "description": "Web Reputation Events",
              "query": "\nTrendMicroDeepSecurity\n\n            | where DeepSecurityModuleName == \"Web Reputation\"\n            | sort by TimeGenerated"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
              "innerSteps": [
                {
                  "title": "1.1 Select or create a Linux machine",
                  "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds."
                },
                {
                  "title": "1.2 Install the CEF collector on the Linux machine",
                  "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 TCP.\n\n> 1. Make sure that you have Python on your machine using the following command: python -version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                  "instructions": [
                    {
                      "parameters": {
                        "fillWith": [
                          "WorkspaceId",
                          "PrimaryKey"
                        ],
                        "label": "Run the following command to install and apply the CEF collector:",
                        "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                      },
                      "type": "CopyableLabel"
                    }
                  ]
                }
              ],
              "title": "1. Linux Syslog agent configuration"
            },
            {
              "description": "1. Set your security solution to send Syslog messages in CEF format to the proxy machine. Make sure to send the logs to port 514 TCP on the machine's IP address.\n2. Forward Trend Micro Deep Security events to the Syslog agent.\n3. Define a new Syslog Configuration that uses the CEF format by referencing [this knowledge article](https://aka.ms/Sentinel-trendmicro-kblink)  for additional information.\n4. Configure the Deep Security Manager to use this new configuration to forward events to the Syslog agent using [these instructions](https://aka.ms/Sentinel-trendMicro-connectorInstructions).\n5. Make sure to save the [TrendMicroDeepSecurity](https://aka.ms/TrendMicroDeepSecurityFunction) function so that it queries the Trend Micro Deep Security data properly.",
              "title": "2. Forward Trend Micro Deep Security logs to Syslog agent"
            },
            {
              "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python -version\n\n>2. You must have elevated permissions (sudo) on your machine",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Run the following command to validate your connectivity:",
                    "value": "sudo wget -O cef_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py {0}"
                  },
                  "type": "CopyableLabel"
                }
              ],
              "title": "3. Validate connection"
            },
            {
              "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
              "title": "4. Secure your machine "
            }
          ],
          "id": "[variables('_uiConfigId1')]",
          "additionalRequirementBanner": "These queries and workbooks are dependent on Kusto functions based on Kusto to work as expected. Follow the steps to use the Kusto functions alias \"TrendMicroDeepSecurity\" \nin queries and workbooks. [Follow steps to get this Kusto function.](https://aka.ms/TrendMicroDeepSecurityFunction)"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrendMicroDeepSecurityAttackActivity Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Visualize and gain insights into the MITRE ATT&CK related activity detected by Trend Micro Deep Security."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Trend Micro Deep Security ATT&CK Related Activity\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"94910267-b8f6-4b30-aa2f-e5780ad9738e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000}],\"allowCustom\":false}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":1,\"content\":{\"json\":\"---\"},\"name\":\"text - 29\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"TrendMicroDeepSecurity\\r\\n| where Activity contains \\\"ATT&CK\\\"\\r\\n| summarize count() by DeepSecurityModuleName, bin(TimeGenerated, 1h)\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"ATT&CK Event History\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"name\":\"ATT&CK Event History\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"TrendMicroDeepSecurity\\n| where Activity contains \\\"ATT&CK\\\"\\n| summarize Count=count() by Activity = strcat(DeepSecurityModuleName,\\\" - \\\",Activity)\\n| top 10 by Count\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top ATT&CK Events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"Top ATT&CK Events\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"TrendMicroDeepSecurity\\n| where Activity contains \\\"ATT&CK\\\"\\n| summarize Count=count() by Host=DeviceName\\n| top 10 by Count\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top ATT&CK Computers\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"Top ATT&CK Computers\",\"styleSettings\":{\"maxWidth\":\"50\"}}],\"fromTemplateId\":\"sentinel-TrendMicroAttackActivity\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=TrendMicroDeepSecurityAttackActivityWorkbook; logoFileName=trendmicro_logo.svg; description=Visualize and gain insights into the MITRE ATT&CK related activity detected by Trend Micro Deep Security.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Trend Micro Deep Security ATT&CK Related Activity; templateRelativePath=TrendMicroDeepSecurityAttackActivity.json; subtitle=; provider=Trend Micro}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Trend Micro Deep Security",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Trend Micro"
                },
                "support": {
                  "name": "Trend Micro",
                  "tier": "Partner",
                  "link": "https://success.trendmicro.com/dcx/s/?language=en_US"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "CommonSecurityLog",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "TrendMicro",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "CefAma",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrendMicroDeepSecurityOverview Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId2')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Gain insights into your Trend Micro Deep Security security event data by visualizing your Deep Security Anti-Malware, Firewall, Integrity Monitoring, Intrusion Prevention, Log Inspection, and Web Reputation event data."
              },
              "properties": {
                "displayName": "[parameters('workbook2-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Trend Micro Deep Security Events\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"94910267-b8f6-4b30-aa2f-e5780ad9738e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000}],\"allowCustom\":true}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Anti-Malware\"},\"name\":\"text - 29\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName  == \\\"Anti-Malware\\\" \\r\\n| summarize count() by DeviceAction, bin(TimeGenerated, 1h)\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Anti-Malware Event History\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"name\":\"Anti-Malware Event History\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Anti-Malware\\\"\\r\\n| summarize Events=count(Activity) by Rule=Activity\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 Detected Malware\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Top 5 Detected Malware\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Anti-Malware\\\"\\r\\n| summarize Events=count(DeviceName) by Device=DeviceName\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 Infected Computers\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Top 5 Infected Computers\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Firewall\"},\"name\":\"text - 29 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName  == \\\"Firewall\\\"\\r\\n| where Activity !contains \\\"Reconnaissance\\\"\\r\\n| summarize count() by DeviceAction, bin(TimeGenerated, 1h)\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Firewall Event History\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"name\":\"Firewall Event History\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Firewall\\\"\\r\\n| where Activity !contains \\\"Reconnaissance\\\"\\r\\n| where DeviceAction == \\\"Deny\\\"\\r\\n| summarize Events=count(Activity) by Rule=Activity\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Firewall Activity (Prevented)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Firewall Activity (Prevented)\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Firewall\\\"\\r\\n| where Activity !contains \\\"Reconnaissance\\\"\\r\\n| where DeviceAction == \\\"IDS:Deny\\\"\\r\\n| summarize Events=count(Activity) by Rule=Activity\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Firewall Activity (Detected)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Firewall Activity (Detected)\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Firewall\\\"\\r\\n| where Activity !contains \\\"Reconnaissance\\\"\\r\\n| where DeviceAction == \\\"Deny\\\"\\r\\n| summarize Events=count(DeviceName) by Device=DeviceName\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Firewall Computer Activity (Prevented)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Firewall Computer Activity (Prevented)\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Firewall\\\"\\r\\n| where Activity !contains \\\"Reconnaissance\\\"\\r\\n| where DeviceAction == \\\"IDS:Deny\\\"\\r\\n| summarize Events=count(DeviceName) by Device=DeviceName\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Firewall Computer Activity (Detected)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Firewall Computer Activity (Detected)\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Integrity Monitoring\"},\"name\":\"text - 29 - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"TrendMicroDeepSecurity \\r\\n| where DeepSecurityModuleName == \\\"Integrity Monitoring\\\"\\r\\n| extend severity = case(LogSeverity == 3, \\\"Low\\\", \\r\\n                         LogSeverity == 6, \\\"Medium\\\",\\r\\n                         LogSeverity == 8, \\\"High\\\", \\r\\n                         \\\"Critical\\\")\\r\\n| summarize count() by severity, bin(TimeGenerated, 1h)\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Integrity Monitoring Event History\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"name\":\"Integrity Monitoring Event History\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Integrity Monitoring\\\"\\r\\n| summarize Events=count(Activity) by Rule=Activity\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Integrity Monitoring Activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Integrity Monitoring Activity\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Integrity Monitoring\\\"\\r\\n| summarize Events=count(Activity) by Device=DeviceName\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Integrity Monitoring Computer Activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Integrity Monitoring Computer Activity\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Intrusion Prevention\"},\"name\":\"text - 29 - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName  == \\\"Intrusion Prevention\\\"\\r\\n| summarize count() by DeviceAction, bin(TimeGenerated, 1h)\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Intrusion Prevention Event History\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"name\":\"Intrusion Prevention Event History\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Intrusion Prevention\\\"\\r\\n| where DeviceAction == \\\"Reset\\\"\\r\\n| summarize Events=count(Activity) by Rule=Activity\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"IPS Activity (Prevented)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"IPS Activity (Prevented)\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Intrusion Prevention\\\"\\r\\n| where DeviceAction == \\\"IDS:Reset\\\"\\r\\n| summarize Events=count(Activity) by Rule=Activity\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"IPS Activity (Detected)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"IPS Activity (Detected)\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Intrusion Prevention\\\"\\r\\n| where DeviceAction == \\\"Reset\\\"\\r\\n| summarize Events=count(DeviceName) by Device=DeviceName\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"IPS Computer Activity (Prevented)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"IPS Computer Activity (Prevented)\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Intrusion Prevention\\\"\\r\\n| where DeviceAction == \\\"IDS:Reset\\\"\\r\\n| summarize Events=count(DeviceName) by Device=DeviceName\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"IPS Computer Activity (Detected)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"IPS Computer Activity (Detected)\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Log Inspection\"},\"name\":\"text - 29 - Copy - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"TrendMicroDeepSecurity \\r\\n| where DeepSecurityModuleName == \\\"Log Inspection\\\"\\r\\n| extend severity = case(LogSeverity == 3, \\\"Low\\\", \\r\\n                         LogSeverity == 6, \\\"Medium\\\",\\r\\n                         LogSeverity == 8, \\\"High\\\", \\r\\n                         \\\"Critical\\\")\\r\\n| summarize count() by severity, bin(TimeGenerated, 1h)\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Log Inspection Event History\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"name\":\"Log Inspection Event History\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Log Inspection\\\"\\r\\n| summarize Events=count(Activity) by Rule=Activity\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Log Inspection Activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Log Inspection Activity\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Log Inspection\\\"\\r\\n| summarize Events=count(LIDescription) by Event=LIDescription\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Log Inspection Description Activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Log Inspection Description Activity\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Log Inspection\\\"\\r\\n| summarize Events=count(Activity) by Device=DeviceName\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Log Inspection Computer Activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Log Inspection Computer Activity\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Web Reputation\"},\"name\":\"text - 29 - Copy - Copy - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName  == \\\"Web Reputation\\\"\\r\\n| summarize count() by Message, bin(TimeGenerated, 1h)\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Web Reputation Event History\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"name\":\"Web Reputation Event History\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Web Reputation\\\"\\r\\n| summarize Events=count(RequestURL) by URL=RequestURL\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Web Reputation URL Activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Web Reputation URL Activity\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nTrendMicroDeepSecurity\\r\\n| where DeepSecurityModuleName == \\\"Web Reputation\\\"\\r\\n| summarize Events=count(RequestURL) by Device=DeviceName\\r\\n| top 5 by Events\",\"size\":3,\"exportFieldName\":\"SelectedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Web Reputation Computer Activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"Web Reputation Computer Activity\",\"styleSettings\":{\"maxWidth\":\"50\"}}],\"fromTemplateId\":\"sentinel-TrendMicroOverview\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId2'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=TrendMicroDeepSecurityOverviewWorkbook; logoFileName=trendmicro_logo.svg; description=Gain insights into your Trend Micro Deep Security security event data by visualizing your Deep Security Anti-Malware, Firewall, Integrity Monitoring, Intrusion Prevention, Log Inspection, and Web Reputation event data.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Trend Micro Deep Security Events; templateRelativePath=TrendMicroDeepSecurityOverview.json; subtitle=; provider=Trend Micro}.description",
                "parentId": "[variables('workbookId2')]",
                "contentId": "[variables('_workbookContentId2')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Trend Micro Deep Security",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Trend Micro"
                },
                "support": {
                  "name": "Trend Micro",
                  "tier": "Partner",
                  "link": "https://success.trendmicro.com/dcx/s/?language=en_US"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "CommonSecurityLog",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "TrendMicro",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "CefAma",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId2')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook2-name')]",
        "contentProductId": "[variables('_workbookcontentProductId2')]",
        "id": "[variables('_workbookcontentProductId2')]",
        "version": "[variables('workbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrendMicroDeepSecurity Data Parser with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "TrendMicroDeepSecurity",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "TrendMicroDeepSecurity",
                "query": "CommonSecurityLog\n| where DeviceVendor has_any (\"TrendMicro\", \"Trend Micro\")\n| extend DeviceCustomNumber1 = coalesce(column_ifexists(\"FieldDeviceCustomNumber1\", long(null)),DeviceCustomNumber1),\n         DeviceCustomNumber2 = coalesce(column_ifexists(\"FieldDeviceCustomNumber2\", long(null)),DeviceCustomNumber2),\n         DeviceCustomNumber3 = coalesce(column_ifexists(\"FieldDeviceCustomNumber3\", long(null)),DeviceCustomNumber3)\n| extend DeepSecurityHostID = DeviceCustomNumber1\n| extend DeepSecurityModuleName =\niff(toint(DeviceEventClassID) in (20,21,100,850,851,852,853,854),\"Firewall\",\niff(toint(DeviceEventClassID)>=1000000 and toint(DeviceEventClassID)<2000000,\"Intrusion Prevention\",\niff(toint(DeviceEventClassID)>=2000000 and toint(DeviceEventClassID)<3000000,\"Integrity Monitoring\",\niff(toint(DeviceEventClassID)>=3000000 and toint(DeviceEventClassID)<4000000,\"Log Inspection\",\niff(toint(DeviceEventClassID)>=4000000 and toint(DeviceEventClassID)<5000000,\"Anti-Malware\",\niff(toint(DeviceEventClassID)>=5000000 and toint(DeviceEventClassID)<6000000,\"Web Reputation\",\niff(toint(DeviceEventClassID)>=6000000 and toint(DeviceEventClassID)<7000000,\"Application Control\",\"System\")))))))\n| extend actionReason = iff(DeepSecurityModuleName == \"Application Control\", DeviceCustomString1, \"\")\n| extend sha1 = iff(DeepSecurityModuleName == \"Application Control\", DeviceCustomString2, \"\")\n| extend md5 = iff(DeepSecurityModuleName == \"Application Control\", DeviceCustomString3, \"\")\n| parse AdditionalExtensions with * \"target=\" target \";\" *\n| extend LIDescription = iff (DeepSecurityModuleName == \"Log Inspection\", DeviceCustomString1, \"\")\n| extend FragmentationBits = iff (DeepSecurityModuleName == \"Firewall\", DeviceCustomString3, \"\")\n| extend TCPFlags = iff (DeepSecurityModuleName == \"Firewall\" or DeepSecurityModuleName == \"Intrusion Prevention\", DeviceCustomString2, \"\")\n| extend InfectedResource = iff(DeepSecurityModuleName == \"Anti-Malware\", DeviceCustomString3, \"\")\n| extend ResourceType = iff(DeepSecurityModuleName == \"Anti-Malware\", DeviceCustomString4, \"\")\n| extend RiskLevel = iff(DeepSecurityModuleName == \"Anti-Malware\", DeviceCustomString5, \"\")\n| extend DPIStreamPosition = iff(DeepSecurityModuleName == \"Intrusion Prevention\", DeviceCustomString5, \"\")\n| extend DPIFlags = iff(DeepSecurityModuleName == \"Intrusion Prevention\", DeviceCustomString6, \"\")\n| extend DPIPacketPosition = iff(DeepSecurityModuleName == \"Intrusion Prevention\", DeviceCustomNumber3, 0)\n| where DeviceProduct startswith \"Deep Security\"\n| project-away DeviceCustomNumber1, DeviceCustomNumber1Label, DeviceCustomNumber2, DeviceCustomNumber2Label, DeviceCustomNumber3, DeviceCustomNumber3Label, DeviceCustomString1, DeviceCustomString1Label, DeviceCustomString2, DeviceCustomString2Label, DeviceCustomString3, DeviceCustomString3Label, DeviceCustomString4, DeviceCustomString4Label, DeviceCustomString5, DeviceCustomString5Label, DeviceCustomString6, DeviceCustomString6Label\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'TrendMicroDeepSecurity')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "Trend Micro Deep Security",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Trend Micro"
                },
                "support": {
                  "name": "Trend Micro",
                  "tier": "Partner",
                  "link": "https://success.trendmicro.com/dcx/s/?language=en_US"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "TrendMicroDeepSecurity",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "TrendMicroDeepSecurity",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "TrendMicroDeepSecurity",
        "query": "CommonSecurityLog\n| where DeviceVendor has_any (\"TrendMicro\", \"Trend Micro\")\n| extend DeviceCustomNumber1 = coalesce(column_ifexists(\"FieldDeviceCustomNumber1\", long(null)),DeviceCustomNumber1),\n         DeviceCustomNumber2 = coalesce(column_ifexists(\"FieldDeviceCustomNumber2\", long(null)),DeviceCustomNumber2),\n         DeviceCustomNumber3 = coalesce(column_ifexists(\"FieldDeviceCustomNumber3\", long(null)),DeviceCustomNumber3)\n| extend DeepSecurityHostID = DeviceCustomNumber1\n| extend DeepSecurityModuleName =\niff(toint(DeviceEventClassID) in (20,21,100,850,851,852,853,854),\"Firewall\",\niff(toint(DeviceEventClassID)>=1000000 and toint(DeviceEventClassID)<2000000,\"Intrusion Prevention\",\niff(toint(DeviceEventClassID)>=2000000 and toint(DeviceEventClassID)<3000000,\"Integrity Monitoring\",\niff(toint(DeviceEventClassID)>=3000000 and toint(DeviceEventClassID)<4000000,\"Log Inspection\",\niff(toint(DeviceEventClassID)>=4000000 and toint(DeviceEventClassID)<5000000,\"Anti-Malware\",\niff(toint(DeviceEventClassID)>=5000000 and toint(DeviceEventClassID)<6000000,\"Web Reputation\",\niff(toint(DeviceEventClassID)>=6000000 and toint(DeviceEventClassID)<7000000,\"Application Control\",\"System\")))))))\n| extend actionReason = iff(DeepSecurityModuleName == \"Application Control\", DeviceCustomString1, \"\")\n| extend sha1 = iff(DeepSecurityModuleName == \"Application Control\", DeviceCustomString2, \"\")\n| extend md5 = iff(DeepSecurityModuleName == \"Application Control\", DeviceCustomString3, \"\")\n| parse AdditionalExtensions with * \"target=\" target \";\" *\n| extend LIDescription = iff (DeepSecurityModuleName == \"Log Inspection\", DeviceCustomString1, \"\")\n| extend FragmentationBits = iff (DeepSecurityModuleName == \"Firewall\", DeviceCustomString3, \"\")\n| extend TCPFlags = iff (DeepSecurityModuleName == \"Firewall\" or DeepSecurityModuleName == \"Intrusion Prevention\", DeviceCustomString2, \"\")\n| extend InfectedResource = iff(DeepSecurityModuleName == \"Anti-Malware\", DeviceCustomString3, \"\")\n| extend ResourceType = iff(DeepSecurityModuleName == \"Anti-Malware\", DeviceCustomString4, \"\")\n| extend RiskLevel = iff(DeepSecurityModuleName == \"Anti-Malware\", DeviceCustomString5, \"\")\n| extend DPIStreamPosition = iff(DeepSecurityModuleName == \"Intrusion Prevention\", DeviceCustomString5, \"\")\n| extend DPIFlags = iff(DeepSecurityModuleName == \"Intrusion Prevention\", DeviceCustomString6, \"\")\n| extend DPIPacketPosition = iff(DeepSecurityModuleName == \"Intrusion Prevention\", DeviceCustomNumber3, 0)\n| where DeviceProduct startswith \"Deep Security\"\n| project-away DeviceCustomNumber1, DeviceCustomNumber1Label, DeviceCustomNumber2, DeviceCustomNumber2Label, DeviceCustomNumber3, DeviceCustomNumber3Label, DeviceCustomString1, DeviceCustomString1Label, DeviceCustomString2, DeviceCustomString2Label, DeviceCustomString3, DeviceCustomString3Label, DeviceCustomString4, DeviceCustomString4Label, DeviceCustomString5, DeviceCustomString5Label, DeviceCustomString6, DeviceCustomString6Label\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'TrendMicroDeepSecurity')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "Trend Micro Deep Security",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Trend Micro"
        },
        "support": {
          "name": "Trend Micro",
          "tier": "Partner",
          "link": "https://success.trendmicro.com/dcx/s/?language=en_US"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Trend Micro Deep Security",
        "publisherDisplayName": "Trend Micro",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Trend%20Micro%20Deep%20Security/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.trendmicro.com/en_us/business/products/hybrid-cloud/deep-security.html\">Trend Micro Deep Security</a> solution for Microsoft Sentinel enables you to ingest Deep Security logs into Microsoft Sentinel, using the Common Event Format (CEF) for Security Monitoring.</p>\n\n<p>This solution is dependent on the Common Event Format solution containing the CEF via AMA connector to collect the logs. The CEF solution will be installed as part of this solution installation.</p>\n<p><strong>NOTE:</strong> Microsoft recommends installation of CEF via AMA Connector. Legacy connector uses the Log Analytics agent which is about to be deprecated by <strong>Aug 31, 2024,</strong> and thus should only be installed where AMA is not supported. Using MMA and AMA on same machine can cause log duplication and extra ingestion cost <a href=\"https://learn.microsoft.com/en-us/azure/sentinel/ama-migrate\">more details</a>.</p>\n<p><strong>Data Connectors:</strong> 1, <strong>Parsers:</strong> 1, <strong>Workbooks:</strong> 2</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Trend_Micro_Logo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Trend Micro Deep Security",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Trend Micro"
        },
        "support": {
          "name": "Trend Micro",
          "tier": "Partner",
          "link": "https://success.trendmicro.com/dcx/s/?language=en_US"
        },
        "dependencies": {
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId2')]",
              "version": "[variables('workbookVersion2')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "Solution",
              "contentId": "azuresentinel.azure-sentinel-solution-commoneventformat"
            }
          ]
        },
        "firstPublishDate": "2022-05-10",
        "providers": [
          "Trend Micro"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
