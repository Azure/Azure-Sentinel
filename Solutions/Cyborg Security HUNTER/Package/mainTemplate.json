{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Mike Mitchell - mike@cyborgsecurity.com",
    "comments": "Solution template for Cyborg Security HUNTER"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "mike@cyborgsecurity.com",
    "_email": "[variables('email')]",
    "_solutionName": "Cyborg Security HUNTER",
    "_solutionVersion": "3.0.0",
    "solutionId": "cyborgsecurityinc1689265652101.azure-sentinel-solution-cyborgsecurity-hunter",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "CyborgSecurity_HUNTER",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "CyborgSecurity_HUNTER",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "huntingQueryVersion1": "1.0.0",
    "huntingQuerycontentId1": "d7233f14-4705-403e-9db9-e0d677c9506b",
    "_huntingQuerycontentId1": "[variables('huntingQuerycontentId1')]",
    "huntingQueryId1": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId1'))]",
    "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId1'))))]",
    "_huntingQuerycontentProductId1": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId1'),'-', variables('huntingQueryVersion1'))))]",
    "huntingQueryVersion2": "1.0.0",
    "huntingQuerycontentId2": "6d1c9f13-e43e-4b52-a443-5799465d573b",
    "_huntingQuerycontentId2": "[variables('huntingQuerycontentId2')]",
    "huntingQueryId2": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId2'))]",
    "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId2'))))]",
    "_huntingQuerycontentProductId2": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId2'),'-', variables('huntingQueryVersion2'))))]",
    "huntingQueryVersion3": "1.0.0",
    "huntingQuerycontentId3": "4894a60b-d2ee-4f24-be61-0d0c96a84e63",
    "_huntingQuerycontentId3": "[variables('huntingQuerycontentId3')]",
    "huntingQueryId3": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId3'))]",
    "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId3'))))]",
    "_huntingQuerycontentProductId3": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId3'),'-', variables('huntingQueryVersion3'))))]",
    "huntingQueryVersion4": "1.0.0",
    "huntingQuerycontentId4": "37cba0d1-8aa5-4f8f-bb26-25a45475ca9a",
    "_huntingQuerycontentId4": "[variables('huntingQuerycontentId4')]",
    "huntingQueryId4": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId4'))]",
    "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId4'))))]",
    "_huntingQuerycontentProductId4": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId4'),'-', variables('huntingQueryVersion4'))))]",
    "huntingQueryVersion5": "1.0.0",
    "huntingQuerycontentId5": "b194088b-c846-4c72-a4b7-933627878db4",
    "_huntingQuerycontentId5": "[variables('huntingQuerycontentId5')]",
    "huntingQueryId5": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId5'))]",
    "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId5'))))]",
    "_huntingQuerycontentProductId5": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId5'),'-', variables('huntingQueryVersion5'))))]",
    "huntingQueryVersion6": "1.0.0",
    "huntingQuerycontentId6": "d2d3bbc2-6e57-4043-ab24-988a6a6c88db",
    "_huntingQuerycontentId6": "[variables('huntingQuerycontentId6')]",
    "huntingQueryId6": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId6'))]",
    "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId6'))))]",
    "_huntingQuerycontentProductId6": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId6'),'-', variables('huntingQueryVersion6'))))]",
    "huntingQueryVersion7": "1.0.0",
    "huntingQuerycontentId7": "e186a8af-3d4a-4003-93b7-9b199e0b1dd1",
    "_huntingQuerycontentId7": "[variables('huntingQuerycontentId7')]",
    "huntingQueryId7": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId7'))]",
    "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId7'))))]",
    "_huntingQuerycontentProductId7": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId7'),'-', variables('huntingQueryVersion7'))))]",
    "huntingQueryVersion8": "1.0.0",
    "huntingQuerycontentId8": "fc36d683-385a-4ec2-842d-2982dbed97a4",
    "_huntingQuerycontentId8": "[variables('huntingQuerycontentId8')]",
    "huntingQueryId8": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId8'))]",
    "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId8'))))]",
    "_huntingQuerycontentProductId8": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId8'),'-', variables('huntingQueryVersion8'))))]",
    "huntingQueryVersion9": "1.0.0",
    "huntingQuerycontentId9": "3ac1e703-3ed0-45e1-ae1d-0fa60baf99fb",
    "_huntingQuerycontentId9": "[variables('huntingQuerycontentId9')]",
    "huntingQueryId9": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId9'))]",
    "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId9'))))]",
    "_huntingQuerycontentProductId9": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId9'),'-', variables('huntingQueryVersion9'))))]",
    "huntingQueryVersion10": "1.0.0",
    "huntingQuerycontentId10": "3bc6e8ef-9e08-4626-89e9-fda87866cc82",
    "_huntingQuerycontentId10": "[variables('huntingQuerycontentId10')]",
    "huntingQueryId10": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId10'))]",
    "huntingQueryTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId10'))))]",
    "_huntingQuerycontentProductId10": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('_huntingQuerycontentId10'),'-', variables('huntingQueryVersion10'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Cyborg Security HUNTER data connector with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Cyborg Security HUNTER Hunt Packages",
                  "publisher": "Cyborg Security",
                  "descriptionMarkdown": "Cyborg Security is a leading provider of advanced threat hunting solutions, with a mission to empower organizations with cutting-edge technology and collaborative tools to proactively detect and respond to cyber threats. Cyborg Security's flagship offering, the HUNTER Platform, combines powerful analytics, curated threat hunting content, and comprehensive hunt management capabilities to create a dynamic ecosystem for effective threat hunting operations.\n\nFollow the steps to gain access to Cyborg Security's Community and setup the 'Open in Tool' capabilities in the HUNTER Platform.",
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "graphQueries": [
                    {
                      "metricName": "Total SecurityEvents received",
                      "legend": "SecurityEvent",
                      "baseQuery": "SecurityEvent"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All Alerts",
                      "query": "SecurityEvent"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "SecurityEvents",
                      "lastDataReceivedQuery": "SecurityEvent\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "SecurityEvent\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "instructions": [
                        {
                          "parameters": {
                            "text": "Use the following link to find your Azure Tentant ID <a href=\"https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/how-to-find-tenant\">How to find your Azure Active Directory tenant ID</a>",
                            "visible": true,
                            "inline": true
                          },
                          "type": "InfoMessage"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "workspaceName"
                            ],
                            "label": "ResourceGroupName & WorkspaceName",
                            "value": "{0}"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "WorkspaceID",
                            "value": "{0}"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "description": "Cyborg Security offers Community Memebers access to a subset of the Emerging Threat Collections and hunt packages.\n\nCreate a Free Commuinity Account to get access to Cyborg Security's Hunt Packages: [Sign Up Now!](https://www.cyborgsecurity.com/user-account-creation/)",
                      "title": "1. Sign up for Cyborg Security's HUNTER Community Account"
                    },
                    {
                      "description": "\n\n1.  Navigate to the [Environment](https://hunter.cyborgsecurity.io/environment) section of the HUNTER Platform.\n2.  Fill in te **Root URI** of your environment in the section labeled **Microsoft Sentinel**. Replace the <bolded items> with the IDs and Names of your Subscription, Resource Groups and Workspaces.\n\n    https[]()://portal.azure.com#@**AzureTenantID**/blade/Microsoft_OperationsManagementSuite_Workspace/Logs.ReactView/resourceId/%2Fsubscriptions%2F**AzureSubscriptionID**%2Fresourcegroups%2F**ResourceGroupName**%2Fproviders%2Fmicrosoft.operationalinsights%2Fworkspaces%2F<**WorkspaceName**>/\n3.  Click **Save**.",
                      "title": "2. Configure the Open in Tool Feature"
                    },
                    {
                      "description": "\n\nIdentify a Cyborg Security HUNTER hunt package to deploy and use the **Open In Tool** button to quickly open Microsoft Sentinel and stage the hunting content.\n\n![image](https://7924572.fs1.hubspotusercontent-na1.net/hubfs/7924572/HUNTER/Screenshots/openintool-ms-new.png)",
                      "title": "3. Execute a HUNTER hunt pacakge in Microsoft Sentinel"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "Cyborg Security HUNTER Hunt Packages",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Cyborg Security HUNTER",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Mike Mitchell",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cyborg Security",
          "email": "info@cyborgsecurity.com",
          "tier": "Partner",
          "link": "https://hunter.cyborgsecurity.io/customer-support"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Cyborg Security HUNTER Hunt Packages",
          "publisher": "Cyborg Security",
          "descriptionMarkdown": "Cyborg Security is a leading provider of advanced threat hunting solutions, with a mission to empower organizations with cutting-edge technology and collaborative tools to proactively detect and respond to cyber threats. Cyborg Security's flagship offering, the HUNTER Platform, combines powerful analytics, curated threat hunting content, and comprehensive hunt management capabilities to create a dynamic ecosystem for effective threat hunting operations.\n\nFollow the steps to gain access to Cyborg Security's Community and setup the 'Open in Tool' capabilities in the HUNTER Platform.",
          "graphQueries": [
            {
              "metricName": "Total SecurityEvents received",
              "legend": "SecurityEvent",
              "baseQuery": "SecurityEvent"
            }
          ],
          "dataTypes": [
            {
              "name": "SecurityEvents",
              "lastDataReceivedQuery": "SecurityEvent\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "SecurityEvent\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "All Alerts",
              "query": "SecurityEvent"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "instructions": [
                {
                  "parameters": {
                    "text": "Use the following link to find your Azure Tentant ID <a href=\"https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/how-to-find-tenant\">How to find your Azure Active Directory tenant ID</a>",
                    "visible": true,
                    "inline": true
                  },
                  "type": "InfoMessage"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "workspaceName"
                    ],
                    "label": "ResourceGroupName & WorkspaceName",
                    "value": "{0}"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "WorkspaceID",
                    "value": "{0}"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "description": "Cyborg Security offers Community Memebers access to a subset of the Emerging Threat Collections and hunt packages.\n\nCreate a Free Commuinity Account to get access to Cyborg Security's Hunt Packages: [Sign Up Now!](https://www.cyborgsecurity.com/user-account-creation/)",
              "title": "1. Sign up for Cyborg Security's HUNTER Community Account"
            },
            {
              "description": "\n\n1.  Navigate to the [Environment](https://hunter.cyborgsecurity.io/environment) section of the HUNTER Platform.\n2.  Fill in te **Root URI** of your environment in the section labeled **Microsoft Sentinel**. Replace the <bolded items> with the IDs and Names of your Subscription, Resource Groups and Workspaces.\n\n    https[]()://portal.azure.com#@**AzureTenantID**/blade/Microsoft_OperationsManagementSuite_Workspace/Logs.ReactView/resourceId/%2Fsubscriptions%2F**AzureSubscriptionID**%2Fresourcegroups%2F**ResourceGroupName**%2Fproviders%2Fmicrosoft.operationalinsights%2Fworkspaces%2F<**WorkspaceName**>/\n3.  Click **Save**.",
              "title": "2. Configure the Open in Tool Feature"
            },
            {
              "description": "\n\nIdentify a Cyborg Security HUNTER hunt package to deploy and use the **Open In Tool** button to quickly open Microsoft Sentinel and stage the hunting content.\n\n![image](https://7924572.fs1.hubspotusercontent-na1.net/hubfs/7924572/HUNTER/Screenshots/openintool-ms-new.png)",
              "title": "3. Execute a HUNTER hunt pacakge in Microsoft Sentinel"
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Attempted VBScript Stored in Non-Run CurrentVersion Registry Key Value_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cyborg_Security_HUNTER_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Attempted VBScript Stored in Non-Run CurrentVersion Registry Key Value",
                "category": "Hunting Queries",
                "query": "SecurityEvent\n| where ObjectName has \"\\\\CurrentVersion\"\n| where ObjectName !has \"\\\\Run\"\n| where NewValue contains \"RunHTMLApplication\" or \n  NewValue contains \"vbscript\" or \n  NewValue contains \"jscript\" or \n  NewValue contains \"mshtml\" or \n  NewValue contains \"mshtml,\" or \n  NewValue contains \"mshtml \" or \n  NewValue contains \"Execute(\" or \n  NewValue contains \"CreateObject\" or \n  NewValue contains \"RegRead\" or \n  NewValue contains \"window.close\"\n| project TimeGenerated, Computer, Process, ObjectName, ObjectValueName, NewValue, OldValue, SubjectUserName, NewProcessId, SourceComputerId\n| order by TimeGenerated\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Identify potential new registry key name that is a non-autorun and non-run key in the HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\ registry key containing VBScript in the key value value."
                  },
                  {
                    "name": "tactics",
                    "value": "DefenseEvasion"
                  },
                  {
                    "name": "techniques",
                    "value": "T1112"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId1'),'/'))))]",
              "properties": {
                "description": "Cyborg Security HUNTER Hunting Query 1",
                "parentId": "[variables('huntingQueryId1')]",
                "contentId": "[variables('_huntingQuerycontentId1')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId1')]",
        "contentKind": "HuntingQuery",
        "displayName": "Attempted VBScript Stored in Non-Run CurrentVersion Registry Key Value",
        "contentProductId": "[variables('_huntingQuerycontentProductId1')]",
        "id": "[variables('_huntingQuerycontentProductId1')]",
        "version": "[variables('huntingQueryVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Excessive Windows Discovery and Execution Processes - Potential Malware Installation_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cyborg_Security_HUNTER_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Excessive Windows Discovery and Execution Processes - Potential Malware Installation",
                "category": "Hunting Queries",
                "query": "SecurityEvent\n| where NewProcessName has_any (\n  \"arp.exe\",\n  \"at.exe\",\n  \"attrib.exe\",\n  \"cscript.exe\",\n  \"dsquery.exe\",\n  \"hostname.exe\",\n  \"ipconfig.exe\",\n  \"mimikatz.exe\",\n  \"nbtstat.exe\",\n  \"net.exe\",\n  \"netsh.exe\",\n  \"nslookup.exe\",\n  \"ping.exe\",\n  \"quser.exe\",\n  \"qwinsta.exe\",\n  \"reg.exe\",\n  \"runas.exe\",\n  \"sc.exe\",\n  \"schtasks.exe\",\n  \"ssh.exe\",\n  \"systeminfo.exe\",\n  \"taskkill.exe\",\n  \"telnet.exe\",\n  \"tracert.exe\",\n  \"wscript.exe\",\n  \"xcopy.exe\",\n  \"pscp.exe\",\n  \"copy.exe\",\n  \"robocopy.exe\",\n  \"certutil.exe\",\n  \"vssadmin.exe\",\n  \"powershell.exe\",\n  \"wevtutil.exe\",\n  \"psexec.exe\",\n  \"bcedit.exe\",\n  \"wbadmin.exe\",\n  \"icacls.exe\",\n  \"diskpart.exe\",\n  \"ver.exe\",\n  \"netstat.exe\",\n  \"tasklist.exe\",\n  \"route.exe\",\n  \"driverquery.exe\"\n)\n| summarize firstEvent=min(TimeGenerated), lastEvent=max(TimeGenerated), uniqueProcesses=dcount(NewProcessName), eventIds=make_set(tostring(EventID)), processPaths=make_set(NewProcessName), processCommandLines=make_set(CommandLine), parentProcessPaths=make_set(ParentProcessName), processIds=make_set(NewProcessId), parentprocessIds=make_set(ProcessId), eventData=make_set(EventData), count() by SourceComputerId, Computer| order by firstEvent\n| where uniqueProcesses > 4\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Utilizes a list of commonly abused LOLB an attacker or malware would execute in quick succession. The presence of multiple executions of the programs within the list can be indicative of an infection or malicious activity occurring on a victim host."
                  },
                  {
                    "name": "tactics",
                    "value": "Discovery"
                  },
                  {
                    "name": "techniques",
                    "value": "T1016"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId2'),'/'))))]",
              "properties": {
                "description": "Cyborg Security HUNTER Hunting Query 2",
                "parentId": "[variables('huntingQueryId2')]",
                "contentId": "[variables('_huntingQuerycontentId2')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId2')]",
        "contentKind": "HuntingQuery",
        "displayName": "Excessive Windows Discovery and Execution Processes - Potential Malware Installation",
        "contentProductId": "[variables('_huntingQuerycontentProductId2')]",
        "id": "[variables('_huntingQuerycontentProductId2')]",
        "version": "[variables('huntingQueryVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LSASS Memory Dumping using WerFault.exe - Command Identification_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cyborg_Security_HUNTER_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "LSASS Memory Dumping using WerFault.exe - Command Identification",
                "category": "Hunting Queries",
                "query": "SecurityEvent\n| where NewProcessName endswith \"werfault.exe\"\n| where ObjectName endswith \"lsass.exe\"\n| project NewProcessName, ObjectName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Identifies WerFault.exe creating a memory dump of lsass.exe (Local Security Authority Subsystem Service, a process responsible for the enforcement of security policies on Windows systems, which generates and stores credentials in its process memory)."
                  },
                  {
                    "name": "tactics",
                    "value": "CredentialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1003"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId3'),'/'))))]",
              "properties": {
                "description": "Cyborg Security HUNTER Hunting Query 3",
                "parentId": "[variables('huntingQueryId3')]",
                "contentId": "[variables('_huntingQuerycontentId3')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId3')]",
        "contentKind": "HuntingQuery",
        "displayName": "LSASS Memory Dumping using WerFault.exe - Command Identification",
        "contentProductId": "[variables('_huntingQuerycontentProductId3')]",
        "id": "[variables('_huntingQuerycontentProductId3')]",
        "version": "[variables('huntingQueryVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Metasploit Impacket PsExec Process Creation Activity_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cyborg_Security_HUNTER_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Metasploit / Impacket PsExec Process Creation Activity",
                "category": "Hunting Queries",
                "query": "SecurityEvent\n| where ParentProcessName has \"services.exe\"\n| where NewProcessName matches regex \"C:\\\\\\\\Windows\\\\\\\\[a-zA-Z]{8}.exe\"\n| where EventID == \"4688\"\n| project EventID, NewProcessName, CommandLine, Computer, ParentProcessName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Meant to detect process creations containing names consistent with the schema used by Metasploit or Impacket's PsExec tool. Metasploit and Impacket's PsExec tooling is used by malicious actors for lateral movement & performing actions on remote systems."
                  },
                  {
                    "name": "tactics",
                    "value": "Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1569.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId4'),'/'))))]",
              "properties": {
                "description": "Cyborg Security HUNTER Hunting Query 4",
                "parentId": "[variables('huntingQueryId4')]",
                "contentId": "[variables('_huntingQuerycontentId4')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId4')]",
        "contentKind": "HuntingQuery",
        "displayName": "Metasploit / Impacket PsExec Process Creation Activity",
        "contentProductId": "[variables('_huntingQuerycontentProductId4')]",
        "id": "[variables('_huntingQuerycontentProductId4')]",
        "version": "[variables('huntingQueryVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Potential Maldoc Execution Chain Observed_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cyborg_Security_HUNTER_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Potential Maldoc Execution Chain Observed",
                "category": "Hunting Queries",
                "query": "let officeProducts = dynamic([\"WINWORD.EXE\",\"EXCEL.EXE\",\"POWERPNT.EXE\",\"MSACCESS.EXE\",\"VISIO.EXE\",\"WINPROJ.EXE\"]);\nlet executionMethods = dynamic([\"powershell.exe\",\"cmd.exe\",\"WScript.exe\",\"rundll32.exe\",\"cscript.exe\",\"wmic.exe\",\"mshta.exe\",\"msiexec.exe\"]);\nSecurityEvent\n| where TimeGenerated >= ago(7d)\n| where (NewProcessName has_any (officeProducts,\"OUTLOOK.EXE\",\"explorer.exe\",executionMethods) or ParentProcessName has_any (officeProducts,\"OUTLOOK\",\"explorer\",executionMethods))\n| project TimeGenerated, Computer, Activity, EventID, CommandLine, NewProcessName, processId = tolong(NewProcessId), ParentProcessName, parentProcessId = tolong(ProcessId)\n| extend sourceAppTrue=case(NewProcessName endswith \"outlook.exe\",1,\n                            (ParentProcessName has_any(\"outlook.exe\",\"explorer.exe\") and NewProcessName has_any(officeProducts)),1,\n                            0)\n| extend officeAppTrue=case(NewProcessName has_any(officeProducts),1,\n                            ParentProcessName has_any(officeProducts),1,\n                            0)\n| extend executionTrue=case(NewProcessName has_any(executionMethods),1,\n                            ParentProcessName has_any(executionMethods),1,\n                            0)\n| summarize process=make_set(NewProcessName,10), processId=make_set(processId,10), parentProcess=make_set(ParentProcessName,10),parentProcessId=make_set(parentProcessId,10), sourceApp=sum(sourceAppTrue), officeApp=sum(officeAppTrue), execution=sum(executionTrue)\nby Computer, bin(TimeGenerated,5m)\n| where sourceApp > 0 and officeApp > 0 and execution > 0\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Detect the aftermath of a successfully delivered and executed maldoc (Microsoft Office). Indicates an Office document was opened from an email or download/link, spawned a suspicious execution, and attempted to execute code via common Windows binaries."
                  },
                  {
                    "name": "tactics",
                    "value": "DefenseEvasion,Execution,InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1059,T1059.001,T1059.004,T1059.005,T1059.006,T1059.007,T1218.011,T1566.001,T1566.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId5'),'/'))))]",
              "properties": {
                "description": "Cyborg Security HUNTER Hunting Query 5",
                "parentId": "[variables('huntingQueryId5')]",
                "contentId": "[variables('_huntingQuerycontentId5')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId5')]",
        "contentKind": "HuntingQuery",
        "displayName": "Potential Maldoc Execution Chain Observed",
        "contentProductId": "[variables('_huntingQuerycontentProductId5')]",
        "id": "[variables('_huntingQuerycontentProductId5')]",
        "version": "[variables('huntingQueryVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Powershell Encoded Command Execution_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cyborg_Security_HUNTER_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Powershell Encoded Command Execution",
                "category": "Hunting Queries",
                "query": "SecurityEvent\n| where TimeGenerated >= ago(7d)\n| project TimeGenerated, Computer, Activity, EventID, CommandLine, NewProcessName, processId = tolong(NewProcessId), ParentProcessName, parentProcessId = tolong(ProcessId)\n| where NewProcessName endswith \"powershell.exe\"\n| where CommandLine matches regex \"-[Ee^]{1,2}[NnCcOoDdEeMmAaPpHh^`]+\\\\s+\\\"?[a-zA-Z0-9+/=]{6,}\"\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Looks for valid variations of the -EncodedCommand parameter. Commonly used to encode or obfuscate commands, and not all occurrences are malicious."
                  },
                  {
                    "name": "tactics",
                    "value": "DefenseEvasion,Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1027,T1059.001"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId6'),'/'))))]",
              "properties": {
                "description": "Cyborg Security HUNTER Hunting Query 6",
                "parentId": "[variables('huntingQueryId6')]",
                "contentId": "[variables('_huntingQuerycontentId6')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId6')]",
        "contentKind": "HuntingQuery",
        "displayName": "Powershell Encoded Command Execution",
        "contentProductId": "[variables('_huntingQuerycontentProductId6')]",
        "id": "[variables('_huntingQuerycontentProductId6')]",
        "version": "[variables('huntingQueryVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PowerShell Pastebin Download_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cyborg_Security_HUNTER_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "PowerShell Pastebin Download",
                "category": "Hunting Queries",
                "query": "SecurityEvent\n| where Process  has \"powershell.exe\"\n| where CommandLine contains \"http\"\n| where CommandLine has_any (\n  \"pastebin\",\n  \"github\",\n  \"ghostbin\",\n  \"githubusercontent\",\n  \"0bin\",\n  \"zerobin\",\n  \"privatebin\",\n  \"klgrth\",\n  \"termbin\",\n  \"hatebin\",\n  \"hastebin\",\n  \"dumpz\"\n) or  CommandLine contains \".onion\" or CommandLine contains \"paste.\"\n| project TimeGenerated, Computer, tostring(EventID), ParentProcessName, NewProcessName, CommandLine, SubjectUserName, SourceComputerId, processID=tolong(NewProcessId), parentProcessID=tolong(ProcessId), EventData| order by TimeGenerated\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Detects PowerShell commands downloading and execute code hosted on Pastebin and other services. This technique has been used by malicious actors to distribute malware, in particular it has been used by the EvilCorp Ransomware variants such as Sodinokibi."
                  },
                  {
                    "name": "tactics",
                    "value": "CommandandControl"
                  },
                  {
                    "name": "techniques",
                    "value": "T1102"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId7'),'/'))))]",
              "properties": {
                "description": "Cyborg Security HUNTER Hunting Query 7",
                "parentId": "[variables('huntingQueryId7')]",
                "contentId": "[variables('_huntingQuerycontentId7')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId7')]",
        "contentKind": "HuntingQuery",
        "displayName": "PowerShell Pastebin Download",
        "contentProductId": "[variables('_huntingQuerycontentProductId7')]",
        "id": "[variables('_huntingQuerycontentProductId7')]",
        "version": "[variables('huntingQueryVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Prohibited Applications Spawning cmd.exe or powershell.exe_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cyborg_Security_HUNTER_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Prohibited Applications Spawning cmd.exe or powershell.exe",
                "category": "Hunting Queries",
                "query": "let StartDate = ago(1d);\nSecurityEvent\n| where TimeGenerated > StartDate\n| where NewProcessName has_any (\n  \"winword.exe\",\n  \"EXCEL.EXE\",\n  \"OUTLOOK.EXE\",\n  \"POWERPNT.EXE\",\n  \"visio.exe\",\n  \"mspub.exe\",\n  \"Acrobat.exe\",\n  \"Acrord32.exe\",\n  \"chrome.exe\",\n  \"iexplore.exe\",\n  \"opera.exe\",\n  \"firefox.exe\",\n  \"mshta.exe\",\n  \"zoom.exe\",\n  \"utilman.exe\"\n)\n| where NewProcessName has_any (\n  \"cmd.exe\",\n  \"powershell.exe\"\n)\n| project TimeGenerated, Computer, tostring(EventID), ParentProcessName, NewProcessName, CommandLine, SubjectUserName, SourceComputerId, processID=tolong(NewProcessId), parentProcessID=tolong(ProcessId), EventData| order by TimeGenerated\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  },
                  {
                    "name": "tactics",
                    "value": "CommandandControl"
                  },
                  {
                    "name": "techniques",
                    "value": "T1102"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId8'),'/'))))]",
              "properties": {
                "description": "Cyborg Security HUNTER Hunting Query 8",
                "parentId": "[variables('huntingQueryId8')]",
                "contentId": "[variables('_huntingQuerycontentId8')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId8')]",
        "contentKind": "HuntingQuery",
        "displayName": "Prohibited Applications Spawning cmd.exe or powershell.exe",
        "contentProductId": "[variables('_huntingQuerycontentProductId8')]",
        "id": "[variables('_huntingQuerycontentProductId8')]",
        "version": "[variables('huntingQueryVersion8')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Proxy VBScript Execution via CurrentVersion Registry Key_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cyborg_Security_HUNTER_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Proxy VBScript Execution via CurrentVersion Registry Key",
                "category": "Hunting Queries",
                "query": "SecurityEvent\n| where Process  has_any (\"cmd.exe\", \"powershell.exe\", \"rundll32.exe\", \"AppData\") \nand CommandLine contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\"\nand CommandLine has_all (\"Execute\",\"CreateObject\", \"RegRead\")\nor CommandLine has_all (\"vbscript\" ,\"\\\\..\\\\mshtml\" , \"RunHTMLApplication\")\n| project TimeGenerated, Computer, tostring(EventID), ParentProcessName, NewProcessName, CommandLine, SubjectUserName, SourceComputerId, processID=tolong(NewProcessId), parentProcessID=tolong(ProcessId), EventData| order by TimeGenerated\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Identifies VBScript proxy execution through a registry key in \\Microsoft\\Windows\\CurrentVersion."
                  },
                  {
                    "name": "tactics",
                    "value": "DefenseEvasion,Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1059.005,T1218.005"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId9'),'/'))))]",
              "properties": {
                "description": "Cyborg Security HUNTER Hunting Query 9",
                "parentId": "[variables('huntingQueryId9')]",
                "contentId": "[variables('_huntingQuerycontentId9')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId9')]",
        "contentKind": "HuntingQuery",
        "displayName": "Proxy VBScript Execution via CurrentVersion Registry Key",
        "contentProductId": "[variables('_huntingQuerycontentProductId9')]",
        "id": "[variables('_huntingQuerycontentProductId9')]",
        "version": "[variables('huntingQueryVersion9')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Rundll32 or cmd Executing Application from Explorer - Potential Malware Execution Chain_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cyborg_Security_HUNTER_Hunting_Query_10",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Rundll32 or cmd Executing Application from Explorer - Potential Malware Execution Chain",
                "category": "Hunting Queries",
                "query": "SecurityEvent\n| where ParentProcessName has \"explorer.exe\" \n| where Process has_any (\n  \"wscript.exe\",\n  \"rundll32.exe\",\n  \"explorer.exe\",\n  \"cmd.exe\"\n  )\n| where (CommandLine has_any (\n  \"explorer\",\n  \"rundll32\"\n  ) and CommandLine has_any (\n  \".dll,\",\n  \".dll \"\n  )) or (CommandLine has \"cmd.exe\" and CommandLine matches regex \"\\\\/[Cc] +[Ss][Tt][Aa][Rr][Tt].*\\\\.exe\")\n| project TimeGenerated, Computer, tostring(EventID), ParentProcessName, NewProcessName, CommandLine, SubjectUserName, SourceComputerId, processID=tolong(NewProcessId), parentProcessID=tolong(ProcessId), EventData| order by TimeGenerated\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Identifies when rundll32 or cmd.exe is utilized to launch a malicious DLL or executable from explorer.exe. Indicative of a cmd window or LNK file executing a program or malware due to a user clicking on a file."
                  },
                  {
                    "name": "tactics",
                    "value": "Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1204.002"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId10'),'/'))))]",
              "properties": {
                "description": "Cyborg Security HUNTER Hunting Query 10",
                "parentId": "[variables('huntingQueryId10')]",
                "contentId": "[variables('_huntingQuerycontentId10')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyborg Security HUNTER",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Mike Mitchell",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyborg Security",
                  "email": "info@cyborgsecurity.com",
                  "tier": "Partner",
                  "link": "https://hunter.cyborgsecurity.io/customer-support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_huntingQuerycontentId10')]",
        "contentKind": "HuntingQuery",
        "displayName": "Rundll32 or cmd Executing Application from Explorer - Potential Malware Execution Chain",
        "contentProductId": "[variables('_huntingQuerycontentProductId10')]",
        "id": "[variables('_huntingQuerycontentProductId10')]",
        "version": "[variables('huntingQueryVersion10')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Cyborg Security HUNTER",
        "publisherDisplayName": "Cyborg Security",
        "descriptionHtml": "<p><strong>Note:</strong> <em>There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</em></p>\n<p>The <a href=\"https://www.cyborgsecurity.com/\">Cyborg Security HUNTER</a> solution for Microsoft Sentinel helps analysts to configure the 'Open in Tool' button within the HUNTER platform, allowing the Microsoft Sentinel hunt packages to be deployed in the Microsoft Sentinel Platform</p>\n<p><strong>Data Connectors:</strong> 1, <strong>Hunting Queries:</strong> 10</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/cyborgsecurity-logo-75px.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Cyborg Security HUNTER",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Mike Mitchell",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cyborg Security",
          "email": "info@cyborgsecurity.com",
          "tier": "Partner",
          "link": "https://hunter.cyborgsecurity.io/customer-support"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId1')]",
              "version": "[variables('huntingQueryVersion1')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId2')]",
              "version": "[variables('huntingQueryVersion2')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId3')]",
              "version": "[variables('huntingQueryVersion3')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId4')]",
              "version": "[variables('huntingQueryVersion4')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId5')]",
              "version": "[variables('huntingQueryVersion5')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId6')]",
              "version": "[variables('huntingQueryVersion6')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId7')]",
              "version": "[variables('huntingQueryVersion7')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId8')]",
              "version": "[variables('huntingQueryVersion8')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId9')]",
              "version": "[variables('huntingQueryVersion9')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId10')]",
              "version": "[variables('huntingQueryVersion10')]"
            }
          ]
        },
        "firstPublishDate": "2023-07-03",
        "lastPublishDate": "2023-09-22",
        "providers": [
          "Cyborg Security HUNTER"
        ],
        "categories": {
          "domains": [
            "Security - Network",
            "Security - Automation (SOAR)",
            "Security - Threat Protection",
            "Security - Threat Intelligence"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
