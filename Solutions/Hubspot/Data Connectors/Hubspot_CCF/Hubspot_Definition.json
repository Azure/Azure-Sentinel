{
  "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
  "apiVersion": "2022-09-01-preview",
  "name": "HubspotDefinition",
  "location": "{{location}}",
  "kind": "Customizable",
  "properties": {
    "connectorUiConfig": {
      "id": "HubspotDefinition",
      "title": "Hubspot",
      "publisher": "Community",
      "descriptionMarkdown": "The unofficial [HubSpot](https://www.hubspot.com/) solution provides the capability to ingest [Hubspot account activity](https://developers.hubspot.com/docs/api-reference/account-audit-logs-v3/guide) into Microsoft Sentinel.",
      "graphQueriesTableName": "HubspotAuditLogs_CL",
      "graphQueries": [
        {
          "metricName": "Total events received",
          "legend": "Audit events",
          "baseQuery": "{{graphQueriesTableName}}"
        },
        {
          "metricName": "Total events received",
          "legend": "Security events",
          "baseQuery": "HubspotSecurityActivity_CL"
        }
      ],
      "sampleQueries": [
        {
          "description": "Get Sample Events",
          "query": "{{graphQueriesTableName}}\n | take 10"
        }
      ],
      "dataTypes": [
        {
          "name": "{{graphQueriesTableName}}",
          "lastDataReceivedQuery": "{{graphQueriesTableName}}\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        },
        {
          "name": "HubspotSecurityActivity_CL",
          "lastDataReceivedQuery": "HubspotSecurityActivity_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        }
      ],
      "connectivityCriteria": [
        {
          "type": "HasDataConnectors"
        }
      ],
      "availability": {
        "isPreview": false
      },
      "permissions": {
        "resourceProvider": [
          {
            "provider": "Microsoft.OperationalInsights/workspaces",
            "permissionsDisplayText": "Read and Write permissions are required.",
            "providerDisplayName": "Workspace",
            "scope": "Workspace",
            "requiredPermissions": {
              "read": true,
              "write": true,
              "delete": true,
              "action": false
            }
          }
        ],
        "customs": [
          {
            "name": "Hubspot account-info.security.read API scope",
            "description": "https://developers.hubspot.com/docs/api-reference/account-audit-logs-v3/guide#scope-requirements"
          }
        ]
      },
      "instructionSteps": [
        {
          "description": "Connect using Hubspot Private App. Learn more: https://developers.hubspot.com/docs/apps/legacy-apps/private-apps/overview#create-a-private-app",
          "instructions": [
            {
              "type": "Textbox",
              "parameters": {
                "label": "Access token",
                "placeholder": "Enter access token",
                "type": "password",
                "name": "apikey",
                "validations": {
                  "required": true
                }
              }
            },
            {
              "type": "ConnectionToggleButton",
              "parameters": {
                "connectLabel": "Connect",
                "name": "Connect"
              }
            }
          ],
          "title": "Connect Hubspot to Microsoft Sentinel"
        }
      ]
    }
  }
}