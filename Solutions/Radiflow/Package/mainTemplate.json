{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Radiflow - support@radiflow.com",
    "comments": "Solution template for Radiflow"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@radiflow.com",
    "_email": "[variables('email')]",
    "_solutionName": "Radiflow",
    "_solutionVersion": "3.0.1",
    "solutionId": "radiflow.azure-sentinel-solution-radiflow",
    "_solutionId": "[variables('solutionId')]",
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','RadiflowEvent')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'RadiflowEvent')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('RadiflowEvent-Parser')))]",
      "parserVersion1": "1.0.0",
      "parserContentId1": "RadiflowEvent-Parser"
    },
    "uiConfigId1": "RadiflowIsid",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "RadiflowIsid",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "6c028ebd-03ca-41cb-bce7-5727ddb43731",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6c028ebd-03ca-41cb-bce7-5727ddb43731')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6c028ebd-03ca-41cb-bce7-5727ddb43731')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6c028ebd-03ca-41cb-bce7-5727ddb43731','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "cde00cc5-5841-4aa9-96c5-dd836f9e3f26",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'cde00cc5-5841-4aa9-96c5-dd836f9e3f26')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('cde00cc5-5841-4aa9-96c5-dd836f9e3f26')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','cde00cc5-5841-4aa9-96c5-dd836f9e3f26','-', '1.0.0')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "8177ecff-30a1-4d4f-9a82-7fbb69019504",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '8177ecff-30a1-4d4f-9a82-7fbb69019504')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('8177ecff-30a1-4d4f-9a82-7fbb69019504')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','8177ecff-30a1-4d4f-9a82-7fbb69019504','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "ff0c781a-b30f-4acf-9cf1-75d7383d66d1",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'ff0c781a-b30f-4acf-9cf1-75d7383d66d1')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('ff0c781a-b30f-4acf-9cf1-75d7383d66d1')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','ff0c781a-b30f-4acf-9cf1-75d7383d66d1','-', '1.0.0')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.0",
      "_analyticRulecontentId5": "a3f4cc3e-2403-4570-8d21-1dedd5632958",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'a3f4cc3e-2403-4570-8d21-1dedd5632958')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('a3f4cc3e-2403-4570-8d21-1dedd5632958')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','a3f4cc3e-2403-4570-8d21-1dedd5632958','-', '1.0.0')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.0",
      "_analyticRulecontentId6": "ecac26b8-147d-478a-9d50-99be4bf14019",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'ecac26b8-147d-478a-9d50-99be4bf14019')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('ecac26b8-147d-478a-9d50-99be4bf14019')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','ecac26b8-147d-478a-9d50-99be4bf14019','-', '1.0.0')))]"
    },
    "analyticRuleObject7": {
      "analyticRuleVersion7": "1.0.0",
      "_analyticRulecontentId7": "4d90d485-6d47-417e-80ea-9cf956c1a671",
      "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4d90d485-6d47-417e-80ea-9cf956c1a671')]",
      "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4d90d485-6d47-417e-80ea-9cf956c1a671')))]",
      "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','4d90d485-6d47-417e-80ea-9cf956c1a671','-', '1.0.0')))]"
    },
    "analyticRuleObject8": {
      "analyticRuleVersion8": "1.0.0",
      "_analyticRulecontentId8": "cc33e1a9-e167-460b-93e6-f14af652dbd3",
      "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'cc33e1a9-e167-460b-93e6-f14af652dbd3')]",
      "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('cc33e1a9-e167-460b-93e6-f14af652dbd3')))]",
      "_analyticRulecontentProductId8": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','cc33e1a9-e167-460b-93e6-f14af652dbd3','-', '1.0.0')))]"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RadiflowEvent Data Parser with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for RadiflowEvent",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "RadiflowEvent",
                "query": "CommonSecurityLog\n| where DeviceVendor =~ 'radiflow'\n| extend EventType = 0\n| extend EventVendor = 'Radiflow'\n| extend SchemaVersion = 1.0\n| parse-kv AdditionalExtensions as\n  (\n    id: long\n    , pt: string\n    , PtName: string\n    , SrcName: string\n    , DstName: string\n    , SrcMac: string\n    , DstMac: string\n    , SrcVendor: string\n    , DstVendor: string\n    , SrcType: string\n    , DstType: string\n    , SrcVlan: string\n  ) with (pair_delimiter=';', kv_delimiter='=')\n| extend DestinationHostName = iif(DstName matches regex @\"^[A-Za-z0-9 \\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\{\\}\\[\\]\\:\\;\\<\\>\\,\\?\\_\\+\\-\\=\\~\\`\\'\\|\\/]{1,15}$\", DstName, \"\")\n| extend DestinationMACAddress = DstMac\n| extend EventTime = TimeGenerated\n| extend Protocol = PtName\n| extend SourceHostName = iif(SrcName matches regex @\"^[A-Za-z0-9 \\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\{\\}\\[\\]\\:\\;\\<\\>\\,\\?\\_\\+\\-\\=\\~\\`\\'\\|\\/]{1,15}$\", SrcName, \"\")\n| extend SourceIP = coalesce(DeviceAddress, SourceIP)\n| extend SourceMACAddress = trim(@\"#012[\\s]+\", SrcMac)\n| project-rename\n    DestinationType = DstType\n    , DestinationVendor = DstVendor\n    , EventID = id\n    , EventCategory = DeviceEventCategory\n    , EventClassID = DeviceEventClassID\n    , EventCollectorHostName = CollectorHostName\n    , EventMessage = Activity\n    , EventServer = Computer\n    , EventSeverity = LogSeverity\n    , Port = pt\n    , SourceType = SrcType\n    , SourceVendor = SrcVendor\n    , SourceVLAN = SrcVlan\n| project-keep\n    TimeGenerated\n    , EventCategory\n    , EventClassID\n    , EventCollectorHostName\n    , EventID\n    , EventMessage\n    , EventServer\n    , EventSeverity\n    , EventTime\n    , EventType\n    , SchemaVersion\n    , DeviceProduct\n    , DeviceVendor\n    , DeviceVersion\n    , Port\n    , Protocol\n    , SourceHostName\n    , SourceIP\n    , SourceMACAddress\n    , SourceType\n    , SourceVendor\n    , SourceVLAN\n    , DestinationHostName\n    , DestinationIP\n    , DestinationMACAddress\n    , DestinationType\n    , DestinationVendor\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'RadiflowEvent')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "Radiflow",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Radiflow",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Radiflow",
                  "email": "support@radiflow.com",
                  "tier": "Partner",
                  "link": "https://www.radiflow.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "Parser for RadiflowEvent",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for RadiflowEvent",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "RadiflowEvent",
        "query": "CommonSecurityLog\n| where DeviceVendor =~ 'radiflow'\n| extend EventType = 0\n| extend EventVendor = 'Radiflow'\n| extend SchemaVersion = 1.0\n| parse-kv AdditionalExtensions as\n  (\n    id: long\n    , pt: string\n    , PtName: string\n    , SrcName: string\n    , DstName: string\n    , SrcMac: string\n    , DstMac: string\n    , SrcVendor: string\n    , DstVendor: string\n    , SrcType: string\n    , DstType: string\n    , SrcVlan: string\n  ) with (pair_delimiter=';', kv_delimiter='=')\n| extend DestinationHostName = iif(DstName matches regex @\"^[A-Za-z0-9 \\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\{\\}\\[\\]\\:\\;\\<\\>\\,\\?\\_\\+\\-\\=\\~\\`\\'\\|\\/]{1,15}$\", DstName, \"\")\n| extend DestinationMACAddress = DstMac\n| extend EventTime = TimeGenerated\n| extend Protocol = PtName\n| extend SourceHostName = iif(SrcName matches regex @\"^[A-Za-z0-9 \\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\{\\}\\[\\]\\:\\;\\<\\>\\,\\?\\_\\+\\-\\=\\~\\`\\'\\|\\/]{1,15}$\", SrcName, \"\")\n| extend SourceIP = coalesce(DeviceAddress, SourceIP)\n| extend SourceMACAddress = trim(@\"#012[\\s]+\", SrcMac)\n| project-rename\n    DestinationType = DstType\n    , DestinationVendor = DstVendor\n    , EventID = id\n    , EventCategory = DeviceEventCategory\n    , EventClassID = DeviceEventClassID\n    , EventCollectorHostName = CollectorHostName\n    , EventMessage = Activity\n    , EventServer = Computer\n    , EventSeverity = LogSeverity\n    , Port = pt\n    , SourceType = SrcType\n    , SourceVendor = SrcVendor\n    , SourceVLAN = SrcVlan\n| project-keep\n    TimeGenerated\n    , EventCategory\n    , EventClassID\n    , EventCollectorHostName\n    , EventID\n    , EventMessage\n    , EventServer\n    , EventSeverity\n    , EventTime\n    , EventType\n    , SchemaVersion\n    , DeviceProduct\n    , DeviceVendor\n    , DeviceVersion\n    , Port\n    , Protocol\n    , SourceHostName\n    , SourceIP\n    , SourceMACAddress\n    , SourceType\n    , SourceVendor\n    , SourceVLAN\n    , DestinationHostName\n    , DestinationIP\n    , DestinationMACAddress\n    , DestinationType\n    , DestinationVendor\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'RadiflowEvent')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "Radiflow",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Radiflow",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Radiflow",
          "email": "support@radiflow.com",
          "tier": "Partner",
          "link": "https://www.radiflow.com"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Radiflow data connector with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Radiflow iSID via AMA",
                  "publisher": "Radiflow",
                  "descriptionMarkdown": "iSID enables non-disruptive monitoring of distributed ICS networks for changes in topology and behavior, using multiple security packages, each offering a unique capability pertaining to a specific type of network activity",
                  "additionalRequirementBanner": "This data connector depends on a parser based on Kusto Function to work as expected [**RadiflowEvent**] which is deployed with the Microsoft Sentinel Solution.",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "RadiflowEvent",
                      "baseQuery": "RadiflowEvent\n| where DeviceProduct =~ \"iSID\""
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Top 5 protocols by number of events",
                      "query": "RadiflowEvent\n| where DeviceProduct =~ \"iSID\"\n| where isnotempty(Protocol)\n| summarize count() by Port, Protocol\n| project-keep count_, Port, Protocol\n| top 5 by Protocol"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "CommonSecurityLog (RadiflowEvent)",
                      "lastDataReceivedQuery": "CommonSecurityLog\n| where DeviceProduct =~ \"iSID\"\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "RadiflowEvent\n| where DeviceProduct =~ \"iSID\"\n| summarize LastLogReceived = max(TimeGenerated)\n| project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**RadiflowEvent**] which is deployed with the Microsoft Sentinel Solution.",
                      "instructions": [
                        {
                          "parameters": {
                            "title": "1. Kindly follow the steps to configure the data connector",
                            "instructionSteps": [
                              {
                                "title": "Step A. Configure the Common Event Format (CEF) via AMA data connector",
                                "description": "_Note:- CEF logs are collected only from Linux Agents_\n\n1. Navigate to Microsoft Sentinel workspace ---> configuration ---> Data connector blade.\n\n2. Search for 'Common Event Format (CEF) via AMA' data connector and open it.\n\n3. Check If there is no existing DCR configured to collect required facility of logs, Create a new DCR (Data Collection Rule).\n\n\t_Note:- It is recommended to install minimum 1.27 version of AMA agent [Learn more](https://learn.microsoft.com/azure/azure-monitor/agents/azure-monitor-agent-manage?tabs=azure-portal ) and ensure there is no duplicate DCR as it can cause log duplicacy._\n\n4. Run the command provided in the CEF via AMA data connector page to configure the CEF collector on the machine."
                              },
                              {
                                "title": "Step B. Configure iSID to send logs using CEF",
                                "description": "Configure log forwarding using CEF:\n\n1. Navigate to the **System Notifications** section of the Configuration menu.\n\n2. Under Syslog, select **+Add**.\n\n3. In the **New Syslog Server** dialog specify the name, remote server **IP**, **Port**, **Transport** and select **Format** - **CEF**.\n\n4. Press **Apply** to exit the **Add Syslog dialog**."
                              },
                              {
                                "title": "Step C. Validate connection",
                                "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\nIt may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n 1. Make sure that you have Python on your machine using the following command: python --version\n\n2. You must have elevated permissions (sudo) on your machine",
                                "instructions": [
                                  {
                                    "parameters": {
                                      "label": "Run the following command to validate your connectivity:",
                                      "value": "sudo wget -O Sentinel_AMA_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/Syslog/Sentinel_AMA_troubleshoot.py&&sudo python Sentinel_AMA_troubleshoot.py --cef"
                                    },
                                    "type": "CopyableLabel"
                                  }
                                ]
                              }
                            ]
                          },
                          "type": "InstructionStepsGroup"
                        }
                      ]
                    },
                    {
                      "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
                      "title": "2. Secure your machine "
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Radiflow",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Radiflow",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Radiflow",
                  "email": "support@radiflow.com",
                  "tier": "Partner",
                  "link": "https://www.radiflow.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "Radiflow iSID via AMA",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Radiflow",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Radiflow",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Radiflow",
          "email": "support@radiflow.com",
          "tier": "Partner",
          "link": "https://www.radiflow.com"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Radiflow iSID via AMA",
          "publisher": "Radiflow",
          "descriptionMarkdown": "iSID enables non-disruptive monitoring of distributed ICS networks for changes in topology and behavior, using multiple security packages, each offering a unique capability pertaining to a specific type of network activity",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "RadiflowEvent",
              "baseQuery": "RadiflowEvent\n| where DeviceProduct =~ \"iSID\""
            }
          ],
          "dataTypes": [
            {
              "name": "CommonSecurityLog (RadiflowEvent)",
              "lastDataReceivedQuery": "CommonSecurityLog\n| where DeviceProduct =~ \"iSID\"\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "RadiflowEvent\n| where DeviceProduct =~ \"iSID\"\n| summarize LastLogReceived = max(TimeGenerated)\n| project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Top 5 protocols by number of events",
              "query": "RadiflowEvent\n| where DeviceProduct =~ \"iSID\"\n| where isnotempty(Protocol)\n| summarize count() by Port, Protocol\n| project-keep count_, Port, Protocol\n| top 5 by Protocol"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**RadiflowEvent**] which is deployed with the Microsoft Sentinel Solution.",
              "instructions": [
                {
                  "parameters": {
                    "title": "1. Kindly follow the steps to configure the data connector",
                    "instructionSteps": [
                      {
                        "title": "Step A. Configure the Common Event Format (CEF) via AMA data connector",
                        "description": "_Note:- CEF logs are collected only from Linux Agents_\n\n1. Navigate to Microsoft Sentinel workspace ---> configuration ---> Data connector blade.\n\n2. Search for 'Common Event Format (CEF) via AMA' data connector and open it.\n\n3. Check If there is no existing DCR configured to collect required facility of logs, Create a new DCR (Data Collection Rule).\n\n\t_Note:- It is recommended to install minimum 1.27 version of AMA agent [Learn more](https://learn.microsoft.com/azure/azure-monitor/agents/azure-monitor-agent-manage?tabs=azure-portal ) and ensure there is no duplicate DCR as it can cause log duplicacy._\n\n4. Run the command provided in the CEF via AMA data connector page to configure the CEF collector on the machine."
                      },
                      {
                        "title": "Step B. Configure iSID to send logs using CEF",
                        "description": "Configure log forwarding using CEF:\n\n1. Navigate to the **System Notifications** section of the Configuration menu.\n\n2. Under Syslog, select **+Add**.\n\n3. In the **New Syslog Server** dialog specify the name, remote server **IP**, **Port**, **Transport** and select **Format** - **CEF**.\n\n4. Press **Apply** to exit the **Add Syslog dialog**."
                      },
                      {
                        "title": "Step C. Validate connection",
                        "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\nIt may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n 1. Make sure that you have Python on your machine using the following command: python --version\n\n2. You must have elevated permissions (sudo) on your machine",
                        "instructions": [
                          {
                            "parameters": {
                              "label": "Run the following command to validate your connectivity:",
                              "value": "sudo wget -O Sentinel_AMA_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/Syslog/Sentinel_AMA_troubleshoot.py&&sudo python Sentinel_AMA_troubleshoot.py --cef"
                            },
                            "type": "CopyableLabel"
                          }
                        ]
                      }
                    ]
                  },
                  "type": "InstructionStepsGroup"
                }
              ]
            },
            {
              "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
              "title": "2. Secure your machine "
            }
          ],
          "id": "[variables('_uiConfigId1')]",
          "additionalRequirementBanner": "This data connector depends on a parser based on Kusto Function to work as expected [**RadiflowEvent**] which is deployed with the Microsoft Sentinel Solution."
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RadiflowExploitDetected_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Generates an incident when the use of an exploit is detected by Radiflow's iSID.",
                "displayName": "Radiflow - Exploit Detected",
                "enabled": false,
                "query": "RadiflowEvent\n| where DeviceProduct =~ 'iSID'\n| where\n    (\n        EventClassID in (34, 53, 67, 68, 69, 70, 71, 179)\n        or EventMessage has 'Exploit'\n    )\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "RadiflowEvent"
                    ],
                    "connectorId": "RadiflowIsid"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "PrivilegeEscalation",
                  "LateralMovement"
                ],
                "techniques": [
                  "T0819",
                  "T0866",
                  "T0890"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "SourceHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationIP",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SourceVLAN": "SourceVLAN",
                  "DestinationMAC": "DestinationMACAddress",
                  "SourceType": "SourceType",
                  "DestinationHostName": "DestinationHostName",
                  "SourceMAC": "SourceMACAddress",
                  "SourceHostName": "SourceHostName",
                  "DestinationIP": "DestinationIP",
                  "Protocol": "Protocol",
                  "SourceVendor": "SourceVendor",
                  "SourceIP": "SourceIP",
                  "DestinationVendor": "DestinationVendor",
                  "DestinationType": "DestinationType",
                  "Port": "Port"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDisplayNameFormat": "Exploit Detected: {{EventMessage}}",
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "A possible exploit attempt has been detected. Check the details of this incident for further information.\n\nMessage: {{EventMessage}}\nSource device: {{SourceIP}} \nDestination device (if any): {{DestinationIP}} "
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "1h"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "Radiflow Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Radiflow",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Radiflow",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Radiflow",
                  "email": "support@radiflow.com",
                  "tier": "Partner",
                  "link": "https://www.radiflow.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Radiflow - Exploit Detected",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RadiflowNetworkScanningDetected_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Generates an incident when a network scan is detected either by Radiflow's iSID.",
                "displayName": "Radiflow - Network Scanning Detected",
                "enabled": false,
                "query": "RadiflowEvent\n| where DeviceProduct =~ 'iSID'\n| where\n    (\n        EventClassID in (52, 105, 150, 151, 152, 153, 158, 166, 175)\n        or EventMessage has 'Scan'\n    )\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "RadiflowEvent"
                    ],
                    "connectorId": "RadiflowIsid"
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "techniques": [
                  "T0840",
                  "T0846",
                  "T0888"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "SourceHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationIP",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SourceVLAN": "SourceVLAN",
                  "DestinationMAC": "DestinationMACAddress",
                  "SourceType": "SourceType",
                  "DestinationHostName": "DestinationHostName",
                  "SourceMAC": "SourceMACAddress",
                  "SourceHostName": "SourceHostName",
                  "DestinationIP": "DestinationIP",
                  "Protocol": "Protocol",
                  "SourceVendor": "SourceVendor",
                  "SourceIP": "SourceIP",
                  "DestinationVendor": "DestinationVendor",
                  "DestinationType": "DestinationType",
                  "Port": "Port"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDisplayNameFormat": "Network Scanning Detected: {{EventMessage}}",
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "A suspicious network scan activity has been detected in the network. Please check the the alert details for further information.\n\nMessage: {{EventMessage}}\nSource device: {{SourceIP}}\nDestination device (if any): {{DestinationIP}} "
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "1h"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "Radiflow Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "Radiflow",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Radiflow",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Radiflow",
                  "email": "support@radiflow.com",
                  "tier": "Partner",
                  "link": "https://www.radiflow.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "Radiflow - Network Scanning Detected",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RadiflowNewActivityDetected_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Generates an incident when a new asset or MAC is detected either by Radiflow's iSID.",
                "displayName": "Radiflow - New Activity Detected",
                "enabled": false,
                "query": "RadiflowEvent\n| where DeviceProduct =~ 'iSID'\n| where EventClassID in (1, 2, 3, 155)\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "RadiflowEvent"
                    ],
                    "connectorId": "RadiflowIsid"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133",
                  "T0848"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "SourceHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationIP",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SourceVLAN": "SourceVLAN",
                  "DestinationMAC": "DestinationMACAddress",
                  "SourceType": "SourceType",
                  "DestinationHostName": "DestinationHostName",
                  "SourceMAC": "SourceMACAddress",
                  "SourceHostName": "SourceHostName",
                  "DestinationIP": "DestinationIP",
                  "Protocol": "Protocol",
                  "SourceVendor": "SourceVendor",
                  "SourceIP": "SourceIP",
                  "DestinationVendor": "DestinationVendor",
                  "DestinationType": "DestinationType",
                  "Port": "Port"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDisplayNameFormat": "New Activity Detected (MAC: {{SourceMACAddress}} - IP: {{SourceIP}})",
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "A previously undetected asset, link or entity has been detected in the network. Please check whether the activity is legitimate."
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "1h"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "Radiflow Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "Radiflow",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Radiflow",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Radiflow",
                  "email": "support@radiflow.com",
                  "tier": "Partner",
                  "link": "https://www.radiflow.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "Radiflow - New Activity Detected",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RadiflowPlatformAlert_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Generates an incident when an alert raised by Radiflow's iSID is not contemplated by any of the other analytic rules",
                "displayName": "Radiflow - Platform Alert",
                "enabled": false,
                "query": "RadiflowEvent\n| where DeviceProduct =~ 'iSID'\n| where EventClassID !in ('User Activity', 100, 200, 300, 15500, 500, 15600, 16100, 16900, 17100, 18200, 18300, 18400, 18500, 5200, 10500, 15000, 15100, 15200, 15300, 15800, 16600, 17500, 11400, 11500, 11600, 11700, 11800, 11900, 16200, 5500, 14700, 19300, 19400, 2200, 2300, 2400, 2500, 2600, 2700, 14500, 3400, 5300, 6700, 6800, 6900, 7000, 7100, 17900, 5700, 5800, 5800, 6000, 17600, 17800, 18100)\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "RadiflowEvent"
                    ],
                    "connectorId": "RadiflowIsid"
                  }
                ],
                "tactics": [
                  "PrivilegeEscalation",
                  "Execution",
                  "CommandAndControl",
                  "Exfiltration",
                  "LateralMovement",
                  "ImpairProcessControl",
                  "InhibitResponseFunction",
                  "InitialAccess"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "SourceHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationIP",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SourceVLAN": "SourceVLAN",
                  "DestinationMAC": "DestinationMACAddress",
                  "SourceType": "SourceType",
                  "DestinationHostName": "DestinationHostName",
                  "SourceMAC": "SourceMACAddress",
                  "SourceHostName": "SourceHostName",
                  "DestinationIP": "DestinationIP",
                  "Protocol": "Protocol",
                  "SourceVendor": "SourceVendor",
                  "SourceIP": "SourceIP",
                  "DestinationVendor": "DestinationVendor",
                  "DestinationType": "DestinationType",
                  "Port": "Port"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDisplayNameFormat": "Radiflow Platform Alert",
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "Suspicious activity has been detected by Radiflow's iSID. Please check the following details for more information.\\n\\nMessage: {{EventMessage}} \\nSourceIP: {{SourceIP}} \\nDestination IP (if any): {{DestinationIP}}\n"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "1h"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "Radiflow Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "Radiflow",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Radiflow",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Radiflow",
                  "email": "support@radiflow.com",
                  "tier": "Partner",
                  "link": "https://www.radiflow.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "Radiflow - Platform Alert",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RadiflowPolicyViolationDetected_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Generates an incident when an unauthorized session or action is detected either by Radiflow's iSID.",
                "displayName": "Radiflow - Policy Violation Detected",
                "enabled": false,
                "query": "RadiflowEvent\n| where DeviceProduct =~ 'iSID'\n| where EventClassID in (5, 156, 161, 169, 171, 182, 183, 184, 185)\n| extend EventMessage = iif(EventMessage == ' ', 'Policy Violation', EventMessage)\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "RadiflowEvent"
                    ],
                    "connectorId": "RadiflowIsid"
                  }
                ],
                "tactics": [
                  "LateralMovement",
                  "ImpairProcessControl",
                  "Execution",
                  "Collection",
                  "Persistence"
                ],
                "techniques": [
                  "T0886",
                  "T0855",
                  "T0858",
                  "T0845",
                  "T0889",
                  "T0843"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "NetBiosName"
                      },
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "NetBiosName"
                      },
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "HostName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationIP",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SourceVLAN": "SourceVLAN",
                  "DestinationMAC": "DestinationMACAddress",
                  "SourceType": "SourceType",
                  "DestinationHostName": "DestinationHostName",
                  "SourceMAC": "SourceMACAddress",
                  "SourceHostName": "SourceHostName",
                  "DestinationIP": "DestinationIP",
                  "Protocol": "Protocol",
                  "SourceVendor": "SourceVendor",
                  "SourceIP": "SourceIP",
                  "DestinationVendor": "DestinationVendor",
                  "DestinationType": "DestinationType",
                  "Port": "Port"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDisplayNameFormat": "Policy Violation Detected",
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "Recent activity which violates the security policy has been detected in the network. Please check the details for additional information."
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "1h"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "Radiflow Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "Radiflow",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Radiflow",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Radiflow",
                  "email": "support@radiflow.com",
                  "tier": "Partner",
                  "link": "https://www.radiflow.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "Radiflow - Policy Violation Detected",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RadiflowSuspiciousMaliciousActivityDetected_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Generates an incident when malware is detected by Radiflow's iSID.",
                "displayName": "Radiflow - Suspicious Malicious Activity Detected",
                "enabled": false,
                "query": "RadiflowEvent\n| where DeviceProduct =~ 'iSID'\n| where EventClassID in (57, 58, 59, 60, 176, 178, 181)\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "RadiflowEvent"
                    ],
                    "connectorId": "RadiflowIsid"
                  }
                ],
                "tactics": [
                  "DefenseEvasion",
                  "InhibitResponseFunction"
                ],
                "techniques": [
                  "T0851"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "SourceHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationIP",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SourceVLAN": "SourceVLAN",
                  "DestinationMAC": "DestinationMACAddress",
                  "SourceType": "SourceType",
                  "DestinationHostName": "DestinationHostName",
                  "SourceMAC": "SourceMACAddress",
                  "SourceHostName": "SourceHostName",
                  "DestinationIP": "DestinationIP",
                  "Protocol": "Protocol",
                  "SourceVendor": "SourceVendor",
                  "SourceIP": "SourceIP",
                  "DestinationVendor": "DestinationVendor",
                  "DestinationType": "DestinationType",
                  "Port": "Port"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDisplayNameFormat": "Suspicious Malicious Activity Detected: {{EventMessage}}",
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "A possible malware has been detected in the network as specified in the details of the incident. Please verify the source of this activity.\n\nMessage: {{EventMessage}}\nSource device: {{{SourceIP}} \nDestination device (if any): {{DestinationIP}}"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "1h"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "Radiflow Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "Radiflow",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Radiflow",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Radiflow",
                  "email": "support@radiflow.com",
                  "tier": "Partner",
                  "link": "https://www.radiflow.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "Radiflow - Suspicious Malicious Activity Detected",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject7').analyticRuleTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RadiflowUnauthorizedCommandInOperationalDevice_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject7').analyticRuleVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Generates an incident when an unauthorized command is detected in the network by Radiflow's iSID.",
                "displayName": "Radiflow - Unauthorized Command in Operational Device",
                "enabled": false,
                "query": "RadiflowEvent\n| where DeviceProduct =~ 'iSID'\n| where \n    (\n        EventClassID in (114, 115, 116, 117, 118, 119, 162)\n        or EventMessage has 'Unauthorized'\n    )\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "RadiflowEvent"
                    ],
                    "connectorId": "RadiflowIsid"
                  }
                ],
                "tactics": [
                  "Execution",
                  "LateralMovement",
                  "InhibitResponseFunction",
                  "ImpairProcessControl"
                ],
                "techniques": [
                  "T0858",
                  "T0843",
                  "T0816",
                  "T0857",
                  "T0836",
                  "T0855"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "SourceHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationIP",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SourceVLAN": "SourceVLAN",
                  "DestinationMAC": "DestinationMACAddress",
                  "SourceType": "SourceType",
                  "DestinationHostName": "DestinationHostName",
                  "SourceMAC": "SourceMACAddress",
                  "SourceHostName": "SourceHostName",
                  "DestinationIP": "DestinationIP",
                  "Protocol": "Protocol",
                  "SourceVendor": "SourceVendor",
                  "SourceIP": "SourceIP",
                  "DestinationVendor": "DestinationVendor",
                  "DestinationType": "DestinationType",
                  "Port": "Port"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDisplayNameFormat": "Unauthorized Command in Operational Device",
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "An unauthorized command has been detected. Please check the alert details for further information.\n\nMessage: {{EventMessage}}\nSource device: {{SourceIP}} \nDestination device (if any): {{DestinationIP}} "
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "1h"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject7').analyticRuleId7,'/'))))]",
              "properties": {
                "description": "Radiflow Analytics Rule 7",
                "parentId": "[variables('analyticRuleObject7').analyticRuleId7]",
                "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject7').analyticRuleVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "Radiflow",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Radiflow",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Radiflow",
                  "email": "support@radiflow.com",
                  "tier": "Partner",
                  "link": "https://www.radiflow.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
        "contentKind": "AnalyticsRule",
        "displayName": "Radiflow - Unauthorized Command in Operational Device",
        "contentProductId": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "id": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject8').analyticRuleTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RadiflowUnauthorizedInternetAccess_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject8').analyticRuleVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Generates an incident when an unauthorized link between the network and the Internet is detected by Radiflow's iSID.",
                "displayName": "Radiflow - Unauthorized Internet Access",
                "enabled": false,
                "query": "RadiflowEvent\n| where DeviceProduct =~ 'iSID'\n| where EventClassID in (55, 147, 193, 194)\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "RadiflowEvent"
                    ],
                    "connectorId": "RadiflowIsid"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Impact"
                ],
                "techniques": [
                  "T0822",
                  "T0883",
                  "T0882"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "SourceHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DestinationHostName",
                        "identifier": "NetBiosName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "DestinationIP",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SourceVLAN": "SourceVLAN",
                  "DestinationMAC": "DestinationMACAddress",
                  "SourceType": "SourceType",
                  "DestinationHostName": "DestinationHostName",
                  "SourceMAC": "SourceMACAddress",
                  "SourceHostName": "SourceHostName",
                  "DestinationIP": "DestinationIP",
                  "Protocol": "Protocol",
                  "SourceVendor": "SourceVendor",
                  "SourceIP": "SourceIP",
                  "DestinationVendor": "DestinationVendor",
                  "DestinationType": "DestinationType",
                  "Port": "Port"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDisplayNameFormat": "Unauthorized Internet Access",
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "An external connection to the network has been detected. Please check whether this activity is legitimate and the external device is authorized to connect.\n\nMessage: {{EventMessage}}\nSource device: {{SourceIP}} \nDestination device (if any): {{DestinationIP}} "
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "1h"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject8').analyticRuleId8,'/'))))]",
              "properties": {
                "description": "Radiflow Analytics Rule 8",
                "parentId": "[variables('analyticRuleObject8').analyticRuleId8]",
                "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject8').analyticRuleVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "Radiflow",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Radiflow",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Radiflow",
                  "email": "support@radiflow.com",
                  "tier": "Partner",
                  "link": "https://www.radiflow.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
        "contentKind": "AnalyticsRule",
        "displayName": "Radiflow - Unauthorized Internet Access",
        "contentProductId": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "id": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.1",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Radiflow",
        "publisherDisplayName": "Radiflow",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Radiflow/ReleaseNotes.md\">Release Notes</a></p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.radiflow.com/\">Radiflow</a> solution for Microsoft Sentinel enables ingestion of <a href=\"https://www.radiflow.com/products/ot-visibility-and-anomaly-detection/\">iSID</a> events into Microsoft Sentinel.</p>\n<ol>\n<li><strong>Radiflow iSID via AMA</strong> - This data connector helps in ingesting Radiflow logs into your Log Analytics Workspace using the new Azure Monitor Agent. Learn more about ingesting using the new Azure Monitor Agent <a href=\"https://learn.microsoft.com/azure/sentinel/connect-cef-ama\">here</a>. <strong>Microsoft recommends using this Data Connector</strong>.</li>\n</ol>\n<p><strong>Data Connectors:</strong> 1, <strong>Parsers:</strong> 1, <strong>Analytic Rules:</strong> 8</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Radiflow.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Radiflow",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Radiflow",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Radiflow",
          "email": "support@radiflow.com",
          "tier": "Partner",
          "link": "https://www.radiflow.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
            }
          ]
        },
        "firstPublishDate": "2024-06-26",
        "providers": [
          "Radiflow"
        ],
        "categories": {
          "domains": [
            "Internet of Things (IoT)",
            "Security - Others"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
