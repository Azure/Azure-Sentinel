id: 3bd4a2b3-c686-465a-b882-4d873a520ccc
Function:
  Title: Corelight Connection Events
  Version: '1.0.0'
  LastUpdated: '2025-09-23'
Category: Microsoft Sentinel Parser
FunctionName: corelight_first_seen
FunctionAlias: corelight_first_seen
FunctionQuery: |
    let dummy_table = datatable(TimeGenerated: datetime, uid_s: string) [];
    let corelight_first_seen = view () {
        union isfuzzy=true
            Corelight_v2_first_seen_CL,
            dummy_table
        | summarize arg_max(TimeGenerated, *) by uid_s
        | join kind=leftouter 
            (corelight_conn
            | project uid, local_orig, local_resp
            )
            on $left.uid_s == $right.uid
        | project-away uid
        | extend
            path = column_ifexists("_path_s", ""),
            system_name = column_ifexists("_system_name_s", ""),
            write_ts = column_ifexists("_write_ts_t", datetime(null)),
            uid = column_ifexists("uid_s", ""),
            use_case = column_ifexists("use_case_s", ""),
            use_case_description = column_ifexists("use_case_description_s", ""),
            entity = column_ifexists("entity_s", ""),
            original_entity = column_ifexists("original_entity_s", ""),
            entity_training_items = column_ifexists("entity_training_items_s", ""),
            item = column_ifexists("item_s", ""),
            first_seen_type = column_ifexists("first_seen_type_s", ""),
            history_days = column_ifexists("history_days_d", real(null)),
            history = column_ifexists("history_d", real(null)),
            ts = column_ifexists("ts_t", datetime(null))
        | extend
            EventVendor = "Corelight",
            EventProduct = "CorelightSensor",
            EventType = "first_seen"
        | extend
            is_dest_internal_ip = iff(local_resp == true, "true", "false"),
            is_src_internal_ip = iff(local_orig == true, "true", "false"),
            direction=case(local_orig == "true" and local_resp == "true", "internal", local_orig == "true" and local_resp == "false", "outbound", local_orig == "false" and local_resp == "false", "external", local_orig == "false" and local_resp == "true", "inbound", "unknown")
        | project
            TimeGenerated,
            path,
            system_name,
            write_ts,
            uid,
            use_case,
            use_case_description,
            entity,
            original_entity,
            entity_training_items,
            item,
            first_seen_type,
            history_days,
            history,
            EventVendor,
            EventProduct,
            EventType,
            ts,
            is_dest_internal_ip,
            is_src_internal_ip,
            direction
    };
    corelight_first_seen