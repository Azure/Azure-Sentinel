{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Corelight",
    "comments": "Solution template for Corelight"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Corelight",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "solutionId": "corelightinc1584998267292.corelight-for-azure-sentinel",
    "_solutionId": "[variables('solutionId')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "CorelightWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "analyticRuleVersion1": "1.0.0",
    "analyticRulecontentId1": "8eaa2268-74ee-492c-b869-450eff707fef",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1')))]",
    "analyticRuleVersion2": "1.0.0",
    "analyticRulecontentId2": "05850746-9ae4-412f-838b-844f0903f4a9",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2')))]",
    "analyticRuleVersion3": "1.0.0",
    "analyticRulecontentId3": "73f23aa2-5cc4-4507-940b-75c9092e9e01",
    "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
    "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
    "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3')))]",
    "analyticRuleVersion4": "1.0.0",
    "analyticRulecontentId4": "4e55e306-3022-43a1-870a-41c4d5116079",
    "_analyticRulecontentId4": "[variables('analyticRulecontentId4')]",
    "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId4'))]",
    "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId4')))]",
    "analyticRuleVersion5": "1.0.0",
    "analyticRulecontentId5": "7226d37b-50ee-4e3b-9f80-5b74080d8f2c",
    "_analyticRulecontentId5": "[variables('analyticRulecontentId5')]",
    "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId5'))]",
    "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId5')))]",
    "analyticRuleVersion6": "1.0.0",
    "analyticRulecontentId6": "599570d4-06f8-4939-8e29-95cd003f1abd",
    "_analyticRulecontentId6": "[variables('analyticRulecontentId6')]",
    "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId6'))]",
    "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId6')))]",
    "analyticRuleVersion7": "1.0.0",
    "analyticRulecontentId7": "f3245aa1-1ca1-471c-a0b7-97ea6b791d5d",
    "_analyticRulecontentId7": "[variables('analyticRulecontentId7')]",
    "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId7'))]",
    "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId7')))]",
    "analyticRuleVersion8": "1.0.0",
    "analyticRulecontentId8": "db662e49-6e34-4d10-9d3c-5d04b5479658",
    "_analyticRulecontentId8": "[variables('analyticRulecontentId8')]",
    "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId8'))]",
    "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId8')))]",
    "analyticRuleVersion9": "1.0.0",
    "analyticRulecontentId9": "50c61708-9824-46f3-87cf-22490796fae2",
    "_analyticRulecontentId9": "[variables('analyticRulecontentId9')]",
    "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId9'))]",
    "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId9')))]",
    "analyticRuleVersion10": "1.0.0",
    "analyticRulecontentId10": "6b579e98-abc9-4e7a-9efc-2f3408ba16c9",
    "_analyticRulecontentId10": "[variables('analyticRulecontentId10')]",
    "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId10'))]",
    "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId10')))]",
    "uiConfigId1": "Corelight",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "Corelight",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
    "dataConnectorVersion1": "1.0.0",
    "parserVersion1": "1.0.0",
    "parserContentId1": "Corelight-Parser",
    "_parserContentId1": "[variables('parserContentId1')]",
    "parserName1": "Corelight",
    "_parserName1": "[concat(parameters('workspace'),'/',variables('parserName1'))]",
    "parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
    "_parserId1": "[variables('parserId1')]",
    "parserTemplateSpecName1": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId1')))]",
    "huntingQueryVersion1": "1.0.0",
    "huntingQuerycontentId1": "e9441d57-39f4-41fb-aaad-d02e47783d1a",
    "_huntingQuerycontentId1": "[variables('huntingQuerycontentId1')]",
    "huntingQueryId1": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId1'))]",
    "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId1')))]",
    "huntingQueryVersion2": "1.0.0",
    "huntingQuerycontentId2": "f37e076e-69f6-4fcf-81dc-ca2bc5929eb5",
    "_huntingQuerycontentId2": "[variables('huntingQuerycontentId2')]",
    "huntingQueryId2": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId2'))]",
    "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId2')))]",
    "huntingQueryVersion3": "1.0.0",
    "huntingQuerycontentId3": "c5f3974b-f411-4a06-a3f8-ee14fcadd0e1",
    "_huntingQuerycontentId3": "[variables('huntingQuerycontentId3')]",
    "huntingQueryId3": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId3'))]",
    "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId3')))]",
    "huntingQueryVersion4": "1.0.0",
    "huntingQuerycontentId4": "3e42a796-9a4c-4ebf-a0e0-5282947986b5",
    "_huntingQuerycontentId4": "[variables('huntingQuerycontentId4')]",
    "huntingQueryId4": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId4'))]",
    "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId4')))]",
    "huntingQueryVersion5": "1.0.0",
    "huntingQuerycontentId5": "0c3ad86f-6b92-4ff5-8d41-86ff7e01d518",
    "_huntingQuerycontentId5": "[variables('huntingQuerycontentId5')]",
    "huntingQueryId5": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId5'))]",
    "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId5')))]",
    "huntingQueryVersion6": "1.0.0",
    "huntingQuerycontentId6": "887e648f-32d7-4803-8cd4-2ceef7995872",
    "_huntingQuerycontentId6": "[variables('huntingQuerycontentId6')]",
    "huntingQueryId6": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId6'))]",
    "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId6')))]",
    "huntingQueryVersion7": "1.0.0",
    "huntingQuerycontentId7": "69736969-6ae0-48cd-a05a-743f7372ee84",
    "_huntingQuerycontentId7": "[variables('huntingQuerycontentId7')]",
    "huntingQueryId7": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId7'))]",
    "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId7')))]",
    "huntingQueryVersion8": "1.0.0",
    "huntingQuerycontentId8": "a518ea0c-f87a-4a79-8f45-2b5b6f44bd7f",
    "_huntingQuerycontentId8": "[variables('huntingQuerycontentId8')]",
    "huntingQueryId8": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId8'))]",
    "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId8')))]",
    "huntingQueryVersion9": "1.0.0",
    "huntingQuerycontentId9": "9aab6aac-6dad-4749-b8cf-46840b6d978f",
    "_huntingQuerycontentId9": "[variables('huntingQuerycontentId9')]",
    "huntingQueryId9": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId9'))]",
    "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId9')))]",
    "huntingQueryVersion10": "1.0.0",
    "huntingQuerycontentId10": "1ea3a384-77a4-4b0d-8e42-74d26b38ab5b",
    "_huntingQuerycontentId10": "[variables('huntingQuerycontentId10')]",
    "huntingQueryId10": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId10'))]",
    "huntingQueryTemplateSpecName10": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId10')))]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "properties": {
        "description": "Corelight Workbook with template",
        "displayName": "Corelight workbook template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('workbookTemplateSpecName1'),'/',variables('workbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "CorelightWorkbook Workbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Sets the time name for analysis"
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\">**NOTE:** This workbook depends on a parser based on a Kusto Function to work as expected [**Corelight**](https://aka.ms/sentinel-Corelight-parser) which is deployed with the Microsoft Sentinel Solution.\"},\"name\":\"text - 23\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"d723eef6-b3f0-40be-9a56-125421b32619\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Corelight Main Dashboard\",\"subTarget\":\"corelight_main_dashboard\",\"style\":\"link\"},{\"id\":\"5736d4f4-bd4c-4a49-bea7-00da2bbc7fd9\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Corelight Connections\",\"subTarget\":\"corelight_connections\",\"style\":\"link\"},{\"id\":\"5336f601-4da3-4da0-8196-332a97636047\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Corelight DNS\",\"subTarget\":\"corelight_dns\",\"style\":\"link\"},{\"id\":\"5c26ac35-85e3-4f48-8673-f80d30314d1a\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Corelight Files\",\"subTarget\":\"corelight_files\",\"style\":\"link\"},{\"id\":\"14595b52-fcaa-402c-9a39-3d236b2aeba9\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Corelight Software\",\"subTarget\":\"corelight_software\",\"style\":\"link\"}]},\"name\":\"links - 24\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"c64d5d3d-90c6-484a-ab88-c70652b75b6e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":300000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated {TimeRange}\\n|make-series Trend = count() on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by EventType;\",\"size\":0,\"title\":\"Sensor Events Timechart\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_main_dashboard\"},\"customWidth\":\"50\",\"name\":\"Sensor Events Timechart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated {TimeRange}\\n| summarize Count=count() by EventType | sort by Count desc\",\"size\":0,\"title\":\"Sensor Events Count\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_main_dashboard\"},\"customWidth\":\"50\",\"name\":\"Sensor Events Count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"conn\\\"\\n| where isnotempty(Service)\\n| summarize count() by tostring(Service) | take 10\",\"size\":3,\"title\":\"Top Services\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"showMetrics\":false,\"showLegend\":true,\"ySettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_connections\"},\"customWidth\":\"50\",\"name\":\"Top Services\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"conn\\\"\\n| where isnotempty(DstPort)\\n| extend dstprt = tostring(DstPort)\\n| summarize Count=count() by dstprt | sort by Count desc |take 10\",\"size\":3,\"title\":\"Top Responder Ports\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"showMetrics\":false,\"showLegend\":true,\"ySettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_connections\"},\"customWidth\":\"50\",\"name\":\"Top Responder Ports\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"conn\\\"\\n| extend NetworkDirection = case(LocalOrig == true,\\\"outbound\\\", LocalOrig == false, \\\"inbound\\\",'')\\n| where NetworkDirection == \\\"outbound\\\"\\n| where isnotempty(SrcIpAddr) and isnotempty(DstIpAddr) and isnotempty(SrcIpBytes) and isnotempty(DstIpBytes)\\n| extend bytes = toint(SrcIpBytes) + toint(DstIpBytes)\\n| summarize Bytes=sum(bytes) by SrcIpAddr, DstIpAddr, NetworkProtocol | sort by Bytes desc | take 15\",\"size\":0,\"title\":\"Top Outbound Data Flows by Originator Bytes\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_connections\"},\"customWidth\":\"50\",\"name\":\"Top Outbound Data Flows by Originator Bytes\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"conn\\\"\\n| extend NetworkDirection = case(LocalOrig == true,\\\"outbound\\\", LocalOrig == false, \\\"inbound\\\",'')\\n| where NetworkDirection == \\\"inbound\\\"\\n| where isnotempty(SrcIpAddr) and isnotempty(DstIpAddr) and isnotempty(SrcIpBytes) and isnotempty(DstIpBytes)\\n| extend bytes = toint(SrcIpBytes) + toint(DstIpBytes)\\n| summarize Bytes=sum(bytes) by SrcIpAddr, DstIpAddr, NetworkProtocol | sort by Bytes desc | take 15\",\"size\":0,\"title\":\"Top Inbound Data Flows by Originator Bytes\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_connections\"},\"customWidth\":\"50\",\"name\":\"Top Inbound Data Flows by Originator Bytes - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where EventType startswith \\\"conn\\\"\\n| where TimeGenerated  {TimeRange} \\n| summarize Count=count() by SrcIpAddr | sort by Count\",\"size\":3,\"title\":\"Top Originators (sources) by # of connections\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_connections\"},\"customWidth\":\"50\",\"name\":\"Top Originators (sources) by # of connections\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where EventType startswith \\\"conn\\\"\\n| where TimeGenerated  {TimeRange} \\n| summarize Count=count() by DstIpAddr | sort by Count\",\"size\":3,\"title\":\"Top Responders (destinations) by # of connections\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_connections\"},\"customWidth\":\"50\",\"name\":\"Top Responders (destinations) by # of connections - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where EventType startswith \\\"conn\\\"\\n| where TimeGenerated  {TimeRange}\\n| where isnotempty(SrcIpAddr) and isnotempty(DstIpAddr) and isnotempty(Service) and isnotempty(DstPort) and isnotempty(SrcPort)\\n| summarize duration=avg(toint(Duration)), make_list(SrcIpAddr), make_list(DstIpAddr), make_list(NetworkProtocol) by EventUid | sort by duration desc | take 50\",\"size\":0,\"title\":\"Open/Active Long Lived Connections (requires Long Connections Pkg)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"duration\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"duration\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_connections\"},\"name\":\"Open/Active Long Lived Connections (requires Long Connections Pkg)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"dns\\\"\\n| where isnotempty(DnsQueryTypeName)\\n| where DstPort ==\\\"53\\\" | summarize count() by DnsQueryTypeName\",\"size\":3,\"title\":\"Top Query Types\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_dns\"},\"customWidth\":\"33\",\"name\":\"Top Query Types\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"dns\\\"\\n| where isnotempty(DnsQueryName)\\n| summarize Count=count() by DnsQueryName | sort by Count desc | take 10\\n| join kind = inner (Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"dns\\\"\\n| where isnotempty(DnsQueryName)\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DnsQueryName)\\n on DnsQueryName\",\"size\":0,\"title\":\"Top 10 Queries by Count\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Trend\",\"formatter\":10,\"formatOptions\":{\"palette\":\"blueDark\"}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":5}]}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_dns\"},\"customWidth\":\"33\",\"name\":\"Top 10 Queries by Count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"dns\\\"\\n| where DnsResponseCodeName ==\\\"NXDOMAIN\\\" and DnsQueryTypeName !=\\\"PTR\\\" and DstPort ==\\\"53\\\"\\n| summarize Count=count() by DnsQueryName | sort by Count desc | take 10\\n| join kind = inner (Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"dns\\\"\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DnsQueryName)\\n on DnsQueryName\",\"size\":0,\"title\":\"Top 10 Queries by Count to Non-Existent Domains\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DnsQueryName1\",\"formatter\":5},{\"columnMatch\":\"Trend\",\"formatter\":10,\"formatOptions\":{\"palette\":\"blueDark\"}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":5}]}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_dns\"},\"customWidth\":\"33\",\"name\":\"Top 10 Queries by Count to Non-Existent Domains\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where EventType startswith \\\"dns\\\"\\n| where TimeGenerated  {TimeRange}\\n| where DstPort == \\\"53\\\" and isnotempty(DnsQueryTypeName)\\n| summarize Count=count() by SrcIpAddr | sort by Count | take 10\",\"size\":0,\"title\":\"Top Originators by Count\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_dns\"},\"customWidth\":\"33\",\"name\":\"Top Originators by Count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"dns\\\"\\n| where DnsResponseCodeName ==\\\"NOERROR\\\" and DnsQueryTypeName ==\\\"PTR\\\" and DstPort ==\\\"53\\\"\\n| where DstPort == \\\"53\\\" and isnotempty(DnsQueryTypeName)\\n| summarize Count=count() by DnsQueryName | sort by Count | take 10\",\"size\":0,\"title\":\"Top Successful Reverse Queries by Count\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_dns\"},\"customWidth\":\"33\",\"name\":\"Top Successful Reverse Queries by Count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"dns\\\"\\n| where DnsResponseCodeName ==\\\"NXDOMAIN\\\" and DnsQueryTypeName == \\\"PTR\\\" and DstPort == \\\"53\\\"\\n| summarize Count=count() by DnsQueryName | sort by Count | take 10\",\"size\":0,\"title\":\"Top Reverse Queries by Count to Non-Existent Domains\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_dns\"},\"customWidth\":\"33\",\"name\":\"Top Reverse Queries by Count to Non-Existent Domains\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"files\\\"\\n| where isnotempty(MimeType)\\n| where MimeType != \\\"application/pkix-cert\\\"\\n| summarize Count=count() by MimeType | sort by Count desc | take 20\",\"size\":0,\"title\":\"Top 20 Mime Types by File Count\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_files\"},\"name\":\"Top 20 Mime Types by File Count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"files\\\"\\n| where isnotempty(MimeType)\\n| where MimeType != \\\"application/pkix-cert\\\"\\n| summarize [\\\"File Count\\\"]=count() by Source | sort by [\\\"File Count\\\"] desc | take 15\",\"size\":0,\"title\":\"Top File Protocols by File Count\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_files\"},\"name\":\"Top File Protocols by File Count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where EventType startswith \\\"files\\\"\\n| where isnotempty(MimeType)\\n| where MimeType != \\\"application/pkix-cert\\\"\\n| extend NetworkDirection = case(LocalOrig == \\\"true\\\", \\\"outbound\\\", LocalOrig == \\\"false\\\", \\\"inbound\\\", \\\"\\\" )\\n|make-series [\\\"Files Sent\\\"]=countif(NetworkDirection==\\\"outbound\\\"), [\\\"Files Received\\\"]=countif(NetworkDirection==\\\"inbound\\\") on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by EventType | project [\\\"Files Sent\\\"], [\\\"Files Received\\\"], TimeGenerated;\",\"size\":0,\"title\":\"File Flow - # of Files\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_files\"},\"customWidth\":\"50\",\"name\":\"File Flow - # of Files\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where EventType startswith \\\"files\\\"\\n| where isnotempty(MimeType)\\n| where MimeType != \\\"application/pkix-cert\\\"\\n| extend NetworkDirection = case(LocalOrig == \\\"true\\\", \\\"outbound\\\", LocalOrig == \\\"false\\\", \\\"inbound\\\", \\\"\\\" )\\n|make-series [\\\"Bytes Sent\\\"]=sumif(toint(ZeekFilesSeenBytes), NetworkDirection==\\\"outbound\\\" ), [\\\"Bytes Received\\\"]=sumif(toint(ZeekFilesSeenBytes),NetworkDirection==\\\"inbound\\\") on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by EventType;\",\"size\":0,\"title\":\"File Flow - Bytes\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_files\"},\"customWidth\":\"50\",\"name\":\"File Flow - Bytes\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where EventType startswith \\\"software\\\"\\n| where TimeGenerated  {TimeRange}\\n| where isnotempty(SoftwareType)\\n| summarize Count=count() by Name | sort by Count | take 20\",\"size\":0,\"title\":\"Top Software\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_software\"},\"name\":\"Top Software\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where TimeGenerated  {TimeRange}\\n| where EventType startswith \\\"software\\\"\\n| where isnotempty(SoftwareType)\\n| summarize Count=count() by Name, UnparsedVersion | sort by Count \",\"size\":0,\"title\":\"Top Software Versions\",\"timeContext\":{\"durationMs\":43200000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Name\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Name\"],\"expandTopLevel\":true}}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_software\"},\"customWidth\":\"50\",\"name\":\"Top Software Versions\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Corelight\\n| where EventType startswith \\\"software\\\"\\n| where isnotempty(SoftwareType)\\n| summarize Count=count() by SoftwareType | sort by Count \",\"size\":0,\"title\":\"Top Software Types\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Name\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Name\"],\"expandTopLevel\":true}}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"corelight_software\"},\"customWidth\":\"50\",\"name\":\"Top Software Types\"}],\"fromTemplateId\":\"sentinel-CorelightWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=CorelightWorkbook; logoFileName=corelight.svg; description=Sets the time name for analysis; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Corelight; templateRelativePath=Corelight.json; subtitle=; provider=Corelight}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "Corelight_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Corelight",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Corelight Analytics Rule 1 with template",
        "displayName": "Corelight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName1'),'/',variables('analyticRuleVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "CorelightC2RepetitiveFailures_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects large amounts of DNS resolution failures.",
                "displayName": "Corelight - C2 DGA Detected Via Repetitive Failures",
                "enabled": false,
                "query": "let threshold = 25;\nCorelight\n| where EventType =~ 'dns'\n| where DnsResponseCodeName in~ ('NXDOMAIN', 'SERVFAIL')\n| summarize count() by DnsQueryName, SrcIpAddr, bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "Corelight",
                    "dataTypes": [
                      "Corelight"
                    ]
                  }
                ],
                "tactics": [
                  "CommandAndControl"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "Corelight Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Corelight Analytics Rule 2 with template",
        "displayName": "Corelight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName2'),'/',variables('analyticRuleVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "CorelightExternalProxyDetected_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects external proxy usage.",
                "displayName": "Corelight - External Proxy Detected",
                "enabled": false,
                "query": "Corelight\n| where EventType =~ 'http'\n| where isnotempty(HttpProxiedHeaders)\n| where ipv4_is_private(SrcIpAddr) == 'False'\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "Corelight",
                    "dataTypes": [
                      "Corelight"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion",
                  "CommandAndControl"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "Corelight Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Corelight Analytics Rule 3 with template",
        "displayName": "Corelight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName3'),'/',variables('analyticRuleVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "CorelightForcedExternalOutboundSMB_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId3')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects SMB requests that originate internally and communicate with an external IP address.",
                "displayName": "Corelight - Forced External Outbound SMB",
                "enabled": false,
                "query": "Corelight\n| where EventType =~ 'conn'\n| where ZeekConnLocalSrc == 'True'\n| where ZeekConnLocalDst == 'False'\n| where NetworkConnectionHistory hasprefix 'Sh' and NetworkApplication hasprefix 'smb'\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "Corelight",
                    "dataTypes": [
                      "Corelight"
                    ]
                  }
                ],
                "tactics": [
                  "CredentialAccess"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
              "properties": {
                "description": "Corelight Analytics Rule 3",
                "parentId": "[variables('analyticRuleId3')]",
                "contentId": "[variables('_analyticRulecontentId3')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Corelight Analytics Rule 4 with template",
        "displayName": "Corelight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName4'),'/',variables('analyticRuleVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "CorelightMultipleCompressedFilesTransferredOverHTTP_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId4')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects compressed archives transferre over HTTP.",
                "displayName": "Corelight - Multiple Compressed Files Transferred over HTTP",
                "enabled": false,
                "query": "let threshold = 25;\nCorelight\n| where EventType =~ 'http'\n| where HttpRequestMethod in~ ('POST', 'PUT')\n| where isempty(HttpReferrerOriginal)\n| where SrcMimeType in~ ('application/vnd.ms-cab-compressed', 'application/warc', 'application/x-7z-compressed', 'application/x-ace', 'application/x-arc', 'application/x-archive', 'application/x-arj', 'application/x-compress', 'application/x-cpio', 'application/x-dmg', 'application/x-eet', 'application/x-gzip', 'application/x-lha', 'application/x-lrzip', 'application/x-lz4', 'application/x-lzma', 'application/x-lzh', 'application/x-lzip', 'application/x-rar', 'application/x-rpm', 'application/x-stuffit', 'application/x-tar', 'application/x-xz', 'application/x-zoo', 'application/zip')\n| summarize count() by UrlOriginal, SrcIpAddr, bin(TimeGenerated, 15m)\n| where count_ > threshold\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "Corelight",
                    "dataTypes": [
                      "Corelight"
                    ]
                  }
                ],
                "tactics": [
                  "Exfiltration"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId4'),'/'))))]",
              "properties": {
                "description": "Corelight Analytics Rule 4",
                "parentId": "[variables('analyticRuleId4')]",
                "contentId": "[variables('_analyticRulecontentId4')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Corelight Analytics Rule 5 with template",
        "displayName": "Corelight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName5'),'/',variables('analyticRuleVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "CorelightMultipleFilesSentOverHTTPAbnormalRequests_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId5')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects sources sending multiple compressed files greater than 10MBs sent over HTTP in a short amount of time.",
                "displayName": "Corelight - Multiple files sent over HTTP with abnormal requests",
                "enabled": false,
                "query": "let threshold = 25;\nlet fl_size_threshold = 10000000;\nCorelight\n| where EventType =~ 'http'\n| where HttpRequestMethod in~ ('POST', 'PUT')\n| where isempty(HttpReferrerOriginal)\n| where tolong(HttpRequestBodyBytes) > fl_size_threshold\n| summarize count() by UrlOriginal, SrcIpAddr, bin(TimeGenerated, 15m)\n| where count_ > threshold\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "Corelight",
                    "dataTypes": [
                      "Corelight"
                    ]
                  }
                ],
                "tactics": [
                  "Exfiltration"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId5'),'/'))))]",
              "properties": {
                "description": "Corelight Analytics Rule 5",
                "parentId": "[variables('analyticRuleId5')]",
                "contentId": "[variables('_analyticRulecontentId5')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Corelight Analytics Rule 6 with template",
        "displayName": "Corelight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName6'),'/',variables('analyticRuleVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "CorelightNetworkServiceScanning_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId6')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identify scanning of services that may be available on the internal network.",
                "displayName": "Corelight - Network Service Scanning Multiple IP Addresses",
                "enabled": false,
                "query": "let threshold = 25;\nCorelight\n| where EventType =~ 'conn'\n| where ZeekConnLocalSrc == 'True'\n| where ZeekConnLocalDst == 'True'\n| where NetworkConnectionState in~ ('S0', 'REJ')\n| where NetworkConnectionHistory !contains 'D'\n| summarize count() by SrcIpAddr, DstPort, bin(TimeGenerated, 1m)\n| where count_ > threshold\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "Corelight",
                    "dataTypes": [
                      "Corelight"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId6'),'/'))))]",
              "properties": {
                "description": "Corelight Analytics Rule 6",
                "parentId": "[variables('analyticRuleId6')]",
                "contentId": "[variables('_analyticRulecontentId6')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Corelight Analytics Rule 7 with template",
        "displayName": "Corelight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName7'),'/',variables('analyticRuleVersion7'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName7'))]"
      ],
      "properties": {
        "description": "CorelightPossibleWebshell_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId7')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects post requests to unusual extensions.",
                "displayName": "Corelight - Possible Webshell",
                "enabled": false,
                "query": "Corelight\n| where EventType =~ 'http'\n| where HttpRequestMethod in~ ('POST', 'PUT')\n| where toint(HttpStatusCode) between (200 .. 299)\n| where HttpRequestBodyBytes != 0 or HttpResponseBodyBytes != 0\n| extend fe = extract(@'.*(\\.\\w+)$', 1, UrlOriginal)\n| where fe in~ ('.jpg', '.jpeg', '.gif', '.png', '.icon', '.ico', '.xml', '.swf', '.svg', '.ppt', '.pttx', '.doc', '.docx', '.rtf', '.pdf', '.tif', '.zip', '.mov')\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "Corelight",
                    "dataTypes": [
                      "Corelight"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId7'),'/'))))]",
              "properties": {
                "description": "Corelight Analytics Rule 7",
                "parentId": "[variables('analyticRuleId7')]",
                "contentId": "[variables('_analyticRulecontentId7')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Corelight Analytics Rule 8 with template",
        "displayName": "Corelight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName8'),'/',variables('analyticRuleVersion8'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName8'))]"
      ],
      "properties": {
        "description": "CorelightPossibleWebshellRarePOST_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId8')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects rare post requests to a single webserver location.",
                "displayName": "Corelight - Possible Webshell (Rare PUT or POST)",
                "enabled": false,
                "query": "let threshold = 3;\nCorelight\n| where EventType =~ 'http'\n| where HttpRequestMethod in~ ('POST', 'PUT')\n| where toint(HttpStatusCode) !between (400 .. 499)\n| where HttpRequestBodyBytes != 0 or HttpResponseBodyBytes != 0\n| extend fe = extract(@'.*(\\.\\w+)$', 1, UrlOriginal)\n| where fe in~ ('.aspx', '.asp', '.php', '.jsp', '.jspx', '.war', '.ashx', '.asmx', '.ascx', '.asx', '.cshtml', '.cfm', '.cfc', '.cfml', '.wss', '.do', '.action', '.pl', '.plx', '.pm', '.xs', '.t', '.pod', '.php-s', '.pht', '.phar', '.phps', '.php7', '.php5', '.php4', '.php3', '.phtml', '.py', '.rb', '.rhtml', '.cgi', '.dll', '.ayws', '.cgi', '.erb', '.rjs', '.hta', '.htc', '.cs', '.kt', '.lua', '.vbhtml')\n| summarize count() by UrlOriginal, SrcIpAddr\n| where count_ < threshold\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "Corelight",
                    "dataTypes": [
                      "Corelight"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId8'),'/'))))]",
              "properties": {
                "description": "Corelight Analytics Rule 8",
                "parentId": "[variables('analyticRuleId8')]",
                "contentId": "[variables('_analyticRulecontentId8')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Corelight Analytics Rule 9 with template",
        "displayName": "Corelight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName9'),'/',variables('analyticRuleVersion9'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName9'))]"
      ],
      "properties": {
        "description": "CorelightSMTPEmailSubjectNonAsciiCharacters_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId9')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects where an emails contain non ascii characters within the Subject.",
                "displayName": "Corelight - SMTP Email containing NON Ascii Characters within the Subject",
                "enabled": false,
                "query": "Corelight\n| where EventType =~ 'smtp'\n| where Subject hasprefix  @'\\=?utf-16'\n| summarize recipients = dcount(To)\n| extend k = 1\n| join (Corelight\n        | where Subject hasprefix  @'\\=?utf-16'\n        | summarize by To\n        | extend k = 1) on k\n| where recipients > 1\n| extend MailCustomEntity = To\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "Corelight",
                    "dataTypes": [
                      "Corelight"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Recipient",
                        "columnName": "MailCustomEntity"
                      }
                    ],
                    "entityType": "MailMessage"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId9'),'/'))))]",
              "properties": {
                "description": "Corelight Analytics Rule 9",
                "parentId": "[variables('analyticRuleId9')]",
                "contentId": "[variables('_analyticRulecontentId9')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Corelight Analytics Rule 10 with template",
        "displayName": "Corelight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName10'),'/',variables('analyticRuleVersion10'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName10'))]"
      ],
      "properties": {
        "description": "CorelightTypoSquattingOrPunycodePhishingHTTPRequest_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId10')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when an HTTP request was made to a domain that was using unicode/punycode.",
                "displayName": "Corelight - Possible Typo Squatting or Punycode Phishing HTTP Request",
                "enabled": false,
                "query": "Corelight\n| where EventType =~ 'http'\n| where HttpRequestMethod =~ 'GET'\n| where isempty(HttpReferrerOriginal)\n| where HttpRequestHeaderHost has 'xn--'\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "Corelight",
                    "dataTypes": [
                      "Corelight"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId10'),'/'))))]",
              "properties": {
                "description": "Corelight Analytics Rule 10",
                "parentId": "[variables('analyticRuleId10')]",
                "contentId": "[variables('_analyticRulecontentId10')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "Corelight data connector with template",
        "displayName": "Corelight template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "Corelight data connector with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Corelight",
                  "publisher": "Corelight",
                  "descriptionMarkdown": "The [Corelight](https://corelight.com/) data connector enables incident responders and threat hunters who use Microsoft Sentinel to work faster and more effectively. The data connector enables ingestion of events from [Zeek](https://zeek.org/) and [Suricata](https://suricata-ids.org/) via Corelight Sensors into Microsoft Sentinel.",
                  "additionalRequirementBanner": "This data connector depends on a parser based on a Kusto Function to work as expected [**Corelight**](https://aka.ms/sentinel-Corelight-parser) which is deployed with the Microsoft Sentinel Solution.",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "Corelight_CL",
                      "baseQuery": "Corelight"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Top 10 Clients (Source IP)",
                      "query": "Corelight\n | summarize count() by SrcIpAddr\n | top 10 by count_"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "Corelight_CL",
                      "lastDataReceivedQuery": "Corelight\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Corelight\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**Corelight**](https://aka.ms/sentinel-Corelight-parser) which is deployed with the Microsoft Sentinel Solution."
                    },
                    {
                      "description": "Install the agent on the Server where the Corelight logs are generated.\n\n> Logs from Corelight Server deployed on Linux or Windows servers are collected by **Linux** or **Windows** agents.",
                      "instructions": [
                        {
                          "parameters": {
                            "title": "Choose where to install the Linux agent:",
                            "instructionSteps": [
                              {
                                "title": "Install agent on Azure Linux Virtual Machine",
                                "description": "Select the machine to install the agent on and then click **Connect**.",
                                "instructions": [
                                  {
                                    "parameters": {
                                      "linkType": "InstallAgentOnLinuxVirtualMachine"
                                    },
                                    "type": "InstallAgent"
                                  }
                                ]
                              },
                              {
                                "title": "Install agent on a non-Azure Linux Machine",
                                "description": "Download the agent on the relevant machine and follow the instructions.",
                                "instructions": [
                                  {
                                    "parameters": {
                                      "linkType": "InstallAgentOnLinuxNonAzure"
                                    },
                                    "type": "InstallAgent"
                                  }
                                ]
                              }
                            ]
                          },
                          "type": "InstructionStepsGroup"
                        }
                      ],
                      "title": "1. Install and onboard the agent for Linux or Windows"
                    },
                    {
                      "instructions": [
                        {
                          "parameters": {
                            "title": "Choose where to install the Windows agent:",
                            "instructionSteps": [
                              {
                                "title": "Install agent on Azure Windows Virtual Machine",
                                "description": "Select the machine to install the agent on and then click **Connect**.",
                                "instructions": [
                                  {
                                    "parameters": {
                                      "linkType": "InstallAgentOnVirtualMachine"
                                    },
                                    "type": "InstallAgent"
                                  }
                                ]
                              },
                              {
                                "title": "Install agent on a non-Azure Windows Machine",
                                "description": "Download the agent on the relevant machine and follow the instructions.",
                                "instructions": [
                                  {
                                    "parameters": {
                                      "linkType": "InstallAgentOnNonAzure"
                                    },
                                    "type": "InstallAgent"
                                  }
                                ]
                              }
                            ]
                          },
                          "type": "InstructionStepsGroup"
                        }
                      ]
                    },
                    {
                      "description": "Follow the configuration steps below to get Corelight logs into Microsoft Sentinel. This configuration enriches events generated by Corelight module to provide visibility on log source information for Corelight logs. Refer to the [Azure Monitor Documentation](https://docs.microsoft.com/azure/azure-monitor/agents/data-sources-json) for more details on these steps.\n1. Download config file: [corelight.conf](https://aka.ms/sentinel-Corelight-conf/).\n2. Login to the server where you have installed Azure Log Analytics agent.\n3. Copy corelight.conf to the /etc/opt/microsoft/omsagent/**workspace_id**/conf/omsagent.d/ folder.\n4. Edit corelight.conf as follows:\n\n\t i. configure an alternate port to send data to, if desired (line 3)\n\n\t ii. replace **workspace_id** with real value of your Workspace ID (lines 22,23,24,27)\n5. Save changes and restart the Azure Log Analytics agent for Linux service with the following command:\n\t\tsudo /opt/microsoft/omsagent/bin/service_control restart",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        }
                      ],
                      "title": "2. Configure the logs to be collected"
                    },
                    {
                      "description": "See the [Corelight documentation](https://docs.corelight.com/docs/sensor/export/json_tcp.html) for details on how to configure the Corelight Sensor to export JSON over TCP. Configure the JSON TCP Server to the IP address of the Azure Log Analytics Agent, using the port configured in the previous step (port 21234 by default)",
                      "title": "3. Configure the Corelight Sensor to send logs to the Azure Log Analytics Agent"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Corelight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Corelight"
        },
        "support": {
          "name": "Corelight",
          "tier": "Partner",
          "link": "https://support.corelight.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Corelight",
          "publisher": "Corelight",
          "descriptionMarkdown": "The [Corelight](https://corelight.com/) data connector enables incident responders and threat hunters who use Microsoft Sentinel to work faster and more effectively. The data connector enables ingestion of events from [Zeek](https://zeek.org/) and [Suricata](https://suricata-ids.org/) via Corelight Sensors into Microsoft Sentinel.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "Corelight_CL",
              "baseQuery": "Corelight"
            }
          ],
          "dataTypes": [
            {
              "name": "Corelight_CL",
              "lastDataReceivedQuery": "Corelight\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "Corelight\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Top 10 Clients (Source IP)",
              "query": "Corelight\n | summarize count() by SrcIpAddr\n | top 10 by count_"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**Corelight**](https://aka.ms/sentinel-Corelight-parser) which is deployed with the Microsoft Sentinel Solution."
            },
            {
              "description": "Install the agent on the Server where the Corelight logs are generated.\n\n> Logs from Corelight Server deployed on Linux or Windows servers are collected by **Linux** or **Windows** agents.",
              "instructions": [
                {
                  "parameters": {
                    "title": "Choose where to install the Linux agent:",
                    "instructionSteps": [
                      {
                        "title": "Install agent on Azure Linux Virtual Machine",
                        "description": "Select the machine to install the agent on and then click **Connect**.",
                        "instructions": [
                          {
                            "parameters": {
                              "linkType": "InstallAgentOnLinuxVirtualMachine"
                            },
                            "type": "InstallAgent"
                          }
                        ]
                      },
                      {
                        "title": "Install agent on a non-Azure Linux Machine",
                        "description": "Download the agent on the relevant machine and follow the instructions.",
                        "instructions": [
                          {
                            "parameters": {
                              "linkType": "InstallAgentOnLinuxNonAzure"
                            },
                            "type": "InstallAgent"
                          }
                        ]
                      }
                    ]
                  },
                  "type": "InstructionStepsGroup"
                }
              ],
              "title": "1. Install and onboard the agent for Linux or Windows"
            },
            {
              "instructions": [
                {
                  "parameters": {
                    "title": "Choose where to install the Windows agent:",
                    "instructionSteps": [
                      {
                        "title": "Install agent on Azure Windows Virtual Machine",
                        "description": "Select the machine to install the agent on and then click **Connect**.",
                        "instructions": [
                          {
                            "parameters": {
                              "linkType": "InstallAgentOnVirtualMachine"
                            },
                            "type": "InstallAgent"
                          }
                        ]
                      },
                      {
                        "title": "Install agent on a non-Azure Windows Machine",
                        "description": "Download the agent on the relevant machine and follow the instructions.",
                        "instructions": [
                          {
                            "parameters": {
                              "linkType": "InstallAgentOnNonAzure"
                            },
                            "type": "InstallAgent"
                          }
                        ]
                      }
                    ]
                  },
                  "type": "InstructionStepsGroup"
                }
              ]
            },
            {
              "description": "Follow the configuration steps below to get Corelight logs into Microsoft Sentinel. This configuration enriches events generated by Corelight module to provide visibility on log source information for Corelight logs. Refer to the [Azure Monitor Documentation](https://docs.microsoft.com/azure/azure-monitor/agents/data-sources-json) for more details on these steps.\n1. Download config file: [corelight.conf](https://aka.ms/sentinel-Corelight-conf/).\n2. Login to the server where you have installed Azure Log Analytics agent.\n3. Copy corelight.conf to the /etc/opt/microsoft/omsagent/**workspace_id**/conf/omsagent.d/ folder.\n4. Edit corelight.conf as follows:\n\n\t i. configure an alternate port to send data to, if desired (line 3)\n\n\t ii. replace **workspace_id** with real value of your Workspace ID (lines 22,23,24,27)\n5. Save changes and restart the Azure Log Analytics agent for Linux service with the following command:\n\t\tsudo /opt/microsoft/omsagent/bin/service_control restart",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                }
              ],
              "title": "2. Configure the logs to be collected"
            },
            {
              "description": "See the [Corelight documentation](https://docs.corelight.com/docs/sensor/export/json_tcp.html) for details on how to configure the Corelight Sensor to export JSON over TCP. Configure the JSON TCP Server to the IP address of the Azure Log Analytics Agent, using the port configured in the previous step (port 21234 by default)",
              "title": "3. Configure the Corelight Sensor to send logs to the Azure Log Analytics Agent"
            }
          ],
          "id": "[variables('_uiConfigId1')]",
          "additionalRequirementBanner": "This data connector depends on a parser based on a Kusto Function to work as expected [**Corelight**](https://aka.ms/sentinel-Corelight-parser) which is deployed with the Microsoft Sentinel Solution."
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('parserTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "Corelight Data Parser with template",
        "displayName": "Corelight Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('parserTemplateSpecName1'),'/',variables('parserVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "Corelight Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName1')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight",
                "category": "Samples",
                "functionAlias": "Corelight",
                "query": "\nlet Corelight_view = view () {\r\n    Corelight_CL | where isnotempty(Message)\r\n| extend tmp = parse_json(Message)\r\n| evaluate bag_unpack(tmp)\r\n    | extend \r\n        EventVendor=\"Corelight\",\r\n        EventProduct=\"Corelight Sensor\",\r\n        EventType=column_ifexists('_path',''),\r\n        DvcHostname=column_ifexists('_system_name', ''),\r\n        SrcDvcHostname=column_ifexists('hostname_s', ''),\r\n        EventEndTime=column_ifexists('ts', '')\r\n};\r\nlet Corelight_main_view = view () {\r\n    Corelight_view \r\n    | extend\r\n        Action=column_ifexists('action', ''),\r\n        Actions=column_ifexists('actions', ''),\r\n        AgentRemoteId=column_ifexists('agent_remote_id', ''),\r\n        AlertCategory=column_ifexists('alert.category', ''),\r\n        AlertGroupId=column_ifexists('alert.gid', ''),\r\n        AlertMetadata=column_ifexists('alert.metadata', ''),\r\n        AlertRevision=column_ifexists('alert.rev', ''),\r\n        AlertSeverity=column_ifexists('alert.severity', ''),\r\n        AlertSignature=column_ifexists('alert.signature', ''),\r\n        AlertSignatureId=column_ifexists('alert.signature_id', ''),\r\n        Analyzer=column_ifexists('analyzer', ''),\r\n        AuthAttempts=column_ifexists('auth_attempts', ''),\r\n        AuthSuccess=column_ifexists('auth_success', ''),\r\n        BasicConstraintsCa=column_ifexists('basic_constraints.ca', ''),\r\n        BasicConstraintsPathLen=column_ifexists('basic_constraints.path_len', ''),\r\n        Cc=column_ifexists('cc', ''),\r\n        CertificateCn=column_ifexists('certificate.cn', ''),\r\n        CertificateCurve=column_ifexists('certificate.curve', ''),\r\n        CertificateExponent=column_ifexists('certificate.exponent', ''),\r\n        CertificateHashSha1=column_ifexists('orig_certificate_sha1', ''),\r\n        CertificateIssuer=column_ifexists('certificate.issuer', column_ifexists('client_issuer', '')),\r\n        CertificateKeyAlg=column_ifexists('certificate.key_alg', ''),\r\n        CertificateKeyLength=column_ifexists('certificate.key_length', ''),\r\n        CertificateKeyType=column_ifexists('certificate.key_type', ''),\r\n        CertificateNotValidAfter=column_ifexists('certificate.not_valid_after', ''),\r\n        CertificateNotValidBefore=column_ifexists('certificate.not_valid_before', ''),\r\n        CertificateSerial=column_ifexists('certificate.serial', ''),\r\n        CertificateSigAlg=column_ifexists('certificate.sig_alg', ''),\r\n        CertificateSubject=column_ifexists('certificate.subject', column_ifexists('client_subject', '')),\r\n        CertificateVersion=column_ifexists('certificate.version', ''),\r\n        CipherAlg=column_ifexists('cipher_alg', ''),\r\n        Client=column_ifexists('client', ''),\r\n        ClientMessage=column_ifexists('client_message', ''),\r\n        ClientSoftware=column_ifexists('client_software', ''),\r\n        CompileTs=column_ifexists('compile_ts', ''),\r\n        CompressionAlg=column_ifexists('compression_alg', ''),\r\n        Cshka=column_ifexists('cshka', ''),\r\n        DataChannelOrigH=column_ifexists('data_channel.orig_h', ''),\r\n        DataChannelPassive=column_ifexists('data_channel.passive', ''),\r\n        DataChannelRespH=column_ifexists('data_channel.resp_h', ''),\r\n        DataChannelRespP=column_ifexists('data_channel.resp_p', ''),\r\n        Date=column_ifexists('date', ''),\r\n        Depth=column_ifexists('depth', ''),\r\n        DhcpAssignedIpAddr=column_ifexists('assigned_addr', ''),\r\n        DhcpCircuitId=column_ifexists('circuit_id', ''),\r\n        DhcpLeaseTime=column_ifexists('lease_time', ''),\r\n        DhcpRequestedIpAddr=column_ifexists('requested_addr', ''),\r\n        DhcpSubscriberId=column_ifexists('subscriber_id', ''),\r\n        Direction=column_ifexists('direction', ''),\r\n        Dnp3FunctionReply=column_ifexists('fc_reply', ''),\r\n        Dnp3FunctionRequest=column_ifexists('fc_request', ''),\r\n        Dnp3Iin=column_ifexists('iin', ''),\r\n        DnsAdditionalAuthoritativeName=column_ifexists('auth', ''),\r\n        DnsAdditionalName=column_ifexists('addl', ''),\r\n        DnsFlagsAuthoritative=column_ifexists('AA', ''),\r\n        DnsFlagsRecursionAvailable=column_ifexists('RA', ''),\r\n        DnsFlagsRecursionDesired=column_ifexists('RD', ''),\r\n        DnsFlagsTruncated=column_ifexists('TC', ''),\r\n        DnsFlagsZ=column_ifexists('Z', ''),\r\n        DnsQueryClass=column_ifexists('qclass', ''),\r\n        DnsQueryClassName=column_ifexists('qclass_name', ''),\r\n        DnsQueryName=column_ifexists('query', ''),\r\n        DnsQueryType=column_ifexists('qtype', ''),\r\n        DnsQueryTypeName=column_ifexists('qtype_name', ''),\r\n        DnsRejected=column_ifexists('rejected', ''),\r\n        DnsResponseCode=column_ifexists('rcode', ''),\r\n        DnsResponseCodeName=column_ifexists('rcode_name', ''),\r\n        DnsResponseName=column_ifexists('answers', ''),\r\n        DnsResponseTtl=column_ifexists('TTLs', ''),\r\n        DnsRtt=column_ifexists('rtt', ''),\r\n        DnsTransactionId=column_ifexists('trans_id', ''),\r\n        Domainname=column_ifexists('domainname', ''),\r\n        Dropped=column_ifexists('dropped', ''),\r\n        Dst=column_ifexists('dst', ''),\r\n        DstBytes=column_ifexists('resp_bytes', ''),\r\n        DstCertificateIssuerName=column_ifexists('issuer', ''),\r\n        DstCertificateSha1=column_ifexists('resp_certificate_sha1', ''),\r\n        DstCertificateSubjectName=column_ifexists('subject', ''),\r\n        DstHostName=column_ifexists('http_header_host', column_ifexists('tls_server_name', '')),\r\n        DstIpAddr=column_ifexists('id.resp_h', column_ifexists('server_addr', column_ifexists('tx_hosts', ''))),\r\n        DstIpBytes=column_ifexists('resp_ip_bytes', ''),\r\n        DstMac=column_ifexists('resp_l2_addr', ''),\r\n        DstPackets=column_ifexists('resp_pkts', ''),\r\n        DstPort=column_ifexists('id.resp_p', ''),\r\n        Duration=column_ifexists('duration', ''),\r\n        EmailBodySections=column_ifexists('email_body_sections', ''),\r\n        EventDuration=column_ifexists('duration', ''),\r\n        EventUid=column_ifexists('z_Enrichment', column_ifexists('zeek_id_uids', column_ifexists('uid', ''))),\r\n        FailureReason=column_ifexists('failure_reason', ''),\r\n        FileAccessedTime=column_ifexists('times_accessed', ''),\r\n        FileChangedTime=column_ifexists('times_changed', ''),\r\n        FileCreationTime=column_ifexists('times_created', ''),\r\n        FileDesc=column_ifexists('file_desc', ''),\r\n        FileDirectory=column_ifexists('cwd', ''),\r\n        FileMimeType=column_ifexists('file_mime_type', column_ifexists('mime_type', column_ifexists('resp_mime_types', ''))),\r\n        FileModifiedTime=column_ifexists('times_modified', ''),\r\n        FileName=column_ifexists('filename', column_ifexists('resp_filenames', '')),\r\n        FilePath=column_ifexists('file_name', ''),\r\n        FilePreviousName=column_ifexists('prev_name', ''),\r\n        FileSize=column_ifexists('file_size', column_ifexists('total_bytes', column_ifexists('size', ''))),\r\n        FileSystemType=column_ifexists('native_file_system', ''),\r\n        FingerprintNetworkCommunityId=column_ifexists('community_id', ''),\r\n        FirstReceived=column_ifexists('first_received', ''),\r\n        FlowId=column_ifexists('flow_id', ''),\r\n        From=column_ifexists('from', ''),\r\n        FtpCommandLine=column_ifexists('arg', ''),\r\n        FtpPassive=column_ifexists('ftp_passive', ''),\r\n        FtpProcessName=column_ifexists('command', ''),\r\n        Fuid=column_ifexists('fuid', ''),\r\n        Fuids=column_ifexists('fuids', ''),\r\n        HasCertTable=column_ifexists('has_cert_table', ''),\r\n        HasDebugData=column_ifexists('has_debug_data', ''),\r\n        HasExportTable=column_ifexists('has_export_table', ''),\r\n        HasImportTable=column_ifexists('has_import_table', ''),\r\n        HashJa3=column_ifexists('ja3', ''),\r\n        HashJa3s=column_ifexists('ja3s', ''),\r\n        HashMd5=column_ifexists('md5', ''),\r\n        HashSha1=column_ifexists('sha1', ''),\r\n        HashSha256=column_ifexists('sha256', ''),\r\n        Hassh=column_ifexists('hassh', ''),\r\n        Hasshalgorithms=column_ifexists('hasshAlgorithms', ''),\r\n        Hasshserver=column_ifexists('hasshServer', ''),\r\n        Hasshserveralgorithms=column_ifexists('hasshServerAlgorithms', ''),\r\n        Hasshversion=column_ifexists('hasshVersion', ''),\r\n        Helo=column_ifexists('helo', ''),\r\n        Host=column_ifexists('host', ''),\r\n        HostKey=column_ifexists('host_key', ''),\r\n        HostKeyAlg=column_ifexists('host_key_alg', ''),\r\n        HostP=column_ifexists('host_p', ''),\r\n        Hostname=column_ifexists('hostname', ''),\r\n        HttpCookieVariables=column_ifexists('cookie_vars', ''),\r\n        HttpInformationalCode=column_ifexists('info_code', ''),\r\n        HttpInformationalMessage=column_ifexists('info_msg', ''),\r\n        HttpProxiedHeaders=column_ifexists('proxied', ''),\r\n        HttpReferrerOriginal=column_ifexists('referrer', ''),\r\n        HttpRequestBodyBytes=column_ifexists('request_body_len', ''),\r\n        HttpRequestHeaderHost=column_ifexists('host', ''),\r\n        HttpRequestHeaderNames=column_ifexists('client_header_names', ''),\r\n        HttpRequestHeaderOrigin=column_ifexists('origin', ''),\r\n        HttpRequestMethod=column_ifexists('method', ''),\r\n        HttpResponseBodyBytes=column_ifexists('response_body_len', ''),\r\n        HttpResponseBodyOriginal=column_ifexists('post_body', ''),\r\n        HttpResponseHeaderNames=column_ifexists('server_header_names', ''),\r\n        HttpStatusCode=column_ifexists('status_code', ''),\r\n        HttpStatusMessage=column_ifexists('status_msg', ''),\r\n        HttpVersion=column_ifexists('version', ''),\r\n        Id=column_ifexists('id', ''),\r\n        InReplyTo=column_ifexists('in_reply_to', ''),\r\n        Is64bit=column_ifexists('is_64bit', ''),\r\n        IsExe=column_ifexists('is_exe', ''),\r\n        IsOrig=column_ifexists('is_orig', ''),\r\n        IsWebmail=column_ifexists('is_webmail', ''),\r\n        KexAlg=column_ifexists('kex_alg', ''),\r\n        LastReply=column_ifexists('last_reply', ''),\r\n        LocalOrig=column_ifexists('local_orig', ''),\r\n        Logcert=column_ifexists('logcert', ''),\r\n        MacAlg=column_ifexists('mac_alg', ''),\r\n        Machine=column_ifexists('machine', ''),\r\n        Mailfrom=column_ifexists('mailfrom', ''),\r\n        Matched=column_ifexists('matched', ''),\r\n        MimeType=column_ifexists('mime_type', ''),\r\n        Msg=column_ifexists('msg', ''),\r\n        MsgId=column_ifexists('msg_id', ''),\r\n        MsgOrig=column_ifexists('msg_orig', ''),\r\n        MsgTypes=column_ifexists('msg_types', ''),\r\n        N=column_ifexists('n', ''),\r\n        Name=column_ifexists('name', ''),\r\n        NetworkApplication=column_ifexists('service', ''),\r\n        NetworkConnectionHistory=column_ifexists('history', ''),\r\n        NetworkConnectionState=column_ifexists('conn_state', ''),\r\n        NetworkInnerVlanId=column_ifexists('inner_vlan', ''),\r\n        NetworkMissedBytes=column_ifexists('missed_bytes', ''),\r\n        NetworkOuterVlanId=column_ifexists('vlan', ''),\r\n        NetworkProtocol=case(EventType == \"smb_files\" or EventType == \"smb_mapping\" or EventType == \"ssl\" or EventType == \"ssl_red\" or EventType == \"http\" or EventType == \"http_red\", \"tcp\",EventType == \"dhcp\", \"udp\",column_ifexists('proto','')),\r\n        Node=column_ifexists('node', ''),\r\n        Note=column_ifexists('note', ''),\r\n        Notice=column_ifexists('notice', ''),\r\n        Os=column_ifexists('os', ''),\r\n        OscpValidationStatus=column_ifexists('ocsp_status', ''),\r\n        P=column_ifexists('p', ''),\r\n        PacketSegment=column_ifexists('packet_segment', ''),\r\n        Path=column_ifexists('path', ''),\r\n        PcapCount=column_ifexists('pcap_cnt', ''),\r\n        Peer=column_ifexists('peer', ''),\r\n        PeerDescr=column_ifexists('peer_descr', ''),\r\n        Rcptto=column_ifexists('rcptto', ''),\r\n        RemoteLocationCity=column_ifexists('remote_location.city', ''),\r\n        RemoteLocationCountryCode=column_ifexists('remote_location.country_code', ''),\r\n        RemoteLocationLatitude=column_ifexists('remote_location.latitude', ''),\r\n        RemoteLocationLongitude=column_ifexists('remote_location.longitude', ''),\r\n        RemoteLocationRegion=column_ifexists('remote_location.region', ''),\r\n        ReplyCode=column_ifexists('reply_code', ''),\r\n        ReplyMsg=column_ifexists('reply_msg', ''),\r\n        ReplyTo=column_ifexists('reply_to', ''),\r\n        SanDns=column_ifexists('san.dns', ''),\r\n        SanEmail=column_ifexists('san.email', ''),\r\n        SanIp=column_ifexists('san.ip', ''),\r\n        SanUri=column_ifexists('san.uri', '') ,\r\n        SecondReceived=column_ifexists('second_received', ''),\r\n        SectionNames=column_ifexists('section_names', ''),\r\n        SeenIndicator=column_ifexists('seen.indicator', ''),\r\n        SeenIndicatorType=column_ifexists('seen.indicator_type', ''),\r\n        SeenWhere=column_ifexists('seen.where', ''),\r\n        Server=column_ifexists('server', ''),\r\n        ServerDnsComputerName=column_ifexists('server_dns_computer_name', ''),\r\n        ServerMessage=column_ifexists('server_message', ''),\r\n        ServerNbComputerName=column_ifexists('server_nb_computer_name', ''),\r\n        ServerSoftware=column_ifexists('server_software', ''),\r\n        ServerTreeName=column_ifexists('server_tree_name', ''),\r\n        Service=column_ifexists('service', ''),\r\n        ShareName=column_ifexists('path', ''),\r\n        ShareRelativeTargetName=column_ifexists('name', ''),\r\n        ShareType=column_ifexists('share_type', ''),\r\n        SmbAction=column_ifexists('action', ''),\r\n        SoftwareFlashVersionOriginal=column_ifexists('flash_version', ''),\r\n        SoftwareType=column_ifexists('software_type', ''),\r\n        Source=column_ifexists('source', ''),\r\n        Sources=column_ifexists('sources', ''),\r\n        Src=column_ifexists('src', ''),\r\n        SrcBytes=column_ifexists('orig_bytes', ''),\r\n        SrcDomain=column_ifexists('domain', ''),\r\n        SrcFileName=column_ifexists('orig_filenames', ''),\r\n        SrcFilePath=column_ifexists('src_file_name', ''),\r\n        SrcFqdn=column_ifexists('client_fqdn', ''),\r\n        SrcHostName=column_ifexists('host_name', ''),\r\n        SrcIpAddr=column_ifexists('id.orig_h', column_ifexists('rx_hosts', column_ifexists('client_addr', ''))),\r\n        SrcIpBytes=column_ifexists('orig_ip_bytes', ''),\r\n        SrcMac=column_ifexists('mac', column_ifexists('orig_l2_addr', '')),\r\n        SrcMimeType=column_ifexists('orig_mime_types', ''),\r\n        SrcPackets=column_ifexists('orig_pkts', ''),\r\n        SrcPort=column_ifexists('id.orig_p', ''),\r\n        Sub=column_ifexists('sub', ''),\r\n        Subject=column_ifexists('subject', ''),\r\n        SubpressFor=column_ifexists('subpress_for', ''),\r\n        Subsystem=column_ifexists('subsystem', ''),\r\n        Success=column_ifexists('success', ''),\r\n        SuricataId=column_ifexists('suri_id', ''),\r\n        SuricataIds=column_ifexists('suri_ids', ''),\r\n        Tls=column_ifexists('tls', ''),\r\n        TlsCertificateValidationStatus=column_ifexists('validation_status', ''),\r\n        TlsCipher=column_ifexists('cipher', ''),\r\n        TlsCurve=column_ifexists('curve', ''),\r\n        TlsEstablished=column_ifexists('established', ''),\r\n        TlsLastAlert=column_ifexists('last_alert', ''),\r\n        TlsNextProtocol=column_ifexists('next_protocol', ''),\r\n        TlsNotaryResponse=column_ifexists('notary', ''),\r\n        TlsResumed=column_ifexists('resumed', ''),\r\n        TlsServerName=column_ifexists('server_name', ''),\r\n        TlsVersion=column_ifexists('version', ''),\r\n        TlsVersionNumber=column_ifexists('version_num', ''),\r\n        To=column_ifexists('to', ''),\r\n        TransactionId=column_ifexists('tx_id', ''),\r\n        TransDepth=column_ifexists('trans_depth', ''),\r\n        TunnelType=column_ifexists('tunnel_type', ''),\r\n        UnparsedVersion=column_ifexists('unparsed_version', ''),\r\n        Url=column_ifexists('url', ''),\r\n        UrlOriginal=column_ifexists('uri', ''),\r\n        UrlQueryValues=column_ifexists('uri_vars', ''),\r\n        UserAgent=column_ifexists('user_agent', ''),\r\n        UserAgentOriginal=column_ifexists('user_agent', ''),\r\n        UserName=column_ifexists('user', column_ifexists('username', '')),\r\n        UserPassword=column_ifexists('password', ''),\r\n        Username=column_ifexists('username', ''),\r\n        UsesAslr=column_ifexists('uses_aslr', ''),\r\n        UsesCodeIntegrity=column_ifexists('uses_code_integrity', ''),\r\n        UsesDep=column_ifexists('uses_dep', ''),\r\n        UsesSeh=column_ifexists('uses_seh', ''),\r\n        ValidCtLogs=column_ifexists('valid_ct_logs', ''),\r\n        ValidCtOperators=column_ifexists('valid_ct_operators', ''),\r\n        ValidCtOperatorsList=column_ifexists('valid_ct_operators_list', ''),\r\n        Version=column_ifexists('version', ''),\r\n        VersionAddl=column_ifexists('version.addl', ''),\r\n        VersionMajor=column_ifexists('version.major', ''),\r\n        VersionMinor2=column_ifexists('version.minor2', ''),\r\n        VersionMinor3=column_ifexists('version.minor3', ''),\r\n        VersionMinor=column_ifexists('version.minor', ''),\r\n        X509=column_ifexists('x509', ''),\r\n        XOriginatingIp=column_ifexists('x_originating_ip', ''),\r\n        ZeekConnLocalDst=column_ifexists('local_resp', ''),\r\n        ZeekConnLocalSrc=column_ifexists('local_orig', ''),\r\n        ZeekFilesAnalyzers=column_ifexists('analyzers', ''),\r\n        ZeekFilesEntropy=column_ifexists('entropy', ''),\r\n        ZeekFilesExtracted=column_ifexists('extracted', ''),\r\n        ZeekFilesExtractedCutoff=column_ifexists('extracted_cutoff', ''),\r\n        ZeekFilesExtractedSize=column_ifexists('extracted_size', ''),\r\n        ZeekFilesMissingBytes=column_ifexists('missing_bytes', ''),\r\n        ZeekFilesOverflowBytes=column_ifexists('overflow_bytes', ''),\r\n        ZeekFilesSeenBytes=column_ifexists('seen_bytes', ''),\r\n        ZeekFilesTimedout=column_ifexists('timedout', ''),\r\n        ZeekHttpOmniture=column_ifexists('omniture', ''),\r\n        ZeekHttpTags=column_ifexists('tags', ''),\r\n        ZeekHttpTransDepth=column_ifexists('trans_depth', ''),\r\n        ZeekIdCertChainFuids=column_ifexists('cert_chain_fuids', ''),\r\n        ZeekIdClientCertChainFuids=column_ifexists('client_cert_chain_fuids', ''),\r\n        ZeekIdConnUids=column_ifexists('conn_uids', ''),\r\n        ZeekIdFuid=column_ifexists('fuid', ''),\r\n        ZeekIdOrigFuids=column_ifexists('orig_fuids', ''),\r\n        ZeekIdParentFuid=column_ifexists('parent_fuid', ''),\r\n        ZeekIdRespFuids=column_ifexists('resp_fuids', ''),\r\n        ZeekIdTunnelParents=column_ifexists('tunnel_parents', ''),\r\n        ZeekIdUids=column_ifexists('uids', ''),\r\n        ZeekMetaDstIpAddrHostName=column_ifexists('id.resp_h_name.vals', ''),\r\n        ZeekMetaDstIpAddrSource=column_ifexists('id.resp_h_name.src', ''),\r\n        ZeekMetaSrcIpAddrHostName=column_ifexists('id.orig_h_name.vals', ''),\r\n        ZeekMetaSrcIpAddrSource=column_ifexists('id.orig_h_name.src', ''),\r\n        ZeekOrigCc=column_ifexists('orig_cc', ''),\r\n        ZeekRespCc=column_ifexists('resp_cc', '')\r\n       | project\r\n        DvcHostname,\r\n        SrcDvcHostname,\r\n        EventEndTime,\r\n        Message,\r\n        TimeGenerated, \r\n        EventType,\r\n        EventVendor,\r\n        EventProduct,\r\n        Action,\r\n        Actions,\r\n        AgentRemoteId,\r\n        AlertCategory,\r\n        AlertGroupId,\r\n        AlertMetadata,\r\n        AlertRevision,\r\n        AlertSeverity,\r\n        AlertSignature,\r\n        AlertSignatureId,\r\n        Analyzer,\r\n        AuthAttempts,\r\n        AuthSuccess,\r\n        BasicConstraintsCa,\r\n        BasicConstraintsPathLen,\r\n        Cc,\r\n        CertificateCn,\r\n        CertificateCurve,\r\n        CertificateExponent,\r\n        CertificateHashSha1,\r\n        CertificateIssuer,\r\n        CertificateKeyAlg,\r\n        CertificateKeyLength,\r\n        CertificateKeyType,\r\n        CertificateNotValidAfter,\r\n        CertificateNotValidBefore,\r\n        CertificateSerial,\r\n        CertificateSigAlg,\r\n        CertificateSubject,\r\n        CertificateVersion,\r\n        CipherAlg,\r\n        Client,\r\n        ClientMessage,\r\n        ClientSoftware,\r\n        CompileTs,\r\n        CompressionAlg,\r\n        Cshka,\r\n        DataChannelOrigH,\r\n        DataChannelPassive,\r\n        DataChannelRespH,\r\n        DataChannelRespP,\r\n        Date,\r\n        Depth,\r\n        DhcpAssignedIpAddr,\r\n        DhcpCircuitId,\r\n        DhcpLeaseTime,\r\n        DhcpRequestedIpAddr,\r\n        DhcpSubscriberId,\r\n        Direction,\r\n        Dnp3FunctionReply,\r\n        Dnp3FunctionRequest,\r\n        Dnp3Iin,\r\n        DnsAdditionalAuthoritativeName,\r\n        DnsAdditionalName,\r\n        DnsFlagsAuthoritative,\r\n        DnsFlagsRecursionAvailable,\r\n        DnsFlagsRecursionDesired,\r\n        DnsFlagsTruncated,\r\n        DnsFlagsZ,\r\n        DnsQueryClass,\r\n        DnsQueryClassName,\r\n        DnsQueryName,\r\n        DnsQueryType,\r\n        DnsQueryTypeName,\r\n        DnsRejected,\r\n        DnsResponseCode,\r\n        DnsResponseCodeName,\r\n        DnsResponseName,\r\n        DnsResponseTtl,\r\n        DnsRtt,\r\n        DnsTransactionId,\r\n        Domainname,\r\n        Dropped,\r\n        Dst,\r\n        DstBytes,\r\n        DstCertificateIssuerName,\r\n        DstCertificateSha1,\r\n        DstCertificateSubjectName,\r\n        DstHostName,\r\n        DstIpAddr,\r\n        DstIpBytes,\r\n        DstMac,\r\n        DstPackets,\r\n        DstPort,\r\n        Duration,\r\n        EmailBodySections,\r\n        EventDuration,\r\n        EventUid,\r\n        FailureReason,\r\n        FileAccessedTime,\r\n        FileChangedTime,\r\n        FileCreationTime,\r\n        FileDesc,\r\n        FileDirectory,\r\n        FileMimeType,\r\n        FileModifiedTime,\r\n        FileName,\r\n        FilePath,\r\n        FilePreviousName,\r\n        FileSize,\r\n        FileSystemType,\r\n        FingerprintNetworkCommunityId,\r\n        FirstReceived,\r\n        FlowId,\r\n        From,\r\n        FtpCommandLine,\r\n        FtpPassive,\r\n        FtpProcessName,\r\n        Fuid,\r\n        Fuids,\r\n        HasCertTable,\r\n        HasDebugData,\r\n        HasExportTable,\r\n        HasImportTable,\r\n        HashJa3,\r\n        HashJa3s,\r\n        HashMd5,\r\n        HashSha1,\r\n        HashSha256,\r\n        Hassh,\r\n        Hasshalgorithms,\r\n        Hasshserver,\r\n        Hasshserveralgorithms,\r\n        Hasshversion,\r\n        Helo,\r\n        Host,\r\n        HostKey,\r\n        HostKeyAlg,\r\n        HostP,\r\n        Hostname,\r\n        HttpCookieVariables,\r\n        HttpInformationalCode,\r\n        HttpInformationalMessage,\r\n        HttpProxiedHeaders,\r\n        HttpReferrerOriginal,\r\n        HttpRequestBodyBytes,\r\n        HttpRequestHeaderHost,\r\n        HttpRequestHeaderNames,\r\n        HttpRequestHeaderOrigin,\r\n        HttpRequestMethod,\r\n        HttpResponseBodyBytes,\r\n        HttpResponseBodyOriginal,\r\n        HttpResponseHeaderNames,\r\n        HttpStatusCode,\r\n        HttpStatusMessage,\r\n        HttpVersion,\r\n        Id,\r\n        InReplyTo,\r\n        Is64bit,\r\n        IsExe,\r\n        IsOrig,\r\n        IsWebmail,\r\n        KexAlg,\r\n        LastReply,\r\n        LocalOrig,\r\n        Logcert,\r\n        MacAlg,\r\n        Machine,\r\n        Mailfrom,\r\n        Matched,\r\n        MimeType,\r\n        Msg,\r\n        MsgId,\r\n        MsgOrig,\r\n        MsgTypes,\r\n        N,\r\n        Name,\r\n        NetworkApplication,\r\n        NetworkConnectionHistory,\r\n        NetworkConnectionState,\r\n        NetworkInnerVlanId,\r\n        NetworkMissedBytes,\r\n        NetworkOuterVlanId,\r\n        NetworkProtocol,\r\n        Node,\r\n        Note,\r\n        Notice,\r\n        Os,\r\n        OscpValidationStatus,\r\n        P,\r\n        PacketSegment,\r\n        Path,\r\n        PcapCount,\r\n        Peer,\r\n        PeerDescr,\r\n        Rcptto,\r\n        RemoteLocationCity,\r\n        RemoteLocationCountryCode,\r\n        RemoteLocationLatitude,\r\n        RemoteLocationLongitude,\r\n        RemoteLocationRegion,\r\n        ReplyCode,\r\n        ReplyMsg,\r\n        ReplyTo,\r\n        SanDns,\r\n        SanEmail,\r\n        SanIp,\r\n        SanUri,\r\n        SecondReceived,\r\n        SectionNames,\r\n        SeenIndicator,\r\n        SeenIndicatorType,\r\n        SeenWhere,\r\n        Server,\r\n        ServerDnsComputerName,\r\n        ServerMessage,\r\n        ServerNbComputerName,\r\n        ServerSoftware,\r\n        ServerTreeName,\r\n        Service,\r\n        ShareName,\r\n        ShareRelativeTargetName,\r\n        ShareType,\r\n        SmbAction,\r\n        SoftwareFlashVersionOriginal,\r\n        SoftwareType,\r\n        Source,\r\n        Sources,\r\n        Src,\r\n        SrcBytes,\r\n        SrcDomain,\r\n        SrcFileName,\r\n        SrcFilePath,\r\n        SrcFqdn,\r\n        SrcHostName,\r\n        SrcIpAddr,\r\n        SrcIpBytes,\r\n        SrcMac,\r\n        SrcMimeType,\r\n        SrcPackets,\r\n        SrcPort,\r\n        Sub,\r\n        Subject,\r\n        SubpressFor,\r\n        Subsystem,\r\n        Success,\r\n        SuricataId,\r\n        SuricataIds,\r\n        Tls,\r\n        TlsCertificateValidationStatus,\r\n        TlsCipher,\r\n        TlsCurve,\r\n        TlsEstablished,\r\n        TlsLastAlert,\r\n        TlsNextProtocol,\r\n        TlsNotaryResponse,\r\n        TlsResumed,\r\n        TlsServerName,\r\n        TlsVersion,\r\n        TlsVersionNumber,\r\n        To,\r\n        TransactionId,\r\n        TransDepth,\r\n        TunnelType,\r\n        UnparsedVersion,\r\n        Url,\r\n        UrlOriginal,\r\n        UrlQueryValues,\r\n        UserAgent,\r\n        UserAgentOriginal,\r\n        UserName,\r\n        UserPassword,\r\n        Username,\r\n        UsesAslr,\r\n        UsesCodeIntegrity,\r\n        UsesDep,\r\n        UsesSeh,\r\n        ValidCtLogs,\r\n        ValidCtOperators,\r\n        ValidCtOperatorsList,\r\n        Version,\r\n        VersionAddl,\r\n        VersionMajor,\r\n        VersionMinor2,\r\n        VersionMinor3,\r\n        VersionMinor,\r\n        X509,\r\n        XOriginatingIp,\r\n        ZeekConnLocalDst,\r\n        ZeekConnLocalSrc,\r\n        ZeekFilesAnalyzers,\r\n        ZeekFilesEntropy,\r\n        ZeekFilesExtracted,\r\n        ZeekFilesExtractedCutoff,\r\n        ZeekFilesExtractedSize,\r\n        ZeekFilesMissingBytes,\r\n        ZeekFilesOverflowBytes,\r\n        ZeekFilesSeenBytes,\r\n        ZeekFilesTimedout,\r\n        ZeekHttpOmniture,\r\n        ZeekHttpTags,\r\n        ZeekHttpTransDepth,\r\n        ZeekIdCertChainFuids,\r\n        ZeekIdClientCertChainFuids,\r\n        ZeekIdConnUids,\r\n        ZeekIdFuid,\r\n        ZeekIdOrigFuids,\r\n        ZeekIdParentFuid,\r\n        ZeekIdRespFuids,\r\n        ZeekIdTunnelParents,\r\n        ZeekIdUids,\r\n        ZeekMetaDstIpAddrHostName,\r\n        ZeekMetaDstIpAddrSource,\r\n        ZeekMetaSrcIpAddrHostName,\r\n        ZeekMetaSrcIpAddrSource,\r\n        ZeekOrigCc,\r\n        ZeekRespCc\r\n};\r\nCorelight_main_view\r\n\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "Corelight"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName1')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
                "contentId": "[variables('_parserContentId1')]",
                "kind": "Parser",
                "version": "[variables('parserVersion1')]",
                "source": {
                  "name": "Corelight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2021-06-01",
      "name": "[variables('_parserName1')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Corelight",
        "category": "Samples",
        "functionAlias": "Corelight",
        "query": "\nlet Corelight_view = view () {\r\n    Corelight_CL | where isnotempty(Message)\r\n| extend tmp = parse_json(Message)\r\n| evaluate bag_unpack(tmp)\r\n    | extend \r\n        EventVendor=\"Corelight\",\r\n        EventProduct=\"Corelight Sensor\",\r\n        EventType=column_ifexists('_path',''),\r\n        DvcHostname=column_ifexists('_system_name', ''),\r\n        SrcDvcHostname=column_ifexists('hostname_s', ''),\r\n        EventEndTime=column_ifexists('ts', '')\r\n};\r\nlet Corelight_main_view = view () {\r\n    Corelight_view \r\n    | extend\r\n        Action=column_ifexists('action', ''),\r\n        Actions=column_ifexists('actions', ''),\r\n        AgentRemoteId=column_ifexists('agent_remote_id', ''),\r\n        AlertCategory=column_ifexists('alert.category', ''),\r\n        AlertGroupId=column_ifexists('alert.gid', ''),\r\n        AlertMetadata=column_ifexists('alert.metadata', ''),\r\n        AlertRevision=column_ifexists('alert.rev', ''),\r\n        AlertSeverity=column_ifexists('alert.severity', ''),\r\n        AlertSignature=column_ifexists('alert.signature', ''),\r\n        AlertSignatureId=column_ifexists('alert.signature_id', ''),\r\n        Analyzer=column_ifexists('analyzer', ''),\r\n        AuthAttempts=column_ifexists('auth_attempts', ''),\r\n        AuthSuccess=column_ifexists('auth_success', ''),\r\n        BasicConstraintsCa=column_ifexists('basic_constraints.ca', ''),\r\n        BasicConstraintsPathLen=column_ifexists('basic_constraints.path_len', ''),\r\n        Cc=column_ifexists('cc', ''),\r\n        CertificateCn=column_ifexists('certificate.cn', ''),\r\n        CertificateCurve=column_ifexists('certificate.curve', ''),\r\n        CertificateExponent=column_ifexists('certificate.exponent', ''),\r\n        CertificateHashSha1=column_ifexists('orig_certificate_sha1', ''),\r\n        CertificateIssuer=column_ifexists('certificate.issuer', column_ifexists('client_issuer', '')),\r\n        CertificateKeyAlg=column_ifexists('certificate.key_alg', ''),\r\n        CertificateKeyLength=column_ifexists('certificate.key_length', ''),\r\n        CertificateKeyType=column_ifexists('certificate.key_type', ''),\r\n        CertificateNotValidAfter=column_ifexists('certificate.not_valid_after', ''),\r\n        CertificateNotValidBefore=column_ifexists('certificate.not_valid_before', ''),\r\n        CertificateSerial=column_ifexists('certificate.serial', ''),\r\n        CertificateSigAlg=column_ifexists('certificate.sig_alg', ''),\r\n        CertificateSubject=column_ifexists('certificate.subject', column_ifexists('client_subject', '')),\r\n        CertificateVersion=column_ifexists('certificate.version', ''),\r\n        CipherAlg=column_ifexists('cipher_alg', ''),\r\n        Client=column_ifexists('client', ''),\r\n        ClientMessage=column_ifexists('client_message', ''),\r\n        ClientSoftware=column_ifexists('client_software', ''),\r\n        CompileTs=column_ifexists('compile_ts', ''),\r\n        CompressionAlg=column_ifexists('compression_alg', ''),\r\n        Cshka=column_ifexists('cshka', ''),\r\n        DataChannelOrigH=column_ifexists('data_channel.orig_h', ''),\r\n        DataChannelPassive=column_ifexists('data_channel.passive', ''),\r\n        DataChannelRespH=column_ifexists('data_channel.resp_h', ''),\r\n        DataChannelRespP=column_ifexists('data_channel.resp_p', ''),\r\n        Date=column_ifexists('date', ''),\r\n        Depth=column_ifexists('depth', ''),\r\n        DhcpAssignedIpAddr=column_ifexists('assigned_addr', ''),\r\n        DhcpCircuitId=column_ifexists('circuit_id', ''),\r\n        DhcpLeaseTime=column_ifexists('lease_time', ''),\r\n        DhcpRequestedIpAddr=column_ifexists('requested_addr', ''),\r\n        DhcpSubscriberId=column_ifexists('subscriber_id', ''),\r\n        Direction=column_ifexists('direction', ''),\r\n        Dnp3FunctionReply=column_ifexists('fc_reply', ''),\r\n        Dnp3FunctionRequest=column_ifexists('fc_request', ''),\r\n        Dnp3Iin=column_ifexists('iin', ''),\r\n        DnsAdditionalAuthoritativeName=column_ifexists('auth', ''),\r\n        DnsAdditionalName=column_ifexists('addl', ''),\r\n        DnsFlagsAuthoritative=column_ifexists('AA', ''),\r\n        DnsFlagsRecursionAvailable=column_ifexists('RA', ''),\r\n        DnsFlagsRecursionDesired=column_ifexists('RD', ''),\r\n        DnsFlagsTruncated=column_ifexists('TC', ''),\r\n        DnsFlagsZ=column_ifexists('Z', ''),\r\n        DnsQueryClass=column_ifexists('qclass', ''),\r\n        DnsQueryClassName=column_ifexists('qclass_name', ''),\r\n        DnsQueryName=column_ifexists('query', ''),\r\n        DnsQueryType=column_ifexists('qtype', ''),\r\n        DnsQueryTypeName=column_ifexists('qtype_name', ''),\r\n        DnsRejected=column_ifexists('rejected', ''),\r\n        DnsResponseCode=column_ifexists('rcode', ''),\r\n        DnsResponseCodeName=column_ifexists('rcode_name', ''),\r\n        DnsResponseName=column_ifexists('answers', ''),\r\n        DnsResponseTtl=column_ifexists('TTLs', ''),\r\n        DnsRtt=column_ifexists('rtt', ''),\r\n        DnsTransactionId=column_ifexists('trans_id', ''),\r\n        Domainname=column_ifexists('domainname', ''),\r\n        Dropped=column_ifexists('dropped', ''),\r\n        Dst=column_ifexists('dst', ''),\r\n        DstBytes=column_ifexists('resp_bytes', ''),\r\n        DstCertificateIssuerName=column_ifexists('issuer', ''),\r\n        DstCertificateSha1=column_ifexists('resp_certificate_sha1', ''),\r\n        DstCertificateSubjectName=column_ifexists('subject', ''),\r\n        DstHostName=column_ifexists('http_header_host', column_ifexists('tls_server_name', '')),\r\n        DstIpAddr=column_ifexists('id.resp_h', column_ifexists('server_addr', column_ifexists('tx_hosts', ''))),\r\n        DstIpBytes=column_ifexists('resp_ip_bytes', ''),\r\n        DstMac=column_ifexists('resp_l2_addr', ''),\r\n        DstPackets=column_ifexists('resp_pkts', ''),\r\n        DstPort=column_ifexists('id.resp_p', ''),\r\n        Duration=column_ifexists('duration', ''),\r\n        EmailBodySections=column_ifexists('email_body_sections', ''),\r\n        EventDuration=column_ifexists('duration', ''),\r\n        EventUid=column_ifexists('z_Enrichment', column_ifexists('zeek_id_uids', column_ifexists('uid', ''))),\r\n        FailureReason=column_ifexists('failure_reason', ''),\r\n        FileAccessedTime=column_ifexists('times_accessed', ''),\r\n        FileChangedTime=column_ifexists('times_changed', ''),\r\n        FileCreationTime=column_ifexists('times_created', ''),\r\n        FileDesc=column_ifexists('file_desc', ''),\r\n        FileDirectory=column_ifexists('cwd', ''),\r\n        FileMimeType=column_ifexists('file_mime_type', column_ifexists('mime_type', column_ifexists('resp_mime_types', ''))),\r\n        FileModifiedTime=column_ifexists('times_modified', ''),\r\n        FileName=column_ifexists('filename', column_ifexists('resp_filenames', '')),\r\n        FilePath=column_ifexists('file_name', ''),\r\n        FilePreviousName=column_ifexists('prev_name', ''),\r\n        FileSize=column_ifexists('file_size', column_ifexists('total_bytes', column_ifexists('size', ''))),\r\n        FileSystemType=column_ifexists('native_file_system', ''),\r\n        FingerprintNetworkCommunityId=column_ifexists('community_id', ''),\r\n        FirstReceived=column_ifexists('first_received', ''),\r\n        FlowId=column_ifexists('flow_id', ''),\r\n        From=column_ifexists('from', ''),\r\n        FtpCommandLine=column_ifexists('arg', ''),\r\n        FtpPassive=column_ifexists('ftp_passive', ''),\r\n        FtpProcessName=column_ifexists('command', ''),\r\n        Fuid=column_ifexists('fuid', ''),\r\n        Fuids=column_ifexists('fuids', ''),\r\n        HasCertTable=column_ifexists('has_cert_table', ''),\r\n        HasDebugData=column_ifexists('has_debug_data', ''),\r\n        HasExportTable=column_ifexists('has_export_table', ''),\r\n        HasImportTable=column_ifexists('has_import_table', ''),\r\n        HashJa3=column_ifexists('ja3', ''),\r\n        HashJa3s=column_ifexists('ja3s', ''),\r\n        HashMd5=column_ifexists('md5', ''),\r\n        HashSha1=column_ifexists('sha1', ''),\r\n        HashSha256=column_ifexists('sha256', ''),\r\n        Hassh=column_ifexists('hassh', ''),\r\n        Hasshalgorithms=column_ifexists('hasshAlgorithms', ''),\r\n        Hasshserver=column_ifexists('hasshServer', ''),\r\n        Hasshserveralgorithms=column_ifexists('hasshServerAlgorithms', ''),\r\n        Hasshversion=column_ifexists('hasshVersion', ''),\r\n        Helo=column_ifexists('helo', ''),\r\n        Host=column_ifexists('host', ''),\r\n        HostKey=column_ifexists('host_key', ''),\r\n        HostKeyAlg=column_ifexists('host_key_alg', ''),\r\n        HostP=column_ifexists('host_p', ''),\r\n        Hostname=column_ifexists('hostname', ''),\r\n        HttpCookieVariables=column_ifexists('cookie_vars', ''),\r\n        HttpInformationalCode=column_ifexists('info_code', ''),\r\n        HttpInformationalMessage=column_ifexists('info_msg', ''),\r\n        HttpProxiedHeaders=column_ifexists('proxied', ''),\r\n        HttpReferrerOriginal=column_ifexists('referrer', ''),\r\n        HttpRequestBodyBytes=column_ifexists('request_body_len', ''),\r\n        HttpRequestHeaderHost=column_ifexists('host', ''),\r\n        HttpRequestHeaderNames=column_ifexists('client_header_names', ''),\r\n        HttpRequestHeaderOrigin=column_ifexists('origin', ''),\r\n        HttpRequestMethod=column_ifexists('method', ''),\r\n        HttpResponseBodyBytes=column_ifexists('response_body_len', ''),\r\n        HttpResponseBodyOriginal=column_ifexists('post_body', ''),\r\n        HttpResponseHeaderNames=column_ifexists('server_header_names', ''),\r\n        HttpStatusCode=column_ifexists('status_code', ''),\r\n        HttpStatusMessage=column_ifexists('status_msg', ''),\r\n        HttpVersion=column_ifexists('version', ''),\r\n        Id=column_ifexists('id', ''),\r\n        InReplyTo=column_ifexists('in_reply_to', ''),\r\n        Is64bit=column_ifexists('is_64bit', ''),\r\n        IsExe=column_ifexists('is_exe', ''),\r\n        IsOrig=column_ifexists('is_orig', ''),\r\n        IsWebmail=column_ifexists('is_webmail', ''),\r\n        KexAlg=column_ifexists('kex_alg', ''),\r\n        LastReply=column_ifexists('last_reply', ''),\r\n        LocalOrig=column_ifexists('local_orig', ''),\r\n        Logcert=column_ifexists('logcert', ''),\r\n        MacAlg=column_ifexists('mac_alg', ''),\r\n        Machine=column_ifexists('machine', ''),\r\n        Mailfrom=column_ifexists('mailfrom', ''),\r\n        Matched=column_ifexists('matched', ''),\r\n        MimeType=column_ifexists('mime_type', ''),\r\n        Msg=column_ifexists('msg', ''),\r\n        MsgId=column_ifexists('msg_id', ''),\r\n        MsgOrig=column_ifexists('msg_orig', ''),\r\n        MsgTypes=column_ifexists('msg_types', ''),\r\n        N=column_ifexists('n', ''),\r\n        Name=column_ifexists('name', ''),\r\n        NetworkApplication=column_ifexists('service', ''),\r\n        NetworkConnectionHistory=column_ifexists('history', ''),\r\n        NetworkConnectionState=column_ifexists('conn_state', ''),\r\n        NetworkInnerVlanId=column_ifexists('inner_vlan', ''),\r\n        NetworkMissedBytes=column_ifexists('missed_bytes', ''),\r\n        NetworkOuterVlanId=column_ifexists('vlan', ''),\r\n        NetworkProtocol=case(EventType == \"smb_files\" or EventType == \"smb_mapping\" or EventType == \"ssl\" or EventType == \"ssl_red\" or EventType == \"http\" or EventType == \"http_red\", \"tcp\",EventType == \"dhcp\", \"udp\",column_ifexists('proto','')),\r\n        Node=column_ifexists('node', ''),\r\n        Note=column_ifexists('note', ''),\r\n        Notice=column_ifexists('notice', ''),\r\n        Os=column_ifexists('os', ''),\r\n        OscpValidationStatus=column_ifexists('ocsp_status', ''),\r\n        P=column_ifexists('p', ''),\r\n        PacketSegment=column_ifexists('packet_segment', ''),\r\n        Path=column_ifexists('path', ''),\r\n        PcapCount=column_ifexists('pcap_cnt', ''),\r\n        Peer=column_ifexists('peer', ''),\r\n        PeerDescr=column_ifexists('peer_descr', ''),\r\n        Rcptto=column_ifexists('rcptto', ''),\r\n        RemoteLocationCity=column_ifexists('remote_location.city', ''),\r\n        RemoteLocationCountryCode=column_ifexists('remote_location.country_code', ''),\r\n        RemoteLocationLatitude=column_ifexists('remote_location.latitude', ''),\r\n        RemoteLocationLongitude=column_ifexists('remote_location.longitude', ''),\r\n        RemoteLocationRegion=column_ifexists('remote_location.region', ''),\r\n        ReplyCode=column_ifexists('reply_code', ''),\r\n        ReplyMsg=column_ifexists('reply_msg', ''),\r\n        ReplyTo=column_ifexists('reply_to', ''),\r\n        SanDns=column_ifexists('san.dns', ''),\r\n        SanEmail=column_ifexists('san.email', ''),\r\n        SanIp=column_ifexists('san.ip', ''),\r\n        SanUri=column_ifexists('san.uri', '') ,\r\n        SecondReceived=column_ifexists('second_received', ''),\r\n        SectionNames=column_ifexists('section_names', ''),\r\n        SeenIndicator=column_ifexists('seen.indicator', ''),\r\n        SeenIndicatorType=column_ifexists('seen.indicator_type', ''),\r\n        SeenWhere=column_ifexists('seen.where', ''),\r\n        Server=column_ifexists('server', ''),\r\n        ServerDnsComputerName=column_ifexists('server_dns_computer_name', ''),\r\n        ServerMessage=column_ifexists('server_message', ''),\r\n        ServerNbComputerName=column_ifexists('server_nb_computer_name', ''),\r\n        ServerSoftware=column_ifexists('server_software', ''),\r\n        ServerTreeName=column_ifexists('server_tree_name', ''),\r\n        Service=column_ifexists('service', ''),\r\n        ShareName=column_ifexists('path', ''),\r\n        ShareRelativeTargetName=column_ifexists('name', ''),\r\n        ShareType=column_ifexists('share_type', ''),\r\n        SmbAction=column_ifexists('action', ''),\r\n        SoftwareFlashVersionOriginal=column_ifexists('flash_version', ''),\r\n        SoftwareType=column_ifexists('software_type', ''),\r\n        Source=column_ifexists('source', ''),\r\n        Sources=column_ifexists('sources', ''),\r\n        Src=column_ifexists('src', ''),\r\n        SrcBytes=column_ifexists('orig_bytes', ''),\r\n        SrcDomain=column_ifexists('domain', ''),\r\n        SrcFileName=column_ifexists('orig_filenames', ''),\r\n        SrcFilePath=column_ifexists('src_file_name', ''),\r\n        SrcFqdn=column_ifexists('client_fqdn', ''),\r\n        SrcHostName=column_ifexists('host_name', ''),\r\n        SrcIpAddr=column_ifexists('id.orig_h', column_ifexists('rx_hosts', column_ifexists('client_addr', ''))),\r\n        SrcIpBytes=column_ifexists('orig_ip_bytes', ''),\r\n        SrcMac=column_ifexists('mac', column_ifexists('orig_l2_addr', '')),\r\n        SrcMimeType=column_ifexists('orig_mime_types', ''),\r\n        SrcPackets=column_ifexists('orig_pkts', ''),\r\n        SrcPort=column_ifexists('id.orig_p', ''),\r\n        Sub=column_ifexists('sub', ''),\r\n        Subject=column_ifexists('subject', ''),\r\n        SubpressFor=column_ifexists('subpress_for', ''),\r\n        Subsystem=column_ifexists('subsystem', ''),\r\n        Success=column_ifexists('success', ''),\r\n        SuricataId=column_ifexists('suri_id', ''),\r\n        SuricataIds=column_ifexists('suri_ids', ''),\r\n        Tls=column_ifexists('tls', ''),\r\n        TlsCertificateValidationStatus=column_ifexists('validation_status', ''),\r\n        TlsCipher=column_ifexists('cipher', ''),\r\n        TlsCurve=column_ifexists('curve', ''),\r\n        TlsEstablished=column_ifexists('established', ''),\r\n        TlsLastAlert=column_ifexists('last_alert', ''),\r\n        TlsNextProtocol=column_ifexists('next_protocol', ''),\r\n        TlsNotaryResponse=column_ifexists('notary', ''),\r\n        TlsResumed=column_ifexists('resumed', ''),\r\n        TlsServerName=column_ifexists('server_name', ''),\r\n        TlsVersion=column_ifexists('version', ''),\r\n        TlsVersionNumber=column_ifexists('version_num', ''),\r\n        To=column_ifexists('to', ''),\r\n        TransactionId=column_ifexists('tx_id', ''),\r\n        TransDepth=column_ifexists('trans_depth', ''),\r\n        TunnelType=column_ifexists('tunnel_type', ''),\r\n        UnparsedVersion=column_ifexists('unparsed_version', ''),\r\n        Url=column_ifexists('url', ''),\r\n        UrlOriginal=column_ifexists('uri', ''),\r\n        UrlQueryValues=column_ifexists('uri_vars', ''),\r\n        UserAgent=column_ifexists('user_agent', ''),\r\n        UserAgentOriginal=column_ifexists('user_agent', ''),\r\n        UserName=column_ifexists('user', column_ifexists('username', '')),\r\n        UserPassword=column_ifexists('password', ''),\r\n        Username=column_ifexists('username', ''),\r\n        UsesAslr=column_ifexists('uses_aslr', ''),\r\n        UsesCodeIntegrity=column_ifexists('uses_code_integrity', ''),\r\n        UsesDep=column_ifexists('uses_dep', ''),\r\n        UsesSeh=column_ifexists('uses_seh', ''),\r\n        ValidCtLogs=column_ifexists('valid_ct_logs', ''),\r\n        ValidCtOperators=column_ifexists('valid_ct_operators', ''),\r\n        ValidCtOperatorsList=column_ifexists('valid_ct_operators_list', ''),\r\n        Version=column_ifexists('version', ''),\r\n        VersionAddl=column_ifexists('version.addl', ''),\r\n        VersionMajor=column_ifexists('version.major', ''),\r\n        VersionMinor2=column_ifexists('version.minor2', ''),\r\n        VersionMinor3=column_ifexists('version.minor3', ''),\r\n        VersionMinor=column_ifexists('version.minor', ''),\r\n        X509=column_ifexists('x509', ''),\r\n        XOriginatingIp=column_ifexists('x_originating_ip', ''),\r\n        ZeekConnLocalDst=column_ifexists('local_resp', ''),\r\n        ZeekConnLocalSrc=column_ifexists('local_orig', ''),\r\n        ZeekFilesAnalyzers=column_ifexists('analyzers', ''),\r\n        ZeekFilesEntropy=column_ifexists('entropy', ''),\r\n        ZeekFilesExtracted=column_ifexists('extracted', ''),\r\n        ZeekFilesExtractedCutoff=column_ifexists('extracted_cutoff', ''),\r\n        ZeekFilesExtractedSize=column_ifexists('extracted_size', ''),\r\n        ZeekFilesMissingBytes=column_ifexists('missing_bytes', ''),\r\n        ZeekFilesOverflowBytes=column_ifexists('overflow_bytes', ''),\r\n        ZeekFilesSeenBytes=column_ifexists('seen_bytes', ''),\r\n        ZeekFilesTimedout=column_ifexists('timedout', ''),\r\n        ZeekHttpOmniture=column_ifexists('omniture', ''),\r\n        ZeekHttpTags=column_ifexists('tags', ''),\r\n        ZeekHttpTransDepth=column_ifexists('trans_depth', ''),\r\n        ZeekIdCertChainFuids=column_ifexists('cert_chain_fuids', ''),\r\n        ZeekIdClientCertChainFuids=column_ifexists('client_cert_chain_fuids', ''),\r\n        ZeekIdConnUids=column_ifexists('conn_uids', ''),\r\n        ZeekIdFuid=column_ifexists('fuid', ''),\r\n        ZeekIdOrigFuids=column_ifexists('orig_fuids', ''),\r\n        ZeekIdParentFuid=column_ifexists('parent_fuid', ''),\r\n        ZeekIdRespFuids=column_ifexists('resp_fuids', ''),\r\n        ZeekIdTunnelParents=column_ifexists('tunnel_parents', ''),\r\n        ZeekIdUids=column_ifexists('uids', ''),\r\n        ZeekMetaDstIpAddrHostName=column_ifexists('id.resp_h_name.vals', ''),\r\n        ZeekMetaDstIpAddrSource=column_ifexists('id.resp_h_name.src', ''),\r\n        ZeekMetaSrcIpAddrHostName=column_ifexists('id.orig_h_name.vals', ''),\r\n        ZeekMetaSrcIpAddrSource=column_ifexists('id.orig_h_name.src', ''),\r\n        ZeekOrigCc=column_ifexists('orig_cc', ''),\r\n        ZeekRespCc=column_ifexists('resp_cc', '')\r\n       | project\r\n        DvcHostname,\r\n        SrcDvcHostname,\r\n        EventEndTime,\r\n        Message,\r\n        TimeGenerated, \r\n        EventType,\r\n        EventVendor,\r\n        EventProduct,\r\n        Action,\r\n        Actions,\r\n        AgentRemoteId,\r\n        AlertCategory,\r\n        AlertGroupId,\r\n        AlertMetadata,\r\n        AlertRevision,\r\n        AlertSeverity,\r\n        AlertSignature,\r\n        AlertSignatureId,\r\n        Analyzer,\r\n        AuthAttempts,\r\n        AuthSuccess,\r\n        BasicConstraintsCa,\r\n        BasicConstraintsPathLen,\r\n        Cc,\r\n        CertificateCn,\r\n        CertificateCurve,\r\n        CertificateExponent,\r\n        CertificateHashSha1,\r\n        CertificateIssuer,\r\n        CertificateKeyAlg,\r\n        CertificateKeyLength,\r\n        CertificateKeyType,\r\n        CertificateNotValidAfter,\r\n        CertificateNotValidBefore,\r\n        CertificateSerial,\r\n        CertificateSigAlg,\r\n        CertificateSubject,\r\n        CertificateVersion,\r\n        CipherAlg,\r\n        Client,\r\n        ClientMessage,\r\n        ClientSoftware,\r\n        CompileTs,\r\n        CompressionAlg,\r\n        Cshka,\r\n        DataChannelOrigH,\r\n        DataChannelPassive,\r\n        DataChannelRespH,\r\n        DataChannelRespP,\r\n        Date,\r\n        Depth,\r\n        DhcpAssignedIpAddr,\r\n        DhcpCircuitId,\r\n        DhcpLeaseTime,\r\n        DhcpRequestedIpAddr,\r\n        DhcpSubscriberId,\r\n        Direction,\r\n        Dnp3FunctionReply,\r\n        Dnp3FunctionRequest,\r\n        Dnp3Iin,\r\n        DnsAdditionalAuthoritativeName,\r\n        DnsAdditionalName,\r\n        DnsFlagsAuthoritative,\r\n        DnsFlagsRecursionAvailable,\r\n        DnsFlagsRecursionDesired,\r\n        DnsFlagsTruncated,\r\n        DnsFlagsZ,\r\n        DnsQueryClass,\r\n        DnsQueryClassName,\r\n        DnsQueryName,\r\n        DnsQueryType,\r\n        DnsQueryTypeName,\r\n        DnsRejected,\r\n        DnsResponseCode,\r\n        DnsResponseCodeName,\r\n        DnsResponseName,\r\n        DnsResponseTtl,\r\n        DnsRtt,\r\n        DnsTransactionId,\r\n        Domainname,\r\n        Dropped,\r\n        Dst,\r\n        DstBytes,\r\n        DstCertificateIssuerName,\r\n        DstCertificateSha1,\r\n        DstCertificateSubjectName,\r\n        DstHostName,\r\n        DstIpAddr,\r\n        DstIpBytes,\r\n        DstMac,\r\n        DstPackets,\r\n        DstPort,\r\n        Duration,\r\n        EmailBodySections,\r\n        EventDuration,\r\n        EventUid,\r\n        FailureReason,\r\n        FileAccessedTime,\r\n        FileChangedTime,\r\n        FileCreationTime,\r\n        FileDesc,\r\n        FileDirectory,\r\n        FileMimeType,\r\n        FileModifiedTime,\r\n        FileName,\r\n        FilePath,\r\n        FilePreviousName,\r\n        FileSize,\r\n        FileSystemType,\r\n        FingerprintNetworkCommunityId,\r\n        FirstReceived,\r\n        FlowId,\r\n        From,\r\n        FtpCommandLine,\r\n        FtpPassive,\r\n        FtpProcessName,\r\n        Fuid,\r\n        Fuids,\r\n        HasCertTable,\r\n        HasDebugData,\r\n        HasExportTable,\r\n        HasImportTable,\r\n        HashJa3,\r\n        HashJa3s,\r\n        HashMd5,\r\n        HashSha1,\r\n        HashSha256,\r\n        Hassh,\r\n        Hasshalgorithms,\r\n        Hasshserver,\r\n        Hasshserveralgorithms,\r\n        Hasshversion,\r\n        Helo,\r\n        Host,\r\n        HostKey,\r\n        HostKeyAlg,\r\n        HostP,\r\n        Hostname,\r\n        HttpCookieVariables,\r\n        HttpInformationalCode,\r\n        HttpInformationalMessage,\r\n        HttpProxiedHeaders,\r\n        HttpReferrerOriginal,\r\n        HttpRequestBodyBytes,\r\n        HttpRequestHeaderHost,\r\n        HttpRequestHeaderNames,\r\n        HttpRequestHeaderOrigin,\r\n        HttpRequestMethod,\r\n        HttpResponseBodyBytes,\r\n        HttpResponseBodyOriginal,\r\n        HttpResponseHeaderNames,\r\n        HttpStatusCode,\r\n        HttpStatusMessage,\r\n        HttpVersion,\r\n        Id,\r\n        InReplyTo,\r\n        Is64bit,\r\n        IsExe,\r\n        IsOrig,\r\n        IsWebmail,\r\n        KexAlg,\r\n        LastReply,\r\n        LocalOrig,\r\n        Logcert,\r\n        MacAlg,\r\n        Machine,\r\n        Mailfrom,\r\n        Matched,\r\n        MimeType,\r\n        Msg,\r\n        MsgId,\r\n        MsgOrig,\r\n        MsgTypes,\r\n        N,\r\n        Name,\r\n        NetworkApplication,\r\n        NetworkConnectionHistory,\r\n        NetworkConnectionState,\r\n        NetworkInnerVlanId,\r\n        NetworkMissedBytes,\r\n        NetworkOuterVlanId,\r\n        NetworkProtocol,\r\n        Node,\r\n        Note,\r\n        Notice,\r\n        Os,\r\n        OscpValidationStatus,\r\n        P,\r\n        PacketSegment,\r\n        Path,\r\n        PcapCount,\r\n        Peer,\r\n        PeerDescr,\r\n        Rcptto,\r\n        RemoteLocationCity,\r\n        RemoteLocationCountryCode,\r\n        RemoteLocationLatitude,\r\n        RemoteLocationLongitude,\r\n        RemoteLocationRegion,\r\n        ReplyCode,\r\n        ReplyMsg,\r\n        ReplyTo,\r\n        SanDns,\r\n        SanEmail,\r\n        SanIp,\r\n        SanUri,\r\n        SecondReceived,\r\n        SectionNames,\r\n        SeenIndicator,\r\n        SeenIndicatorType,\r\n        SeenWhere,\r\n        Server,\r\n        ServerDnsComputerName,\r\n        ServerMessage,\r\n        ServerNbComputerName,\r\n        ServerSoftware,\r\n        ServerTreeName,\r\n        Service,\r\n        ShareName,\r\n        ShareRelativeTargetName,\r\n        ShareType,\r\n        SmbAction,\r\n        SoftwareFlashVersionOriginal,\r\n        SoftwareType,\r\n        Source,\r\n        Sources,\r\n        Src,\r\n        SrcBytes,\r\n        SrcDomain,\r\n        SrcFileName,\r\n        SrcFilePath,\r\n        SrcFqdn,\r\n        SrcHostName,\r\n        SrcIpAddr,\r\n        SrcIpBytes,\r\n        SrcMac,\r\n        SrcMimeType,\r\n        SrcPackets,\r\n        SrcPort,\r\n        Sub,\r\n        Subject,\r\n        SubpressFor,\r\n        Subsystem,\r\n        Success,\r\n        SuricataId,\r\n        SuricataIds,\r\n        Tls,\r\n        TlsCertificateValidationStatus,\r\n        TlsCipher,\r\n        TlsCurve,\r\n        TlsEstablished,\r\n        TlsLastAlert,\r\n        TlsNextProtocol,\r\n        TlsNotaryResponse,\r\n        TlsResumed,\r\n        TlsServerName,\r\n        TlsVersion,\r\n        TlsVersionNumber,\r\n        To,\r\n        TransactionId,\r\n        TransDepth,\r\n        TunnelType,\r\n        UnparsedVersion,\r\n        Url,\r\n        UrlOriginal,\r\n        UrlQueryValues,\r\n        UserAgent,\r\n        UserAgentOriginal,\r\n        UserName,\r\n        UserPassword,\r\n        Username,\r\n        UsesAslr,\r\n        UsesCodeIntegrity,\r\n        UsesDep,\r\n        UsesSeh,\r\n        ValidCtLogs,\r\n        ValidCtOperators,\r\n        ValidCtOperatorsList,\r\n        Version,\r\n        VersionAddl,\r\n        VersionMajor,\r\n        VersionMinor2,\r\n        VersionMinor3,\r\n        VersionMinor,\r\n        X509,\r\n        XOriginatingIp,\r\n        ZeekConnLocalDst,\r\n        ZeekConnLocalSrc,\r\n        ZeekFilesAnalyzers,\r\n        ZeekFilesEntropy,\r\n        ZeekFilesExtracted,\r\n        ZeekFilesExtractedCutoff,\r\n        ZeekFilesExtractedSize,\r\n        ZeekFilesMissingBytes,\r\n        ZeekFilesOverflowBytes,\r\n        ZeekFilesSeenBytes,\r\n        ZeekFilesTimedout,\r\n        ZeekHttpOmniture,\r\n        ZeekHttpTags,\r\n        ZeekHttpTransDepth,\r\n        ZeekIdCertChainFuids,\r\n        ZeekIdClientCertChainFuids,\r\n        ZeekIdConnUids,\r\n        ZeekIdFuid,\r\n        ZeekIdOrigFuids,\r\n        ZeekIdParentFuid,\r\n        ZeekIdRespFuids,\r\n        ZeekIdTunnelParents,\r\n        ZeekIdUids,\r\n        ZeekMetaDstIpAddrHostName,\r\n        ZeekMetaDstIpAddrSource,\r\n        ZeekMetaSrcIpAddrHostName,\r\n        ZeekMetaSrcIpAddrSource,\r\n        ZeekOrigCc,\r\n        ZeekRespCc\r\n};\r\nCorelight_main_view\r\n\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId1')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
        "contentId": "[variables('_parserContentId1')]",
        "kind": "Parser",
        "version": "[variables('parserVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Corelight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Corelight"
        },
        "support": {
          "name": "Corelight",
          "tier": "Partner",
          "link": "https://support.corelight.com/"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "Corelight Hunting Query 1 with template",
        "displayName": "Corelight Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName1'),'/',variables('huntingQueryVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "CorelightAbnormalEmailSubject_HuntingQueries Hunting Query with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "Corelight_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight - Abnormal Email Subject",
                "category": "Hunting Queries",
                "query": "Corelight\n| where EventType =~ 'smtp'\n| where Subject hasprefix @'\\=?utf-16'\n| extend MailCustomEntity = To\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for emails with NON-Ascii characters within the Subject ."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1566"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId1'),'/'))))]",
              "properties": {
                "description": "Corelight Hunting Query 1",
                "parentId": "[variables('huntingQueryId1')]",
                "contentId": "[variables('_huntingQuerycontentId1')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "Corelight Hunting Query 2 with template",
        "displayName": "Corelight Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName2'),'/',variables('huntingQueryVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "CorelightCompressedFilesTransferredOverHTTP_HuntingQueries Hunting Query with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "Corelight_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight - Compressed Files Transferred over HTTP",
                "category": "Hunting Queries",
                "query": "Corelight\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'http'\n| where HttpRequestMethod in~ ('POST', 'PUT')\n| where SrcMimeType in~ ('application/vnd.ms-cab-compressed', 'application/warc', 'application/x-7z-compressed', 'application/x-ace', 'application/x-arc', 'application/x-archive', 'application/x-arj', 'application/x-compress', 'application/x-cpio', 'application/x-dmg', 'application/x-eet', 'application/x-gzip', 'application/x-lha', 'application/x-lrzip', 'application/x-lz4', 'application/x-lzma', 'application/x-lzh', 'application/x-lzip', 'application/x-rar', 'application/x-rpm', 'application/x-stuffit', 'application/x-tar', 'application/x-xz', 'application/x-zoo', 'application/zip')\n| summarize count() by SrcIpAddr\n| top 10 by count_\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for top sources which transferred compressed archives over HTTP."
                  },
                  {
                    "name": "tactics",
                    "value": "Exfiltration"
                  },
                  {
                    "name": "techniques",
                    "value": "T1560"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId2'),'/'))))]",
              "properties": {
                "description": "Corelight Hunting Query 2",
                "parentId": "[variables('huntingQueryId2')]",
                "contentId": "[variables('_huntingQuerycontentId2')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "Corelight Hunting Query 3 with template",
        "displayName": "Corelight Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName3'),'/',variables('huntingQueryVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "CorelightDataTransferedByIp_HuntingQueries Hunting Query with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "Corelight_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight - Top sources of data transferred",
                "category": "Hunting Queries",
                "query": "Corelight\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'http'\n| where HttpRequestMethod in~ ('POST', 'PUT')\n| summarize data_sent = sum(tolong(HttpRequestBodyBytes)) by SrcIpAddr\n| top 10 by data_sent\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for top sources by transferred data over period of time."
                  },
                  {
                    "name": "tactics",
                    "value": "Exfiltration"
                  },
                  {
                    "name": "techniques",
                    "value": "T1560"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId3'),'/'))))]",
              "properties": {
                "description": "Corelight Hunting Query 3",
                "parentId": "[variables('huntingQueryId3')]",
                "contentId": "[variables('_huntingQuerycontentId3')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "Corelight Hunting Query 4 with template",
        "displayName": "Corelight Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName4'),'/',variables('huntingQueryVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "CorelightExternalServices_HuntingQueries Hunting Query with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "Corelight_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight - External Facing Services",
                "category": "Hunting Queries",
                "query": "Corelight\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'conn'\n| where ipv4_is_private(SrcIpAddr) == 'False'\n| where isnotempty(DstPort)\n| where NetworkConnectionHistory startswith 'Sh'\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for external facing services."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId4'),'/'))))]",
              "properties": {
                "description": "Corelight Hunting Query 4",
                "parentId": "[variables('huntingQueryId4')]",
                "contentId": "[variables('_huntingQuerycontentId4')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "Corelight Hunting Query 5 with template",
        "displayName": "Corelight Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName5'),'/',variables('huntingQueryVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "CorelightFilesSeen_HuntingQueries Hunting Query with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "Corelight_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight - Files in logs",
                "category": "Hunting Queries",
                "query": "Corelight\n| where isnotempty(FileName)\n| summarize makeset(FileName) by SrcIpAddr\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for files which where seen in logs over period of time."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,Exfiltration"
                  },
                  {
                    "name": "techniques",
                    "value": "T1566,T1560"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId5'),'/'))))]",
              "properties": {
                "description": "Corelight Hunting Query 5",
                "parentId": "[variables('huntingQueryId5')]",
                "contentId": "[variables('_huntingQuerycontentId5')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "Corelight Hunting Query 6 with template",
        "displayName": "Corelight Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName6'),'/',variables('huntingQueryVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "CorelightFilesTransferedByIp_HuntingQueries Hunting Query with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "Corelight_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight - File transferred by source",
                "category": "Hunting Queries",
                "query": "Corelight\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'http'\n| where HttpRequestMethod in~ ('POST', 'PUT')\n| where isnotempty(FilePath)\n| summarize f_list = makeset(FilePath) by SrcIpAddr\n| extend f_cnt = array_length(f_list)\n| order by f_cnt\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for files transferred over period of time by each source."
                  },
                  {
                    "name": "tactics",
                    "value": "Exfiltration"
                  },
                  {
                    "name": "techniques",
                    "value": "T1560"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId6'),'/'))))]",
              "properties": {
                "description": "Corelight Hunting Query 6",
                "parentId": "[variables('huntingQueryId6')]",
                "contentId": "[variables('_huntingQuerycontentId6')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "Corelight Hunting Query 7 with template",
        "displayName": "Corelight Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName7'),'/',variables('huntingQueryVersion7'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName7'))]"
      ],
      "properties": {
        "description": "CorelightMultipleRemoteSMBConnectionsFromSingleIP_HuntingQueries Hunting Query with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "Corelight_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight - Multiple Remote SMB Connections from single client",
                "category": "Hunting Queries",
                "query": "let threshold = 50;\nCorelight\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'smb_mapping'\n| where isnotempty(ShareName)\n| summarize sh_cnt = dcount(ShareName) by SrcIpAddr, bin(TimeGenerated, 1m)\n| where sh_cnt > threshold\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Detects when a single source is connecting to many different SMB or file shares."
                  },
                  {
                    "name": "tactics",
                    "value": "Discovery"
                  },
                  {
                    "name": "techniques",
                    "value": "T1135"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId7'),'/'))))]",
              "properties": {
                "description": "Corelight Hunting Query 7",
                "parentId": "[variables('huntingQueryId7')]",
                "contentId": "[variables('_huntingQuerycontentId7')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "Corelight Hunting Query 8 with template",
        "displayName": "Corelight Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName8'),'/',variables('huntingQueryVersion8'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName8'))]"
      ],
      "properties": {
        "description": "CorelightObfuscatedBinary_HuntingQueries Hunting Query with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "Corelight_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight - Obfuscated binary filenames",
                "category": "Hunting Queries",
                "query": "Corelight\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'http'\n| where FileMimeType in~ ('application/java-archive', 'application/mshelp', 'application/chrome-ext', 'application/x-object', 'application/x-executable', 'application/x-dosexec', 'application/x-msdownload', 'application/vnd.microsoft.portable-executable ')\n| where UrlOriginal !hassuffix '.exe' or UrlOriginal !hassuffix '.dll' or UrlOriginal !hassuffix '.msi'\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for downloaded obfuscated binary file names."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1189,T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId8'),'/'))))]",
              "properties": {
                "description": "Corelight Hunting Query 8",
                "parentId": "[variables('huntingQueryId8')]",
                "contentId": "[variables('_huntingQuerycontentId8')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "Corelight Hunting Query 9 with template",
        "displayName": "Corelight Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName9'),'/',variables('huntingQueryVersion9'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName9'))]"
      ],
      "properties": {
        "description": "CorelightRarePOST_HuntingQueries Hunting Query with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "Corelight_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight - Rare PUT or POST",
                "category": "Hunting Queries",
                "query": "Corelight\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'http'\n| where HttpRequestMethod in~ ('POST', 'PUT')\n| where HttpStatusCode !startswith '4'\n| where HttpRequestBodyBytes != 0 or HttpResponseBodyBytes != 0\n| extend fe = extract(@'.*(\\.\\w+)$', 1, UrlOriginal)\n| where fe in~ ('.aspx', '.asp', '.php', '.jsp', '.jspx', '.war', '.ashx', '.asmx', '.ascx', '.asx', '.cshtml', '.cfm', '.cfc', '.cfml', '.wss', '.do', '.action', '.pl', '.plx', '.pm', '.xs', '.t', '.pod', '.php-s', '.pht', '.phar', '.phps', '.php7', '.php5', '.php4', '.php3', '.phtml', '.py', '.rb', '.rhtml', '.cgi', '.dll', '.ayws', '.cgi', '.erb', '.rjs', '.hta', '.htc', '.cs', '.kt', '.lua', '.vbhtml')\n| summarize count() by SrcIpAddr\n| where count_ < 10\n| order by count_ asc\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for rare post requests to a single location."
                  },
                  {
                    "name": "tactics",
                    "value": "Persistence"
                  },
                  {
                    "name": "techniques",
                    "value": "T1100,T1505"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId9'),'/'))))]",
              "properties": {
                "description": "Corelight Hunting Query 9",
                "parentId": "[variables('huntingQueryId9')]",
                "contentId": "[variables('_huntingQuerycontentId9')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "Corelight Hunting Query 10 with template",
        "displayName": "Corelight Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName10'),'/',variables('huntingQueryVersion10'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName10'))]"
      ],
      "properties": {
        "description": "CorelightRepetitiveDnsFailures_HuntingQueries Hunting Query with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "Corelight_Hunting_Query_10",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Corelight - Repetitive DNS Failures",
                "category": "Hunting Queries",
                "query": "let threshold = 100;\nCorelight\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'dns'\n| where DnsResponseCodeName in~ ('NXDOMAIN', 'SERVFAIL')\n| summarize count() by SrcIpAddr, bin(TimeGenerated, 1h)\n| where count_ > threshold\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for repetitive DNS resolution failures from single host."
                  },
                  {
                    "name": "tactics",
                    "value": "CommanAndControl"
                  },
                  {
                    "name": "techniques",
                    "value": "T1094,T1043"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId10'),'/'))))]",
              "properties": {
                "description": "Corelight Hunting Query 10",
                "parentId": "[variables('huntingQueryId10')]",
                "contentId": "[variables('_huntingQuerycontentId10')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "Corelight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Corelight"
                },
                "support": {
                  "name": "Corelight",
                  "tier": "Partner",
                  "link": "https://support.corelight.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Corelight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Corelight"
        },
        "support": {
          "name": "Corelight",
          "tier": "Partner",
          "link": "https://support.corelight.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId3')]",
              "version": "[variables('analyticRuleVersion3')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId4')]",
              "version": "[variables('analyticRuleVersion4')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId5')]",
              "version": "[variables('analyticRuleVersion5')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId6')]",
              "version": "[variables('analyticRuleVersion6')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId7')]",
              "version": "[variables('analyticRuleVersion7')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId8')]",
              "version": "[variables('analyticRuleVersion8')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId9')]",
              "version": "[variables('analyticRuleVersion9')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId10')]",
              "version": "[variables('analyticRuleVersion10')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId1')]",
              "version": "[variables('parserVersion1')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId1')]",
              "version": "[variables('huntingQueryVersion1')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId2')]",
              "version": "[variables('huntingQueryVersion2')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId3')]",
              "version": "[variables('huntingQueryVersion3')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId4')]",
              "version": "[variables('huntingQueryVersion4')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId5')]",
              "version": "[variables('huntingQueryVersion5')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId6')]",
              "version": "[variables('huntingQueryVersion6')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId7')]",
              "version": "[variables('huntingQueryVersion7')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId8')]",
              "version": "[variables('huntingQueryVersion8')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId9')]",
              "version": "[variables('huntingQueryVersion9')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId10')]",
              "version": "[variables('huntingQueryVersion10')]"
            }
          ]
        },
        "firstPublishDate": "2022-06-01",
        "providers": [
          "Corelight"
        ],
        "categories": {
          "domains": [
            "IT Operations",
            "Security  Network"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
