{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for CiscoASA"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Cisco - ASA",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "CiscoASA",
    "_solutionVersion": "3.0.4",
    "solutionId": "azuresentinel.azure-sentinel-solution-ciscoasa",
    "_solutionId": "[variables('solutionId')]",
    "workbookVersion1": "1.1.0",
    "workbookContentId1": "CiscoWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "uiConfigId1": "CiscoASA",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "CiscoASA",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "uiConfigId2": "CiscoAsaAma",
    "_uiConfigId2": "[variables('uiConfigId2')]",
    "dataConnectorContentId2": "CiscoAsaAma",
    "_dataConnectorContentId2": "[variables('dataConnectorContentId2')]",
    "dataConnectorId2": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
    "_dataConnectorId2": "[variables('dataConnectorId2')]",
    "dataConnectorTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId2'))))]",
    "dataConnectorVersion2": "1.0.0",
    "_dataConnectorcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId2'),'-', variables('dataConnectorVersion2'))))]",
    "CiscoASAConnector": "CiscoASAConnector",
    "_CiscoASAConnector": "[variables('CiscoASAConnector')]",
    "TemplateEmptyArray": "[json('[]')]",
    "blanks": "[replace('b', 'b', '')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "CiscoASAConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1'))))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','lc','-', uniqueString(concat(variables('_solutionId'),'-','LogicAppsCustomConnector','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "CiscoASA-AddIPtoNetworkObjectGroup": "CiscoASA-AddIPtoNetworkObjectGroup",
    "_CiscoASA-AddIPtoNetworkObjectGroup": "[variables('CiscoASA-AddIPtoNetworkObjectGroup')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "CiscoASA-AddIPtoNetworkObjectGroup",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "CiscoASA-CreateACEInACL": "CiscoASA-CreateACEInACL",
    "_CiscoASA-CreateACEInACL": "[variables('CiscoASA-CreateACEInACL')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "CiscoASA-CreateACEInACL",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "CiscoASA-CreateInboundAccessRuleOnInterface": "CiscoASA-CreateInboundAccessRuleOnInterface",
    "_CiscoASA-CreateInboundAccessRuleOnInterface": "[variables('CiscoASA-CreateInboundAccessRuleOnInterface')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "CiscoASA-CreateInboundAccessRuleOnInterface",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4'))))]",
    "_playbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId4'),'-', variables('playbookVersion4'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.2",
      "_analyticRulecontentId1": "795edf2d-cf3e-45b5-8452-fe6c9e6a582e",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '795edf2d-cf3e-45b5-8452-fe6c9e6a582e')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('795edf2d-cf3e-45b5-8452-fe6c9e6a582e')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','795edf2d-cf3e-45b5-8452-fe6c9e6a582e','-', '1.0.2')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.2",
      "_analyticRulecontentId2": "79f29feb-6a9d-4cdf-baaa-2daf480a5da1",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '79f29feb-6a9d-4cdf-baaa-2daf480a5da1')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('79f29feb-6a9d-4cdf-baaa-2daf480a5da1')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','79f29feb-6a9d-4cdf-baaa-2daf480a5da1','-', '1.0.2')))]"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Cisco Workbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Gain insights into your Cisco ASA firewalls by analyzing traffic, events, and firewall operations.\nThis workbook analyzes Cisco ASA threat events and identifies suspicious ports, users, protocols and IP addresses.\nYou can learn about trends across user and data traffic directions, and drill down into the Cisco filter results.\nEasily detect attacks on your organization by monitoring management operations, such as configuration and logins."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Cisco\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"query\":\"\",\"parameters\":[{\"id\":\"94910267-b8f6-4b30-aa2f-e5780ad9738e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":7776000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}},{\"id\":\"bb491a9f-3089-4a2e-a6de-e7efbc77e7f6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DeviceAddress\",\"label\":\"Device Address\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| distinct DeviceAddress\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Action\\r\\nlet data = CommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where DeviceAction != ''\\r\\n| where \\\"{DeviceAddress:lable}\\\" == \\\"All\\\" or DeviceAddress in ({DeviceAddress});\\r\\ndata\\r\\n| summarize Count = count() by SimplifiedDeviceAction\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SimplifiedDeviceAction)\\r\\n on SimplifiedDeviceAction\\r\\n| project-away SimplifiedDeviceAction1, TimeGenerated\\r\\n| extend SimplifiedDeviceActions = SimplifiedDeviceAction\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend SimplifiedDeviceAction = 'All', SimplifiedDeviceActions = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":3,\"exportFieldName\":\"SimplifiedDeviceAction\",\"exportParameterName\":\"SelectedDeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Events, by action\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SimplifiedDeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"33\",\"name\":\"Events by action\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Count by Severity\\r\\nlet data = CommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where \\\"{DeviceAddress:lable}\\\" == \\\"All\\\" or DeviceAddress in ({DeviceAddress});\\r\\ndata\\r\\n| summarize Count = count() by LogSeverity\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by LogSeverity)\\r\\n on LogSeverity\\r\\n| project-away LogSeverity1, TimeGenerated\\r\\n| extend LogSeveritys = LogSeverity\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend LogSeverity = 'All', LogSeveritys = '*' \\r\\n)\\r\\n| order by Count desc, LogSeverity asc\\r\\n| take 10\",\"size\":3,\"exportFieldName\":\"LogSeverity\",\"exportParameterName\":\"SelectedLogSeverity\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Severity, by volume\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"LogSeverity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false,\"sortCriteriaField\":\"LogSeverity\",\"sortOrderField\":1}},\"customWidth\":\"33\",\"name\":\"Severity by volume\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//volume by time\\r\\nCommonSecurityLog\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where \\\"{DeviceAddress:lable}\\\" == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where '{SelectedDeviceAction}' == \\\"All\\\" or '{SelectedDeviceAction}' == SimplifiedDeviceAction\\r\\n| where '{SelectedLogSeverity}' == \\\"All\\\" or '{SelectedLogSeverity}' == LogSeverity\\r\\n| summarize Volme=count() by bin(TimeGenerated,{TimeRange:grain})\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Event trends, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"Severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//volume by time\\r\\nCommonSecurityLog\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where \\\"{DeviceAddress:lable}\\\" == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where '{SelectedDeviceAction}' == \\\"All\\\" or '{SelectedDeviceAction}' == SimplifiedDeviceAction\\r\\n| where '{SelectedLogSeverity}' == \\\"All\\\" or '{SelectedLogSeverity}' == LogSeverity\\r\\n| summarize Volume=count() by LogSeverity, bin(TimeGenerated, {TimeRange:grain})\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Event severity, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"Event severity by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where '{SelectedDeviceAction}' == \\\"All\\\" or '{SelectedDeviceAction}' == SimplifiedDeviceAction\\r\\n| where '{SelectedLogSeverity}' == \\\"All\\\" or '{SelectedLogSeverity}' == LogSeverity\\r\\n| project TimeGenerated, LogSeverity, DeviceAction, SimplifiedDeviceAction, DeviceAddress, DestinationPort, DestinationIP, Message, Protocol, SourcePort, SourceIP\\r\\n| sort by TimeGenerated desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"All events, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"filter\":true}},\"name\":\"All events, by time\"},{\"type\":1,\"content\":{\"json\":\"---\"},\"name\":\"text - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//no. of concurrent sessions\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID  == '302010'\\r\\n| extend ConcurrentSession= extract('%ASA-6-302010: ([0-9]*?) in use,',1,Message)\\r\\n| summarize AvgSession=avg(toint(ConcurrentSession)) by TimeGenerated\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Average concurrent sessions, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"33\",\"name\":\"concurrent\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Max Sessions\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID  == '302010'\\r\\n| extend MaxSessions= extract('%ASA-6-302010:.*, ([0-9].*?) most used',1,Message)\\r\\n| summarize AvgSession=avg(toint(MaxSessions)) by TimeGenerated\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Average max concurrent sessions, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"33\",\"name\":\"max concurrent\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//top 5 reason for packet drop\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID == '733100'\\r\\n| extend TrafficType= extract('%ASA-4-733100: \\\\\\\\[(.*?)\\\\\\\\]',1,Message)\\r\\n| project TrafficType\\r\\n| summarize AttackCount=count() by TrafficType\\r\\n| top 5 by AttackCount desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 reasons for packet drop\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TrafficType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"AttackCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"30\",\"name\":\"Top 5 reasons for packet drop\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Firewall log trends and activities\"},\"name\":\"text - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Communication direction count by time\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where CommunicationDirection != ''\\r\\n| summarize DirectionVolume=count() by CommunicationDirection, bin(TimeGenerated, {TimeRange:grain})\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Inbound Outbound Time Trend\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"25\",\"name\":\"Inbound Outbound Time Trend\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//out bound\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where CommunicationDirection contains   'outbound'\\r\\n| summarize TrafficVolume=count() by SimplifiedDeviceAction, TimeGenerated\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Outbound traffic connection, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"25\",\"name\":\"Outbound traffic connection by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//allowd vs denied for in bound\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where CommunicationDirection contains   'inbound'\\r\\n| where SimplifiedDeviceAction in ('Deny', 'Allow')\\r\\n| summarize TrafficVolume=count() by SimplifiedDeviceAction, TimeGenerated\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Inbound traffic events, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"25\",\"name\":\"Inbound traffic events by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Communication direction count\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where CommunicationDirection != ''\\r\\n| summarize DirectionVolume=count() by CommunicationDirection\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Summary of inbound and outbound traffic\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"25\",\"name\":\"Summary of inbound and outbound traffic\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Top 5 allowed and blocked ports\"},\"name\":\"text - 15\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//top 5 port inbound Allow \\r\\nCommonSecurityLog \\r\\n| where DeviceProduct =~ 'ASA' \\r\\n| where DeviceVendor =~ 'Cisco' \\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID == '106100'  \\r\\n | where SimplifiedDeviceAction == 'Allow' \\r\\n//| where Message contains ' -> inside'  \\r\\n| extend DestinationPortS=tostring(DestinationPort)   \\r\\n| summarize PortCount=count() by DestinationPortS \\r\\n| top 5 by PortCount desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed inbound ports\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DestinationPortS\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"PortCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 allowed inbound ports\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//top 5 port inbound deny\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where CommunicationDirection contains   'inbound'\\r\\n  | where SimplifiedDeviceAction == 'Deny'\\r\\n| extend DestinationPortS=tostring(DestinationPort)\\r\\n| summarize PortCount=count() by DestinationPortS\\r\\n| top 5 by PortCount desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 blocked inbound ports\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DestinationPortS\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"PortCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 blocked inbound ports\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//top 5 port outbound Allow\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID == '106100'\\r\\n | where SimplifiedDeviceAction == 'Allow'\\r\\n//| where Message contains ' -> management'\\r\\n| extend DestinationPortS=tostring(DestinationPort)\\r\\n| summarize PortCount=count() by DestinationPortS\\r\\n| top 5 by PortCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed outbound ports\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DestinationPortS\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"PortCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 allowed outbound ports\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Top 5 Outbound Ports Denied\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where CommunicationDirection contains'outbound'\\r\\n| where SimplifiedDeviceAction =='Deny'\\r\\n| extend DestinationPortS=tostring(DestinationPort)\\r\\n| summarize PortCount=count() by DestinationPortS\\r\\n| top 5 by PortCount desc \",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 denied outbound ports\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DestinationPortS\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"PortCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 denied outbound ports\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Top 5 allowed and blocked IP addresses\"},\"name\":\"text - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//top 5 protocol Deny\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where Protocol != ''\\r\\n| where SimplifiedDeviceAction == 'Deny'\\r\\n| summarize ProtocolCount= count() by Protocol\\r\\n| top 5 by ProtocolCount\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 denied protocols\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"Top 5 denied protocols\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//top 5 protocol Allow\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where Protocol != ''\\r\\n| where SimplifiedDeviceAction == 'Allow'\\r\\n| summarize ProtocolCount= count() by Protocol\\r\\n| top 5 by ProtocolCount\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed protocols\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"Top 5 allowed protocols\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Top 5 Inbound Destination IP Addresses Blocked \\r\\nCommonSecurityLog \\r\\n| where DeviceProduct =~ 'ASA' \\r\\n| where DeviceVendor =~ 'Cisco' \\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where CommunicationDirection contains   'inbound' \\r\\n| where SimplifiedDeviceAction == 'Deny' \\r\\n| summarize IpCount= count()  by DestinationIP \\r\\n| top 5 by IpCount desc nulls last \",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 blocked inbound destination IP addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DestinationIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IpCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 blocked inbound destination IP addresses\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Top 5 Inbound Destination IP Addresses Allowed \\r\\nCommonSecurityLog \\r\\n| where DeviceProduct =~ 'ASA' \\r\\n| where DeviceVendor =~ 'Cisco' \\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where CommunicationDirection contains   'inbound' \\r\\n| where DestinationIP != '' \\r\\n| where SimplifiedDeviceAction == 'Allow' or SimplifiedDeviceAction == 'Built' \\r\\n| summarize IpCount= count()  by DestinationIP \\r\\n| top 5 by IpCount desc nulls last\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed inbound destination IP addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DestinationIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IpCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 allowed inbound destination IP addresses\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//top 5 outbound deny dst ip\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID == '106100'\\r\\n | where SimplifiedDeviceAction == 'Deny'\\r\\n//| where Message contains ' -> management'\\r\\n| summarize IpCount= count()  by DestinationIP\\r\\n| top 5 by IpCount desc nulls last\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 denied outbound destination IP addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DestinationIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IpCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 denied outbound destination IP addresses\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//top 5 outbound Allow dst ip\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID == '106100'\\r\\n | where SimplifiedDeviceAction == 'Allow'\\r\\n | where Message contains ' -> management'\\r\\n| summarize IpCount= count()  by DestinationIP\\r\\n| top 5 by IpCount desc nulls last\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed outbound destination IP addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DestinationIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IpCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 allowed outbound destination IP addresses\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Top 5 Inbound Source IP Addresses Denied \\r\\nCommonSecurityLog \\r\\n| where DeviceProduct =~ 'ASA' \\r\\n| where DeviceVendor =~ 'Cisco' \\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where CommunicationDirection contains   'inbound' \\r\\n| where SimplifiedDeviceAction == 'Deny' \\r\\n| summarize IpCount= count()  by SourceIP \\r\\n| top 5 by IpCount desc nulls last\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 denied inbound source IP addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"SourceIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IpCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 denied inbound source IP addresses\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Top 5 Outbound Source IP Addresses Allowed \\r\\nCommonSecurityLog \\r\\n| where DeviceProduct =~ 'ASA' \\r\\n| where DeviceVendor =~ 'Cisco' \\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where CommunicationDirection contains   'outbound' \\r\\n| where SimplifiedDeviceAction == 'Built' \\r\\n| summarize IpCount= count()  by SourceIP \\r\\n| top 5 by IpCount desc nulls last\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed outbound source IP addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"SourceIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IpCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 allowed outbound source IP addresses\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Firewall management\"},\"name\":\"text - 29\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Top 5 Source IP Addresses By Failed Authentication \\r\\nCommonSecurityLog \\r\\n| where DeviceProduct =~ 'ASA' \\r\\n| where DeviceVendor =~ 'Cisco' \\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID == '611102' \\r\\n| extend IPAddress= extract('%ASA-6-611102:.*: IP address: (.*?), Uname.*',1,Message) \\r\\n| summarize IPAddressCount=count() by IPAddress \\r\\n| top 5 by IPAddressCount desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 source IP addresses, by failed authentication\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ipaddress\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IPCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 source IP addresses, by failed authentication\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"\\r\\n//Login Attempts For Nonexistent User Account \\r\\nCommonSecurityLog \\r\\n| where DeviceProduct =~ 'ASA' \\r\\n| where DeviceVendor =~ 'Cisco' \\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID == '113015' \\r\\n| extend ipaddress=extract('%ASA-6-113015:.*: user IP = (.*)$',1,Message) \\r\\n| summarize IPCount=count() by ipaddress \\r\\n| top 5 by  IPCount desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Logon attempts to nonexistent user account, by source IP address\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ipaddress\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IPCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Logon attempts to nonexistent user account by source IP address\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Top 5 SSH Failed Attempt By Source IP \\r\\nCommonSecurityLog \\r\\n| where DeviceProduct =~ 'ASA' \\r\\n| where DeviceVendor =~ 'Cisco' \\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID == '315011' \\r\\n| extend IP= extract('%ASA-6-315011: SSH session from (.*) on',1,Message) \\r\\n| summarize  ReasonCount=count() by IP \\r\\n| top 5 by ReasonCount  desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 SSH failed attempts, by source IP address\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReasonCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 SSH failed attempts by source IP address\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Authentocation Success\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct =~ 'ASA'\\r\\n| where DeviceVendor =~ 'Cisco'\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID == '113012'\\r\\n| extend UserName= extract('%ASA-6-113012:.*: user = (.*)$',1,Message)\\r\\n| summarize UserCount=count() by UserName\\r\\n| top 5 by UserCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 successfully authenticated users\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserCount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 successfully authenticated users\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//top 10 commands\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct == \\\"ASA\\\"\\r\\n| where DeviceVendor == \\\"Cisco\\\"\\r\\n| where '{DeviceAddress:label}' == \\\"All\\\" or DeviceAddress in ({DeviceAddress})\\r\\n| where DeviceEventClassID == \\\"111008\\\"\\r\\n| extend CommandExecuted= extract(\\\"%ASA-5-111008: User '.*?' executed the '(.*?)' command.\\\",1,Message) \\r\\n| summarize Count= count() by CommandExecuted  \\r\\n| top 10 by Count desc \",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 Commands Executed on Firewall\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CommandExecuted\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 Commands Executed on Firewall\"}],\"fromTemplateId\":\"sentinel-Cisco\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=CiscoWorkbook; logoFileName=cisco_logo.svg; description=Gain insights into your Cisco ASA firewalls by analyzing traffic, events, and firewall operations.\nThis workbook analyzes Cisco ASA threat events and identifies suspicious ports, users, protocols and IP addresses.\nYou can learn about trends across user and data traffic directions, and drill down into the Cisco filter results.\nEasily detect attacks on your organization by monitoring management operations, such as configuration and logins.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.1.0; title=Cisco - ASA; templateRelativePath=Cisco.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "CiscoASA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "CommonSecurityLog",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "CiscoASA",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoASA data connector with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Cisco ASA via Legacy Agent",
                  "publisher": "Cisco",
                  "descriptionMarkdown": "The Cisco ASA firewall connector allows you to easily connect your Cisco ASA logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives you more insight into your organization's network and improves your security operation capabilities.",
                  "logo": "CiscoLogo.svg",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "Cisco",
                      "baseQuery": "\nCommonSecurityLog​ \n| where DeviceVendor =~ \"Cisco\"\n| where DeviceProduct == \"ASA\"\n"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "\nCommonSecurityLog​ \n| where DeviceVendor =~ \"Cisco\"\n| where DeviceProduct == \"ASA\"\n\n            | sort by TimeGenerated"
                    },
                    {
                      "description": "Deny device actions",
                      "query": "\nCommonSecurityLog​ \n| where DeviceVendor =~ \"Cisco\"\n| where DeviceProduct == \"ASA\"\n\n            | where SimplifiedDeviceAction == \"Deny\"\n            | sort by TimeGenerated"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "\nCommonSecurityLog​ \n| where DeviceVendor =~ \"Cisco\"\n| where DeviceProduct == \"ASA\"\n\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(3d)"
                      ]
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "CommonSecurityLog (Cisco)",
                      "lastDataReceivedQuery": "\nCommonSecurityLog​ \n| where DeviceVendor =~ \"Cisco\"\n| where DeviceProduct == \"ASA\"\n\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "availability": {
                    "status": 2,
                    "isPreview": false,
                    "featureFlag": {
                      "feature": "CiscoASAConnector",
                      "featureStates": {
                        "1": 2,
                        "2": 2,
                        "3": 2,
                        "4": 2,
                        "5": 2,
                        "6": 1,
                        "7": 1
                      }
                    }
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
                      "innerSteps": [
                        {
                          "title": "1.1 Select or create a Linux machine",
                          "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds."
                        },
                        {
                          "title": "1.2 Install the CEF collector on the Linux machine",
                          "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 TCP.\n\n> 1. Make sure that you have Python on your machine using the following command: python --version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                          "instructions": [
                            {
                              "parameters": {
                                "fillWith": [
                                  "WorkspaceId",
                                  "PrimaryKey"
                                ],
                                "label": "Run the following command to install and apply the CEF collector:",
                                "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                              },
                              "type": "CopyableLabel"
                            }
                          ]
                        }
                      ],
                      "title": "1. Linux Syslog agent configuration"
                    },
                    {
                      "description": "Configure Cisco ASA to forward Syslog messages in CEF format to your Microsoft Sentinel workspace via the Syslog agent.\n\nGo to [Send Syslog messages to an external Syslog server](https://aka.ms/asi-syslog-cisco-forwarding), and follow the instructions to set up the connection. Use these parameters when prompted:\n\n1.  Set \"port\" to 514.\n2.  Set \"syslog_ip\" to the IP address of the Syslog agent.\n\n\n[Learn more >](https://aka.ms/CEFCisco)",
                      "title": "2. Forward Cisco ASA logs to Syslog agent"
                    },
                    {
                      "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python --version\n\n>2. You must have elevated permissions (sudo) on your machine",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Run the following command to validate your connectivity:",
                            "value": "sudo wget -O cef_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py  {0}"
                          },
                          "type": "CopyableLabel"
                        }
                      ],
                      "title": "3. Validate connection"
                    },
                    {
                      "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
                      "title": "4. Secure your machine "
                    }
                  ],
                  "metadata": {
                    "id": "31e95c16-9972-4afe-9697-05b9f40f2a58",
                    "version": "1.0.0",
                    "kind": "dataConnector",
                    "source": {
                      "kind": "community"
                    },
                    "author": {
                      "name": "Cisco Systems"
                    },
                    "support": {
                      "name": "Cisco Systems",
                      "link": "https://www.cisco.com/c/en/us/support/index.html",
                      "tier": "developer"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "CiscoASA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "Cisco ASA via Legacy Agent",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "CiscoASA",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "tier": "Microsoft",
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "link": "https://support.microsoft.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Cisco ASA via Legacy Agent",
          "publisher": "Cisco",
          "descriptionMarkdown": "The Cisco ASA firewall connector allows you to easily connect your Cisco ASA logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives you more insight into your organization's network and improves your security operation capabilities.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "Cisco",
              "baseQuery": "\nCommonSecurityLog​ \n| where DeviceVendor =~ \"Cisco\"\n| where DeviceProduct == \"ASA\"\n"
            }
          ],
          "dataTypes": [
            {
              "name": "CommonSecurityLog (Cisco)",
              "lastDataReceivedQuery": "\nCommonSecurityLog​ \n| where DeviceVendor =~ \"Cisco\"\n| where DeviceProduct == \"ASA\"\n\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "\nCommonSecurityLog​ \n| where DeviceVendor =~ \"Cisco\"\n| where DeviceProduct == \"ASA\"\n\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(3d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "All logs",
              "query": "\nCommonSecurityLog​ \n| where DeviceVendor =~ \"Cisco\"\n| where DeviceProduct == \"ASA\"\n\n            | sort by TimeGenerated"
            },
            {
              "description": "Deny device actions",
              "query": "\nCommonSecurityLog​ \n| where DeviceVendor =~ \"Cisco\"\n| where DeviceProduct == \"ASA\"\n\n            | where SimplifiedDeviceAction == \"Deny\"\n            | sort by TimeGenerated"
            }
          ],
          "availability": {
            "status": 2,
            "isPreview": false,
            "featureFlag": {
              "feature": "CiscoASAConnector",
              "featureStates": {
                "1": 2,
                "2": 2,
                "3": 2,
                "4": 2,
                "5": 2,
                "6": 1,
                "7": 1
              }
            }
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
              "innerSteps": [
                {
                  "title": "1.1 Select or create a Linux machine",
                  "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds."
                },
                {
                  "title": "1.2 Install the CEF collector on the Linux machine",
                  "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 TCP.\n\n> 1. Make sure that you have Python on your machine using the following command: python --version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                  "instructions": [
                    {
                      "parameters": {
                        "fillWith": [
                          "WorkspaceId",
                          "PrimaryKey"
                        ],
                        "label": "Run the following command to install and apply the CEF collector:",
                        "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                      },
                      "type": "CopyableLabel"
                    }
                  ]
                }
              ],
              "title": "1. Linux Syslog agent configuration"
            },
            {
              "description": "Configure Cisco ASA to forward Syslog messages in CEF format to your Microsoft Sentinel workspace via the Syslog agent.\n\nGo to [Send Syslog messages to an external Syslog server](https://aka.ms/asi-syslog-cisco-forwarding), and follow the instructions to set up the connection. Use these parameters when prompted:\n\n1.  Set \"port\" to 514.\n2.  Set \"syslog_ip\" to the IP address of the Syslog agent.\n\n\n[Learn more >](https://aka.ms/CEFCisco)",
              "title": "2. Forward Cisco ASA logs to Syslog agent"
            },
            {
              "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python --version\n\n>2. You must have elevated permissions (sudo) on your machine",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Run the following command to validate your connectivity:",
                    "value": "sudo wget -O cef_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py  {0}"
                  },
                  "type": "CopyableLabel"
                }
              ],
              "title": "3. Validate connection"
            },
            {
              "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
              "title": "4. Secure your machine "
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoASA data connector with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId2')]",
                  "title": "Cisco ASA/FTD via AMA (Preview)",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": "The Cisco ASA firewall connector allows you to easily connect your Cisco ASA logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives you more insight into your organization's network and improves your security operation capabilities.",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "CommonSecurityLog",
                      "baseQuery": "CommonSecurityLog\n| where DeviceVendor == \"Cisco\"\n| where DeviceProduct in (\"ASA\", \"FTD\")\n| extend ingestion_time = bin(TimeGenerated, 1m)\n| join kind=inner (Heartbeat \n| where Category == \"Azure Monitor Agent\" \n| project TimeGenerated, _ResourceId\n| summarize by _ResourceId, ingestion_time = bin(TimeGenerated, 1m)) on _ResourceId, ingestion_time\n| project-away  _ResourceId1, ingestion_time, ingestion_time1"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "CommonSecurityLog\n| where DeviceVendor == \"Cisco\"\n| where DeviceProduct in (\"ASA\", \"FTD\")\n| extend ingestion_time = bin(TimeGenerated, 1m)\n| join kind=inner (Heartbeat \n| where Category == \"Azure Monitor Agent\" \n| project TimeGenerated, _ResourceId\n| summarize by _ResourceId, ingestion_time = bin(TimeGenerated, 1m)) on _ResourceId, ingestion_time\n| project-away  _ResourceId1, ingestion_time, ingestion_time1 \n            | sort by TimeGenerated"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "CiscoAsaAMA"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "CommonSecurityLog",
                      "lastDataReceivedQuery": "CommonSecurityLog\n| where DeviceVendor == \"Cisco\"\n| where DeviceProduct in (\"ASA\", \"FTD\")\n| extend ingestion_time = bin(TimeGenerated, 1m)\n| join kind=inner (Heartbeat \n| where Category == \"Azure Monitor Agent\" \n| project TimeGenerated, _ResourceId\n| summarize by _ResourceId, ingestion_time = bin(TimeGenerated, 1m)) on _ResourceId, ingestion_time\n| project-away  _ResourceId1, ingestion_time, ingestion_time1 \n             | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "availability": {
                    "status": 2,
                    "isPreview": false,
                    "featureFlag": {
                      "feature": "CiscoAsaAma",
                      "featureStates": {
                        "1": 1,
                        "2": 1,
                        "3": 1,
                        "4": 1
                      }
                    }
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/datasources",
                        "permissionsDisplayText": "read and write permissions.",
                        "providerDisplayName": "Workspace data sources",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "description": "To collect data from non-Azure VMs, they must have Azure Arc installed and enabled. [Learn more](https://docs.microsoft.com/azure/azure-monitor/agents/azure-monitor-agent-install?tabs=ARMAgentPowerShell,PowerShellWindows,PowerShellWindowsArc,CLIWindows,CLIWindowsArc)"
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "> Cisco ASA/FTD event logs are collected only from **Linux** agents.",
                      "instructions": [
                        {
                          "type": "CiscoAsaAma"
                        }
                      ],
                      "title": "Enable data collection rule​"
                    },
                    {
                      "instructions": [
                        {
                          "parameters": {
                            "linkType": "OpenCreateDataCollectionRule",
                            "dataCollectionRuleType": 4
                          },
                          "type": "InstallAgent"
                        }
                      ]
                    },
                    {
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId",
                              "PrimaryKey"
                            ],
                            "label": "",
                            "value": "sudo wget -O Forwarder_AMA_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/Syslog/Forwarder_AMA_installer.py&&sudo python Forwarder_AMA_installer.py"
                          },
                          "type": "CopyableLabel"
                        }
                      ],
                      "title": "Run the following command to install and apply the Cisco ASA/FTD collector:"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
                "contentId": "[variables('_dataConnectorContentId2')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "CiscoASA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "contentKind": "DataConnector",
        "displayName": "Cisco ASA/FTD via AMA (Preview)",
        "contentProductId": "[variables('_dataConnectorcontentProductId2')]",
        "id": "[variables('_dataConnectorcontentProductId2')]",
        "version": "[variables('dataConnectorVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId2')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion2')]",
        "source": {
          "kind": "Solution",
          "name": "CiscoASA",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "tier": "Microsoft",
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "link": "https://support.microsoft.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Cisco ASA/FTD via AMA (Preview)",
          "publisher": "Microsoft",
          "descriptionMarkdown": "The Cisco ASA firewall connector allows you to easily connect your Cisco ASA logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives you more insight into your organization's network and improves your security operation capabilities.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "CommonSecurityLog",
              "baseQuery": "CommonSecurityLog\n| where DeviceVendor == \"Cisco\"\n| where DeviceProduct in (\"ASA\", \"FTD\")\n| extend ingestion_time = bin(TimeGenerated, 1m)\n| join kind=inner (Heartbeat \n| where Category == \"Azure Monitor Agent\" \n| project TimeGenerated, _ResourceId\n| summarize by _ResourceId, ingestion_time = bin(TimeGenerated, 1m)) on _ResourceId, ingestion_time\n| project-away  _ResourceId1, ingestion_time, ingestion_time1"
            }
          ],
          "dataTypes": [
            {
              "name": "CommonSecurityLog",
              "lastDataReceivedQuery": "CommonSecurityLog\n| where DeviceVendor == \"Cisco\"\n| where DeviceProduct in (\"ASA\", \"FTD\")\n| extend ingestion_time = bin(TimeGenerated, 1m)\n| join kind=inner (Heartbeat \n| where Category == \"Azure Monitor Agent\" \n| project TimeGenerated, _ResourceId\n| summarize by _ResourceId, ingestion_time = bin(TimeGenerated, 1m)) on _ResourceId, ingestion_time\n| project-away  _ResourceId1, ingestion_time, ingestion_time1 \n             | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "CiscoAsaAMA"
            }
          ],
          "sampleQueries": [
            {
              "description": "All logs",
              "query": "CommonSecurityLog\n| where DeviceVendor == \"Cisco\"\n| where DeviceProduct in (\"ASA\", \"FTD\")\n| extend ingestion_time = bin(TimeGenerated, 1m)\n| join kind=inner (Heartbeat \n| where Category == \"Azure Monitor Agent\" \n| project TimeGenerated, _ResourceId\n| summarize by _ResourceId, ingestion_time = bin(TimeGenerated, 1m)) on _ResourceId, ingestion_time\n| project-away  _ResourceId1, ingestion_time, ingestion_time1 \n            | sort by TimeGenerated"
            }
          ],
          "availability": {
            "status": 2,
            "isPreview": false,
            "featureFlag": {
              "feature": "CiscoAsaAma",
              "featureStates": {
                "1": 1,
                "2": 1,
                "3": 1,
                "4": 1
              }
            }
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces/datasources",
                "permissionsDisplayText": "read and write permissions.",
                "providerDisplayName": "Workspace data sources",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true
                }
              }
            ],
            "customs": [
              {
                "description": "To collect data from non-Azure VMs, they must have Azure Arc installed and enabled. [Learn more](https://docs.microsoft.com/azure/azure-monitor/agents/azure-monitor-agent-install?tabs=ARMAgentPowerShell,PowerShellWindows,PowerShellWindowsArc,CLIWindows,CLIWindowsArc)"
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "> Cisco ASA/FTD event logs are collected only from **Linux** agents.",
              "instructions": [
                {
                  "type": "CiscoAsaAma"
                }
              ],
              "title": "Enable data collection rule​"
            },
            {
              "instructions": [
                {
                  "parameters": {
                    "linkType": "OpenCreateDataCollectionRule",
                    "dataCollectionRuleType": 4
                  },
                  "type": "InstallAgent"
                }
              ]
            },
            {
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId",
                      "PrimaryKey"
                    ],
                    "label": "",
                    "value": "sudo wget -O Forwarder_AMA_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/Syslog/Forwarder_AMA_installer.py&&sudo python Forwarder_AMA_installer.py"
                  },
                  "type": "CopyableLabel"
                }
              ],
              "title": "Run the following command to install and apply the Cisco ASA/FTD collector:"
            }
          ],
          "id": "[variables('_uiConfigId2')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoASAConnector Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "CustomConnectorName": {
              "defaultValue": "CiscoASAConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the Azure Firewall Connector"
              }
            },
            "Service Endpoint": {
              "type": "string",
              "metadata": {
                "description": "URL of the Cisco ASA REST API"
              }
            }
          },
          "variables": {
            "operationId-CiscoAsaGetAccessGroupsInV1": "CiscoAsaGetAccessGroupsInV1",
            "_operationId-CiscoAsaGetAccessGroupsInV1": "[[variables('operationId-CiscoAsaGetAccessGroupsInV1')]",
            "operationId-CiscoAsaGetAccessGroupInV1": "CiscoAsaGetAccessGroupInV1",
            "_operationId-CiscoAsaGetAccessGroupInV1": "[[variables('operationId-CiscoAsaGetAccessGroupInV1')]",
            "operationId-CiscoAsaGetAccessGroupInRulesV1": "CiscoAsaGetAccessGroupInRulesV1",
            "_operationId-CiscoAsaGetAccessGroupInRulesV1": "[[variables('operationId-CiscoAsaGetAccessGroupInRulesV1')]",
            "operationId-CiscoAsaPostAccessGroupInRuleV1": "CiscoAsaPostAccessGroupInRuleV1",
            "_operationId-CiscoAsaPostAccessGroupInRuleV1": "[[variables('operationId-CiscoAsaPostAccessGroupInRuleV1')]",
            "operationId-CiscoAsaGetAccessGroupInRuleV1": "CiscoAsaGetAccessGroupInRuleV1",
            "_operationId-CiscoAsaGetAccessGroupInRuleV1": "[[variables('operationId-CiscoAsaGetAccessGroupInRuleV1')]",
            "operationId-CiscoAsaDeleteAccessGroupInRuleV1": "CiscoAsaDeleteAccessGroupInRuleV1",
            "_operationId-CiscoAsaDeleteAccessGroupInRuleV1": "[[variables('operationId-CiscoAsaDeleteAccessGroupInRuleV1')]",
            "operationId-CiscoAsaGetMonitoringIPAddressesV1": "CiscoAsaGetMonitoringIPAddressesV1",
            "_operationId-CiscoAsaGetMonitoringIPAddressesV1": "[[variables('operationId-CiscoAsaGetMonitoringIPAddressesV1')]",
            "operationId-CiscoAsaGetMonitoringIPAddressV1": "CiscoAsaGetMonitoringIPAddressV1",
            "_operationId-CiscoAsaGetMonitoringIPAddressV1": "[[variables('operationId-CiscoAsaGetMonitoringIPAddressV1')]",
            "operationId-CiscoAsaGetObjectsExtendedAcesV1": "CiscoAsaGetObjectsExtendedAcesV1",
            "_operationId-CiscoAsaGetObjectsExtendedAcesV1": "[[variables('operationId-CiscoAsaGetObjectsExtendedAcesV1')]",
            "operationId-CiscoAsaPostObjectsExtendedAceV1": "CiscoAsaPostObjectsExtendedAceV1",
            "_operationId-CiscoAsaPostObjectsExtendedAceV1": "[[variables('operationId-CiscoAsaPostObjectsExtendedAceV1')]",
            "operationId-CiscoAsaGetObjectsExtendedAceV1": "CiscoAsaGetObjectsExtendedAceV1",
            "_operationId-CiscoAsaGetObjectsExtendedAceV1": "[[variables('operationId-CiscoAsaGetObjectsExtendedAceV1')]",
            "operationId-CiscoAsaDeleteObjectsExtendedAceV1": "CiscoAsaDeleteObjectsExtendedAceV1",
            "_operationId-CiscoAsaDeleteObjectsExtendedAceV1": "[[variables('operationId-CiscoAsaDeleteObjectsExtendedAceV1')]",
            "operationId-CiscoAsaGetObjectsNetworkObjectGroupsV1": "CiscoAsaGetObjectsNetworkObjectGroupsV1",
            "_operationId-CiscoAsaGetObjectsNetworkObjectGroupsV1": "[[variables('operationId-CiscoAsaGetObjectsNetworkObjectGroupsV1')]",
            "operationId-CiscoAsaPostObjectsNetworkObjectGroupV1": "CiscoAsaPostObjectsNetworkObjectGroupV1",
            "_operationId-CiscoAsaPostObjectsNetworkObjectGroupV1": "[[variables('operationId-CiscoAsaPostObjectsNetworkObjectGroupV1')]",
            "operationId-CiscoAsaGetObjectsNetworkObjectGroupV1": "CiscoAsaGetObjectsNetworkObjectGroupV1",
            "_operationId-CiscoAsaGetObjectsNetworkObjectGroupV1": "[[variables('operationId-CiscoAsaGetObjectsNetworkObjectGroupV1')]",
            "operationId-CiscoAsaPatchObjectsNetworkObjectGroupV1": "CiscoAsaPatchObjectsNetworkObjectGroupV1",
            "_operationId-CiscoAsaPatchObjectsNetworkObjectGroupV1": "[[variables('operationId-CiscoAsaPatchObjectsNetworkObjectGroupV1')]",
            "operationId-CiscoAsaGetObjectsNetworkObjectsV1": "CiscoAsaGetObjectsNetworkObjectsV1",
            "_operationId-CiscoAsaGetObjectsNetworkObjectsV1": "[[variables('operationId-CiscoAsaGetObjectsNetworkObjectsV1')]",
            "operationId-CiscoAsaPostObjectsNetworkObjectV1": "CiscoAsaPostObjectsNetworkObjectV1",
            "_operationId-CiscoAsaPostObjectsNetworkObjectV1": "[[variables('operationId-CiscoAsaPostObjectsNetworkObjectV1')]",
            "operationId-CiscoAsaGetObjectsNetworkObjectV1": "CiscoAsaGetObjectsNetworkObjectV1",
            "_operationId-CiscoAsaGetObjectsNetworkObjectV1": "[[variables('operationId-CiscoAsaGetObjectsNetworkObjectV1')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId1": "CiscoASAConnector",
            "playbookId1": "[[resourceId('Microsoft.Web/customApis', parameters('CustomConnectorName'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('CustomConnectorName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "connectionParameters": {
                  "username": {
                    "type": "securestring",
                    "uiDefinition": {
                      "displayName": "username",
                      "description": "The username for this API",
                      "tooltip": "Provide the username",
                      "constraints": {
                        "tabIndex": 2,
                        "clearText": true,
                        "required": "true"
                      }
                    }
                  },
                  "password": {
                    "type": "securestring",
                    "uiDefinition": {
                      "displayName": "password",
                      "description": "The password for this API",
                      "tooltip": "Provide the password",
                      "constraints": {
                        "tabIndex": 3,
                        "clearText": false,
                        "required": "true"
                      }
                    }
                  }
                },
                "backendService": {
                  "serviceUrl": "[[parameters('Service Endpoint')]"
                },
                "brandColor": "#ffffff",
                "displayName": "[[parameters('CustomConnectorName')]",
                "iconUri": "data:image/png;base64,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",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "title": "Cisco ASA REST API",
                    "version": "v1"
                  },
                  "paths": {
                    "/api/access/in": {
                      "get": {
                        "tags": [
                          "AccessIn"
                        ],
                        "summary": "Fetch inbound access groups",
                        "description": "Fetch inbound access groups",
                        "operationId": "[[variables('_operationId-CiscoAsaGetAccessGroupsInV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "query",
                            "name": "limit",
                            "description": "Number of items to return; maximum of 100",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "query",
                            "name": "offset",
                            "description": "Index of first item to return",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/AccessGroupCollection"
                            }
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/access/in/{interfaceId}": {
                      "get": {
                        "tags": [
                          "AccessIn"
                        ],
                        "summary": "Fetch an inbound access group by interface name",
                        "description": "Fetch an inbound access group by interface name",
                        "operationId": "[[variables('_operationId-CiscoAsaGetAccessGroupInV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "interfaceId",
                            "description": "The interface of inbound access group to be fetched",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/AccessGroup"
                            }
                          },
                          "404": {
                            "description": "Not Found",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/access/in/{interfaceId}/rules": {
                      "get": {
                        "tags": [
                          "AccessIn"
                        ],
                        "summary": "Fetch inbound access rules on an interface",
                        "description": "Fetch inbound access rules on an interface",
                        "operationId": "[[variables('_operationId-CiscoAsaGetAccessGroupInRulesV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "interfaceId",
                            "description": "The interface to which the inbound access rule applies",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "query",
                            "name": "limit",
                            "description": "Number of items to return; maximum of 100",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "query",
                            "name": "offset",
                            "description": "Index of first item to return",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/ExtendedACECollection"
                            }
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      },
                      "post": {
                        "tags": [
                          "AccessIn"
                        ],
                        "summary": "Create an inbound access rule on an interface",
                        "description": "Create an inbound access rule on an interface",
                        "operationId": "[[variables('_operationId-CiscoAsaPostAccessGroupInRuleV1')]",
                        "consumes": [
                          "application/json",
                          "text/json",
                          "application/*+json"
                        ],
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "interfaceId",
                            "description": "The interface to which the inbound access rule applies",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "description": "[variables('blanks')]",
                            "schema": {
                              "$ref": "#/definitions/ExtendedACEPost"
                            }
                          }
                        ],
                        "responses": {
                          "201": {
                            "description": "Success"
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/access/in/{interfaceId}/rules/{objectId}": {
                      "get": {
                        "tags": [
                          "AccessIn"
                        ],
                        "summary": "Fetch an inbound access rule on an interface",
                        "description": "Fetch an inbound access rule on an interface",
                        "operationId": "[[variables('_operationId-CiscoAsaGetAccessGroupInRuleV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "interfaceId",
                            "description": "The interface to which the inbound access rule applies",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "path",
                            "name": "objectId",
                            "description": "The object ID of the inbound access rule to be fetched",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/ExtendedACE"
                            }
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      },
                      "delete": {
                        "tags": [
                          "AccessIn"
                        ],
                        "summary": "Remove an inbound access rule on an interface",
                        "description": "Remove an inbound access rule on an interface",
                        "operationId": "[[variables('_operationId-CiscoAsaDeleteAccessGroupInRuleV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "interfaceId",
                            "description": "The interface to which the inbound access rule applies",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "path",
                            "name": "objectId",
                            "description": "The object ID of the inbound access rule to be removed",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "204": {
                            "description": "Success"
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/monitoring/ipaddress": {
                      "get": {
                        "tags": [
                          "MonitoringIpAddress"
                        ],
                        "summary": "Get the connection statistics of the device",
                        "description": "Get the connection statistics of the device",
                        "operationId": "[[variables('_operationId-CiscoAsaGetMonitoringIPAddressesV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "query",
                            "name": "limit",
                            "description": "Number of items to return; maximum of 100",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "query",
                            "name": "offset",
                            "description": "Index of first item to return",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/IPAddressCollection"
                            }
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/monitoring/ipaddress/{objectId}": {
                      "get": {
                        "tags": [
                          "MonitoringIpAddress"
                        ],
                        "summary": "Get the ipaddress details of the device",
                        "description": "Get the ipaddress details of the device",
                        "operationId": "[[variables('_operationId-CiscoAsaGetMonitoringIPAddressV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "objectId",
                            "description": "Name of the interface (object ID) for which to fetch ipaddress details",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/IPAddress"
                            }
                          },
                          "404": {
                            "description": "Not Found",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/objects/extendedacls/{aclName}/aces": {
                      "get": {
                        "tags": [
                          "ObjectsExtendedAcls"
                        ],
                        "summary": "Fetch ACEs on an interface",
                        "description": "Fetch ACEs on an interface",
                        "operationId": "[[variables('_operationId-CiscoAsaGetObjectsExtendedAcesV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "aclName",
                            "description": "The name of the ACL to which this rule belongs",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "query",
                            "name": "limit",
                            "description": "Number of items to return; maximum of 100",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "query",
                            "name": "offset",
                            "description": "Index of first item to return",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/ExtendedACECollection"
                            }
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      },
                      "post": {
                        "tags": [
                          "ObjectsExtendedAcls"
                        ],
                        "summary": "Add a new ACE on an interface",
                        "description": "Add a new ACE on an interface",
                        "operationId": "[[variables('_operationId-CiscoAsaPostObjectsExtendedAceV1')]",
                        "consumes": [
                          "application/json",
                          "text/json",
                          "application/*+json"
                        ],
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "aclName",
                            "description": "The name of the ACL to which this rule belongs",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "description": "Configuration of the ACE to be added",
                            "schema": {
                              "$ref": "#/definitions/ExtendedACEPost"
                            }
                          }
                        ],
                        "responses": {
                          "201": {
                            "description": "Success"
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/objects/extendedacls/{aclName}/aces/{objectId}": {
                      "get": {
                        "tags": [
                          "ObjectsExtendedAcls"
                        ],
                        "summary": "Fetch an ACE on an interface",
                        "description": "Fetch an ACE on an interface",
                        "operationId": "[[variables('_operationId-CiscoAsaGetObjectsExtendedAceV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "aclName",
                            "description": "The name of the ACL to which this rule belongs",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "path",
                            "name": "objectId",
                            "description": "The object ID of the ACE to be fetched",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/ExtendedACE"
                            }
                          },
                          "404": {
                            "description": "Not Found",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      },
                      "delete": {
                        "tags": [
                          "ObjectsExtendedAcls"
                        ],
                        "summary": "Delete an ACE",
                        "description": "Delete an ACE",
                        "operationId": "[[variables('_operationId-CiscoAsaDeleteObjectsExtendedAceV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "aclName",
                            "description": "The name of the ACL to which this rule belongs",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "path",
                            "name": "objectId",
                            "description": "The object ID of the ACE to be deleted",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "204": {
                            "description": "Success"
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/objects/networkobjectgroups": {
                      "get": {
                        "tags": [
                          "ObjectsNetworkObjectGroups"
                        ],
                        "summary": "Fetch network object groups",
                        "description": "Fetch network object groups",
                        "operationId": "[[variables('_operationId-CiscoAsaGetObjectsNetworkObjectGroupsV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "query",
                            "name": "limit",
                            "description": "Number of items to return; maximum of 100",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "query",
                            "name": "offset",
                            "description": "Index of first item to return",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/NetworkObjGroupCollection"
                            }
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      },
                      "post": {
                        "tags": [
                          "ObjectsNetworkObjectGroups"
                        ],
                        "summary": "Add a new network object group",
                        "description": "Add a new network object group",
                        "operationId": "[[variables('_operationId-CiscoAsaPostObjectsNetworkObjectGroupV1')]",
                        "consumes": [
                          "application/json",
                          "text/json",
                          "application/*+json"
                        ],
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "description": "[variables('blanks')]",
                            "schema": {
                              "$ref": "#/definitions/NetworkObjGroupPost"
                            }
                          }
                        ],
                        "responses": {
                          "201": {
                            "description": "Success"
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/objects/networkobjectgroups/{objectId}": {
                      "get": {
                        "tags": [
                          "ObjectsNetworkObjectGroups"
                        ],
                        "summary": "Fetch a network object group",
                        "description": "Fetch a network object group",
                        "operationId": "[[variables('_operationId-CiscoAsaGetObjectsNetworkObjectGroupV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "objectId",
                            "description": "The ID of the network object group to be fetched",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/NetworkObjGroup"
                            }
                          },
                          "404": {
                            "description": "Not Found",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      },
                      "patch": {
                        "tags": [
                          "ObjectsNetworkObjectGroups"
                        ],
                        "summary": "Patch members of a network object group",
                        "description": "Patch members of a network object group",
                        "operationId": "[[variables('_operationId-CiscoAsaPatchObjectsNetworkObjectGroupV1')]",
                        "consumes": [
                          "application/json",
                          "text/json",
                          "application/*+json"
                        ],
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "objectId",
                            "description": "The ID of the network object group to be patched",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "description": "[variables('blanks')]",
                            "schema": {
                              "$ref": "#/definitions/NetworkObjGroupPatch"
                            }
                          }
                        ],
                        "responses": {
                          "204": {
                            "description": "Success"
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/objects/networkobjects": {
                      "get": {
                        "tags": [
                          "ObjectsNetworkObjects"
                        ],
                        "summary": "Fetch network objects",
                        "description": "Fetch network objects",
                        "operationId": "[[variables('_operationId-CiscoAsaGetObjectsNetworkObjectsV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "query",
                            "name": "limit",
                            "description": "Number of items to return; maximum of 100",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "query",
                            "name": "offset",
                            "description": "Index of first item to return",
                            "type": "integer",
                            "format": "int32"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/NetworkObjectCollection"
                            }
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      },
                      "post": {
                        "tags": [
                          "ObjectsNetworkObjects"
                        ],
                        "summary": "Add a new network object",
                        "description": "Add a new network object",
                        "operationId": "[[variables('_operationId-CiscoAsaPostObjectsNetworkObjectV1')]",
                        "consumes": [
                          "application/json",
                          "text/json",
                          "application/*+json"
                        ],
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "description": "[variables('blanks')]",
                            "schema": {
                              "$ref": "#/definitions/NetworkObjectPost"
                            }
                          }
                        ],
                        "responses": {
                          "201": {
                            "description": "Success"
                          },
                          "400": {
                            "description": "Bad Request",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    },
                    "/api/objects/networkobjects/{objectId}": {
                      "get": {
                        "tags": [
                          "ObjectsNetworkObjects"
                        ],
                        "summary": "Fetch a network object",
                        "description": "Fetch a network object",
                        "operationId": "[[variables('_operationId-CiscoAsaGetObjectsNetworkObjectV1')]",
                        "produces": [
                          "text/plain",
                          "application/json",
                          "text/json"
                        ],
                        "parameters": [
                          {
                            "in": "path",
                            "name": "objectId",
                            "description": "The ID of the network object to be fetched",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "header",
                            "name": "User-Agent",
                            "description": "You must include the header 'User-Agent: REST API Agent' in all API calls",
                            "required": true,
                            "type": "string",
                            "default": "REST API Agent",
                            "enum": [
                              "REST API Agent"
                            ],
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Success",
                            "schema": {
                              "$ref": "#/definitions/NetworkObject"
                            }
                          },
                          "404": {
                            "description": "Not Found",
                            "schema": {
                              "$ref": "#/definitions/ErrorModel"
                            }
                          }
                        }
                      }
                    }
                  },
                  "definitions": {
                    "RangeInfo": {
                      "type": "object",
                      "properties": {
                        "offset": {
                          "format": "int32",
                          "type": "integer",
                          "x-ms-summary": "Offset"
                        },
                        "limit": {
                          "format": "int32",
                          "type": "integer",
                          "x-ms-summary": "Limit"
                        },
                        "total": {
                          "format": "int32",
                          "type": "integer",
                          "x-ms-summary": "Total"
                        }
                      },
                      "x-ms-summary": "Range info"
                    },
                    "Interface": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: objectRef#Interface",
                          "type": "string",
                          "x-ms-summary": "Interface kind"
                        },
                        "refLink": {
                          "type": "string",
                          "x-ms-summary": "Interface refLink"
                        },
                        "objectId": {
                          "type": "string",
                          "x-ms-summary": "Interface objectId"
                        },
                        "name": {
                          "type": "string",
                          "x-ms-summary": "Interface name"
                        }
                      }
                    },
                    "AccessGroup": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: object#AccessGroup",
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "selfLink": {
                          "description": "Unique URI for this resource object",
                          "type": "string",
                          "x-ms-summary": "SelfLink"
                        },
                        "aclName": {
                          "description": "Name of the ACL used in the access group",
                          "type": "string",
                          "x-ms-summary": "ACL name"
                        },
                        "direction": {
                          "description": "Direction: IN our OUT",
                          "type": "string",
                          "x-ms-summary": "Direction"
                        },
                        "interface": {
                          "$ref": "#/definitions/Interface"
                        }
                      }
                    },
                    "AccessGroupCollection": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: collection#AccessGroup",
                          "type": "string",
                          "x-ms-summary": "Collection kind"
                        },
                        "selfLink": {
                          "description": "Unique URI for this resource object",
                          "type": "string",
                          "x-ms-summary": "Collection selfLink"
                        },
                        "rangeInfo": {
                          "$ref": "#/definitions/RangeInfo"
                        },
                        "items": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/AccessGroup"
                          },
                          "x-ms-summary": "Access group items"
                        }
                      }
                    },
                    "Message": {
                      "type": "object",
                      "properties": {
                        "level": {
                          "type": "string",
                          "x-ms-summary": "Message level"
                        },
                        "code": {
                          "type": "string",
                          "x-ms-summary": "Message code"
                        },
                        "context": {
                          "type": "string",
                          "x-ms-summary": "Message context"
                        },
                        "details": {
                          "type": "string",
                          "x-ms-summary": "Message details"
                        }
                      }
                    },
                    "ErrorModel": {
                      "type": "object",
                      "properties": {
                        "messages": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/Message"
                          },
                          "x-ms-summary": "Error messages"
                        }
                      }
                    },
                    "SourceAddress": {
                      "required": [
                        "kind"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: AnyIPAddress, IPv4Address, IPv4FQDN, IPv4Network, IPv4Range, IPv6Address, IPv6FQDN, IPv6Network, IPv6Range, SecurityName, SecurityTag, interfaceIP, objectRef#NetworkObj, objectRef#NetworkObjGroup",
                          "enum": [
                            "AnyIPAddress",
                            "IPv4Address",
                            "IPv4FQDN",
                            "IPv4Network",
                            "IPv4Range",
                            "IPv6Address",
                            "IPv6FQDN",
                            "IPv6Network",
                            "IPv6Range",
                            "SecurityName",
                            "SecurityTag",
                            "interfaceIP",
                            "objectRef#NetworkObj",
                            "objectRef#NetworkObjGroup"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "objectId": {
                          "type": "string",
                          "x-ms-summary": "ObjectId",
                          "x-ms-visibility": "important"
                        },
                        "value": {
                          "type": "string",
                          "x-ms-summary": "Value",
                          "x-ms-visibility": "important"
                        }
                      },
                      "x-ms-summary": "Source address"
                    },
                    "DestinationAddress": {
                      "required": [
                        "kind"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: AnyIPAddress, IPv4Address, IPv4FQDN, IPv4Network, IPv4Range, IPv6Address, IPv6FQDN, IPv6Network, IPv6Range, SecurityName, SecurityTag, interfaceIP, objectRef#NetworkObj, objectRef#NetworkObjGroup",
                          "enum": [
                            "AnyIPAddress",
                            "IPv4Address",
                            "IPv4FQDN",
                            "IPv4Network",
                            "IPv4Range",
                            "IPv6Address",
                            "IPv6FQDN",
                            "IPv6Network",
                            "IPv6Range",
                            "SecurityName",
                            "SecurityTag",
                            "interfaceIP",
                            "objectRef#NetworkObj",
                            "objectRef#NetworkObjGroup"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "objectId": {
                          "type": "string",
                          "x-ms-summary": "ObjectId",
                          "x-ms-visibility": "important"
                        },
                        "value": {
                          "type": "string",
                          "x-ms-summary": "Value",
                          "x-ms-visibility": "important"
                        }
                      },
                      "x-ms-summary": "Destination address"
                    },
                    "SourceService": {
                      "required": [
                        "kind"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: AnyService, ICMP6Service, ICMPService, NetworkProtocol, NetworkServiceGroups, NetworkServiceObjects, TcpUdpService",
                          "enum": [
                            "AnyService",
                            "ICMP6Service",
                            "ICMPService",
                            "NetworkProtocol",
                            "NetworkServiceGroups",
                            "NetworkServiceObjects",
                            "TcpUdpService"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "value": {
                          "type": "string",
                          "x-ms-summary": "Value"
                        }
                      },
                      "x-ms-summary": "Source service"
                    },
                    "DestinationService": {
                      "required": [
                        "kind"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: AnyService, ICMP6Service, ICMPService, NetworkProtocol, NetworkServiceGroups, NetworkServiceObjects, TcpUdpService",
                          "enum": [
                            "AnyService",
                            "ICMP6Service",
                            "ICMPService",
                            "NetworkProtocol",
                            "NetworkServiceGroups",
                            "NetworkServiceObjects",
                            "TcpUdpService"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "value": {
                          "type": "string",
                          "x-ms-summary": "Value",
                          "x-ms-visibility": "important"
                        }
                      },
                      "x-ms-summary": "Destination service"
                    },
                    "Rulelogging": {
                      "required": [
                        "logStatus"
                      ],
                      "type": "object",
                      "properties": {
                        "logInterval": {
                          "format": "int32",
                          "type": "integer",
                          "x-ms-summary": "Log interval"
                        },
                        "logStatus": {
                          "description": "One of: Errors, Debugging, Emergencies, Critical, Informational, Alerts, Disabled, Warnings, Notifications, Default",
                          "enum": [
                            "Errors",
                            "Debugging",
                            "Emergencies",
                            "Critical",
                            "Informational",
                            "Alerts",
                            "Disabled",
                            "Warnings",
                            "Notifications",
                            "Default"
                          ],
                          "type": "string",
                          "x-ms-summary": "Log status"
                        }
                      },
                      "x-ms-summary": "Rule logging"
                    },
                    "DestinationSecurity": {
                      "required": [
                        "kind"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: SecurityName, SecurityTag, objectRef#SecurityObjGroup",
                          "enum": [
                            "SecurityName",
                            "SecurityTag",
                            "objectRef#SecurityObjGroup"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "objectId": {
                          "type": "string",
                          "x-ms-summary": "ObjectId"
                        },
                        "value": {
                          "type": "string",
                          "x-ms-summary": "Value"
                        }
                      },
                      "x-ms-summary": "Destination security"
                    },
                    "SourceSecurity": {
                      "required": [
                        "kind"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: SecurityName, SecurityTag, objectRef#SecurityObjGroup",
                          "enum": [
                            "SecurityName",
                            "SecurityTag",
                            "objectRef#SecurityObjGroup"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "objectId": {
                          "type": "string",
                          "x-ms-summary": "ObjectId"
                        },
                        "value": {
                          "type": "string",
                          "x-ms-summary": "Value"
                        }
                      },
                      "x-ms-summary": "Source security"
                    },
                    "User": {
                      "required": [
                        "kind"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: AnyUser, NoneUser, objectRef#LocalUserObjGroup, objectRef#UserGroupObj, objectRef#UserObj",
                          "enum": [
                            "AnyUser",
                            "NoneUser",
                            "objectRef#LocalUserObjGroup",
                            "objectRef#UserGroupObj",
                            "objectRef#UserObj"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "objectId": {
                          "type": "string",
                          "x-ms-summary": "ObjectId"
                        },
                        "value": {
                          "type": "string",
                          "x-ms-summary": "Value"
                        }
                      },
                      "x-ms-summary": "User"
                    },
                    "TimeRange": {
                      "required": [
                        "kind"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: objectRef#TimeRange",
                          "enum": [
                            "objectRef#TimeRange"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "objectId": {
                          "type": "string",
                          "x-ms-summary": "OjectId"
                        },
                        "value": {
                          "type": "string",
                          "x-ms-summary": "Value"
                        }
                      },
                      "x-ms-summary": "Time range"
                    },
                    "ExtendedACE": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: object#ExtendedACE",
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "selfLink": {
                          "description": "Unique URI for this resource object",
                          "type": "string",
                          "x-ms-summary": "SelfLink"
                        },
                        "permit": {
                          "description": "Hows if the action is permit or deny",
                          "type": "boolean",
                          "x-ms-summary": "Permit"
                        },
                        "sourceAddress": {
                          "$ref": "#/definitions/SourceAddress"
                        },
                        "destinationAddress": {
                          "$ref": "#/definitions/DestinationAddress"
                        },
                        "sourceService": {
                          "$ref": "#/definitions/SourceService"
                        },
                        "destinationService": {
                          "$ref": "#/definitions/DestinationService"
                        },
                        "active": {
                          "description": "Shows if the rule is active or inactive, default is active",
                          "type": "boolean",
                          "x-ms-summary": "Active"
                        },
                        "remarks": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "x-ms-summary": "Remarks"
                        },
                        "ruleLogging": {
                          "$ref": "#/definitions/Rulelogging"
                        },
                        "position": {
                          "format": "int32",
                          "description": "The position of the ace inside the ACL",
                          "type": "integer",
                          "x-ms-summary": "Position"
                        },
                        "isAccessRule": {
                          "type": "boolean",
                          "x-ms-summary": "Is access rule"
                        },
                        "objectId": {
                          "description": "Unique ID of this resource object",
                          "type": "string",
                          "x-ms-summary": "ObjectId"
                        },
                        "dstSecurity": {
                          "$ref": "#/definitions/DestinationSecurity"
                        },
                        "srcSecurity": {
                          "$ref": "#/definitions/SourceSecurity"
                        },
                        "user": {
                          "$ref": "#/definitions/User"
                        },
                        "timeRange": {
                          "$ref": "#/definitions/TimeRange"
                        }
                      }
                    },
                    "ExtendedACECollection": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: collection#ExtendedACE",
                          "type": "string",
                          "x-ms-summary": "Collection kind"
                        },
                        "selfLink": {
                          "description": "Unique URI for this resource object",
                          "type": "string",
                          "x-ms-summary": "Collection selfLink"
                        },
                        "rangeInfo": {
                          "$ref": "#/definitions/RangeInfo"
                        },
                        "items": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/ExtendedACE"
                          },
                          "x-ms-summary": "Extended ACE items"
                        }
                      }
                    },
                    "ExtendedACEPost": {
                      "required": [
                        "active",
                        "destinationAddress",
                        "destinationService",
                        "permit",
                        "sourceAddress"
                      ],
                      "type": "object",
                      "properties": {
                        "permit": {
                          "description": "Hows if the action is permit or deny",
                          "type": "boolean",
                          "x-ms-summary": "Permit"
                        },
                        "sourceAddress": {
                          "$ref": "#/definitions/SourceAddress"
                        },
                        "destinationAddress": {
                          "$ref": "#/definitions/DestinationAddress"
                        },
                        "sourceService": {
                          "$ref": "#/definitions/SourceService"
                        },
                        "destinationService": {
                          "$ref": "#/definitions/DestinationService"
                        },
                        "active": {
                          "description": "Shows if the rule is active or inactive, default is active",
                          "type": "boolean",
                          "x-ms-summary": "Active"
                        },
                        "remarks": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "x-ms-summary": "Remarks"
                        },
                        "ruleLogging": {
                          "$ref": "#/definitions/Rulelogging"
                        },
                        "position": {
                          "format": "int32",
                          "description": "The position of the ace inside the ACL",
                          "type": "integer",
                          "x-ms-summary": "Position"
                        },
                        "dstSecurity": {
                          "$ref": "#/definitions/DestinationSecurity"
                        },
                        "srcSecurity": {
                          "$ref": "#/definitions/SourceSecurity"
                        },
                        "user": {
                          "$ref": "#/definitions/User"
                        },
                        "timeRange": {
                          "$ref": "#/definitions/TimeRange"
                        }
                      }
                    },
                    "IPAddress": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: object#IPAddress",
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "selfLink": {
                          "description": "Unique URI for this resource object",
                          "type": "string",
                          "x-ms-summary": "SelfLink"
                        },
                        "ipAddress": {
                          "description": "Master IP Address",
                          "type": "string",
                          "x-ms-summary": "IP address"
                        },
                        "isClusterInterface": {
                          "description": "Cluster Interface",
                          "type": "boolean",
                          "x-ms-summary": "Is cluster interface"
                        },
                        "netmask": {
                          "description": "Netmask",
                          "type": "string",
                          "x-ms-summary": "Netmask"
                        },
                        "interface": {
                          "$ref": "#/definitions/Interface"
                        },
                        "objectId": {
                          "description": "Unique ID of this resource object",
                          "type": "string",
                          "x-ms-summary": "ObjectId"
                        },
                        "masterIpAddress": {
                          "description": "Master IP Address",
                          "type": "string",
                          "x-ms-summary": "Master IP address"
                        },
                        "masterIpNetmask": {
                          "description": "Master IP Netmask",
                          "type": "string",
                          "x-ms-summary": "Master IP Netmask"
                        }
                      }
                    },
                    "IPAddressCollection": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: collection#IPAddressDetails",
                          "type": "string",
                          "x-ms-summary": "Collection kind"
                        },
                        "selfLink": {
                          "description": "Unique URI for this resource object",
                          "type": "string",
                          "x-ms-summary": "Collection selfLink"
                        },
                        "rangeInfo": {
                          "$ref": "#/definitions/RangeInfo"
                        },
                        "items": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/IPAddress"
                          },
                          "x-ms-summary": "IP Address items"
                        }
                      }
                    },
                    "NetworkObjGroupMember": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: IPv4Address, IPv4Network, IPv6Address, IPv6Network, objectRef#NetworkObj",
                          "type": "string",
                          "x-ms-summary": "Member kind"
                        },
                        "value": {
                          "type": "string",
                          "x-ms-summary": "Member value"
                        },
                        "refLink": {
                          "type": "string",
                          "x-ms-summary": "Member refLink"
                        },
                        "objectId": {
                          "description": "Unique ID of this resource object",
                          "type": "string",
                          "x-ms-summary": "Member objectId"
                        }
                      }
                    },
                    "NetworkObjGroup": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: object#NetworkObjGroup",
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "selfLink": {
                          "description": "Unique URI for this resource object",
                          "type": "string",
                          "x-ms-summary": "SelfLink"
                        },
                        "name": {
                          "type": "string",
                          "x-ms-summary": "Name"
                        },
                        "members": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/NetworkObjGroupMember"
                          },
                          "x-ms-summary": "Members"
                        },
                        "description": {
                          "type": "string",
                          "x-ms-summary": "Description"
                        },
                        "objectId": {
                          "description": "Unique ID of this resource object",
                          "type": "string",
                          "x-ms-summary": "ObjectId"
                        }
                      }
                    },
                    "NetworkObjGroupCollection": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: collection#NetworkObjGroup",
                          "type": "string",
                          "x-ms-summary": "Collection kind"
                        },
                        "selfLink": {
                          "description": "Unique URI for this resource object",
                          "type": "string",
                          "x-ms-summary": "Collection selfLink"
                        },
                        "rangeInfo": {
                          "$ref": "#/definitions/RangeInfo"
                        },
                        "items": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/NetworkObjGroup"
                          },
                          "x-ms-summary": "Network object group items"
                        }
                      }
                    },
                    "NetworkObjGroupMemberPost": {
                      "required": [
                        "kind"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: IPv4Address, IPv4Range, IPv4Network, IPv4FQDN, IPv6Address, IPv6Range, IPv6Network, objectRef#NetworkObj",
                          "enum": [
                            "IPv4Address",
                            "IPv4Range",
                            "IPv4Network",
                            "IPv4FQDN",
                            "IPv6Address",
                            "IPv6Range",
                            "IPv6Network",
                            "objectRef#NetworkObj"
                          ],
                          "type": "string",
                          "x-ms-summary": "Member kind"
                        },
                        "value": {
                          "description": "Used when 'Member kind' is IPv4Address, IPv4Network, IPv6Address or IPv6Network",
                          "type": "string",
                          "x-ms-summary": "Member value"
                        },
                        "objectId": {
                          "description": "Unique ID of this resource object, used when 'Member kind' is objectRef#NetworkObj",
                          "type": "string",
                          "x-ms-summary": "Member objectId"
                        }
                      }
                    },
                    "NetworkObjGroupPost": {
                      "required": [
                        "kind",
                        "members",
                        "name"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: object#NetworkObjGroup",
                          "default": "object#NetworkObjGroup",
                          "enum": [
                            "object#NetworkObjGroup"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "name": {
                          "type": "string",
                          "x-ms-summary": "Name"
                        },
                        "members": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/NetworkObjGroupMemberPost"
                          },
                          "x-ms-summary": "Members"
                        },
                        "description": {
                          "type": "string",
                          "x-ms-summary": "Description"
                        }
                      }
                    },
                    "NetworkObjGroupPatch": {
                      "type": "object",
                      "properties": {
                        "members": {
                          "description": "Set this field to replace all the members of the network object group",
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/NetworkObjGroupMemberPost"
                          },
                          "x-ms-summary": "Override group members"
                        },
                        "members.add": {
                          "description": "Set this field to add members to the network object group",
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/NetworkObjGroupMemberPost"
                          },
                          "x-ms-summary": "Add group members"
                        },
                        "members.remove": {
                          "description": "Set this field to remove members from the network object group",
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/NetworkObjGroupMemberPost"
                          },
                          "x-ms-summary": "Remove group members"
                        }
                      }
                    },
                    "Host": {
                      "required": [
                        "kind",
                        "value"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "One of: IPv4Address, IPv4Range, IPv4Network, IPv4FQDN, IPv6Address, IPv6Range, IPv6Network",
                          "enum": [
                            "IPv4Address",
                            "IPv4Range",
                            "IPv4Network",
                            "IPv4FQDN",
                            "IPv6Address",
                            "IPv6Range",
                            "IPv6Network"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "value": {
                          "type": "string",
                          "x-ms-summary": "Value"
                        }
                      },
                      "x-ms-summary": "Host"
                    },
                    "NetworkObject": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: object#NetworkObj",
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "selfLink": {
                          "description": "Unique URI for this resource object",
                          "type": "string",
                          "x-ms-summary": "SelfLink"
                        },
                        "name": {
                          "type": "string",
                          "x-ms-summary": "Name"
                        },
                        "host": {
                          "$ref": "#/definitions/Host"
                        },
                        "description": {
                          "type": "string",
                          "x-ms-summary": "Description"
                        },
                        "objectId": {
                          "description": "Unique ID of this resource object",
                          "type": "string",
                          "x-ms-summary": "ObjectId"
                        }
                      }
                    },
                    "NetworkObjectCollection": {
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: collection#NetworkObj",
                          "type": "string",
                          "x-ms-summary": "Collection kind"
                        },
                        "selfLink": {
                          "description": "Unique URI for this resource object",
                          "type": "string",
                          "x-ms-summary": "Collection selfLink"
                        },
                        "rangeInfo": {
                          "$ref": "#/definitions/RangeInfo"
                        },
                        "items": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/NetworkObject"
                          },
                          "x-ms-summary": "Network object items"
                        }
                      }
                    },
                    "NetworkObjectPost": {
                      "required": [
                        "host",
                        "kind",
                        "name"
                      ],
                      "type": "object",
                      "properties": {
                        "kind": {
                          "description": "The kind of this resource object: object#NetworkObj",
                          "default": "object#NetworkObj",
                          "enum": [
                            "object#NetworkObj"
                          ],
                          "type": "string",
                          "x-ms-summary": "Kind"
                        },
                        "name": {
                          "type": "string",
                          "x-ms-summary": "Name"
                        },
                        "host": {
                          "$ref": "#/definitions/Host"
                        },
                        "description": {
                          "type": "string",
                          "x-ms-summary": "Description"
                        }
                      }
                    }
                  },
                  "securityDefinitions": {
                    "basic_auth": {
                      "type": "basic",
                      "description": "Basic Authorization header"
                    }
                  },
                  "security": [
                    {
                      "basic_auth": "[variables('TemplateEmptyArray')]"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "CiscoASA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "LogicAppsCustomConnector",
        "displayName": "CiscoASAConnector",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoASA-AddIPtoNetworkObjectGroup Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "CiscoASA-AddIPtoNetworkObjectGroup",
              "type": "String",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            },
            "Cisco ASA Connector name": {
              "defaultValue": "CiscoASAConnector",
              "type": "String",
              "metadata": {
                "description": "Cisco ASA Connector name"
              }
            },
            "Network Object Group object ID": {
              "type": "String",
              "metadata": {
                "description": "Network Object Group object ID"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[[concat('teamsconnector-', parameters('PlaybookName'))]",
            "CiscoASAConnectionName": "[[concat('ciscoasaconnector-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('Cisco ASA Connector name'))]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('TeamsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('CiscoASAConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('CiscoASAConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Network Object Group object ID": {
                      "defaultValue": "[variables('blanks')]",
                      "type": "String"
                    }
                  },
                  "staticResults": {
                    "Add_comment_to_incident_(V3)0": {
                      "status": "Succeeded",
                      "outputs": {
                        "statusCode": "OK"
                      }
                    },
                    "Entities_-_Get_IPs0": {
                      "status": "Succeeded",
                      "outputs": {
                        "body": {
                          "IPs": [
                            {
                              "Address": "192.168.11.1"
                            },
                            {
                              "Address": "192.168.11.2"
                            },
                            {
                              "Address": "192.168.11.3"
                            }
                          ]
                        },
                        "statusCode": "OK"
                      }
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      },
                      "runtimeConfiguration": {
                        "staticResult": {
                          "staticResultOptions": "Disabled",
                          "name": "Entities_-_Get_IPs0"
                        }
                      }
                    },
                    "Fetch_a_network_object_group": {
                      "runAfter": {
                        "Initialize_Network_Object_Group_object_ID_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "User-Agent": "REST API Agent"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['cisco-ASAv-connector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/api/objects/networkobjectgroups/@{encodeURIComponent(variables('Network Object Group object ID'))}"
                      }
                    },
                    "For_each_over_IPs": {
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Append_to_ipAddresses_variable": {
                          "runAfter": {
                            "If_Network_Object_Group_contains_IP": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "ipAddresses",
                            "value": {
                              "IPAddress": "@{items('For_each_over_IPs')?['Address']}",
                              "controlName": "ipAddressAction@{variables('forEachIndex')}",
                              "existsInNetworkObjectGroup": "@if(greater(length(body('Filter_Network_Object_Group_Members_for_IP_Address')), 0), true, false)"
                            }
                          }
                        },
                        "Filter_Network_Object_Group_Members_for_IP_Address": {
                          "type": "Query",
                          "inputs": {
                            "from": "@body('Fetch_a_network_object_group')?['members']",
                            "where": "@and(equals(item()?['kind'], 'IPv4Address'), equals(item()?['value'], items('For_each_over_IPs')?['Address']))"
                          }
                        },
                        "If_Network_Object_Group_contains_IP": {
                          "actions": {
                            "Append_to_adaptiveCardIPAddressItems_variable_remove_block": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "adaptiveCardIPAddressItems",
                                "value": {
                                  "columns": [
                                    {
                                      "items": [
                                        {
                                          "text": "Unblock '@{items('For_each_over_IPs')?['Address']}'?",
                                          "type": "TextBlock",
                                          "wrap": true
                                        }
                                      ],
                                      "type": "Column",
                                      "width": "stretch"
                                    },
                                    {
                                      "items": [
                                        {
                                          "choices": [
                                            {
                                              "title": "Ignore",
                                              "value": "ignore"
                                            },
                                            {
                                              "title": "Unblock",
                                              "value": "unblock"
                                            }
                                          ],
                                          "id": "ipAddressAction@{variables('forEachIndex')}",
                                          "placeholder": "Placeholder text",
                                          "type": "Input.ChoiceSet",
                                          "value": "ignore"
                                        }
                                      ],
                                      "type": "Column",
                                      "width": "stretch"
                                    }
                                  ],
                                  "type": "ColumnSet"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Filter_Network_Object_Group_Members_for_IP_Address": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_to_adaptiveCardIPAddressItems_variable_add_block": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "adaptiveCardIPAddressItems",
                                  "value": {
                                    "columns": [
                                      {
                                        "items": [
                                          {
                                            "text": "Block '@{items('For_each_over_IPs')?['Address']}'?",
                                            "type": "TextBlock",
                                            "wrap": true
                                          }
                                        ],
                                        "type": "Column",
                                        "width": "stretch"
                                      },
                                      {
                                        "items": [
                                          {
                                            "choices": [
                                              {
                                                "title": "Ignore",
                                                "value": "ignore"
                                              },
                                              {
                                                "title": "Block",
                                                "value": "block"
                                              }
                                            ],
                                            "id": "ipAddressAction@{variables('forEachIndex')}",
                                            "placeholder": "Placeholder text",
                                            "type": "Input.ChoiceSet",
                                            "value": "ignore"
                                          }
                                        ],
                                        "type": "Column",
                                        "width": "stretch"
                                      }
                                    ],
                                    "type": "ColumnSet"
                                  }
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Filter_Network_Object_Group_Members_for_IP_Address'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Increment_for_For_Each_index": {
                          "runAfter": {
                            "Append_to_ipAddresses_variable": [
                              "Succeeded"
                            ]
                          },
                          "type": "IncrementVariable",
                          "inputs": {
                            "name": "forEachIndex",
                            "value": 1
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_For_Each_index_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "If_PostToTeams_submit_action_is_Submit": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "For_each_over_ipAddresses": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p><span style=\"font-size: 16px\"><strong>Cisco ASA playbook run summary</strong></span><br>\n<span style=\"font-size: 14px\">The following IPs were found in the Incident:</span><br>\n@{variables('ipAddressesActionComment')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          },
                          "runtimeConfiguration": {
                            "staticResult": {
                              "staticResultOptions": "Disabled",
                              "name": "Add_comment_to_incident_(V3)0"
                            }
                          }
                        },
                        "For_each_over_ipAddresses": {
                          "foreach": "@variables('ipAddresses')",
                          "actions": {
                            "Switch_PostToTeams_data_for_IP_Address": {
                              "cases": {
                                "Case_block": {
                                  "case": "block",
                                  "actions": {
                                    "Append_blocked_comment_to_ipAddressActionComment": {
                                      "runAfter": {
                                        "Patch_members_of_a_network_object_group_to_add_IPAddress": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "ipAddressesActionComment",
                                        "value": "@{items('For_each_over_ipAddresses')['IPAddress']} - blocked in Cisco ASA\n"
                                      }
                                    },
                                    "Patch_members_of_a_network_object_group_to_add_IPAddress": {
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "body": {
                                          "members.add": [
                                            {
                                              "kind": "IPv4Address",
                                              "value": "@{items('For_each_over_ipAddresses')['IPAddress']}"
                                            }
                                          ]
                                        },
                                        "headers": {
                                          "User-Agent": "REST API Agent"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['cisco-ASAv-connector']['connectionId']"
                                          }
                                        },
                                        "method": "patch",
                                        "path": "/api/objects/networkobjectgroups/@{encodeURIComponent(variables('Network Object Group object ID'))}"
                                      }
                                    }
                                  }
                                },
                                "Case_unblock": {
                                  "case": "unblock",
                                  "actions": {
                                    "Append_unblocked_comment_to_ipAddressActionComment": {
                                      "runAfter": {
                                        "Patch_members_of_a_network_object_group_to_remove_IPAddress": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "ipAddressesActionComment",
                                        "value": "@{items('For_each_over_ipAddresses')['IPAddress']} - unblocked in Cisco ASA\n"
                                      }
                                    },
                                    "Patch_members_of_a_network_object_group_to_remove_IPAddress": {
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "body": {
                                          "members.remove": [
                                            {
                                              "kind": "IPv4Address",
                                              "value": "@{items('For_each_over_ipAddresses')['IPAddress']}"
                                            }
                                          ]
                                        },
                                        "headers": {
                                          "User-Agent": "REST API Agent"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['cisco-ASAv-connector']['connectionId']"
                                          }
                                        },
                                        "method": "patch",
                                        "path": "/api/objects/networkobjectgroups/@{encodeURIComponent(variables('Network Object Group object ID'))}"
                                      }
                                    }
                                  }
                                }
                              },
                              "default": {
                                "actions": {
                                  "Append_no_action_taken_comment_to_ipAddressActionComment": {
                                    "type": "AppendToStringVariable",
                                    "inputs": {
                                      "name": "ipAddressesActionComment",
                                      "value": "@{items('For_each_over_ipAddresses')['IPAddress']} - no action taken in Cisco ASA\n"
                                    }
                                  }
                                }
                              },
                              "expression": "@outputs('PostToTeams')['body']['data'][item()['controlName']]",
                              "type": "Switch"
                            }
                          },
                          "type": "Foreach"
                        },
                        "Update_incident": {
                          "runAfter": {
                            "Add_comment_to_incident_(V3)": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "classification": {
                                "ClassificationAndReason": "@{outputs('PostToTeams')['body']['data']['incidentStatus']}"
                              },
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "severity": "@{outputs('PostToTeams')['body']['data']['incidentSeverity']}",
                              "status": "Closed"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_ipAddressesActionComment_variable": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@outputs('PostToTeams')['body']['submitActionId']",
                              "Submit"
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Initialize_Adaptive_Card_IP_Address_variable": {
                      "runAfter": {
                        "Initialize_ipAddresses_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "adaptiveCardIPAddressItems",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_For_Each_index_variable": {
                      "runAfter": {
                        "Initialize_Adaptive_Card_IP_Address_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "forEachIndex",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "Initialize_Network_Object_Group_object_ID_variable": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Network Object Group object ID",
                            "type": "string",
                            "value": "@parameters('Network Object Group object ID')"
                          }
                        ]
                      }
                    },
                    "Initialize_ipAddressesActionComment_variable": {
                      "runAfter": {
                        "PostToTeams": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ipAddressesActionComment",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_ipAddresses_variable": {
                      "runAfter": {
                        "Fetch_a_network_object_group": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ipAddresses",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "PostToTeams": {
                      "runAfter": {
                        "For_each_over_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "body": {
                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"Large\",\n            \"weight\": \"Bolder\",\n            \"text\": \"Suspicious IP - Microsoft Sentinel\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"@{triggerBody()?['object']?['properties']?['severity']} incident @{triggerBody()?['object']?['properties']?['title']}\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Incident description\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"@{triggerBody()?['object']?['properties']?['description']}\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Alert product names\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"@{join(triggerBody()?['object']?['properties']?['additionalData']?['alertProductNames'], ', ')}\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration:\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close MicroSoft Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Informational\",\n                    \"value\": \"Informational\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Cisco ASA Actions\",\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"Image\",\n            \"url\": \"data:image/png;base64,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\",\n            \"size\": \"Medium\"\n        },\n        {\n            \"type\": \"Container\",\n            \"items\": @{variables('adaptiveCardIPAddressItems')}\n        }\n    ],\n    \"actions\": [\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Submit\"\n        },\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Ignore\"\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                            "recipient": {
                              "channelId": "[variables('blanks')]"
                            },
                            "shouldUpdateCard": true,
                            "updateMessage": "Thanks for your response, it is being processed."
                          },
                          "notificationUrl": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['teams']['connectionId']"
                          }
                        },
                        "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                        "queries": {
                          "groupId": "[variables('blanks')]"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "cisco-ASAv-connector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('CiscoASAConnectionName'))]",
                        "connectionName": "[[variables('CiscoASAConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('Cisco ASA Connector name'))]"
                      },
                      "teams": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[[variables('TeamsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]"
                      }
                    }
                  },
                  "Network Object Group object ID": {
                    "value": "[[parameters('Network Object Group object ID')]"
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "CiscoASA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_CiscoASAConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Block IP - Cisco ASA",
            "description": "This playbook allows blocking/allowing of IPs in Cisco ASA, using a Network Object Group. The Network Object Group itself should be part of an Access Control Entry.",
            "prerequisites": [
              "1. In Cisco ASA there needs to be a Network Object Group. You can create a Network Object Group using Cisco ASDM, [Configure a Network Object Group](https://www.cisco.com/c/en/us/td/docs/security/asa/asa96/asdm76/firewall/asdm-76-firewall-config/access-objects.html#ariaid-title6), or using the CLI, [Configuring a Network Object Group](https://www.cisco.com/c/en/us/td/docs/security/asa/asa96/configuration/firewall/asa-96-firewall-config/access-objects.html#ID-2122-0000007d). The Network Object Group can be blocked using an access rule, [Configure Access Rules](https://www.cisco.com/c/en/us/td/docs/security/asa/asa96/asdm76/firewall/asdm-76-firewall-config/access-rules.html#ID-2124-00000152).",
              "2. Cisco ASA custom connector needs to be deployed prior to the deployment of this playbook (link below), in the same resource group and region.",
              "3. To authenticate the connector, in Cisco ASA create a local user and allow it to use the REST API. Depending on the playbook used the user needs to be able to add members to a network object group or create access control entries, by default that requires privilege level 15."
            ],
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, you will need to authorize each connection.",
              "1. Click the Microsoft Sentinel connection resource",
              "2.Click edit API connection",
              "3.Click Authorize",
              "4.Sign in",
              "5.Click Save",
              "6.Repeat steps for other connections such as Teams and Cisco ASA (For authorizing the Cisco ASA API connection, the username and password needs to be provided)",
              "**b. Select Teams channel**",
              "The Teams channel to which the adaptive card will be posted will need to be configured.",
              "1. Click the Azure Logic app resource",
              "2. Edit the Logic App",
              "3. Find the 'PostToTeams' action",
              "4. Select a Team and Channel",
              "5. Save the Logic App",
              "**c. Configurations in Sentinel**",
              "1. In Microsoft Sentinel analytical rules should be configured to trigger an incident with IP Entity.",
              "2. Configure the automation rules to trigger this playbook"
            ],
            "lastUpdateTime": "2021-07-28T00:00:00Z",
            "entities": [
              "Ip"
            ],
            "tags": [
              "Remediation",
              "Response from teams"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "CiscoASA-AddIPtoNetworkObjectGroup",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoASA-CreateACEInACL Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "CiscoASA-CreateACEInACL",
              "type": "String",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            },
            "Cisco ASA Connector name": {
              "defaultValue": "CiscoASAConnector",
              "type": "String",
              "metadata": {
                "description": "Cisco ASA Connector name"
              }
            },
            "ACL Name": {
              "type": "String",
              "metadata": {
                "description": "ACL Name"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[[concat('teamsconnector-', parameters('PlaybookName'))]",
            "CiscoASAConnectionName": "[[concat('ciscoasaconnector-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('Cisco ASA Connector name'))]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('TeamsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('CiscoASAConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('CiscoASAConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "ACL Name": {
                      "defaultValue": "[variables('blanks')]",
                      "type": "String"
                    }
                  },
                  "staticResults": {
                    "Add_comment_to_incident_(V3)0": {
                      "status": "Succeeded",
                      "outputs": {
                        "statusCode": "OK"
                      }
                    },
                    "Entities_-_Get_IPs0": {
                      "status": "Succeeded",
                      "outputs": {
                        "body": {
                          "IPs": [
                            {
                              "Address": "192.168.11.1"
                            },
                            {
                              "Address": "192.168.11.2"
                            },
                            {
                              "Address": "192.168.11.3"
                            }
                          ]
                        },
                        "statusCode": "OK"
                      }
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      },
                      "runtimeConfiguration": {
                        "staticResult": {
                          "staticResultOptions": "Disabled",
                          "name": "Entities_-_Get_IPs0"
                        }
                      }
                    },
                    "Fetch_ACEs_on_an_interface": {
                      "runAfter": {
                        "Initialize_ACL_Name_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "User-Agent": "REST API Agent"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['cisco-ASAv-connector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/api/objects/extendedacls/@{encodeURIComponent(variables('ACL Name'))}/aces"
                      }
                    },
                    "For_each_over_IPs": {
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Filter_Extended_ACE_items_for_IP_Address": {
                          "type": "Query",
                          "inputs": {
                            "from": "@body('Fetch_ACEs_on_an_interface')?['items']",
                            "where": "@and(equals(item()?['sourceAddress']?['kind'], 'IPv4Address'), equals(item()?['sourceAddress']?['value'], items('For_each_over_IPs')?['Address']))"
                          }
                        },
                        "If_Access_Control_List_contains_rule_with_IP": {
                          "actions": {
                            "Append_exist_item_to_ipAddresses_variable": {
                              "runAfter": {
                                "Append_to_adaptiveCardIPAddressItems_variable_remove_block": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "ipAddresses",
                                "value": {
                                  "IPAddress": "@{items('For_each_over_IPs')?['Address']}",
                                  "controlName": "ipAddressAction@{variables('forEachIndex')}",
                                  "existsInExtendedAceItems": "@if(greater(length(body('Filter_Extended_ACE_items_for_IP_Address')), 0), true, false)",
                                  "extendedAceItemObjectId": "@{body('Filter_Extended_ACE_items_for_IP_Address')[0]?['objectId']}"
                                }
                              }
                            },
                            "Append_to_adaptiveCardIPAddressItems_variable_remove_block": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "adaptiveCardIPAddressItems",
                                "value": {
                                  "columns": [
                                    {
                                      "items": [
                                        {
                                          "text": "Unblock '@{items('For_each_over_IPs')?['Address']}'?",
                                          "type": "TextBlock",
                                          "wrap": true
                                        }
                                      ],
                                      "type": "Column",
                                      "width": "stretch"
                                    },
                                    {
                                      "items": [
                                        {
                                          "choices": [
                                            {
                                              "title": "Ignore",
                                              "value": "ignore"
                                            },
                                            {
                                              "title": "Unblock",
                                              "value": "unblock"
                                            }
                                          ],
                                          "id": "ipAddressAction@{variables('forEachIndex')}",
                                          "placeholder": "Placeholder text",
                                          "type": "Input.ChoiceSet",
                                          "value": "ignore"
                                        }
                                      ],
                                      "type": "Column",
                                      "width": "stretch"
                                    }
                                  ],
                                  "type": "ColumnSet"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Filter_Extended_ACE_items_for_IP_Address": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_does_not_exist_item_to_ipAddresses_variable": {
                                "runAfter": {
                                  "Append_to_adaptiveCardIPAddressItems_variable_add_block": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "ipAddresses",
                                  "value": {
                                    "IPAddress": "@{items('For_each_over_IPs')?['Address']}",
                                    "controlName": "ipAddressAction@{variables('forEachIndex')}",
                                    "existsInExtendedAceItems": "@if(greater(length(body('Filter_Extended_ACE_items_for_IP_Address')), 0), true, false)",
                                    "extendedAceItemObjectId": "[variables('blanks')]"
                                  }
                                }
                              },
                              "Append_to_adaptiveCardIPAddressItems_variable_add_block": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "adaptiveCardIPAddressItems",
                                  "value": {
                                    "columns": [
                                      {
                                        "items": [
                                          {
                                            "text": "Block '@{items('For_each_over_IPs')?['Address']}'?",
                                            "type": "TextBlock",
                                            "wrap": true
                                          }
                                        ],
                                        "type": "Column",
                                        "width": "stretch"
                                      },
                                      {
                                        "items": [
                                          {
                                            "choices": [
                                              {
                                                "title": "Ignore",
                                                "value": "ignore"
                                              },
                                              {
                                                "title": "Block",
                                                "value": "block"
                                              }
                                            ],
                                            "id": "ipAddressAction@{variables('forEachIndex')}",
                                            "placeholder": "Placeholder text",
                                            "type": "Input.ChoiceSet",
                                            "value": "ignore"
                                          }
                                        ],
                                        "type": "Column",
                                        "width": "stretch"
                                      }
                                    ],
                                    "type": "ColumnSet"
                                  }
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Filter_Extended_ACE_items_for_IP_Address'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Increment_for_For_Each_index": {
                          "runAfter": {
                            "If_Access_Control_List_contains_rule_with_IP": [
                              "Succeeded"
                            ]
                          },
                          "type": "IncrementVariable",
                          "inputs": {
                            "name": "forEachIndex",
                            "value": 1
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_For_Each_index_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "If_PostToTeams_submit_action_is_Submit": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "For_each_over_ipAddresses": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p><span style=\"font-size: 16px\"><strong>Cisco ASA playbook run summary</strong></span><br>\n<span style=\"font-size: 14px\">The following IPs were found in the Incident:</span><br>\n@{variables('ipAddressesActionComment')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          },
                          "runtimeConfiguration": {
                            "staticResult": {
                              "staticResultOptions": "Disabled",
                              "name": "Add_comment_to_incident_(V3)0"
                            }
                          }
                        },
                        "For_each_over_ipAddresses": {
                          "foreach": "@variables('ipAddresses')",
                          "actions": {
                            "Switch_PostToTeams_data_for_IP_Address": {
                              "cases": {
                                "Case_block": {
                                  "case": "block",
                                  "actions": {
                                    "Add_a_new_ACE_on_an_interface": {
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "body": {
                                          "active": true,
                                          "destinationAddress": {
                                            "kind": "AnyIPAddress",
                                            "value": "any4"
                                          },
                                          "destinationService": {
                                            "kind": "NetworkProtocol",
                                            "value": "ip"
                                          },
                                          "permit": false,
                                          "sourceAddress": {
                                            "kind": "IPv4Address",
                                            "value": "@{items('For_each_over_ipAddresses')['IPAddress']}"
                                          }
                                        },
                                        "headers": {
                                          "User-Agent": "REST API Agent"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['cisco-ASAv-connector']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/api/objects/extendedacls/@{encodeURIComponent(variables('ACL Name'))}/aces"
                                      }
                                    },
                                    "Append_blocked_comment_to_ipAddressActionComment": {
                                      "runAfter": {
                                        "Add_a_new_ACE_on_an_interface": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "ipAddressesActionComment",
                                        "value": "@{items('For_each_over_ipAddresses')['IPAddress']} - blocked in Cisco ASA\n"
                                      }
                                    }
                                  }
                                },
                                "Case_unblock": {
                                  "case": "unblock",
                                  "actions": {
                                    "Append_unblocked_comment_to_ipAddressActionComment": {
                                      "runAfter": {
                                        "Delete_an_ACE": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "ipAddressesActionComment",
                                        "value": "@{items('For_each_over_ipAddresses')['IPAddress']} - unblocked in Cisco ASA\n"
                                      }
                                    },
                                    "Delete_an_ACE": {
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "headers": {
                                          "User-Agent": "REST API Agent"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['cisco-ASAv-connector']['connectionId']"
                                          }
                                        },
                                        "method": "delete",
                                        "path": "/api/objects/extendedacls/@{encodeURIComponent(variables('ACL Name'))}/aces/@{encodeURIComponent(items('For_each_over_ipAddresses')['extendedAceItemObjectId'])}"
                                      }
                                    }
                                  }
                                }
                              },
                              "default": {
                                "actions": {
                                  "Append_no_action_taken_comment_to_ipAddressActionComment": {
                                    "type": "AppendToStringVariable",
                                    "inputs": {
                                      "name": "ipAddressesActionComment",
                                      "value": "@{items('For_each_over_ipAddresses')['IPAddress']} - no action taken in Cisco ASA\n"
                                    }
                                  }
                                }
                              },
                              "expression": "@outputs('PostToTeams')['body']['data'][item()['controlName']]",
                              "type": "Switch"
                            }
                          },
                          "type": "Foreach"
                        },
                        "Update_incident": {
                          "runAfter": {
                            "Add_comment_to_incident_(V3)": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "classification": {
                                "ClassificationAndReason": "@{outputs('PostToTeams')['body']['data']['incidentStatus']}"
                              },
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "severity": "@{outputs('PostToTeams')['body']['data']['incidentSeverity']}",
                              "status": "Closed"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_ipAddressesActionComment_variable": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@outputs('PostToTeams')['body']['submitActionId']",
                              "Submit"
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Initialize_ACL_Name_variable": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ACL Name",
                            "type": "string",
                            "value": "@parameters('ACL Name')"
                          }
                        ]
                      }
                    },
                    "Initialize_Adaptive_Card_IP_Address_variable": {
                      "runAfter": {
                        "Initialize_ipAddresses_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "adaptiveCardIPAddressItems",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_For_Each_index_variable": {
                      "runAfter": {
                        "Initialize_Adaptive_Card_IP_Address_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "forEachIndex",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "Initialize_ipAddressesActionComment_variable": {
                      "runAfter": {
                        "PostToTeams": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ipAddressesActionComment",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_ipAddresses_variable": {
                      "runAfter": {
                        "Fetch_ACEs_on_an_interface": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ipAddresses",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "PostToTeams": {
                      "runAfter": {
                        "For_each_over_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "body": {
                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"Large\",\n            \"weight\": \"Bolder\",\n            \"text\": \"Suspicious IP - Microsoft Sentinel\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"@{triggerBody()?['object']?['properties']?['severity']} incident @{triggerBody()?['object']?['properties']?['title']}\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Incident description\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"@{triggerBody()?['object']?['properties']?['description']}\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Alert product names\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"@{join(triggerBody()?['object']?['properties']?['additionalData']?['alertProductNames'], ', ')}\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration:\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close MicroSoft Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Informational\",\n                    \"value\": \"Informational\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Cisco ASA Actions\",\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"Image\",\n            \"url\": \"data:image/png;base64,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\",\n            \"size\": \"Medium\"\n        },\n        {\n            \"type\": \"Container\",\n            \"items\": @{variables('adaptiveCardIPAddressItems')}\n        }\n    ],\n    \"actions\": [\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Submit\"\n        },\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Ignore\"\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                            "recipient": {
                              "channelId": "[variables('blanks')]"
                            },
                            "shouldUpdateCard": true,
                            "updateMessage": "Thanks for your response, it is being processed."
                          },
                          "notificationUrl": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['teams']['connectionId']"
                          }
                        },
                        "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                        "queries": {
                          "groupId": "[variables('blanks')]"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "cisco-ASAv-connector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('CiscoASAConnectionName'))]",
                        "connectionName": "[[variables('CiscoASAConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('Cisco ASA Connector name'))]"
                      },
                      "teams": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[[variables('TeamsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]"
                      }
                    }
                  },
                  "ACL Name": {
                    "value": "[[parameters('ACL Name')]"
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "CiscoASA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_CiscoASAConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Cisco ASA - Create or remove access rules on an interface for IP Addresses",
            "description": "This playbook allows blocking/unblocking of IPs in Cisco ASA, using **Access Control Entries** which will be created in an access control list.",
            "prerequisites": [
              "1. **This playbook template is based on Microsoft Sentinel Incident Trigger which is currently in Private Preview (Automation Rules).** You can change the trigger to the Sentinel Alert trigger in cases you are not part of the Private Preview.",
              "2. Cisco ASA custom connector needs to be deployed prior to the deployment of this playbook, in the same resource group and region. Relevant instructions can be found in the connector doc page.",
              "3. Cisco ASA needs to have an extended Access Control List configured. Create a new ACL or retrieve the name of an existing ACL. To use Cisco ASDM to configure Extended ACLs, see [Configure Extended ACLs](https://www.cisco.com/c/en/us/td/docs/security/asa/asa914/asdm714/firewall/asdm-714-firewall-config/access-acls.html#ID-2069-0000016d)"
            ],
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, you will need to authorize each connection.",
              "1. Click the Microsoft Sentinel connection resource",
              "2.Click edit API connection",
              "3.Click Authorize",
              "4.Sign in",
              "5.Click Save",
              "6.Repeat steps for other connections such as Teams and Cisco ASA (For authorizing the Cisco ASA API connection, the username and password needs to be provided)",
              "**b. Select Teams channel**",
              "The Teams channel to which the adaptive card will be posted will need to be configured.",
              "1. Click the Azure Logic app resource",
              "2. Edit the Logic App",
              "3. Find the 'PostToTeams' action",
              "4. Select a Team and Channel",
              "5. Save the Logic App",
              "**c. Configurations in Sentinel**",
              "1. In Microsoft Sentinel analytical rules should be configured to trigger an incident with IP Entity.",
              "2. Configure the automation rules to trigger this playbook"
            ],
            "lastUpdateTime": "2021-07-28T00:00:00Z",
            "entities": [
              "Ip"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "CiscoASA-CreateACEInACL",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoASA-CreateInboundAccessRuleOnInterface Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "CiscoASA-CreateInboundAccessRuleOnInterface",
              "type": "String",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            },
            "Cisco ASA Connector name": {
              "defaultValue": "CiscoASAConnector",
              "type": "String",
              "metadata": {
                "description": "Cisco ASA Connector name"
              }
            },
            "Interface ID": {
              "type": "String",
              "metadata": {
                "description": "Interface ID"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[[concat('teamsconnector-', parameters('PlaybookName'))]",
            "CiscoASAConnectionName": "[[concat('ciscoasaconnector-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('Cisco ASA Connector name'))]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('TeamsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('CiscoASAConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('CiscoASAConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Interface ID": {
                      "defaultValue": "[variables('blanks')]",
                      "type": "String"
                    }
                  },
                  "staticResults": {
                    "Add_comment_to_incident_(V3)0": {
                      "status": "Succeeded",
                      "outputs": {
                        "statusCode": "OK"
                      }
                    },
                    "Entities_-_Get_IPs0": {
                      "status": "Succeeded",
                      "outputs": {
                        "body": {
                          "IPs": [
                            {
                              "Address": "192.168.11.1"
                            },
                            {
                              "Address": "192.168.11.2"
                            },
                            {
                              "Address": "192.168.11.3"
                            }
                          ]
                        },
                        "statusCode": "OK"
                      }
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      },
                      "runtimeConfiguration": {
                        "staticResult": {
                          "staticResultOptions": "Disabled",
                          "name": "Entities_-_Get_IPs0"
                        }
                      }
                    },
                    "Fetch_inbound_access_rules_on_an_interface": {
                      "runAfter": {
                        "Initialize_Interface_ID_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "User-Agent": "REST API Agent"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['cisco-ASAv-connector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/api/access/in/@{encodeURIComponent(variables('Interface ID'))}/rules"
                      }
                    },
                    "For_each_over_IPs": {
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Filter_Extended_ACE_items_for_IP_Address": {
                          "type": "Query",
                          "inputs": {
                            "from": "@body('Fetch_inbound_access_rules_on_an_interface')?['items']",
                            "where": "@and(equals(item()?['sourceAddress']?['kind'], 'IPv4Address'), equals(item()?['sourceAddress']?['value'], items('For_each_over_IPs')?['Address']))"
                          }
                        },
                        "If_Extended_ACE_items_contains_IP": {
                          "actions": {
                            "Append_exist_item_to_ipAddresses_variable": {
                              "runAfter": {
                                "Append_to_adaptiveCardIPAddressItems_variable_remove_block": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "ipAddresses",
                                "value": {
                                  "IPAddress": "@{items('For_each_over_IPs')?['Address']}",
                                  "controlName": "ipAddressAction@{variables('forEachIndex')}",
                                  "existsInExtendedAceItems": "@if(greater(length(body('Filter_Extended_ACE_items_for_IP_Address')), 0), true, false)",
                                  "extendedAceItemObjectId": "@{body('Filter_Extended_ACE_items_for_IP_Address')[0]?['objectId']}"
                                }
                              }
                            },
                            "Append_to_adaptiveCardIPAddressItems_variable_remove_block": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "adaptiveCardIPAddressItems",
                                "value": {
                                  "columns": [
                                    {
                                      "items": [
                                        {
                                          "text": "Unblock '@{items('For_each_over_IPs')?['Address']}'?",
                                          "type": "TextBlock",
                                          "wrap": true
                                        }
                                      ],
                                      "type": "Column",
                                      "width": "stretch"
                                    },
                                    {
                                      "items": [
                                        {
                                          "choices": [
                                            {
                                              "title": "Ignore",
                                              "value": "ignore"
                                            },
                                            {
                                              "title": "Unblock",
                                              "value": "unblock"
                                            }
                                          ],
                                          "id": "ipAddressAction@{variables('forEachIndex')}",
                                          "placeholder": "Placeholder text",
                                          "type": "Input.ChoiceSet",
                                          "value": "ignore"
                                        }
                                      ],
                                      "type": "Column",
                                      "width": "stretch"
                                    }
                                  ],
                                  "type": "ColumnSet"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Filter_Extended_ACE_items_for_IP_Address": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_does_not_exist_item_to_ipAddresses_variable": {
                                "runAfter": {
                                  "Append_to_adaptiveCardIPAddressItems_variable_add_block": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "ipAddresses",
                                  "value": {
                                    "IPAddress": "@{items('For_each_over_IPs')?['Address']}",
                                    "controlName": "ipAddressAction@{variables('forEachIndex')}",
                                    "existsInExtendedAceItems": "@if(greater(length(body('Filter_Extended_ACE_items_for_IP_Address')), 0), true, false)",
                                    "extendedAceItemObjectId": "[variables('blanks')]"
                                  }
                                }
                              },
                              "Append_to_adaptiveCardIPAddressItems_variable_add_block": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "adaptiveCardIPAddressItems",
                                  "value": {
                                    "columns": [
                                      {
                                        "items": [
                                          {
                                            "text": "Block '@{items('For_each_over_IPs')?['Address']}'?",
                                            "type": "TextBlock",
                                            "wrap": true
                                          }
                                        ],
                                        "type": "Column",
                                        "width": "stretch"
                                      },
                                      {
                                        "items": [
                                          {
                                            "choices": [
                                              {
                                                "title": "Ignore",
                                                "value": "ignore"
                                              },
                                              {
                                                "title": "Block",
                                                "value": "block"
                                              }
                                            ],
                                            "id": "ipAddressAction@{variables('forEachIndex')}",
                                            "placeholder": "Placeholder text",
                                            "type": "Input.ChoiceSet",
                                            "value": "ignore"
                                          }
                                        ],
                                        "type": "Column",
                                        "width": "stretch"
                                      }
                                    ],
                                    "type": "ColumnSet"
                                  }
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Filter_Extended_ACE_items_for_IP_Address'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Increment_for_For_Each_index": {
                          "runAfter": {
                            "If_Extended_ACE_items_contains_IP": [
                              "Succeeded"
                            ]
                          },
                          "type": "IncrementVariable",
                          "inputs": {
                            "name": "forEachIndex",
                            "value": 1
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_For_Each_index_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "If_PostToTeams_submit_action_is_Submit": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "For_each_over_ipAddresses": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p><span style=\"font-size: 16px\"><strong>Cisco ASA playbook run summary</strong></span><br>\n<span style=\"font-size: 14px\">The following IPs were found in the Incident:</span><br>\n@{variables('ipAddressesActionComment')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          },
                          "runtimeConfiguration": {
                            "staticResult": {
                              "staticResultOptions": "Disabled",
                              "name": "Add_comment_to_incident_(V3)0"
                            }
                          }
                        },
                        "For_each_over_ipAddresses": {
                          "foreach": "@variables('ipAddresses')",
                          "actions": {
                            "Switch_PostToTeams_data_for_IP_Address": {
                              "cases": {
                                "Case_block": {
                                  "case": "block",
                                  "actions": {
                                    "Append_blocked_comment_to_ipAddressActionComment": {
                                      "runAfter": {
                                        "Create_an_inbound_access_rule_on_an_interface": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "ipAddressesActionComment",
                                        "value": "@{items('For_each_over_ipAddresses')['IPAddress']} - blocked in Cisco ASA\n"
                                      }
                                    },
                                    "Create_an_inbound_access_rule_on_an_interface": {
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "body": {
                                          "active": true,
                                          "destinationAddress": {
                                            "kind": "AnyIPAddress",
                                            "value": "any4"
                                          },
                                          "destinationService": {
                                            "kind": "NetworkProtocol",
                                            "value": "ip"
                                          },
                                          "permit": false,
                                          "sourceAddress": {
                                            "kind": "IPv4Address",
                                            "value": "@{items('For_each_over_ipAddresses')['IPAddress']}"
                                          }
                                        },
                                        "headers": {
                                          "User-Agent": "REST API Agent"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['cisco-ASAv-connector']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/api/access/in/@{encodeURIComponent(variables('Interface ID'))}/rules"
                                      }
                                    }
                                  }
                                },
                                "Case_unblock": {
                                  "case": "unblock",
                                  "actions": {
                                    "Append_unblocked_comment_to_ipAddressActionComment": {
                                      "runAfter": {
                                        "Remove_an_inbound_access_rule_on_an_interface": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "ipAddressesActionComment",
                                        "value": "@{items('For_each_over_ipAddresses')['IPAddress']} - unblocked in Cisco ASA\n"
                                      }
                                    },
                                    "Remove_an_inbound_access_rule_on_an_interface": {
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "headers": {
                                          "User-Agent": "REST API Agent"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['cisco-ASAv-connector']['connectionId']"
                                          }
                                        },
                                        "method": "delete",
                                        "path": "/api/access/in/@{encodeURIComponent(variables('Interface ID'))}/rules/@{encodeURIComponent(items('For_each_over_ipAddresses')['extendedAceItemObjectId'])}"
                                      }
                                    }
                                  }
                                }
                              },
                              "default": {
                                "actions": {
                                  "Append_no_action_taken_comment_to_ipAddressActionComment": {
                                    "type": "AppendToStringVariable",
                                    "inputs": {
                                      "name": "ipAddressesActionComment",
                                      "value": "@{items('For_each_over_ipAddresses')['IPAddress']} - no action taken in Cisco ASA\n"
                                    }
                                  }
                                }
                              },
                              "expression": "@outputs('PostToTeams')['body']['data'][item()['controlName']]",
                              "type": "Switch"
                            }
                          },
                          "type": "Foreach"
                        },
                        "Update_incident": {
                          "runAfter": {
                            "Add_comment_to_incident_(V3)": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "classification": {
                                "ClassificationAndReason": "@{outputs('PostToTeams')['body']['data']['incidentStatus']}"
                              },
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "severity": "@{outputs('PostToTeams')['body']['data']['incidentSeverity']}",
                              "status": "Closed"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_ipAddressesActionComment_variable": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@outputs('PostToTeams')['body']['submitActionId']",
                              "Submit"
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Initialize_Adaptive_Card_IP_Address_variable": {
                      "runAfter": {
                        "Initialize_ipAddresses_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "adaptiveCardIPAddressItems",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_For_Each_index_variable": {
                      "runAfter": {
                        "Initialize_Adaptive_Card_IP_Address_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "forEachIndex",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "Initialize_Interface_ID_variable": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Interface ID",
                            "type": "string",
                            "value": "@parameters('Interface ID')"
                          }
                        ]
                      }
                    },
                    "Initialize_ipAddressesActionComment_variable": {
                      "runAfter": {
                        "PostToTeams": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ipAddressesActionComment",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_ipAddresses_variable": {
                      "runAfter": {
                        "Fetch_inbound_access_rules_on_an_interface": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ipAddresses",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "PostToTeams": {
                      "runAfter": {
                        "For_each_over_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "body": {
                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"size\": \"Large\",\n            \"weight\": \"Bolder\",\n            \"text\": \"Suspicious IP - Microsoft Sentinel\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"@{triggerBody()?['object']?['properties']?['severity']} incident @{triggerBody()?['object']?['properties']?['title']}\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Incident description\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"@{triggerBody()?['object']?['properties']?['description']}\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Alert product names\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"@{join(triggerBody()?['object']?['properties']?['additionalData']?['alertProductNames'], ', ')}\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration:\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close MicroSoft Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Informational\",\n                    \"value\": \"Informational\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Cisco ASA Actions\",\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"Image\",\n            \"url\": \"data:image/png;base64,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\",\n            \"size\": \"Medium\"\n        },\n        {\n            \"type\": \"Container\",\n            \"items\": @{variables('adaptiveCardIPAddressItems')}\n        }\n    ],\n    \"actions\": [\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Submit\"\n        },\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Ignore\"\n        }\n    ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                            "recipient": {
                              "channelId": "[variables('blanks')]"
                            },
                            "shouldUpdateCard": true,
                            "updateMessage": "Thanks for your response, it is being processed."
                          },
                          "notificationUrl": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['teams']['connectionId']"
                          }
                        },
                        "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                        "queries": {
                          "groupId": "[variables('blanks')]"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "cisco-ASAv-connector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('CiscoASAConnectionName'))]",
                        "connectionName": "[[variables('CiscoASAConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('Cisco ASA Connector name'))]"
                      },
                      "teams": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[[variables('TeamsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]"
                      }
                    }
                  },
                  "Interface ID": {
                    "value": "[[parameters('Interface ID')]"
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "CiscoASA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_CiscoASAConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Cisco ASA - Create or Inbound Access Rule On Interface",
            "description": "This playbook allows blocking/unblocking of IPs in Cisco ASA, using **Access Rules** which will be created on an interface.",
            "prerequisites": [
              "1. **This playbook template is based on Microsoft Sentinel Incident Trigger which is currently in Private Preview (Automation Rules).** You can change the trigger to the Sentinel Alert trigger in cases you are not part of the Private Preview.",
              "2. Cisco ASA custom connector needs to be deployed prior to the deployment of this playbook, in the same resource group and region. Relevant instructions can be found in the connector doc page.",
              "3. Cisco ASA needs to have an extended Access Control List configured. Create a new ACL or retrieve the name of an existing ACL. To use Cisco ASDM to configure Extended ACLs, see [Configure Extended ACLs](https://www.cisco.com/c/en/us/td/docs/security/asa/asa914/asdm714/firewall/asdm-714-firewall-config/access-acls.html#ID-2069-0000016d)"
            ],
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, you will need to authorize each connection.",
              "1. Click the Microsoft Sentinel connection resource",
              "2.Click edit API connection",
              "3.Click Authorize",
              "4.Sign in",
              "5.Click Save",
              "6.Repeat steps for other connections such as Teams and Cisco ASA (For authorizing the Cisco ASA API connection, the username and password needs to be provided)",
              "**b. Select Teams channel**",
              "The Teams channel to which the adaptive card will be posted will need to be configured.",
              "1. Click the Azure Logic app resource",
              "2. Edit the Logic App",
              "3. Find the 'PostToTeams' action",
              "4. Select a Team and Channel",
              "5. Save the Logic App",
              "**c. Configurations in Sentinel**",
              "1. In Microsoft Sentinel analytical rules should be configured to trigger an incident with IP Entity.",
              "2. Configure the automation rules to trigger this playbook"
            ],
            "lastUpdateTime": "2021-07-28T00:00:00Z",
            "entities": [
              "Ip"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId4')]",
        "contentKind": "Playbook",
        "displayName": "CiscoASA-CreateInboundAccessRuleOnInterface",
        "contentProductId": "[variables('_playbookcontentProductId4')]",
        "id": "[variables('_playbookcontentProductId4')]",
        "version": "[variables('playbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoASA-ThreatDetectionMessage_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies when the Cisco ASA Threat Detection engine fired an alert based on malicious activity occurring on the network inicated by DeviceEventClassID 733101-733105\nResources: https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs9.html\nDetails on how to further troubleshoot/investigate: https://www.cisco.com/c/en/us/support/docs/security/asa-5500-x-series-next-generation-firewalls/113685-asa-threat-detection.html",
                "displayName": "Cisco ASA - threat detection message fired",
                "enabled": false,
                "query": "CommonSecurityLog\n| where isempty(CommunicationDirection)\n| where DeviceEventClassID in (\"733101\",\"733102\",\"733103\",\"733104\",\"733105\")\n| extend HostName = tostring(split(DeviceName, \".\")[0]), DomainIndex = toint(indexof(DeviceName, '.'))\n| extend HostNameDomain = iff(DomainIndex != -1, substring(DeviceName, DomainIndex + 1), DeviceName)\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CiscoASA",
                    "dataTypes": [
                      "CommonSecurityLog"
                    ]
                  }
                ],
                "tactics": [
                  "Discovery",
                  "Impact"
                ],
                "techniques": [
                  "T1046",
                  "T1498"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "DeviceName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SourceIP"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "CiscoASA Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "CiscoASA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco ASA - threat detection message fired",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CiscoASA-AvgAttackDetectRateIncrease_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will help you determine if Cisco ASA devices are under heavier attack than normal over the last hour versus the previous 6 hours based on DeviceEventClassID 733100\nReferences: https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs9.html\nDetails on how to further troubleshoot/investigate: https://www.cisco.com/c/en/us/support/docs/security/asa-5500-x-series-next-generation-firewalls/113685-asa-threat-detection.html",
                "displayName": "Cisco ASA - average attack detection rate increase",
                "enabled": false,
                "query": "let timeframe = 1h;\nlet last1h = CommonSecurityLog\n| where TimeGenerated >= ago(timeframe)\n| where isempty(CommunicationDirection)\n| where DeviceEventClassID == \"733100\"\n| extend SourceOfDropRateCount = tostring(split(tostring(split(Message, \"]\")[0]),\"[ \")[1])\n| extend splitMessage = split(Message, \".\")\n| extend DropRate = tostring(split(tostring(splitMessage[0]),\"] \")[1])\n| extend CurrentBurstRate = split(tostring(split(tostring(splitMessage[1]),\"  \")[0]),\"is \")\n| extend CurrentBurstRatePerSec = toint(split(tostring(CurrentBurstRate[1]),\" \")[0])\n| extend MaxConfiguredBurstRate = toint(CurrentBurstRate[2])\n| extend CurrentAvgRate = split(tostring(split(tostring(splitMessage[1]),\"  \")[1]),\"is \")\n| extend CurrentAvgRatePerSec = toint(split(tostring(CurrentAvgRate[1]),\" \")[0])\n| extend MaxConfiguredAvgRate = toint(CurrentAvgRate[2])\n| extend CumulativeTotal = toint(split(tostring(split(tostring(splitMessage[1]),\"  \")[2]),\"is \")[1])\n| summarize last1hCumTotal = sum(CumulativeTotal), last1hAvgRatePerSec = avg(CurrentAvgRatePerSec), last1hAvgBurstRatePerSec = avg(CurrentBurstRatePerSec) by DeviceName, DeviceEventClassID, SourceIP, SourceOfDropRateCount, DropRate;\nlet prev6h = CommonSecurityLog\n| where TimeGenerated between (ago(6h) .. ago(1h))\n| where isempty(CommunicationDirection)\n| where DeviceEventClassID == \"733100\"\n| extend SourceOfDropRateCount = tostring(split(tostring(split(Message, \"]\")[0]),\"[ \")[1])\n| extend splitMessage = split(Message, \".\")\n| extend DropRate = tostring(split(tostring(splitMessage[0]),\"] \")[1])\n| extend CurrentBurstRate = split(tostring(split(tostring(splitMessage[1]),\"  \")[0]),\"is \")\n| extend prevCurrentBurstRatePerSec = toint(split(tostring(CurrentBurstRate[1]),\" \")[0])\n| extend prevMaxConfiguredBurstRate = toint(CurrentBurstRate[2])\n| extend CurrentAvgRate = split(tostring(split(tostring(splitMessage[1]),\"  \")[1]),\"is \")\n| extend prevCurrentAvgRatePerSec = toint(split(tostring(CurrentAvgRate[1]),\" \")[0])\n| extend prevMaxConfiguredAvgRate = toint(CurrentAvgRate[2])\n| extend prevCumulativeTotal = toint(split(tostring(split(tostring(splitMessage[1]),\"  \")[2]),\"is \")[1])\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), prev6hCumTotal = sum(prevCumulativeTotal), prev6hAvgRatePerSec = avg(prevCurrentAvgRatePerSec), prev6hAvgBurstRatePerSec = avg(prevCurrentBurstRatePerSec)\nby DeviceName, DeviceEventClassID, SourceIP, SourceOfDropRateCount, DropRate;\nlast1h | join (\n  prev6h\n) on DeviceName, DeviceEventClassID, SourceIP, SourceOfDropRateCount, DropRate\n| project StartTimeUtc, EndTimeUtc, DeviceName, DeviceEventClassID, SourceIP, SourceOfDropRateCount, DropRate, last1hCumTotal, prev6hCumTotal, prev6hAvgCumTotal = prev6hCumTotal/6, last1hAvgRatePerSec, prev6hAvgRatePerSec, last1hAvgBurstRatePerSec, prev6hAvgBurstRatePerSec\n// Select only events that indicate a doubling of the expected rate in the last hour over the previous 6 hours\n| where last1hCumTotal > 2*prev6hAvgCumTotal or last1hAvgRatePerSec > 2*prev6hAvgRatePerSec or last1hAvgBurstRatePerSec > 2*prev6hAvgBurstRatePerSec\n| extend HostName = tostring(split(DeviceName, \".\")[0]), DomainIndex = toint(indexof(DeviceName, '.'))\n| extend HostNameDomain = iff(DomainIndex != -1, substring(DeviceName, DomainIndex + 1), DeviceName)\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT6H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CiscoASA",
                    "dataTypes": [
                      "CommonSecurityLog"
                    ]
                  }
                ],
                "tactics": [
                  "Discovery",
                  "Impact"
                ],
                "techniques": [
                  "T1046",
                  "T1498"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "DeviceName"
                      },
                      {
                        "identifier": "HostName",
                        "columnName": "HostName"
                      },
                      {
                        "identifier": "DnsDomain",
                        "columnName": "HostNameDomain"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SourceIP"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "CiscoASA Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "CiscoASA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cisco ASA - average attack detection rate increase",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.4",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "CiscoASA",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/CiscoASA/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.cisco.com/c/en_in/products/security/adaptive-security-appliance-asa-software/index.html\">Cisco ASA</a> solution for Microsoft Sentinel enables you to ingest <a href=\"https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/messages-listed-by-severity-level.html\">Cisco ASA logs</a> into Microsoft Sentinel. This solution includes two (2) data connectors to help ingest the logs.</p>\n<ol>\n<li><p><strong>Cisco ASA/FTD via AMA</strong> - This data connector helps in ingesting Cisco ASA logs into your Log Analytics Workspace using the new Azure Monitor Agent. Learn more about ingesting using the new Azure Monitor Agent <a href=\"https://learn.microsoft.com/azure/sentinel/connect-cef-ama\">here</a>. <strong>Microsoft recommends using this Data Connector</strong></p>\n</li>\n<li><p><strong>Cisco ASA via Legacy Agent</strong> - This data connector helps in ingesting Cisco ASA logs into your Log Analytics Workspace using the legacy Log Analytics agent.</p>\n</li>\n</ol>\n<P style=\"color:red\">**NOTE:** Microsoft recommends Installation of Cisco ASA/FTD via AMA Connector. Legacy connector uses the Log Analytics agent which is about to be deprecated by **Aug 31,2024** and thus should only be installed where AMA is not supported.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ol type=\"a\">\n<li><a href=\"https://docs.microsoft.com/azure/sentinel/connect-syslog\">Agent-based log collection (Syslog)</a></li>\n</ol>\n<p><strong>Data Connectors:</strong> 2, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 2, <strong>Custom Azure Logic Apps Connectors:</strong> 1, <strong>Playbooks:</strong> 3</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/cisco-logo-72px.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "CiscoASA",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId2')]",
              "version": "[variables('dataConnectorVersion2')]"
            },
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_CiscoASAConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_CiscoASA-AddIPtoNetworkObjectGroup')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_CiscoASA-CreateACEInACL')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_CiscoASA-CreateInboundAccessRuleOnInterface')]",
              "version": "[variables('playbookVersion4')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            }
          ]
        },
        "firstPublishDate": "2022-05-23",
        "providers": [
          "Cisco"
        ],
        "categories": {
          "domains": [
            "Security - Automation (SOAR)"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
