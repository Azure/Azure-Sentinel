{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Community",
    "comments": "Solution template for SOC Handbook"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Analytics Efficiency",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook2-name": {
      "type": "string",
      "defaultValue": "AnomaliesVisulization",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook3-name": {
      "type": "string",
      "defaultValue": "AnomalyData",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook4-name": {
      "type": "string",
      "defaultValue": "Attack Surface Reduction Dashboard",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook5-name": {
      "type": "string",
      "defaultValue": "Microsoft Sentinel Cost",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook6-name": {
      "type": "string",
      "defaultValue": "Security Alerts",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook7-name": {
      "type": "string",
      "defaultValue": "Incident overview",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook8-name": {
      "type": "string",
      "defaultValue": "IntSights IOC Workbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook9-name": {
      "type": "string",
      "defaultValue": "Investigation Insights",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook10-name": {
      "type": "string",
      "defaultValue": "MITRE ATT&CK Workbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook11-name": {
      "type": "string",
      "defaultValue": "Security Operations Efficiency",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook12-name": {
      "type": "string",
      "defaultValue": "Security Status",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook13-name": {
      "type": "string",
      "defaultValue": "Microsoft Sentinel Central",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "SOC Handbook",
    "_solutionVersion": "3.0.0",
    "solutionId": "microsoftsentinelcommunity.azure-sentinel-solution-sochandbook",
    "_solutionId": "[variables('solutionId')]",
    "workbookVersion1": "1.2.0",
    "workbookContentId1": "AnalyticsEfficiencyWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))),variables('workbookVersion1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "workbookVersion2": "1.0.0",
    "workbookContentId2": "AnomaliesVisualizationWorkbook",
    "workbookId2": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId2'))]",
    "workbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId2'))),variables('workbookVersion2')))]",
    "_workbookContentId2": "[variables('workbookContentId2')]",
    "_workbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId2'),'-', variables('workbookVersion2'))))]",
    "workbookVersion3": "1.0.0",
    "workbookContentId3": "AnomalyDataWorkbook",
    "workbookId3": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId3'))]",
    "workbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId3'))),variables('workbookVersion3')))]",
    "_workbookContentId3": "[variables('workbookContentId3')]",
    "_workbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId3'),'-', variables('workbookVersion3'))))]",
    "workbookVersion4": "1.0.0",
    "workbookContentId4": "AttackSurfaceReduction",
    "workbookId4": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId4'))]",
    "workbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId4'))),variables('workbookVersion4')))]",
    "_workbookContentId4": "[variables('workbookContentId4')]",
    "_workbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId4'),'-', variables('workbookVersion4'))))]",
    "workbookVersion5": "1.5.1",
    "workbookContentId5": "AzureSentinelCost",
    "workbookId5": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId5'))]",
    "workbookTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId5'))),variables('workbookVersion5')))]",
    "_workbookContentId5": "[variables('workbookContentId5')]",
    "_workbookcontentProductId5": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId5'),'-', variables('workbookVersion5'))))]",
    "workbookVersion6": "1.1.0",
    "workbookContentId6": "AzureSentinelSecurityAlertsWorkbook",
    "workbookId6": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId6'))]",
    "workbookTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId6'))),variables('workbookVersion6')))]",
    "_workbookContentId6": "[variables('workbookContentId6')]",
    "_workbookcontentProductId6": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId6'),'-', variables('workbookVersion6'))))]",
    "workbookVersion7": "2.1.0",
    "workbookContentId7": "IncidentOverview",
    "workbookId7": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId7'))]",
    "workbookTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId7'))),variables('workbookVersion7')))]",
    "_workbookContentId7": "[variables('workbookContentId7')]",
    "_workbookcontentProductId7": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId7'),'-', variables('workbookVersion7'))))]",
    "workbookVersion8": "2.0.0",
    "workbookContentId8": "IntsightsIOCWorkbook",
    "workbookId8": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId8'))]",
    "workbookTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId8'))),variables('workbookVersion8')))]",
    "_workbookContentId8": "[variables('workbookContentId8')]",
    "_workbookcontentProductId8": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId8'),'-', variables('workbookVersion8'))))]",
    "workbookVersion9": "1.4.0",
    "workbookContentId9": "InvestigationInsightsWorkbook",
    "workbookId9": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId9'))]",
    "workbookTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId9'))),variables('workbookVersion9')))]",
    "_workbookContentId9": "[variables('workbookContentId9')]",
    "_workbookcontentProductId9": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId9'),'-', variables('workbookVersion9'))))]",
    "workbookVersion10": "1.0.1",
    "workbookContentId10": "MITREATTACKWorkbook",
    "workbookId10": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId10'))]",
    "workbookTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId10'))),variables('workbookVersion10')))]",
    "_workbookContentId10": "[variables('workbookContentId10')]",
    "_workbookcontentProductId10": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId10'),'-', variables('workbookVersion10'))))]",
    "workbookVersion11": "1.5.0",
    "workbookContentId11": "SecurityOperationsEfficiency",
    "workbookId11": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId11'))]",
    "workbookTemplateSpecName11": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId11'))),variables('workbookVersion11')))]",
    "_workbookContentId11": "[variables('workbookContentId11')]",
    "_workbookcontentProductId11": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId11'),'-', variables('workbookVersion11'))))]",
    "workbookVersion12": "1.3.0",
    "workbookContentId12": "SecurityStatusWorkbook",
    "workbookId12": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId12'))]",
    "workbookTemplateSpecName12": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId12'))),variables('workbookVersion12')))]",
    "_workbookContentId12": "[variables('workbookContentId12')]",
    "_workbookcontentProductId12": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId12'),'-', variables('workbookVersion12'))))]",
    "workbookVersion13": "2.1.1",
    "workbookContentId13": "SentinelCentral",
    "workbookId13": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId13'))]",
    "workbookTemplateSpecName13": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId13'))),variables('workbookVersion13')))]",
    "_workbookContentId13": "[variables('workbookContentId13')]",
    "_workbookcontentProductId13": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId13'),'-', variables('workbookVersion13'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AnalyticsEfficiencyWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Gain insights into the efficacy of your analytics rules. In this workbook you can analyze and monitor the analytics rules found in your workspace to achieve better performance by your SOC."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Analytics Efficiency (Preview)\"},\"customWidth\":\"35\",\"name\":\"Page header\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"26d2fea7-3646-4993-b79f-6722f9ef8ddb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DefaultSubscription_Internal\",\"type\":1,\"isRequired\":true,\"query\":\"where type =~ 'microsoft.operationalinsights/workspaces'\\n| take 1\\n| project subscriptionId\",\"isHiddenWhenLocked\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"109f8d4a-05e3-4d1b-adac-087873d109a6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"InternalWSs\",\"type\":1,\"isRequired\":true,\"query\":\"SecurityIncident\\n| take 1\\n| parse IncidentUrl with * \\\"/workspaces/\\\" Workspace \\\"/\\\" *\\n| project Workspace\",\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"55d3ab63-6e1f-4d02-8d9e-2225526689c7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"query\":\"summarize by subscriptionId\\n| project value = strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\",\"crossComponentResources\":[\"value::all\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"95a45501-31b5-4ea2-bcb3-eb208e0080e2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"query\":\"where type =~ \\\"microsoft.operationalinsights/workspaces\\\"\\r\\n| project subscriptionId,id,name\\r\\n| where '{Subscription}' has subscriptionId\\r\\n| project value =id, label = name, selected = iff(name =~ '{InternalWSs}', true, false)\",\"crossComponentResources\":[\"value::all\"],\"typeSettings\":{\"showDefault\":false},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"7d597ad7-4a2a-45ed-a4fe-7ee32de0fc22\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000}],\"allowCustom\":true}},{\"id\":\"9a199167-2dde-49dd-8f01-23e9d1fa8151\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"InternalRG\",\"type\":1,\"isRequired\":true,\"query\":\"where type =~ \\\"microsoft.operationalinsights/workspaces\\\"\\r\\n| where id =~  \\\"{Workspace}\\\"\\r\\n| project resourceGroup\",\"crossComponentResources\":[\"{Workspace}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"c4470c37-5a8a-4ecd-8ece-5e98db8e8a92\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"label\":\"Show Help\",\"type\":10,\"description\":\"This will show some help information to help you understand the page you are on\",\"isRequired\":true,\"typeSettings\":{\"jsonData\":\"[{ \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true }]\"}],\"style\":\"pills\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"customWidth\":\"100\",\"name\":\"WSSelector\"},{\"type\":1,\"content\":{\"json\":\"### Help\\r\\nSelect **Subscription**, **Workspace**, and **Time Range** from the drop-downs above.\\r\\nThe workbook will display analytics rules according to your selections.\\r\\n\\r\\nThe **Time range** filter refers to the time the rule was last modified, and applies to all components.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Help text\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"18c690d7-7cbd-46c1-b677-1f72692d40cd\",\"cellValue\":\"TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Alert Rules\",\"subTarget\":\"Rule\",\"preText\":\"Alert rules\",\"style\":\"link\"},{\"id\":\"94d4ab9a-4ec7-4e4b-a69d-b6acb5cccd62\",\"cellValue\":\"TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Alerts\",\"subTarget\":\"Alert\",\"style\":\"link\"},{\"id\":\"19b985d3-9819-4d97-aeec-dfc558977b39\",\"cellValue\":\"TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Incidents\",\"subTarget\":\"Incident\",\"style\":\"link\"}]},\"name\":\"Tabs link\"},{\"type\":1,\"content\":{\"json\":\"### Analytics rules\\r\\nThis table displays all the analytics rules in the chosen subscription, workspace, and time range. Select rules to analyze based on the selected tab. \"},\"name\":\"Heading-workbook\"},{\"type\":1,\"content\":{\"json\":\"### Help\\r\\nSelect rules from the table for analysis.\\r\\nThe workbook is updated dynamically as rules are selected or deselected.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Rules selection help text\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{Subscription:id}/resourceGroups/{InternalRG}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/alertRules\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2020-01-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"$.properties.displayName\\\",\\\"columnid\\\":\\\"RuleName\\\"},{\\\"path\\\":\\\"$.properties.description\\\",\\\"columnid\\\":\\\"Description\\\"},{\\\"path\\\":\\\"$.name\\\",\\\"columnid\\\":\\\"AlertRuleID\\\"},{\\\"path\\\":\\\"$.kind\\\",\\\"columnid\\\":\\\"Kind\\\"},{\\\"path\\\":\\\"$.properties.productFilter\\\",\\\"columnid\\\":\\\"ProductName\\\"},{\\\"path\\\":\\\"$.properties.tactics\\\",\\\"columnid\\\":\\\"Tactics\\\"},{\\\"path\\\":\\\"$.properties.enabled\\\",\\\"columnid\\\":\\\"Status\\\"},{\\\"path\\\":\\\"$.properties\\\",\\\"columnid\\\":\\\"prop\\\"},{\\\"path\\\":\\\"$.properties.lastModifiedUtc\\\",\\\"columnid\\\":\\\"lastModifiedUtc\\\"}]}}]}\",\"size\":0,\"noDataMessage\":\"No analytic rules are defined \",\"exportMultipleValues\":true,\"exportedParameters\":[{\"fieldName\":\"AlertRuleID\",\"parameterName\":\"AlertRuleID\",\"parameterType\":1},{\"fieldName\":\"ProductName\",\"parameterName\":\"ProductName\",\"parameterType\":1},{\"fieldName\":\"Tactics\",\"parameterName\":\"Tactics\",\"parameterType\":1},{\"fieldName\":\"RuleName\",\"parameterName\":\"RuleName\",\"parameterType\":1},{\"fieldName\":\"Status\",\"parameterName\":\"Status\",\"parameterType\":1},{\"fieldName\":\"prop\",\"parameterName\":\"prop\",\"parameterType\":1,\"delimiter\":\",\",\"quote\":\"\"}],\"exportToExcelOptions\":\"all\",\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Kind\",\"formatter\":1},{\"columnMatch\":\"ProductName\",\"formatter\":5},{\"columnMatch\":\"Tactics\",\"formatter\":5,\"formatOptions\":{\"customColumnWidthSetting\":\"0ch\"}},{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"1\",\"representation\":\"success\",\"text\":\"enabled\"},{\"operator\":\"==\",\"thresholdValue\":\"0\",\"representation\":\"disabled\",\"text\":\"disabled\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"disabled\",\"text\":\"disabled\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"success\",\"text\":\"enabled\"}]}},{\"columnMatch\":\"prop\",\"formatter\":5},{\"columnMatch\":\"enabled\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":1,\"palette\":\"redGreen\",\"compositeBarSettings\":{\"labelText\":\"\",\"columnSettings\":[{\"columnName\":\"enabled\",\"color\":\"green\"}]}}}],\"rowLimit\":512,\"filter\":true,\"sortBy\":[{\"itemKey\":\"lastModifiedUtc\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"RuleName\",\"label\":\"Rule name\"},{\"columnId\":\"Description\"},{\"columnId\":\"AlertRuleID\",\"label\":\"Alert rule ID\"},{\"columnId\":\"Kind\",\"label\":\"Rule type\"},{\"columnId\":\"ProductName\",\"label\":\"Product name\"},{\"columnId\":\"Tactics\"},{\"columnId\":\"Status\"},{\"columnId\":\"prop\"}]},\"sortBy\":[{\"itemKey\":\"lastModifiedUtc\",\"sortOrder\":2}],\"graphSettings\":{\"type\":0},\"mapSettings\":{\"locInfo\":\"LatLong\"}},\"name\":\"Analytic rules\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Total number of incidents \\nSum of all the incidents generated by all the selected rules over the selected time range\"},\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Incindets sum text\"},{\"type\":1,\"content\":{\"json\":\"### Help\\r\\nThe **Total number of incidents** chart shows the total count of the incidents generated by the selected rules over the selected time range.\\r\\nYou can use this chart to monitor the incidents load on the SOC.\\r\\n\\r\\n\",\"style\":\"info\"},\"conditionalVisibilities\":[{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Incindets sum text help\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\nlet isProductMarked = (product:string) {\\r\\n    let productText = strcat_array(dynamic([{ProductName}]),\\\",\\\");\\r\\n    array_index_of(split(productText,'\\\\\\\"'),product)\\r\\n};\\r\\nlet SecurityAlertFiltered= SecurityAlert\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| project ProductName,ExtendedProperties,SystemAlertId\\r\\n| extend AnalyticRuleIdStr = replace('\\\\\\\"','',tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| extend AnaliticRulesInAlertArray= split(substring(AnalyticRuleIdStr,1,string_size(AnalyticRuleIdStr)-2),\\\",\\\")\\r\\n| mv-expand SingleAnaliticRuleID=AnaliticRulesInAlertArray\\r\\n| extend SingleAnaliticRuleID=tostring(SingleAnaliticRuleID)\\r\\n| extend SingleAnaliticRuleID=iff(ProductName==\\\"Azure Sentinel\\\",tostring(SingleAnaliticRuleID),ProductName)\\r\\n| where alertText has SingleAnaliticRuleID or isProductMarked(SingleAnaliticRuleID)!=-1;\\r\\nlet SecurityIncedentFiltered = SecurityIncident\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| project AlertIds,TimeGenerated\\r\\n| mv-expand AnalyticAlertId=AlertIds\\r\\n| extend AnalyticAlertId=tostring(AnalyticAlertId);\\r\\nSecurityAlertFiltered\\r\\n| join SecurityIncedentFiltered on $left.SystemAlertId==$right.AnalyticAlertId\\r\\n| project TimeGenerated,SingleAnaliticRuleID\\r\\n| summarize incedentAmount=count() by bin(TimeGenerated,1h)\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\"},\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Total amount of Incidents \"},{\"type\":1,\"content\":{\"json\":\"## Number of incidents, by rule\\nCount of the incidents generated by each of the selected rules over time\"},\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Total amount of Incidents text\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let getRuleNameIdTable = (){\\r\\n    let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\n    let RuleName =  strcat_array(dynamic([{RuleName}]),\\\",\\\");\\r\\n    let rulesData = range x from 0 to array_length(split(alertText,','))-1 step 1\\r\\n    | extend AlertRuleId= tostring(split(alertText,',')[x]),\\r\\n    RuleName=tostring(split(RuleName,',')[x]);\\r\\n    rulesData\\r\\n};\\r\\nlet GetAlertRuleTable = (){\\r\\n    let proerties = dynamic([{prop}]);\\r\\n    let TmpRuleTable = datatable (MockColumn:string)[\\\"Mock\\\"];\\r\\n    TmpRuleTable\\r\\n    | mv-expand SingleRuleProperties=proerties\\r\\n    | project-away MockColumn\\r\\n    | extend \\r\\n    Product=iff(SingleRuleProperties.productFilter!='',SingleRuleProperties.productFilter,\\\"Azure Sentinel\\\"), \\r\\n    RuleName=tostring(SingleRuleProperties.displayName), \\r\\n    MITRE_Tactics=iff(SingleRuleProperties.tactics!='',SingleRuleProperties.tactics,dynamic([])),\\r\\n    Description=SingleRuleProperties.description\\r\\n    | extend Status= iff(SingleRuleProperties.enabled==true,'Enabled',iff(RuleName startswith 'AUTO DISABLED','Auto disabled', 'Disabled'))\\r\\n    | project-away SingleRuleProperties\\r\\n    | join getRuleNameIdTable() on $left.RuleName==$right.RuleName\\r\\n    | project-away RuleName1,x\\r\\n};\\r\\nlet AlertAmount = materialize( SecurityAlert\\r\\n| project ExtendedProperties,ProductName, ProviderName,TimeGenerated\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| extend AnalyticRuleIdStr = replace('\\\\\\\"','',tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| extend AnaliticRulesInAlertArray= split(substring(AnalyticRuleIdStr,1,string_size(AnalyticRuleIdStr)-2),\\\",\\\")\\r\\n| mv-expand SingleAnaliticRuleID=AnaliticRulesInAlertArray\\r\\n| extend SingleAnaliticRuleID=iff(ProductName==\\\"Azure Sentinel\\\",tostring(SingleAnaliticRuleID),ProductName)\\r\\n| summarize AlertAmount=count() by SingleAnaliticRuleID\\r\\n| extend AlertAmount=iff(AlertAmount>0,AlertAmount,0));\\r\\nlet AlertRulesTable =GetAlertRuleTable();\\r\\nlet alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\nlet isProductMarked = (product:string) {\\r\\n    let productText = strcat_array(dynamic([{ProductName}]),\\\",\\\");\\r\\n    array_index_of(split(productText,'\\\\\\\"'),product)\\r\\n};\\r\\nlet SecurityAlertFiltered= SecurityAlert\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| project ProductName,ExtendedProperties,SystemAlertId\\r\\n| extend AnalyticRuleIdStr = replace('\\\\\\\"','',tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| extend AnaliticRulesInAlertArray= split(substring(AnalyticRuleIdStr,1,string_size(AnalyticRuleIdStr)-2),\\\",\\\")\\r\\n| mv-expand SingleAnaliticRuleID=AnaliticRulesInAlertArray\\r\\n| extend SingleAnaliticRuleID=tostring(SingleAnaliticRuleID)\\r\\n| extend SingleAnaliticRuleID=iff(ProductName==\\\"Azure Sentinel\\\",tostring(SingleAnaliticRuleID),ProductName)\\r\\n| where alertText has SingleAnaliticRuleID or isProductMarked(SingleAnaliticRuleID)!=-1;\\r\\nlet SecurityIncedentFiltered = SecurityIncident\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| project AlertIds,TimeGenerated\\r\\n| mv-expand AnalyticAlertId=AlertIds\\r\\n| extend AnalyticAlertId=tostring(AnalyticAlertId);\\r\\nSecurityAlertFiltered\\r\\n| join SecurityIncedentFiltered on $left.SystemAlertId==$right.AnalyticAlertId\\r\\n| project TimeGenerated,SingleAnaliticRuleID\\r\\n| join kind=leftouter AlertRulesTable on $left.SingleAnaliticRuleID==$right.AlertRuleId\\r\\n| summarize incedentAmount=count() by bin(TimeGenerated,1h),SingleAnaliticRuleID,RuleName\\r\\n| where RuleName !=\\\"\\\"\\r\\n|project incedentAmount,TimeGenerated,RuleName\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"xAxis\":\"TimeGenerated\",\"yAxis\":[\"incedentAmount\"],\"showMetrics\":false,\"showLegend\":true}},\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Incidents created by rules\"},{\"type\":1,\"content\":{\"json\":\"## Amount of incidents by rule \\nFor each of the selected rules the total incidents number genereted on the selected time period by closing status \"},\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Total amount of Incidents help text\"},{\"type\":1,\"content\":{\"json\":\"### Help\\r\\nHere you can see the amount of incidents created from each rule you selected.\\r\\nIn addition you can see the distribution of closing reasons for each of the selected rules. \\r\\nMonitoring the amount of incidents each detection is creating is essential for the SOC.\\r\\n\",\"style\":\"info\"},\"conditionalVisibilities\":[{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Incident by rules text \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\nlet isProductMarked = (product:string) {\\r\\n    let productText = strcat_array(dynamic([{ProductName}]),\\\",\\\");\\r\\n    array_index_of(split(productText,','),product)\\r\\n};\\r\\nlet getAmountOfIncedentForRuleId = (classification:string,status:string){\\r\\nSecurityIncident\\r\\n    | project TimeGenerated, Status, Classification, RelatedAnalyticRuleIds, AdditionalData\\r\\n    | where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n    | where Status == status and Classification == classification\\r\\n    | mv-expand RuleId=RelatedAnalyticRuleIds\\r\\n    | extend RuleId=tostring(RuleId)\\r\\n    | extend AlertProductNames = todynamic(AdditionalData)[\\\"alertProductNames\\\"]\\r\\n    | mv-expand AlertProductName =AlertProductNames\\r\\n    | extend  AlertProductName=tostring(AlertProductName)\\r\\n    | project AlertProductName,RuleId\\r\\n    | where  isProductMarked(AlertProductName)!=-1 or alertText has RuleId\\r\\n    | extend RuleId=iff(AlertProductName!= 'Azure Sentinel', AlertProductName, RuleId)\\r\\n    | summarize counter=count() by RuleId\\r\\n};\\r\\n\\r\\nlet falsePositiveClassificationTable = getAmountOfIncedentForRuleId(\\\"FalsePositive\\\",\\\"Closed\\\") | extend FalsePositiveCounter=counter | project-away counter;\\r\\nlet undeterminedClassificationTable = getAmountOfIncedentForRuleId(\\\"Undetermined\\\",\\\"Closed\\\") | extend UndeterminedCounter=counter | project-away counter;\\r\\nlet benignPositiveClassificationTable = getAmountOfIncedentForRuleId(\\\"BenignPositive\\\",\\\"Closed\\\") | extend BenignPositiveCounter=counter | project-away counter;\\r\\nlet truePositiveClassificationTable = getAmountOfIncedentForRuleId(\\\"TruePositive\\\",\\\"Closed\\\") | extend TruePositiveCounter=counter | project-away counter;\\r\\nlet activeIncedentTable = getAmountOfIncedentForRuleId(\\\"\\\",\\\"Active\\\") | extend ActiveIncedentsCounter=counter | project-away counter;    \\r\\nlet newIncedentTable = getAmountOfIncedentForRuleId(\\\"\\\",\\\"New\\\") | extend NewIncedentsCounter=counter | project-away counter;\\r\\nlet joinByRuleId = (T:(RuleId:string), S:(RuleId:string)){\\r\\n    T \\r\\n    | join kind=fullouter S on $left.RuleId == $right.RuleId\\r\\n    | extend RuleId= iff(RuleId == '', RuleId1,RuleId)\\r\\n    | project-away RuleId1\\r\\n};\\r\\njoinByRuleId(joinByRuleId(joinByRuleId(joinByRuleId(joinByRuleId(falsePositiveClassificationTable, undeterminedClassificationTable) , benignPositiveClassificationTable), truePositiveClassificationTable),activeIncedentTable), newIncedentTable)\\r\\n// Adding the Rule name to the table(we want to display name and not ID) \\r\\n| join kind=leftouter  \\r\\n(SecurityAlert | project TimeGenerated, ProductName, ExtendedProperties\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| where ProductName  ==  'Azure Sentinel'\\r\\n| extend RuleId = parsejson( tostring(todynamic(ExtendedProperties)['Analytic Rule Ids']))\\r\\n| mv-expand RuleId=RuleId\\r\\n| extend RuleId=tostring(RuleId)\\r\\n| extend RuleName=  tostring(todynamic(ExtendedProperties)['Analytic Rule Name'])\\r\\n| project RuleId,RuleName\\r\\n| distinct RuleId,RuleName)\\r\\n on $left.RuleId==$right.RuleId\\r\\n| extend RuleName=iff(isempty(RuleName),RuleId,RuleName)\\r\\n| project-away RuleId1\\r\\n| where alertText has RuleId or isProductMarked(RuleName)!=-1  \\r\\n| project-away RuleId\\r\\n| extend TotalAlerts= iff(isempty(FalsePositiveCounter),0,FalsePositiveCounter) + \\r\\niff(isempty(UndeterminedCounter),0,UndeterminedCounter)+ \\r\\niff(isempty(BenignPositiveCounter),0,BenignPositiveCounter)+\\r\\niff(isempty(TruePositiveCounter),0,TruePositiveCounter) +\\r\\niff(isempty(ActiveIncedentsCounter),0,ActiveIncedentsCounter) +\\r\\niff(isempty(NewIncedentsCounter),0,NewIncedentsCounter)\\r\\n| where TotalAlerts>0\\r\\n| sort by TotalAlerts desc \\r\\n| project-away TotalAlerts \\r\\n\",\"size\":0,\"noDataMessage\":\"No incedents created\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"chartSettings\":{\"xAxis\":\"RuleName\"}},\"conditionalVisibility\":{\"parameterName\":\"AlertRuleID\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Incident closing reasons\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\nlet isProductMarked = (product:string) {\\r\\n    let productText = strcat_array(dynamic([{ProductName}]),\\\",\\\");\\r\\n    array_index_of(split(productText,','),product)\\r\\n};\\r\\nSecurityIncident\\r\\n| project TimeGenerated, RelatedAnalyticRuleIds, AdditionalData\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| mv-expand AlertRuleId=RelatedAnalyticRuleIds\\r\\n| extend AlertRuleId=tostring(AlertRuleId)\\r\\n| extend AlertProductNames = todynamic(AdditionalData)[\\\"alertProductNames\\\"]\\r\\n| mv-expand AlertProductName =AlertProductNames\\r\\n| extend  AlertProductName=tostring(AlertProductName)\\r\\n| project AlertProductName,AlertRuleId\\r\\n| where  isProductMarked(AlertProductName)!=-1 or alertText has AlertRuleId\\r\\n| summarize count() by AlertProductName\",\"size\":2,\"title\":\"Incident created by rules\",\"noDataMessage\":\"No incedents created\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"38\",\"conditionalVisibility\":{\"parameterName\":\"AlertRuleID\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Incident closing reson query\"}]},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"},\"name\":\"IncidentRelatedGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Rules analysis \\nThe following metrics apply to the selected rules in the table.\"},\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"analysys for rules text \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let getSecurityAlertRulesTable = (){\\r\\n    let getRuleNameIdTable = (){\\r\\n        let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\n        let RuleName =  strcat_array(dynamic([{RuleName}]),\\\",\\\");\\r\\n        let rulesData = range x from 0 to array_length(split(alertText,','))-1 step 1\\r\\n        | extend AlertRuleId= tostring(split(alertText,',')[x]),\\r\\n        RuleName=tostring(split(RuleName,',')[x]);\\r\\n        rulesData\\r\\n    };\\r\\n    let GetAlertRuleTable = (){\\r\\n        let proerties = dynamic([{prop}]);\\r\\n        let TmpRuleTable = datatable (MockColumn:string)[\\\"Mock\\\"];\\r\\n        TmpRuleTable\\r\\n        | mv-expand SingleRuleProperties=proerties\\r\\n        | project-away MockColumn\\r\\n        | extend \\r\\n        Product=iff(SingleRuleProperties.productFilter!='',SingleRuleProperties.productFilter,\\\"Azure Sentinel\\\"), \\r\\n        RuleName=tostring(SingleRuleProperties.displayName), \\r\\n        MITRE_Tactics=iff(SingleRuleProperties.tactics!='',SingleRuleProperties.tactics,dynamic([])),\\r\\n        Description=SingleRuleProperties.description\\r\\n        | extend Status= iff(SingleRuleProperties.enabled==true,'Enabled',iff(RuleName startswith 'AUTO DISABLED','Auto disabled', 'Disabled'))\\r\\n        | project-away SingleRuleProperties\\r\\n        | join getRuleNameIdTable() on $left.RuleName==$right.RuleName\\r\\n        | project-away RuleName1,x\\r\\n    };\\r\\n    let AlertAmount = materialize( SecurityAlert\\r\\n    | project ExtendedProperties,ProductName, ProviderName,TimeGenerated\\r\\n    | where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n    | extend AnalyticRuleIdStr = replace('\\\\\\\"','',tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n    | extend AnaliticRulesInAlertArray= split(substring(AnalyticRuleIdStr,1,string_size(AnalyticRuleIdStr)-2),\\\",\\\")\\r\\n    | mv-expand SingleAnaliticRuleID=AnaliticRulesInAlertArray\\r\\n    | extend SingleAnaliticRuleID=iff(ProductName==\\\"Azure Sentinel\\\",tostring(SingleAnaliticRuleID),ProductName)\\r\\n    | summarize AlertAmount=count() by SingleAnaliticRuleID\\r\\n    | extend AlertAmount=iff(AlertAmount>0,AlertAmount,0));\\r\\n    GetAlertRuleTable()\\r\\n    | join kind=leftouter AlertAmount on $left.AlertRuleId==$right.SingleAnaliticRuleID \\r\\n    | project-away SingleAnaliticRuleID\\r\\n    | extend AlertAmount=iff(AlertAmount>0 or Product!= 'Azure Sentinel',AlertAmount,0)\\r\\n    | join kind=leftouter AlertAmount on $left.Product==$right.SingleAnaliticRuleID\\r\\n    | extend AlertAmount=iff(Product!= 'Azure Sentinel',AlertAmount1,AlertAmount)\\r\\n    | project-away AlertAmount1\\r\\n    | sort by AlertAmount desc\\r\\n    \\r\\n    };\\r\\ngetSecurityAlertRulesTable()\\r\\n| summarize count() by Product\\r\\n\",\"size\":2,\"title\":\"Selected rules by provider\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"40\",\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"analysys for rules query\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"#### Selected rules by MITRE ATT&CK tactics coverage\\nThis chart shows each rule's MITRE ATT&CK tactics, as configured at the rule's creation.\\n\\nWe aspire to have full coverage. For more complete MITRE ATT&CK coverage, use Azure Sentinel templates.\"},\"name\":\"text - 5\"},{\"type\":1,\"content\":{\"json\":\"### Help\\r\\nThe **Selected rules by MITRE ATT&CK tactics coverage** chart displays the MITRE ATT&CK tactics coverage of the selected rules.\\r\\n\\r\\nWhen creating **scheduled alert rules**, you are able to specify the MITRE ATT&CK tactics associated with each rule. These specified tactics are used to populate this chart.\\r\\n\\r\\nThis tactic specification is available only with **scheduled alert** rules, not with other types of analytics rules.\\r\\n\",\"style\":\"info\"},\"conditionalVisibilities\":[{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"MITRE attack coverage text \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let MITRE_DEF_TABLE = datatable(Tactic:string)[\\\"InitialAccess\\\",\\\"Execution\\\",\\\"Persistence\\\",\\\"PrivilegeEscalation\\\", \\\"DefenseEvasion\\\",\\\"CredentialAccess\\\",\\\"Discovery\\\", \\\"LateralMovement\\\",\\\"Collection\\\",\\\"Exfiltration\\\",\\\"CommandAndControl\\\",\\\"Impact\\\"];\\r\\nlet getRuleNameIdTable = (){\\r\\n    let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\n    let RuleName =  strcat_array(dynamic([{RuleName}]),\\\",\\\");\\r\\n    let rulesData = range x from 0 to array_length(split(alertText,','))-1 step 1\\r\\n    | extend AlertRuleId= tostring(split(alertText,',')[x]),\\r\\n    RuleName=tostring(split(RuleName,',')[x]);\\r\\n    rulesData\\r\\n};\\r\\nlet GetAlertRuleTable = (){\\r\\n    let proerties = dynamic([{prop}]);\\r\\n    let TmpRuleTable = datatable (MockColumn:string)[\\\"Mock\\\"];\\r\\n    TmpRuleTable\\r\\n    | mv-expand SingleRuleProperties=proerties\\r\\n    | project-away MockColumn\\r\\n    | extend \\r\\n    Product=iff(SingleRuleProperties.productFilter!='',SingleRuleProperties.productFilter,\\\"Azure Sentinel\\\"), \\r\\n    RuleName=tostring(SingleRuleProperties.displayName), \\r\\n    MITRE_Tactics=iff(SingleRuleProperties.tactics!='',SingleRuleProperties.tactics,dynamic([])),\\r\\n    Description=SingleRuleProperties.description\\r\\n    | extend Status= iff(SingleRuleProperties.enabled==true,'Enabled',iff(RuleName startswith 'AUTO DISABLED','Auto disabled', 'disabled'))\\r\\n    | project-away SingleRuleProperties\\r\\n    | join getRuleNameIdTable() on $left.RuleName==$right.RuleName\\r\\n    | project-away RuleName1\\r\\n};\\r\\nMITRE_DEF_TABLE\\r\\n| join kind=leftouter (GetAlertRuleTable()\\r\\n| project MITRE_Tactics\\r\\n| mv-expand MITRE_Tactics\\r\\n| extend MITRE_Tactics = tostring(MITRE_Tactics)\\r\\n| summarize RuleAmount=count() by MITRE_Tactics) on $left.Tactic==$right.MITRE_Tactics\\r\\n| extend RuleAmount=iff(RuleAmount>0,RuleAmount,0)\\r\\n| project Tactic,RuleAmount\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"DefenseEvasion\",\"label\":\"Defense evasion\"},{\"seriesName\":\"CommandAndControl\",\"label\":\"Command and control\"},{\"seriesName\":\"InitialAccess\",\"label\":\"Initial access\"},{\"seriesName\":\"LateralMovement\",\"label\":\"Lateral movement\"},{\"seriesName\":\"PrivilegeEscalation\",\"label\":\"Privilege escalation\"},{\"seriesName\":\"CredentialAccess\",\"label\":\"Credential access\"}]}},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"MITRE attack coverage query\"}]},\"customWidth\":\"60\",\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"MITRE group\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let getRuleNameIdTable = (){\\r\\n    let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\n    let RuleName =  strcat_array(dynamic([{RuleName}]),\\\",\\\");\\r\\n    let rulesData = range x from 0 to array_length(split(alertText,','))-1 step 1\\r\\n    | extend AlertRuleId= tostring(split(alertText,',')[x]),\\r\\n    RuleName=tostring(split(RuleName,',')[x]);\\r\\n    rulesData\\r\\n};\\r\\nlet GetAlertRuleTable = (){\\r\\n    let proerties = dynamic([{prop}]);\\r\\n    let TmpRuleTable = datatable (MockColumn:string)[\\\"Mock\\\"];\\r\\n    TmpRuleTable\\r\\n    | mv-expand SingleRuleProperties=proerties\\r\\n    | project-away MockColumn\\r\\n    | extend \\r\\n    Product=iff(SingleRuleProperties.productFilter!='',SingleRuleProperties.productFilter,\\\"Azure Sentinel\\\"), \\r\\n    RuleName=tostring(SingleRuleProperties.displayName), \\r\\n    MITRE_Tactics=iff(SingleRuleProperties.tactics!='',SingleRuleProperties.tactics,dynamic([])),\\r\\n    Description=SingleRuleProperties.description\\r\\n    | extend Status= iff(SingleRuleProperties.enabled==true,'Enabled',iff(RuleName startswith 'AUTO DISABLED','Auto disabled', 'Disabled'))\\r\\n    | project-away SingleRuleProperties\\r\\n    | join getRuleNameIdTable() on $left.RuleName==$right.RuleName\\r\\n    | project-away RuleName1\\r\\n};\\r\\n let StatusTable = datatable (Status:string)[\\\"Enabled\\\",\\\"Disabled\\\",\\\"Auto Disabled\\\"];\\r\\nGetAlertRuleTable()\\r\\n| project Status\\r\\n| summarize AmountOfRules=count() by Status\\r\\n| join kind=fullouter StatusTable on $left.Status==$right.Status\\r\\n| extend Status=Status1\\r\\n| project Status,AmountOfRules\\r\\n| extend AmountOfRules=iff(AmountOfRules>0,AmountOfRules,0)\\r\\n\",\"size\":2,\"title\":\"Selected rules by status\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Status\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AmountOfRules\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Enabled\",\"color\":\"greenDark\"},{\"seriesName\":\"Disabled\",\"color\":\"red\"},{\"seriesName\":\"Auto Disabled\",\"color\":\"yellow\"}]}},\"customWidth\":\"40\",\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"rules status query\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"#### Rules that require attention\\nThis chart displays the selected rules that require attention, either because they didn't create alerts during the selected period, or because they were auto-disabled.\\n\\nAzure Sentinel will automatically disable rules that violate the scheduled alert rules guidelines.\"},\"name\":\"text - 1\"},{\"type\":1,\"content\":{\"json\":\"### Help\\r\\nThis chart displays rules that require attention.\\r\\nThese include rules that didn't create alerts during the selected time range, and auto-disabled rules. \\r\\nRules that are not triggered might have problems, which may result in overestimation of the detection coverage.\\r\\nAzure Sentinel will automatically disable rules that violate the scheduled alert rules guidelines.\\r\\n[Learn more](https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom) about scheduled alerts in Azure Sentinel.\",\"style\":\"info\"},\"conditionalVisibilities\":[{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"text - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let getRuleNameIdTable = (){\\r\\n    let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\n    let RuleName =  strcat_array(dynamic([{RuleName}]),\\\",\\\");\\r\\n    let rulesData = range x from 0 to array_length(split(alertText,','))-1 step 1\\r\\n    | extend AlertRuleId= tostring(split(alertText,',')[x]),\\r\\n    RuleName=tostring(split(RuleName,',')[x]);\\r\\n    rulesData\\r\\n};\\r\\nlet GetAlertRuleTable = (){\\r\\n    let proerties = dynamic([{prop}]);\\r\\n    let TmpRuleTable = datatable (MockColumn:string)[\\\"Mock\\\"];\\r\\n    TmpRuleTable\\r\\n    | mv-expand SingleRuleProperties=proerties\\r\\n    | project-away MockColumn\\r\\n    | extend \\r\\n    Product=iff(SingleRuleProperties.productFilter!='',SingleRuleProperties.productFilter,\\\"Azure Sentinel\\\"), \\r\\n    RuleName=tostring(SingleRuleProperties.displayName), \\r\\n    MITRE_Tactics=iff(SingleRuleProperties.tactics!='',SingleRuleProperties.tactics,dynamic([])),\\r\\n    Description=SingleRuleProperties.description\\r\\n    | extend Status= iff(SingleRuleProperties.enabled==true,'Enabled',iff(RuleName startswith 'AUTO DISABLED','Auto disabled', 'Disabled'))\\r\\n    | project-away SingleRuleProperties\\r\\n    | join getRuleNameIdTable() on $left.RuleName==$right.RuleName\\r\\n    | project-away RuleName1,x\\r\\n};\\r\\nlet AlertAmount = materialize( SecurityAlert\\r\\n| project ExtendedProperties,ProductName, ProviderName,TimeGenerated\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| extend AnalyticRuleIdStr = replace('\\\\\\\"','',tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| extend AnaliticRulesInAlertArray= split(substring(AnalyticRuleIdStr,1,string_size(AnalyticRuleIdStr)-2),\\\",\\\")\\r\\n| mv-expand SingleAnaliticRuleID=AnaliticRulesInAlertArray\\r\\n| extend SingleAnaliticRuleID=iff(ProductName==\\\"Azure Sentinel\\\",tostring(SingleAnaliticRuleID),ProductName)\\r\\n| summarize AlertAmount=count() by SingleAnaliticRuleID\\r\\n| extend AlertAmount=iff(AlertAmount>0,AlertAmount,0));\\r\\nGetAlertRuleTable()\\r\\n| join kind=leftouter AlertAmount on $left.AlertRuleId==$right.SingleAnaliticRuleID \\r\\n| project-away SingleAnaliticRuleID\\r\\n| extend AlertAmount=iff(AlertAmount>0 or Product!= 'Azure Sentinel',AlertAmount,0)\\r\\n| join kind=leftouter AlertAmount on $left.Product==$right.SingleAnaliticRuleID\\r\\n| extend AlertAmount=iff(Product!= 'Azure Sentinel',AlertAmount1,AlertAmount)\\r\\n| extend AlertAmount=iff(AlertAmount>0,AlertAmount,0)\\r\\n| project-away AlertAmount1\\r\\n| sort by AlertAmount desc\\r\\n| project Status,Product,RuleName,AlertAmount\\r\\n| where AlertAmount==0 and Status == 'Enabled' or Status==\\\"Auto disabled\\\"\\r\\n| extend Status=iff(Status == 'Enabled' and AlertAmount==0, \\\"No Alerts\\\", Status)\\r\\n| project Status,RuleName, AlertAmount\\r\\n\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"contains\",\"thresholdValue\":\"No Alerts\",\"representation\":\"1\",\"text\":\"No Alerts\"},{\"operator\":\"contains\",\"thresholdValue\":\"Auto disabled\",\"representation\":\"2\",\"text\":\"Auto disabled\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"question\",\"text\":\"\"}],\"customColumnWidthSetting\":\"11ch\"}}],\"labelSettings\":[{\"columnId\":\"Status\"},{\"columnId\":\"RuleName\",\"label\":\"Rule name\"}]}},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 17\"}]},\"customWidth\":\"60\",\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"rule required attention group\"}]},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"Rule\"},\"name\":\"AlertRulesGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Total number of alerts\\nSum of the alerts generated by all the selected rules over the selected time range\"},\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"text Sum of the numbers of alerts generated by all the selected rules\"},{\"type\":1,\"content\":{\"json\":\"### Help\\r\\nThe **Total number of alerts** chart shows the total count of the alerts generated by the selected rules over the selected time range.\\r\\nYou can use this chart to monitor the alert load on the SOC.\\r\\n\",\"style\":\"info\"},\"conditionalVisibilities\":[{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"text alerts generated by the selected rules over the selected time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\nlet isProductMarked = (product:string) {\\r\\n    let productText = strcat_array(dynamic([{ProductName}]),\\\",\\\");\\r\\n    array_index_of(split(productText,'\\\\\\\"'),product)\\r\\n};\\r\\nSecurityAlert\\r\\n| project TimeGenerated,ProductName,ExtendedProperties\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| extend AnalyticRuleIdStr = replace('\\\\\\\"','',tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| extend AnaliticRulesInAlertArray= split(substring(AnalyticRuleIdStr,1,string_size(AnalyticRuleIdStr)-2),\\\",\\\")\\r\\n| mv-expand SingleAnaliticRuleID=AnaliticRulesInAlertArray\\r\\n| extend SingleAnaliticRuleID=iff(ProductName==\\\"Azure Sentinel\\\",tostring(SingleAnaliticRuleID),ProductName)\\r\\n| extend RuleName= iff(ProductName==\\\"Azure Sentinel\\\",tostring(todynamic(ExtendedProperties)['Analytic Rule Name']),ProductName)\\r\\n| where isProductMarked(ProductName)!=-1 or ProductName == \\\"Azure Sentinel\\\" and  alertText has SingleAnaliticRuleID\\r\\n| summarize AlertAmount=count() by bin(TimeGenerated,1h)\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"AlertAmount\",\"label\":\"Number of alerts\"}]}},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Total amount of alerts\"},{\"type\":1,\"content\":{\"json\":\"## Number of alerts, by rule\\nCount of the alerts generated by each of the selected rules over time\"},\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"number of alerts by selected rule text \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\nlet isProductMarked = (product:string) {\\r\\n    let productText = strcat_array(dynamic([{ProductName}]),\\\",\\\");\\r\\n    array_index_of(split(productText,'\\\\\\\"'),product)\\r\\n};\\r\\nSecurityAlert\\r\\n| project TimeGenerated,ProductName,ExtendedProperties\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| extend AnalyticRuleIdStr = replace('\\\\\\\"','',tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| extend AnaliticRulesInAlertArray= split(substring(AnalyticRuleIdStr,1,string_size(AnalyticRuleIdStr)-2),\\\",\\\")\\r\\n| mv-expand SingleAnaliticRuleID=AnaliticRulesInAlertArray\\r\\n| extend SingleAnaliticRuleID=iff(ProductName==\\\"Azure Sentinel\\\",tostring(SingleAnaliticRuleID),ProductName)\\r\\n| extend RuleName= iff(ProductName==\\\"Azure Sentinel\\\",tostring(todynamic(ExtendedProperties)['Analytic Rule Name']),ProductName)\\r\\n| where isProductMarked(ProductName)!=-1 or ProductName == \\\"Azure Sentinel\\\" and  alertText has SingleAnaliticRuleID\\r\\n| summarize AlertAmount=count() by bin(TimeGenerated,1h),SingleAnaliticRuleID,RuleName\",\"size\":0,\"noDataMessage\":\"No alerts generated by selected rules\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"xAxis\":\"TimeGenerated\",\"yAxis\":[\"AlertAmount\"],\"group\":\"RuleName\",\"createOtherGroup\":\"\"}},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Amount of alerts by rule over time\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"#### Alert rules trigger status\\r\\nThe number of rules that triggered alerts and those that didn't.\"},\"name\":\"Alert rules triggered text\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let getRuleNameIdTable = (){\\r\\n    let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\n    let RuleName =  strcat_array(dynamic([{RuleName}]),\\\",\\\");\\r\\n    let rulesData = range x from 0 to array_length(split(alertText,','))-1 step 1\\r\\n    | extend AlertRuleId= tostring(split(alertText,',')[x]),\\r\\n    RuleName=tostring(split(RuleName,',')[x]);\\r\\n    rulesData\\r\\n};\\r\\nlet GetAlertRuleTable = (){\\r\\n    let proerties = dynamic([{prop}]);\\r\\n    let TmpRuleTable = datatable (MockColumn:string)[\\\"Mock\\\"];\\r\\n    TmpRuleTable\\r\\n    | mv-expand SingleRuleProperties=proerties\\r\\n    | project-away MockColumn\\r\\n    | extend \\r\\n    Product=iff(SingleRuleProperties.productFilter!='',SingleRuleProperties.productFilter,\\\"Azure Sentinel\\\"), \\r\\n    RuleName=tostring(SingleRuleProperties.displayName), \\r\\n    MITRE_Tactics=iff(SingleRuleProperties.tactics!='',SingleRuleProperties.tactics,dynamic([])),\\r\\n    Description=SingleRuleProperties.description\\r\\n    | extend Status= iff(SingleRuleProperties.enabled==true,'Enabled',iff(RuleName startswith 'AUTO DISABLED','Auto disabled', 'Disabled'))\\r\\n    | project-away SingleRuleProperties\\r\\n    | join getRuleNameIdTable() on $left.RuleName==$right.RuleName\\r\\n    | project-away RuleName1,x\\r\\n};\\r\\nlet AlertAmount = materialize( SecurityAlert\\r\\n| project ExtendedProperties,ProductName, ProviderName,TimeGenerated\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| extend AnalyticRuleIdStr = replace('\\\\\\\"','',tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| extend AnaliticRulesInAlertArray= split(substring(AnalyticRuleIdStr,1,string_size(AnalyticRuleIdStr)-2),\\\",\\\")\\r\\n| mv-expand SingleAnaliticRuleID=AnaliticRulesInAlertArray\\r\\n| extend SingleAnaliticRuleID=iff(ProductName==\\\"Azure Sentinel\\\",tostring(SingleAnaliticRuleID),ProductName)\\r\\n| summarize AlertAmount=count() by SingleAnaliticRuleID\\r\\n| extend AlertAmount=iff(AlertAmount>0,AlertAmount,0));\\r\\nlet contentTable= materialize(GetAlertRuleTable()\\r\\n| join kind=leftouter AlertAmount on $left.AlertRuleId==$right.SingleAnaliticRuleID \\r\\n| project-away SingleAnaliticRuleID\\r\\n| extend AlertAmount=iff(AlertAmount>0 or Product!= 'Azure Sentinel',AlertAmount,0)\\r\\n| join kind=leftouter AlertAmount on $left.Product==$right.SingleAnaliticRuleID\\r\\n| extend AlertAmount=iff(Product!= 'Azure Sentinel',AlertAmount1,AlertAmount)\\r\\n| extend AlertAmount=iff(AlertAmount>0,AlertAmount,0)\\r\\n| project-away AlertAmount1\\r\\n| sort by AlertAmount desc\\r\\n| project Status,Product,RuleName,AlertAmount);\\r\\ncontentTable\\r\\n| summarize Amount=countif(AlertAmount > 0)\\r\\n| extend Type='Alerted'\\r\\n| join kind=fullouter  \\r\\n(contentTable | summarize Amount=countif(AlertAmount == 0)\\r\\n| extend Type='No alerts') on $left.Type==$right.Type\\r\\n| extend Type = iff(Type=='',Type1,Type), Amount=iff(Amount>0,Amount,Amount1)\\r\\n| project Type,Amount\\r\\n\\r\\n\",\"size\":2,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"No alerts\",\"label\":\"Rules that did not generate alerts\",\"color\":\"red\"},{\"seriesName\":\"Alerted\",\"label\":\"Rules that generated alerts\",\"color\":\"greenDark\"}]}},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Rules alert generation status\"}]},\"customWidth\":\"40\",\"name\":\"AlertGenerationGroup\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\nlet isProductMarked = (product:string) {\\r\\n    let productText = strcat_array(dynamic([{ProductName}]),\\\",\\\");\\r\\n    array_index_of(split(productText,'\\\\\\\"'),product)\\r\\n};\\r\\nSecurityAlert\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| where isProductMarked(ProductName)!=-1 or ProductName == 'Azure Sentinel'\\r\\n| extend AlertRuleIDArray= parsejson(tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| mv-expand SingleAnaliticRuleID=AlertRuleIDArray\\r\\n| extend SingleAnaliticRuleID= tostring(SingleAnaliticRuleID)\\r\\n| where alertText has SingleAnaliticRuleID\\r\\n| summarize AmountOfAlerts=count() by AlertSeverity\",\"size\":0,\"title\":\"Alerts generated, by severity\",\"noDataMessage\":\"No alerts\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"60\",\"conditionalVisibility\":{\"parameterName\":\"AlertRuleID\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query alert generation status\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let getRuleNameIdTable = (){\\r\\n    let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\n    let RuleName =  strcat_array(dynamic([{RuleName}]),\\\",\\\");\\r\\n    let rulesData = range x from 0 to array_length(split(alertText,','))-1 step 1\\r\\n    | extend AlertRuleId= tostring(split(alertText,',')[x]),\\r\\n    RuleName=tostring(split(RuleName,',')[x]);\\r\\n    rulesData\\r\\n};\\r\\nlet GetAlertRuleTable = (){\\r\\n    let proerties = dynamic([{prop}]);\\r\\n    let TmpRuleTable = datatable (MockColumn:string)[\\\"Mock\\\"];\\r\\n    TmpRuleTable\\r\\n    | mv-expand SingleRuleProperties=proerties\\r\\n    | project-away MockColumn\\r\\n    | extend \\r\\n    Product=iff(SingleRuleProperties.productFilter!='',SingleRuleProperties.productFilter,\\\"Azure Sentinel\\\"), \\r\\n    RuleName=tostring(SingleRuleProperties.displayName), \\r\\n    MITRE_Tactics=iff(SingleRuleProperties.tactics!='',SingleRuleProperties.tactics,dynamic([])),\\r\\n    Description=SingleRuleProperties.description\\r\\n    | extend Status= iff(SingleRuleProperties.enabled==true,'Enabled',iff(RuleName startswith 'AUTO DISABLED','Auto disabled', 'Disabled'))\\r\\n    | project-away SingleRuleProperties\\r\\n    | join getRuleNameIdTable() on $left.RuleName==$right.RuleName\\r\\n    | project-away RuleName1,x\\r\\n};\\r\\nlet AlertAmount = materialize( SecurityAlert\\r\\n| project ExtendedProperties,ProductName, ProviderName,TimeGenerated\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| extend AnalyticRuleIdStr = replace('\\\\\\\"','',tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| extend AnaliticRulesInAlertArray= split(substring(AnalyticRuleIdStr,1,string_size(AnalyticRuleIdStr)-2),\\\",\\\")\\r\\n| mv-expand SingleAnaliticRuleID=AnaliticRulesInAlertArray\\r\\n| extend SingleAnaliticRuleID=iff(ProductName==\\\"Azure Sentinel\\\",tostring(SingleAnaliticRuleID),ProductName)\\r\\n| summarize AlertAmount=count() by SingleAnaliticRuleID\\r\\n| extend AlertAmount=iff(AlertAmount>0,AlertAmount,0));\\r\\nGetAlertRuleTable()\\r\\n| join kind=leftouter AlertAmount on $left.AlertRuleId==$right.SingleAnaliticRuleID \\r\\n| project-away SingleAnaliticRuleID\\r\\n| extend AlertAmount=iff(AlertAmount>0 or Product!= 'Azure Sentinel',AlertAmount,0)\\r\\n| join kind=leftouter AlertAmount on $left.Product==$right.SingleAnaliticRuleID\\r\\n| extend AlertAmount=iff(Product!= 'Azure Sentinel',AlertAmount1,AlertAmount)\\r\\n| extend AlertAmount=iff(AlertAmount>0,AlertAmount,0)\\r\\n| project-away AlertAmount1\\r\\n| sort by AlertAmount desc\\r\\n| project Status,Product,RuleName,AlertAmount\",\"size\":0,\"title\":\"Rules alert amount table \",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Enabled\",\"representation\":\"success\",\"text\":\"\"},{\"operator\":\"==\",\"thresholdValue\":\"Disabled\",\"representation\":\"disabled\",\"text\":\"\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"failed\",\"text\":\"\"}],\"compositeBarSettings\":{\"labelText\":\"\",\"columnSettings\":\"[]\"},\"customColumnWidthSetting\":\"11ch\"}},{\"columnMatch\":\"Product\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30.7143ch\"}},{\"columnMatch\":\"AlertAmount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"magenta\"}},{\"columnMatch\":\"MITRE_Tactics\",\"formatter\":5},{\"columnMatch\":\"Description\",\"formatter\":5},{\"columnMatch\":\"AlertRuleId\",\"formatter\":5},{\"columnMatch\":\"SingleAnaliticRuleID\",\"formatter\":5}],\"labelSettings\":[{\"columnId\":\"Status\",\"comment\":\"\"},{\"columnId\":\"Product\"},{\"columnId\":\"RuleName\",\"label\":\"Rule name\"},{\"columnId\":\"AlertAmount\",\"label\":\"Number of alerts\"}]},\"sortBy\":\"[]\"},\"customWidth\":\"56\",\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Alert amount table query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\nlet isProductMarked = (product:string) {\\r\\n    let productText = strcat_array(dynamic([{ProductName}]),\\\",\\\");\\r\\n    array_index_of(split(productText,','),product)\\r\\n};\\r\\nSecurityAlert\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| where isProductMarked(ProductName)!=-1  or ProductName == 'Azure Sentinel'\\r\\n| extend AlertRuleIDArray= parsejson(tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| mv-expand SingleAnaliticRuleID=AlertRuleIDArray\\r\\n| extend SingleAnaliticRuleID= tostring(SingleAnaliticRuleID)\\r\\n| where alertText has SingleAnaliticRuleID\\r\\n| summarize count() by ProductName\\r\\n\",\"size\":2,\"title\":\"Number of alerts by provider\",\"noDataMessage\":\"No alerts created\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"ProviderName\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"count_\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"count_\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"38\",\"conditionalVisibility\":{\"parameterName\":\"AlertRuleID\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query numver of alert by provider\"},{\"type\":1,\"content\":{\"json\":\"### Count of alerts, by rule\\nThe total number of alerts generated by each rule over the selected time period \"},\"conditionalVisibility\":{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"},\"name\":\"heading text alert amount created by each rules \"},{\"type\":1,\"content\":{\"json\":\"### Help\\r\\nHere you can see the amount of alerts created from each rule you selected. \\r\\nMonitoring the amount of alert each detection is creating is essential for the SOC.\\r\\n\\r\\n\",\"style\":\"info\"},\"customWidth\":\"80\",\"conditionalVisibilities\":[{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},{\"parameterName\":\"prop\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Help text alert amount created by each rules \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let alertText =  strcat_array(dynamic([{AlertRuleID}]),\\\",\\\");\\r\\nlet isProductMarked = (product:string) {\\r\\n    let productText = strcat_array(dynamic([{ProductName}]),\\\",\\\");\\r\\n    array_index_of(split(productText,'\\\\\\\"'),product)\\r\\n};\\r\\nSecurityAlert\\r\\n| project TimeGenerated,ProductName,ExtendedProperties\\r\\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated <= {TimeRange:end}\\r\\n| extend AlertRuleName = parsejson(tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Name\\\"]))\\r\\n| extend AlertRuleIDArray= parsejson(tostring(todynamic(ExtendedProperties)[\\\"Analytic Rule Ids\\\"]))\\r\\n| mv-expand SingleAnaliticRuleID=AlertRuleIDArray\\r\\n| extend SingleAnaliticRuleID=tostring(SingleAnaliticRuleID)\\r\\n| project SingleAnaliticRuleID,AlertRuleName, ProductName\\r\\n| where isProductMarked(ProductName)!=-1 or ProductName == \\\"Azure Sentinel\\\" and  alertText has SingleAnaliticRuleID\\r\\n| extend AlertRuleIdentifier = iff(ProductName==\\\"Azure Sentinel\\\", tostring(AlertRuleName), tostring(ProductName))\\r\\n| summarize AlertAmount=count() by AlertRuleIdentifier\",\"size\":0,\"noDataMessage\":\"No alerts created\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"chartSettings\":{\"createOtherGroup\":6}},\"customWidth\":\"80\",\"conditionalVisibility\":{\"parameterName\":\"AlertRuleID\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Alerts generated by selected rules\"}]},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"Alert\"},\"name\":\"AlertGroup\"},{\"type\":1,\"content\":{\"json\":\"\"},\"name\":\"text - 19\"}],\"fromTemplateId\":\"sentinel-AnalyticsEfficiency\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=AnalyticsEfficiencyWorkbook; logoFileName=Azure_Sentinel.svg; description=Gain insights into the efficacy of your analytics rules. In this workbook you can analyze and monitor the analytics rules found in your workspace to achieve better performance by your SOC.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.2.0; title=Analytics Efficiency; templateRelativePath=AnalyticsEfficiency.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "SecurityAlert",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SecurityIncident",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AnomaliesVisualizationWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId2')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "A workbook that provides contextual information to a user for better insight on Anomalies and their impact. The workbook will help with investigation of anomalies as well as identify patterns that can lead to a threat."
              },
              "properties": {
                "displayName": "[parameters('workbook2-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Anomaly Summary\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident \\r\\n| mv-expand AlertIds\\r\\n| extend AlertIds = tostring(AlertIds)\\r\\n| join \\r\\n(\\r\\n    SecurityAlert\\r\\n) on $left.AlertIds == $right.SystemAlertId\\r\\n| where AlertType == '8ecf8077-cf51-4820-aadd-14040956f35d_212ef723-bb93-4450-8ef5-166c43dc6e57'\\r\\n| summarize by ProviderIncidentId, TenantId\\r\\n| count\",\"size\":4,\"title\":\"Incidents with Anomalies\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Anomalies\\r\\n| count\",\"size\":4,\"title\":\"Anomalies\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"Anomalies\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Anomalies\\r\\n| where tostring(Entities) contains '\\\"Type\\\":\\\"host\\\"'\\r\\n| count\",\"size\":4,\"title\":\"Anomalies by Host\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Anomalies\\r\\n| where tostring(Entities) contains '\\\"Type\\\":\\\"account\\\"'\\r\\n| count\",\"size\":4,\"title\":\"Anomalies by Account\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"query - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Anomalies\\r\\n| where tostring(Entities) contains '\\\"Type\\\":\\\"ip\\\"'\\r\\n| count\",\"size\":4,\"title\":\"Anomalies by IP\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"query - 2 - Copy - Copy\"}]},\"name\":\"Anomaly Summary\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let incidentIdList = SecurityIncident \\r\\n| mv-expand AlertIds\\r\\n| extend AlertIds = tostring(AlertIds)\\r\\n| join SecurityAlert on $left.AlertIds == $right.SystemAlertId\\r\\n| where AlertType == '8ecf8077-cf51-4820-aadd-14040956f35d_212ef723-bb93-4450-8ef5-166c43dc6e57'\\r\\n| summarize by ProviderIncidentId, TenantId;\\r\\nSecurityIncident\\r\\n| join kind=innerunique incidentIdList on ProviderIncidentId, TenantId\\r\\n| project-away ProviderIncidentId1, TenantId1\\r\\n| project Title, IncidentUrl, TimeGenerated, IncidentName, Description, Severity, Status, Classification, ClassificationComment, ClassificationReason, Owner, ProviderName, ProviderIncidentId, FirstActivityTime, LastActivityTime, FirstModifiedTime, LastModifiedTime, CreatedTime, ClosedTime, IncidentNumber, RelatedAnalyticRuleIds, AlertIds, BookmarkIds, Comments, Labels, AdditionalData, ModifiedBy, SourceSystem\\r\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"Incidents\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"IncidentName\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"IncidentName\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Anomalies \\r\\n| project TimeGenerated, Id, AnomalyTemplateName, AnomalyTemplateId, AnomalyTemplateVersion, WorkspaceId, VendorName, RuleId, RuleStatus, RuleName, RuleConfigVersion, Score, Description, StartTime, EndTime, ExtendedLinks, Tactics, Techniques, UserName, UserPrincipalName, SourceIpAddress, SourceLocation, SourceDevice, DestinationIpAddress, DestinationLocation, DestinationDevice, ActivityInsights, DeviceInsights, UserInsights, AnomalyReasons, Entities, ExtendedProperties, AnomalyDetails, SourceSystem \\r\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"Latest Anomalies (Last 7 Days)\",\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"Latest Anomalies\"}]},\"name\":\"group - 3\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Anomalies\\r\\n| extend AnomalyType = AnomalyTemplateName\\r\\n| summarize count() by AnomalyType\\r\\n| sort by count_ desc\",\"size\":0,\"timeContext\":{\"durationMs\":2592000000},\"exportFieldName\":\"AnomalyType\",\"exportParameterName\":\"AnomalyType\",\"exportDefaultValue\":\"*\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"25\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let AnomalyTypeString_ = trim('\\\"', '{AnomalyType}');\\r\\nAnomalies\\r\\n| where AnomalyTemplateName == iif(AnomalyTypeString_ == '*', AnomalyTemplateName, AnomalyTypeString_)\\r\\n| summarize count() by bin(TimeGenerated, 1h)\",\"size\":0,\"title\":\"Anomalies Trend\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\"},\"customWidth\":\"75\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let AnomalyTypeString_ = trim('\\\"', '{AnomalyType}');\\r\\nAnomalies\\r\\n| where AnomalyTemplateName == iif(AnomalyTypeString_ == '*', AnomalyTemplateName, AnomalyTypeString_)\\r\\n| extend idParam = strcat('\\\"id\\\":', Id)\\r\\n| sort by Score desc\\r\\n| project Id, AnomalyTemplateName, Entities, Description, StartTime, EndTime, Score, idParam\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":2592000000},\"exportedParameters\":[{\"fieldName\":\"Id\",\"parameterName\":\"AnomalyId\",\"parameterType\":1},{\"fieldName\":\"AnomalyTemplateName\",\"parameterName\":\"AnomalyTemplateName\",\"parameterType\":1},{\"fieldName\":\"Description\",\"parameterName\":\"AnomalyDescription\",\"parameterType\":1},{\"fieldName\":\"StartTime\",\"parameterName\":\"StartTime\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Id\",\"formatter\":5},{\"columnMatch\":\"AnomalyTemplateName\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"\",\"workbookContext\":{\"componentIdSource\":\"workbook\",\"resourceIdsSource\":\"workbook\",\"templateIdSource\":\"static\",\"templateId\":\"<PlaceHolder, please update to anomaly data workbook or workbook of choice>\",\"typeSource\":\"workbook\",\"gallerySource\":\"workbook\",\"locationSource\":\"default\",\"passSpecificParams\":true,\"templateParameters\":[{\"name\":\"Id\",\"source\":\"column\",\"value\":\"Id\"},{\"name\":\"Description\",\"source\":\"column\",\"value\":\"Description\"},{\"name\":\"AnomalyTemplateName\",\"source\":\"column\",\"value\":\"AnomalyTemplateName\"},{\"name\":\"StartTime\",\"source\":\"column\",\"value\":\"StartTime\"},{\"name\":\"EndTime\",\"source\":\"column\",\"value\":\"EndTime\"}]},\"bladeOpenContext\":{\"bladeName\":\"UsageNotebookBlade\",\"extensionName\":\"AppInsightsExtension\",\"bladeParameters\":[{\"name\":\"ComponentId\",\"source\":\"static\",\"value\":\"<PlaceHolder, please update to anomaly data workbook or workbook of choice>\"},{\"name\":\"ConfigurationId\",\"source\":\"static\",\"value\":\"<PlaceHolder, please update to anomaly data workbook or workbook of choice>\"},{\"name\":\"Type\",\"source\":\"static\",\"value\":\"sentinel\"},{\"name\":\"WorkbookTemplateName\",\"source\":\"static\",\"value\":\"Anomaly Data Workbook\"},{\"name\":\"NotebookParams\",\"source\":\"column\",\"value\":\"idParam\"}]}}},{\"columnMatch\":\"Description\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"70ch\"}},{\"columnMatch\":\"EndTime\",\"formatter\":5},{\"columnMatch\":\"Score\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"8ch\"}},{\"columnMatch\":\"idParam\",\"formatter\":5}],\"sortBy\":[{\"itemKey\":\"Score\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Score\",\"sortOrder\":2}]},\"name\":\"query - 1\"}]},\"name\":\"group - 1\"}],\"fromTemplateId\":\"sentinel-AnomaliesVisualizationWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId2'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=AnomaliesVisualizationWorkbook; logoFileName=; description=A workbook that provides contextual information to a user for better insight on Anomalies and their impact. The workbook will help with investigation of anomalies as well as identify patterns that can lead to a threat.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=AnomaliesVisulization; templateRelativePath=AnomaliesVisualization.json; subtitle=; provider=Microsoft Sentinel Community}.description",
                "parentId": "[variables('workbookId2')]",
                "contentId": "[variables('_workbookContentId2')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "Anomalies",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId2')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook2-name')]",
        "contentProductId": "[variables('_workbookcontentProductId2')]",
        "id": "[variables('_workbookcontentProductId2')]",
        "version": "[variables('workbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AnomalyDataWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId3')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "A workbook providing details, related Incident, and related Hunting Workbook for a specific Anomaly."
              },
              "properties": {
                "displayName": "[parameters('workbook3-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b4bca4a8-7fef-494e-9dd0-5ccd77fee390\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Id\",\"type\":1,\"isGlobal\":true,\"timeContext\":{\"durationMs\":86400000},\"value\":\"85ff04bc-c150-4444-8e2a-48f39679c785\"},{\"id\":\"d4383faf-970a-42d3-acbb-29c0445c615b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AnomalyTemplateName\",\"type\":1,\"isGlobal\":true,\"timeContext\":{\"durationMs\":86400000},\"value\":\"(Preview) UEBA Anomalous Account Creation\"},{\"id\":\"7fc9760f-8718-47b9-9e00-de6e7da6a6f1\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Description\",\"type\":1,\"isGlobal\":true,\"value\":\"91f40573-5825-407e-90ad-32c68bbe5f5d's account Performed a UserManagement action, Add user (490826a1-e130-4d0a-b119-9501012b4bd4@contosohotelb2corgp1.onmicrosoft.com).  from quincy, united states  From IP address 40.126.26.160       \"},{\"id\":\"79c838d7-e4f0-46cb-bf3b-e19c52a75609\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"StartTime\",\"type\":1,\"isGlobal\":true,\"value\":\"2022-05-19T19:31:20Z\"},{\"id\":\"014cb5c1-87ca-4dd7-b081-8877734abc20\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"EndTime\",\"type\":1,\"isGlobal\":true,\"value\":\"2022-05-19T19:31:20Z\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":1,\"content\":{\"json\":\"## {AnomalyTemplateName}\\r\\n\\r\\n{Description}\\r\\n\\r\\n**Start Date**: {StartTime}  \\r\\n**End Date**: {EndTime}\"},\"name\":\"text - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Anomalies\\r\\n| where Id == '{Id}'\\r\\n| mv-expand Entities\\r\\n| project Entities\\r\\n| evaluate bag_unpack(Entities, columnsConflict='replace_source')\",\"size\":1,\"title\":\"Entities\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Anomalies\\r\\n| where AnomalyTemplateName == '{AnomalyTemplateName}'\\r\\n| summarize count() by bin(TimeGenerated, 1h)\",\"size\":0,\"title\":\"Anomaly Job Trend\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\"},\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let fusionAlert =  SecurityAlert\\r\\n| extend extendedPropertiesDict = parse_json(ExtendedProperties)\\r\\n| extend originalSystemAlertId = extendedPropertiesDict['OriginalSystemAlertId']\\r\\n| where originalSystemAlertId == '{Id}';\\r\\nlet incidentIdList = SecurityIncident \\r\\n| mv-expand AlertIds\\r\\n| extend AlertIds = tostring(AlertIds)\\r\\n| join fusionAlert on $left.AlertIds == $right.SystemAlertId\\r\\n| summarize by ProviderIncidentId, TenantId;\\r\\nSecurityIncident\\r\\n| join kind=innerunique incidentIdList on ProviderIncidentId, TenantId\\r\\n| project-away ProviderIncidentId1, TenantId1\\r\\n| project Title, IncidentUrl, TimeGenerated, IncidentName, Description, Severity, Status, Classification, ClassificationComment, ClassificationReason, Owner, ProviderName, ProviderIncidentId, FirstActivityTime, LastActivityTime, FirstModifiedTime, LastModifiedTime, CreatedTime, ClosedTime, IncidentNumber, RelatedAnalyticRuleIds, AlertIds, BookmarkIds, Comments, Labels, AdditionalData, ModifiedBy, SourceSystem\\r\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"Related Incidents\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let fusionAlert =  SecurityAlert\\r\\n| extend extendedPropertiesDict = parse_json(ExtendedProperties)\\r\\n| extend originalSystemAlertId = extendedPropertiesDict['OriginalSystemAlertId']\\r\\n| where originalSystemAlertId == '{Id}';\\r\\nlet incidentIdList = SecurityIncident \\r\\n| mv-expand AlertIds\\r\\n| extend AlertIds = tostring(AlertIds)\\r\\n| join fusionAlert on $left.AlertIds == $right.SystemAlertId\\r\\n| summarize by ProviderIncidentId, TenantId;\\r\\nlet uniqueIncidentIdList = SecurityIncident\\r\\n| join kind=innerunique incidentIdList on ProviderIncidentId, TenantId;\\r\\nlet incidentBookmarkIds = uniqueIncidentIdList\\r\\n| mv-expand BookmarkIds\\r\\n| project BookmarkId = tostring(BookmarkIds);\\r\\nHuntingBookmark\\r\\n| join incidentBookmarkIds on BookmarkId;\",\"size\":0,\"title\":\"Related Hunting Bookmarks\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 5\"}],\"fromTemplateId\":\"sentinel-AnomalyDataWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId3'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=AnomalyDataWorkbook; logoFileName=; description=A workbook providing details, related Incident, and related Hunting Workbook for a specific Anomaly.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=AnomalyData; templateRelativePath=AnomalyData.json; subtitle=; provider=Microsoft Sentinel Community}.description",
                "parentId": "[variables('workbookId3')]",
                "contentId": "[variables('_workbookContentId3')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "Anomalies",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId3')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook3-name')]",
        "contentProductId": "[variables('_workbookcontentProductId3')]",
        "id": "[variables('_workbookcontentProductId3')]",
        "version": "[variables('workbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AttackSurfaceReductionWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId4')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "This workbook helps you implement the ASR rules of Windows/Defender, and to monitor them over time. The workbook can filter on ASR rules in Audit mode and Block mode."
              },
              "properties": {
                "displayName": "[parameters('workbook4-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Attack Surface Reduction Dashboard\\n---\\n\\nVersion: 2022.1\\n\\nCreated by: Daniel Chronlund (https://danielchronlund.com)\"},\"name\":\"text - heading\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let T = datatable(DisplayName:string, AdvancedHuntingAuditAction:string, AdvancedHuntingBlockAction:string, Description:string, DocsURL:string, GUID:string)\\r\\n[\\r\\n    \\\"Block abuse of exploited vulnerable signed drivers\\\", \\\"Not yet available\\\", \\\"Not yet available\\\", \\\"This rule prevents an application from writing a vulnerable signed driver to disk.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-abuse-of-exploited-vulnerable-signed-drivers\\\", \\\"56a863a9-875e-4185-98a7-b882c64b5ce5\\\", \\r\\n    \\\"Block Adobe Reader from creating child processes\\\", \\\"AsrAdobeReaderChildProcessAudited\\\", \\\"AsrAdobeReaderChildProcessBlocked\\\", \\\"This rule prevents attacks by blocking Adobe Reader from creating processes.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-adobe-reader-from-creating-child-processes\\\", \\\"7674ba52-37eb-4a4f-a9a1-f0f9a1619a2c\\\", \\r\\n    \\\"Block all Office applications from creating child processes\\\", \\\"AsrOfficeChildProcessAudited\\\", \\\"AsrOfficeChildProcessBlocked\\\", \\\"This rule blocks Office apps from creating child processes. Office apps include Word, Excel, PowerPoint, OneNote, and Access.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-all-office-applications-from-creating-child-processes\\\", \\\"d4f940ab-401b-4efc-aadc-ad5f3c50688a\\\", \\r\\n    \\\"Block credential stealing from the Windows local security authority subsystem\\\", \\\"AsrLsassCredentialTheftAudited\\\", \\\"AsrLsassCredentialTheftBlocked\\\", \\\"This rule helps prevent credential stealing by locking down Local Security Authority Subsystem Service (LSASS).\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-credential-stealing-from-the-windows-local-security-authority-subsystem\\\", \\\"9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2\\\", \\r\\n    \\\"Block executable content from email client and webmail\\\", \\\"AsrExecutableEmailContentAudited\\\", \\\"AsrExecutableEmailContentBlocked\\\", \\\"This rule blocks the following file types from launching from email opened within the Microsoft Outlook application, or Outlook.com and other popular webmail providers: Executable files (such as .exe, .dll, or .scr) Script files (such as a PowerShell .ps, Visual Basic .vbs, or JavaScript .js file).\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-executable-content-from-email-client-and-webmail\\\", \\\"be9ba2d9-53ea-4cdc-84e5-9b1eeee46550\\\", \\r\\n    \\\"Block executable files from running unless they meet a prevalence, age, or trusted list criterion\\\", \\\"AsrUntrustedExecutableAudited\\\", \\\"AsrUntrustedExecutableBlocked\\\", \\\"This rule blocks executable files, such as .exe, .dll, or .scr, from launching. Thus, launching untrusted or unknown executable files can be risky, as it might not be initially clear if the files are malicious.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-executable-files-from-running-unless-they-meet-a-prevalence-age-or-trusted-list-criterion\\\", \\\"01443614-cd74-433a-b99e-2ecdc07bfc25\\\", \\r\\n    \\\"Block execution of potentially obfuscated scripts\\\", \\\"AsrObfuscatedScriptAudited\\\", \\\"AsrObfuscatedScriptBlocked\\\", \\\"This rule detects suspicious properties within an obfuscated script.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-execution-of-potentially-obfuscated-scripts\\\", \\\"5beb7efe-fd9a-4556-801d-275e5ffc04cc\\\", \\r\\n    \\\"Block JavaScript or VBScript from launching downloaded executable content\\\", \\\"AsrScriptExecutableDownloadAudited\\\", \\\"AsrScriptExecutableDownloadBlocked\\\", \\\"This rule prevents scripts from launching potentially malicious downloaded content. Malware written in JavaScript or VBScript often acts as a downloader to fetch and launch other malware from the Internet.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-javascript-or-vbscript-from-launching-downloaded-executable-content\\\", \\\"d3e037e1-3eb8-44c8-a917-57927947596d\\\", \\r\\n    \\\"Block Office applications from creating executable content\\\", \\\"AsrExecutableOfficeContentAudited\\\", \\\"AsrExecutableOfficeContentBlocked\\\", \\\"This rule prevents Office apps, including Word, Excel, and PowerPoint, from creating potentially malicious executable content, by blocking malicious code from being written to disk.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-office-applications-from-creating-executable-content\\\", \\\"3b576869-a4ec-4529-8536-b80a7769e899\\\", \\r\\n    \\\"Block Office applications from injecting code into other processes\\\", \\\"AsrOfficeProcessInjectionAudited\\\", \\\"AsrOfficeProcessInjectionBlocked\\\", \\\"This rule blocks code injection attempts from Office apps into other processes.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-office-applications-from-injecting-code-into-other-processes\\\", \\\"75668c1f-73b5-4cf0-bb93-3ecf5cb7cc84\\\", \\r\\n    \\\"Block Office communication application from creating child processes\\\", \\\"AsrOfficeCommAppChildProcessAudited\\\", \\\"AsrOfficeCommAppChildProcessBlocked\\\", \\\"This rule prevents Outlook from creating child processes, while still allowing legitimate Outlook functions.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-office-communication-application-from-creating-child-processes\\\", \\\"26190899-1602-49e8-8b27-eb1d0a1ce869\\\", \\r\\n    \\\"Block persistence through WMI event subscription\\\", \\\"AsrPersistenceThroughWmiAudited\\\", \\\"AsrPersistenceThroughWmiBlocked\\\", \\\"This rule prevents malware from abusing WMI to attain persistence on a device.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-persistence-through-wmi-event-subscription\\\", \\\"e6db77e5-3df2-4cf1-b95a-636979351e5b\\\", \\r\\n    \\\"Block process creations originating from PSExec and WMI commands\\\", \\\"AsrPsexecWmiChildProcessAudited\\\", \\\"AsrPsexecWmiChildProcessBlocked\\\", \\\"This rule blocks processes created throughPsExecandWMIfrom running.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-process-creations-originating-from-psexec-and-wmi-commands\\\", \\\"d1e49aac-8f56-4280-b9ba-993a6d77406c\\\", \\r\\n    \\\"Block untrusted and unsigned processes that run from USB\\\", \\\"AsrUntrustedUsbProcessAudited\\\", \\\"AsrUntrustedUsbProcessBlocked\\\", \\\"With this rule, admins can prevent unsigned or untrusted executable files from running from USB removable drives, including SD cards. Blocked file types include executable files (such as .exe, .dll, or .scr)\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-untrusted-and-unsigned-processes-that-run-from-usb\\\", \\\"b2b3f03d-6a65-4f7b-a9c7-1c7ef74a9ba4\\\", \\r\\n    \\\"Block Win32 API calls from Office macros\\\", \\\"AsrOfficeMacroWin32ApiCallsAudited\\\", \\\"AsrOfficeMacroWin32ApiCallsBlocked\\\", \\\"This rule prevents VBA macros from calling Win32 APIs.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-win32-api-calls-from-office-macros\\\", \\\"92e97fa1-2edf-4476-bdd6-9dd0b4dddc7b\\\", \\r\\n    \\\"Use advanced protection against ransomware\\\", \\\"AsrRansomwareAudited\\\", \\\"AsrRansomwareBlocked\\\", \\\"This rule provides an extra layer of protection against ransomware. It uses both client and cloud heuristics to determine whether a file resembles ransomware.\\\", \\\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#use-advanced-protection-against-ransomware\\\", \\\"c1db55ab-c21a-4637-bb3f-a12568109d35\\\",\\r\\n];\\r\\nT\",\"size\":1,\"title\":\"ASR Rules Reference (updated 2022-06-15)\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"DisplayName\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"DisplayName\",\"sortOrder\":1}]},\"name\":\"query - rulesreference\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n\\r\\n### How to use this dashboard:\\r\\n\\r\\n1. Select the ASR mode you are interested in. Rules running in 'Audit' or 'Block' mode.\\r\\n2. Select the time range you are interested in.\\r\\n3. Optional: Select a specific ASR rule you are interested in (default is All rules).\\r\\n4. Optional: Select a specific Windows device you are interested in (default is All devices).\\r\\n5. Optional: Select a specific user account you are interested in (default is All users).\"},\"name\":\"text - instructions\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"5e86e57b-1c37-4f5c-86f4-5db8f0a026a7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Mode\",\"type\":2,\"isRequired\":true,\"value\":\"Blocked\",\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"jsonData\":\"[\\\"Blocked\\\", \\\"Audited\\\"]\"},{\"id\":\"e327ae2b-6659-4d53-98d7-7326e30a893a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":86400000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000,\"isInitialTime\":true},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":2592000000}},{\"id\":\"16379874-5c33-49a0-a533-d8c696c51b35\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ASRRule\",\"type\":2,\"query\":\"DeviceEvents\\r\\n| where ActionType startswith \\\"Asr\\\"\\r\\n| summarize by ActionType\\r\\n| order by ActionType asc\",\"value\":\"\",\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"ed954184-3ae9-40e9-805c-d55ac7248a01\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DeviceName\",\"type\":2,\"query\":\"DeviceEvents\\r\\n| where ActionType startswith \\\"Asr\\\"\\r\\n| summarize by DeviceName\\r\\n| order by DeviceName asc\",\"value\":\"\",\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"ffda8294-0b36-4b35-935a-5611d4092950\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"User\",\"type\":2,\"query\":\"DeviceEvents\\r\\n| where ActionType startswith \\\"Asr\\\"\\r\\n| summarize by AccountName\\r\\n| order by AccountName asc\",\"value\":\"\",\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters\",\"styleSettings\":{\"margin\":\"0\",\"padding\":\"0\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Agregate all Attack Surface Reduction rules events in Block mode, in 1h time chunks to display in time line chart.\\r\\nDeviceEvents\\r\\n| where ActionType startswith \\\"Asr\\\"\\r\\n| where ActionType endswith \\\"{Mode}\\\"\\r\\n| where ActionType startswith iff(isnull(\\\"{ASRRule}\\\"), \\\"\\\", \\\"{ASRRule}\\\")\\r\\n| where DeviceName startswith iff(isnull(\\\"{DeviceName}\\\"), \\\"\\\", \\\"{DeviceName}\\\")\\r\\n| where AccountName startswith iff(isnull(\\\"{User}\\\"), \\\"\\\", \\\"{User}\\\")\\r\\n| summarize count() by ActionType, bin(TimeGenerated, 1h)\\r\\n| render timechart\",\"size\":0,\"title\":\"ASR Events Timeline\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Update conditional access policy\",\"color\":\"blue\"},{\"seriesName\":\"Add conditional access policy\",\"color\":\"green\"},{\"seriesName\":\"Delete conditional access policy\",\"color\":\"redBright\"}]}},\"customWidth\":\"100\",\"name\":\"query - asrtimeline\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\r\\n| where ActionType startswith \\\"Asr\\\"\\r\\n| where ActionType endswith \\\"{Mode}\\\"\\r\\n| where ActionType startswith iff(isnull(\\\"{ASRRule}\\\"), \\\"\\\", \\\"{ASRRule}\\\")\\r\\n| where DeviceName startswith iff(isnull(\\\"{DeviceName}\\\"), \\\"\\\", \\\"{DeviceName}\\\")\\r\\n| where AccountName startswith iff(isnull(\\\"{User}\\\"), \\\"\\\", \\\"{User}\\\")\\r\\n| summarize count() by ActionType\",\"size\":3,\"title\":\"ASR Events by Rule\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"query - eventsbyrule\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\r\\n| where ActionType startswith \\\"Asr\\\"\\r\\n| where ActionType endswith \\\"{Mode}\\\"\\r\\n| where ActionType startswith iff(isnull(\\\"{ASRRule}\\\"), \\\"\\\", \\\"{ASRRule}\\\")\\r\\n| where DeviceName startswith iff(isnull(\\\"{DeviceName}\\\"), \\\"\\\", \\\"{DeviceName}\\\")\\r\\n| where AccountName startswith iff(isnull(\\\"{User}\\\"), \\\"\\\", \\\"{User}\\\")\\r\\n| summarize count() by DeviceName\",\"size\":3,\"title\":\"ASR Events by Device\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"query - eventsbydevice\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\r\\n| where ActionType startswith \\\"Asr\\\"\\r\\n| where ActionType endswith \\\"{Mode}\\\"\\r\\n| where ActionType startswith iff(isnull(\\\"{ASRRule}\\\"), \\\"\\\", \\\"{ASRRule}\\\")\\r\\n| where DeviceName startswith iff(isnull(\\\"{DeviceName}\\\"), \\\"\\\", \\\"{DeviceName}\\\")\\r\\n| where AccountName startswith iff(isnull(\\\"{User}\\\"), \\\"\\\", \\\"{User}\\\")\\r\\n| summarize count() by InitiatingProcessAccountUpn\",\"size\":3,\"title\":\"ASR Events by User\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"query - eventsbyuser\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\r\\n| where ActionType startswith \\\"Asr\\\"\\r\\n| where ActionType endswith \\\"{Mode}\\\"\\r\\n| where ActionType startswith iff(isnull(\\\"{ASRRule}\\\"), \\\"\\\", \\\"{ASRRule}\\\")\\r\\n| where DeviceName startswith iff(isnull(\\\"{DeviceName}\\\"), \\\"\\\", \\\"{DeviceName}\\\")\\r\\n| where AccountName startswith iff(isnull(\\\"{User}\\\"), \\\"\\\", \\\"{User}\\\")\\r\\n| project TimeGenerated, ActionType, DeviceName, AccountName, InitiatingProcessAccountUpn, FileName, InitiatingProcessCommandLine, InitiatingProcessFolderPath\",\"size\":0,\"title\":\"ASR Event Log\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":1000}},\"name\":\"query - eventlog\",\"styleSettings\":{\"showBorder\":true}}],\"fromTemplateId\":\"sentinel-AttackSurfaceReduction\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId4'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=AttackSurfaceReduction; logoFileName=M365securityposturelogo.svg; description=This workbook helps you implement the ASR rules of Windows/Defender, and to monitor them over time. The workbook can filter on ASR rules in Audit mode and Block mode.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Attack Surface Reduction Dashboard; templateRelativePath=AttackSurfaceReduction.json; subtitle=; provider=Microsoft Sentinel community}.description",
                "parentId": "[variables('workbookId4')]",
                "contentId": "[variables('_workbookContentId4')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "DeviceEvents",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "MicrosoftThreatProtection",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId4')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook4-name')]",
        "contentProductId": "[variables('_workbookcontentProductId4')]",
        "id": "[variables('_workbookcontentProductId4')]",
        "version": "[variables('workbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AzureSentinelCostWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId5')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "This workbook provides an estimated cost across the main billed items in Microsoft Sentinel: ingestion, retention and automation. It also provides insight about the possible impact of the Microsoft 365 E5 offer."
              },
              "properties": {
                "displayName": "[parameters('workbook5-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Microsoft Sentinel cost summary\\n---\\n\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"9d001d6f-301c-4d03-b02c-b8cc6dce210b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":7776000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"67c2ce6e-ea54-4ae4-8343-3fcad8e53d1b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources | where type =~ 'Microsoft.operationsmanagement/solutions' | where name contains 'SecurityInsights' | project id = tostring(properties.workspaceResourceId)\",\"crossComponentResources\":[\"value::all\"],\"value\":[\"value::all\"],\"typeSettings\":{\"limitSelectTo\":100,\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"9375c625-e916-4f48-b072-352d6aeefddb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Price\",\"label\":\"Ingestion price\",\"type\":1,\"value\":\"4.3\",\"description\":\"Enter your ingestion price per GB (PAYG or Commitment Tier). Combine the cost of log analytics and sentinel ingestion for the region. Use Azure Pricing Calculator to find current pricing. Sentinel table by default is 'Analytic', not Basic. Equation is: LAW+Sentinel (ingestion by region and tier).\"},{\"id\":\"9d5299d0-36a0-4666-9803-ca6931bdaab7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"RetentionPrice\",\"label\":\"Retention price\",\"type\":1,\"description\":\"Enter the retention price per GB/month that will be used in this workbook's calculations\",\"value\":\"0.1\"},{\"id\":\"67494f3e-322e-4411-9b45-1cbea03ed618\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TotalE5Seats\",\"label\":\"Total seats (E5/A5/F5/G5)\",\"type\":1,\"description\":\"Enter the total number of Microsoft 365 E5, A5, F5, G5 and Microsoft 365 E5, A5, F5, G5 Security licenses in your environment\",\"value\":\"0\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":1,\"content\":{\"json\":\"## Ingestion and Retention Summary\"},\"name\":\"text - 2\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"union withsource=TableName1 * | where TimeGenerated < ago(90d) | extend key = 'Key' | summarize size = sum(_BilledSize)/1024/1024/1024 by key\\r\\n| project ['Data over 90 days'] = size, ['Retention Cost'] = size*{RetentionPrice}\\r\\n\\r\\n\\r\\n\",\"size\":4,\"title\":\"Data older than 90 days and resulting retention cost\",\"noDataMessage\":\"You have no data older than 90 days\",\"noDataMessageStyle\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Data over 90 days\",\"formatter\":0,\"numberFormat\":{\"unit\":36,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"Retention Cost\",\"formatter\":0,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"}}}]},\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"Data over 90 days\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":39,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},\"rightContent\":{\"columnMatch\":\"Retention Cost\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"currency\":\"USD\",\"style\":\"currency\",\"maximumFractionDigits\":2}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"33\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"union withsource = tt *\\r\\n| where TimeGenerated > startofday({TimeRange:start}) and TimeGenerated < startofday({TimeRange:end})\\r\\n// Only look at chargeable Tables\\r\\n| where _IsBillable == True\\r\\n| summarize TotalGBytes =round(sum(_BilledSize/(1024*1024*1024)),2) by bin(TimeGenerated, 1d)//, Solution=tt\\r\\n| summarize ['GBs/day'] =round(avg(TotalGBytes),2)\",\"size\":4,\"title\":\"Average billable GBs/day ingested in the last {TimeRange}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"GBs/day\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"33\",\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Usage\\r\\n| where IsBillable == true\\r\\n| summarize size = sum(Quantity)/1024 by IsBillable\\r\\n| project ['Total data ingestion'] = size, ['Estimated cost'] = size*{Price}\",\"size\":4,\"title\":\"Total billable ingestion and cost in the last {TimeRange}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\",\"compositeBarSettings\":{\"labelText\":\"\",\"columnSettings\":\"[]\"}},\"numberFormat\":{\"unit\":0,\"options\":{\"currency\":\"USD\",\"style\":\"currency\",\"useGrouping\":false}}},\"leftContent\":{\"columnMatch\":\"Total data ingestion\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":39,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":1}}},\"rightContent\":{\"columnMatch\":\"Estimated cost\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"currency\":\"USD\",\"style\":\"currency\",\"useGrouping\":false,\"maximumFractionDigits\":1}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"33\",\"name\":\"query - 8\"}]},\"name\":\"Costing\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let Categories = datatable(Type:string,Category:string)\\r\\n[\\r\\n\\\"AuditLogs\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"SigninLogs\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"AADNonInteractiveUserSignInLogs\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"AADRiskyUsers\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"AADRiskyServicePrincipals\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"AADServicePrincipalRiskEvents\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"ADFSSignInLogs\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"NetworkAccessTraffic\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"AADUserRiskEvents\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"AADServicePrincipalSignInLogs\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"AADManagedIdentitySignInLogs\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"AADProvisioningLogs\\\" , \\\"Azure Active Directory\\\",\\r\\n\\\"AZFWApplicationRule\\\" , \\\"Firewall\\\",\\r\\n\\\"AZFWApplicationRuleAggregation\\\" , \\\"Firewall\\\",\\r\\n\\\"AZFWDnsQuery\\\" , \\\"Firewall\\\",\\r\\n\\\"AZFWIdpsSignature\\\" , \\\"Firewall\\\",\\r\\n\\\"AZFWNatRule\\\" , \\\"Firewall\\\",\\r\\n\\\"AZFWNatRuleAggregation\\\" , \\\"Firewall\\\",\\r\\n\\\"AZFWNetworkRule\\\" , \\\"Firewall\\\",\\r\\n\\\"AZFWNetworkRuleAggregation\\\" , \\\"Firewall\\\",\\r\\n\\\"WindowsFirewall\\\" , \\\"Firewall\\\",\\r\\n\\\"Event\\\" , \\\"Custom Events\\\",\\r\\n\\\"BehaviorAnalytics\\\" , \\\"User Entity Behavior Analytics\\\",\\r\\n\\\"UserPeerAnalytics\\\" , \\\"User Entity Behavior Analytics\\\",\\r\\n\\\"UserAccessAnalytics\\\" , \\\"User Entity Behavior Analytics\\\",\\r\\n\\\"IdentityInfo\\\" , \\\"User Entity Behavior Analytics\\\",\\r\\n\\\"DeviceLogonEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\r\\n\\\"DeviceEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\r\\n\\\"DeviceNetworkInfo\\\" , \\\"Microsoft Defender for Endpoint\\\",\\r\\n\\\"DeviceImageLoadEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\r\\n\\\"DeviceFileEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\r\\n\\\"DeviceInfo\\\" , \\\"Microsoft Defender for Endpoint\\\",\\r\\n\\\"DeviceProcessEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\r\\n\\\"DeviceNetworkEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\r\\n\\\"DeviceRegistryEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\r\\n\\\"DeviceFileCertificateInfo\\\" , \\\"Microsoft Defender for Endpoint\\\",\\r\\n\\\"EmailAttachmentInfo\\\" , \\\"Microsoft Defender for Office 365\\\",\\r\\n\\\"EmailEvents\\\" , \\\"Microsoft Defender for Office 365\\\",\\r\\n\\\"EmailPostDeliveryEvents\\\" , \\\"Microsoft Defender for Office 365\\\",\\r\\n\\\"EmailUrlInfo\\\" , \\\"Microsoft Defender for Office 365\\\",\\r\\n\\\"IdentityLogonEvents\\\" , \\\"Microsoft Defender for Identity\\\",\\r\\n\\\"IdentityQueryEvents\\\" , \\\"Microsoft Defender for Identity\\\",\\r\\n\\\"IdentityDirectoryEvents\\\" , \\\"Microsoft Defender for Identity\\\",\\r\\n\\\"CloudAppEvents\\\" , \\\"Microsoft Defender for Cloud Apps\\\",\\r\\n\\\"AlertEvidence\\\" , \\\"Microsoft Defender Alert Evidence\\\",\\r\\n\\\"InsightsMetrics\\\" , \\\"Azure Monitor for VMs\\\",\\r\\n\\\"VMBoundPort\\\" , \\\"Azure Monitor for VMs\\\",\\r\\n\\\"VMComputer\\\" , \\\"Azure Monitor for VMs\\\",\\r\\n\\\"VMConnection\\\" , \\\"Azure Monitor for VMs\\\",\\r\\n\\\"VMProcess\\\" , \\\"Azure Monitor for VMs\\\",\\r\\n\\\"SecurityEvent\\\" , \\\"Windows Security Events\\\",\\r\\n\\\"StorageBlobLogs\\\" , \\\"Azure Storage\\\",\\r\\n\\\"StorageFileLogs\\\" , \\\"Azure Storage\\\",\\r\\n\\\"Syslog\\\" , \\\"Syslog/CEF\\\",\\r\\n\\\"SecurityIoTRawEvent\\\" , \\\"IoT Logs\\\",\\r\\n\\\"CommonSecurityLog\\\" , \\\"Syslog/CEF\\\",\\r\\n\\\"ThreatIntelligenceIndicator\\\" , \\\"Sentinel\\\",\\r\\n\\\"DnsEvents\\\" , \\\"DNS Logs\\\",\\r\\n\\\"DnsInventory\\\" , \\\"DNS Logs\\\",\\r\\n\\\"AWSCloudTrail\\\" , \\\"AWS Logs\\\",\\r\\n\\\"AWSVPCFlow\\\" , \\\"AWS Logs\\\",\\r\\n\\\"ConfigurationChange\\\" , \\\"Change Tracking\\\",\\r\\n\\\"ConfigurationData\\\" , \\\"Change Tracking\\\",\\r\\n\\\"AzureDiagnostics\\\" , \\\"Azure Resources\\\",\\r\\n\\\"AzureActivity\\\" , \\\"Azure Resources\\\",\\r\\n\\\"LAQueryLogs\\\" , \\\"Management\\\",\\r\\n\\\"SentinelHealth\\\" , \\\"Sentinel\\\",\\r\\n\\\"Perf\\\" , \\\"Performance\\\",\\r\\n\\\"AzureMetrics\\\" , \\\"Azure Metrics\\\",\\r\\n\\\"SecurityNestedRecommendation\\\" , \\\"Microsoft Defender for Cloud\\\",\\r\\n\\\"SecurityRecommendation\\\" , \\\"Microsoft Defender for Cloud\\\",\\r\\n\\\"SecurityRegulatoryCompliance\\\" , \\\"Microsoft Defender for Cloud\\\",\\r\\n\\\"SecureScoreControls\\\" , \\\"Microsoft Defender for Cloud\\\",\\r\\n\\\"SecurityBaseline\\\" , \\\"Microsoft Defender for Cloud\\\",\\r\\n\\\"SecureScores\\\" , \\\"Microsoft Defender for Cloud\\\",\\r\\n\\\"Update\\\" , \\\"Update Management\\\",\\r\\n\\\"UpdateSummary\\\" , \\\"Update Management\\\",\\r\\n\\\"DeviceTvmSecureConfigurationAssessment\\\" , \\\"Microsoft Defender Vuln. Management\\\",\\r\\n\\\"DeviceTvmSoftwareVulnerabilities\\\" , \\\"Microsoft Defender Vuln. Management\\\",\\r\\n\\\"DeviceTvmSoftwareInventory\\\" , \\\"Microsoft Defender Vuln. Management\\\",\\r\\n\\\"UrlClickEvents\\\" , \\\"Microsoft Defender for Office 365\\\",\\r\\n\\\"SecurityBaselineSummary\\\" , \\\"Microsoft Defender for Cloud\\\",\\r\\n\\\"AZFWThreatIntel\\\" , \\\"Firewall\\\",\\r\\n\\\"AWSGuardDuty\\\" , \\\"AWS Logs\\\",\\r\\n\\\"Watchlist\\\" , \\\"Sentinel\\\",\\r\\n\\\"HuntingBookmark\\\" , \\\"Sentinel\\\",\\r\\n\\\"SentinelAudit\\\" , \\\"Sentinel\\\",\\r\\n\\\"Operation\\\" , \\\"Log Management\\\",\\r\\n\\\"StorageTableLogs\\\" , \\\"Azure Storage\\\",\\r\\n\\\"AddonAzureBackupStorage\\\" , \\\"Azure Storage\\\",\\r\\n\\\"AddonAzureBackupPolicy\\\" , \\\"Azure Storage\\\",\\r\\n\\\"StorageQueueLogs\\\" , \\\"Azure Storage\\\",\\r\\n\\\"AddonAzureBackupProtectedInstance\\\" , \\\"Azure Storage\\\",\\r\\n\\\"AddonAzureBackupJobs\\\" , \\\"Azure Storage\\\"\\r\\n];\\r\\nlet customTables = Usage\\r\\n| where IsBillable == true\\r\\n| where DataType contains \\\"_CL\\\"\\r\\n| summarize size = sum(Quantity)/1024 by DataType\\r\\n| project ['Log Type'] = \\\"Custom Log\\\",['Table'] = DataType, ['Table Size'] = size, ['Estimated cost'] = size*4.3;\\r\\nlet AzDiagTables = AzureDiagnostics\\r\\n| summarize TotalIngestBytes=sum(_BilledSize) by Category\\r\\n| project ['Log Type'] = \\\"AzureDiagnostics\\\", ['Table'] = Category ,['Table Size'] = TotalIngestBytes/1024000000 , ['Estimated cost'] = (TotalIngestBytes/1024000000 ) * 4.3;\\r\\nlet knownTables = Usage\\r\\n| where IsBillable == true \\r\\n| where DataType <> \\\"AzureDiagnostics\\\"\\r\\n| join kind=leftouter Categories on $left.DataType == $right.Type\\r\\n| summarize size =sumif(Quantity, isnotempty(Category))/1024, sizeOther= sumif(Quantity,(isempty(Category) and DataType !contains \\\"_CL\\\"))/1024 by Category, DataType\\r\\n| project ['Log Type'] = iif(isnotempty( Category),Category,\\\"Other\\\"), ['Table'] = DataType, ['Table Size'] = iif(isnotempty( Category),size,sizeOther), ['Estimated cost'] = iif(isnotempty(Category),size*4.3,sizeOther*4.3);\\r\\nunion customTables, knownTables, AzDiagTables\\r\\n| sort by ['Estimated cost'] desc\",\"size\":2,\"title\":\"Breakdown of billable ingestion by log category in the last {TimeRange}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Log Type\",\"formatter\":5},{\"columnMatch\":\"Table\",\"formatter\":5},{\"columnMatch\":\"Table Size\",\"formatter\":3,\"formatOptions\":{\"palette\":\"greenRed\",\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":39,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"Estimated cost\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":0,\"options\":{\"currency\":\"USD\",\"style\":\"currency\"}}}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Log Type\"],\"finalBy\":\"Table\"}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Log Category\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Billed Size\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 2\"},{\"type\":1,\"content\":{\"json\":\"## Microsoft Sentinel benefit for Microsoft 365 E5, A5, F5 and G5 customers\\r\\n\\r\\nWith security information and event management (SIEM) and extended detection and response (XDR) from Microsoft, youre armed with the context and automation you need to stop sophisticated, cross-domain attacks across your entire organization. \\r\\n\\r\\nMicrosoft 365 E5, A5, F5, G5 and Microsoft 365 E5, A5, F5, G5 Security customers can get data grant up to 5MB per user/day of Microsoft 365 data ingestion into Microsoft Sentinel. <br>\\r\\nThe data sources included in this offer include:\\r\\n\\r\\n- Azure Active Directory (Azure AD) sign-in and audit logs\\r\\n- Microsoft Cloud App Security shadow IT discovery logs\\r\\n- Microsoft Information Protection logs\\r\\n- Microsoft 365 advanced hunting data\\r\\n\\r\\nThe data grant will be calculated at the end of the month and applied to your bill, covering the cost of up to 5 MB of data ingestion per user/day.\\r\\n\\r\\nVisit https://azure.microsoft.com/offers/sentinel-microsoft-365-offer/ for more information\\r\\n\\r\\n<br>\\r\\n\\r\\n### Below are the ingestion for the eligible data sources:\\r\\n\\r\\n_**Note:** Kindly specify **Total seats (E5/A5/F5/G5)** and **Ingestion Price** parameters for calculation._\"},\"name\":\"text - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Usage\\r\\n| where IsBillable == true\\r\\n| where DataType in (\\\"SigninLogs\\\", \\r\\n\\\"AuditLogs\\\", \\r\\n\\\"AADNonInteractiveUserSignInLogs\\\", \\r\\n\\\"AADServicePrincipalSignInLogs\\\",\\r\\n\\\"AADManagedIdentitySignInLogs\\\",\\r\\n\\\"AADProvisioningLogs\\\",\\r\\n\\\"ADFSSignInLogs\\\",\\r\\n\\\"McasShadowItReporting\\\", \\r\\n\\\"InformationProtectionLogs_CL\\\", \\r\\n\\\"DeviceEvents\\\", \\r\\n\\\"DeviceFileEvents\\\", \\r\\n\\\"DeviceImageLoadEvents\\\", \\r\\n\\\"DeviceInfo\\\", \\r\\n\\\"DeviceLogonEvents\\\", \\r\\n\\\"DeviceNetworkEvents\\\", \\r\\n\\\"DeviceNetworkInfo\\\", \\r\\n\\\"DeviceProcessEvents\\\", \\r\\n\\\"DeviceRegistryEvents\\\",\\r\\n\\\"DeviceFileCertificateInfo\\\", \\r\\n\\\"EmailAttachmentInfo\\\", \\r\\n\\\"EmailEvents\\\", \\r\\n\\\"EmailPostDeliveryEvents\\\", \\r\\n\\\"EmailUrlInfo\\\",\\r\\n\\\"IdentityLogonEvents\\\",\\r\\n\\\"IdentityQueryEvents\\\",\\r\\n\\\"IdentityDirectoryEvents\\\",\\r\\n\\\"AlertEvidence\\\",\\r\\n\\\"CloudAppEvents\\\"\\r\\n)  \\r\\n| summarize BillableDataGB = sum(Quantity) / 1000. by DataType\\r\\n| order by BillableDataGB desc\\r\\n\",\"size\":0,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"BillableDataGB\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\"}}]}},\"name\":\"query - 13\"},{\"type\":1,\"content\":{\"json\":\"<br>\\r\\n**Daily ingestion size (for eligible data sources) vs Maximum data grant:**\"},\"conditionalVisibilities\":[{\"parameterName\":\"TotalE5Seats\",\"comparison\":\"isNotEqualTo\",\"value\":\"0\"},{\"parameterName\":\"TotalE5Seats\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"text - DailyIngestionVsAllocation\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Usage\\r\\n| where IsBillable == true\\r\\n| where DataType in (\\\"SigninLogs\\\", \\r\\n\\\"AuditLogs\\\", \\r\\n\\\"AADNonInteractiveUserSignInLogs\\\", \\r\\n\\\"AADServicePrincipalSignInLogs\\\",\\r\\n\\\"AADManagedIdentitySignInLogs\\\",\\r\\n\\\"AADProvisioningLogs\\\",\\r\\n\\\"ADFSSignInLogs\\\",\\r\\n\\\"McasShadowItReporting\\\", \\r\\n\\\"InformationProtectionLogs_CL\\\", \\r\\n\\\"DeviceEvents\\\", \\r\\n\\\"DeviceFileEvents\\\", \\r\\n\\\"DeviceImageLoadEvents\\\", \\r\\n\\\"DeviceInfo\\\", \\r\\n\\\"DeviceLogonEvents\\\", \\r\\n\\\"DeviceNetworkEvents\\\", \\r\\n\\\"DeviceNetworkInfo\\\", \\r\\n\\\"DeviceProcessEvents\\\", \\r\\n\\\"DeviceRegistryEvents\\\",\\r\\n\\\"DeviceFileCertificateInfo\\\", \\r\\n\\\"EmailAttachmentInfo\\\", \\r\\n\\\"EmailEvents\\\", \\r\\n\\\"EmailPostDeliveryEvents\\\", \\r\\n\\\"EmailUrlInfo\\\",\\r\\n\\\"IdentityLogonEvents\\\",\\r\\n\\\"IdentityQueryEvents\\\",\\r\\n\\\"IdentityDirectoryEvents\\\",\\r\\n\\\"AlertEvidence\\\",\\r\\n\\\"CloudAppEvents\\\")  \\r\\n| summarize DailyIngestionGB = toreal(sum(Quantity))/ 1024  by format_datetime(TimeGenerated, 'yyyy-MM-dd') \\r\\n| extend MaxDataGrantGB  = ((5*toreal({TotalE5Seats}))/1024)\\r\\n| sort by TimeGenerated asc\\r\\n\",\"size\":0,\"aggregation\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"linechart\",\"chartSettings\":{\"xAxis\":\"TimeGenerated\",\"showDataPoints\":true,\"ySettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":3}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"TotalE5Seats\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"TotalE5Seats\",\"comparison\":\"isNotEqualTo\",\"value\":\"0\"}],\"name\":\"DailyIngestionVSAllocation\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Usage\\r\\n| where IsBillable == true\\r\\n| where DataType in (\\\"SigninLogs\\\", \\r\\n\\\"AuditLogs\\\", \\r\\n\\\"AADNonInteractiveUserSignInLogs\\\", \\r\\n\\\"AADServicePrincipalSignInLogs\\\",\\r\\n\\\"AADManagedIdentitySignInLogs\\\",\\r\\n\\\"AADProvisioningLogs\\\",\\r\\n\\\"ADFSSignInLogs\\\",\\r\\n\\\"McasShadowItReporting\\\", \\r\\n\\\"InformationProtectionLogs_CL\\\", \\r\\n\\\"DeviceEvents\\\", \\r\\n\\\"DeviceFileEvents\\\", \\r\\n\\\"DeviceImageLoadEvents\\\", \\r\\n\\\"DeviceInfo\\\", \\r\\n\\\"DeviceLogonEvents\\\", \\r\\n\\\"DeviceNetworkEvents\\\", \\r\\n\\\"DeviceNetworkInfo\\\", \\r\\n\\\"DeviceProcessEvents\\\", \\r\\n\\\"DeviceRegistryEvents\\\",\\r\\n\\\"DeviceFileCertificateInfo\\\", \\r\\n\\\"EmailAttachmentInfo\\\", \\r\\n\\\"EmailEvents\\\", \\r\\n\\\"EmailPostDeliveryEvents\\\", \\r\\n\\\"EmailUrlInfo\\\",\\r\\n\\\"IdentityLogonEvents\\\",\\r\\n\\\"IdentityQueryEvents\\\",\\r\\n\\\"IdentityDirectoryEvents\\\",\\r\\n\\\"AlertEvidence\\\",\\r\\n\\\"CloudAppEvents\\\"\\r\\n)  \\r\\n| summarize TotalBillableDataGB = sum(Quantity) / 1024\\r\\n\\r\\n\",\"size\":4,\"title\":\"Total ingestion\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"TotalBillableDataGB\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":39,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"E5IngestionSize\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let DailyMaxDiscountGB  = ((5*toreal({TotalE5Seats}))/1024);\\r\\nUsage\\r\\n| where IsBillable == true\\r\\n| where DataType in (\\\"SigninLogs\\\", \\r\\n\\\"AuditLogs\\\", \\r\\n\\\"AADNonInteractiveUserSignInLogs\\\", \\r\\n\\\"AADServicePrincipalSignInLogs\\\",\\r\\n\\\"AADManagedIdentitySignInLogs\\\",\\r\\n\\\"AADProvisioningLogs\\\",\\r\\n\\\"ADFSSignInLogs\\\",\\r\\n\\\"McasShadowItReporting\\\", \\r\\n\\\"InformationProtectionLogs_CL\\\", \\r\\n\\\"DeviceEvents\\\", \\r\\n\\\"DeviceFileEvents\\\", \\r\\n\\\"DeviceImageLoadEvents\\\", \\r\\n\\\"DeviceInfo\\\", \\r\\n\\\"DeviceLogonEvents\\\", \\r\\n\\\"DeviceNetworkEvents\\\", \\r\\n\\\"DeviceNetworkInfo\\\", \\r\\n\\\"DeviceProcessEvents\\\", \\r\\n\\\"DeviceRegistryEvents\\\",\\r\\n\\\"DeviceFileCertificateInfo\\\", \\r\\n\\\"EmailAttachmentInfo\\\", \\r\\n\\\"EmailEvents\\\", \\r\\n\\\"EmailPostDeliveryEvents\\\", \\r\\n\\\"EmailUrlInfo\\\",\\r\\n\\\"IdentityLogonEvents\\\",\\r\\n\\\"IdentityQueryEvents\\\",\\r\\n\\\"IdentityDirectoryEvents\\\",\\r\\n\\\"AlertEvidence\\\",\\r\\n\\\"CloudAppEvents\\\")  \\r\\n| summarize DailyBillableGB = toreal(sum(Quantity))/ 1024  by format_datetime(TimeGenerated, 'yy-MM-dd') \\r\\n| extend DailyMaxGrantGB = DailyMaxDiscountGB\\r\\n| summarize MaxDataGrantGB = sum(toreal(DailyMaxGrantGB))\\r\\n\\r\\n\",\"size\":4,\"title\":\"Total Data Grant Limit\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"MaxDataGrantGB\",\"formatter\":12,\"formatOptions\":{\"palette\":\"orangeBlue\"},\"numberFormat\":{\"unit\":39,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"TotalE5Seats\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"TotalE5Seats\",\"comparison\":\"isNotEqualTo\",\"value\":\"0\"}],\"customWidth\":\"20\",\"name\":\"DataGrantLimit\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let DailyMaxDiscountGB  = ((5*toreal({TotalE5Seats}))/1024);\\r\\nUsage\\r\\n| where IsBillable == true\\r\\n| where DataType in (\\\"SigninLogs\\\", \\r\\n\\\"AuditLogs\\\", \\r\\n\\\"AADNonInteractiveUserSignInLogs\\\", \\r\\n\\\"AADServicePrincipalSignInLogs\\\",\\r\\n\\\"AADManagedIdentitySignInLogs\\\",\\r\\n\\\"AADProvisioningLogs\\\",\\r\\n\\\"ADFSSignInLogs\\\",\\r\\n\\\"McasShadowItReporting\\\", \\r\\n\\\"InformationProtectionLogs_CL\\\", \\r\\n\\\"DeviceEvents\\\", \\r\\n\\\"DeviceFileEvents\\\", \\r\\n\\\"DeviceImageLoadEvents\\\", \\r\\n\\\"DeviceInfo\\\", \\r\\n\\\"DeviceLogonEvents\\\", \\r\\n\\\"DeviceNetworkEvents\\\", \\r\\n\\\"DeviceNetworkInfo\\\", \\r\\n\\\"DeviceProcessEvents\\\", \\r\\n\\\"DeviceRegistryEvents\\\",\\r\\n\\\"DeviceFileCertificateInfo\\\", \\r\\n\\\"EmailAttachmentInfo\\\", \\r\\n\\\"EmailEvents\\\", \\r\\n\\\"EmailPostDeliveryEvents\\\", \\r\\n\\\"EmailUrlInfo\\\",\\r\\n\\\"IdentityLogonEvents\\\",\\r\\n\\\"IdentityQueryEvents\\\",\\r\\n\\\"IdentityDirectoryEvents\\\",\\r\\n\\\"AlertEvidence\\\",\\r\\n\\\"CloudAppEvents\\\")  \\r\\n| summarize DailyBillableGB = toreal(sum(Quantity))/ 1024  by format_datetime(TimeGenerated, 'yy-MM-dd') \\r\\n| summarize TotalEligibleGB = sum(iif(toreal(DailyBillableGB)>toreal(DailyMaxDiscountGB),toreal(DailyMaxDiscountGB),DailyBillableGB))\\r\\n\\r\\n\",\"size\":4,\"title\":\"Total Data Grant Used\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"TotalEligibleGB\",\"formatter\":12,\"formatOptions\":{\"palette\":\"coldHot\"},\"numberFormat\":{\"unit\":39,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"TotalE5Seats\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"TotalE5Seats\",\"comparison\":\"isNotEqualTo\",\"value\":\"0\"}],\"customWidth\":\"30\",\"name\":\"EligibleE5Ingestion\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let DailyMaxDiscountGB  = ((5*toreal({TotalE5Seats}))/1024);\\r\\nUsage\\r\\n| where IsBillable == true\\r\\n| where DataType in (\\\"SigninLogs\\\", \\r\\n\\\"AuditLogs\\\", \\r\\n\\\"AADNonInteractiveUserSignInLogs\\\", \\r\\n\\\"AADServicePrincipalSignInLogs\\\",\\r\\n\\\"AADManagedIdentitySignInLogs\\\",\\r\\n\\\"AADProvisioningLogs\\\",\\r\\n\\\"ADFSSignInLogs\\\",\\r\\n\\\"McasShadowItReporting\\\", \\r\\n\\\"InformationProtectionLogs_CL\\\", \\r\\n\\\"DeviceEvents\\\", \\r\\n\\\"DeviceFileEvents\\\", \\r\\n\\\"DeviceImageLoadEvents\\\", \\r\\n\\\"DeviceInfo\\\", \\r\\n\\\"DeviceLogonEvents\\\", \\r\\n\\\"DeviceNetworkEvents\\\", \\r\\n\\\"DeviceNetworkInfo\\\", \\r\\n\\\"DeviceProcessEvents\\\", \\r\\n\\\"DeviceRegistryEvents\\\",\\r\\n\\\"DeviceFileCertificateInfo\\\", \\r\\n\\\"EmailAttachmentInfo\\\", \\r\\n\\\"EmailEvents\\\", \\r\\n\\\"EmailPostDeliveryEvents\\\", \\r\\n\\\"EmailUrlInfo\\\",\\r\\n\\\"IdentityLogonEvents\\\",\\r\\n\\\"IdentityQueryEvents\\\",\\r\\n\\\"IdentityDirectoryEvents\\\",\\r\\n\\\"AlertEvidence\\\",\\r\\n\\\"CloudAppEvents\\\")  \\r\\n| summarize DailyBillableGB = toreal(sum(Quantity))/ 1024  by format_datetime(TimeGenerated, 'yy-MM-dd') \\r\\n| summarize TotalEligibleGB = sum(iif(toreal(DailyBillableGB)>toreal(DailyMaxDiscountGB),toreal(DailyMaxDiscountGB),DailyBillableGB))\\r\\n| extend TotalDiscount = toreal(TotalEligibleGB)*{Price}\\r\\n| project TotalDiscount\\r\\n\\r\\n\",\"size\":4,\"title\":\"Estimated Saving\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"TotalDiscount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"currency\":\"USD\",\"style\":\"currency\",\"maximumFractionDigits\":2}}},\"showBorder\":false}},\"conditionalVisibilities\":[{\"parameterName\":\"TotalE5Seats\",\"comparison\":\"isNotEqualTo\",\"value\":\"0\"},{\"parameterName\":\"TotalE5Seats\",\"comparison\":\"isNotEqualTo\"}],\"customWidth\":\"20\",\"name\":\"EstimateE5Discount\"},{\"type\":1,\"content\":{\"json\":\"## SOAR summary\\r\\n\\r\\nIn this section, you can view billable information regarding your Logic Apps. The data is based on Logic Apps' built-in metrics. To view the list of Logic Apps click the \\\">\\\" icon in the subscription column.\\r\\n\\r\\nYou can change the default Logic App execution cost in the parameter below.\\r\\n\\r\\nTo see the approximate cost of your logic apps, **click on any subscription on the table below**.\\r\\n\\r\\nFor more billable information, visit: https://azure.microsoft.com/pricing/details/logic-apps/\"},\"name\":\"text - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"6f50ee54-8f0e-424e-9e16-70eca531af7f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ResourceTypes\",\"label\":\"Resource types\",\"type\":7,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"microsoft.logic/workflows\"],\"isHiddenWhenLocked\":true,\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"includeAll\":true},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"1c8dc8da-2233-426c-8cfc-52ec31bf1e84\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"label\":\"Subscriptions\",\"type\":6,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"Resources\\r\\n| where type in~ ({ResourceTypes})\\r\\n| summarize Count = count() by subscriptionId\\r\\n| order by Count desc\\r\\n| extend Rank = row_number()\\r\\n| project value = subscriptionId, label = subscriptionId, selected = Rank == 1\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"value::all\"]},{\"id\":\"f103ef04-042e-45ed-8f78-b31e676258d7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ResourceGroups\",\"label\":\"Resource groups\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"Resources\\r\\n| where type in~ ({ResourceTypes})\\r\\n| summarize Count = count() by subscriptionId, resourceGroup\\r\\n| order by Count desc\\r\\n| extend Rank = row_number()\\r\\n| project value = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup), label = resourceGroup, selected = false\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"value::all\"]},{\"id\":\"b6514d02-8893-44b8-896e-e53ada5024d5\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Resources\",\"label\":\"Logic Apps\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"Resources\\r\\n| where type in~({ResourceTypes})\\r\\n| extend resourceGroupId = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup)\\r\\n| where resourceGroupId in~({ResourceGroups}) or '*' in~({ResourceGroups})\\r\\n| order by name asc\\r\\n| extend Rank = row_number()\\r\\n| project value = id, label = tostring(name), selected = Rank <= 10, group = resourceGroup\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"8f552e99-2d30-4679-b4b0-25429bf0216b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ExecutionCost\",\"label\":\"Logic App execution cost\",\"type\":1,\"isRequired\":true,\"value\":\"0.000125\"}],\"style\":\"pills\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 10\"},{\"type\":10,\"content\":{\"chartId\":\"workbooke70b7cbc-f1d7-4a74-b8b9-75cc8d5ab586\",\"version\":\"MetricsItem/2.0\",\"size\":1,\"chartType\":0,\"resourceType\":\"microsoft.logic/workflows\",\"metricScope\":0,\"resourceParameter\":\"Resources\",\"resourceIds\":[\"{Resources}\"],\"timeContextFromParameter\":\"TimeRange\",\"timeContext\":{\"durationMs\":0},\"metrics\":[{\"namespace\":\"microsoft.logic/workflows\",\"metric\":\"microsoft.logic/workflows--TotalBillableExecutions\",\"aggregation\":1}],\"title\":\"Click on a subscription below to calculate the estimated automation costs\",\"resourceLimit\":10000,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":\"\",\"showIcon\":true,\"customColumnWidthSetting\":\"10fr\"}},{\"columnMatch\":\"Subscription\",\"formatter\":5},{\"columnMatch\":\"Name\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true,\"customColumnWidthSetting\":\"10fr\"}},{\"columnMatch\":\"microsoft.logic/workflows--TotalBillableExecutions\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"aggregation\":\"Sum\",\"customColumnWidthSetting\":\"15fr\"}},{\"columnMatch\":\"microsoft.logic/workflows--TotalBillableExecutions Timeline\",\"formatter\":21,\"formatOptions\":{\"palette\":\"blue\",\"customColumnWidthSetting\":\"15fr\"}},{\"columnMatch\":\"microsoft.logic/workflows--BillableTriggerExecutions Timeline\",\"formatter\":5},{\"columnMatch\":\"microsoft.logic/workflows--BillableActionExecutions\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"microsoft.logic/workflows--BillableActionExecutions Timeline\",\"formatter\":5},{\"columnMatch\":\"RG\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"\",\"showIcon\":true}},{\"columnMatch\":\"Sum\",\"formatter\":1,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"}}}],\"rowLimit\":10000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Subscription\"]},\"labelSettings\":[{\"columnId\":\"microsoft.logic/workflows--TotalBillableExecutions\",\"label\":\"Total Billable Executions (Sum)\"},{\"columnId\":\"microsoft.logic/workflows--TotalBillableExecutions Timeline\",\"label\":\"Total Billable Executions Timeline\"}]},\"sortBy\":\"[]\",\"exportFieldName\":\"microsoft.logic/workflows--TotalBillableExecutions\",\"exportParameterName\":\"Total\",\"exportDefaultValue\":\"0\"},\"customWidth\":\"60\",\"name\":\"Billable Metric\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Usage | take 1 | project ['Estimated automation costs'] ={Total}*{ExecutionCost}\",\"size\":4,\"title\":\"Estimated Logic App execution cost over the last {TimeRange}\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Estimated automation costs\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"currency\":\"USD\",\"style\":\"currency\",\"minimumFractionDigits\":2,\"maximumFractionDigits\":3}}},\"showBorder\":false}},\"conditionalVisibility\":{\"parameterName\":\"Total\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 11\"}],\"fromTemplateId\":\"sentinel-CostWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId5'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=AzureSentinelCost; logoFileName=Azure_Sentinel.svg; description=This workbook provides an estimated cost across the main billed items in Microsoft Sentinel: ingestion, retention and automation. It also provides insight about the possible impact of the Microsoft 365 E5 offer.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.5.1; title=Microsoft Sentinel Cost; templateRelativePath=AzureSentinelCost.json; subtitle=; provider=Microsoft Sentinel Community}.description",
                "parentId": "[variables('workbookId5')]",
                "contentId": "[variables('_workbookContentId5')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "Usage",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId5')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook5-name')]",
        "contentProductId": "[variables('_workbookcontentProductId5')]",
        "id": "[variables('_workbookcontentProductId5')]",
        "version": "[variables('workbookVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AzureSentinelSecurityAlertsWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId6')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Security Alerts dashboard for alerts in your Microsoft Sentinel environment."
              },
              "properties": {
                "displayName": "[parameters('workbook6-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Security Alerts Dashboard\\n---\\n\\nThis dashboard shows Azure Sentinel Security Alerts data by various views.\\n\\nNote: Not all Security Alerts are Incidients\\n\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"08f97f34-6264-4fa3-90b5-16b89422d285\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":1209600000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]}},{\"id\":\"cd98a9c7-5dbd-4f92-a967-7ed1c781132a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AlertSeverity\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityAlert\\r\\n| summarize Count = count() by AlertSeverity\\r\\n| order by Count desc, AlertSeverity asc\\r\\n| project Value = AlertSeverity, Label = strcat(AlertSeverity, ' - ', Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"df0fbc31-ade1-4488-9109-a4f647ad8fe2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ProductName\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityAlert\\r\\n| summarize Count = count() by ProductName\\r\\n| order by Count desc, ProductName asc\\r\\n| project Value = ProductName, Label = strcat(ProductName, ' - ', Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = SecurityAlert\\n| where \\\"{AlertSeverity:lable}\\\" == \\\"All\\\" or AlertSeverity in ({AlertSeverity})\\n| where \\\"{ProductName:lable}\\\" == \\\"All\\\" or ProductName in ({ProductName});\\ndata\\n| summarize Count = count() by AlertSeverity\\n| join kind = inner (data\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by AlertSeverity)\\n on AlertSeverity\\n | project-away TimeGenerated\\n| extend AlertSeveritys = AlertSeverity\\n| union (\\n data \\n | summarize Count = count() \\n | extend jkey = 1\\n | join kind=inner (data\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\n | extend jkey = 1) on jkey\\n | extend AlertSeverity = 'All', AlertSeveritys = '*' \\n)\\n| extend Severity = iif(AlertSeverity == \\\"All\\\", 0,iif(AlertSeverity == \\\"High\\\", 1, iif(AlertSeverity == \\\"Medium\\\", 2, iif(AlertSeverity == \\\"Low\\\", 3, 4))))\\n| order by Severity asc\\n\",\"size\":3,\"title\":\"Security Alerts by Severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"AlertSeverity\",\"exportParameterName\":\"AlertSeverityPicker\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"AlertSeverity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":1}},\"name\":\"SecurityAlertsbySeverity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = SecurityAlert\\r\\n| where \\\"{AlertSeverity:lable}\\\" == \\\"All\\\" or AlertSeverity in ({AlertSeverity})\\r\\n| where \\\"{ProductName:lable}\\\" == \\\"All\\\" or ProductName in ({ProductName})\\r\\n| where AlertSeverity == '{AlertSeverityPicker}' or '{AlertSeverityPicker}' == \\\"All\\\";\\r\\ndata\\r\\n| summarize Count = count() by ProductName\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ProductName)\\r\\n on ProductName\\r\\n | project-away TimeGenerated\\r\\n| extend ProductNames = ProductName\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend ProductName = 'All', ProductNames = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n\",\"size\":3,\"title\":\"Security Alerts by Product\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"ProductName\",\"exportParameterName\":\"ProductNamePicker\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"ProductName\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"name\":\"SecurityAlertsbyProduct\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where \\\"{AlertSeverity:lable}\\\" == \\\"All\\\" or AlertSeverity in ({AlertSeverity})\\r\\n| where \\\"{ProductName:lable}\\\" == \\\"All\\\" or ProductName in ({ProductName})\\r\\n| where AlertSeverity == '{AlertSeverityPicker}' or '{AlertSeverityPicker}' == \\\"All\\\"\\r\\n| where ProductName == '{ProductNamePicker}' or '{ProductNamePicker}' == \\\"All\\\"\\r\\n| summarize count() by AlertSeverity, bin(TimeGenerated, 1d)\",\"size\":3,\"title\":\"Security Alerts Over Time by Severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Informational\",\"color\":\"gray\"},{\"seriesName\":\"High\",\"color\":\"red\"}]}},\"name\":\"SecurityAlertsOverTimebySeverity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where \\\"{AlertSeverity:lable}\\\" == \\\"All\\\" or AlertSeverity in ({AlertSeverity})\\r\\n| where \\\"{ProductName:lable}\\\" == \\\"All\\\" or ProductName in ({ProductName})\\r\\n| where AlertSeverity == '{AlertSeverityPicker}' or '{AlertSeverityPicker}' == \\\"All\\\"\\r\\n| where ProductName == '{ProductNamePicker}' or '{ProductNamePicker}' == \\\"All\\\"\\r\\n| summarize count() by ProductName, bin(TimeGenerated, 1d)\",\"size\":3,\"title\":\"Security Alerts Over Time by Product\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Informational\",\"color\":\"gray\"},{\"seriesName\":\"High\",\"color\":\"red\"}]}},\"name\":\"SecurityAlertsOverTimebyProduct\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where \\\"{AlertSeverity:lable}\\\" == \\\"All\\\" or AlertSeverity in ({AlertSeverity})\\r\\n| where \\\"{ProductName:lable}\\\" == \\\"All\\\" or ProductName in ({ProductName})\\r\\n| where AlertSeverity == '{AlertSeverityPicker}' or '{AlertSeverityPicker}' == \\\"All\\\"\\r\\n| where ProductName == '{ProductNamePicker}' or '{ProductNamePicker}' == \\\"All\\\"\\r\\n| extend Entities = iff(isempty(Entities), todynamic('[{\\\"dummy\\\" : \\\"\\\"}]'), todynamic(Entities))\\r\\n| mvexpand Entities\\r\\n| evaluate bag_unpack(Entities, \\\"Entity_\\\")\\r\\n| extend Entity_Type = columnifexists(\\\"Entity_Type\\\", \\\"\\\")\\r\\n| extend Entity_Name = columnifexists(\\\"Entity_Name\\\", \\\"\\\")\\r\\n| extend Entity_ResourceId = columnifexists(\\\"Entity_ResourceId\\\", \\\"\\\")\\r\\n| extend Entity_Directory = columnifexists(\\\"Entity_Directory\\\", \\\"\\\")\\r\\n| extend Entity_Value = columnifexists(\\\"Entity_Value\\\", \\\"\\\")\\r\\n| extend Entity_HostName = columnifexists(\\\"Entity_HostName\\\", \\\"\\\")\\r\\n| extend Entity_Address = columnifexists(\\\"Entity_Address\\\", \\\"\\\")\\r\\n| extend Entity_ProcessId = columnifexists(\\\"Entity_ProcessId\\\", \\\"\\\")\\r\\n| extend Entity_Url = columnifexists(\\\"Entity_Url\\\", \\\"\\\")\\r\\n| extend Target = iif(Entity_Type == \\\"account\\\", Entity_Name, iif(Entity_Type == \\\"azure-resource\\\", Entity_ResourceId, iif(Entity_Type == \\\"cloud-application\\\", Entity_Name, iif(Entity_Type == \\\"dns\\\", Entity_Name, iif(Entity_Type == \\\"file\\\", strcat(Entity_Directory, \\\"\\\\\\\\\\\", Entity_Name), iif(Entity_Type == \\\"filehash\\\", Entity_Value, iif(Entity_Type == \\\"host\\\", Entity_HostName, iif(Entity_Type == \\\"ip\\\" , Entity_Address, iif(Entity_Type == \\\"malware\\\", Entity_HostName, iif(Entity_Type == \\\"network-connection\\\", Entity_Name, iif(Entity_Type == \\\"process\\\", Entity_ProcessId, iif(Entity_Type == \\\"registry-key\\\", Entity_Name, iif(Entity_Type == \\\"registry-value\\\", Entity_Name, iif(Entity_Type == \\\"security-group\\\", Entity_Name, iif(Entity_Type == \\\"url\\\", Entity_Url, \\\"NoTarget\\\")))))))))))))))\\r\\n| where Entity_Type in (\\\"account\\\", \\\"host\\\", \\\"ip\\\", \\\"url\\\", \\\"azure-resource\\\", \\\"cloud-application\\\", \\\"dns\\\", \\\"file\\\", \\\"filehash\\\", \\\"malware\\\", \\\"network-connection\\\", \\\"process\\\", \\\"registry-key\\\", \\\"registry-value\\\", \\\"security-group\\\")\\r\\n| summarize count() by bin(TimeGenerated, 1d), Target, Entity_Type\\r\\n| project-away TimeGenerated\\r\\n| order by count_ desc\\r\\n\\r\\n\",\"size\":0,\"title\":\"Top Entities in Security Alerts\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"TopEntitiesinSecurityAlerts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where \\\"{AlertSeverity:lable}\\\" == \\\"All\\\" or AlertSeverity in ({AlertSeverity})\\r\\n| where \\\"{ProductName:lable}\\\" == \\\"All\\\" or ProductName in ({ProductName})\\r\\n| where AlertSeverity == '{AlertSeverityPicker}' or '{AlertSeverityPicker}' == \\\"All\\\"\\r\\n| where ProductName == '{ProductNamePicker}' or '{ProductNamePicker}' == \\\"All\\\"\\r\\n| extend Entities = iff(isempty(Entities), todynamic('[{\\\"dummy\\\" : \\\"\\\"}]'), todynamic(Entities))\\r\\n| mvexpand Entities\\r\\n| evaluate bag_unpack(Entities, \\\"Entity_\\\")\\r\\n| extend Entity_Type = columnifexists(\\\"Entity_Type\\\", \\\"\\\")\\r\\n| where Entity_Type in (\\\"account\\\", \\\"alerts\\\", \\\"azure-resource\\\", \\\"cloud-application\\\", \\\"dns\\\", \\\"file\\\", \\\"filehash\\\", \\\"host\\\", \\\"host-logon-session\\\", \\\"ip\\\", \\\"malware\\\", \\\"network-connection\\\", \\\"process\\\", \\\"registry-key\\\", \\\"registry-value\\\", \\\"security-group\\\", \\\"SrvSvcSessionEntry\\\", \\\"url\\\")\\r\\n| summarize count() by Entity_Type\\r\\n| order by count_ desc\",\"size\":0,\"title\":\"Count of Entities in Security Alerts by Type\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\"},\"name\":\"CountofEntitiesinSecurityAlertsbyType\"}],\"fromTemplateId\":\"sentinel-AzureSentinelSecurityAlerts\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId6'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=AzureSentinelSecurityAlertsWorkbook; logoFileName=Azure_Sentinel.svg; description=Security Alerts dashboard for alerts in your Microsoft Sentinel environment.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.1.0; title=Security Alerts; templateRelativePath=AzureSentinelSecurityAlerts.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId6')]",
                "contentId": "[variables('_workbookContentId6')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "SecurityAlert",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId6')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook6-name')]",
        "contentProductId": "[variables('_workbookcontentProductId6')]",
        "id": "[variables('_workbookcontentProductId6')]",
        "version": "[variables('workbookVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "IncidentOverviewWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId7')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "The Incident Overview workbook is designed to assist in triaging and investigation by providing in-depth information about the incident, including:\r\n* General information\r\n* Entity data\r\n* Triage time (time between incident creation and first response)\r\n* Mitigation time (time between incident creation and closing)\r\n* Comments\r\n\r\nCustomize this workbook by saving and editing it. \r\nYou can reach this workbook template from the incidents panel as well. Once you have customized it, the link from the incident panel will open the customized workbook instead of the template.\r\n"
              },
              "properties": {
                "displayName": "[parameters('workbook7-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Incident Overview\"},\"customWidth\":\"35\",\"name\":\"Headline\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"9a199167-2dde-49dd-8f01-23e9d1fa8151\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"InternalWSs\",\"type\":1,\"isRequired\":true,\"query\":\"SecurityIncident\\r\\n| take 1\\r\\n| parse IncidentUrl with * \\\"/workspaces/\\\" Workspace \\\"/\\\" *\\r\\n| project Workspace\",\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"7806fefd-432f-4828-9756-8c0be5c08d07\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"InternalSub\",\"type\":1,\"isRequired\":true,\"query\":\"SecurityIncident\\r\\n| take 1\\r\\n| parse IncidentUrl with * \\\"/subscriptions/\\\" subscriptions \\\"/\\\" *\\r\\n| project subscriptions\",\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"55d3ab63-6e1f-4d02-8d9e-2225526689c7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"isRequired\":true,\"query\":\"summarize by subscriptionId\\r\\n| project subscriptionId, Subscription=strcat(\\\"/subscriptions/\\\", subscriptionId)\\r\\n| extend selected = iff(subscriptionId =~ '{InternalSub}', true, false)\\r\\n\",\"crossComponentResources\":[\"value::all\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":\"\"},{\"id\":\"95a45501-31b5-4ea2-bcb3-eb208e0080e2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"//resources | where type =~ 'Microsoft.operationsmanagement/solutions' | where name contains //'SecurityInsights' | project id //= tostring(properties.workspaceResourceId)\\r\\n\\r\\nwhere type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| project value =id, label = name, selected = iff(name =~ '{InternalWSs}', true, false)\\r\\n\\r\\n\\r\\n\",\"crossComponentResources\":[\"value::all\"],\"typeSettings\":{\"showDefault\":false},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"7d597ad7-4a2a-45ed-a4fe-7ee32de0fc22\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Incident Creation Time\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000}],\"allowCustom\":true}},{\"id\":\"3a87d4f7-42cc-4c62-b543-6b5d9ab8cf27\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Severity\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| summarize Count = count(IncidentNumber) by Severity\\r\\n| project Value = Severity, Label = strcat(Severity, \\\": \\\", Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"81085d3a-5aca-488e-b7c6-ecf1167e59f7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Tactics\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend Tactics = todynamic(AdditionalData.tactics)\\r\\n| mv-expand Tactics to typeof(string)\\r\\n| summarize Count=count(IncidentNumber) by Tactics\\r\\n| project Value = Tactics, Label = strcat(Tactics, \\\": \\\", Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"0f9efb0d-ac34-41d0-8a19-165840eb2a71\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Owner\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend owner = tostring(Owner.assignedTo) \\r\\n| summarize Count=count(IncidentNumber) by Owner= case(owner==\\\"\\\", \\\"Unassigned\\\",owner)\\r\\n| project Value = Owner, Label = strcat(Owner, \\\": \\\", Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"cf86113b-59ad-4fc9-aeb7-9b44e230641e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Product\",\"label\":\"Product Name\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend Product = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0]) \\r\\n| summarize Count=count(IncidentNumber) by Product\\r\\n| project Value = Product, Label = strcat(Product, \\\": \\\", Count)\\r\\n\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"1fea48e7-99b2-4664-8eb6-bd35fc4efaf0\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"resourceGroup\",\"type\":1,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| where id == \\\"{Workspace:lable}\\\"\\r\\n| project resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"2908f26a-6238-43ed-9aa0-546c9041d918\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"label\":\"Show Help\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"jsonData\":\"[{ \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true }]\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"100\",\"name\":\"parameters - 6\"},{\"type\":1,\"content\":{\"json\":\"The Incident Overview workbook is designed to assist in triaging and investigation by providing in-depth information about the incident, including:\\r\\n* General information\\r\\n* Entity data\\r\\n* Triage time (time between incident creation and first response)\\r\\n* Mitigation time (time between incident creation and closing)\\r\\n* Comments\\r\\n* Remediation information from the Alerts or from a Watchlist - setup readme: https://github.com/Azure/Azure-Sentinel/wiki/SOC-Process-Framework\\r\\n\\r\\nCustomize this workbook by saving and editing it. \\r\\nYou can reach this workbook template from the incidents panel as well. Once you have customized it, the link from the incident panel will open the customized workbook instead of the template.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"customWidth\":\"100\",\"name\":\"Info\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"9aec751b-07bd-43ba-80b9-f711887dce45\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IncidentNumber\",\"label\":\"Incident Number\",\"type\":1,\"isRequired\":true,\"value\":\"\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\"},{\"id\":\"9ef1a34d-5c8e-42ad-b1d7-1353e0091060\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"testRemediation\",\"type\":1,\"isRequired\":true,\"query\":\"SecurityIncident\\r\\n| where IncidentNumber == '{IncidentNumber:value}' \\r\\n| summarize arg_max(LastModifiedTime,*) by tostring(IncidentNumber)\\r\\n| extend Alerts = extract(\\\"\\\\\\\\[(.*?)\\\\\\\\]\\\", 1, tostring(AlertIds))\\r\\n| mv-expand AlertIds to typeof(string)\\r\\n| join \\r\\n(\\r\\n    SecurityAlert\\r\\n    | extend Remediation_ = parse_json(RemediationSteps)\\r\\n    | mv-expand Remediation_\\r\\n) on $left.AlertIds == $right.SystemAlertId\\r\\n| summarize  Remediation=make_set(tostring(Remediation_)) by IncidentNumber, Title, Severity\\r\\n| mv-expand Remediation to typeof(string)\\r\\n| project value=iif(isempty(Remediation),'0','1')\",\"crossComponentResources\":[\"{Workspace}\"],\"isHiddenWhenLocked\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"e5d4131c-43a9-4f92-87c9-dbf647530c9c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"watchListExists\",\"type\":1,\"isRequired\":true,\"query\":\"_GetWatchlist('SocRA')\\r\\n| limit 1\",\"crossComponentResources\":[\"{Workspace}\"],\"isHiddenWhenLocked\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 6 - Copy\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"f978edb2-9886-4bff-8e12-8280800321c3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IncidentID\",\"label\":\"Incident Name\",\"type\":1,\"query\":\"SecurityIncident\\r\\n| where IncidentNumber == {IncidentNumber}\\r\\n| take 1\\r\\n| project IncidentName\\r\\n\",\"crossComponentResources\":[\"{Workspace}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"3b8e6cdd-4578-49cb-a515-1f9dec104fd7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"RuleId\",\"label\":\"Rule Id\",\"type\":1,\"query\":\"SecurityIncident\\r\\n| where IncidentNumber == {IncidentNumber}\\r\\n| summarize arg_max(TimeGenerated, RelatedAnalyticRuleIds) by IncidentNumber\\r\\n| project RelatedAnalyticRuleIds\",\"crossComponentResources\":[\"{Workspace}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"IncidentNumber\",\"comparison\":\"isEqualTo\",\"value\":\"e\"},\"customWidth\":\"50\",\"name\":\"Invisible parameters\"},{\"type\":1,\"content\":{\"json\":\"## General Incident Information \"},\"customWidth\":\"67\",\"name\":\"Headline - general info\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let incidentNumberToCheck = '{IncidentNumber}';\\r\\nlet incidentWithNoAlertsQuery = SecurityIncident\\r\\n| where IncidentNumber == incidentNumberToCheck\\r\\n| summarize arg_max(TimeGenerated,CreatedTime,Status, Severity, Owner, AdditionalData, IncidentUrl, Comments, Classification,ClassificationReason, ClassificationComment,Labels, Title, AlertIds) by IncidentNumber\\r\\n| where array_length(AlertIds) == 0\\r\\n| where Severity in ({Severity}) or '{Severity:label}' == \\\"All\\\"\\r\\n| extend Tactics = todynamic(AdditionalData.tactics)\\r\\n| extend Owner = todynamic(Owner.assignedTo), IncidentCreated = format_datetime(CreatedTime,'yy-MM-dd HH:mm')\\r\\n| where Owner in ({Owner}) or '{Owner:label}' == \\\"All\\\"\\r\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0]))\\r\\n| where Product in ({Product}) or '{Product:label}' == \\\"All\\\"\\r\\n| extend Tags = extract_all('labelName\\\":\\\"(.*?)\\\"',tostring(Labels))\\r\\n| extend Owner = case(tostring(Owner)==\\\"\\\", \\\"Unassigned\\\",tostring(Owner)), Products = strcat_array(AdditionalData.alertProductNames, \\\", \\\"), Alerts = tostring(AdditionalData.alertsCount), Bookmarks = tostring(AdditionalData.bookmarksCount), Comments = tostring(AdditionalData.commentsCount), Tactics = strcat_array(AdditionalData.tactics, \\\", \\\"), Labels = strcat_array(Tags, \\\", \\\")\\r\\n;\\r\\nlet incidentWithAlertsQuery = SecurityIncident\\r\\n| where IncidentNumber ==  incidentNumberToCheck\\r\\n| summarize arg_max(TimeGenerated,CreatedTime,Status, Severity, Owner, AdditionalData, IncidentUrl, Comments, Classification,ClassificationReason, ClassificationComment,Labels, Title, AlertIds) by IncidentNumber\\r\\n| where array_length(AlertIds) > 0\\r\\n| where Severity in ({Severity}) or '{Severity:label}' == \\\"All\\\"\\r\\n| extend Tactics = todynamic(AdditionalData.tactics)\\r\\n| extend Owner = todynamic(Owner.assignedTo), IncidentCreated = format_datetime(CreatedTime,'yy-MM-dd HH:mm')\\r\\n| where Owner in ({Owner}) or '{Owner:label}' == \\\"All\\\"\\r\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0]))\\r\\n| where Product in ({Product}) or '{Product:label}' == \\\"All\\\"\\r\\n| extend Tags = extract_all('labelName\\\":\\\"(.*?)\\\"',tostring(Labels))\\r\\n| extend Owner = case(tostring(Owner)==\\\"\\\", \\\"Unassigned\\\",tostring(Owner)), Products = strcat_array(AdditionalData.alertProductNames, \\\", \\\"), Alerts = tostring(AdditionalData.alertsCount), Bookmarks = tostring(AdditionalData.bookmarksCount), Comments = tostring(AdditionalData.commentsCount), Tactics = strcat_array(AdditionalData.tactics, \\\", \\\"), Labels = strcat_array(Tags, \\\", \\\")\\r\\n| mv-expand AlertIds to typeof(string)\\r\\n| join kind=leftouter\\r\\n(SecurityAlert\\r\\n| summarize arg_max(TimeGenerated,AlertName, Description, AlertType, Entities) by SystemAlertId) on $left.AlertIds == $right.SystemAlertId\\r\\n| summarize AlertName = makelist(AlertName), AlertType = makelist(AlertType) by Comments, Labels, Title, Products, AlertsCount = Alerts, Bookmarks, Status, Severity, Owner, IncidentCreated, ClassificationComment, Classification, ClassificationReason\\r\\n| extend AlertNames = strcat_array(AlertName, \\\", \\\"), AlertTypes = strcat_array(AlertType, \\\", \\\")\\r\\n;\\r\\nincidentWithNoAlertsQuery\\r\\n| union incidentWithAlertsQuery\\r\\n| project packed = pack_all()\\r\\n| mv-expand packed\\r\\n| parse tostring(packed) with * '\\\"' Field '\\\":\\\"' Value '\\\"}'\\r\\n| where Field in ('Severity', 'Owner','Status', 'AlertsCount','Products','Title', 'IncidentCreated', 'Labels','Bookmarks', 'AlertNames', 'AlertsType', 'Classification','ClassificationComment','ClassificationReason')\\r\\n| extend Field1 = case(Field== \\\"IncidentCreated\\\", \\\"Time created\\\", Field == \\\"AlertsCount\\\", \\\"Alert count\\\", Field == \\\"ClassificationComment\\\", \\\"Classification Comment\\\", Field == \\\"ClassificationReason\\\", \\\"Classification Reason\\\", Field == \\\"AlertNames\\\", \\\"Alert Names\\\", Field)\\r\\n| extend Order = case(Field==\\\"Title\\\", 1,Field==\\\"IncidentCreated\\\", 2,Field==\\\"Severity\\\", 3,Field==\\\"Status\\\", 4,Field==\\\"Owner\\\", 5,Field==\\\"Products\\\", 6,Field==\\\"AlertsType\\\",6,Field==\\\"AlertsCount\\\", 7,Field==\\\"Bookmarks\\\", 8, Field==\\\"Labels\\\", 9,Field==\\\"Classification\\\", 10,Field==\\\"ClassificationReason\\\",11, 100)\",\"size\":0,\"noDataMessage\":\"Enter an incident number\",\"noDataMessageStyle\":5,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Field1\",\"formatter\":1,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},\"leftContent\":{\"columnMatch\":\"Value\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"New\",\"representation\":\"blue\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Active\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Closed\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"text\":\"{0}{1}\"}]}},\"secondaryContent\":{\"columnMatch\":\"Remediation_\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\"}},\"showBorder\":false,\"sortCriteriaField\":\"Order\",\"sortOrderField\":1,\"size\":\"auto\"}},\"customWidth\":\"67\",\"name\":\"general info\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Closing Classifications of Similar Incidents\"},\"name\":\"Headline - classification\"},{\"type\":1,\"content\":{\"json\":\"Closing classifications of incidents that where created from the same rule in the past month\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Info - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let alertText =  strcat_array(dynamic([{RuleId}]),\\\",\\\");\\r\\nlet getAmountOfIncidentForRuleId = (classification:string){\\r\\n    SecurityIncident\\r\\n    | where TimeGenerated >= ago(30d)\\r\\n    | where Classification == classification\\r\\n    | mv-expand AlertId=AlertIds\\r\\n    | extend AlertId=tostring(AlertId)\\r\\n    | join  (SecurityAlert| where TimeGenerated >=ago(30d)) on $left.AlertId==$right.SystemAlertId\\r\\n    | mv-expand RuleId=RelatedAnalyticRuleIds\\r\\n    | extend RuleId=iff(ProductName!= 'Azure Sentinel', ProductName,RuleId)\\r\\n    | summarize counter=count() by RuleIdentifier=tostring(RuleId)\\r\\n    | extend RuleId=RuleIdentifier\\r\\n    | project-away RuleIdentifier\\r\\n};\\r\\nlet falsePositiveClassificationTable = getAmountOfIncidentForRuleId(\\\"FalsePositive\\\") | extend FalsePositiveCounter=counter | project-away counter;\\r\\nlet undeterminedClassificationTable = getAmountOfIncidentForRuleId(\\\"Undetermined\\\") | extend UndeterminedCounter=counter | project-away counter;\\r\\nlet benignPositiveClassificationTable = getAmountOfIncidentForRuleId(\\\"BenignPositive\\\") | extend BenignPositiveCounter=counter | project-away counter;\\r\\nlet truePositiveClassificationTable = getAmountOfIncidentForRuleId(\\\"TruePositive\\\") | extend TruePositiveCounter=counter | project-away counter;\\r\\nlet closedIncidentTable = SecurityIncident| where TimeGenerated >= ago(30d) |where Status == \\\"Closed\\\" | mv-expand AlertId=AlertIds| extend AlertId=tostring(AlertId)| join  SecurityAlert on $left.AlertId==$right.SystemAlertId| mv-expand RelatedAnalyticRuleIds| extend RuleId= iff(ProductName == 'Azure Sentinel', tostring(RelatedAnalyticRuleIds), ProductName);\\r\\nlet joinByRuleId = (T:(RuleId:string), S:(RuleId:string)){\\r\\n    T \\r\\n    | join kind=fullouter S on $left.RuleId == $right.RuleId\\r\\n    | extend RuleId= iff(RuleId == '', RuleId1,RuleId)\\r\\n    | project-away RuleId1\\r\\n};\\r\\njoinByRuleId(joinByRuleId(joinByRuleId(joinByRuleId(falsePositiveClassificationTable, undeterminedClassificationTable) , benignPositiveClassificationTable), truePositiveClassificationTable),closedIncidentTable)\\r\\n| join kind=leftouter  (SecurityAlert\\r\\n| where TimeGenerated >= ago(30d)\\r\\n| where ProductName  ==  'Azure Sentinel'\\r\\n| extend RuleId = parsejson( tostring(todynamic(ExtendedProperties)['Analytic Rule Ids']))\\r\\n| mv-expand RuleId=RuleId\\r\\n| extend RuleId=tostring(RuleId)\\r\\n| extend RuleName=  tostring(todynamic(ExtendedProperties)['Analytic Rule Name'])\\r\\n| project RuleId,RuleName\\r\\n| distinct RuleId,RuleName)\\r\\n on $left.RuleId==$right.RuleId\\r\\n| extend RuleName=iff(isempty(RuleName),RuleId,RuleName)\\r\\n| project-away RuleId1\\r\\n| where alertText has RuleId \\r\\n| summarize dcount(IncidentNumber) by Classification\",\"size\":0,\"noDataMessage\":\"No recent closed incident were found\",\"noDataMessageStyle\":4,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Field1\",\"formatter\":1,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"}}},\"leftContent\":{\"columnMatch\":\"Value\",\"formatter\":1},\"showBorder\":false,\"sortCriteriaField\":\"Order\",\"sortOrderField\":1,\"size\":\"auto\"},\"chartSettings\":{\"createOtherGroup\":\"\"}},\"name\":\"Closing classification\"}]},\"customWidth\":\"33\",\"name\":\"Similar\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\" Remediations - click to Open\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"## Recommended Actions\"},\"name\":\"text - 15\"},{\"type\":1,\"content\":{\"json\":\"### Remediations and Actions Help\\r\\nIn this section of the Workbook, which only is visiable if an Alert has remediation entries, the default Remediations that are contained in the Alert data will be shown (Basic view). \\r\\nNote, not all Alerts have this data. \\r\\nHowever you can provide you own set of Alerts mapped to the Alert \\\"Title\\\".  This enhanced feature, uses a Watchlist which has an alias name of: SocRA when you import it (Advanced view).\\r\\n\\r\\n \\r\\n### WatchList Instructions\\r\\n\\r\\n* You must download the Watchlist file called:\\r\\n### SOCAnalystActionsByAlert.csv \\r\\n\\r\\n<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" id=\\\"a75e3f3a-2661-410b-82fb-d300d37dea2d\\\" width=\\\"18\\\" height=\\\"18\\\" viewBox=\\\"0 0 18 18\\\"><defs><linearGradient id=\\\"aff60ddf-eec1-40bf-8bf5-f3e3b50e8818\\\" x1=\\\"9\\\" y1=\\\"16.21\\\" x2=\\\"9\\\" y2=\\\"0.62\\\" gradientUnits=\\\"userSpaceOnUse\\\"><stop offset=\\\"0\\\" stop-color=\\\"#1b93eb\\\"/><stop offset=\\\"0.21\\\" stop-color=\\\"#2095eb\\\"/><stop offset=\\\"0.44\\\" stop-color=\\\"#2e9ced\\\"/><stop offset=\\\"0.69\\\" stop-color=\\\"#45a7ef\\\"/><stop offset=\\\"0.95\\\" stop-color=\\\"#64b6f1\\\"/><stop offset=\\\"1\\\" stop-color=\\\"#6bb9f2\\\"/></linearGradient></defs><title>Icon-security-248</title><path d=\\\"M16,8.44c0,4.57-5.53,8.25-6.73,9a.43.43,0,0,1-.46,0C7.57,16.69,2,13,2,8.44V2.94a.44.44,0,0,1,.43-.44C6.77,2.39,5.78.5,9,.5s2.23,1.89,6.53,2a.44.44,0,0,1,.43.44Z\\\" fill=\\\"#1b93eb\\\"/><path d=\\\"M15.38,8.48c0,4.2-5.07,7.57-6.17,8.25a.4.4,0,0,1-.42,0c-1.1-.68-6.17-4.05-6.17-8.25v-5A.41.41,0,0,1,3,3c3.94-.11,3-1.83,6-1.83S11.05,2.93,15,3a.41.41,0,0,1,.39.4Z\\\" fill=\\\"url(#aff60ddf-eec1-40bf-8bf5-f3e3b50e8818)\\\"/><path d=\\\"M9,6.53A2.88,2.88,0,0,1,11.84,9a.49.49,0,0,0,.49.4h1.4a.49.49,0,0,0,.5-.53,5.26,5.26,0,0,0-10.46,0,.49.49,0,0,0,.5.53h1.4A.49.49,0,0,0,6.16,9,2.88,2.88,0,0,1,9,6.53Z\\\" fill=\\\"#c3f1ff\\\"/><circle cx=\\\"9\\\" cy=\\\"9.4\\\" r=\\\"1.91\\\" fill=\\\"#fff\\\"/></svg>(https://github.com/Azure/Azure-Sentinel/blob/master/docs/SOCAnalystActionsByAlert.csv)\\r\\n \\r\\n * Name the Watchlist alias as:  \\r\\n ### SocRA  \\r\\n * Note: SocRA is case sensitive, you need an uppercase S, R and A.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - ra Help text\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| where IncidentNumber == '{IncidentNumber:value}' \\r\\n| summarize arg_max(LastModifiedTime,*) by tostring(IncidentNumber)\\r\\n| extend Alerts = extract(\\\"\\\\\\\\[(.*?)\\\\\\\\]\\\", 1, tostring(AlertIds))\\r\\n| mv-expand AlertIds to typeof(string)\\r\\n| join \\r\\n(\\r\\n    SecurityAlert\\r\\n    | extend Remediation_ = parse_json(RemediationSteps)\\r\\n    | mv-expand Remediation_\\r\\n) on $left.AlertIds == $right.SystemAlertId\\r\\n| summarize  Remediation=make_set(tostring(Remediation_)) by IncidentNumber, Title, Severity\\r\\n| mv-expand Remediation to typeof(string)\\r\\n// extract URL from the string \\r\\n| extend url_ = iif(Remediation contains 'https://',extract (\\\"https://([a-zA-Z0-9-_://@.?%=&# +]*)\\\",0,tostring(Remediation)),\\\"\\\")\\r\\n| serialize\\r\\n| extend IncidentNumber = iif(prev(IncidentNumber) == IncidentNumber,'',IncidentNumber), Title = iif(prev(Title) == Title,'',Title)\\r\\n\",\"size\":1,\"title\":\"Incident and Remediations - Basic View (from Alert) \",\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Remediation\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true},\"tooltipFormat\":{\"tooltip\":\"Click to see more details about the Remediation step\"}},{\"columnMatch\":\"url_\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"\",\"linkIsContextBlade\":false},\"tooltipFormat\":{\"tooltip\":\"Open this link (in another Tab)\"}},{\"columnMatch\":\"entityList\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}}],\"labelSettings\":[{\"columnId\":\"url_\",\"label\":\"URL\",\"comment\":\"Show a URL if available \"}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"IncidentNumber\"},\"subtitleContent\":{\"columnMatch\":\"Title\"},\"leftContent\":{\"columnMatch\":\"Remediation\"},\"secondaryContent\":{\"columnMatch\":\"url_\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkIsContextBlade\":false}},\"showBorder\":false},\"graphSettings\":{\"type\":2,\"topContent\":{\"columnMatch\":\"IncidentNumber\"},\"leftContent\":{\"columnMatch\":\"Title\"},\"centerContent\":{\"columnMatch\":\"url_\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\"}},\"hivesContent\":{\"columnMatch\":\"Title\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\"}},\"nodeIdField\":\"Remediation\",\"sourceIdField\":\"Title\",\"targetIdField\":\"Remediation\",\"graphOrientation\":3,\"showOrientationToggles\":false,\"nodeSize\":\"\",\"staticNodeSize\":100,\"colorSettings\":{\"nodeColorField\":\"url_\",\"type\":1,\"colorPalette\":\"default\"},\"groupByField\":\"Title\",\"hivesMargin\":5}},\"conditionalVisibility\":{\"parameterName\":\"watchListExists\",\"comparison\":\"isEqualTo\"},\"name\":\"query - basic View \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SocRA')\\r\\n| join\\r\\n  (\\r\\n   SecurityIncident | where IncidentNumber == '{IncidentNumber}' \\r\\n   | summarize arg_max(TimeGenerated, CreatedTime, Status, Severity, Owner, AdditionalData, IncidentUrl, Comments, Classification, ClassificationReason, ClassificationComment, Labels, Title, AlertIds) by IncidentNumber\\r\\n  ) on $left.Alert == $right.Title\\r\\n| project-keep  A*, Status, Severity //, A1, A2, A3, A4, A5, A6, A7, A8, A9, A10, A11, A12, A13, A14, A15, A16, A17, A18, A19\\r\\n| project-reorder Alert, Status, Severity, A* asc\\r\\n| project-away AlertIds, AdditionalData\\r\\n| evaluate narrow()\\r\\n| extend url_ = iif(Value contains 'https://',extract (\\\"https://([a-zA-Z0-9-_://@.?%=&# +]*)\\\",0,Value),\\\"\\\")\\r\\n| extend r = iif(Column startswith 'A', extract(@\\\"\\\\d+\\\",0,tostring(Column)),\\\"\\\")\\r\\n| where isnotempty(Value)\\r\\n| project tostring(Column), RemediationStep =Value, URLtoOpen=url_,toint(r)\\r\\n| order by Column desc, r asc \\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":0,\"title\":\"Incident and Remediations - Advanced View (from Watchlist, \\\"SocRA\\\") Incident Number:{IncidentNumber}\",\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Remediation\",\"formatter\":18,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"text\":\"{0}{1}\"}]},\"tooltipFormat\":{\"tooltip\":\"Click to see more details about the Remediation step\"}},{\"columnMatch\":\"URLtoOpen\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\"}},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"url_\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"\",\"linkIsContextBlade\":false},\"tooltipFormat\":{\"tooltip\":\"Open this link (in another Tab)\"}},{\"columnMatch\":\"entityList\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"r\",\"sortOrder\":1}],\"labelSettings\":[{\"columnId\":\"r\",\"label\":\"AlertOrder\"}]},\"sortBy\":[{\"itemKey\":\"r\",\"sortOrder\":1}],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"IncidentNumber\"},\"subtitleContent\":{\"columnMatch\":\"Title\"},\"leftContent\":{\"columnMatch\":\"Remediation\"},\"secondaryContent\":{\"columnMatch\":\"url_\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkIsContextBlade\":false}},\"showBorder\":false},\"graphSettings\":{\"type\":2,\"topContent\":{\"columnMatch\":\"IncidentNumber\"},\"leftContent\":{\"columnMatch\":\"Title\"},\"centerContent\":{\"columnMatch\":\"url_\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\"}},\"hivesContent\":{\"columnMatch\":\"Title\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\"}},\"nodeIdField\":\"Remediation\",\"sourceIdField\":\"Title\",\"targetIdField\":\"Remediation\",\"graphOrientation\":3,\"showOrientationToggles\":false,\"nodeSize\":\"\",\"staticNodeSize\":100,\"colorSettings\":{\"nodeColorField\":\"url_\",\"type\":1,\"colorPalette\":\"default\"},\"groupByField\":\"Title\",\"hivesMargin\":5}},\"conditionalVisibility\":{\"parameterName\":\"watchListExists\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - advanced View\"}]},\"name\":\"RecActions\"},{\"type\":1,\"content\":{\"json\":\"## Incident Entities\"},\"name\":\"text - 2 - Copy - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"POST\\\",\\\"path\\\":\\\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/incidents/{IncidentID}/entities\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2021-04-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.metaData\\\"}}]}\",\"size\":2,\"noDataMessage\":\"No entities were found\",\"noDataMessageStyle\":4,\"queryType\":12,\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"entityKind\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"}},\"leftContent\":{\"columnMatch\":\"count\",\"formatter\":1,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"}}},\"showBorder\":false,\"sortCriteriaField\":\"Order\",\"sortOrderField\":1,\"size\":\"auto\"}},\"customWidth\":\"30\",\"name\":\"Entities\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"POST\\\",\\\"path\\\":\\\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/incidents/{IncidentID}/entities\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2021-04-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.entities\\\",\\\"columns\\\":[{\\\"path\\\":\\\"$.kind\\\",\\\"columnid\\\":\\\"Kind\\\"},{\\\"path\\\":\\\"$.properties.friendlyName\\\",\\\"columnid\\\":\\\"Name\\\"}]}}]}\",\"size\":2,\"noDataMessage\":\"No entities were found\",\"noDataMessageStyle\":4,\"queryType\":12,\"visualization\":\"table\",\"gridSettings\":{\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Kind\"],\"expandTopLevel\":true}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"kind\",\"formatter\":1,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"}}},\"subtitleContent\":{\"columnMatch\":\"properties\",\"formatter\":1},\"showBorder\":false,\"sortCriteriaField\":\"kind\",\"sortOrderField\":1,\"size\":\"auto\"}},\"customWidth\":\"70\",\"name\":\"Entities List\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Recent activities\"},\"name\":\"text - 2 - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where Severity in ({Severity}) or '{Severity:label}' ==  \\\"All\\\"\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or '{Tactics:label}' ==  \\\"All\\\"\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or '{Owner:label}' ==  \\\"All\\\"\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or '{Product:label}' ==  \\\"All\\\"\\n| where IncidentNumber == '{IncidentNumber}' or '{IncidentNumber}' ==  ''\\n| order by LastModifiedTime \\n| project LastModifiedTime,IncidentNumber, Title, Product, IncidentUrl, ModifiedBy,Status, Severity, Owner\\n| take 250\\n\\n\\n\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to incident >\"}}],\"labelSettings\":[{\"columnId\":\"LastModifiedTime\",\"label\":\"Last Modified Time\"},{\"columnId\":\"IncidentNumber\",\"label\":\"Incident Number\"},{\"columnId\":\"IncidentUrl\",\"label\":\"Link to incident\"},{\"columnId\":\"ModifiedBy\",\"label\":\"Modified By\"}]},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"IncidentNumber\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 2 - Copy - Copy - Copy - Copy\"}]},\"name\":\"Incidents tactic over time\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Incident's Comments\"},\"name\":\"text - 2 - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where IncidentNumber == '{IncidentNumber}' or '{IncidentNumber}' ==  ''\\n| summarize arg_max(TimeGenerated,Status, Severity, Owner, AdditionalData, IncidentUrl, Comments) by IncidentNumber\\n| where Severity in ({Severity}) or '{Severity:label}' ==  \\\"All\\\"\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or '{Tactics:label}' ==  \\\"All\\\"\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or '{Owner:label}' ==  \\\"All\\\"\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or '{Product:label}' ==  \\\"All\\\"\\n| mv-expand Comments to typeof(string)\\n| extend Message = extract('message\\\":\\\"(.*?)\\\"',1,tostring(Comments)), Author = extract('name\\\":\\\"(.*?)\\\"',1,tostring(Comments)), CreatedTimeUTC = extract('createdTimeUtc\\\":\\\"(.*?)\\\"',1,tostring(Comments))\\n| project CreatedTimeUTC, Author, Message, IncidentNumber, Owner\\n| take 250\\n\\n\\n\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to incident >\"}}],\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}],\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"IncidentNumber\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 2 - Copy - Copy - Copy - Copy\"}]},\"name\":\"Incidents tactic over time - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Time to closure\\r\\n\"},\"name\":\"text - 2 - Copy\"},{\"type\":1,\"content\":{\"json\":\"The mean time between the incident creation and first modification by owner\\r\\n\\r\\n\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 2 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where IncidentNumber == '{IncidentNumber}' or '{IncidentNumber}' ==  ''\\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| where Severity in ({Severity}) or '{Severity:label}' ==  \\\"All\\\"\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or '{Tactics:label}' ==  \\\"All\\\"\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or '{Owner:label}' ==  \\\"All\\\"\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or '{Product:label}' ==  \\\"All\\\"\\n| summarize arg_max(TimeGenerated,Title, ClosedTime, CreatedTime) by IncidentNumber \\n| where isnotnull(ClosedTime)\\n| extend TimeToClosure =  (ClosedTime - CreatedTime)/1h\\n\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"series\",\"exportParameterName\":\"Status\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"IncidentNumber\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"TimeToClosure\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},\"showBorder\":false}},\"name\":\"query - 2 - Copy\"}]},\"name\":\"Time to mitigate\",\"styleSettings\":{\"margin\":\"0\",\"padding\":\"0\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Time to triage \\r\\n\"},\"name\":\"text - 2 - Copy\"},{\"type\":1,\"content\":{\"json\":\"The mean time between the incident creation and first modification by owner\\r\\n\\r\\n\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 2 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where IncidentNumber == '{IncidentNumber}' or '{IncidentNumber}' ==  ''\\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| where Severity in ({Severity}) or '{Severity:label}' ==  \\\"All\\\"\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or '{Tactics:label}' ==  \\\"All\\\"\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or '{Owner:label}' ==  \\\"All\\\"\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or '{Product:label}' ==  \\\"All\\\"\\n| where ModifiedBy != 'Incident created from alert'\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\n| where isnotnull(FirstModifiedTime)\\n| extend TimeToTriage =  FirstModifiedTime - CreatedTime\\n| project IncidentNumber, MeanToTriage = TimeToTriage/1h\\n\",\"size\":1,\"timeContext\":{\"durationMs\":94608000000,\"endTime\":\"2023-06-01T17:13:00Z\"},\"exportFieldName\":\"series\",\"exportParameterName\":\"Status\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"IncidentNumber\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"MeanToTriage\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},\"showBorder\":false}},\"name\":\"query - 2 - Copy\"}]},\"name\":\"Time to close\",\"styleSettings\":{\"margin\":\"0\",\"padding\":\"0\"}}],\"fromTemplateId\":\"sentinel-IncidentOverview\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId7'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=IncidentOverview; logoFileName=Azure_Sentinel.svg; description=The Incident Overview workbook is designed to assist in triaging and investigation by providing in-depth information about the incident, including:\r\n* General information\r\n* Entity data\r\n* Triage time (time between incident creation and first response)\r\n* Mitigation time (time between incident creation and closing)\r\n* Comments\r\n\r\nCustomize this workbook by saving and editing it. \r\nYou can reach this workbook template from the incidents panel as well. Once you have customized it, the link from the incident panel will open the customized workbook instead of the template.\r\n; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=2.1.0; title=Incident overview; templateRelativePath=IncidentOverview.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId7')]",
                "contentId": "[variables('_workbookContentId7')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "SecurityAlert",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SecurityIncident",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId7')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook7-name')]",
        "contentProductId": "[variables('_workbookcontentProductId7')]",
        "id": "[variables('_workbookcontentProductId7')]",
        "version": "[variables('workbookVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "IntsightsIOCWorkbookWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId8')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "This Microsoft Sentinel workbook provides an overview of Indicators of Compromise (IOCs) and their correlations allowing users to analyze and visualize indicators based on severity, type, and other parameters."
              },
              "properties": {
                "displayName": "[parameters('workbook8-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"bd618d6f-8e52-4cd4-87af-0fa8a03dc56d\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"IOCs Overview\",\"subTarget\":\"iocs_overview\",\"style\":\"link\"},{\"id\":\"a482be59-ecc1-4215-b0ff-fd4455197422\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Correlation Overview\",\"subTarget\":\"correlation_overview\",\"style\":\"link\"}]},\"name\":\"links - 3\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"e61becba-cfb6-42f3-a155-422e4f359817\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range:\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"15\",\"name\":\"parameters - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"3e8bb03d-ba1e-4d9f-b649-e8964090f6b4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"reporting_feeds\",\"label\":\"Reporting Feeds:\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ThreatIntelligenceIndicator\\n| extend ReportingFeeds=parse_json(Description)['ReportingFeeds']\\n| where isnotnull(ReportingFeeds)\\n| mv-expand ReportingFeeds\\n| summarize by tostring(ReportingFeeds)\\n| order by ReportingFeeds asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"20\",\"name\":\"parameters - 1\"}],\"exportParameters\":true},\"name\":\"filters\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data=ThreatIntelligenceIndicator\\n| extend Enrichment=parse_json(Description)\\n| extend ReportingFeed=Enrichment['ReportingFeeds'][0], IocSeverity=tostring(Enrichment['Severity']), Value=tostring(Enrichment['IOC'])\\n| where ReportingFeed in ({reporting_feeds});\\ndata\\n| summarize Count=dcount(Value) by IocSeverity\\n| extend IocSeverities=IocSeverity\\n| union (\\n data \\n | summarize Count=dcount(Value) \\n | extend IocSeverity='All', IocSeverities='*' \\n)\\n| extend Severity = iif(IocSeverity == \\\"All\\\", 0,iif(IocSeverity == \\\"High\\\", 1, iif(IocSeverity == \\\"Medium\\\", 2, iif(IocSeverity == \\\"Low\\\", 3, 4))))\\n| order by Severity asc\",\"size\":3,\"title\":\"Total Indicators by Severity\",\"timeContext\":{\"durationMs\":86400000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"IocSeverity\",\"exportParameterName\":\"IndicatorSeverityPicker\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"IocSeverity\",\"formatter\":1,\"formatOptions\":{\"compositeBarSettings\":{\"labelText\":\"\",\"columnSettings\":[{\"columnName\":\"Severity\",\"color\":\"blue\"}]}}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"none\"}},\"showBorder\":true,\"size\":\"auto\"}},\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\n| extend Enrichment=parse_json(Description)\\n| extend ReportingFeed = Enrichment['ReportingFeeds'][0], Value = tostring(Enrichment['IOC'])\\n| where ReportingFeed in ({reporting_feeds})\\n| where Enrichment['Severity'] == '{IndicatorSeverityPicker}' or '{IndicatorSeverityPicker}' == 'All'\\n| extend IndicatorType = iif(isnotempty(EmailSourceIpAddress) or isnotempty(NetworkDestinationIP) or isnotempty(NetworkIP) or isnotempty(NetworkSourceIP) or isnotempty(NetworkCidrBlock), \\\"IP\\\",\\n                        iff(isnotempty(Url), \\\"URL\\\",\\n                        iff(isnotempty(EmailRecipient) or isnotempty(EmailSenderAddress), \\\"Email\\\",\\n                        iff(isnotempty(FileHashValue), \\\"File\\\",\\n                         iff(isnotempty(DomainName) or isnotempty(EmailSourceDomain), \\\"Domain\\\",\\n                        \\\"Other\\\")))))\\n| summarize CountOfIndicators=dcount(Value) by IndicatorType\",\"size\":0,\"title\":\"Total Indicators by Type\",\"timeContext\":{\"durationMs\":86400000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IPs\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Count\"}},{\"columnMatch\":\"Domains\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Count\"}},{\"columnMatch\":\"Hashes\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Count\"}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"IndicatorType\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"CountOfIndicators\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false},\"graphSettings\":{\"type\":0},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"IP\",\"color\":\"blue\"},{\"seriesName\":\"Domain\",\"color\":\"orange\"},{\"seriesName\":\"File\",\"color\":\"green\"}],\"ySettings\":{\"min\":0}}},\"name\":\"total_indicator_by_type\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\n| extend Enrichment=parse_json(Description)\\n| extend ReportingFeed = Enrichment['ReportingFeeds'][0]\\n| where ReportingFeed in ({reporting_feeds})\\n| where Enrichment['Severity'] == '{IndicatorSeverityPicker}' or '{IndicatorSeverityPicker}' == 'All'\\n| extend IndicatorType = iif(isnotempty(EmailSourceIpAddress) or isnotempty(NetworkDestinationIP) or isnotempty(NetworkIP) or isnotempty(NetworkSourceIP) or isnotempty(NetworkCidrBlock), \\\"IP\\\",\\n                        iff(isnotempty(Url), \\\"URL\\\",\\n                        iff(isnotempty(EmailRecipient) or isnotempty(EmailSenderAddress), \\\"Email\\\",\\n                        iff(isnotempty(FileHashValue), \\\"File\\\",\\n                         iff(isnotempty(DomainName) or isnotempty(EmailSourceDomain), \\\"Domain\\\",\\n                        \\\"Other\\\")))))\\n| project Value=tostring(Enrichment['IOC']), Type=IndicatorType, tostring(ReportingFeed), Severity=tostring(Enrichment['Severity']), FirstSeen=tostring(Enrichment['FirstSeen']),\\n         LastSeen=tostring(Enrichment['LastSeen']), RelatedAlert=tostring(Enrichment['RelatedAlert'])\\n| summarize make_set(Value) by Value, Type, ReportingFeed, Severity, FirstSeen, LastSeen, RelatedAlert\\n| order by LastSeen desc\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"blue\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"gray\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"set_Value\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"0ch\"}}],\"rowLimit\":5000,\"filter\":true},\"sortBy\":\"[]\"},\"conditionalVisibility\":{\"parameterName\":\"ioc\",\"comparison\":\"isEqualTo\"},\"name\":\"iocs_overview_list\"}]},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"iocs_overview\"},\"name\":\"IOCs Overview\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let tiObservables = ThreatIntelligenceIndicator\\n| extend Enrichment=parse_json(Description)\\n| extend ReportingFeed = Enrichment['ReportingFeeds'][0], IocSeverity=tostring(Enrichment['Severity'])\\n| where ReportingFeed in ({reporting_feeds})\\n| project observableValue = strcat(NetworkSourceIP, NetworkIP, NetworkDestinationIP, Url, EmailSourceIpAddress, EmailSenderAddress, DomainName), IocSeverity;\\nlet alertEntity = SecurityAlert \\n| project parse_json(Entities), SystemAlertId\\n| mvexpand(Entities)\\n| extend entity = iif(isnotempty(Entities.Address), Entities.Address,\\n                  iif(isnotempty(Entities.HostName),strcat(Entities.HostName, \\\".\\\", Entities.DnsDomain),\\n                  iif(isnotempty(Entities.Url), Entities.Url,\\n                  iif(Entities.Type == \\\"account\\\", strcat(Entities.Name,\\\"@\\\",Entities.UPNSuffix),\\\"\\\")))) \\n| where isnotempty(entity) \\n| project entity, SystemAlertId;\\nalertEntity\\n| join kind= inner tiObservables on $left.entity == $right.observableValue\\n| summarize Count=dcount(observableValue) by IocSeverity\\n| extend IocSeverities=IocSeverity\\n| union (\\n alertEntity\\n | join kind= inner tiObservables on $left.entity == $right.observableValue\\n | summarize Count=dcount(observableValue)\\n | extend IocSeverity='All', IocSeverities='*' \\n)\\n| extend Severity = iif(IocSeverity == \\\"All\\\", 0,iif(IocSeverity == \\\"High\\\", 1, iif(IocSeverity == \\\"Medium\\\", 2, iif(IocSeverity == \\\"Low\\\", 3, 4))))\\n| order by Severity asc\",\"size\":3,\"title\":\"Total Matched Indicators by Severity\",\"timeContext\":{\"durationMs\":86400000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"IocSeverity\",\"exportParameterName\":\"IndicatorSeverityPicker\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"sortBy\":\"[]\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"IocSeverity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"none\"}},\"showBorder\":true,\"size\":\"full\"}},\"customWidth\":\"33\",\"name\":\"total_matched_by_severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let tiObservables = ThreatIntelligenceIndicator\\n| extend Enrichment=parse_json(Description)\\n| extend ReportingFeed = Enrichment['ReportingFeeds'][0]\\n| where ReportingFeed in ({reporting_feeds})\\n| where Enrichment['Severity'] == '{IndicatorSeverityPicker}' or '{IndicatorSeverityPicker}' == 'All'\\n| extend IndicatorType = iif(isnotempty(EmailSourceIpAddress) or isnotempty(NetworkDestinationIP) or isnotempty(NetworkIP) or isnotempty(NetworkSourceIP) or isnotempty(NetworkCidrBlock), \\\"IP\\\",\\n                        iff(isnotempty(Url), \\\"URL\\\",\\n                        iff(isnotempty(EmailRecipient) or isnotempty(EmailSenderAddress), \\\"Email\\\",\\n                        iff(isnotempty(FileHashValue), \\\"File\\\",\\n                        iff(isnotempty(DomainName) or isnotempty(EmailSourceDomain), \\\"Domain\\\",\\n                        \\\"Other\\\")))))\\n| project observableValue = strcat(NetworkSourceIP, NetworkIP, NetworkDestinationIP, Url, EmailSourceIpAddress, EmailSenderAddress, DomainName), IndicatorType;\\nlet alertEntity = SecurityAlert \\n| project parse_json(Entities), SystemAlertId\\n| mvexpand(Entities)\\n| extend entity = iif(isnotempty(Entities.Address), Entities.Address,\\n                  iif(isnotempty(Entities.HostName),strcat(Entities.HostName, \\\".\\\", Entities.DnsDomain),\\n                  iif(isnotempty(Entities.Url), Entities.Url,\\n                  iif(Entities.Type == \\\"account\\\", strcat(Entities.Name,\\\"@\\\",Entities.UPNSuffix),\\\"\\\")))) \\n| where isnotempty(entity) \\n| project entity, SystemAlertId;\\nalertEntity\\n| join kind= inner tiObservables on $left.entity == $right.observableValue\\n| summarize CountOfIndicators=dcount(observableValue) by IndicatorType\",\"size\":3,\"title\":\"Total Matched Indicators by Type\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"showMetrics\":false,\"showLegend\":true}},\"customWidth\":\"33\",\"showPin\":false,\"name\":\"total_matched_by_type\"}],\"exportParameters\":true},\"name\":\"group - 0\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let tiObservables = ThreatIntelligenceIndicator\\n| extend Enrichment=parse_json(Description)\\n| extend ReportingFeed = Enrichment['ReportingFeeds'][0]\\n| where ReportingFeed in ({reporting_feeds})\\n| where Enrichment['Severity'] == '{IndicatorSeverityPicker}' or '{IndicatorSeverityPicker}' == 'All'\\n| extend Tags=set_union(Enrichment['UserTags'],Enrichment['SystemTags'])\\n| mvexpand Tags\\n| where isnotnull(Tags)\\n| project observableValue = strcat(NetworkSourceIP, NetworkIP, NetworkDestinationIP, Url, EmailSourceIpAddress, EmailSenderAddress, DomainName), Tags;\\nlet alertEntity = SecurityAlert \\n| project parse_json(Entities), SystemAlertId\\n| mvexpand(Entities)\\n| extend entity = iif(isnotempty(Entities.Address), Entities.Address,\\n                  iif(isnotempty(Entities.HostName),strcat(Entities.HostName, \\\".\\\", Entities.DnsDomain),\\n                  iif(isnotempty(Entities.Url), Entities.Url,\\n                  iif(Entities.Type == \\\"account\\\", strcat(Entities.Name,\\\"@\\\",Entities.UPNSuffix),\\\"\\\")))) \\n| where isnotempty(entity) \\n| project entity, SystemAlertId;\\nalertEntity\\n| join kind= inner tiObservables on $left.entity == $right.observableValue\\n| summarize Count=dcount(observableValue) by Tag=tostring(Tags)\\n| order by Count desc\",\"size\":1,\"title\":\"Top Tags Linked with Matched Indicators\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"33\",\"name\":\"tags\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let tiObservables = ThreatIntelligenceIndicator\\n| extend Enrichment = parse_json(Description)\\n| extend ReportingFeed = Enrichment['ReportingFeeds'][0]\\n| where ReportingFeed in ({reporting_feeds})\\n| where Enrichment['Severity'] == '{IndicatorSeverityPicker}' or '{IndicatorSeverityPicker}' == 'All'\\n| extend Malwares= Enrichment['Malwares']\\n| where isnotnull(Malwares)\\n| mvexpand Malwares\\n| project observableValue = strcat(NetworkSourceIP, NetworkIP, NetworkDestinationIP, Url, EmailSourceIpAddress, EmailSenderAddress, DomainName), Malwares;\\nlet alertEntity = SecurityAlert \\n| project parse_json(Entities), SystemAlertId\\n| mvexpand(Entities)\\n| extend entity = iif(isnotempty(Entities.Address), Entities.Address,\\n                  iif(isnotempty(Entities.HostName),strcat(Entities.HostName, \\\".\\\", Entities.DnsDomain),\\n                  iif(isnotempty(Entities.Url), Entities.Url,\\n                  iif(Entities.Type == \\\"account\\\", strcat(Entities.Name,\\\"@\\\",Entities.UPNSuffix),\\\"\\\")))) \\n| where isnotempty(entity) \\n| project entity, SystemAlertId;\\nalertEntity\\n| join kind= inner tiObservables on $left.entity == $right.observableValue\\n| summarize Count=dcount(observableValue) by Malware=tostring(Malwares)\\n| order by Count desc\",\"size\":1,\"title\":\"Top Malwares Linked with Matched Indicators\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"33\",\"name\":\"malwares\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let tiObservables = ThreatIntelligenceIndicator\\n| extend Enrichment = parse_json(Description)\\n| extend ReportingFeed = Enrichment['ReportingFeeds'][0]\\n| where ReportingFeed in ({reporting_feeds})\\n| where Enrichment['Severity'] == '{IndicatorSeverityPicker}' or '{IndicatorSeverityPicker}' == 'All'\\n| extend ThreatActors=Enrichment['ThreatActors']\\n| where isnotnull(ThreatActors)\\n| mvexpand ThreatActors\\n| project observableValue = strcat(NetworkSourceIP, NetworkIP, NetworkDestinationIP, Url, EmailSourceIpAddress, EmailSenderAddress, DomainName), ThreatActors;\\nlet alertEntity = SecurityAlert \\n| project parse_json(Entities), SystemAlertId\\n| mvexpand(Entities)\\n| extend entity = iif(isnotempty(Entities.Address), Entities.Address,\\n                  iif(isnotempty(Entities.HostName),strcat(Entities.HostName, \\\".\\\", Entities.DnsDomain),\\n                  iif(isnotempty(Entities.Url), Entities.Url,\\n                  iif(Entities.Type == \\\"account\\\", strcat(Entities.Name,\\\"@\\\",Entities.UPNSuffix),\\\"\\\")))) \\n| where isnotempty(entity) \\n| project entity, SystemAlertId;\\nalertEntity\\n| join kind= inner tiObservables on $left.entity == $right.observableValue\\n| summarize Count=dcount(observableValue) by ThreatActor=tostring(ThreatActors)\\n| order by Count desc\",\"size\":1,\"title\":\"Top Threat Actors Linked with Matched Indicators\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"33\",\"name\":\"threat_actors\"}]},\"name\":\"group - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let tiObservables=ThreatIntelligenceIndicator\\n| extend Enrichment=parse_json(Description)\\n| extend ReportingFeed=Enrichment['ReportingFeeds'][0]\\n| where ReportingFeed in ({reporting_feeds})\\n| where Enrichment['Severity'] == '{IndicatorSeverityPicker}' or '{IndicatorSeverityPicker}' == 'All'\\n| project Enrichment, observableValue = strcat(NetworkSourceIP, NetworkIP, NetworkDestinationIP, Url, EmailSourceIpAddress, EmailSenderAddress, DomainName), SourceSystem;\\nlet alertEntity = SecurityAlert \\n| project parse_json(Entities), SystemAlertId, AlertName\\n| mvexpand(Entities)\\n| extend entity=iif(isnotempty(Entities.Address), Entities.Address,\\n                iif(isnotempty(Entities.HostName),strcat(Entities.HostName, \\\".\\\", Entities.DnsDomain),\\n                iif(isnotempty(Entities.Url), Entities.Url,\\n                iif(Entities.Type == \\\"account\\\", strcat(Entities.Name,\\\"@\\\",Entities.UPNSuffix),\\\"\\\")))) \\n| where isnotempty(entity) \\n| project entity, SystemAlertId, AlertName;\\nalertEntity\\n| join kind= inner tiObservables on $left.entity == $right.observableValue\\n| extend Severity=tostring(Enrichment['Severity']), Tags=tostring(set_union(Enrichment['UserTags'],Enrichment['SystemTags'])), ThreatActors=tostring(Enrichment['ThreatActors']), Malwares=tostring(Enrichment['Malwares'])\\n| summarize Alerts = dcount(SystemAlertId) by Value=observableValue, Severity, SourceSystem, AlertName\\n| order by Alerts desc\",\"size\":0,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"blue\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"gray\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Alerts\",\"formatter\":8,\"formatOptions\":{\"palette\":\"red\"}}],\"rowLimit\":5000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"Value\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Value\",\"sortOrder\":2}]},\"name\":\"correlation_iocs_list\"}]},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"correlation_overview\"},\"name\":\"Correlation Overview\"}],\"fromTemplateId\":\"sentinel-IntsightsIOCWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId8'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=IntsightsIOCWorkbook; logoFileName=IntSights_logo.svg; description=This Microsoft Sentinel workbook provides an overview of Indicators of Compromise (IOCs) and their correlations allowing users to analyze and visualize indicators based on severity, type, and other parameters.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=2.0.0; title=IntSights IOC Workbook; templateRelativePath=IntsightsIOCWorkbook.json; subtitle=; provider=IntSights Cyber Intelligence}.description",
                "parentId": "[variables('workbookId8')]",
                "contentId": "[variables('_workbookContentId8')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ThreatIntelligenceIndicator",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SecurityAlert",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ThreatIntelligenceTaxii",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId8')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook8-name')]",
        "contentProductId": "[variables('_workbookcontentProductId8')]",
        "id": "[variables('_workbookcontentProductId8')]",
        "version": "[variables('workbookVersion8')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "InvestigationInsightsWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId9')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Help analysts gain insight into incident, bookmark and entity data through the Investigation Insights Workbook. This workbook provides common queries and detailed visualizations to help an analyst investigate suspicious activities quickly with an easy to use interface. Analysts can start their investigation from a Microsoft Sentinel incident, bookmark, or by simply entering the entity data into the workbook manually."
              },
              "properties": {
                "displayName": "[parameters('workbook9-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"value::all\"],\"parameters\":[{\"id\":\"903a0628-df2f-4a7d-93ac-80fbf48032ec\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"InternalWSs\",\"type\":1,\"isRequired\":true,\"query\":\"where type =~ \\\"Microsoft.OperationsManagement/solutions\\\"\\r\\n| where name startswith \\\"SecurityInsights\\\"\\r\\n| parse id with * '(' WSName ')' *\\r\\n| take 1\\r\\n| project WSName\",\"crossComponentResources\":[\"value::all\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":2592000000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"8c7b9fc5-b87f-44d7-9cc8-bec025faf2c2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DefaultSubscription_Internal\",\"type\":1,\"isRequired\":true,\"query\":\"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| take 1\\r\\n| project subscriptionId\",\"crossComponentResources\":[\"value::selected\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"f046681a-d502-4370-9a04-736042ed7e47\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"query\":\"resources\\r\\n| summarize by subscriptionId\\r\\n| project value = strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\",\"crossComponentResources\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"ef68dc9e-94e2-47c9-bfc8-8206537418a8\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"query\":\"//resources\\r\\n//| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n//| project id\\r\\n\\r\\nwhere type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| project value =id, label = name, selected = iff(name =~ '{InternalWSs}', true, false)\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":\"\"},{\"id\":\"f9f6427d-1903-4ebc-9c48-86846ec36119\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"ddb7df85-73e6-4a6a-9201-a82c08739c98\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"investigateBy\",\"label\":\"Investigate By\",\"type\":10,\"description\":\"Investigate Incidents or Entities\",\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Incident\\\", \\\"label\\\": \\\"Incident\\\", \\\"selected\\\":true},\\r\\n { \\\"value\\\": \\\"Bookmark\\\", \\\"label\\\": \\\"Bookmark\\\"},\\r\\n {\\\"value\\\": \\\"Entity\\\", \\\"label\\\": \\\"Entity\\\" }\\r\\n]\\r\\n\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"IncidentView\",\"label\":\"Show Incident Trend\",\"type\":10,\"description\":\"Show incident view or not?\",\"isRequired\":true,\"query\":\"datatable(IncidentView:string, InvestigateBy:string)\\r\\n\\t[\\\"Yes\\\", \\\"Incident\\\",\\r\\n\\t\\\"No\\\", \\\"Incident\\\"]\\r\\n| where InvestigateBy =~ \\\"{investigateBy}\\\" or IncidentView == \\\"No\\\"\\r\\n| project IncidentView\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":\"No\",\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"id\":\"5c093daf-515c-45be-a1e4-4b14d211c0eb\"},{\"id\":\"44663fe5-5c34-4620-b87c-78fd566ebc2c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Change Log\\\", \\\"label\\\": \\\"Change Log\\\"}\\r\\n]\"},{\"id\":\"080aebcf-c127-49ea-af49-cdc32888ee08\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DefaultUPNSuffix\",\"type\":1,\"description\":\"When extracting the account entity from an alert, if no UPN suffix is included, this suffix will be assumed.\",\"value\":\"\",\"isHiddenWhenLocked\":true},{\"id\":\"19a40f6a-2429-480f-bc34-067b602d1fa8\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AlertID\",\"type\":1,\"description\":\"This parameter should be left blank\",\"isHiddenWhenLocked\":true},{\"id\":\"0c774c1b-f434-480d-ae82-078f7665f11d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"EntityData\",\"type\":1,\"description\":\"This parameter should be left blank\",\"isHiddenWhenLocked\":true},{\"id\":\"d663ab0d-fc80-40a5-9d76-71a7401d7324\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"EntityType\",\"type\":1,\"description\":\"This parameter should be left blank\",\"isHiddenWhenLocked\":true}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"GlobalParameters\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"75399fba-c502-401d-9d4c-ca2e3ec6bd70\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"GlobalCustomTabName\",\"type\":1,\"description\":\"Enter a tab name if you wish to add a customizable section to the Global tab list.  This customizable section can be used to link to your own workbook to embed additional content.  Otherwise, leave this parameter blank so the tab is hidden.\",\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"ae1a3f68-8153-41d1-9fa2-c4ead5649a77\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IPCustomTabName\",\"type\":1,\"description\":\"Enter a tab name if you wish to add a customizable section to the IP tab list.  This customizable section can be used to link to your own workbook to embed additional content.  Otherwise, leave this parameter blank so the tab is hidden.\",\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"4b8d0ad0-14f4-4083-99de-2b5d4573ad7a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AccountCustomTabName\",\"type\":1,\"description\":\"Enter a tab name if you wish to add a customizable section to the Account tab list.  This customizable section can be used to link to your own workbook to embed additional content.  Otherwise, leave this parameter blank so the tab is hidden.\",\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"9150e8c7-bf5d-42ea-b0cf-52499b43fa17\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"HostCustomTabName\",\"type\":1,\"description\":\"Enter a tab name if you wish to add a customizable section to the Host tab list.  This customizable section can be used to link to your own workbook to embed additional content.  Otherwise, leave this parameter blank so the tab is hidden.\",\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"071760ec-c549-481f-b22f-93be5b8a11fe\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"URLCustomTabName\",\"type\":1,\"description\":\"Enter a tab name if you wish to add a customizable section to the URL tab list.  This customizable section can be used to link to your own workbook to embed additional content.  Otherwise, leave this parameter blank so the tab is hidden.\",\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"a9100608-ef9e-4c8d-81f9-119e7c8fc134\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"FileHashCustomTabName\",\"type\":1,\"description\":\"Enter a tab name if you wish to add a customizable section to the File Hash tab list.  This customizable section can be used to link to your own workbook to embed additional content.  Otherwise, leave this parameter blank so the tab is hidden.\",\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"customParameters\"},{\"type\":1,\"content\":{\"json\":\"# Investigation Insights\"},\"name\":\"text - 21\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### Change Log\\r\\nBrian Delaney, Clive Watson, Jon Shectman - Microsoft\\r\\n\\t\\r\\n\\tVersion v1.4\\r\\n\\tFixing issue in table names in FullSearch output\\r\\n\\tAdding open external query/export to excel to FullSearch Results\\r\\n\\t\\r\\n\\tVersion v1.2\\r\\n\\tAdded Tag based filters to Incident View\\r\\n\\tAdded Incident Number filter to Incident View\\r\\n\\tAdded Application Consent to User IOCs\\r\\n\\tAdded Logon Type filter for User Account Logons\\r\\n\\tAdded Defender ATP DeviceLogonEvents to User Account Logons table\\r\\n\\tEnabled support for nesting custom workbooks\\r\\n\\tImproved samAccountName detection using IdentityInfo table\\r\\n\\tImproved Location Anomalies map to color datapoints based on distance\\r\\n\\tOther minor improvements\\r\\n\\t\\r\\n\\tVersion v1.1\\r\\n\\tAdded Investigate by Bookmark\\r\\n\\tAdded Related Bookmarks to each Investigation type\\r\\n\\tAdded Investigate FileHash\\r\\n\\tAdded BehaviorAnalytics for Account Investigation\\r\\n\\tAdded MFA Fraud Query for Account Investigation\\r\\n\\tAdded Owner and Status Filters to Incident View\\r\\n\\tAdded Normalized Network Schema view\\r\\n\\tUpdated Entity Parsing to add additional entity types\\r\\n\\tUpdated Incident Timeline to be based on CreatedTime of Incident\\r\\n\\tOther minor improvements\\r\\n\\t\\r\\n\\t\\r\\n\\tVersion v1.0\\r\\n\\tInitial Release\",\"style\":\"info\"},\"customWidth\":\"50\",\"name\":\"text - 20\"}]},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Change Log\"},\"name\":\"ChangeLogGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Investigation Insights Help\\r\\n\\r\\n### Overview\\r\\n\\r\\nThe Investigation Insights Workbook is designed to assist in investigations of Azure Sentinel Incidents or individual IP/Account/Host/URL entities. The workbook leverages multiple data sources to provide detailed views of frequently used information during the analysis of an incident.\\r\\n\\r\\nDetailed help on this workbook is maintained at the [Azure Sentinel Github Wiki](https://github.com/Azure/Azure-Sentinel/wiki/Investigation-Insights---Overview).\\r\\n\\r\\nThe workbook is broken up into 2 main sections, Incident Insights and Entity Insights.\\r\\n\\r\\n#### Incident Insights\\r\\n\\r\\nThe Incident Insights gives the analyst a view of ongoing Sentinel Incidents and allows for quick access to their associated metadata including alerts and entity information.\\r\\n\\r\\n#### Entity Insights\\r\\n\\r\\nThe Entity Insights allows the analyst to take entity data either from an incident or through manual entry and explore related information about that entity.  This workbook presently provides view of the following entity types:\\r\\n- IP Address\\r\\n- Account\\r\\n- Host\\r\\n- URL\\r\\n- FileHash\\r\\n\\r\\n### Workbook Setup\\r\\n\\r\\nThis workbook can be configured using the parameters at the top of the workbook.  Some of these parameters are only available in Edit mode.\\r\\n\\r\\n\\r\\n| Parameter | Description |\\r\\n|---|---|\\r\\n|Subscription |Select the Azure subscription where your Azure Sentinel instance resides |\\r\\n|Workspace|Select the Azure Log Analytics workspace where your Azure Sentinel data resides|\\r\\n|TimeRange|Select the time window you want to Investigate|\\r\\n|Investigate by|Investigate by Incident allows you to view Sentinel incident data and investigate by entity, Investigate by Entity allows you to proceed directly to entering the entity data manually for your investigation |\\r\\n| Show Incident Trend |Use this toggle, to see additonal data about the Trends over the past (TimeRange), compared to the last 24hours.|\\r\\n|Help|Turn on/off this help data, Turn on/off the change log|\\r\\n|DefaultUPNSuffix|This parameter is used when the entity data does not include a UPN suffix, the value of this parameter will be the assumed suffix|\\r\\n|AlertID|This parameter should be left blank and is hidden when using the workbook|\\r\\n|EntityData|This parameter should be left blank and is hidden when using the workbook|\\r\\n|EntityType|This parameter should be left blank and is hidden when using the workbook|\\r\\n\\r\\n#### Data Sources\\r\\n\\r\\nThis workbook leverages a number of different data sources.  Most of these data sources are not required for this workbook to function but elements of the workbook may not function if data sources are missing.  Our detailed help located on [GitHub](https://github.com/Azure/Azure-Sentinel/wiki/Investigation-Insights---Overview) includes additional information about which data sources are required for specific capabilities of this workbook.\\r\\n\\r\\n|Data Source|Type|Data Connector|\\r\\n|---|---|\\r\\n| Azure Resource Graph |api| Not Applicable|\\r\\n| AuditLogs | table| Azure Active Directory |\\r\\n| AWSCloudTrail | table| Amazon Web Services |\\r\\n| AzureActivity |table| Azure Activity | \\r\\n| BehaviorAnalytics | table | Entity Behavior Analytics |\\r\\n| CommonSecurityLog |table| Multiple Connectors |\\r\\n| DeviceLogonEvents |table| Defender ATP |\\r\\n| DnsEvents |table| DNS |\\r\\n| IdentityInfo | table | Entity Behavior Analytics |\\r\\n| OfficeActivity |table| Office 365 |\\r\\n| ProtectionStatus |table| Azure Security Center with Microsoft Monitoring Agent |\\r\\n| SecurityAlert |table| Multiple Connectors |\\r\\n| SecurityBaseline | table | Azure Security Center with Microsoft Monitoring Agent |\\r\\n| SecurityBaselineSummary | table | Azure Security Center with Microsoft Monitoring Agent |\\r\\n| SecurityEvent |table| Security Events |\\r\\n| SecurtityIncident | table| Not Applicable |\\r\\n| SigninLogs |table|Azure Active Directory |\\r\\n| ThreatIntelligenceIndicator |table| Threat Intelligence (Platforms and/or TAXII)|\\r\\n| UpdateSummary |table| Azure Security Center with Microsoft Monitoring Agent |\\r\\n| Update | table | Azure Security Center with Microsoft Monitoring Agent |\\r\\n| VMConnection | table | Azure Monitor VM Insights |\\r\\n| W3CIISLog | table | Microsoft Monitoring Agent |\\r\\n| WindowsFirewall | table | Windows Firewall |\\r\\n\\r\\n\",\"style\":\"info\"},\"name\":\"text - 19\"}]},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"HelpGroup\"},{\"type\":1,\"content\":{\"json\":\"### Incident Insights\\n---\\n\\n\"},\"conditionalVisibility\":{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"},\"name\":\"IncidentHeader\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"e3e3e2b2-4e83-43a2-b65b-59f1cdd1d30c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectSeverity\",\"label\":\"Incident Severity\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"let SortOrder = datatable(Value:string, SortOrder:int)\\r\\n[\\\"High\\\", 1, \\\"Medium\\\", 2, \\\"Low\\\", 3, \\\"Informational\\\", 4];\\r\\nSecurityIncident\\r\\n| where CreatedTime {TimeRange:value}\\r\\n| summarize arg_max(TimeGenerated,*) by IncidentNumber\\r\\n| summarize Count=dcount(IncidentNumber) by Severity\\r\\n| extend Label = strcat(Severity,\\\" [\\\",Count,\\\"]\\\")\\r\\n| project Label, Value=Severity\\r\\n| distinct  Value, Label\\r\\n| join kind=leftouter SortOrder on Value\\r\\n| project Value, Label\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"2be7af21-dc71-45af-bbac-f4a6a9140390\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Status\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| where CreatedTime {TimeRange:value}\\r\\n| where Severity in ({SelectSeverity})\\r\\n| distinct Status\\r\\n| sort by Status asc\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"53c5d5c8-5ea1-4df9-81af-63dc3e80254c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Owner\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| where CreatedTime {TimeRange:value}\\r\\n| where Status in ({Status})\\r\\n| where Severity in ({SelectSeverity})\\r\\n| project Owner=tostring(Owner.userPrincipalName)\\r\\n| sort by Owner asc\\r\\n| extend Owner = iff(isnotempty( Owner), Owner, \\\"Unassigned\\\")\\r\\n| distinct Owner\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"88a6775c-d6de-45b1-a027-3a43731c1d93\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Tags\",\"label\":\"\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| mv-expand Labels\\r\\n| project Tags=replace_string(tostring(Labels.labelName),@\\\"\\\\\\\",@\\\"\\\\\\\\\\\")\\r\\n| distinct Tags\\r\\n| sort by Tags asc\\r\\n| union (datatable(Tags:string)[\\\"Untagged\\\"])\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"e68521f2-ba48-4df5-bad2-0b434aa8de07\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IncidentNumber\",\"label\":\"Incident Number\",\"type\":1,\"value\":\"\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"},\"customWidth\":\"45\",\"name\":\"parameters - 19 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n//| summarize IncidentCount=count() by TimeGenerated\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| where IncidentNumber == \\\"{IncidentNumber}\\\" or isempty(\\\"{IncidentNumber}\\\")\\r\\n| where CreatedTime {TimeRange:value}\\r\\n| where Status in ({Status})\\r\\n| where Severity in ({SelectSeverity})\\r\\n| where tostring(Owner.userPrincipalName) in ({Owner}) or (isempty(tostring(Owner.userPrincipalName)) and \\\"Unassigned\\\" in ({Owner}))\\r\\n| summarize IncidentCount=dcount(IncidentNumber) by bin(CreatedTime, {TimeRange:grain})\\r\\n\",\"size\":1,\"title\":\"Incident Timeline\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"linechart\",\"sortBy\":\"[]\",\"chartSettings\":{\"ySettings\":{\"min\":0}}},\"conditionalVisibility\":{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"},\"customWidth\":\"55\",\"name\":\"IncidentByTime - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### Incident Trending at a Glance\\r\\n---\"},\"conditionalVisibilities\":[{\"parameterName\":\"IncidentView\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"}],\"name\":\"IncidentHeader - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// lookup all Severities seen in last month \\r\\nlet pastMonth = SecurityIncident | where TimeGenerated > startofday(ago(30d)) | summarize by Severity;\\r\\n SecurityIncident\\r\\n// lookup Severities from today only\\r\\n| where TimeGenerated > ago(1d)\\r\\n| summarize todayCount=count() by Severity\\r\\n| join kind=fullouter  (pastMonth) on Severity\\r\\n| join (\\r\\n SecurityIncident \\r\\n // from oldest suplied parameter until this time Yesterday \\r\\n | where TimeGenerated between (startofday({TimeRange:start}) .. ago(1d))\\r\\n // get avg from oldest date to this time yesterday\\r\\n | summarize count() by Severity , bin(TimeGenerated,1d)\\r\\n | summarize historyCount = round(avg(count_),1) by Severity\\r\\n | extend low  = iif(Severity == \\\"Low\\\",\\\"a\\\",\\\"\\\"),\\r\\n          med  = iif(Severity == \\\"Medium\\\",\\\"b\\\",\\\"\\\"),\\r\\n          high = iif(Severity == \\\"High\\\",\\\"c\\\",\\\"\\\"),\\r\\n          info = iif(Severity == \\\"Informational\\\",\\\"d\\\",\\\"\\\")\\r\\n ) on $left.Severity1 == $right.Severity\\r\\n | extend todayCount = iif(isempty(todayCount),0,todayCount)\\r\\n | extend trendIs = case(\\r\\n        todayCount > historyCount,\\\"Trending Up\\\",\\r\\n        todayCount == historyCount,\\\"Equal\\\",\\r\\n        todayCount < historyCount,\\\"Trending Down\\\",\\r\\n        Severity2\\r\\n )\\r\\n| project Severity2, todayCount, historyCount, trendIs, low, med, high, info\\r\\n| order by high, med, low, info\",\"size\":1,\"title\":\"Incident Severity Trend - Average count from {TimeRange:label}  vs. Last 24hr Count\",\"exportFieldName\":\"Severity\",\"exportParameterName\":\"Severity\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"historyCount\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"historyCount\",\"sortOrder\":2}],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity2\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"historyCount\",\"tooltipFormat\":{\"tooltip\":\"Average Count\"}},\"leftContent\":{\"columnMatch\":\"trendIs\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Trending Up\",\"representation\":\"trendup\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Trending Down\",\"representation\":\"trenddown\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Equal\",\"representation\":\"Normal\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"\"}]},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},\"secondaryContent\":{\"columnMatch\":\"todayCount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"},\"tooltipFormat\":{\"tooltip\":\"Today's Count\"}},\"showBorder\":true}},\"customWidth\":\"59\",\"conditionalVisibility\":{\"parameterName\":\"IncidentView\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"IncidentBySev - Incident Trend \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let SortOrder = datatable(Severity:string, SortOrder:int)[\\\"High\\\", 1, \\\"Medium\\\", 2, \\\"Low\\\", 3, \\\"Informational\\\", 4,];\\r\\nSecurityIncident\\r\\n| join kind=leftouter SortOrder on Severity\\r\\n| make-series count() on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}  by Severity\\r\\n\\r\\n\\r\\n\",\"size\":1,\"title\":\"Incident Severity Trend - Average count from {TimeRange:label}  \",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Severity\",\"exportParameterName\":\"Severity\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":9,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":5}],\"labelSettings\":[{\"columnId\":\"Severity\"},{\"columnId\":\"count_\",\"label\":\"Trend\"},{\"columnId\":\"TimeGenerated\"}]},\"sortBy\":\"[]\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity2\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"historyCount\",\"tooltipFormat\":{\"tooltip\":\"Average Count\"}},\"leftContent\":{\"columnMatch\":\"trendIs\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Trending Up\",\"representation\":\"trendup\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Trending Down\",\"representation\":\"trenddown\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Equal\",\"representation\":\"Normal\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"\"}]},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},\"secondaryContent\":{\"columnMatch\":\"todayCount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"},\"tooltipFormat\":{\"tooltip\":\"Today's Count\"}},\"showBorder\":true}},\"customWidth\":\"39\",\"conditionalVisibility\":{\"parameterName\":\"IncidentView\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"IncidentBySev - Incident Trend  - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// lookup all Status states seen in last month \\r\\nlet pastMonth = SecurityIncident | where TimeGenerated > startofday(ago(30d)) | summarize by Status;\\r\\n SecurityIncident\\r\\n// lookup Status states, from today only\\r\\n| where TimeGenerated > ago(1d)\\r\\n| summarize todayCount=count() by Status\\r\\n| join kind=fullouter (pastMonth) on Status\\r\\n| join (\\r\\n SecurityIncident \\r\\n // from oldest suplied parameter until 24hrs ago \\r\\n | where TimeGenerated between (startofday({TimeRange:start}) .. ago(1d))\\r\\n // get avg from oldest date to this time yesterday\\r\\n | summarize count() by Status , bin(TimeGenerated,1d)\\r\\n | summarize historyCount = round(avg(count_),2) by Status\\r\\n ) on $left.Status1 == $right.Status\\r\\n| extend todayCount = iif(isempty(todayCount),0,todayCount)\\r\\n | extend trendIs = case(\\r\\n        todayCount > historyCount,\\\"Trending Up\\\",\\r\\n        todayCount == historyCount,\\\"Equal\\\",\\r\\n        todayCount < historyCount,\\\"Trending Down\\\",\\r\\n        Status2\\r\\n )\\r\\n| project Status2, todayCount, historyCount, trendIs \",\"size\":1,\"title\":\"Incident Status Trend - Average count from {TimeRange:label} vs. Last 24hr Count\",\"exportFieldName\":\"Severity\",\"exportParameterName\":\"Severity\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"historyCount\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"historyCount\",\"sortOrder\":2}],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Status2\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"historyCount\",\"tooltipFormat\":{\"tooltip\":\"Average Count\"}},\"leftContent\":{\"columnMatch\":\"trendIs\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Trending Up\",\"representation\":\"trendup\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Trending Down\",\"representation\":\"trenddown\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Equal\",\"representation\":\"Normal\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"\"}]},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},\"secondaryContent\":{\"columnMatch\":\"todayCount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"tooltipFormat\":{\"tooltip\":\"Today's Count\"}},\"showBorder\":true}},\"customWidth\":\"59\",\"conditionalVisibility\":{\"parameterName\":\"IncidentView\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"IncidentBySev - Incident Trend  - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| make-series count() on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}  by Status\\r\\n\\r\\n\\r\\n\",\"size\":1,\"title\":\"Incident Status Trend - Average count from {TimeRange:label}  \",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Severity\",\"exportParameterName\":\"Severity\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":9,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":5}],\"labelSettings\":[{\"columnId\":\"Status\"},{\"columnId\":\"count_\",\"label\":\"Trend\"},{\"columnId\":\"TimeGenerated\"}]},\"sortBy\":\"[]\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity2\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"historyCount\",\"tooltipFormat\":{\"tooltip\":\"Average Count\"}},\"leftContent\":{\"columnMatch\":\"trendIs\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Trending Up\",\"representation\":\"trendup\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Trending Down\",\"representation\":\"trenddown\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Equal\",\"representation\":\"Normal\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"\"}]},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},\"secondaryContent\":{\"columnMatch\":\"todayCount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"},\"tooltipFormat\":{\"tooltip\":\"Today's Count\"}},\"showBorder\":true}},\"customWidth\":\"39\",\"conditionalVisibility\":{\"parameterName\":\"IncidentView\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"IncidentBySev - Incident Trend  - Copy - Copy\"}]},\"name\":\"customGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Security Table Anomalies\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"a04e32b1-ffbe-47b6-96bf-4d77891fe3d9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AnomaliesTimeRange\",\"type\":4,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"bec01a6d-0c4e-4510-ba14-9297ca422da9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SampleInterval\",\"type\":2,\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"jsonData\":\"[{ \\\"value\\\": \\\"5m\\\", \\\"label\\\": \\\"5m\\\" }, { \\\"value\\\": \\\"1h\\\", \\\"label\\\": \\\"1h\\\" }, { \\\"value\\\": \\\"1d\\\", \\\"label\\\": \\\"1d\\\" , \\\"selected\\\":true }, { \\\"value\\\": \\\"7d\\\", \\\"label\\\": \\\"7d\\\" , \\\"selected\\\":true },{ \\\"value\\\": \\\"14d\\\", \\\"label\\\": \\\"14d\\\"}]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"1h\"},{\"id\":\"345e2087-decb-4751-b800-5bba202d65f7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"PositiveAlertThreshold\",\"type\":1,\"isRequired\":true,\"value\":\"0\",\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"8a8384a1-c192-41c5-83e6-57dd59a24bfa\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NegativeAlertThreshold\",\"type\":1,\"isRequired\":true,\"value\":\"0.0\",\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 3\"},{\"type\":1,\"content\":{\"json\":\"### Security Anomalies \"},\"name\":\"text - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"union withsource=TableName1 SecurityIncident, SecurityAlert, SecurityEvent, CommonSecurityLog, Syslog\\r\\n| make-series count() on TimeGenerated from {AnomaliesTimeRange:start} to {AnomaliesTimeRange:end} step {SampleInterval:value}  by TableName1\\r\\n| extend (anomalies, score, baseline) = series_decompose_anomalies(count_, 1.5, 7, 'linefit', 1, 'ctukey', 0.01)\\r\\n//| where anomalies[-1] == 1 or anomalies[-1] == -1  \\r\\n| extend Score = score[-1]\\r\\n| where Score >= {PositiveAlertThreshold:value} or Score <= {NegativeAlertThreshold:value}\\r\\n| project TableName1, expectedCounts=baseline[-1], actualCount=count_[-1], Score = score[-1]\",\"size\":4,\"title\":\"Security Tables detected anomalies: {AnomaliesTimeRange:label},  step {SampleInterval:value} \",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"AnomaliesTimeRange\",\"exportFieldName\":\"TableName1\",\"exportParameterName\":\"TableName1\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"expectedCounts\",\"formatter\":0,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumSignificantDigits\":2}}},{\"columnMatch\":\"actualCount\",\"formatter\":0,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumSignificantDigits\":2}}},{\"columnMatch\":\"Score\",\"formatter\":0,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumSignificantDigits\":3}}}]},\"sortBy\":\"[]\"},\"customWidth\":\"50\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"union withsource=TableName1 *\\r\\n| where TableName1 == '{TableName1}'\\r\\n| make-series count() on TimeGenerated from {AnomaliesTimeRange:start} to {AnomaliesTimeRange:end} step {SampleInterval:value}\\r\\n| extend (anomalies, score, baseline) = series_decompose_anomalies(count_, 1.5, 7, 'linefit', 1, 'ctukey', 0.01)\\r\\n| project-away anomalies, score\\r\\n\",\"size\":1,\"title\":\"Anomaly graph for the selected table\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"AnomaliesTimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"query - 4\"}]},\"conditionalVisibility\":{\"parameterName\":\"Hide\",\"comparison\":\"isEqualTo\",\"value\":\"EnableAfterMVP\"},\"name\":\"group - Security Anomalies\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"IncidentView\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"}],\"name\":\"incidentTrending\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let selectedTags = dynamic([{Tags}]);\\r\\nSecurityIncident\\r\\n| summarize arg_max(TimeGenerated,*) by tostring(IncidentNumber)\\r\\n| where IncidentNumber == \\\"{IncidentNumber}\\\" or isempty(\\\"{IncidentNumber}\\\")\\r\\n| where Severity in ({SelectSeverity})\\r\\n| where Status in ({Status})\\r\\n| where Labels has_any(selectedTags) or (selectedTags has_any(\\\"Untagged\\\") and array_length(Labels) == 0)\\r\\n| extend Alerts = extract(\\\"\\\\\\\\[(.*?)\\\\\\\\]\\\", 1, tostring(AlertIds))\\r\\n| mv-expand AlertIds to typeof(string)\\r\\n| join \\r\\n(\\r\\n    SecurityAlert\\r\\n    | extend AlertEntities = parse_json(Entities)\\r\\n    | mv-expand AlertEntities\\r\\n    | extend sortOrder = case \\r\\n      ( \\r\\n        AlertEntities.Type == \\\"account\\\",1, AlertEntities.Type == \\\"host\\\",2, AlertEntities.Type == \\\"ip\\\",3, AlertEntities.Type == \\\"url\\\",4, 99\\r\\n      ) \\r\\n    | order by sortOrder asc    \\r\\n) on $left.AlertIds == $right.SystemAlertId\\r\\n| summarize AlertCount=dcount(AlertIds), entityList=make_set(tostring(AlertEntities.Type)) by IncidentNumber, Status, Severity, Title,  Alerts, IncidentUrl, Owner=tostring(Owner.userPrincipalName) , Tactics =tostring(AdditionalData.tactics)\\r\\n| where Owner in ({Owner}) or (isempty(Owner) and \\\"Unassigned\\\" in ({Owner}))\\r\\n// set column order\\r\\n| project IncidentNumber, Severity, Status, AlertCount,Owner, Title, Alerts, entityList, Tactics, IncidentUrl\\r\\n| order by IncidentNumber desc\",\"size\":2,\"title\":\"Incident Details - {TimeRange:label} \",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportedParameters\":[{\"fieldName\":\"Alerts\",\"parameterName\":\"Alerts\",\"defaultValue\":\"\\\"None\\\"\"},{\"fieldName\":\"IncidentNumber\",\"parameterName\":\"INexport\",\"parameterType\":1,\"defaultValue\":\"None\"},{\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"down\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"info\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"unknown\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"New\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Active\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AlertCount\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"}},{\"columnMatch\":\"Owner\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"25ch\"}},{\"columnMatch\":\"Alerts\",\"formatter\":5},{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Open Incident in the Azure Sentinel Portal\"}},{\"columnMatch\":\"Entities\",\"formatter\":1},{\"columnMatch\":\"alertCount\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"redBright\"}},{\"columnMatch\":\"count_AlertCount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"rowLimit\":500,\"filter\":true,\"labelSettings\":[{\"columnId\":\"IncidentNumber\"},{\"columnId\":\"Status\"},{\"columnId\":\"Owner\"},{\"columnId\":\"Title\"},{\"columnId\":\"IncidentUrl\"}]},\"sortBy\":\"[]\"},\"customWidth\":\"75\",\"conditionalVisibility\":{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"},\"name\":\"IncidentDetailsView - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| where IncidentNumber == '{INexport}' \\r\\n| summarize arg_max(TimeGenerated,CreatedTime,Status, Severity, Owner, AdditionalData, IncidentUrl, Comments, Classification, ClassificationComment,Labels, Title, AlertIds) by IncidentNumber\\r\\n| extend Tactics = todynamic(AdditionalData.tactics)\\r\\n| extend Owner = todynamic(Owner.assignedTo), IncidentCreated = format_datetime(CreatedTime,'yy-MM-dd HH:mm')\\r\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\r\\n| extend Tags = extract_all('labelName\\\":\\\"(.*?)\\\"',tostring(Labels))\\r\\n| extend Owner = case(Owner==\\\"\\\", \\\"Unassigned\\\",Owner), Products = strcat_array(AdditionalData.alertProductNames, \\\", \\\"), Alerts = tostring(AdditionalData.alertsCount), Bookmarks = tostring(AdditionalData.bookmarksCount), Comments = tostring(AdditionalData.commentsCount), Tactics = strcat_array(AdditionalData.tactics, \\\", \\\"), Labels = strcat_array(Tags, \\\", \\\")\\r\\n| mvexpand AlertIds to typeof(string)\\r\\n| join kind=leftouter\\r\\n(SecurityAlert\\r\\n| summarize arg_max(TimeGenerated,AlertName, Description, AlertType, Entities)by SystemAlertId) on $left.AlertIds == $right.SystemAlertId\\r\\n| summarize AlertName = makelist(AlertName), AlertType = makelist(AlertType) by Comments, Labels, Title, Products, AlertsCount = Alerts, Bookmarks, Status, Severity, Owner, IncidentCreated \\r\\n| extend AlertNames = strcat_array(AlertName, \\\", \\\"), AlertTypes = strcat_array(AlertType, \\\", \\\")\\r\\n| project packed = pack_all()\\r\\n| mv-expand packed\\r\\n| parse tostring(packed) with * '\\\"' Field '\\\":\\\"' Value '\\\"}'\\r\\n| where Field in ('Severity', 'Owner','Status','Comments', 'AlertsCount','Products','Title', 'IncidentCreated', 'Labels','Bookmarks', 'AlertNames', 'AlertsType')\\r\\n| extend Order = case(Field==\\\"Title\\\", 1,Field==\\\"IncidentCreated\\\", 2,Field==\\\"Severity\\\", 3,Field==\\\"Status\\\", 4,Field==\\\"Owner\\\", 5,Field==\\\"Products\\\", 6,Field==\\\"AlertsType\\\",6,Field==\\\"AlertsCount\\\", 7,Field==\\\"Bookmarks\\\", 8, Field==\\\"Labels\\\", 9, 100)\\r\\n\",\"size\":3,\"title\":\"Incident Summary: {INexport}\",\"noDataMessage\":\"Select an Incident to show Summary\",\"noDataMessageStyle\":2,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Field\",\"formatter\":1},\"rightContent\":{\"columnMatch\":\"Value\"},\"showBorder\":true,\"sortCriteriaField\":\"Order\",\"size\":\"auto\"}},\"customWidth\":\"25\",\"conditionalVisibility\":{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"},\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where SystemAlertId in ({Alerts})\\r\\n| summarize by  DisplayName, ProductName, StartTime, EndTime,  SystemAlertId, ProviderName\\r\\n| sort by EndTime desc\",\"size\":1,\"title\":\"Alerts\",\"noDataMessage\":\"Select an incident to show Alerts\",\"noDataMessageStyle\":2,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"SystemAlertId\",\"exportParameterName\":\"AlertID\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"SystemAlertId\",\"formatter\":5}]},\"sortBy\":\"[]\"},\"customWidth\":\"75\",\"conditionalVisibilities\":[{\"parameterName\":\"Alerts\",\"comparison\":\"isNotEqualTo\",\"value\":\"\"},{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"}],\"name\":\"AlertsByIncident\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let AlertEntities = SecurityAlert\\r\\n| where SystemAlertId == \\\"{AlertID}\\\"\\r\\n| where TimeGenerated {TimeRange}\\r\\n| extend AlertEntities = parse_json(Entities)\\r\\n| mv-expand AlertEntities\\r\\n| where isnotempty(AlertEntities)\\r\\n| project AlertEntities;\\r\\nlet filehashEntities = AlertEntities\\r\\n| where AlertEntities.Type =~ \\\"filehash\\\"\\r\\n| extend Entity = tostring(AlertEntities.Value)\\r\\n| extend EntityType = strcat(tostring(AlertEntities.Type), \\\"-\\\", tostring(AlertEntities.Algorithm))\\r\\n| distinct Entity, EntityType;\\r\\nlet fileEntities = AlertEntities\\r\\n| where AlertEntities.Type == \\\"file\\\"\\r\\n| extend Entity = strcat(tostring(AlertEntities.Directory), \\\"\\\\\\\\\\\", tostring(AlertEntities.Name))\\r\\n| extend EntityType = tostring(AlertEntities.Type)\\r\\n| distinct Entity, EntityType;\\r\\nlet nestedFileHashEntities = AlertEntities\\r\\n| where AlertEntities.Type =~ \\\"file\\\"\\r\\n| where isnotempty(AlertEntities.FileHashes)\\r\\n| mv-expand hashes=AlertEntities.FileHashes\\r\\n| extend Entity = tostring(hashes.Value)\\r\\n| extend EntityType = strcat(tostring(hashes.Type), \\\"-\\\", tostring(hashes.Algorithm))\\r\\n| distinct Entity, EntityType;\\r\\nlet IPEntities = AlertEntities\\r\\n| where AlertEntities.Type == \\\"ip\\\"\\r\\n| extend Entity = tostring(AlertEntities.Address)\\r\\n| extend EntityType = tostring(AlertEntities.Type)\\r\\n| distinct Entity, EntityType;\\r\\nlet AccountEntities = AlertEntities\\r\\n| where AlertEntities.Type == \\\"account\\\"\\r\\n| extend Entity = iff(isnotempty(AlertEntities.UPNSuffix), strcat(AlertEntities.Name, '@', AlertEntities.UPNSuffix), AlertEntities.Name)\\r\\n| extend EntityType = tostring(AlertEntities.Type)\\r\\n| distinct Entity, EntityType;\\r\\nlet HostEntities = AlertEntities\\r\\n| where AlertEntities.Type == \\\"host\\\"\\r\\n| extend Entity = iff(isnotempty(AlertEntities.DnsDomain), strcat(AlertEntities.HostName, '.', AlertEntities.DnsDomain), AlertEntities.HostName)\\r\\n| extend EntityType = tostring(AlertEntities.Type)\\r\\n| distinct Entity, EntityType;\\r\\nlet appEntities = AlertEntities\\r\\n| where AlertEntities.Type == \\\"cloud-application\\\"\\r\\n| extend Entity = tostring(AlertEntities.Name)\\r\\n| extend EntityType = tostring(AlertEntities.Type)\\r\\n| distinct Entity, EntityType;\\r\\nlet azresEntities = AlertEntities\\r\\n| where AlertEntities.Type == \\\"azure-resource\\\"\\r\\n| extend Entity = tostring(AlertEntities.ResourceId)\\r\\n| extend EntityType = tostring(AlertEntities.Type)\\r\\n| distinct Entity, EntityType;\\r\\nlet malwareEntities = AlertEntities\\r\\n| where AlertEntities.Type == \\\"malware\\\"\\r\\n| extend Entity = tostring(AlertEntities.Name)\\r\\n| extend EntityType = tostring(AlertEntities.Type)\\r\\n| distinct Entity, EntityType;\\r\\nlet domResIdEntities = AlertEntities\\r\\n| where AlertEntities.Type == \\\"DomainResourceIdentifier\\\"\\r\\n| extend Entity = tostring(AlertEntities.ResourceName)\\r\\n| extend EntityType = tostring(AlertEntities.Type)\\r\\n| distinct Entity, EntityType;\\r\\nlet dnsEntities = AlertEntities\\r\\n| where AlertEntities.Type == \\\"dns\\\"\\r\\n| extend Entity = tostring(AlertEntities.DomainName)\\r\\n| extend EntityType = tostring(AlertEntities.Type)\\r\\n| distinct Entity, EntityType;\\r\\nAlertEntities\\r\\n| where AlertEntities.Type == \\\"url\\\"\\r\\n| extend Entity = tostring(AlertEntities.Url)\\r\\n| extend EntityType = tostring(AlertEntities.Type)\\r\\n| distinct Entity, EntityType\\r\\n| union IPEntities, AccountEntities, HostEntities, filehashEntities, fileEntities, nestedFileHashEntities, appEntities, azresEntities, malwareEntities, domResIdEntities, dnsEntities\\r\\n| where isnotempty(Entity)\\r\\n| order by EntityType asc\",\"size\":1,\"title\":\"Entities\",\"noDataMessage\":\"Select an alert to show Entities\",\"noDataMessageStyle\":2,\"exportedParameters\":[{\"fieldName\":\"Entity\",\"parameterName\":\"EntityData\",\"defaultValue\":\"None\"},{\"fieldName\":\"EntityType\",\"parameterName\":\"EntityType\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"25\",\"conditionalVisibilities\":[{\"parameterName\":\"Alerts\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"}],\"name\":\"EntitiesByIncident\"}],\"exportParameters\":true},\"conditionalVisibility\":{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Incident\"},\"name\":\"IncidentGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### Bookmark Insights\\r\\n---\\r\\n\\r\\n\"},\"name\":\"text - 20\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"947f6af6-e8c1-4f6b-b457-693af446156a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"CreatedBy\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"HuntingBookmark\\r\\n| extend Entities = parse_json(QueryResultRow).__entityMapping\\r\\n| summarize arg_max(TimeGenerated, CreatedBy) by BookmarkId\\r\\n| extend CreatedBy = tostring(parse_json(CreatedBy).Email)\\r\\n| distinct CreatedBy\\r\\n| sort by CreatedBy asc\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"288cf7d8-a8c8-411d-b913-e9f21429a5ff\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"LastModifiedBy\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"HuntingBookmark\\r\\n| extend Entities = parse_json(QueryResultRow).__entityMapping\\r\\n| summarize arg_max(TimeGenerated, UpdatedBy) by BookmarkId\\r\\n| extend UpdatedBy = tostring(parse_json(UpdatedBy).Email)\\r\\n| distinct UpdatedBy\\r\\n| sort by UpdatedBy asc\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"BookmarkParam\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"HuntingBookmark\\r\\n| extend Entities = parse_json(QueryResultRow).__entityMapping\\r\\n| summarize arg_max(TimeGenerated, BookmarkName, CreatedBy, UpdatedBy, CreatedTime, Notes, Tags) by BookmarkId\\r\\n| extend CreatedBy = tostring(parse_json(CreatedBy).Email)\\r\\n| extend UpdatedBy = tostring(parse_json(UpdatedBy).Email)\\r\\n| where CreatedBy in ({CreatedBy})\\r\\n| where UpdatedBy in ({LastModifiedBy})\\r\\n| sort by TimeGenerated desc\\r\\n| project BookmarkName, CreatedBy, UpdatedBy, Notes, Tags, BookmarkId\",\"size\":0,\"title\":\"Bookmarks\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"BookmarkId\",\"exportParameterName\":\"BookmarkId\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"BookmarkId\",\"formatter\":5}]}},\"customWidth\":\"75\",\"name\":\"query - 21\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"HuntingBookmark\\r\\n//| where TimeGenerated > ago(14d)\\r\\n| where BookmarkId == \\\"{BookmarkId}\\\"\\r\\n| extend Entities = parse_json(QueryResultRow).__entityMapping\\r\\n| summarize arg_max(TimeGenerated, Entities) by BookmarkId\\r\\n| extend splitEntities = split(replace(@'[\\\"{}]', '', tostring(Entities)),',')\\r\\n| mv-expand splitEntities\\r\\n| extend splitEntity = split(splitEntities, ':')\\r\\n| extend EntityType = tolower(splitEntity[1]), Entity = splitEntity[0]\\r\\n| where isnotempty(Entity)\\r\\n| project Entity, EntityType\",\"size\":0,\"title\":\"Entities\",\"noDataMessage\":\"Select a bookmark to see entities.\",\"noDataMessageStyle\":2,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportedParameters\":[{\"fieldName\":\"Entity\",\"parameterName\":\"EntityData\",\"parameterType\":1},{\"fieldName\":\"EntityType\",\"parameterName\":\"EntityType\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"25\",\"name\":\"query - 21 - Copy\"}],\"exportParameters\":true},\"conditionalVisibility\":{\"parameterName\":\"investigateBy\",\"comparison\":\"isEqualTo\",\"value\":\"Bookmark\"},\"name\":\"BookmarkGroup\"},{\"type\":1,\"content\":{\"json\":\"### Entity Insights\\r\\n---\\r\\nChoose an Entity Type to investigate by.\"},\"name\":\"InvestigationHeader\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"2d86a4e0-881d-475f-9bfb-0baf99010471\",\"cellValue\":\"InvestigationType\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Investigate IP Address\",\"subTarget\":\"IP\",\"style\":\"link\"},{\"id\":\"5cfe0f82-d29c-4a9a-b7dd-f329fb7b988b\",\"cellValue\":\"InvestigationType\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Investigate Account\",\"subTarget\":\"Account\",\"style\":\"link\"},{\"id\":\"e8b98a6c-26b9-4ab8-a6c3-cfae76da70a9\",\"cellValue\":\"InvestigationType\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Investigate Host\",\"subTarget\":\"Host\",\"style\":\"link\"},{\"id\":\"1f808e56-e32f-436b-8154-b9b78fece9e6\",\"cellValue\":\"InvestigationType\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Investigate URL\",\"subTarget\":\"URL\",\"style\":\"link\"},{\"id\":\"cb986821-e409-4938-98d1-8e33e7478145\",\"cellValue\":\"InvestigationType\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Investigate File Hash\",\"subTarget\":\"FileHash\",\"style\":\"link\"},{\"id\":\"7720a8f8-10e8-4be3-b980-fe6d6bb45b6d\",\"cellValue\":\"InvestigationType\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Full Search\",\"subTarget\":\"Search\",\"style\":\"link\"},{\"id\":\"0ba1e996-2122-44c4-8794-423ddbecba02\",\"cellValue\":\"InvestigationType\",\"linkTarget\":\"parameter\",\"linkLabel\":\"{GlobalCustomTabName}\",\"subTarget\":\"Custom\",\"style\":\"link\"}]},\"name\":\"InvestigationLinks\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"d492cada-966f-484b-b527-d41ba2ddd1a3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IPAddress\",\"type\":1,\"isRequired\":true,\"query\":\"datatable(Entity:string, EntityType:string)\\r\\n\\t[\\\"{EntityData}\\\",\\\"{EntityType}\\\"]\\r\\n| where EntityType =~ \\\"ip\\\"\\r\\n| project Entity\",\"crossComponentResources\":[\"{Workspace}\"],\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"IP\"},\"name\":\"parameters - 8\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"d3818dec-355b-49b0-a2ba-e119da14844a\",\"cellValue\":\"IPNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Active Accounts\",\"subTarget\":\"Accounts\",\"preText\":\"\",\"style\":\"link\"},{\"id\":\"c4a505ba-ae31-4fa6-bbbc-659d0b27d036\",\"cellValue\":\"IPNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Network\",\"subTarget\":\"Network\",\"preText\":\"\",\"style\":\"link\"},{\"id\":\"ca04718e-3a80-42bd-b6c5-e5acadbc0a1d\",\"cellValue\":\"IPNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Normalized Network (Preview)\",\"subTarget\":\"NormalizedNetwork\",\"style\":\"link\"},{\"id\":\"08336f47-fe4b-4ba4-989c-d265aff3207d\",\"cellValue\":\"IPNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"IOCs\",\"subTarget\":\"IOC\",\"style\":\"link\"},{\"id\":\"c96ba98d-c211-419b-8abf-ea25772ab122\",\"cellValue\":\"IPNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Related Alerts & Bookmarks\",\"subTarget\":\"Related\",\"style\":\"link\"},{\"id\":\"de7adc45-b859-4753-a05f-58fb2b00e434\",\"cellValue\":\"IPNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"{IPCustomTabName}\",\"subTarget\":\"Custom\",\"style\":\"link\"}]},\"name\":\"links - 4\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let Office = OfficeActivity\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where ClientIP == \\\"{IPAddress}\\\"\\r\\n| extend UPN = tolower(UserId)\\r\\n| summarize Count=count() by UPN;\\r\\nlet AAD = SigninLogs\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where IPAddress == \\\"{IPAddress}\\\"\\r\\n| extend UPN = tolower(UserPrincipalName)\\r\\n| project UPN\\r\\n| summarize Count=count() by UPN;\\r\\nAzureActivity\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where CallerIpAddress == \\\"{IPAddress}\\\"\\r\\n| extend UPN = tolower(Caller)\\r\\n| project UPN\\r\\n| summarize Count=count() by UPN\\r\\n| union AAD, Office\\r\\n| summarize Count=sum(Count) by UPN\\r\\n| sort by Count desc\",\"size\":4,\"title\":\"Accounts Active from IP\",\"exportFieldName\":\"UPN\",\"exportParameterName\":\"UPN\",\"exportDefaultValue\":\"AllUPNs\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"UPN\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"IP\"},\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where IPAddress == \\\"{IPAddress}\\\"\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\" or \\\"AllUPNs\\\" == \\\"{UPN}\\\"\\r\\n| summarize Count=count() by AppDisplayName\",\"size\":1,\"title\":\"AAD Signin\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"IP\"},\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OfficeActivity\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where ClientIP == \\\"{IPAddress}\\\"\\r\\n| where UserId =~ \\\"{UPN}\\\" or \\\"AllUPNs\\\" == \\\"{UPN}\\\"\\r\\n| summarize Count=count() by Operation\",\"size\":1,\"title\":\"Office Activity\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"IP\"},\"name\":\"query - 10 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureActivity\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where CallerIpAddress == \\\"{IPAddress}\\\"\\r\\n| where Caller =~ \\\"{UPN}\\\" or \\\"AllUPNs\\\" == \\\"{UPN}\\\"\\r\\n| summarize Count=count() by OperationNameValue\",\"size\":1,\"title\":\"Azure Activity\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\"},\"customWidth\":\"33\",\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"IP\"},\"name\":\"query - 10 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let Office = OfficeActivity\\r\\n| where UserId =~ \\\"{UPN}\\\" or \\\"AllUPNs\\\" == \\\"{UPN}\\\"\\r\\n| where ClientIP == \\\"{IPAddress}\\\"\\r\\n| extend UPN = tolower(UserId)\\r\\n| project TimeGenerated, ResultType=ResultStatus, UPN, AppOrAction=Operation, Details=Parameters, Source=\\\"OfficeActivity\\\";\\r\\nlet AAD = SigninLogs\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\" or \\\"AllUPNs\\\" == \\\"{UPN}\\\"\\r\\n| where IPAddress == \\\"{IPAddress}\\\"\\r\\n| extend UPN = tolower(UserPrincipalName)\\r\\n| project TimeGenerated, ResultType, UPN, AppOrAction=AppDisplayName, Details=ResultDescription, Source=\\\"SigninLogs\\\";\\r\\nAzureActivity\\r\\n| where Caller =~ \\\"{UPN}\\\" or \\\"AllUPNs\\\" == \\\"{UPN}\\\"\\r\\n| where CallerIpAddress == \\\"{IPAddress}\\\"\\r\\n| extend UPN = tolower(Caller)\\r\\n| project TimeGenerated, ResultType=ActivityStatus, UPN, AppOrAction=OperationNameValue, Details=ResourceId, Source=\\\"AzureActivity\\\"\\r\\n| union AAD, Office\\r\\n| sort by TimeGenerated desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Activity Detail\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"query - 4\"}]},\"conditionalVisibility\":{\"parameterName\":\"IPNav\",\"comparison\":\"isEqualTo\",\"value\":\"Accounts\"},\"name\":\"IPAccounts\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IPList = dynamic([\\\"{IPAddress}\\\"]);\\r\\n(union isfuzzy=true\\r\\n(CommonSecurityLog  //Final\\r\\n| where isnotempty(SourceIP) or isnotempty(DestinationIP)\\r\\n| where SourceIP in (IPList) or DestinationIP in (IPList) or Message has_any (IPList)\\r\\n| extend IPMatch = case(SourceIP in (IPList), \\\"SourceIP\\\", DestinationIP in (IPList), \\\"DestinationIP\\\", \\\"Message\\\") \\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by Computer, CommunicationDirection, FirewallAction=DeviceAction, Protocol, SourceIP, DestinationIP, tostring(DestinationPort), IPMatch, Type),\\r\\n(VMConnection //Final\\r\\n| where isnotempty(SourceIp) or isnotempty(DestinationIp) \\r\\n| where SourceIp in (IPList) or DestinationIp in (IPList) \\r\\n| extend IPMatch = case( SourceIp in (IPList), \\\"SourceIP\\\", DestinationIp in (IPList), \\\"DestinationIP\\\", \\\"None\\\") \\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by Computer, CommunicationDirection=Direction, Protocol, SourceIP=SourceIp, DestinationIP=DestinationIp, tostring(DestinationPort), IPMatch, Type\\r\\n),\\r\\n(WindowsFirewall //Final\\r\\n| where isnotempty(SourceIP) or isnotempty(DestinationIP) \\r\\n| where SourceIP in (IPList) or DestinationIP in (IPList) \\r\\n| extend IPMatch = case( SourceIP in (IPList), \\\"SourceIP\\\", DestinationIP in (IPList), \\\"DestinationIP\\\", \\\"None\\\") \\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by Computer, CommunicationDirection, FirewallAction, Protocol, SourceIP, DestinationIP, tostring(DestinationPort), IPMatch, Type\\r\\n),\\r\\n(W3CIISLog //Final\\r\\n| where isnotempty(cIP)\\r\\n| where cIP in (IPList) or sIP in (IPList)\\r\\n| extend IPMatch = case( cIP in (IPList), \\\"SourceIP\\\", sIP in (IPList), \\\"DestinationIP\\\", \\\"None\\\") \\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by Computer, CommunicationDirection=\\\"Inbound\\\", SourceIP=cIP, DestinationIP=sIP, DestinationPort=tostring(sPort), IPMatch, Type\\r\\n)\\r\\n)\\r\\n| summarize Count=sum(Count) by Type\\r\\n| sort by Count desc\",\"size\":4,\"title\":\"Network Activity\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Type\",\"exportParameterName\":\"LogType\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"Network Overview\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IPList = dynamic([\\\"{IPAddress}\\\"]);\\r\\n(union isfuzzy=true\\r\\n(CommonSecurityLog  //Final\\r\\n| where isnotempty(SourceIP) or isnotempty(DestinationIP)\\r\\n| where SourceIP in (IPList) or DestinationIP in (IPList) or Message has_any (IPList)\\r\\n| extend IPMatch = case(SourceIP in (IPList), \\\"SourceIP\\\", DestinationIP in (IPList), \\\"DestinationIP\\\", \\\"Message\\\") \\r\\n| summarize Count=count() by IPMatch),\\r\\n(VMConnection //Final\\r\\n| where isnotempty(SourceIp) or isnotempty(DestinationIp) \\r\\n| where SourceIp in (IPList) or DestinationIp in (IPList) \\r\\n| extend IPMatch = case( SourceIp in (IPList), \\\"SourceIP\\\", DestinationIp in (IPList), \\\"DestinationIP\\\", \\\"None\\\") \\r\\n| summarize Count=count() by IPMatch\\r\\n),\\r\\n(WindowsFirewall //Final\\r\\n| where isnotempty(SourceIP) or isnotempty(DestinationIP) \\r\\n| where SourceIP in (IPList) or DestinationIP in (IPList) \\r\\n| extend IPMatch = case( SourceIP in (IPList), \\\"SourceIP\\\", DestinationIP in (IPList), \\\"DestinationIP\\\", \\\"None\\\") \\r\\n| summarize Count=count() by IPMatch\\r\\n),\\r\\n(W3CIISLog //Final\\r\\n| where isnotempty(cIP)\\r\\n| where cIP in (IPList) or sIP in (IPList)\\r\\n| extend IPMatch = case( cIP in (IPList), \\\"SourceIP\\\", sIP in (IPList), \\\"DestinationIP\\\", \\\"None\\\") \\r\\n| summarize Count=count() by IPMatch\\r\\n)\\r\\n)\\r\\n| summarize Count=sum(Count) by IPMatch\\r\\n| sort by Count desc\",\"size\":4,\"title\":\"IPMatch\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"IPMatch\",\"exportParameterName\":\"IPMatch\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"IPMatch\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"IP Match\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IPList = dynamic([\\\"{IPAddress}\\\"]);\\r\\n(union isfuzzy=true\\r\\n(CommonSecurityLog  //Final\\r\\n| where isnotempty(SourceIP) or isnotempty(DestinationIP)\\r\\n| where SourceIP in (IPList) or DestinationIP in (IPList) or Message has_any (IPList)\\r\\n| extend IPMatch = case(SourceIP in (IPList), \\\"SourceIP\\\", DestinationIP in (IPList), \\\"DestinationIP\\\", \\\"Message\\\") \\r\\n| where IPMatch =~ \\\"{IPMatch}\\\" or \\\"{IPMatch}\\\" =~ \\\"None\\\"\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by Computer, CommunicationDirection, FirewallAction=DeviceAction, Protocol, SourceIP, DestinationIP, tostring(DestinationPort), IPMatch, Type),\\r\\n(VMConnection //Final\\r\\n| where isnotempty(SourceIp) or isnotempty(DestinationIp) \\r\\n| where SourceIp in (IPList) or DestinationIp in (IPList) \\r\\n| extend IPMatch = case( SourceIp in (IPList), \\\"SourceIP\\\", DestinationIp in (IPList), \\\"DestinationIP\\\", \\\"None\\\") \\r\\n| where IPMatch =~ \\\"{IPMatch}\\\" or \\\"{IPMatch}\\\" =~ \\\"None\\\"\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by Computer, CommunicationDirection=Direction, Protocol, SourceIP=SourceIp, DestinationIP=DestinationIp, tostring(DestinationPort), IPMatch, Type\\r\\n),\\r\\n(WindowsFirewall //Final\\r\\n| where isnotempty(SourceIP) or isnotempty(DestinationIP) \\r\\n| where SourceIP in (IPList) or DestinationIP in (IPList) \\r\\n| extend IPMatch = case( SourceIP in (IPList), \\\"SourceIP\\\", DestinationIP in (IPList), \\\"DestinationIP\\\", \\\"None\\\") \\r\\n| where IPMatch =~ \\\"{IPMatch}\\\" or \\\"{IPMatch}\\\" =~ \\\"None\\\"\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by Computer, CommunicationDirection, FirewallAction, Protocol, SourceIP, DestinationIP, tostring(DestinationPort), IPMatch, Type\\r\\n),\\r\\n(W3CIISLog //Final\\r\\n| where isnotempty(cIP)\\r\\n| where cIP in (IPList) or sIP in (IPList)\\r\\n| extend IPMatch = case( cIP in (IPList), \\\"SourceIP\\\", sIP in (IPList), \\\"DestinationIP\\\", \\\"None\\\") \\r\\n| where IPMatch =~ \\\"{IPMatch}\\\" or \\\"{IPMatch}\\\" =~ \\\"None\\\"\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by Computer, CommunicationDirection=\\\"Inbound\\\", SourceIP=cIP, DestinationIP=sIP, DestinationPort=tostring(sPort), IPMatch, Type\\r\\n)\\r\\n)\\r\\n| where Type =~ \\\"{LogType}\\\" or \\\"{LogType}\\\" =~ \\\"None\\\"\\r\\n| sort by LastOccurance desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Network Activity Details\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"Network\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DnsEvents\\r\\n| where ResultCode == 0\\r\\n| where IPAddresses contains \\\"{IPAddress}\\\" or ClientIP =~ \\\"{IPAddress}\\\"\\r\\n| extend IPMatch = iff(ClientIP =~ \\\"{IPAddress}\\\", \\\"DNSClientIP\\\", \\\"IPAddressAnswer\\\")\\r\\n| summarize Count=count() by IPMatch\\r\\n| sort by Count desc\",\"size\":4,\"title\":\"DNS Query Details\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"IPMatch\",\"exportParameterName\":\"DNSIPMatch\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"IPMatch\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = DnsEvents\\r\\n| where ResultCode == 0\\r\\n| where IPAddresses contains \\\"{IPAddress}\\\" or ClientIP =~ \\\"{IPAddress}\\\"\\r\\n| extend IPMatch = iff(ClientIP =~ \\\"{IPAddress}\\\", \\\"DNSClientIP\\\", \\\"IPAddressAnswer\\\")\\r\\n| where IPMatch =~ \\\"{DNSIPMatch}\\\" or \\\"{DNSIPMatch}\\\" =~ \\\"None\\\"\\r\\n| extend queryID = strcat(Computer, ClientIP, IPAddresses, Name, QueryType);\\r\\ndata\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by DNSServer=Computer, DNSClientIP=ClientIP, IPAddressAnswer=IPAddresses, Name, QueryType, IPMatch, queryID\\r\\n| join kind = inner (data\\r\\n| make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by queryID) on queryID \\r\\n| project-away TimeGenerated, queryID, queryID1\\r\\n| project DNSServer, DNSClientIP, IPAddressAnswer, Name, QueryType, IPMatch, Trend, FirstOccurance, LastOccurance, Count\\r\\n| sort by LastOccurance desc\",\"size\":1,\"showAnalytics\":true,\"title\":\"DNS Query Details\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blue\"}}]}},\"name\":\"DNSQueryDetails\"}]},\"conditionalVisibility\":{\"parameterName\":\"IPNav\",\"comparison\":\"isEqualTo\",\"value\":\"Network\"},\"name\":\"IPNetwork\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"#### Network normalization\\r\\n\\r\\nThis section of the workbook uses a normalized schema for network and requires the installation of parsers in your workspace to function.  Please use the references below to setup the Network Normalization parsers.\\r\\n\\r\\n- [Normalization in Azure Sentinel](https://docs.microsoft.com/azure/sentinel/normalization)\\r\\n- [GitHub - Normalized Schema - Networking](https://github.com/Azure/Azure-Sentinel/tree/master/Parsers/Normalized%20Schema%20-%20Networking%20&#40;v1.0.0&#41;)\",\"style\":\"info\"},\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Network_MetaParser\\r\\n| where SrcIpAddr == \\\"{IPAddress}\\\" or DstIpAddr == \\\"{IPAddress}\\\"\\r\\n| extend IPMatch = iff(SrcIpAddr == \\\"{IPAddress}\\\", \\\"Source IP Match\\\", \\\"Destination IP Match\\\")\\r\\n| summarize Count = count() by IPMatch\\r\\n| order by Count\",\"size\":4,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"IPMatch\",\"exportParameterName\":\"IPMatch\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"IPMatch\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Network_MetaParser\\r\\n| where SrcIpAddr == \\\"{IPAddress}\\\" or DstIpAddr == \\\"{IPAddress}\\\"\\r\\n| extend IPMatch = iff(SrcIpAddr == \\\"{IPAddress}\\\", \\\"Source IP Match\\\", \\\"Destination IP Match\\\")\\r\\n| where IPMatch == \\\"{IPMatch}\\\" or \\\"{IPMatch}\\\" == \\\"All\\\"\\r\\n| summarize Count = count() by FirewallAction=DvcAction\\r\\n| order by Count\",\"size\":0,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"FirewallAction\",\"exportParameterName\":\"FirewallAction\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"blue\",\"compositeBarSettings\":{\"labelText\":\"\",\"columnSettings\":\"[]\"}}}]}},\"customWidth\":\"25\",\"name\":\"FirewallActionQuery\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Network_MetaParser\\r\\n| where SrcIpAddr == \\\"{IPAddress}\\\" or DstIpAddr == \\\"{IPAddress}\\\"\\r\\n| where DvcAction == \\\"{FirewallAction}\\\" or \\\"{FirewallAction}\\\" == \\\"All\\\"\\r\\n| extend IPMatch = iff(SrcIpAddr == \\\"{IPAddress}\\\", \\\"Source IP Match\\\", \\\"Destination IP Match\\\")\\r\\n| where IPMatch == \\\"{IPMatch}\\\" or \\\"{IPMatch}\\\" == \\\"All\\\"\\r\\n| summarize Count = count() by SourceIP = SrcIpAddr\\r\\n| order by Count\",\"size\":0,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"SourceIP\",\"exportParameterName\":\"SourceIP\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"blue\"}}]}},\"customWidth\":\"25\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Network_MetaParser\\r\\n| where SrcIpAddr == \\\"{IPAddress}\\\" or DstIpAddr == \\\"{IPAddress}\\\"\\r\\n| where DvcAction == \\\"{FirewallAction}\\\" or \\\"{FirewallAction}\\\" == \\\"All\\\"\\r\\n| where SrcIpAddr == \\\"{SourceIP}\\\" or \\\"{SourceIP}\\\" == \\\"All\\\"\\r\\n| extend IPMatch = iff(SrcIpAddr == \\\"{IPAddress}\\\", \\\"Source IP Match\\\", \\\"Destination IP Match\\\")\\r\\n| where IPMatch == \\\"{IPMatch}\\\" or \\\"{IPMatch}\\\" == \\\"All\\\"\\r\\n| summarize Count = count() by DestinationIP = DstIpAddr\\r\\n| order by Count\",\"size\":0,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"DestinationIP\",\"exportParameterName\":\"DestinationIP\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"blue\"}}]}},\"customWidth\":\"25\",\"name\":\"query - 0 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Network_MetaParser\\r\\n| where SrcIpAddr == \\\"{IPAddress}\\\" or DstIpAddr == \\\"{IPAddress}\\\"\\r\\n| where DvcAction == \\\"{FirewallAction}\\\" or \\\"{FirewallAction}\\\" == \\\"All\\\"\\r\\n| where SrcIpAddr == \\\"{SourceIP}\\\" or \\\"{SourceIP}\\\" == \\\"All\\\"\\r\\n| where DstIpAddr == \\\"{DestinationIP}\\\" or \\\"{DestinationIP}\\\" == \\\"All\\\"\\r\\n| extend IPMatch = iff(SrcIpAddr == \\\"{IPAddress}\\\", \\\"Source IP Match\\\", \\\"Destination IP Match\\\")\\r\\n| where IPMatch == \\\"{IPMatch}\\\" or \\\"{IPMatch}\\\" == \\\"All\\\"\\r\\n| summarize Count = count() by DestinationPort = DstPortNumber\\r\\n| order by Count\",\"size\":0,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"DestinationPort\",\"exportParameterName\":\"DestinationPort\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"blue\"}}]}},\"customWidth\":\"25\",\"name\":\"query - 0 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Network_MetaParser\\r\\n| where SrcIpAddr == \\\"{IPAddress}\\\" or DstIpAddr == \\\"{IPAddress}\\\"\\r\\n| where DvcAction == \\\"{FirewallAction}\\\" or \\\"{FirewallAction}\\\" == \\\"All\\\"\\r\\n| where SrcIpAddr == \\\"{SourceIP}\\\" or \\\"{SourceIP}\\\" == \\\"All\\\"\\r\\n| where DstIpAddr == \\\"{DestinationIP}\\\" or \\\"{DestinationIP}\\\" == \\\"All\\\"\\r\\n| where DstPortNumber == \\\"{DestinationPort}\\\" or \\\"{DestinationPort}\\\" == \\\"All\\\"\\r\\n| extend IPMatch = iff(SrcIpAddr == \\\"{IPAddress}\\\", \\\"Source IP Match\\\", \\\"Destination IP Match\\\")\\r\\n| where IPMatch == \\\"{IPMatch}\\\" or \\\"{IPMatch}\\\" == \\\"All\\\"\\r\\n| summarize Count = count() by ReportingProdcut = EventProduct, SourceIP = SrcIpAddr, DestinationIP = DstIpAddr, DestinationPort = DstPortNumber, ApplicationLayerProtocol = NetworkApplicationProtocol, NetworkProtocol = NetworkProtocol, DeviceAction = DvcAction\\r\\n| order by Count\",\"size\":0,\"showAnalytics\":true,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"blue\"}}]}},\"name\":\"query - 4\"}]},\"conditionalVisibility\":{\"parameterName\":\"IPNav\",\"comparison\":\"isEqualTo\",\"value\":\"NormalizedNetwork\"},\"name\":\"NormalizedNetworkGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated > ago(180d)\\r\\n| where NetworkIP == \\\"{IPAddress}\\\"\\r\\n| summarize arg_max(TimeGenerated, Active) by IndicatorId, SourceSystem, Description, ThreatType\\r\\n| project SourceSystem, Description, ThreatType, Active\",\"size\":4,\"title\":\"IP Threat Intelligence\",\"noDataMessage\":\"No Threat Intelligence was found for the selected IP.\",\"noDataMessageStyle\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"IP\"},\"name\":\"query - 13\"}]},\"conditionalVisibility\":{\"parameterName\":\"IPNav\",\"comparison\":\"isEqualTo\",\"value\":\"IOC\"},\"name\":\"IPIOC\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where Entities contains \\\"\\\"\\\"IP\\\"\\\"\\\"\\r\\n| extend AllEntities = parse_json(Entities)\\r\\n| mv-expand AllEntities\\r\\n| where AllEntities.Type == \\\"ip\\\" and AllEntities.Address == \\\"{IPAddress}\\\"\\r\\n| project AlertSeverity, AlertName=DisplayName, ProviderName, AlertDetails=Entities, SystemAlertId\",\"size\":4,\"title\":\"Related Security Alerts\",\"noDataMessage\":\"No Security Alerts were found for the selected IP.\",\"noDataMessageStyle\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":5}]}},\"customWidth\":\"50\",\"name\":\"query - 13 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"HuntingBookmark\\r\\n| where TimeGenerated {TimeRange}\\r\\n| extend Entities = parse_json(QueryResultRow).__entityMapping\\r\\n| where Entities contains \\\"\\\"\\\"ip\\\"\\\"\\\" //Entity Type to match\\r\\n| summarize arg_max(TimeGenerated, BookmarkName, Notes, Tags, Entities) by BookmarkId\\r\\n| extend splitEntities = split(replace(@'[\\\"{}]', '', tostring(Entities)),',')\\r\\n| mv-expand splitEntities\\r\\n| extend splitEntity = split(splitEntities, ':')\\r\\n| where splitEntity[1] =~ \\\"ip\\\"\\r\\n| where splitEntity[0] =~ \\\"{IPAddress}\\\"\\r\\n| project BookmarkName, Notes, Tags\",\"size\":4,\"title\":\"Related Bookmarks\",\"noDataMessage\":\"No Bookmarks were found for the selected IP.\",\"noDataMessageStyle\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":5}]}},\"customWidth\":\"50\",\"name\":\"query - 13 - Copy - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"IPNav\",\"comparison\":\"isEqualTo\",\"value\":\"Related\"},\"name\":\"IPRelated\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"loadType\":\"always\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## To use this custom group, switch the group type from \\\"Editable\\\" to \\\"From Template\\\" and enter the ID of your custom workbook\"},\"name\":\"text - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"IPNav\",\"comparison\":\"isEqualTo\",\"value\":\"Custom\"},\"name\":\"CustomGroupIP\"}]},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"IP\"},\"name\":\"IPGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"7d4ef622-5d81-47ef-b07a-13624db7dda2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"UPN\",\"type\":1,\"isRequired\":true,\"query\":\"datatable(Entity:string, EntityType:string)\\r\\n\\t[\\\"{EntityData}\\\",\\\"{EntityType}\\\"]\\r\\n| where EntityType =~ \\\"account\\\"\\r\\n| extend Entity = iff(Entity contains \\\"@\\\", Entity, strcat(Entity, \\\"@\\\", \\\"{DefaultUPNSuffix}\\\"))\\r\\n| project Entity\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"d6455f34-39bd-479a-937e-96f69e6c85b1\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"samAccountName\",\"type\":1,\"query\":\"(union isfuzzy=true\\r\\n(datatable(UPN:string, Priority:int)\\r\\n\\t[\\\"{UPN}\\\", 1]\\r\\n| extend samAccountName = split(UPN, \\\"@\\\", 0)\\r\\n| project samAccountName=tostring(samAccountName[0]), Priority),\\r\\n(IdentityInfo\\r\\n| where TimeGenerated > ago(180d)\\r\\n| where AccountUPN =~ \\\"{UPN}\\\"\\r\\n| summarize arg_max(TimeGenerated, *) by AccountUPN\\r\\n| project samAccountName=AccountName, Priority=toint(2)))\\r\\n| top 1 by Priority desc\\r\\n| project-away Priority\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"a3c1474c-0fe4-4105-8928-38dc9ceffb34\",\"cellValue\":\"UserNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Location Anomalies\",\"subTarget\":\"Location\",\"style\":\"link\"},{\"id\":\"997a8794-1da5-4bf0-94cc-952977f1e2ef\",\"cellValue\":\"UserNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Computer Logons\",\"subTarget\":\"Logons\",\"style\":\"link\"},{\"id\":\"65ef8c1a-12a1-475d-8c80-ae1950d2b82c\",\"cellValue\":\"UserNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Conditional Access Analysis\",\"subTarget\":\"CAP\",\"style\":\"link\"},{\"id\":\"b3237117-0e48-46c0-827e-dfbeb8cb6b1c\",\"cellValue\":\"UserNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"IOCs\",\"subTarget\":\"IOC\",\"style\":\"link\"},{\"id\":\"54e10cc1-6fa7-4458-bcdf-4d42196298a1\",\"cellValue\":\"UserNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Related Alerts & Bookmarks\",\"subTarget\":\"Alerts\",\"style\":\"link\"},{\"id\":\"01c23b0f-e0be-4f72-a933-fe64d55b6b85\",\"cellValue\":\"UserNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"{AccountCustomTabName}\",\"subTarget\":\"Custom\",\"style\":\"link\"}]},\"name\":\"links - 5\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let UPN = \\\"{UPN}\\\";\\r\\nlet CommonLocation = SigninLogs\\r\\n| where UserPrincipalName =~ UPN\\r\\n| extend LAT = round(todouble(LocationDetails.geoCoordinates.latitude), 1)\\r\\n| extend LONG = round(todouble(LocationDetails.geoCoordinates.longitude), 1)\\r\\n| summarize Count=count() by LAT, LONG\\r\\n| top 1 by Count;\\r\\nlet CommonLAT = toscalar(CommonLocation\\r\\n| project LAT);\\r\\nlet CommonLONG = toscalar(CommonLocation\\r\\n| project LONG);\\r\\nSigninLogs\\r\\n| where UserPrincipalName =~ UPN\\r\\n| extend LAT = round(todouble(LocationDetails.geoCoordinates.latitude), 1)\\r\\n| extend LONG = round(todouble(LocationDetails.geoCoordinates.longitude), 1)\\r\\n| extend KmFromTypicalLocation = geo_distance_2points(CommonLONG, CommonLAT, LONG, LAT) / 1000\\r\\n| summarize Count=count() by IPAddress, KmFromTypicalLocation, AppDisplayName, ResultDescription\\r\\n| sort by KmFromTypicalLocation desc\\r\\n\",\"size\":0,\"title\":\"Distance from Typical Signin Location\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"IPAddress\",\"exportParameterName\":\"IP\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"KmFromTypicalLocation\",\"formatter\":8,\"formatOptions\":{\"min\":100,\"max\":1000,\"palette\":\"greenRed\",\"aggregation\":\"Average\"}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"}}]}},\"customWidth\":\"50\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let UPN = \\\"{UPN}\\\";\\r\\nlet CommonLocation = SigninLogs\\r\\n| where UserPrincipalName =~ UPN\\r\\n| extend LAT = round(todouble(LocationDetails.geoCoordinates.latitude), 1)\\r\\n| extend LONG = round(todouble(LocationDetails.geoCoordinates.longitude), 1)\\r\\n| summarize Count=count() by LAT, LONG\\r\\n| top 1 by Count;\\r\\nlet CommonLAT = toscalar(CommonLocation\\r\\n| project LAT);\\r\\nlet CommonLONG = toscalar(CommonLocation\\r\\n| project LONG);\\r\\nSigninLogs\\r\\n| where UserPrincipalName =~ UPN\\r\\n| extend LAT = round(todouble(LocationDetails.geoCoordinates.latitude), 1)\\r\\n| extend LONG = round(todouble(LocationDetails.geoCoordinates.longitude), 1)\\r\\n| extend KmFromTypicalLocation = geo_distance_2points(CommonLONG, CommonLAT, LONG, LAT) / 1000\\r\\n| extend LocationString= strcat(tostring(LocationDetails[\\\"countryOrRegion\\\"]), \\\"/\\\", tostring(LocationDetails[\\\"state\\\"]), \\\"/\\\", tostring(LocationDetails[\\\"city\\\"]))\\r\\n| summarize Count=count() by IPAddress, KmFromTypicalLocation, LAT, LONG, LocationString\\r\\n\",\"size\":0,\"title\":\"Signin Map\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"map\",\"mapSettings\":{\"locInfo\":\"LatLong\",\"latitude\":\"LAT\",\"longitude\":\"LONG\",\"sizeSettings\":\"Count\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"LocationString\",\"legendMetric\":\"Count\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"KmFromTypicalLocation\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\",\"heatmapMin\":100,\"heatmapMax\":1000}}},\"customWidth\":\"50\",\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\"\\r\\n| where IPAddress == \\\"{IP}\\\"\\r\\n| extend ResultDetail = iff(ResultType == 0, \\\"Success\\\", ResultDescription)\\r\\n| parse AuthenticationDetails with * '[' AuthDetails ']' *\\r\\n| project TimeGenerated, AppDisplayName, ResourceDisplayName, ResultDetail, ClientAppUsed, ConditionalAccessStatus, AuthDetails, DeviceDetail, LocationDetails, IPAddress, RiskDetail, RiskState\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Signin Details\",\"noDataMessage\":\"Select a Signin from the grid to see additional details\",\"noDataMessageStyle\":2,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AuthDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"DeviceDetail\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"LocationDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}}]}},\"name\":\"query - 6\"}]},\"conditionalVisibility\":{\"parameterName\":\"UserNav\",\"comparison\":\"isEqualTo\",\"value\":\"Location\"},\"name\":\"LocationAnomalies\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"bdcb9616-6e17-4694-a76a-49fb9de8ae2a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SigninStatus\",\"type\":2,\"isRequired\":true,\"value\":\">= 0\",\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"jsonData\":\"[\\r\\n    {\\r\\n        \\\"label\\\": \\\"Successful Logons\\\",\\r\\n        \\\"value\\\": \\\"== 0\\\"\\r\\n    },\\r\\n    {\\r\\n        \\\"label\\\": \\\"Failed Logons\\\",\\r\\n        \\\"value\\\": \\\"<> 0\\\"\\r\\n    },\\r\\n    {\\r\\n        \\\"label\\\": \\\"All Logons\\\",\\r\\n        \\\"value\\\": \\\">= 0\\\"\\r\\n    }\\r\\n]\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\"},{\"id\":\"17a6b0e5-3d86-4ba2-94ac-795bdd692378\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"PolicyName\",\"type\":2,\"isRequired\":true,\"query\":\"SigninLogs\\r\\n| mv-expand ConditionalAccessPolicies\\r\\n| distinct tostring(ConditionalAccessPolicies.displayName)\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":\"value::1\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\"]},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"d880b501-931f-4659-a360-94d5c519ddc4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"PolicyResult\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SigninLogs\\r\\n| mv-expand ConditionalAccessPolicies\\r\\n| distinct tostring(ConditionalAccessPolicies.result)\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let FilteredSignin = SigninLogs\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where Status.errorCode {SigninStatus}\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\"\\r\\n| mv-expand ConditionalAccessPolicies\\r\\n| where ConditionalAccessPolicies.displayName =~ \\\"{PolicyName}\\\" or \\\"{PolicyName:label}\\\" =~ \\\"Any one\\\"\\r\\n| where ConditionalAccessPolicies.result in ({PolicyResult})\\r\\n| distinct Id;\\r\\nSigninLogs\\r\\n| where Id in (FilteredSignin)\\r\\n| extend errorCode = Status.errorCode\\r\\n| extend SigninStatus = case(errorCode == 0, \\\"Success\\\", errorCode == 50058, \\\"Pending user action\\\",errorCode == 50140, \\\"Pending user action\\\", errorCode == 51006, \\\"Pending user action\\\", errorCode == 50059, \\\"Pending user action\\\",errorCode == 65001, \\\"Pending user action\\\", errorCode == 52004, \\\"Pending user action\\\", errorCode == 50055, \\\"Pending user action\\\", errorCode == 50144, \\\"Pending user action\\\", errorCode == 50072, \\\"Pending user action\\\", errorCode == 50074, \\\"Pending user action\\\", errorCode == 16000, \\\"Pending user action\\\", errorCode == 16001, \\\"Pending user action\\\", errorCode == 16003, \\\"Pending user action\\\", errorCode == 50127, \\\"Pending user action\\\", errorCode == 50125, \\\"Pending user action\\\", errorCode == 50129, \\\"Pending user action\\\", errorCode == 50143, \\\"Pending user action\\\", errorCode == 81010, \\\"Pending user action\\\", errorCode == 81014, \\\"Pending user action\\\", errorCode == 81012 ,\\\"Pending user action\\\", \\\"Failure\\\")\\r\\n| extend LocationString= strcat(tostring(LocationDetails[\\\"countryOrRegion\\\"]), \\\"/\\\", tostring(LocationDetails[\\\"state\\\"]), \\\"/\\\", tostring(LocationDetails[\\\"city\\\"]))\\r\\n| project TimeGenerated, Location=LocationString, IPAddress, AppDisplayName, ResourceDisplayName, ResultDescription, ['Sign-in Status'] = strcat(iff(SigninStatus == 'Success', '', ''), ' ', SigninStatus), Id\\r\\n| sort by TimeGenerated desc\",\"size\":0,\"title\":\"AAD Signins\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Id\",\"exportParameterName\":\"SigninId\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Id\",\"formatter\":5},{\"columnMatch\":\"DeviceDetail\",\"formatter\":1}]}},\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where Status.errorCode {SigninStatus}\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\"\\r\\n| where Id == \\\"{SigninId}\\\"\\r\\n| extend errorCode = Status.errorCode\\r\\n| extend SigninStatus = case(errorCode == 0, \\\"Success\\\", errorCode == 50058, \\\"Pending user action\\\",errorCode == 50140, \\\"Pending user action\\\", errorCode == 51006, \\\"Pending user action\\\", errorCode == 50059, \\\"Pending user action\\\",errorCode == 65001, \\\"Pending user action\\\", errorCode == 52004, \\\"Pending user action\\\", errorCode == 50055, \\\"Pending user action\\\", errorCode == 50144, \\\"Pending user action\\\", errorCode == 50072, \\\"Pending user action\\\", errorCode == 50074, \\\"Pending user action\\\", errorCode == 16000, \\\"Pending user action\\\", errorCode == 16001, \\\"Pending user action\\\", errorCode == 16003, \\\"Pending user action\\\", errorCode == 50127, \\\"Pending user action\\\", errorCode == 50125, \\\"Pending user action\\\", errorCode == 50129, \\\"Pending user action\\\", errorCode == 50143, \\\"Pending user action\\\", errorCode == 81010, \\\"Pending user action\\\", errorCode == 81014, \\\"Pending user action\\\", errorCode == 81012 ,\\\"Pending user action\\\", \\\"Failure\\\")\\r\\n| extend LocationString= strcat(tostring(LocationDetails[\\\"countryOrRegion\\\"]), \\\"/\\\", tostring(LocationDetails[\\\"state\\\"]), \\\"/\\\", tostring(LocationDetails[\\\"city\\\"]))\\r\\n| project TimeGenerated, ['Sign-in Status'] = strcat(iff(SigninStatus == 'Success', '', ''), ' ', SigninStatus), ResultDescription, Id\\r\\n| sort by TimeGenerated asc\",\"size\":4,\"title\":\"AAD Signin Sequence\",\"noDataMessage\":\"Select a Signin to see the Logon Sequence\",\"noDataMessageStyle\":2,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Id\",\"formatter\":5},{\"columnMatch\":\"DeviceDetail\",\"formatter\":1}]}},\"customWidth\":\"50\",\"name\":\"query - 5 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where Status.errorCode {SigninStatus}\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\"\\r\\n| where Id == \\\"{SigninId}\\\"\\r\\n| distinct tostring(DeviceDetail), UserAgent\",\"size\":4,\"title\":\"Device and UserAgent Detail\",\"noDataMessage\":\"Select a Signin to see Device and UserAgent Details\",\"noDataMessageStyle\":2,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceDetail\",\"formatter\":1}]}},\"customWidth\":\"50\",\"name\":\"query - 5 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where Status.errorCode {SigninStatus}\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\"\\r\\n| where Id =~ \\\"{SigninId}\\\"\\r\\n| mv-expand ConditionalAccessPolicies\\r\\n| where ConditionalAccessPolicies.displayName =~ \\\"{PolicyName}\\\" or \\\"{PolicyName:label}\\\" =~ \\\"Any one\\\"\\r\\n| where ConditionalAccessPolicies.result in ({PolicyResult})\\r\\n| extend errorCode = Status.errorCode\\r\\n| extend SigninStatus = case(errorCode == 0, \\\"Success\\\", errorCode == 50058, \\\"Pending user action\\\",errorCode == 50140, \\\"Pending user action\\\", errorCode == 51006, \\\"Pending user action\\\", errorCode == 50059, \\\"Pending user action\\\",errorCode == 65001, \\\"Pending user action\\\", errorCode == 52004, \\\"Pending user action\\\", errorCode == 50055, \\\"Pending user action\\\", errorCode == 50144, \\\"Pending user action\\\", errorCode == 50072, \\\"Pending user action\\\", errorCode == 50074, \\\"Pending user action\\\", errorCode == 16000, \\\"Pending user action\\\", errorCode == 16001, \\\"Pending user action\\\", errorCode == 16003, \\\"Pending user action\\\", errorCode == 50127, \\\"Pending user action\\\", errorCode == 50125, \\\"Pending user action\\\", errorCode == 50129, \\\"Pending user action\\\", errorCode == 50143, \\\"Pending user action\\\", errorCode == 81010, \\\"Pending user action\\\", errorCode == 81014, \\\"Pending user action\\\", errorCode == 81012 ,\\\"Pending user action\\\", \\\"Failure\\\")\\r\\n| project TimeGenerated, ['Sign-in Status'] = strcat(iff(SigninStatus == 'Success', '', ''), ' ', SigninStatus), GrantControl=ConditionalAccessPolicies.enforcedGrantControls, ConditionalAccessPolicyName=ConditionalAccessPolicies.displayName, ConditionalAccessResult=ConditionalAccessPolicies.result, MfaDetail\\r\\n| sort by TimeGenerated asc\",\"size\":0,\"title\":\"Conditional Access Policy Details\",\"noDataMessage\":\"Select a Login to see Conditional Access Details\",\"noDataMessageStyle\":2,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceDetail\",\"formatter\":1}]}},\"name\":\"query - 5 - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"UserNav\",\"comparison\":\"isEqualTo\",\"value\":\"CAP\"},\"name\":\"ConditionalAccess\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let eStatus = dynamic([\\\"0xC000006A\\\", \\\"0xC0000234\\\", \\\"0x18\\\"]);\\r\\nlet secEventID = dynamic([4771, 4625, 4776]);\\r\\nlet secEvents = SecurityEvent\\r\\n| where TargetUserName =~ \\\"{samAccountName}\\\"\\r\\n| where EventID in (secEventID)\\r\\n| where Level == 16\\r\\n| where (EventID == 4625 and SubStatus in~ (eStatus)) or (EventID == 4771 and Status in~ (eStatus)) or (EventID == 4776 and Status in~ (eStatus))\\r\\n| extend ResultStatus = case(EventID == 4625, SubStatus, Status)\\r\\n| extend SourceNameorIP = case(EventID == 4776, Workstation, (EventID == 4625 and isnotempty(WorkstationName)), WorkstationName, IpAddress)\\r\\n| extend ResultDescription = case(EventID == 4625, strcat(Activity, '  Logon type: ', LogonTypeName), Activity)\\r\\n| summarize FirstOccurance = min(TimeGenerated), LastOccurance = max(TimeGenerated), FailedSigninCount=count(), LocationCount=dcount(SourceNameorIP) by TargetUserName, SourceNameorIP, ResultDescription, StatusCode=ResultStatus\\r\\n| extend LogSource = \\\"SecurityEvent\\\";\\r\\nSigninLogs\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\"\\r\\n// Error codes that we want to look at as they are related to the use of incorrect password.\\r\\n| where ResultType in (\\\"50126\\\", \\\"50053\\\" , \\\"50055\\\", \\\"50056\\\")\\r\\n| extend OS = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser \\r\\n| extend LocationString= strcat(tostring(LocationDetails[\\\"countryOrRegion\\\"]), \\\"/\\\", tostring(LocationDetails[\\\"state\\\"]), \\\"/\\\", tostring(LocationDetails[\\\"city\\\"]))\\r\\n| summarize FirstOccurance = min(TimeGenerated), LastOccurance = max(TimeGenerated), FailedSigninCount=count(), LocationCount=dcount(LocationString) by TargetUserName=UserPrincipalName, SourceNameorIP=IPAddress, LocationString, AppDisplayName, ResultDescription, tostring(Browser), tostring(OS), StatusCode=ResultType\\r\\n| extend LogSource = \\\"SigninLogs\\\"\\r\\n| union secEvents\\r\\n| project TargetUserName, SourceNameorIP, ResultDescription, StatusCode, LocationString, AppDisplayName, Browser, OS, FirstOccurance, LastOccurance, FailedSigninCount, LocationCount, LogSource\",\"size\":1,\"showAnalytics\":true,\"title\":\"Failed Signin - Bad Password\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"(union isfuzzy=true\\r\\n(SecurityEvent\\r\\n| where EventID in (\\\"4723\\\",\\\"4724\\\")\\r\\n| where TargetUserName =~ \\\"{samAccountName}\\\" or SubjectUserName =~ \\\"{samAccountName}\\\"\\r\\n| extend Result = case(Level==8, \\\"success\\\", Level==16, \\\"failure\\\", \\\"unknown\\\")\\r\\n| project TimeGenerated, InitiatedBy=SubjectUserName, Username=TargetUserName, OperationName=Activity, Result\\r\\n),\\r\\n(AuditLogs\\r\\n| where OperationName contains \\\"password\\\"\\r\\n| sort by TimeGenerated desc\\r\\n| extend InitiatedBy = tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName)\\r\\n| extend Username = tostring(TargetResources[0].userPrincipalName)\\r\\n| where Username =~ \\\"{UPN}\\\" or InitiatedBy =~ \\\"{UPN}\\\"\\r\\n| project TimeGenerated, InitiatedBy, Username, OperationName, Result\\r\\n))\\r\\n| sort by TimeGenerated desc\",\"size\":1,\"showAnalytics\":true,\"title\":\"Password Change and Resets\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"Passwords\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"(union isfuzzy=true\\r\\n(AuditLogs \\r\\n| where OperationName =~ \\\"Disable Strong Authentication\\\"\\r\\n| extend IPAddress = tostring(parse_json(tostring(InitiatedBy.user)).ipAddress) \\r\\n| extend InitiatedByUser = iff(isnotempty(tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName)), \\r\\n tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName), tostring(parse_json(tostring(InitiatedBy.app)).displayName))\\r\\n| extend Targetprop = todynamic(TargetResources)\\r\\n| extend TargetUser = tostring(Targetprop[0].userPrincipalName) \\r\\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated) by User = TargetUser, InitiatedByUser , Operation = OperationName , CorrelationId, IPAddress, Category, Source = SourceSystem , AADTenantId, Type\\r\\n),\\r\\n(AWSCloudTrail\\r\\n| where EventName in~ (\\\"DeactivateMFADevice\\\", \\\"DeleteVirtualMFADevice\\\") \\r\\n| extend InstanceProfileName = tostring(parse_json(RequestParameters).InstanceProfileName)\\r\\n| extend TargetUser = tostring(parse_json(RequestParameters).userName)\\r\\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated) by User = TargetUser, Source = EventSource , Operation = EventName , TenantorInstance_Detail = InstanceProfileName, IPAddress = SourceIpAddress\\r\\n)\\r\\n)\\r\\n| where User =~ \\\"{UPN}\\\" or InitiatedByUser =~ \\\"{UPN}\\\"\",\"size\":4,\"showAnalytics\":true,\"title\":\"Disabled MFA\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\"\\r\\n| where Status.errorCode == 500121\\r\\n| where Status.additionalDetails contains \\\"fraud\\\"\\r\\n| project TimeGenerated, AppDisplayName, IPAddress, Status=Status.additionalDetails, AuthenticationDetails, DeviceDetail, LocationDetails\",\"size\":4,\"showAnalytics\":true,\"title\":\"MFA Fraud Reports\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AuthenticationDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"DeviceDetail\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"LocationDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}}]}},\"customWidth\":\"50\",\"name\":\"query - 1 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AuditLogs\\r\\n| where TimeGenerated > ago(90d)\\r\\n| where OperationName == \\\"Consent to application\\\"\\r\\n| where Category == \\\"ApplicationManagement\\\"\\r\\n| extend UserPrincipalName = InitiatedBy.user.userPrincipalName\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\"\\r\\n| mv-expand TargetResources\\r\\n| extend ModifiedProperties = TargetResources.modifiedProperties\\r\\n| mv-apply ModifiedProperties on (\\r\\n    summarize Consent = make_bag(pack(tostring(ModifiedProperties.displayName), ModifiedProperties.newValue)))\\r\\n| project TimeGenerated, ActivityDisplayName, UserPrincipalName, isAdminConsent=Consent.['ConsentContext.IsAdminConsent'], isAppOnly=Consent.['ConsentContext.IsAppOnly'], OnBehalfOfAll=Consent.['ConsentContext.OnBehalfOfAll'], ResourceServicePrincipalName=Consent.['TargetId.ServicePrincipalNames'], ResourceDisplayName=TargetResources.displayName, Permissions=Consent.['ConsentAction.Permissions']\",\"size\":4,\"showAnalytics\":true,\"title\":\"Application Consent\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"query - Consent\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"(union isfuzzy=true\\r\\n(OfficeActivity \\r\\n| where UserId =~ \\\"{UPN}\\\"\\r\\n| where Operation =~ \\\"Set-Mailbox\\\" \\r\\n| extend parsed = parse_json(Parameters) \\r\\n| extend FieldType = tostring(parsed[1].Name)\\r\\n| where FieldType =~ \\\"ForwardTo\\\" or FieldType =~ \\\"ForwardingSmtpAddress\\\" \\r\\n| extend ForwardTo = tostring(parsed[1].Value)\\r\\n| extend ForwardType = tostring(parsed[2].Name)\\r\\n| project TimeGenerated, UserId, ClientIP=split(ClientIP, \\\":\\\", 0)[0], ForwardTo, ForwardType\\r\\n),\\r\\n(OfficeActivity \\r\\n| where UserId =~ \\\"{UPN}\\\"\\r\\n| where Operation =~ \\\"New-InboxRule\\\"\\r\\n| mv-expand parse_json(Parameters)\\r\\n| extend ParamType = tostring(Parameters.Name)\\r\\n| where ParamType =~ \\\"ForwardTo\\\"\\r\\n| extend ForwardTo = tostring(Parameters.Value)\\r\\n| project TimeGenerated, UserId, ClientIP=split(ClientIP, \\\":\\\", 0)[0], ForwardTo, ForwardType=\\\"InboxRule\\\"\\r\\n))\\r\\n| sort by TimeGenerated desc\",\"size\":4,\"showAnalytics\":true,\"title\":\"Mailbox Forwarding Rules\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"BehaviorAnalytics\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\"\\r\\n| where InvestigationPriority > 0\\r\\n| project TimeGenerated, InvestigationPriority, ActivityType, ActionType, SourceIPLocation, UsersInsights, DevicesInsights, ActivityInsights\\r\\n| sort by InvestigationPriority desc\",\"size\":0,\"title\":\"UEBA Investigation Priorities\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UsersInsights\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"DevicesInsights\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"ActivityInsights\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}}]}},\"name\":\"query - 4\"}]},\"conditionalVisibility\":{\"parameterName\":\"UserNav\",\"comparison\":\"isEqualTo\",\"value\":\"IOC\"},\"name\":\"UserIOCs\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where Entities contains \\\"\\\"\\\"account\\\"\\\"\\\"\\r\\n| extend AllEntities = parse_json(Entities)\\r\\n| mv-expand AllEntities\\r\\n| where AllEntities.Type == \\\"account\\\"\\r\\n| extend AccountEntity = iff(isnotempty(AllEntities.UPNSuffix), strcat(AllEntities.Name, '@', AllEntities.UPNSuffix), AllEntities.Name)\\r\\n| where AccountEntity =~ \\\"{UPN}\\\" or AccountEntity =~ \\\"{samAccountName}\\\"\\r\\n| project AlertSeverity, AlertName=DisplayName, ProviderName, AlertDetails=Entities, SystemAlertId\",\"size\":0,\"title\":\"Related Security Alerts\",\"noDataMessage\":\"No Security Alerts were found for the selected Account.\",\"noDataMessageStyle\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":5}]}},\"customWidth\":\"50\",\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"HuntingBookmark\\r\\n| where TimeGenerated {TimeRange}\\r\\n| extend Entities = parse_json(QueryResultRow).__entityMapping\\r\\n| where Entities contains \\\"\\\"\\\"account\\\"\\\"\\\" //Entity Type to match\\r\\n| summarize arg_max(TimeGenerated, BookmarkName, Notes, Tags, Entities) by BookmarkId\\r\\n| extend splitEntities = split(replace(@'[\\\"{}]', '', tostring(Entities)),',')\\r\\n| mv-expand splitEntities\\r\\n| extend splitEntity = split(splitEntities, ':')\\r\\n| where splitEntity[1] =~ \\\"account\\\"\\r\\n| where splitEntity[0] =~ \\\"{UPN}\\\" or splitEntity[0] =~ \\\"{samAccountName}\\\"\\r\\n| project BookmarkName, Notes, Tags\",\"size\":0,\"title\":\"Related Bookmarks\",\"noDataMessage\":\"No Bookmarks were found for the selected Account.\",\"noDataMessageStyle\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":5}]}},\"customWidth\":\"50\",\"name\":\"query - 4 - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"UserNav\",\"comparison\":\"isEqualTo\",\"value\":\"Alerts\"},\"name\":\"RelatedAlerts\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"805e76ac-979e-4247-a304-f3897fa71be6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"LogonType\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"let events = dynamic([4624, 4625, 4768, 4771]);\\r\\nlet kerbevents = dynamic([4768, 4771]);\\r\\n(union isfuzzy=true\\r\\n(SigninLogs\\r\\n| take 1\\r\\n| project LogonType=\\\"AAD/HDJ\\\"),\\r\\n(SecurityEvent\\r\\n| where EventID in (events)\\r\\n| where TargetUserName =~ \\\"{samAccountName}\\\"\\r\\n| extend LogonType = iff(EventID in (kerbevents), \\\"Kerberos TGT\\\", LogonTypeName)\\r\\n| distinct LogonType),\\r\\n(DeviceLogonEvents\\r\\n| where AccountName =~ \\\"{samAccountName}\\\"\\r\\n| distinct LogonType))\\r\\n| sort by LogonType asc\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let events = dynamic([4624, 4625, 4768, 4771]);\\r\\nlet kerbevents = dynamic([4768, 4771]);\\r\\n(union isfuzzy=true \\r\\n(SigninLogs\\r\\n| where UserPrincipalName =~ \\\"{UPN}\\\"\\r\\n| where AppDisplayName == \\\"Windows Sign In\\\"\\r\\n| extend LogonResult = iff(ResultType == 0, \\\"Success\\\", \\\"Failure\\\")\\r\\n| summarize Count=count(), FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated) by LogonComputerOrIP=tostring(DeviceDetail.displayName), LogonResult, LogonType=\\\"AAD/HDJ\\\", ErrorCode=ResultType, DataSource=Type),\\r\\n(SecurityEvent\\r\\n| where EventID in (events)\\r\\n| where TargetUserName =~ \\\"{samAccountName}\\\"\\r\\n| extend LogonResult = iff(Level == 8, \\\"Success\\\", \\\"Failure\\\")\\r\\n| extend LogonType = iff(EventID in (kerbevents), \\\"Kerberos TGT\\\", LogonTypeName)\\r\\n| extend LogonComputerOrIP = iff(EventID == 4768, IpAddress, Computer)\\r\\n| extend ErrorCode = iff(EventID in (kerbevents), Status, SubStatus)\\r\\n| summarize Count=count(), FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated) by LogonComputerOrIP, LogonResult, LogonType, ErrorCode, DataSource=Type),\\r\\n(DeviceLogonEvents\\r\\n| where AccountName =~ \\\"{samAccountName}\\\"\\r\\n| summarize Count=count(), FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated) by LogonComputerOrIP=DeviceName, LogonResult=ActionType, LogonType, DataSource=Type))\\r\\n| where LogonType in ({LogonType})\\r\\n| sort by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Computer Logons\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"Computer Logons\"}]},\"conditionalVisibility\":{\"parameterName\":\"UserNav\",\"comparison\":\"isEqualTo\",\"value\":\"Logons\"},\"name\":\"UserLogons\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"loadType\":\"always\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## To use this custom group, switch the group type from \\\"Editable\\\" to \\\"From Template\\\" and enter the ID of your custom workbook\"},\"name\":\"text - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"UserNav\",\"comparison\":\"isEqualTo\",\"value\":\"Custom\"},\"name\":\"CustomGroupAccount\"}]},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Account\"},\"name\":\"AccountGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"8ae96068-86fb-4713-9497-6424e724251f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Host\",\"label\":\"Host FQDN\",\"type\":1,\"isRequired\":true,\"query\":\"datatable(Entity:string, EntityType:string)\\r\\n\\t[\\\"{EntityData}\\\",\\\"{EntityType}\\\"]\\r\\n| where EntityType =~ \\\"Host\\\"\\r\\n| project Entity\",\"crossComponentResources\":[\"{Workspace}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Host\"},\"name\":\"parameters - 17\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"5a523135-ffeb-4217-9a78-5db3af6e0292\",\"cellValue\":\"HostNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"New Processes\",\"subTarget\":\"hostAnomaly\",\"style\":\"link\"},{\"id\":\"c0a3eb1f-186c-4e14-8559-aa17385eba12\",\"cellValue\":\"HostNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Account Logons\",\"subTarget\":\"accountLogons\",\"style\":\"link\"},{\"id\":\"622de805-7326-42e5-9b9a-f26f9ce7bbce\",\"cellValue\":\"HostNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Security Baseline\",\"subTarget\":\"securityBaseline\",\"style\":\"link\"},{\"id\":\"3435d945-dd0b-4b7f-9a38-4a915eecebbf\",\"cellValue\":\"HostNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Suspicious Changes\",\"subTarget\":\"suspiciousChanges\",\"style\":\"link\"},{\"id\":\"d914883d-4e94-4b23-ae39-0b9516d7248b\",\"cellValue\":\"HostNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Related Alerts & Bookmarks\",\"subTarget\":\"relatedAlerts\",\"style\":\"link\"},{\"id\":\"2868ddcc-a4e9-4e19-a5d0-602cd8e5b6d7\",\"cellValue\":\"HostNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"{HostCustomTabName}\",\"subTarget\":\"Custom\",\"style\":\"link\"}]},\"name\":\"links - 2\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"7506e1db-61f7-43d4-827b-b0a7e4d96ccb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"HostAnomalies\",\"label\":\"Choose Host Anomaly\",\"type\":10,\"description\":\"Toggle New Logons and Rare Processes\",\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Rare Procs\\\", \\\"label\\\": \\\"Rare Procs\\\"},\\r\\n {\\\"value\\\": \\\"New Logons\\\", \\\"label\\\": \\\"New Logons\\\", \\\"selected\\\":true }\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"Rare Procs\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibilities\":[{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Host\"},{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"hostAnomaly\"},{\"parameterName\":\"Fake\",\"comparison\":\"isEqualTo\",\"value\":\"True\"}],\"name\":\"parameters - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let starttime = ({TimeRange:seconds}s + 90d);\\r\\nlet endtime = {TimeRange:seconds}s;\\r\\nlet ProcessCreationEvents=() {\\r\\nlet processEvents=SecurityEvent\\r\\n| where EventID==4688\\r\\n| where Computer =~ \\\"{Host}\\\"\\r\\n| where TimeGenerated >= ago(starttime) \\r\\n| project TimeGenerated, ComputerName=Computer,AccountName=SubjectUserName, AccountDomain=SubjectDomainName, ProcessPath=NewProcessName, FileName=tostring(split(NewProcessName, '\\\\\\\\')[(-1)]), ProcessCommandLine = CommandLine, InitiatingProcessFileName=ParentProcessName,InitiatingProcessCommandLine='',InitiatingProcessParentFileName='';\\r\\nprocessEvents};\\r\\nlet allHostsProcessEvents = SecurityEvent\\r\\n| where EventID==4688\\r\\n| where TimeGenerated >= ago(starttime) \\r\\n| summarize AllHostsWhereProcessObserved=make_set(Computer), UniqueHosts=dcount(Computer) by FileName=tostring(split(NewProcessName, '\\\\\\\\')[(-1)]);\\r\\nProcessCreationEvents\\r\\n| where TimeGenerated >= ago(starttime) and TimeGenerated < ago(endtime)\\r\\n| summarize count(), arg_max(TimeGenerated, ProcessPath) by FileName\\r\\n| join kind=rightanti (\\r\\n    ProcessCreationEvents\\r\\n    | where TimeGenerated >= ago(endtime)\\r\\n    | summarize FirstOccurance = min(TimeGenerated), LastOccurance = arg_max(TimeGenerated, ProcessPath) by FileName\\r\\n) on FileName\\r\\n| project FileName, ProcessPath, FirstOccurance, LastOccurance\\r\\n| join kind=leftouter allHostsProcessEvents on FileName\\r\\n| project FileName, ProcessPath, FirstOccurance, LastOccurance, AllHostsWhereProcessObserved, UniqueHosts\\r\\n\\r\\n\",\"size\":0,\"title\":\"New Processes on Host {Host} observed during {TimeRange:label}\",\"exportFieldName\":\"FileName\",\"exportParameterName\":\"process\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true,\"sortBy\":[{\"itemKey\":\"FileName\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"FileName\",\"label\":\"File Name\"}]},\"sortBy\":[{\"itemKey\":\"FileName\",\"sortOrder\":2}]},\"conditionalVisibilities\":[{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"hostAnomaly\"},{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Host\"},{\"parameterName\":\"HostAnomalies\",\"comparison\":\"isEqualTo\",\"value\":\"Rare Procs\"}],\"name\":\"query - 12\"},{\"type\":1,\"content\":{\"json\":\"*A New Logon is defined as a Logon to the Host from an Account for the first time in seven days.*\"},\"conditionalVisibilities\":[{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"hostAnomaly\"},{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Host\"},{\"parameterName\":\"HostAnomalies\",\"comparison\":\"isEqualTo\",\"value\":\"New Logons\"}],\"name\":\"text - 17\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Replace this with Brian's query and description\\r\\nlet starttime = 7d;\\r\\nlet endtime = 1d;\\r\\nlet LogonEvents=() { \\r\\nlet logonSuccess=SecurityEvent \\r\\n| where EventID==4624\\r\\n| where tolower(Computer) contains tolower(\\\"{Host}\\\")\\r\\n| where TargetUserName !endswith \\\"$\\\"\\r\\n| where TargetUserName !contains \\\"NETWORK SERVICE\\\"\\r\\n| where TargetUserName !contains \\\"LOCAL SERVICE\\\"\\r\\n| where TargetUserName != \\\"SYSTEM\\\"\\r\\n| project TimeGenerated, ComputerName=Computer, AccountName=TargetUserName, AccountDomain=TargetDomainName, IpAddress, ActionType='Logon';\\r\\nlet logonFail=SecurityEvent \\r\\n| where EventID==4625\\r\\n| where tolower(Computer) contains tolower(\\\"{Host}\\\")\\r\\n| where TargetUserName !endswith \\\"$\\\"\\r\\n| where TargetUserName !contains \\\"NETWORK SERVICE\\\"\\r\\n| where TargetUserName !contains \\\"LOCAL SERVICE\\\"\\r\\n| where TargetUserName != \\\"SYSTEM\\\"\\r\\n| project TimeGenerated, ComputerName=Computer, AccountName=TargetUserName, AccountDomain=TargetDomainName, IpAddress, ActionType='LogonFailure';\\r\\nlogonFail \\r\\n| union logonSuccess\\r\\n};\\r\\nLogonEvents \\r\\n| where TimeGenerated > ago(endtime) \\r\\n| where ActionType == 'Logon' \\r\\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), count() by ComputerName, AccountName \\r\\n| join kind=leftanti ( \\r\\nLogonEvents \\r\\n| where TimeGenerated between(ago(starttime)..ago(endtime)) \\r\\n| where ActionType == 'Logon' \\r\\n| summarize count() by ComputerName, AccountName \\r\\n) on ComputerName, AccountName \\r\\n//| summarize StartTimeUtc = min(StartTimeUtc), EndTimeUtc = max(EndTimeUtc), HostCount=dcount(ComputerName), HostSet=makeset(ComputerName, 10)  by AccountName, ComputerName\\r\\n| summarize count() by AccountName\\r\\n//| extend timestamp = StartTimeUtc, AccountCustomEntity = AccountName\\r\\n\",\"size\":3,\"title\":\"Click to filter by Account\",\"timeContext\":{\"durationMs\":86400000},\"exportFieldName\":\"AccountName\",\"exportParameterName\":\"Account\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"sortBy\":\"[]\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"AccountName\",\"formatter\":1},\"showBorder\":false},\"chartSettings\":{\"group\":\"AccountName\",\"createOtherGroup\":10}},\"conditionalVisibilities\":[{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"hostAnomaly\"},{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Host\"},{\"parameterName\":\"HostAnomalies\",\"comparison\":\"isEqualTo\",\"value\":\"New Logons\"}],\"name\":\"query - 16 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let starttime = 7d;\\r\\nlet endtime = 1d;\\r\\nlet LogonEvents=() { \\r\\nlet logonSuccess=SecurityEvent\\r\\n| where EventID==4624\\r\\n| where tolower(Computer) contains tolower(\\\"{Host}\\\")\\r\\n| where tolower(Account) endswith tolower(\\\"{Account}\\\")\\r\\n| where TargetUserName !endswith \\\"$\\\"\\r\\n| where TargetUserName !contains \\\"NETWORK SERVICE\\\"\\r\\n| where TargetUserName !contains \\\"LOCAL SERVICE\\\"\\r\\n| where TargetUserName != \\\"SYSTEM\\\"\\r\\n| project TimeGenerated, Activity, ComputerName=Computer, AccountName=TargetUserName, AccountDomain=TargetDomainName, IpAddress, ActionType='Logon';\\r\\nlet logonFail=SecurityEvent \\r\\n| where EventID==4625\\r\\n| where tolower(Computer) contains tolower(\\\"{Host}\\\")\\r\\n| where tolower(Account) endswith tolower(\\\"{Account}\\\")\\r\\n| where TargetUserName !endswith \\\"$\\\"\\r\\n| where TargetUserName !contains \\\"NETWORK SERVICE\\\"\\r\\n| where TargetUserName !contains \\\"LOCAL SERVICE\\\"\\r\\n| where TargetUserName != \\\"SYSTEM\\\"\\r\\n| project TimeGenerated, Activity, ComputerName=Computer, AccountName=TargetUserName, AccountDomain=TargetDomainName, IpAddress, ActionType='LogonFailure';\\r\\nlogonFail \\r\\n| union logonSuccess\\r\\n};\\r\\nLogonEvents \\r\\n| where TimeGenerated > ago(endtime) \\r\\n| where ActionType == 'Logon' \\r\\n| summarize FirsttOccurance = min(TimeGenerated), LastOccurance = max(TimeGenerated), count() by ComputerName, AccountName, Activity \\r\\n| join kind=leftanti ( \\r\\nLogonEvents \\r\\n| where TimeGenerated between(ago(starttime)..ago(endtime)) \\r\\n| where ActionType == 'Logon' \\r\\n| summarize count() by ComputerName, AccountName \\r\\n) on ComputerName, AccountName\\r\\n| summarize FirsttOccurance = min(FirsttOccurance), LastOccurance = max(LastOccurance), Count=dcount(AccountName) by AccountName, Activity\",\"size\":1,\"title\":\"New logons to Host Filtered by Account\",\"noDataMessage\":\"Click on an Account above to perform the query.\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"sortBy\":\"[]\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"AccountName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"HostCount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"AccountName\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"HostCount\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"HostCount\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"HostCount\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"HostCount\",\"heatmapPalette\":\"greenRed\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"hostAnomaly\"},{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Host\"},{\"parameterName\":\"HostAnomalies\",\"comparison\":\"isEqualTo\",\"value\":\"New Logons\"}],\"name\":\"query - 16 - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"hostAnomaly\"},\"name\":\"HostAnomaly\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let starttime = 7d;\\r\\nlet endtime = 1d;\\r\\nlet LogonEvents=() { \\r\\nlet logonSuccess=SecurityEvent\\r\\n| where EventID==4624\\r\\n| where tolower(Computer) contains tolower(\\\"{Host}\\\")\\r\\n| where TargetUserName !endswith \\\"$\\\"\\r\\n| where TargetUserName !contains \\\"NETWORK SERVICE\\\"\\r\\n| where TargetUserName !contains \\\"LOCAL SERVICE\\\"\\r\\n| where TargetUserName != \\\"SYSTEM\\\"\\r\\n| project TimeGenerated, Activity, ComputerName=Computer, AccountName=TargetUserName, AccountDomain=TargetDomainName, IpAddress, ActionType='Logon';\\r\\nlet logonFail=SecurityEvent \\r\\n| where EventID==4625\\r\\n| where tolower(Computer) contains tolower(\\\"{Host}\\\")\\r\\n| where TargetUserName !endswith \\\"$\\\"\\r\\n| where TargetUserName !contains \\\"NETWORK SERVICE\\\"\\r\\n| where TargetUserName !contains \\\"LOCAL SERVICE\\\"\\r\\n| where TargetUserName != \\\"SYSTEM\\\"\\r\\n| project TimeGenerated, Activity, ComputerName=Computer, AccountName=TargetUserName, AccountDomain=TargetDomainName, IpAddress, ActionType='LogonFailure';\\r\\nlogonFail \\r\\n| union logonSuccess\\r\\n};\\r\\nLogonEvents \\r\\n| where TimeGenerated > ago(endtime) \\r\\n| where ActionType == 'Logon' \\r\\n| summarize FirstOccurance = min(TimeGenerated), LastOccurance = max(TimeGenerated), count() by ComputerName, AccountName, Activity \\r\\n| join kind=leftanti ( \\r\\nLogonEvents \\r\\n| where TimeGenerated between(ago(starttime)..ago(endtime)) \\r\\n| where ActionType == 'Logon' \\r\\n| summarize count() by ComputerName, AccountName \\r\\n) on ComputerName, AccountName\\r\\n| summarize FirstOccurance = min(FirstOccurance), LastOccurance = max(LastOccurance), Count=dcount(AccountName) by AccountName, Activity\",\"size\":0,\"showAnalytics\":true,\"title\":\"Details of New Logons to Host\",\"timeContext\":{\"durationMs\":86400000},\"exportFieldName\":\"AccountName\",\"exportParameterName\":\"Account\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"filter\":true,\"labelSettings\":[{\"columnId\":\"AccountName\",\"label\":\"Account Name\"},{\"columnId\":\"Activity\"},{\"columnId\":\"FirstOccurance\",\"label\":\"First Occurance\"},{\"columnId\":\"LastOccurance\",\"label\":\"Last Occurance\"},{\"columnId\":\"Count\"}]},\"sortBy\":\"[]\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"AccountName\",\"formatter\":1},\"showBorder\":false},\"chartSettings\":{\"group\":\"AccountName\",\"createOtherGroup\":10}},\"conditionalVisibilities\":[{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Host\"},{\"parameterName\":\"HostAnomalies\",\"comparison\":\"isEqualTo\",\"value\":\"New Logons\"},{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"hostAnomaly\"}],\"name\":\"query - 16\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let events = dynamic([4624, 4625, 4768, 4771]);\\r\\nlet kerbevents = dynamic([4768, 4771]);\\r\\nlet aadSignIns = SigninLogs\\r\\n| where TimeGenerated > ago(7d)\\r\\n| where AppDisplayName == \\\"Windows Sign In\\\"\\r\\n| extend HostShort = split(\\\"{Host}\\\", \\\".\\\", 0)[0]\\r\\n| where DeviceDetail.displayName contains HostShort\\r\\n| extend LogonResult = iff(ResultType == 0, \\\"Success\\\", \\\"Failure\\\")\\r\\n| summarize Count=count(), FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated) by Account=Identity, LogonResult, LogonType=\\\"AAD/HDJ\\\", ErrorCode=ResultType;\\r\\nSecurityEvent\\r\\n| where EventID in (events)\\r\\n| extend LogonResult = iff(Level == 8, \\\"Success\\\", \\\"Failure\\\")\\r\\n| extend LogonType = iff(EventID in (kerbevents), \\\"Kerberos TGT\\\", LogonTypeName)\\r\\n| extend LogonComputerOrIP = iff(EventID == 4768, IpAddress, Computer)\\r\\n| where Account !contains @\\\"Window Manager\\\\DWM\\\"\\r\\n| extend ErrorCode = iff(EventID in (kerbevents), Status, SubStatus)\\r\\n| where TargetAccount !endswith \\\"$\\\"\\r\\n| where TargetAccount !contains \\\"NT AUTHORITY\\\"\\r\\n| where Computer contains \\\"{Host}\\\"\\r\\n| summarize Count=count(), FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated) by Account, LogonResult, LogonType, ErrorCode\\r\\n| union aadSignIns\\r\\n| sort by Count\",\"size\":0,\"showAnalytics\":true,\"title\":\"Account Logons\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true,\"labelSettings\":[{\"columnId\":\"Account\"},{\"columnId\":\"LogonResult\",\"label\":\"Logon Result\"},{\"columnId\":\"LogonType\",\"label\":\"Logon Type\"},{\"columnId\":\"ErrorCode\",\"label\":\"Error Code\"},{\"columnId\":\"Count\"},{\"columnId\":\"FirstOccurance\",\"label\":\"First Occurance\"},{\"columnId\":\"LastOccurance\",\"label\":\"Last Occurance\"}]}},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Host\"},\"name\":\"query - 13\"}]},\"conditionalVisibility\":{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"accountLogons\"},\"name\":\"AccountLogon\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"7491e67e-bdbd-4f0a-8819-45b65104137d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"securityBaselineOptions\",\"label\":\"Choose Security Check\",\"type\":10,\"description\":\"Choose which security check to perform\",\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Updates\\\", \\\"label\\\": \\\"Updates\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Security Baseline\\\", \\\"label\\\": \\\"Security Baseline\\\" },\\r\\n { \\\"value\\\": \\\"Protection Status\\\", \\\"label\\\": \\\"Protection Status\\\" }\\r\\n]\",\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"securityBaseline\"},\"name\":\"parameters - 15\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let lastRun = toscalar(UpdateSummary\\r\\n| where Computer =~ \\\"{Host}\\\"\\r\\n| summarize max(TimeGenerated));\\r\\nUpdateSummary\\r\\n| where tolower(Computer) == tolower(\\\"{Host}\\\")\\r\\n| where TimeGenerated between((lastRun-5m)..lastRun)\\r\\n//| project CriticalUpdatesMissing, SecurityUpdatesMissing, OtherUpdatesMissing\\r\\n| project TimeGenerated, Computer, CriticalUpdatesMissing, SecurityUpdatesMissing, OtherUpdatesMissing, TotalUpdatesMissing, RestartPending, ComputerEnvironment\",\"size\":4,\"title\":\"Update Summary filtered by Update Check\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CriticalUpdatesMissing\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">\",\"thresholdValue\":\"0\",\"representation\":\"red\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"SecurityUpdatesMissing\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">\",\"text\":\"{0}{1}\"},{\"thresholdValue\":\"0\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"OtherUpdatesMissing\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">\",\"text\":\"{0}{1}\"},{\"thresholdValue\":\"0\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"TotalUpdatesMissing\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">\",\"thresholdValue\":\"0\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"green\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"RestartPending\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"text\":\"{0}{1}\"}]}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"Time Generated\"},{\"columnId\":\"Computer\"},{\"columnId\":\"CriticalUpdatesMissing\",\"label\":\"Critical Updates Missing\"},{\"columnId\":\"SecurityUpdatesMissing\",\"label\":\"Security Updates Missing\"},{\"columnId\":\"OtherUpdatesMissing\",\"label\":\"Other Updates Missing\"},{\"columnId\":\"TotalUpdatesMissing\",\"label\":\"Total Updates Missing\"},{\"columnId\":\"RestartPending\",\"label\":\"Restart Pending\"},{\"columnId\":\"ComputerEnvironment\",\"label\":\"Computer Environment\"}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"CriticalUpdatesMissing\",\"formatter\":12,\"formatOptions\":{\"min\":1,\"palette\":\"redBright\"}},\"rightContent\":{\"columnMatch\":\"SecurityUpdatesMissing\",\"formatter\":12,\"formatOptions\":{\"min\":1,\"palette\":\"purpleRed\"}},\"secondaryContent\":{\"columnMatch\":\"OtherUpdatesMissing\",\"formatter\":12,\"formatOptions\":{\"palette\":\"yellow\"}},\"showBorder\":false,\"size\":\"auto\"}},\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let lastRun = toscalar(Update\\r\\n| where Computer =~ \\\"{Host}\\\"\\r\\n| summarize max(TimeGenerated));\\r\\nUpdate\\r\\n| where Computer =~ \\\"{Host}\\\"\\r\\n| where TimeGenerated between((lastRun-5m)..lastRun)\\r\\n| where UpdateState != \\\"Installed\\\"\\r\\n| where Classification != \\\"Feature Packs\\\"\\r\\n| project TimeGenerated, Computer, SourceSystem, Title, Classification, PublishedDate, UpdateState, Product, ResourceId, ResourceGroup, RebootBehavior\",\"size\":1,\"title\":\"Required Updates Missing in the Latest Check\",\"noDataMessage\":\"No missing updates.\",\"noDataMessageStyle\":3,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"rowLimit\":500,\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"Time Generated\"},{\"columnId\":\"Computer\"},{\"columnId\":\"SourceSystem\",\"label\":\"Source System\"},{\"columnId\":\"Title\"},{\"columnId\":\"Classification\"},{\"columnId\":\"PublishedDate\",\"label\":\"Published Date\"},{\"columnId\":\"UpdateState\",\"label\":\"Update State\"},{\"columnId\":\"Product\"},{\"columnId\":\"ResourceId\",\"label\":\"Resource ID\"},{\"columnId\":\"ResourceGroup\",\"label\":\"Resource Group\"},{\"columnId\":\"RebootBehavior\",\"label\":\"Reboot Behavior\"}]}},\"name\":\"query - 2\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"securityBaseline\"},{\"parameterName\":\"securityBaselineOptions\",\"comparison\":\"isEqualTo\",\"value\":\"Updates\"}],\"name\":\"updateSummary\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let lastRun = toscalar(SecurityBaselineSummary\\r\\n| where tolower(Computer) == tolower(\\\"{Host}\\\")\\r\\n| summarize max(TimeGenerated));\\r\\nSecurityBaselineSummary\\r\\n| where tolower(Computer) == tolower(\\\"{Host}\\\")\\r\\n| where TimeGenerated == lastRun\\r\\n| project TimeGenerated, Computer, TotalAssessedRules, Type, PercentageOfPassedRules, CriticalFailedRules, WarningFailedRules, InformationalFailedRules\",\"size\":4,\"title\":\"Security Baseline Summary\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"Time Generated\"},{\"columnId\":\"Computer\"},{\"columnId\":\"TotalAssessedRules\",\"label\":\"Total Assessed Rules\"},{\"columnId\":\"Type\"},{\"columnId\":\"PercentageOfPassedRules\",\"label\":\"Percentage of Passed Rules\"},{\"columnId\":\"CriticalFailedRules\",\"label\":\"Critical Failed Rules\"},{\"columnId\":\"WarningFailedRules\",\"label\":\"Warning Failed Rules\"},{\"columnId\":\"InformationalFailedRules\",\"label\":\"Informational Failed Rules\"}]}},\"name\":\"query - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"91e6ebb4-6719-47ac-a49b-9f71cf52b5c3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ruleSeverity\",\"label\":\"Failed Rule Severity Level\",\"type\":2,\"description\":\"Choose severity level of failed rules to display\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityBaseline\\r\\n| where Computer =~ \\\"{Host}\\\"\\r\\n| where AnalyzeResult == \\\"Failed\\\"\\r\\n| where TimeGenerated > ago(24h)\\r\\n| summarize by RuleSeverity\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let currentAssessmentId = toscalar(SecurityBaseline\\r\\n| where Computer =~ \\\"{Host}\\\"\\r\\n| summarize arg_max(TimeGenerated, AssessmentId)\\r\\n| project AssessmentId);\\r\\nSecurityBaseline\\r\\n| where AssessmentId == currentAssessmentId\\r\\n| where AnalyzeResult == \\\"Failed\\\"\\r\\n| where Computer =~ \\\"{Host}\\\"\\r\\n| where RuleSeverity in ({ruleSeverity})\\r\\n| project TimeGenerated, Computer, BaselineType, RuleSeverity, Description, ActualResult, ExpectedResult, AnalyzeOperation\\r\\n| sort by TimeGenerated desc\",\"size\":0,\"title\":\"Failed Security Baselines in the latest check\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"rowLimit\":500,\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"Time Generated\"},{\"columnId\":\"Computer\"},{\"columnId\":\"BaselineType\",\"label\":\"Baseline Type\"},{\"columnId\":\"RuleSeverity\",\"label\":\"Rule Severity\"},{\"columnId\":\"Description\"},{\"columnId\":\"ActualResult\",\"label\":\"Actual Result\"},{\"columnId\":\"ExpectedResult\",\"label\":\"Expected Result\"},{\"columnId\":\"AnalyzeOperation\",\"label\":\"Analyze Operation\"}]}},\"name\":\"query - 17\"}]},\"conditionalVisibility\":{\"parameterName\":\"securityBaselineOptions\",\"comparison\":\"isEqualTo\",\"value\":\"Security Baseline\"},\"name\":\"baseline\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ProtectionStatus\\r\\n| where Computer =~ \\\"{Host}\\\"\\r\\n| summarize Count = count() by ThreatStatus\",\"size\":1,\"title\":\"Host Threat Protection Status - click to filter\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"ThreatStatus\",\"exportParameterName\":\"TS\",\"exportDefaultValue\":\"AllStatus\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"ThreatStatus\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false}},\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ProtectionStatus\\r\\n| where tolower(Computer) == tolower(\\\"{Host}\\\")\\r\\n| where ThreatStatus == \\\"{TS}\\\" or \\\"{TS}\\\" == \\\"AllStatus\\\"\\r\\n| project ThreatStatus, Resource, ScanDate, TypeofProtection, AMProductVersion, ProtectionStatus, ProtectionStatusDetails\\r\\n| sort by ScanDate\",\"size\":0,\"showAnalytics\":true,\"title\":\"Host Protection Status Details - filtered by Threat Status\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true,\"labelSettings\":[{\"columnId\":\"ThreatStatus\",\"label\":\"Threat Status\"},{\"columnId\":\"Resource\"},{\"columnId\":\"ScanDate\",\"label\":\"Scan Date\"},{\"columnId\":\"TypeofProtection\",\"label\":\"Type of Protection\"},{\"columnId\":\"AMProductVersion\",\"label\":\"AM Product Version\"},{\"columnId\":\"ProtectionStatus\",\"label\":\"Protection Status\"},{\"columnId\":\"ProtectionStatusDetails\",\"label\":\"Protection Status Details\"}]}},\"name\":\"query - 1\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"securityBaseline\"},{\"parameterName\":\"securityBaselineOptions\",\"comparison\":\"isEqualTo\",\"value\":\"Protection Status\"}],\"name\":\"protectionStatus\"}]},\"conditionalVisibility\":{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"securityBaseline\"},\"name\":\"securityBaseline\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"0e998788-617f-412a-a435-386106f4ec23\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"suspiciousChanges\",\"label\":\"Suspicious Changes\",\"type\":10,\"description\":\"Toggle Audit Policy Change and Security Log Clear\",\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"jsonData\":\"[\\r\\n{ \\\"value\\\": \\\"Audit Policy Change\\\", \\\"label\\\": \\\"AuditPolChange\\\", \\\"selected\\\":true},\\r\\n{ \\\"value\\\": \\\"Security Log Clear\\\", \\\"label\\\": \\\"SecLogClear\\\"},\\r\\n{ \\\"value\\\": \\\"User Changes\\\", \\\"label\\\": \\\"User/GroupChanges\\\"}\\r\\n]\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 17\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\r\\n| where EventID == \\\"1102\\\"\\r\\n| where tolower(Computer) == tolower(\\\"{Host}\\\")\\r\\n| parse EventData with * 'SubjectUserName>' SubjectUserName '<' *\\r\\n| parse EventData with * 'SubjectDomainName>' SubjectDomainName '<' *\\r\\n| parse EventData with * 'SubjectLogonId>' SubjectLogonId '<' *\\r\\n| project  TimeGenerated, SubjectDomainName, SubjectUserName, Computer, SubjectLogonId\",\"size\":0,\"title\":\"Security Log Clear Details\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"Time Generated\"},{\"columnId\":\"SubjectDomainName\",\"label\":\"Subject Domain Name\"},{\"columnId\":\"SubjectUserName\",\"label\":\"Subject User Name\"},{\"columnId\":\"Computer\"},{\"columnId\":\"SubjectLogonId\",\"label\":\"Subject Logon ID\"}]}},\"conditionalVisibility\":{\"parameterName\":\"suspiciousChanges\",\"comparison\":\"isEqualTo\",\"value\":\"Security Log Clear\"},\"name\":\"query - 15 - Copy\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"97f331c1-33a9-47c5-8fec-d70ea27ef58d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AuditPolicyChangeType\",\"label\":\"Audit Policy Change Type\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityEvent\\r\\n| where EventID == \\\"4719\\\"\\r\\n| where tolower(Computer) == tolower(\\\"{Host}\\\")\\r\\n| where AccountType != \\\"Machine\\\"\\r\\n| extend AuditPolicyChange = case(AuditPolicyChanges == \\\"%%8448\\\", \\\"Success:disable\\\", AuditPolicyChanges == \\\"%%8449\\\", \\\"Success:enable\\\", AuditPolicyChanges == \\\"%%8450\\\", \\\"Failure:disable\\\", AuditPolicyChanges == \\\"%%8451\\\", \\\"Failure:enable\\\", \\\"Failed to Return\\\")\\r\\n| summarize by AuditPolicyChange\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibilities\":[{\"parameterName\":\"suspiciousChanges\",\"comparison\":\"isEqualTo\",\"value\":\"Audit Policy Change\"},{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"suspiciousChanges\"}],\"name\":\"parameters - 17\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\r\\n| where EventID == \\\"4719\\\"\\r\\n| where tolower(Computer) == tolower(\\\"{Host}\\\")\\r\\n| extend AuditSubcategory = case(SubcategoryGuid == \\\"0cce9213-69ae-11d9-bed3-505054503030\\\", \\\"IPSec Driver\\\", SubcategoryGuid == \\\"0cce9212-69ae-11d9-bed3-505054503030\\\", \\\"System Integrity\\\", SubcategoryGuid == \\\"0cce923f-69ae-11d9-Bed3-505054503030\\\", \\\"Credential Valication\\\", SubcategoryGuid == \\\"0cce9241-69ae-11d9-bed3-505054503030\\\", \\\"Other Account Logon Events\\\", SubcategoryGuid == \\\"0cce9211-69ae-11d9-bed3-505054503030\\\", \\\"Security System Extension\\\", SubcategoryGuid == \\\"0cce9210-69ae-11d9-bed3-505054503030\\\", \\\"Security State Change\\\", SubcategoryGuid == \\\"0cce9214-69ae-11d9-bed3-505054503030\\\", \\\"Other System Events\\\", SubcategoryGuid == \\\"0cce9243-69ae-11d9-bed3-505054503030\\\", \\\"Network Policy Server\\\", SubcategoryGuid == \\\"0cce921c-69ae-11d9-bed3-505054503030\\\", \\\"Other Logon/Logoff\\\", SubcategoryGuid == \\\"0cce921b-69ae-11d9-bed3-505054503030\\\", \\\"Special Logon\\\", SubcategoryGuid == \\\"0cce921a-69ae-11d9-bed3-505054503030\\\", \\\"IPsec Extended Mode\\\", SubcategoryGuid == \\\"0cce9219-69ae-11d9-bed3-505054503030\\\", \\\"IPsec Quick Mode\\\", SubcategoryGuid == \\\"0cce9218-69ae-11d9-bed3-505054503030\\\", \\\"IPsec Main Mode\\\", SubcategoryGuid  == \\\"0cce9217-69ae-11d9-bed3-505054503030\\\", \\\"Account Lockout\\\", SubcategoryGuid == \\\"0cce9216-69ae-11d9-bed3-505054503030\\\", \\\"Logoff\\\", SubcategoryGuid == \\\"0cce9215-69ae-11d9-bed3-505054503030\\\", \\\"Logon\\\", SubcategoryGuid == \\\"0cce9223-69ae-11d9-bed3-505054503030\\\", \\\"Handle Manipulation\\\", SubcategoryGuid == \\\"0cce9244-69ae-11d9-bed3-505054503030\\\", \\\"Detailed File Share\\\", SubcategoryGuid == \\\"0cce9227-69ae-11d9-bed3-505054503030\\\", \\\"Other Object Access\\\", SubcategoryGuid == \\\"0cce9226-69ae-11d9-bed3-505054503030\\\", \\\"FIltering Platform Connection\\\", SubcategoryGuid == \\\"0cce9225-69ae-11d9-bed3-505054503030\\\", \\\"FIltering Platform Packet Drop\\\", SubcategoryGuid == \\\"0cce9224-69ae-11d9-bed3-505054503030\\\", \\\"File Share\\\", SubcategoryGuid == \\\"0cce9222-69ae-11d9-bed3-505054503030\\\", \\\"Application Generated\\\", SubcategoryGuid == \\\"0cce9221-69ae-11d9-bed3-505054503030\\\", \\\"Certificaiton Services\\\", SubcategoryGuid == \\\"0cce9220-69ae-11d9-bed3-505054503030\\\", \\\"SAM\\\", SubcategoryGuid == \\\"0cce921f-69ae-11d9-bed3-505054503030\\\", \\\"Kernel Object\\\", SubcategoryGuid == \\\"0cce921e-69ae-11d9-bed3-505054503030\\\", \\\"Registry\\\", SubcategoryGuid == \\\"0cce921d-69ae-11d9-bed3-505054503030\\\", \\\"File System\\\", SubcategoryGuid == \\\"0cce9229-69ae-11d9-bed3-505054503030\\\", \\\"Non Sensitive Privilege Use\\\", SubcategoryGuid == \\\"0cce922a-69ae-11d9-bed3-505054503030\\\" , \\\"Other Privilege Use Events\\\", SubcategoryGuid == \\\"0cce9228-69ae-11d9-bed3-505054503030\\\", \\\"Sensitive Privilege Use\\\", SubcategoryGuid == \\\"0cce922d-69ae-11d9-bed3-505054503030\\\", \\\"DPAPI Activity\\\", SubcategoryGuid == \\\"0cce922c-69ae-11d9-bed3-505054503030\\\", \\\"Process Termination\\\", SubcategoryGuid == \\\"0cce922b-69ae-11d9-bed3-505054503030\\\", \\\"Process Creation\\\", SubcategoryGuid == \\\"0cce922e-69ae-11d9-bed3-505054503030\\\", \\\"RPC Events\\\", SubcategoryGuid == \\\"0cce9232-69ae-11d9-bed3-505054503030\\\", \\\"MPSSVC Rule-Level Policy Change\\\", SubcategoryGuid == \\\"0cce9234-69ae-11d9-bed3-505054503030\\\", \\\"Other Policy Change Events\\\", SubcategoryGuid == \\\"0cce9233-69ae-11d9-bed3-505054503030\\\", \\\"Filtering Platform Policy Change\\\", SubcategoryGuid == \\\"0cce922f-69ae-11d9-bed3-505054503030\\\", \\\"Audit Policy Change\\\", SubcategoryGuid == \\\"0cce9231-69ae-11d9-bed3-505054503030\\\", \\\"Authorization Policy Change\\\", SubcategoryGuid == \\\"0cce9230-69ae-11d9-bed3-505054503030\\\", \\\"Authentication Policy Change\\\", SubcategoryGuid == \\\"0cce923a-69ae-11d9-bed3-505054503030\\\", \\\"Other Account Management Events\\\", SubcategoryGuid == \\\"0cce9239-69ae-11d9-bed3-505054503030\\\", \\\"Application Group Management\\\", SubcategoryGuid == \\\"0cce9238-69ae-11d9-bed3-505054503030\\\", \\\"Distribution Group Management\\\", SubcategoryGuid == \\\"0cce9237-69ae-11d9-bed3-505054503030\\\", \\\"Security Group Management\\\", SubcategoryGuid == \\\"0cce9236-69ae-11d9-bed3-505054503030\\\", \\\"Computer Account Mangement\\\", SubcategoryGuid == \\\"0cce9235-69ae-11d9-bed3-505054503030\\\", \\\"User Account Mangement\\\", SubcategoryGuid == \\\"0cce923e-69ae-11d9-bed3-505054503030\\\", \\\"Detailed Directory Service Replication\\\", SubcategoryGuid == \\\"0cce923b-69ae-11d9-bed3-505054503030\\\", \\\"Directory Service Access\\\", SubcategoryGuid == \\\"0cce923d-69ae-11d9-bed3-505054503030\\\", \\\"Directory Service Replication\\\", SubcategoryGuid == \\\"0cce923c-69ae-11d9-bed3-505054503030\\\", \\\"Directory Service Changes\\\", SubcategoryGuid == \\\"0cce9240-69ae-11d9-bed3-505054503030\\\", \\\"Kerberos Service Ticket Operations\\\", SubcategoryGuid == \\\"0cce923f-69ae-11d9-bed3-505054503030\\\", \\\"Credential Validation\\\", SubcategoryGuid == \\\"0cce9242-69ae-11d9-bed3-505054503030\\\", \\\"Kerberos Authentication Service\\\", SubcategoryGuid == \\\"0cce9245-69ae-11d9-bed3-505054503030\\\", \\\"Removable Storage\\\", SubcategoryGuid == \\\"0cce9246-69ae-11d9-bed3-505054503030\\\", \\\"Central Access Policy Staging\\\", SubcategoryGuid == \\\"0cce9247-69ae-11d9-bed3-505054503030\\\", \\\"User/Device Claims\\\", SubcategoryGuid == \\\"0cce9248-69ae-11d9-Bed3-505054503030\\\", \\\"PNP Activity\\\", SubcategoryGuid == \\\"0cce9249-69ae-11d9-bed3-505054503030\\\", \\\"Group Membership\\\", \\\"Failed to Return\\\")\\r\\n| extend AuditPolicyChange = case(AuditPolicyChanges == \\\"%%8448\\\", \\\"Success:disable\\\", AuditPolicyChanges == \\\"%%8449\\\", \\\"Success:enable\\\", AuditPolicyChanges == \\\"%%8450\\\", \\\"Failure:disable\\\", AuditPolicyChanges == \\\"%%8451\\\", \\\"Failure:enable\\\", \\\"Failed to Return\\\")\\r\\n| where AccountType != \\\"Computer\\\"\\r\\n| where 'AuditPolicyChange'==\\\"All\\\" or AuditPolicyChange in ({AuditPolicyChangeType})\\r\\n| project TimeGenerated, AuditSubcategory, AuditPolicyChange, Account, SubjectLogonId\\r\\n| order by TimeGenerated desc \",\"size\":0,\"title\":\"Audit Policy Change Details\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"Time Generated\"},{\"columnId\":\"AuditSubcategory\",\"label\":\"Audit Subcategory\"},{\"columnId\":\"AuditPolicyChange\",\"label\":\"Audit Policy Change\"},{\"columnId\":\"Account\"},{\"columnId\":\"SubjectLogonId\",\"label\":\"Subject Logon ID\"}]}},\"conditionalVisibilities\":[{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"suspiciousChanges\"},{\"parameterName\":\"suspiciousChanges\",\"comparison\":\"isEqualTo\",\"value\":\"Audit Policy Change\"}],\"name\":\"query - 17 - Copy - Copy\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"d16f4b45-af6e-4529-b380-77cf46eb8df6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ChangeMaker\",\"label\":\"Change Maker\",\"type\":2,\"isRequired\":true,\"query\":\"let OnPremEvents = dynamic([4720, 4731, 4732, 4733, 4734, 4735, 4764, 4727, 4737, 4728, 4729, 4730, 4754, 4755, 4756, 4757, 4758]);\\r\\nSecurityEvent\\r\\n| where tolower(Computer) == tolower(\\\"{Host}\\\")\\r\\n| where EventID in (OnPremEvents)\\r\\n| summarize by Account\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":\"\",\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"suspiciousChanges\",\"comparison\":\"isEqualTo\",\"value\":\"User Changes\"},\"name\":\"parameters - 16\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\r\\n| where EventID == 4720\\r\\n| where tolower(Computer) == tolower(\\\"{Host}\\\")\\r\\n| where Account == \\\"{ChangeMaker:escape}\\\"//@ or :escape escapes problematic characters\\r\\n//| where Computer == \\\"{Host}\\\"\\r\\n| parse EventData with * 'TargetUserName>' SubjectUserName '<' *\\r\\n| extend AccountType = iff(HomePath == \\\"%%1793\\\", \\\"Local\\\", \\\"AD\\\")\\r\\n| project TimeGenerated, Account, Computer, CreatedAccount=TargetUserName, AccountType\\r\\n| order by TimeGenerated desc\",\"size\":1,\"showAnalytics\":true,\"title\":\"Account Creation Details\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"Time Generated\"},{\"columnId\":\"CreatedAccount\",\"label\":\"Created Account\"},{\"columnId\":\"AccountType\",\"label\":\"Account Type\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"suspiciousChanges\",\"comparison\":\"isEqualTo\",\"value\":\"User Changes\"},\"name\":\"query - 17\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let OnPremEvents = dynamic([4731, 4732, 4733, 4734, 4735, 4764, 4727, 4737, 4728, 4729, 4730, 4754, 4755, 4756, 4757, 4758]);\\r\\nSecurityEvent\\r\\n| where tolower(Computer) == tolower(\\\"{Host}\\\")\\r\\n| where Account == \\\"{ChangeMaker:escape}\\\"//@ or :escape escapes problematic characters\\r\\n| where EventID in (OnPremEvents)\\r\\n| extend ImpactedAccount = iff(MemberName == \\\"-\\\", MemberSid, MemberName)\\r\\n| project TimeGenerated, Activity, ChangeMaker=Account, AccountType, Computer, ImpactedAccount, Group=TargetAccount\\r\\n\\r\\n//Activity, Account, AccountType, Computer, ChangeMaker=SubjectAccount, TargetGroup=TargetAccount;\",\"size\":0,\"showAnalytics\":true,\"title\":\"Group Changes Details\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"suspiciousChanges\",\"comparison\":\"isEqualTo\",\"value\":\"User Changes\"},\"name\":\"query - 17 - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"suspiciousChanges\"},\"name\":\"SuspiciousChanges\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where Entities contains \\\"\\\"\\\"host\\\"\\\"\\\"\\r\\n| extend AllEntities = parse_json(Entities)\\r\\n| mv-expand AllEntities\\r\\n| where AllEntities.Type == \\\"host\\\"\\r\\n| extend HostEntity = tostring(AllEntities.HostName)\\r\\n| where HostEntity =~ split(\\\"{Host}\\\", \\\".\\\", 0)[0]\\r\\n| project AlertSeverity, AlertName=DisplayName, ProviderName, AlertDetails=Entities, SystemAlertId\",\"size\":0,\"title\":\"Related Alerts\",\"noDataMessage\":\"No Security Alerts were found for the selected IP\",\"noDataMessageStyle\":3,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":5}]}},\"customWidth\":\"50\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"HuntingBookmark\\r\\n| where TimeGenerated {TimeRange}\\r\\n| extend Entities = parse_json(QueryResultRow).__entityMapping\\r\\n| where Entities contains \\\"\\\"\\\"host\\\"\\\"\\\" //Entity Type to match\\r\\n| summarize arg_max(TimeGenerated, BookmarkName, Notes, Tags, Entities) by BookmarkId\\r\\n| extend splitEntities = split(replace(@'[\\\"{}]', '', tostring(Entities)),',')\\r\\n| mv-expand splitEntities\\r\\n| extend splitEntity = split(splitEntities, ':')\\r\\n| where splitEntity[1] =~ \\\"host\\\"\\r\\n| where splitEntity[0] =~ \\\"{Host}\\\"\\r\\n| project BookmarkName, Notes, Tags\",\"size\":0,\"title\":\"Related Bookmarks\",\"noDataMessage\":\"No Bookmarks were found for the selected IP\",\"noDataMessageStyle\":3,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":5}]}},\"customWidth\":\"50\",\"name\":\"query - 0 - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"relatedAlerts\"},\"name\":\"RelatedAlerts\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"loadType\":\"always\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## To use this custom group, switch the group type from \\\"Editable\\\" to \\\"From Template\\\" and enter the ID of your custom workbook\"},\"name\":\"text - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"HostNav\",\"comparison\":\"isEqualTo\",\"value\":\"Custom\"},\"name\":\"CustomGroupAccountHost\"}]},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Host\"},\"name\":\"HostGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"d492cada-966f-484b-b527-d41ba2ddd1a3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"URL\",\"type\":1,\"isRequired\":true,\"query\":\"datatable(Entity:string, EntityType:string)\\r\\n\\t[\\\"{EntityData}\\\",\\\"{EntityType}\\\"]\\r\\n| where EntityType =~ \\\"url\\\" or EntityType =~ \\\"dns\\\"\\r\\n| project Entity\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 8 - Copy\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"bc8ae0b0-4f42-4582-8728-79bc9ff857cb\",\"cellValue\":\"URLNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"IOCs\",\"subTarget\":\"IOC\",\"style\":\"link\"},{\"id\":\"327484a8-4f88-4d2f-b063-8f5e047d41ae\",\"cellValue\":\"URLNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"{URLCustomTabName}\",\"subTarget\":\"Custom\",\"style\":\"link\"}]},\"name\":\"links - 5\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated > ago(180d)\\r\\n| where Url contains \\\"{URL}\\\"\\r\\n| summarize arg_max(TimeGenerated, Active) by IndicatorId, SourceSystem, Description, ThreatType, Url\\r\\n| project SourceSystem, Description, Url, ThreatType, Active\",\"size\":0,\"title\":\"URL Threat Intelligence\",\"noDataMessage\":\"No Threat Intelligence was found for the selected URL.\",\"noDataMessageStyle\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"query - 13 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where Entities contains \\\"\\\"\\\"url\\\"\\\"\\\"\\r\\n| extend AllEntities = parse_json(Entities)\\r\\n| mv-expand AllEntities\\r\\n| where AllEntities.Type == \\\"url\\\" and AllEntities.Url contains \\\"{URL}\\\"\\r\\n| project AlertSeverity, AlertName=DisplayName, ProviderName, AlertDetails=Entities, SystemAlertId\",\"size\":0,\"title\":\"Related Alerts\",\"noDataMessage\":\"No Security Alerts were found for the selected URL\",\"noDataMessageStyle\":3,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":5}]}},\"customWidth\":\"50\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"HuntingBookmark\\r\\n| where TimeGenerated {TimeRange}\\r\\n| extend Entities = parse_json(QueryResultRow).__entityMapping\\r\\n| where Entities contains \\\"\\\"\\\"url\\\"\\\"\\\" //Entity Type to match\\r\\n| summarize arg_max(TimeGenerated, BookmarkName, Notes, Tags, Entities) by BookmarkId\\r\\n| extend splitEntities = split(replace(@'[{}]', '', tostring(Entities)),',')\\r\\n| mv-expand splitEntities\\r\\n| parse splitEntities with * '\\\"' Url '\\\":\\\"' EntityType '\\\"'\\r\\n| where EntityType =~ \\\"url\\\"\\r\\n| where Url contains \\\"{URL}\\\"\\r\\n| project BookmarkName, Notes, Tags\",\"size\":0,\"title\":\"Related Bookmarks\",\"noDataMessage\":\"No Bookmarks were found for the selected URL\",\"noDataMessageStyle\":3,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":5}]}},\"customWidth\":\"50\",\"name\":\"query - 2 - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"URLNav\",\"comparison\":\"isEqualTo\",\"value\":\"IOC\"},\"name\":\"URLIOCGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"loadType\":\"always\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## To use this custom group, switch the group type from \\\"Editable\\\" to \\\"From Template\\\" and enter the ID of your custom workbook\"},\"name\":\"text - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"URLNav\",\"comparison\":\"isEqualTo\",\"value\":\"Custom\"},\"name\":\"CustomGroupAccountURL\"}]},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"URL\"},\"name\":\"URLGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"c10a08a4-2969-41d3-84ba-660bfbe7e621\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"FileHash\",\"type\":1,\"isRequired\":true,\"query\":\"datatable(Entity:string, EntityType:string)\\r\\n\\t[\\\"{EntityData}\\\",\\\"{EntityType}\\\"]\\r\\n| where EntityType startswith \\\"filehash\\\"\\r\\n| project Entity\",\"crossComponentResources\":[\"{Workspace}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"56b045e3-0340-4b11-b591-93632bd54cad\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"HashType\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated > ago(180d)\\r\\n| where isnotempty(FileHashValue )\\r\\n| distinct FileHashType\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"82a6c876-22a4-4c80-a96c-41862e58f8b0\",\"cellValue\":\"FileHashNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"IOCs\",\"subTarget\":\"IOC\",\"style\":\"link\"},{\"id\":\"a62f4068-88e7-40ba-a2c4-779169446660\",\"cellValue\":\"FileHashNav\",\"linkTarget\":\"parameter\",\"linkLabel\":\"{FileHashCustomTabName}\",\"subTarget\":\"Custom\",\"style\":\"link\"}]},\"name\":\"links - 4\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated > ago(180d)\\r\\n| where FileHashValue =~ \\\"{FileHash}\\\"\\r\\n| where FileHashType in ({HashType})\\r\\n| summarize arg_max(TimeGenerated, Active) by IndicatorId, SourceSystem, Description, ThreatType, FileHashValue, FileHashType\\r\\n| project SourceSystem, Description, FileHashValue, FileHashType, ThreatType, Active\",\"size\":0,\"title\":\"File Hash Threat Intelligence\",\"noDataMessage\":\"No Threat Intelligence was found for the selected File Hash.\",\"noDataMessageStyle\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where TimeGenerated {TimeRange}\\r\\n| where Entities contains \\\"{FileHash}\\\"\\r\\n| project AlertSeverity, AlertName=DisplayName, ProviderName, AlertDetails=Entities, SystemAlertId\",\"size\":0,\"title\":\"Related Alerts\",\"noDataMessage\":\"No Security Alerts were found for the selected FileHash\",\"noDataMessageStyle\":3,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertDetails\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"View\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":5}]}},\"customWidth\":\"50\",\"name\":\"query - 2\"}]},\"conditionalVisibility\":{\"parameterName\":\"FileHashNav\",\"comparison\":\"isEqualTo\",\"value\":\"IOC\"},\"name\":\"FileHashIOCGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"loadType\":\"always\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## To use this custom group, switch the group type from \\\"Editable\\\" to \\\"From Template\\\" and enter the ID of your custom workbook\"},\"name\":\"text - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"FileHashNav\",\"comparison\":\"isEqualTo\",\"value\":\"Custom\"},\"name\":\"CustomGroupAccountHash\"}]},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"FileHash\"},\"name\":\"FileHashGroup\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"2c1b6b11-5831-4548-90f1-99ddf942a45a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SearchString\",\"type\":1,\"isRequired\":true,\"value\":\"\",\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"dcb0013b-5235-4aa8-a1ad-5a693409af74\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IncludeString\",\"type\":1,\"description\":\"This filter applies after the SearchString to include records that also contain this string value.\",\"value\":\"\"},{\"id\":\"ce0fde61-f7a3-46c6-8647-9cc7c2563af4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ExcludeString\",\"type\":1,\"description\":\"This filter applies after the SearchString to exclude records that also contain this string value.\"},{\"id\":\"4c157722-42dc-4ceb-97d4-7c772f287aba\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Table\",\"type\":2,\"multiSelect\":true,\"quote\":\"\",\"delimiter\":\",\",\"query\":\"Usage\\r\\n| distinct DataType\\r\\n| sort by DataType asc\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"search in ({Table}) \\\"{SearchString}\\\"\\r\\n| where * contains \\\"{IncludeString:label}\\\" or \\\"{IncludeString:label}\\\" == \\\"<unset>\\\"\\r\\n| where * !contains \\\"{ExcludeString:label}\\\" or \\\"{ExcludeString:label}\\\" == \\\"<unset>\\\"\\r\\n| summarize Count=count() by Type\\r\\n| sort by Count desc\",\"size\":1,\"title\":\"Search Results by Table\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Type\",\"exportParameterName\":\"SelectedTable\",\"exportDefaultValue\":\"Usage\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"search in ({SelectedTable}) \\\"{SearchString}\\\"\\r\\n| where * contains \\\"{IncludeString:label}\\\" or \\\"{IncludeString:label}\\\" == \\\"<unset>\\\"\\r\\n| where * !contains \\\"{ExcludeString:label}\\\" or \\\"{ExcludeString:label}\\\" == \\\"<unset>\\\"\\r\\n| project-away TenantId, $table\\r\\n| sort by TimeGenerated desc\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"Select a tile to see detailed results.\",\"noDataMessageStyle\":2,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"sortBy\":\"[]\"},\"name\":\"query - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Search\"},\"name\":\"Search\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"loadType\":\"always\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## To use this custom group, switch the group type from \\\"Editable\\\" to \\\"From Template\\\" and enter the ID of your custom workbook\"},\"name\":\"text - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"InvestigationType\",\"comparison\":\"isEqualTo\",\"value\":\"Custom\"},\"name\":\"CustomGroup\"}],\"fallbackResourceIds\":[\"azure monitor\"],\"fromTemplateId\":\"Community-Workbooks/Azure Sentinel - Workbooks/Investigation Insights\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId9'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=InvestigationInsightsWorkbook; logoFileName=Microsoft_logo.svg; description=Help analysts gain insight into incident, bookmark and entity data through the Investigation Insights Workbook. This workbook provides common queries and detailed visualizations to help an analyst investigate suspicious activities quickly with an easy to use interface. Analysts can start their investigation from a Microsoft Sentinel incident, bookmark, or by simply entering the entity data into the workbook manually.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.4.0; title=Investigation Insights; templateRelativePath=InvestigationInsights.json; subtitle=; provider=Microsoft Sentinel community}.description",
                "parentId": "[variables('workbookId9')]",
                "contentId": "[variables('_workbookContentId9')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "AuditLogs",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "AzureActivity",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "CommonSecurityLog",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "OfficeActivity",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SecurityEvent",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SigninLogs",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ThreatIntelligenceIndicator",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "AzureActivity",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "SecurityEvents",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "Office365",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "AzureActiveDirectory",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "ThreatIntelligence",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "ThreatIntelligenceTaxii",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "WindowsSecurityEvents",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId9')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook9-name')]",
        "contentProductId": "[variables('_workbookcontentProductId9')]",
        "id": "[variables('_workbookcontentProductId9')]",
        "version": "[variables('workbookVersion9')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "MITREAttackWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId10')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Workbook to showcase MITRE ATT&CK Coverage for Microsoft Sentinel"
              },
              "properties": {
                "displayName": "[parameters('workbook10-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"3ac5e194-a6a4-4405-8370-6da952e8bc5b\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Overview\",\"subTarget\":\"Overview\",\"style\":\"link\"},{\"id\":\"1ba43bf0-5c1a-4081-b357-34f5389cf5f2\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"DataSource Statistics\",\"subTarget\":\"DataSourceStatistics\",\"style\":\"link\"},{\"id\":\"c5d475b0-86f9-4e78-8b32-d19631bc68de\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Microsoft Sentinel Github\",\"subTarget\":\"MicrosoftSentinelGithub\",\"style\":\"link\"},{\"id\":\"90261d23-b3d6-4b6c-a22c-c74cfe8d2e23\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Detection Platform Services\",\"subTarget\":\"DetectionPlatformServices\",\"style\":\"link\"},{\"id\":\"6618168f-77ef-4b5b-9ebd-70e2852ba475\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"MITRE ATT&CK Heatmaps\",\"subTarget\":\"MITREATT&CKHeatmaps\",\"style\":\"link\"}]},\"name\":\"links - 0\"},{\"type\":1,\"content\":{\"json\":\"<svg viewBox=\\\"0 0 19 19\\\" width=\\\"20\\\" class=\\\"fxt-escapeShadow\\\" role=\\\"presentation\\\" focusable=\\\"false\\\" xmlns:svg=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" aria-hidden=\\\"true\\\"><g><path fill=\\\"#1b93eb\\\" d=\\\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\\\"></path><path fill=\\\"url(#0024423711759027356)\\\" d=\\\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\\\"></path><path d=\\\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\\\" class=\\\"msportalfx-svg-c01\\\"></path></g></svg>&nbsp;<span style=\\\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\\\"> Please take time to answer a quick survey,\\r\\n</span>[<span style=\\\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\\\"> click here. </span>](https://forms.office.com/r/UjQS9t0TSr)\"},\"name\":\"Survey\"},{\"type\":1,\"content\":{\"json\":\"# Getting Started\\r\\n---\\r\\n\\r\\nThis workbook enables SecOps Analysts, Threat Intelligence Professionals, and Threat Hunters to map out-of-the box Microsoft Sentinel detections coverage across MITRE ATT&CK framework. \\r\\n<br>With this workbook, analysts will be able to get insights into what out-of-the box detections are already available and can make informed decision to either onboard new datasources or enable new analytics and hunting queries to increase MITRE ATT&CK coverage or fill existing gaps. \\r\\n\\r\\nThe workbook is designed into separate tabs as deascribed below.\\r\\n\\r\\n## DataSource Statistics\\r\\n---\\r\\nThis section provides dataSources currently being populated based on Usage Table and security alerts triggered across those datasources from SecurityAlerts Table across Microsoft Sentinel workspace.\\r\\n\\r\\n## Microsoft Sentinel Github\\r\\n---\\r\\nThis section provides breakdown of existig out-of-the box content by Detection type such as Analytics, Hunting Queries and Fusion detections as well as by MITRE ATT&CK Tactics. \\r\\n\\r\\n## Detection Platform Services\\r\\n---\\r\\nThis section provides breakdown of built-in alerts from Microsoft suite of security products such as Azure Defender for various cloud resource types/services, Microsoft Defender for Identity (MDI),  Microsoft Cloud Application Security (MCAS) and others. \\r\\n<br> These alerts can be visually represented by products as well as cloud resource types. \\r\\n\\r\\n## MITRE ATT&CK Heatmaps\\r\\n---\\r\\nThis section provides visual Heatmaps of different MITRE ATT&CK matrix categorized by cloud Platform such as Azure, AWS, GCP as well as by Azure AD, Office 365, Windows, Linux.\\r\\n\\r\\nIn order to populate the data you can use either the Jupyter Notebook or deploy the Azure Function as instructed in the solution [ThreatAnalysis&ResponsewithMITREATT&CK](https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/ThreatAnalysis%26ResponsewithMITREATT%26CK)\\r\\n\\r\\n\\r\\nRefer Notebook : [![nbviewer](https://raw.githubusercontent.com/jupyter/design/master/logos/Badges/nbviewer_badge.svg)](https://nbviewer.jupyter.org/github/Azure/Azure-Sentinel/blob/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/MITRE%20ATT%26CK%20for%20Microsoft%20Sentinel.ipynb)\\r\\n\\r\\n\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"text - 1\"},{\"type\":1,\"content\":{\"json\":\"## Links and Resources\\r\\n\\r\\n- Microsoft Sentinel Github : https://github.com/Azure/Azure-Sentinel/\\r\\n- Microsoft Sentinel Fusion : https://docs.microsoft.com/azure/sentinel/fusion-scenario-reference\\r\\n- Microsoft Defender for Cloud: https://docs.microsoft.com/azure/security-center/alerts-reference\\r\\n- Azure Identity Protection (AIP): https://docs.microsoft.com/azure/active-directory/identity-protection/concept-identity-protection-risks\\r\\n- Microsoft Defender for Identity: https://docs.microsoft.com/advanced-threat-analytics/suspicious-activity-guide\\r\\n- Microsoft Defender for Cloud Apps : https://docs.microsoft.com/cloud-app-security/investigate-anomaly-alerts\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"text - 2\"},{\"type\":1,\"content\":{\"json\":\"\\r\\n# ** Data Sources Available in Current Microsoft Sentinel **\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"DataSourceStatistics\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Usage \\r\\n| summarize SizeinMB = round(sum(Quantity),2) by DataType \\r\\n| sort by SizeinMB desc\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"DataSourceStatistics\"},\"name\":\"query - 4\"},{\"type\":1,\"content\":{\"json\":\"# Detections Coverage in Existing Microsoft Sentinel\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"DataSourceStatistics\"},\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where isnotempty(ProviderName)\\r\\n| summarize Count=dcount(AlertName) by ProviderName, VendorName\",\"size\":0,\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"ProviderName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"ProviderName\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"DataSourceStatistics\"},\"customWidth\":\"50\",\"name\":\"query - 6\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n| where isnotempty(ProviderName)\\r\\n| summarize Count=count() by ProviderName, VendorName, AlertName\\r\\n| sort by ProviderName\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":500,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"DataSourceStatistics\"},\"customWidth\":\"50\",\"name\":\"query - 7\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":1,\"content\":{\"json\":\"## MITRE ATT&CK Coverage against Microsoft Sentinel Github\\r\\n\\r\\n# Links and Resources :\\r\\n- Tactics : https://attack.mitre.org/tactics/enterprise/\\r\\n- Enterprise Matrix : https://attack.mitre.org/matrices/enterprise/\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"MicrosoftSentinelGithub\"},\"name\":\"text - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let SentinelGithub = (externaldata(Tactic: string, TechniqueId: string, Platform: string, DetectionType: string, DetectionService: string, DetectionId: guid, DetectionName: string, DetectionDescription: string, ConnectorId: string, DataTypes: string, Query: string, QueryFrequency: string, QueryPeriod: string, TriggerOperator: string, TriggerThreshold: real, DetectionSeverity: string, DetectionUrl: string, IngestedDate: datetime)\\r\\n[@\\\"https://raw.githubusercontent.com/microsoft/mstic/master/PublicFeeds/MITREATT%26CK/MicrosoftSentinel.csv\\\"] with (format=\\\"csv\\\", ignoreFirstRecord=True)\\r\\n);\\r\\nSentinelGithub\\r\\n| where isnotempty(Tactic)\\r\\n| summarize Count=dcount(DetectionName) by DetectionType\",\"size\":0,\"title\":\"Query Type Breakdown\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"MicrosoftSentinelGithub\"},\"customWidth\":\"50\",\"name\":\"query - 10\",\"styleSettings\":{\"maxWidth\":\"20\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let SentinelGithub = (externaldata(Tactic: string, TechniqueId: string, Platform: string, DetectionType: string, DetectionService: string, DetectionId: guid, DetectionName: string, DetectionDescription: string, ConnectorId: string, DataTypes: string, Query: string, QueryFrequency: string, QueryPeriod: string, TriggerOperator: string, TriggerThreshold: real, DetectionSeverity: string, DetectionUrl: string, IngestedDate: datetime)\\r\\n[@\\\"https://raw.githubusercontent.com/microsoft/mstic/master/PublicFeeds/MITREATT%26CK/MicrosoftSentinel.csv\\\"] with (format=\\\"csv\\\", ignoreFirstRecord=True)\\r\\n);\\r\\nSentinelGithub\\r\\n| where DetectionService == \\\"Azure Sentinel Community Github\\\"\\r\\n| where isnotempty(Tactic)\\r\\n| extend Tactic = iff(Tactic in (\\\"Privilege Escalation\\\",\\\"Privilege escalation\\\") ,\\\"PrivilegeEscalation\\\",Tactic)\\r\\n| extend Tactic = iff(Tactic==\\\"Persistance\\\",\\\"Persistence\\\",Tactic)\\r\\n| extend Tactic = iff(Tactic in (\\\"Command and control\\\",\\\"CommandandControl\\\"), \\\"CommandAndControl\\\",Tactic)\\r\\n| extend Tactic = iff(Tactic in (\\\"Defense Evasion\\\",\\\"Defense evasion\\\"), \\\"DefenseEvasion\\\",Tactic)\\r\\n| extend Tactic = iff(Tactic==\\\"Lateral movement\\\",\\\"LateralMovement\\\",Tactic)\\r\\n| extend Tactic = iff(Tactic==\\\"Credential Access\\\",\\\"CredentialAccess\\\",Tactic)\\r\\n| extend Tactic = iff(Tactic in (\\\"IntialAccess\\\",\\\"InitalAccess\\\", \\\"Initial access\\\"),\\\"InitialAccess\\\",Tactic)\\r\\n| where Tactic in (\\\"InitialAccess\\\", \\\"Collection\\\", \\\"Discovery\\\", \\\"Execution\\\", \\\"Exfiltration\\\", \\\"LateralMovement\\\", \\\"Persistence\\\", \\\"PrivilegeEscalation\\\", \\\"DefenseEvasion\\\", \\\"CredentialAccess\\\", \\\"LateralMovement\\\", \\\"Reconnaissance\\\", \\\"Impact\\\")\\r\\n| summarize Count=dcount(DetectionId), make_set(DetectionName) by Tactic\\r\\n| sort by Count desc\",\"size\":0,\"title\":\"Tactic Level Breakdown\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Tactic\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"MicrosoftSentinelGithub\"},\"customWidth\":\"50\",\"name\":\"query - 9\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"\\r\\nlet SentinelGithub = (externaldata(Tactic: string, TechniqueId: string, Platform: string, DetectionType: string, DetectionService: string, DetectionId: guid, DetectionName: string, DetectionDescription: string, ConnectorId: string, DataTypes: string, Query: string, QueryFrequency: string, QueryPeriod: string, TriggerOperator: string, TriggerThreshold: real, DetectionSeverity: string, DetectionUrl: string, IngestedDate: datetime)\\r\\n[@\\\"https://raw.githubusercontent.com/microsoft/mstic/master/PublicFeeds/MITREATT%26CK/MicrosoftSentinel.csv\\\"] with (format=\\\"csv\\\", ignoreFirstRecord=True)\\r\\n);\\r\\nSentinelGithub\\r\\n| where DetectionService == \\\"Azure Sentinel Community Github\\\"\\r\\n| where isnotempty(Platform)\\r\\n| summarize Count=dcount(DetectionId) by Platform\\r\\n| sort by Count desc\",\"size\":0,\"title\":\"Platform Level Breakdown\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"MicrosoftSentinelGithub\"},\"customWidth\":\"100\",\"name\":\"query - 12\",\"styleSettings\":{\"maxWidth\":\"100\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let SentinelGithub = (externaldata(Tactic: string, TechniqueId: string, Platform: string, DetectionType: string, DetectionService: string, DetectionId: guid, DetectionName: string, DetectionDescription: string, ConnectorId: string, DataTypes: string, Query: string, QueryFrequency: string, QueryPeriod: string, TriggerOperator: string, TriggerThreshold: real, DetectionSeverity: string, DetectionUrl: string, IngestedDate: datetime)\\r\\n[@\\\"https://raw.githubusercontent.com/microsoft/mstic/master/PublicFeeds/MITREATT%26CK/MicrosoftSentinel.csv\\\"] with (format=\\\"csv\\\", ignoreFirstRecord=True)\\r\\n);\\r\\nSentinelGithub\\r\\n| where DetectionService == \\\"Azure Sentinel Community Github\\\"\\r\\n| where isnotempty(Tactic) and isnotempty(Platform)\\r\\n| distinct Platform, DataTypes, DetectionType, DetectionName,DetectionUrl \\r\\n| sort by Platform asc, DetectionType asc\",\"size\":0,\"title\":\"DataSource Level Breakdown\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"rowLimit\":9000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"MicrosoftSentinelGithub\"},\"customWidth\":\"100\",\"name\":\"query - 11\",\"styleSettings\":{\"maxWidth\":\"100\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let MSFTBuiltinAlerts = (externaldata(Alert: string, Description: string, Tactics:string, Severity:string, Provider:string, DetectionService: string)\\r\\n[@\\\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/MSFT-Builtin-Alerts.csv\\\"] with (format=\\\"csv\\\", ignoreFirstRecord=True)\\r\\n);\\r\\nMSFTBuiltinAlerts\\r\\n| summarize Count=count() by DetectionService\\r\\n| sort by Count desc\",\"size\":0,\"title\":\"Detections by Microsoft Services\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"DetectionPlatformServices\"},\"customWidth\":\"50\",\"name\":\"query - 13\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let MSFTBuiltinAlerts = (externaldata(Alert: string, Description: string, Tactics:string, Severity:string, Provider:string, DetectionService: string)\\r\\n[@\\\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/MSFT-Builtin-Alerts.csv\\\"] with (format=\\\"csv\\\", ignoreFirstRecord=True)\\r\\n);\\r\\nMSFTBuiltinAlerts\\r\\n| where Provider != \\\"N.A.\\\"\\r\\n| summarize Count=count() by Provider\\r\\n| sort by Count desc\",\"size\":0,\"title\":\"ASC - Resource Type Breakdown\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Provider\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"DetectionPlatformServices\"},\"customWidth\":\"50\",\"name\":\"query - 14\",\"styleSettings\":{\"maxWidth\":\"70\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let MSFTBuiltinAlerts = (externaldata(Alert: string, Description: string, Tactics:string, Severity:string, Provider:string, DetectionService: string)\\r\\n[@\\\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/MSFT-Builtin-Alerts.csv\\\"] with (format=\\\"csv\\\", ignoreFirstRecord=True)\\r\\n);\\r\\nMSFTBuiltinAlerts\\r\\n\",\"size\":0,\"title\":\"List of Alerts by Microsoft Services\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"rowLimit\":500,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"DetectionPlatformServices\"},\"name\":\"query - 15\"},{\"type\":1,\"content\":{\"json\":\"\"},\"name\":\"text - 16\"},{\"type\":1,\"content\":{\"json\":\"## MITRE ATT&CK Navigator Heatmaps\\r\\n\\r\\nThis section provides visual Heatmaps of different MITRE ATT&CK matrix categorized by cloud Platform such as Azure, AWS, GCP as well as by Azure AD, Office 365, Windows, Linux.\\r\\n\\r\\n### MITRE ATT&CK Navigator Heatmap for Azure\\r\\n<img src=\\\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/images/Azure_Layer_Json_File_for_Microsoft_Sentinel.svg?sanitize=true\\\">\\r\\n\\r\\n\\r\\n### MITRE ATT&CK Navigator Heatmap for Azure AD\\r\\n<img src=\\\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/images/Azure_AD_Layer_Json_File_for_Microsoft_Sentinel.svg?sanitize=true\\\">\\r\\n\\r\\n### MITRE ATT&CK Navigator Heatmap for Office 365\\r\\n<img src=\\\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/images/Office_365_Layer_Json_File_for_Microsoft_Sentinel.svg?sanitize=true\\\">\\r\\n\\r\\n### MITRE ATT&CK Navigator Heatmap for AWS\\r\\n<img src=\\\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/images/AWS_Layer_Json_File_for_Microsoft_Sentinel.svg?sanitize=true\\\">\\r\\n\\r\\n### MITRE ATT&CK Navigator Heatmap for GCP\\r\\n<img src=\\\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/images/GCP_Layer_Json_File_for_Microsoft_Sentinel.svg?sanitize=true\\\">\\r\\n\\r\\n### MITRE ATT&CK Navigator Heatmap for Windows\\r\\n<img src=\\\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/images/Windows_Layer_Json_File_for_Microsoft_Sentinel.svg?sanitize=true\\\">\\r\\n\\r\\n### MITRE ATT&CK Navigator Heatmap for Linux\\r\\n<img src=\\\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Tools/MITREATT%26CK-LayerGeneration-Notebook/images/Linux_Layer_Json_File_for_Microsoft_Sentinel.svg?sanitize=true\\\">\\r\\n\\r\\n\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"MITREATT&CKHeatmaps\"},\"name\":\"text - 1\"}],\"fromTemplateId\":\"sentinel-mitreattack\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId10'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=MITREATTACKWorkbook; logoFileName=Azure_Sentinel.svg; description=Workbook to showcase MITRE ATT&CK Coverage for Microsoft Sentinel; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.1; title=MITRE ATT&CK Workbook; templateRelativePath=MITREAttack.json; subtitle=; provider=Microsoft Sentinel community}.description",
                "parentId": "[variables('workbookId10')]",
                "contentId": "[variables('_workbookContentId10')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "SecurityAlert",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId10')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook10-name')]",
        "contentProductId": "[variables('_workbookcontentProductId10')]",
        "id": "[variables('_workbookcontentProductId10')]",
        "version": "[variables('workbookVersion10')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName11')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SecurityOperationsEfficiencyWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion11')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId11')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Security operations center managers can view overall efficiency metrics and measures regarding the performance of their team. They can find operations by multiple indicators over time including severity, MITRE tactics, mean time to triage, mean time to resolve and more. The SOC manager can develop a picture of the performance in both general and specific areas over time and use it to improve efficiency."
              },
              "properties": {
                "displayName": "[parameters('workbook11-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Security Operations Efficiency\"},\"customWidth\":\"35\",\"name\":\"Main headline\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":\"[]\",\"parameters\":[{\"id\":\"9a199167-2dde-49dd-8f01-23e9d1fa8151\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"InternalWSs\",\"type\":1,\"isRequired\":true,\"query\":\"SecurityIncident\\r\\n| take 1\\r\\n| parse IncidentUrl with * \\\"/workspaces/\\\" Workspace \\\"/\\\" *\\r\\n| project Workspace\",\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"7806fefd-432f-4828-9756-8c0be5c08d07\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"InternalSub\",\"type\":1,\"isRequired\":true,\"query\":\"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| take 1\\r\\n| project subscriptionId\",\"crossComponentResources\":[\"value::selected\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"55d3ab63-6e1f-4d02-8d9e-2225526689c7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"isRequired\":true,\"query\":\"Resources\\r\\n| summarize Count = count() by subscriptionId\\r\\n| order by Count desc\\r\\n| extend Rank = row_number()\\r\\n| project value = subscriptionId, label = subscriptionId, selected = Rank == 1\",\"crossComponentResources\":[\"value::selected\"],\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"95a45501-31b5-4ea2-bcb3-eb208e0080e2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"//resources | where type =~ 'Microsoft.operationsmanagement/solutions' | where name contains //'SecurityInsights' | project id //= tostring(properties.workspaceResourceId)\\r\\n\\r\\nwhere type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| project value =id, label = name, selected = iff(name =~ '{InternalWSs}', true, false)\\r\\n\\r\\n\\r\\n\",\"crossComponentResources\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"7d597ad7-4a2a-45ed-a4fe-7ee32de0fc22\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Incident Creation Time\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000}],\"allowCustom\":true}},{\"id\":\"3a87d4f7-42cc-4c62-b543-6b5d9ab8cf27\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Severity\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| summarize Count = count(IncidentNumber) by Severity\\r\\n| project Value = Severity, Label = strcat(Severity, \\\": \\\", Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"81085d3a-5aca-488e-b7c6-ecf1167e59f7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Tactics\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend Tactics = todynamic(AdditionalData.tactics)\\r\\n| mvexpand Tactics to typeof(string)\\r\\n| summarize Count=count(IncidentNumber) by Tactics\\r\\n| project Value = Tactics, Label = strcat(Tactics, \\\": \\\", Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"0f9efb0d-ac34-41d0-8a19-165840eb2a71\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Owner\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend owner = tostring(Owner.assignedTo) \\r\\n| summarize Count=count(IncidentNumber) by Owner= case(owner==\\\"\\\", \\\"Unassigned\\\",owner)\\r\\n| project Value = Owner, Label = strcat(Owner, \\\": \\\", Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"cf86113b-59ad-4fc9-aeb7-9b44e230641e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Product\",\"label\":\"Product Name\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend Product = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0]) \\r\\n| summarize Count=count(IncidentNumber) by Product\\r\\n| project Value = Product, Label = strcat(Product, \\\": \\\", Count)\\r\\n\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"baa92cd2-7ade-41c3-a07c-a11f5ce3e0e6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"label\":\"Show Help\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"jsonData\":\"[{ \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true }]\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"customWidth\":\"100\",\"name\":\"parameters - 6\"},{\"type\":1,\"content\":{\"json\":\"## Incidents created over time\"},\"customWidth\":\"67\",\"name\":\"Incidents over time - headline\"},{\"type\":1,\"content\":{\"json\":\"## Incidents by closing classification\"},\"customWidth\":\"32\",\"name\":\"Incidents by classification - headline\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident \\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| summarize arg_max(TimeGenerated, Status, Severity, Owner, AdditionalData,CreatedTime) by IncidentNumber\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize count() by bin(CreatedTime, 1h)\\n\\n\\n\\n\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"timeBrushParameterName\":\"TimeBrush\",\"exportFieldName\":\"CreatedTime\",\"exportParameterName\":\"TimePicker\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"unstackedbar\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"CreatedTime\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"CreatedTime\",\"sortOrder\":2}],\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"count_\",\"label\":\"Incidents\"}]}},\"customWidth\":\"67\",\"name\":\"Incidents over time \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where CreatedTime >= {TimeBrush:start} and CreatedTime <= {TimeBrush:end}\\n| where Status == 'Closed'\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| extend feedback =strcat(Classification,\\\" \\\",ClassificationReason)\\n| summarize dcount(IncidentNumber) by feedback\\n\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"Incidents by classification - headline\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident \\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| summarize arg_max(TimeGenerated,Status, Severity, Owner, AdditionalData) by IncidentNumber\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize dcount(IncidentNumber) by Severity\",\"size\":1,\"title\":\"Incidents created by severity\",\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Classification\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"dcount_IncidentNumber\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Informational\",\"color\":\"gray\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"red\"}]}},\"customWidth\":\"22\",\"name\":\"By severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| summarize arg_max(TimeGenerated, Status, Severity, Owner, AdditionalData) by IncidentNumber\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize count() by case(tostring(Owner)==\\\"\\\", \\\"Unassigned\\\",tostring(Owner))\\n\\n\",\"size\":1,\"title\":\"Incidents created by owner\",\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Classification\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"dcount_IncidentNumber\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"22\",\"name\":\"By owner\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| summarize arg_max(TimeGenerated, Status, Severity, Owner, AdditionalData) by IncidentNumber\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize count() by Status\\n\",\"size\":1,\"title\":\"Incidents created by status\",\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Classification\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"dcount_IncidentNumber\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"22\",\"name\":\"By status\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"Time to triage, is the time between the incident creation and its first update.\",\"style\":\"info\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Help1\"},{\"type\":1,\"content\":{\"json\":\"Time to closure, is the time between the incident creation and its last closure.\",\"style\":\"info\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Help1 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where FirstModifiedTime  >= {TimeRange:start} and FirstModifiedTime  <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\n| extend TimeToTriage =  (FirstModifiedTime - CreatedTime)/1h\\n| summarize AvgTTT=avg(TimeToTriage) \\n\",\"size\":1,\"title\":\"Mean time to triage\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AvgTTT\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"50\",\"name\":\"MTTT\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where ClosedTime >= {TimeRange:start} and ClosedTime <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize arg_max(TimeGenerated,*) by IncidentNumber \\n| extend TimeToClosure =  (ClosedTime - CreatedTime)/1h\\n| summarize AvgTTC=avg(TimeToClosure)\",\"size\":1,\"title\":\"Mean time to closure \",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"sortBy\":\"[]\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Classification\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AvgTTC\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"50\",\"name\":\"MTTM\"}]},\"customWidth\":\"34\",\"name\":\"Mean times\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Incidents created by severity over time \"},\"name\":\"text - 2 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident \\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize Incidents=dcount(IncidentNumber) by Severity, bin(CreatedTime, 1d)\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"linechart\"},\"name\":\"query - 2 - Copy - Copy\"}]},\"name\":\"Incidents severity over time\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Incidents created by owner over time \"},\"name\":\"text - 2 - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident \\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize Incidents=dcount(IncidentNumber) by case(tostring(Owner)==\\\"\\\", \\\"Unassigned\\\",tostring(Owner)), bin(CreatedTime, 1d)\\n\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"linechart\"},\"name\":\"query - 2 - Copy - Copy - Copy\"}]},\"name\":\"Incident owner over time\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Incidents created by status over time\"},\"name\":\"text - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident \\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize Incidents=dcount(IncidentNumber) by Status, bin(CreatedTime, 1d)\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"series\",\"exportParameterName\":\"Status\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"linechart\"},\"name\":\"query - 2 - Copy\"}]},\"name\":\"Incident status over time\",\"styleSettings\":{\"margin\":\"0\",\"padding\":\"0\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Incidents created by product over time\"},\"name\":\"text - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident \\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize Incidents=dcount(IncidentNumber) by tostring(Product), bin(CreatedTime, 1d)\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"series\",\"exportParameterName\":\"Status\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"linechart\"},\"name\":\"query - 2 - Copy\"}]},\"name\":\"Incident status over time - Copy\",\"styleSettings\":{\"margin\":\"0\",\"padding\":\"0\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Incidents created by tactics over time \"},\"name\":\"text - 2 - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident \\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| mvexpand Tactics to typeof(string)\\n| summarize Incidents=dcount(IncidentNumber) by Tactics, bin(CreatedTime, 1d)\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"unstackedbar\"},\"name\":\"query - 2 - Copy - Copy - Copy - Copy\"}]},\"name\":\"Incidents tactic over time\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Incidents created by tags over time \"},\"name\":\"text - 2 - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident \\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| extend Tags = extract_all('labelName\\\":\\\"(.*?)\\\"',tostring(Labels))\\n| mvexpand Tags to typeof(string)\\n| summarize Incidents=dcount(IncidentNumber) by Tags, bin(CreatedTime, 1d)\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"unstackedbar\"},\"name\":\"query - 2 - Copy - Copy - Copy - Copy\"}]},\"name\":\"Incidents tactic over time - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Incidents created by name\"},\"name\":\"text - 2 - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident \\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| summarize arg_max(TimeGenerated, Status, Severity, Owner, AdditionalData,CreatedTime) by IncidentNumber, Title\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize count() by bin(CreatedTime, 1h), Title\\n| order by count_ desc\",\"size\":1,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\"},\"name\":\"query - 2 - Copy - Copy - Copy - Copy\"}]},\"name\":\"Incidents tactic over time - Copy - Copy\"}]},\"customWidth\":\"50\",\"name\":\"Over time left panel\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Time to triage (percentiles)\"},\"name\":\"text - 2 - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"Time to triage, is the time between the incident creation and its first update.\",\"style\":\"info\"},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Help2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where FirstModifiedTime  >= {TimeRange:start} and FirstModifiedTime  <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\n| extend TimeToTriage =  (FirstModifiedTime - CreatedTime)/1h\\n| summarize 5th_Percentile=max_of(percentile(TimeToTriage, 5),0),50th_Percentile=percentile(TimeToTriage, 50), 90th_Percentile=percentile(TimeToTriage, 90),99th_Percentile=percentile(TimeToTriage, 99) by bin(FirstModifiedTime, 1d)\\n\",\"size\":1,\"aggregation\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"linechart\",\"chartSettings\":{\"ySettings\":{\"numberFormatSettings\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":3}}}}},\"name\":\"query - 2 - Copy - Copy\"}]},\"name\":\"Incidents severity over time\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Time to closure (percentiles)\\r\\n\"},\"name\":\"text - 2 - Copy - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"Time to closure, is the time between the incident creation and its last closure.\",\"style\":\"info\"},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Help3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where ClosedTime  >= {TimeRange:start} and ClosedTime  <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\n| extend TimeToClosure =  (ClosedTime - CreatedTime)/1h\\n| summarize 5th_Percentile=percentile(TimeToClosure, 5),50th_Percentile=percentile(TimeToClosure, 50), 90th_Percentile=percentile(TimeToClosure, 90),99th_Percentile=percentile(TimeToClosure, 99) by bin(ClosedTime, 1d)\\n\",\"size\":1,\"aggregation\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"linechart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"percentile_MinToTriage_5\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"percentile_MinToTriage_5\",\"sortOrder\":2}],\"tileSettings\":{\"showBorder\":false},\"chartSettings\":{\"ySettings\":{\"numberFormatSettings\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":3}},\"min\":0}}},\"name\":\"query - 2 - Copy - Copy - Copy\"}]},\"name\":\"Incident owner over time\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Mean time to closure per owner\\r\\n\"},\"name\":\"text - 2 - Copy\"},{\"type\":1,\"content\":{\"json\":\"The mean time between the incident creation and last closure by owner\",\"style\":\"info\"},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Help3 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where CreatedTime >= {TimeBrush:start} and CreatedTime <= {TimeBrush:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n|where Status == 'Closed'  \\n| extend Ownerr = case(tostring(Owner)==\\\"\\\", \\\"Unassigned\\\",tostring(Owner))\\n| summarize arg_min(LastModifiedTime,*) by IncidentNumber, Owner = Ownerr\\n| extend TimeToTriage = LastModifiedTime - CreatedTime, Owner\\n| summarize avg(TimeToTriage/1h) by Owner\\n\",\"size\":4,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"series\",\"exportParameterName\":\"Status\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Owner\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"avg_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},\"showBorder\":false}},\"name\":\"query - 2 - Copy\"}]},\"name\":\"Incident status over time\",\"styleSettings\":{\"margin\":\"0\",\"padding\":\"0\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Mean time to triage per owner\\r\\n\"},\"name\":\"text - 2 - Copy\"},{\"type\":1,\"content\":{\"json\":\"The mean time between the incident creation and first modification by owner\",\"style\":\"info\"},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Help3 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where CreatedTime >= {TimeRange:start} and CreatedTime <= {TimeRange:end}\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize arg_max(FirstModifiedTime,*) by IncidentNumber \\n| extend TimeToTriage =  FirstModifiedTime - CreatedTime\\n| extend MinToTriage = TimeToTriage/1h\\n| summarize avg(TimeToTriage/1h) by owner=case(tostring(Owner)==\\\"\\\", \\\"Unassigned\\\",tostring(Owner))\\n\\n\",\"size\":4,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"series\",\"exportParameterName\":\"Status\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"owner\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"avg_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},\"showBorder\":false}},\"name\":\"query - 2 - Copy\"}]},\"name\":\"Incident status triage\",\"styleSettings\":{\"margin\":\"0\",\"padding\":\"0\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Actions per user\"},\"name\":\"text - 2 - Copy\"},{\"type\":1,\"content\":{\"json\":\"The number of actions taken on incidents per incident modifier\",\"style\":\"info\"},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Help3 - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where CreatedTime >= {TimeBrush:start} and CreatedTime <= {TimeBrush:end}\\n| where ModifiedBy !in(\\\"Alert Grouping\\\",\\\"Fusion\\\",\\\"Incident created from alert\\\")\\n| where ModifiedBy !contains(\\\"Automation rule\\\")\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| summarize count() by ModifiedBy\\n\",\"size\":4,\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"series\",\"exportParameterName\":\"Status\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"ModifiedBy\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2}},\"name\":\"query - 2 - Copy\"}]},\"name\":\"Incident status over time - Copy\",\"styleSettings\":{\"margin\":\"0\",\"padding\":\"0\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Recent activities\"},\"name\":\"text - 2 - Copy - Copy - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"Most recent activities taken on incidents\",\"style\":\"info\"},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Help3 - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| order by LastModifiedTime \\n| project LastModifiedTime,IncidentNumber, Title, Product, IncidentUrl, ModifiedBy,Status, Severity, Owner\\n| take 250\\n\\n\\n\",\"size\":1,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to incident >\"}}],\"labelSettings\":[{\"columnId\":\"LastModifiedTime\",\"label\":\"Last Modified Time\"},{\"columnId\":\"IncidentNumber\",\"label\":\"Incident Number\"},{\"columnId\":\"Title\"},{\"columnId\":\"Product\"},{\"columnId\":\"IncidentUrl\",\"label\":\"Link to incident\"},{\"columnId\":\"ModifiedBy\",\"label\":\"Modified By\"},{\"columnId\":\"Status\"},{\"columnId\":\"Severity\"}]},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"IncidentNumber\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 2 - Copy - Copy - Copy - Copy\"}]},\"name\":\"Incidents tactic over time - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Recent incident closing classification\"},\"name\":\"text - 2 - Copy - Copy - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"Recent closing classifications and comments of incidents\",\"style\":\"info\"},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Help3 - Copy - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where Severity in ({Severity}) or \\\"*\\\" in ({Severity})\\n| extend Tactics = todynamic(AdditionalData.tactics)\\n| where Tactics in ({Tactics}) or \\\"*\\\" in ({Tactics})\\n| extend Owner = todynamic(Owner.assignedTo) \\n| where Owner in ({Owner}) or \\\"*\\\" in ({Owner})\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\n| where Product in ({Product}) or \\\"*\\\" in ({Product})\\n| where Status == 'Closed'\\n| order by LastModifiedTime \\n| project LastModifiedTime,IncidentNumber, Title, Classification, ClassificationReason,ClassificationComment, Product, IncidentUrl, ModifiedBy,Status, Severity,Owner\\n| take 250\\n\\n\\n\",\"size\":1,\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to incident >\"}}],\"labelSettings\":[{\"columnId\":\"LastModifiedTime\",\"label\":\"Last Modified Time\"},{\"columnId\":\"IncidentNumber\",\"label\":\"Incident Number\"},{\"columnId\":\"Title\"},{\"columnId\":\"Classification\"},{\"columnId\":\"ClassificationReason\",\"label\":\"Classification Reason\"},{\"columnId\":\"ClassificationComment\",\"label\":\"Classification Comment\"},{\"columnId\":\"Product\"},{\"columnId\":\"IncidentUrl\",\"label\":\"Link to incident\"},{\"columnId\":\"ModifiedBy\",\"label\":\"Modified By\"},{\"columnId\":\"Status\"},{\"columnId\":\"Severity\"}]},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"IncidentNumber\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 2 - Copy - Copy - Copy - Copy\"}]},\"name\":\"Incidents tactic over time - Copy\"}]},\"customWidth\":\"50\",\"name\":\"Over time right panel\"}],\"fromTemplateId\":\"sentinel-SecurityOperationsEfficiency\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId11'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=SecurityOperationsEfficiency; logoFileName=Azure_Sentinel.svg; description=Security operations center managers can view overall efficiency metrics and measures regarding the performance of their team. They can find operations by multiple indicators over time including severity, MITRE tactics, mean time to triage, mean time to resolve and more. The SOC manager can develop a picture of the performance in both general and specific areas over time and use it to improve efficiency.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.5.0; title=Security Operations Efficiency; templateRelativePath=SecurityOperationsEfficiency.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId11')]",
                "contentId": "[variables('_workbookContentId11')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion11')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "SecurityAlert",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SecurityIncident",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId11')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook11-name')]",
        "contentProductId": "[variables('_workbookcontentProductId11')]",
        "id": "[variables('_workbookcontentProductId11')]",
        "version": "[variables('workbookVersion11')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName12')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SecurityStatusWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion12')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId12')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "This workbook gives an overview of Security Settings for VMs and Azure Arc."
              },
              "properties": {
                "displayName": "[parameters('workbook12-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"value::selected\"],\"parameters\":[{\"id\":\"688dc7cb-bea3-41ae-ae94-32d22e09568c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DefaultWorkspace\",\"type\":5,\"isRequired\":true,\"value\":\"value::1\",\"isHiddenWhenLocked\":true,\"typeSettings\":{\"resourceTypeFilter\":{\"microsoft.operationalinsights/workspaces\":true},\"additionalResourceOptions\":[\"value::1\"]}},{\"id\":\"c11b5651-cf86-4865-b23d-9ecc4f16b712\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ContextFree\",\"type\":1,\"query\":\"{\\\"version\\\":\\\"1.0.0\\\",\\\"content\\\":\\\"\\\\\\\"{DefaultWorkspace}\\\\\\\"\\\"}\",\"isHiddenWhenLocked\":true,\"queryType\":8},{\"id\":\"bbbc300a-6f91-4b2b-b4b5-842b4bf8577a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Selection\",\"type\":1,\"query\":\"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend match = strcat(\\\"'\\\", id, \\\"'\\\") =~ \\\"{DefaultWorkspace:value}\\\"\\r\\n| order by match desc, name asc\\r\\n| take 1\\r\\n| project value = tostring(pack('sub', subscriptionId, 'rg', resourceGroup, 'ws', id))\",\"crossComponentResources\":[\"value::selected\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"conditionalVisibility\":{\"parameterName\":\"_\",\"comparison\":\"isEqualTo\",\"value\":\"_\"},\"name\":\"parameters - 0\"},{\"type\":1,\"content\":{\"json\":\"# Computer Security Status\\r\\n<br>\\r\\n### This report shows various security status messages from Azure Resource Graph and Log Analytics\"},\"conditionalVisibility\":{\"parameterName\":\"ContextFree\",\"comparison\":\"isEqualTo\",\"value\":\"value::1\"},\"name\":\"text - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspaces}\"],\"parameters\":[{\"id\":\"1db5ee15-fe52-458b-91d1-7ee39d8c2cd3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscriptions\",\"type\":6,\"isRequired\":true,\"query\":\"summarize by subscriptionId\\r\\n| project value = strcat('/subscriptions/', subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ todynamic('{Selection}').sub, true, false)\",\"crossComponentResources\":[\"value::selected\"],\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"9732eff8-fb57-4cbd-8ade-5ae746f33760\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspaces\",\"type\":5,\"isRequired\":true,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| summarize by id, name\\r\\n| project id, selected = iff(id =~ todynamic('{Selection}').ws, true, false)\",\"crossComponentResources\":[\"{Subscriptions}\"],\"value\":\"/subscriptions/<subs_ID>/resourcegroups/<rg_name>/providers/microsoft.operationalinsights/workspaces/<workspace_name>\",\"typeSettings\":{\"resourceTypeFilter\":{\"microsoft.operationalinsights/workspaces\":true},\"additionalResourceOptions\":\"[]\"},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"5f8cce4b-9c4c-47da-8683-7e5ccc9faed3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000,\"createdTime\":\"2018-10-04T22:01:18.372Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":900000,\"createdTime\":\"2018-10-04T22:01:18.372Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":1800000,\"createdTime\":\"2018-10-04T22:01:18.372Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":3600000,\"createdTime\":\"2018-10-04T22:01:18.372Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":14400000,\"createdTime\":\"2018-10-04T22:01:18.374Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":43200000,\"createdTime\":\"2018-10-04T22:01:18.374Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":86400000,\"createdTime\":\"2018-10-04T22:01:18.374Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":172800000,\"createdTime\":\"2018-10-04T22:01:18.374Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":259200000,\"createdTime\":\"2018-10-04T22:01:18.375Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":604800000,\"createdTime\":\"2018-10-04T22:01:18.375Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":1209600000,\"createdTime\":\"2018-10-04T22:01:18.375Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":2592000000,\"createdTime\":\"2018-10-04T22:01:18.375Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":5184000000,\"createdTime\":\"2018-10-04T22:01:18.375Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":7776000000,\"createdTime\":\"2018-10-04T22:01:18.375Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false}],\"allowCustom\":true},\"value\":{\"durationMs\":604800000}},{\"id\":\"d6de19ff-cde4-41c2-9fba-b441312ea5c9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Test\",\"type\":1,\"query\":\"Perf\\r\\n| where TimeGenerated {TimeRange}\\r\\n| take 1\",\"crossComponentResources\":[\"{Workspaces}\"],\"isHiddenWhenLocked\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"4e5f340e-9ca8-4f16-aa10-48d30b486cce\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Computer\",\"type\":5,\"query\":\"resources\\r\\n| where type == \\\"microsoft.compute/virtualmachines\\\" or type == \\\"microsoft.hybridcompute/machines\\\"\\r\\n| project name\",\"crossComponentResources\":[\"{Workspaces}\"],\"value\":\"default\",\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 2\"},{\"type\":1,\"content\":{\"json\":\" A subscription has not yet been selected. Select a subscription under the `Subscriptions` dropdown or refresh the workbook.\"},\"conditionalVisibility\":{\"parameterName\":\"Subscriptions\",\"comparison\":\"isEqualTo\",\"value\":\"\"},\"name\":\"text - 29\"},{\"type\":1,\"content\":{\"json\":\"---\"},\"name\":\"text - 4\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Status\",\"subTarget\":\"Status\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Events\",\"subTarget\":\"Events\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Azure Arc\",\"subTarget\":\"Arc\",\"style\":\"link\"}]},\"name\":\"links - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\r\\n| where type == \\\"microsoft.security/securitystatuses\\\" or type == \\\"microsoft.security/securitystatuses/servers\\\" or type == \\\"microsoft.security/assessments\\\" \\r\\n//| where name startswith '{Computer}'\\r\\n| extend compute = tostring(properties.type)\\r\\n| where compute =~\\\"virtualmachine\\\"\\r\\n| summarize count() by name\",\"size\":4,\"title\":\"Count of Computers with Security status info\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Workspaces}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"showMetrics\":false}},\"customWidth\":\"50\",\"name\":\"query - 20 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"union withsource = Table_Name *\\r\\n| where Table_Name in (\\\"Syslog\\\",\\\"SecurityEvent\\\",\\\"CommonSecurityLog\\\")\\r\\n| summarize count(EventID) by Table_Name\",\"size\":4,\"title\":\"Count of log entries by Type\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspaces}\"],\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"query - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\r\\n| where type == \\\"microsoft.security/securitystatuses\\\" or type == \\\"microsoft.security/securitystatuses/servers\\\" or type == \\\"microsoft.security/assessments\\\" \\r\\n| where name startswith '{Computer}'\\r\\n| extend p=array_length(properties.resourceDetails) \\r\\n| extend compute = tostring(properties.type)\\r\\n| where compute =~\\\"virtualmachine\\\"\\r\\n| mvexpand prop=properties.resourceDetails\\r\\n| project ComputerName = name, Resource= prop.name, Status = prop.value \",\"size\":0,\"title\":\"Security Status for {Computer}\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Workspaces}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ComputerName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Status\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Status\"},\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\r\\n| where type == \\\"microsoft.security/assessments\\\"\\r\\n| where properties contains '{Computer}'\\r\\n| project Resource = properties.displayName, Status = trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.status,\\\":\\\",1))), Location =  trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.resourceDetails,\\\":\\\",1)))\\r\\n| extend Status  = iif(Status has \\\",\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Status,\\\",\\\",0))),Status)\\r\\n| extend Location = iif(Location has \\\"\\\\\\\\\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Location,\\\"\\\\\\\\\\\",0))),Location)\\r\\n| summarize count() by Status, tostring(Resource), Location\",\"size\":1,\"title\":\"Security Asessment findings for {Computer}\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Workspaces}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Status\"},\"name\":\"query - 18\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\r\\n| where type == \\\"microsoft.security/assessments\\\"\\r\\n| where properties contains '{Computer}'\\r\\n| project Resource = properties.displayName, Status = trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.status,\\\":\\\",1))), Location =  trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.resourceDetails,\\\":\\\",1)))\\r\\n| extend Status   = iif(Status has \\\",\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Status,\\\",\\\",0))),Status)\\r\\n| extend Location = iif(Location has \\\"\\\\\\\\\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Location,\\\"\\\\\\\\\\\",0))),Location)\\r\\n| summarize count() by Status, tostring(Resource), Location\\r\\n| order by count_ desc\",\"size\":0,\"title\":\"Security Asessment findings for {Computer}\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Workspaces}\"],\"gridSettings\":{\"filter\":true,\"sortBy\":[{\"itemKey\":\"Status\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Status\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Status\"},\"name\":\"query - 18 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\r\\n| where Computer startswith \\\"{Computer}\\\"\\r\\n| summarize count() by Activity\\r\\n\",\"size\":1,\"title\":\"Securtity Events for: {Computer} \",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspaces}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Activity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Activity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"Activity\",\"nodeSize\":\"\",\"staticNodeSize\":100,\"colorSettings\":\"\",\"hivesMargin\":5}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Events\"},\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where Computer startswith \\\"{Computer}\\\"\\r\\n| summarize count() by Facility, SeverityLevel\\r\\n\",\"size\":1,\"title\":\"Syslog for: {Computer}\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspaces}\"],\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Events\"},\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where Computer startswith \\\"{Computer}\\\"\\r\\n| summarize count() by DeviceVendor, DeviceEventClassID, Message\\r\\n\",\"size\":1,\"title\":\"CommonSecurityEvent (CEF) for: {Computer}\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspaces}\"],\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Events\"},\"name\":\"query - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"union isfuzzy=true     (W3CIISLog\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude),     (DnsEvents\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country= RemoteIPCountry, Latitude = RemoteIPLatitude, Longitude = RemoteIPLongitude),     (WireData\\r\\n| extend TrafficDirection = iff(Direction != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude),     (WindowsFirewall\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"SEND\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude),     (CommonSecurityLog\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude, Confidence=ThreatDescription, Description=ThreatDescription),     (VMConnection\\r\\n| where Type == \\\"VMConnection\\\"\\r\\n| extend TrafficDirection = iff(Direction != \\\"outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteCountry, Latitude=RemoteLatitude, Longitude=RemoteLongitude)\\r\\n| where isnotempty(MaliciousIP) and isnotempty(Country) and isnotempty(Latitude) and isnotempty(Longitude)\\r\\n| where Computer startswith \\\"{Computer}\\\"\\r\\n| summarize MaliciousIPcount = count(MaliciousIP) by Country//, Latitude, Longitude\\r\\n| order by MaliciousIPcount desc\\r\\n| top 10 by Country\\r\\n\",\"size\":0,\"title\":\"Potential Locations for: {Computer}\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspaces}\"],\"visualization\":\"map\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"MaliciousIPcount\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"MaliciousIPcount\",\"sortOrder\":2}],\"mapSettings\":{\"locInfo\":\"CountryRegion\",\"locInfoColumn\":\"Country\",\"latitude\":\"Latitude\",\"longitude\":\"Longitude\",\"sizeSettings\":\"MaliciousIPcount\",\"sizeAggregation\":\"Sum\",\"defaultSize\":0,\"labelSettings\":\"MaliciousIP\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"MaliciousIPcount\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Events\"},\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"union isfuzzy=true     (W3CIISLog\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude),     (DnsEvents\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country= RemoteIPCountry, Latitude = RemoteIPLatitude, Longitude = RemoteIPLongitude),     (WireData\\r\\n| extend TrafficDirection = iff(Direction != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude),     (WindowsFirewall\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"SEND\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude),     (CommonSecurityLog\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude, Confidence=ThreatDescription, Description=ThreatDescription),     (VMConnection\\r\\n| where Type == \\\"VMConnection\\\"\\r\\n| extend TrafficDirection = iff(Direction != \\\"outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteCountry, Latitude=RemoteLatitude, Longitude=RemoteLongitude)\\r\\n| where isnotempty(MaliciousIP) and isnotempty(Country) and isnotempty(Latitude) and isnotempty(Longitude)\\r\\n| where Computer startswith \\\"{Computer}\\\"\\r\\n| summarize MaliciousIPcount = dcount(MaliciousIP), TableSource = make_set(Type) by Country, TrafficDirection\\r\\n| top 10 by MaliciousIPcount\\r\\n| order by MaliciousIPcount desc\\r\\n\\r\\n\",\"size\":0,\"title\":\"Top10: Potential Locations for: {Computer}\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspaces}\"],\"visualization\":\"table\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"MaliciousIPcount\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"MaliciousIPcount\",\"sortOrder\":2}],\"mapSettings\":{\"locInfo\":\"CountryRegion\",\"locInfoColumn\":\"Code\",\"latitude\":\"Latitude\",\"longitude\":\"Longitude\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"defaultSize\":0,\"labelSettings\":\"MaliciousIP\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"MaliciousIPcount\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Events\"},\"name\":\"query - 14 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" resources\\r\\n| where type == \\\"microsoft.hybridcompute/machines\\\"\\r\\n//| extend p=array_length(properties.provisioningState) \\r\\n| mvexpand prop=properties.provisioningState\\r\\n| project ComputerName = id,  Status = properties.status, State=prop, location, resourceGroup, type\",\"size\":1,\"title\":\"All Azure Arc resources\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"sortBy\":\"[]\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Arc\"},\"name\":\"query - 18\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\r\\n| where type == \\\"microsoft.security/assessments\\\"\\r\\n| where properties has '{Computer}'\\r\\n| project Resource = properties.displayName, Status = trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.status,\\\":\\\",1))), Location =  trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.resourceDetails,\\\":\\\",1)))\\r\\n| extend Status   = iif(Status has \\\",\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Status,\\\",\\\",0))),Status)\\r\\n| extend Location = iif(Location has \\\"\\\\\\\\\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Location,\\\"\\\\\\\\\\\",0))),Location)\\r\\n| where Location == \\\"OnPremise\\\"\\r\\n| summarize count() by Status, tostring(Resource), Location=\\\"Azure Arc\\\"\\r\\n| order by count_ desc\",\"size\":1,\"title\":\"Azure Arc Security Status for: {Computer}\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Status\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Location\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}]},\"sortBy\":\"[]\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Arc\"},\"name\":\"query - 18 - Copy\"}],\"fromTemplateId\":\"sentinel-SecurityStatus\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId12'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=SecurityStatusWorkbook; logoFileName=; description=This workbook gives an overview of Security Settings for VMs and Azure Arc.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.3.0; title=Security Status; templateRelativePath=SecurityStatus.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId12')]",
                "contentId": "[variables('_workbookContentId12')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion12')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "CommonSecurityLog",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SecurityEvent",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Syslog",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId12')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook12-name')]",
        "contentProductId": "[variables('_workbookcontentProductId12')]",
        "id": "[variables('_workbookcontentProductId12')]",
        "version": "[variables('workbookVersion12')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName13')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SentinelCentralWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion13')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId13')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Use this report to view Incident (and Alert data) across many workspaces, this works with Azure Lighthouse and across any subscription you have access to."
              },
              "properties": {
                "displayName": "[parameters('workbook13-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## View Azure Sentinel Incidents and details from any selected Workspaces \\r\\n\\r\\n\"},\"name\":\"text - 0\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"01868289-27ef-4b5e-ae83-1715cacde421\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"region\",\"label\":\"Region\",\"type\":2,\"description\":\"Filter by Azure Region (location)\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"Resources \\r\\n//| where type =~ \\\"microsoft.operationalinsights/workspaces\\\"\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| summarize WorkspaceCount = count(name) by location\\r\\n| order by location asc\\r\\n| project value=location, display=strcat(location,'(',WorkspaceCount,')')\",\"crossComponentResources\":[\"value::selected\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"1ca69445-60fc-4806-b43d-ac7e6aad630a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources\\r\\n| where '*' in ({region}) or location in ({region})\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| distinct subscriptionId, location\\r\\n| summarize by value = strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId\\r\\n| order by value asc\\r\\n\",\"crossComponentResources\":[\"value::selected\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"e94aafa3-c5d9-4523-89f0-4e87aa754511\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\n| extend customerID = trim(' ', tostring(properties.customerId))\\n| project id, customerID, name=tolower(name)\\n|join \\n(\\n\\tresources\\n\\t// Just show Workspaces that have Sentinel enabled\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\n\\t| where name has \\\"SecurityInsights\\\"\\n\\t| parse name with * '(' s_workspace ')'*\\n\\t| project name=tolower(s_workspace)\\n) on name\\n| project tolower(id), customerID, name\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"resourceTypeFilter\":{\"microsoft.operationalinsights/workspaces\":true},\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"value::all\"]},{\"id\":\"66f59acd-2628-457d-a5cd-176aa453472a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}},{\"id\":\"65e74c73-69f0-4eb5-a772-4fb5eae73d28\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"WorkspaceIDguid\",\"type\":1,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerID = trim(' ', tostring(properties.customerId))\\r\\n| project '{Workspace:name}', name, customerID\\r\\n| where '{Workspace:name}' has name\\r\\n//| project customerID, name\\r\\n// join two columns, seperate with a \\\":\\\"; ARG, will comma seperate each row by default\\r\\n| project strcat(customerID,\\\":\\\",name)\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"2af84437-b015-456b-9660-97c8415e72fd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Product\",\"label\":\"Product Name\",\"type\":2,\"description\":\"Filter on All or a named Product\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend productName_ = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| summarize by productName_\\r\\n\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"5a683c1d-5e10-4d94-bb2a-32c05b17da8e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"resourceGroup\",\"type\":1,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n//| where name ==  \\\"{Workspace:label}\\\" \\r\\n| project resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"306edc18-d122-478d-97aa-ebc5a4cb88db\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Owner\",\"type\":2,\"description\":\"Filter on All or a named Owner assigned to an Incident\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend owner = tostring(Owner.assignedTo) \\r\\n| summarize Count=count(IncidentNumber) by Owner= case(owner==\\\"\\\", \\\"Unassigned\\\",owner)\\r\\n| project Value = Owner, Label = strcat(Owner, \\\": \\\", Count)\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"04338a2a-010c-409d-91ac-4b74a0e9d56c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n { \\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Change Log\\\", \\\"label\\\": \\\"Change Log\\\"}\\r\\n]\",\"timeContextFromParameter\":\"TimeRange\",\"value\":\"Change Log\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 1\"},{\"type\":1,\"content\":{\"json\":\"## Sentinel Central\\r\\n### Change Log\\r\\nUse this report to view Incident and Alert data across many workspaces (works with Azure Lighthouse)\\r\\n\\r\\n\\r\\n|Version|Description|\\r\\n|---|---|\\r\\n|v1.2| View Alerts from multiple workspaces (Azure Lighhouse compatiable)|\\r\\n|v1.3| MSSP release |\\r\\n|v1.4| Add Workspace info |\\r\\n|v1.5| Add Workspace info |\\r\\n|v2.0| Multi workspace hunting. per Region selection from main drop down. |\\r\\n|v2.1| Addition of Workspace and Table specific retention. |\\r\\n\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Change Log\"},\"name\":\"text - 7\"},{\"type\":1,\"content\":{\"json\":\"## Sentinel Central Help\\r\\n#### Data sources: REST api, SentinelIncident and SecurityAlert Tables\\r\\n\\r\\n## Incident Overview: \\r\\nUse this report to view Incident (and Alert data) across many workspaces, this works with Azure Lighthouse and across any subscription you have access to. The Workbook is not intended to replace the Multiple Incidents across Workspace view/feature in the Azure Sentinel UI, it's just a way of seeing the data in a different way.\\r\\n- Workspaces not linked to Azure Sentinel will not be shown.\\r\\n\\r\\n## Hunting\\r\\nThis option allows you to use your own KQL (which you can write within the page, or copy from an example or existing query). This will run against *any* of the Workspaces you have selected in the parameters (local or via Azure Lighthouse), please remember the more Workspaces and time range selected, the slower the results.\\r\\n- Use case, this allows you to enter a simple KQL query that doesnt need the prefix of\\tworkspace(\\\"my workspace name\\\").my table name \\r\\n\\r\\ne.g. workspace(Demo\\\").Usage | limit 10\\r\\n\\r\\nor \\r\\n\\r\\n//Example query \\r\\nSecurityIncident\\r\\n| summarize High = countif(Severity ==\\\"High\\\"), Medium = countif(Severity ==\\\"Medium\\\"), MyIncidents=make_set(IncidentNumber ) by WorkspaceId=TenantId\\r\\n\\r\\n##### Note:\\r\\nIn your query it maybe useful to have the workspace ID returned, to do this you get the data from the TenantID column, as this name can be confusing we suggest you re-map it to WorkspaceID.\\r\\ne.g.\\r\\n\\tSecurityIncident | summarize count() by WorkspaceId=TenantId\\r\\n\\r\\n## Query Packs\\r\\nIf you are using Query Packs, use this Tab to open one (from any Resource Group), you can then click on a Query Pack and then on an individual query to run it. \\r\\n\\r\\n- Use case, storing queries this way enables you to share them and secure them (ARM and RBAC), this methods allows you to stay within the workbook to find and execute your queries.\\r\\n## Saved Searches\\r\\nAny Saved Searches from a selected Workspace can be run from this tab. \\r\\n\\r\\n- Use Case, you can see (if you have read rights) saved searches in a selected Workspace and click to run them. Much like the Query Pack method above.\\r\\n\\r\\n## Retention\\r\\nWorkspace and Table specific retention can be viewed in this tab.\\r\\n\\r\\n- Use Case, you can see (if you have read rights) the same or different level retention set on a table in a selected Workspace.\\r\\n\\r\\n\\r\\n\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 7 - Copy\"}],\"exportParameters\":true},\"name\":\"group - parameter and help\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"ad9f9173-35b3-4c1a-84e4-6f6062263c18\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Incident Overview\",\"subTarget\":\"incidents\",\"style\":\"link\"},{\"id\":\"f99135dc-8862-434b-ad1c-38714c1d8992\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Hunting\",\"subTarget\":\"hunting\",\"style\":\"link\"},{\"id\":\"f99e8417-fdad-434d-98a3-9b901c273650\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Query Pack\",\"subTarget\":\"querypack\",\"style\":\"link\"},{\"id\":\"a56b10fb-0e65-4308-9c9e-e6c56ef356c6\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Saved Searches\",\"subTarget\":\"saved\",\"style\":\"link\"},{\"id\":\"16449876-2e6f-4c55-9931-30b5d82baead\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Retention\",\"subTarget\":\"retention\",\"style\":\"link\"}]},\"name\":\"links - 7\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| summarize count(IncidentName) by   [\\\"Workspace\\\"] = workSpacename\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":4,\"title\":\"Count of Security Incidents for selected {$rowCount} Workspaces\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"wsName\"]},\"sortBy\":[{\"itemKey\":\"wsName\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"wsName\",\"sortOrder\":2}]},\"name\":\"query - 3 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| summarize High=  countif(Severity==\\\"High\\\"),\\r\\n            Medium=countif(Severity==\\\"Medium\\\"),\\r\\n            Low   =countif(Severity==\\\"Low\\\"), \\r\\n            Informational=countif(Severity==\\\"Informational\\\"),\\r\\n            Last_record =  datetime_diff(\\\"second\\\", now(), max(TimeGenerated)),\\r\\n            Total  = count()\\r\\n            by workSpacename\\r\\n| join\\r\\n(\\r\\nSecurityIncident\\r\\n// mean time to triage Section\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n//| where FirstModifiedTime  >= {TimeRange:start} and FirstModifiedTime  <= {TimeRange:end}\\r\\n| extend Owner = todynamic(Owner.assignedTo) \\r\\n| where Owner in ({Owner}) or '{Owner:label}' ==  \\\"All\\\"\\r\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\r\\n| where Product in ({Product}) or '{Product:label}' ==  \\\"All\\\"\\r\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\r\\n| extend TimeToTriage =  (FirstModifiedTime - CreatedTime)/1h\\r\\n| summarize 50th_PercentileMeanTime=percentile(TimeToTriage, 50) by workSpacename\\r\\n) on workSpacename\\r\\n|project-away workSpacename1\\r\\n| join\\r\\n(\\r\\nSecurityIncident\\r\\n// mean time to close Section\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| extend iD = TenantId\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n//| where ClosedTime >= {TimeRange:start} and ClosedTime <= {TimeRange:end}\\r\\n| extend Owner = todynamic(Owner.assignedTo) \\r\\n| where Owner in ({Owner}) or '{Owner:label}' ==  \\\"All\\\"\\r\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\r\\n| where Product in ({Product}) or '{Product:label}' ==  \\\"All\\\"\\r\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\r\\n| extend TimeToClosure =  (ClosedTime - CreatedTime)/1h\\r\\n| summarize 50th_PercentileCloseTime=percentile(TimeToClosure, 50) by workSpacename\\r\\n) on workSpacename\\r\\n|project-away workSpacename1\\r\\n| join\\r\\n(\\r\\nSecurityIncident\\r\\n    // Incident Trend by Workspace\\r\\n    // Get the Workspace Name(s) from a parameter\\r\\n    | extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n    | mv-expand stringtoSplit\\r\\n    | where stringtoSplit has TenantId\\r\\n    | extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n    | make-series IncidentTrend=count() on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by workSpacename\\r\\n) on workSpacename\\r\\n|project-away workSpacename1, TimeGenerated\\r\\n\\r\\n\",\"size\":1,\"title\":\"Security Incident summary for {$rowCount} Workspaces:  QueryTime {$queryTime}\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"workSpacename\",\"exportParameterName\":\"exportworkSpacename\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"High\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Medium\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Low\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Informational\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"Last_record\",\"formatter\":0,\"numberFormat\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}},{\"columnMatch\":\"Total\",\"formatter\":8,\"formatOptions\":{\"palette\":\"coldHot\"}},{\"columnMatch\":\"50th_PercentileMeanTime\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},{\"columnMatch\":\"50th_PercentileCloseTime\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":3}}},{\"columnMatch\":\"Trend\",\"formatter\":10,\"formatOptions\":{\"palette\":\"blueDark\"}},{\"columnMatch\":\"iD\",\"formatter\":5}],\"sortBy\":[{\"itemKey\":\"$gen_bar_High_1\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"workSpacename\",\"label\":\"Workspace Name\"},{\"columnId\":\"50th_PercentileMeanTime\",\"label\":\"Mean time to triage\"},{\"columnId\":\"50th_PercentileCloseTime\",\"label\":\"Mean time to closure\"}]},\"sortBy\":[{\"itemKey\":\"$gen_bar_High_1\",\"sortOrder\":2}]},\"name\":\"query - SecIncidents\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n | where type == \\\"microsoft.insights/workbooks\\\"\\r\\n | where properties.displayName has \\\"Security operations efficiency\\\" \\r\\n //| where properties.displayName has '{exportworkSpacename}'\\r\\n //| project properties.displayName, id\\r\\n | project id, note='Please select the Subscription and Workpsace names again in the new blade'\\r\\n | limit 1\\r\\n\\r\\n\",\"size\":4,\"title\":\"Open [Security Operations Efficiency] Workbook - if the Workbook exists locally?\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Click to Open [Security operations efficiency] workbook\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}],\"labelSettings\":[{\"columnId\":\"id\",\"label\":\"Open\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - open_SOC_workbook\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerWorkspaceID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerWorkspaceID, name=tolower(name), subscriptionId, tenantId\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace), subscriptionId, location, properties, resourceGroup\\r\\n) on name\\r\\n| where name =~ '{exportworkSpacename}'\\r\\n| project name, Open=tolower(id), tenantId, customerWorkspaceID,  subscriptionId, location, properties, resourceGroup\\r\\n\",\"size\":4,\"title\":\"Workspace details - click on \\\"name\\\" for more details\",\"exportedParameters\":[{\"fieldName\":\"tenantId\",\"parameterName\":\"exporttenantId\",\"parameterType\":1},{\"fieldName\":\"subscriptionId\",\"parameterName\":\"exportSubscriptionId\",\"parameterType\":1},{\"fieldName\":\"resourceGroup\",\"parameterName\":\"exportResourceGroup\",\"parameterType\":1},{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Click to Open [Security operations efficiency] workbook\",\"linkIsContextBlade\":false}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - Workspace Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/tenants?api-version=2020-01-01\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"\\\",\\\"value\\\":\\\"\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\"}}]}\",\"size\":4,\"title\":\"Tenant details\",\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"domains\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"Domain name(s)\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - Tenant Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{exportSubscriptionId}/resourceGroups/{exportResourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{exportworkSpacename}/providers/Microsoft.SecurityInsights/AlertRules\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"\\\",\\\"value\\\":\\\"\\\"},{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2020-01-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"properties.displayName\\\",\\\"columnid\\\":\\\"displayName\\\"},{\\\"path\\\":\\\"type\\\",\\\"columnid\\\":\\\"type\\\"},{\\\"path\\\":\\\"kind\\\",\\\"columnid\\\":\\\"kind\\\"},{\\\"path\\\":\\\"properties\\\",\\\"columnid\\\":\\\"properties\\\"},{\\\"path\\\":\\\"properties.lastModifiedUtc\\\",\\\"columnid\\\":\\\"lastModifiedUtc\\\"}]}}]}\",\"size\":4,\"title\":\"Rules details ('{exportName}' with {$rowCount} deployed Rules)\",\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"name\",\"formatter\":5},{\"columnMatch\":\"etag\",\"formatter\":5},{\"columnMatch\":\"domains\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"Domain name(s)\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}],\"rowLimit\":500,\"filter\":true,\"sortBy\":[{\"itemKey\":\"kind\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"kind\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportResourceGroup\",\"comparison\":\"isNotEqualTo\",\"value\":\"\"},\"name\":\"query - Rules details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"query - Workspace Details\\\",\\\"rightTable\\\":\\\"query - Tenant Details\\\",\\\"leftColumn\\\":\\\"tenantId\\\",\\\"rightColumn\\\":\\\"tenantId\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[query - Workspace Details].name\\\",\\\"mergedName\\\":\\\"name\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].Open\\\",\\\"mergedName\\\":\\\"Open\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].tenantId\\\",\\\"mergedName\\\":\\\"tenantId\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].customerWorkspaceID\\\",\\\"mergedName\\\":\\\"customerWorkspaceID\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].subscriptionId\\\",\\\"mergedName\\\":\\\"subscriptionId\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].location\\\",\\\"mergedName\\\":\\\"location\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].properties\\\",\\\"mergedName\\\":\\\"properties\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].id\\\",\\\"mergedName\\\":\\\"id\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantId\\\",\\\"mergedName\\\":\\\"tenantId1\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].countryCode\\\",\\\"mergedName\\\":\\\"countryCode\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].displayName\\\",\\\"mergedName\\\":\\\"displayName\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].domains\\\",\\\"mergedName\\\":\\\"domains\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantCategory\\\",\\\"mergedName\\\":\\\"tenantCategory\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].defaultDomain\\\",\\\"mergedName\\\":\\\"defaultDomain\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantType\\\",\\\"mergedName\\\":\\\"tenantType\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantBrandingLogoUrl\\\",\\\"mergedName\\\":\\\"tenantBrandingLogoUrl\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].resourceGroup\\\",\\\"mergedName\\\":\\\"resourceGroup\\\",\\\"fromId\\\":\\\"unknown\\\"}]}\",\"size\":4,\"title\":\"Tenant Details\",\"showExportToExcel\":true,\"queryType\":7,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"tenantId1\",\"formatter\":5},{\"columnMatch\":\"domains\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"Domain List\",\"linkIsContextBlade\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isNotEqualTo\"},\"showPin\":false,\"name\":\"query - merged Tenant view\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Classification and Tactics report\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| where Status == 'Closed'\\r\\n| order by LastModifiedTime \\r\\n| summarize count(), make_set(ClassificationComment) by workSpacename, Classification , ClassificationReason \\r\\n| evaluate pivot(Classification, sum(count_))\",\"size\":1,\"title\":\"Incident Classification report\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"set_ClassificationComment\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"BenignPositive\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"FalsePositive\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"TruePositive\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"Undetermined\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"set_ClassificationComment\",\"label\":\"Reason\"}]},\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":2}]},\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| extend Tactics_ = tostring(parse_json(tostring(AdditionalData.tactics)))\\r\\n| summarize  count()\\r\\n            by workSpacename, Tactics_\\r\\n| order by count_ desc\\r\\n| evaluate pivot(Tactics_, sum(count_))\",\"size\":1,\"title\":\"Incident Tactics report\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"set_ClassificationComment\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"TruePositive\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":1}],\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"workSpacename\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"[\\\"Collection\\\"]\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 10 - Tactics\"}]},\"name\":\"group - classification and tactics\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mvexpand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| summarize Total  = count()\\r\\n            by workSpacename\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":1,\"title\":\"Count of Security Incidents for selected Workspaces and Severity\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"High\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Medium\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Low\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Informational\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"labelSettings\":[{\"columnId\":\"workSpacename\",\"label\":\"Workspace Name\"}]}},\"customWidth\":\"40\",\"conditionalVisibility\":{\"parameterName\":\"hide\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - KQL for MAP count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n// Just show Workspaces that have Sentinel enabled\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| parse name with * '(' s_workspace ')'*\\r\\n| summarize count() by location, s_workspace\",\"size\":0,\"title\":\"Azure Sentinel Workspaces by Azure Region\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"mapSettings\":{\"locInfo\":\"AzureLoc\",\"locInfoColumn\":\"location\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"location\",\"legendMetric\":\"location\",\"legendAggregation\":\"Count\",\"itemColorSettings\":{\"nodeColorField\":\"count_\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"hide\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - ARG for MAp count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"query - KQL for MAP count\\\",\\\"rightTable\\\":\\\"query - ARG for MAp count\\\",\\\"leftColumn\\\":\\\"workSpacename\\\",\\\"rightColumn\\\":\\\"s_workspace\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[query - KQL for MAP count].workSpacename\\\",\\\"mergedName\\\":\\\"Workspace Name\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - KQL for MAP count].Total\\\",\\\"mergedName\\\":\\\"Total\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - ARG for MAp count].location\\\",\\\"mergedName\\\":\\\"location\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - ARG for MAp count].s_workspace\\\",\\\"mergedName\\\":\\\"s_workspace\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - ARG for MAp count].count_\\\",\\\"mergedName\\\":\\\"count_\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"}]}\",\"size\":0,\"title\":\"Azure Sentinel Incident Count by Region\",\"exportedParameters\":[{\"fieldName\":\"\",\"parameterName\":\"exportMap1\"},{\"fieldName\":\"location\",\"parameterName\":\"location\",\"parameterType\":1}],\"queryType\":7,\"visualization\":\"map\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"s_workspace\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"s_workspace\",\"sortOrder\":1}],\"mapSettings\":{\"locInfo\":\"AzureLoc\",\"locInfoColumn\":\"location\",\"sizeSettings\":\"Total\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"location\",\"legendMetric\":\"Total\",\"numberOfMetrics\":50,\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"Total\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n// Just show Workspaces that have Sentinel enabled\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| parse name with * '(' s_workspace ')'*\\r\\n| summarize count() by location, s_workspace\",\"size\":0,\"title\":\"Azure Sentinel Workspaces by Azure Region\",\"exportParameterName\":\"exportMap2\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"map\",\"mapSettings\":{\"locInfo\":\"AzureLoc\",\"locInfoColumn\":\"location\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"location\",\"legendMetric\":\"location\",\"legendAggregation\":\"Count\",\"itemColorSettings\":{\"nodeColorField\":\"count_\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"name\":\"query - 10\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"5443aca4-a73d-46ad-aaea-bd391acc3f0d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata1\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap1}')\\r\\n| project  ['region']=a.regionName,  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata2\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap2}')\\r\\n| project  ['region']=a.regionName,  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"793ac0c4-7518-4e52-9509-eb1bdf97854b\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata1_count\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap1}')\\r\\n| project  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"d4349432-c9cf-436e-9ede-2cd303c4bc9c\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata2_count\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap2}')\\r\\n| project  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"88076350-2736-407f-a272-6b473dc92c6c\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 8\"},{\"type\":1,\"content\":{\"json\":\"### Results from clicking on the Maps above\\r\\n--------------\\r\\n\\r\\n|Azure Region|Location|Incident Count|Workspace Counter|\\r\\n|---|---|---|\\r\\n|Azure Sentinel Incident Count by Region| {getMapdata1}|{getMapdata1_count}||\\r\\n|Azure Sentinel Workspaces by Azure Region| {getMapdata2}||{getMapdata2_count}|\\r\\n\\r\\n-----------\"},\"name\":\"text - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mvexpand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| extend Tactics_ = tostring(parse_json(tostring(AdditionalData.tactics)))\\r\\n| summarize  count()\\r\\n            by workSpacename, Tactics_\\r\\n| order by count_ desc\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":1,\"title\":\"Count of Tactics for selected Workspaces\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":3,\"formatOptions\":{\"palette\":\"coldHot\"}},{\"columnMatch\":\"High\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Medium\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Low\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Informational\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Total\",\"formatter\":8,\"formatOptions\":{\"palette\":\"coldHot\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"count\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"hide\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - 3 - Copy - Copy - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"incidents\"},\"name\":\"group - overview\"},{\"type\":1,\"content\":{\"json\":\"---------------\"},\"name\":\"text - 9\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Expand to Show: Incident details\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| where TimeGenerated > startofday(ago(0d))\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| extend productName_ = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| where productName_ in ({Product}) or '{Product:label}' ==\\\"All\\\"\\r\\n| summarize count() by IncidentNumber, Title, productName_, Severity, [\\\"Workspace\\\"] = workSpacename, IncidentUrl\\r\\n| order by Workspace asc , IncidentNumber desc\\r\\n//| top 50 by [\\\"Workspace\\\"]\",\"size\":1,\"title\":\"{$rowCount} Incidents in Workspaces today\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"exportedParameters\":[{\"fieldName\":\"IncidentNumber\",\"parameterName\":\"IncidentNumber\",\"parameterType\":1},{\"fieldName\":\"Workspace\",\"parameterName\":\"Workspace_export\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"productName_\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"greenDark\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Workspace\",\"formatter\":5},{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Open Azure Sentinel Incident\"}}],\"rowLimit\":5000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Workspace\"]},\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"productName_\",\"label\":\"Product Name\"}]},\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}]},\"name\":\"query - multi Alerts\"},{\"type\":1,\"content\":{\"json\":\"For further analysis I suggest you open the Azure Sentinel Incident Blade and _Investigate_ (use the hyper link provided in the table, if you have the correct RBAC).\\r\\n\\r\\nAlternatively open the [_Investigation Insights_] or [_Incident Overview_] Workbooks for guided and deeper investigation.  Open Incident Overview from the Portal, _Investigation Insights_ can be opened to the right --->.\\r\\n\\r\\n- You must have previoulsy SAVED these Workbooks in your workspace(s).  \\r\\n- Investigation Insights requires release v1.2 or above (you may have to manually select the Workspace), for prior versions you will have to select the matching Incident Number as well. \\r\\n- For the Workbooks to be listed, they need \\\"Investigation\\\" in the name when you save them.\"},\"customWidth\":\"50\",\"name\":\"text - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n | where type == \\\"microsoft.insights/workbooks\\\"\\r\\n | where properties.displayName has \\\"Investigation\\\" // or properties.displayName has \\\"Incident\\\"\\r\\n | where properties.displayName has '{Workspace_export}'\\r\\n | project properties.displayName, id,  {IncidentNumber}\\r\\n\",\"size\":4,\"title\":\"Workspace Name: {Workspace_export}\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"properties_displayName\",\"formatter\":1},{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Open Workbook\",\"linkIsContextBlade\":true}}],\"labelSettings\":[{\"columnId\":\"properties_displayName\",\"label\":\"Workbook Name\"},{\"columnId\":\"id\",\"label\":\"Open\"},{\"columnId\":\"Column1\",\"label\":\"Incident Number\"}]}},\"customWidth\":\"50\",\"name\":\"query - 11\"},{\"type\":1,\"content\":{\"json\":\"### Select a single workspace to see Incident level details \"},\"name\":\"text - 6\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"4383a3f4-7606-41a7-b1cf-e5bffd2d9ecb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"iWorkspace\",\"label\":\"Incident Workspace\",\"type\":7,\"query\":\"resources\\r\\n// Just show Workspaces that have Sentinel enabled\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| parse name with * '(' s_workspace ')'*\\r\\n| project name = s_workspace\\r\\n| sort by name asc\",\"crossComponentResources\":[\"{Subscription}\"],\"value\":\"\",\"typeSettings\":{\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"c2494755-05cc-4b93-b253-e8a0d4b7c899\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"iResourceGroup\",\"type\":1,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| where tolower(name) == \\\"{iWorkspace}\\\"\\r\\n| project resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of workspace validation, now match workspace to the selected parameter\\r\\n| where tolower(workSpacename) == tolower('{iWorkspace}')\\r\\n| summarize arg_max(TimeGenerated,*) by tostring(IncidentNumber)\\r\\n| extend Alerts = extract(\\\"\\\\\\\\[(.*?)\\\\\\\\]\\\", 1, tostring(AlertIds))\\r\\n| extend productName_ = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| where productName_ in ({Product}) or '{Product:label}' ==\\\"All\\\"\\r\\n| mv-expand AlertIds to typeof(string)\\r\\n| join \\r\\n(\\r\\n    SecurityAlert\\r\\n    | extend AlertEntities = parse_json(Entities)\\r\\n    | mv-expand AlertEntities\\r\\n) on $left.AlertIds == $right.SystemAlertId\\r\\n| summarize AlertCount=dcount(AlertIds), entityList=make_set(tostring(AlertEntities.Type)) by IncidentNumber, Status, Severity, Title,  Alerts, IncidentUrl, Owner=tostring(Owner.userPrincipalName) , Tactics =tostring(AdditionalData.tactics), workSpacename, productName_\\r\\n// set column order\\r\\n| project workSpacename, IncidentNumber, Severity, Status, AlertCount,Owner, Title, entityList, Tactics, IncidentUrl, productName_\\r\\n| order by IncidentNumber desc\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":0,\"title\":\"Details for {iWorkspace} Workspace, count of: {$rowCount} Incidents during {TimeRange:label}\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"workSpacename\",\"formatter\":5},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"greenDark\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"New\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AlertCount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"IncidentUrl\",\"formatter\":1,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Open Incident in Azure Sentinel \"}}],\"rowLimit\":500,\"filter\":true,\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"iWorkspace\",\"comparison\":\"isNotEqualTo\",\"value\":\"\"},\"name\":\"query - single alert\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"incidents\"},\"name\":\"group - Incidents\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Hunting: Hunt across selected workspaces, using any KQL you paste or edit in this field. \",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"fcc2456c-f4b5-4505-a188-aa4ebab3db67\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"queryTxt\",\"type\":1,\"description\":\"Add  workspace identity e.g SecurityIncident | summarize count() by WorkspaceId=TenantId\",\"value\":\"Perf \\r\\n| summarize count()  by WorkspaceId=TenantId\",\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"kql\"},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{queryTxt}\",\"size\":0,\"title\":\"Cross workspace Query results, rows: {$rowCount}, QueryTime: {$queryTime}.  Select a row for more details\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"WorkspaceId\",\"exportParameterName\":\"exportWorkspaceId\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Workspace\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}}]}},\"name\":\"query - crossWorkspaceQuery\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerWorkspaceID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerWorkspaceID, name=tolower(name), subscriptionId, tenantId\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace), subscriptionId, location, properties, resourceGroup\\r\\n) on name\\r\\n| where customerWorkspaceID in ('{exportWorkspaceId}')\\r\\n| project name, Open=tolower(id), tenantId, customerWorkspaceID,  subscriptionId, location, properties, resourceGroup\\r\\n\",\"size\":4,\"title\":\"{exportWorkspaceId} lookup  - used to identify tenant or workspace Ids from the results above\",\"exportedParameters\":[{\"fieldName\":\"tenantId\",\"parameterName\":\"exporttenantId\",\"parameterType\":1},{\"fieldName\":\"subscriptionId\",\"parameterName\":\"exportSubscriptionId\",\"parameterType\":1},{\"fieldName\":\"resourceGroup\",\"parameterName\":\"exportResourceGroup\",\"parameterType\":1},{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Click to Open [Security operations efficiency] workbook\",\"linkIsContextBlade\":false}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"tenantId\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"tenantId\",\"sortOrder\":1}]},\"conditionalVisibility\":{\"parameterName\":\"exportWorkspaceId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - Workspace Details\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"hunting\"},\"name\":\"group - hunting\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Query Pack: Use a Query Pack from any Resource Group, then pick a query to run from within the Query Pack\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"9a0c8c17-ac07-4b9a-b3d9-44060087935f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"description\":\"Find Query packs in specific subscriptions \",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"includeAll\":false,\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.operationalinsights/querypacks\\\"\\r\\n| project-away type, kind\",\"size\":0,\"exportedParameters\":[{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1},{\"fieldName\":\"resourceGroup\",\"parameterName\":\"resourceGroup\",\"parameterType\":1},{\"fieldName\":\"subscriptionId\",\"parameterName\":\"subscriptionId\",\"parameterType\":1}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"tenantId\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"location\",\"formatter\":17},{\"columnMatch\":\"resourceGroup\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"subscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":\"\",\"showIcon\":true}}]}},\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/microsoft.operationalInsights/querypacks/{exportName}/Queries\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2019-09-01-preview\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"properties.displayName\\\",\\\"columnid\\\":\\\"name\\\"},{\\\"path\\\":\\\"properties.body\\\",\\\"columnid\\\":\\\"body\\\"},{\\\"path\\\":\\\"properties.description\\\",\\\"columnid\\\":\\\"description\\\"},{\\\"path\\\":\\\"properties.tags\\\",\\\"columnid\\\":\\\"tags\\\"},{\\\"path\\\":\\\"systemData.lastModifiedAt\\\",\\\"columnid\\\":\\\"lastModifiedAt\\\"},{\\\"path\\\":\\\"systemData.lastModifiedBy\\\",\\\"columnid\\\":\\\"lastModifiedBy\\\"},{\\\"path\\\":\\\"systemData.createdBy\\\",\\\"columnid\\\":\\\"createdBy\\\"},{\\\"path\\\":\\\"systemData.createdBy\\\",\\\"columnid\\\":\\\"createdByType\\\"},{\\\"path\\\":\\\"systemData.createdAt\\\",\\\"columnid\\\":\\\"createdAt\\\"}]}}]}\",\"size\":1,\"title\":\"Select a Query to run from the list: {$rowCount} Queries in Query Pack: {exportName}\",\"exportedParameters\":[{\"fieldName\":\"body\",\"parameterName\":\"exportQuery\"},{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"body\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"createdByType\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"body\",\"label\":\"Query\"}]},\"sortBy\":[{\"itemKey\":\"createdByType\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"exportName\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query -Qp queries\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{exportQuery}\",\"size\":0,\"title\":\"Results of the selected Query: {exportName}\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"conditionalVisibility\":{\"parameterName\":\"exportQuery\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 3\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"querypack\"},\"name\":\"group - qp\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"KQL Saved Searches: Select a Workspace to check Saved Searches\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"54ab7c42-3983-46fd-bb6b-9a1d206eec3a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"description\":\"Lookup saved queries in any Azure Sentinel workspace\",\"isRequired\":true,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerID, name=tolower(name)\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace)\\r\\n) on name\\r\\n| project tolower(id), customerID, name\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"{Workspace}/SavedSearches\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2021-06-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"properties.displayName\\\",\\\"columnid\\\":\\\"displayName\\\"},{\\\"path\\\":\\\"properties.category\\\",\\\"columnid\\\":\\\"category\\\"},{\\\"path\\\":\\\"properties.query\\\",\\\"columnid\\\":\\\"query\\\"},{\\\"path\\\":\\\"properties.version\\\",\\\"columnid\\\":\\\"version\\\"},{\\\"path\\\":\\\"name\\\",\\\"columnid\\\":\\\"name\\\"}]}}]}\",\"size\":1,\"title\":\"Select a Query to run, or Search in all columns, Category, Name & Query\",\"noDataMessage\":\"no saved queries found in {Workspace:name}\",\"exportedParameters\":[{\"fieldName\":\"query\",\"parameterName\":\"query\",\"parameterType\":1,\"defaultValue\":\" \"},{\"fieldName\":\"displayName\",\"parameterName\":\"name\",\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"Subscription\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Workspace\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"saved query grid - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Saved Query - {name}\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f3f7beb8-b287-45fb-8af2-c528ef55b704\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"queryText\",\"type\":1,\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"kql\"},\"criteriaData\":[{\"condition\":\"else result = '{query}'\",\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"param\",\"resultValType\":\"static\",\"resultVal\":\"{query}\"}}],\"label\":\"Saved Query Text\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query text param\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{query}\",\"size\":2,\"title\":\"Query Results\",\"timeContext\":{\"durationMs\":1209600000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"query - 3\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"query\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Workspace\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"visible if query selected group\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"saved\"},\"name\":\"group - kql\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Workspace and Table Retention: Select a Workspace to check Workspace and Table Retention\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"54ab7c42-3983-46fd-bb6b-9a1d206eec3a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"description\":\"Lookup Workspace and Table Retention\",\"isRequired\":true,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerID, name=tolower(name)\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace)\\r\\n) on name\\r\\n| project tolower(id), customerID, name\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{Workspace:subscription}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}?api-version=2017-04-26-preview\\\",\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"columns\\\":[{\\\"path\\\":\\\"id\\\",\\\"columnid\\\":\\\"Workspace\\\"},{\\\"path\\\":\\\"properties.retentionInDays\\\",\\\"columnid\\\":\\\"RetentionInDays\\\"},{\\\"path\\\":\\\"location\\\",\\\"columnid\\\":\\\"Location\\\"},{\\\"path\\\":\\\"properties.workspaceCapping.dailyQuotaGb\\\",\\\"columnid\\\":\\\"DailyQuotaGb\\\"},{\\\"path\\\":\\\"properties.sku.name\\\",\\\"columnid\\\":\\\"SkuName\\\"}]}}]}\",\"size\":4,\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{Workspace:subscription}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/Tables?api-version=2017-04-26-preview\\\",\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"name\\\",\\\"columnid\\\":\\\"TableName\\\"},{\\\"path\\\":\\\"properties.retentionInDays\\\",\\\"columnid\\\":\\\"RetentionInDays\\\"}]}}]}\",\"size\":3,\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 13\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"retention\"},\"name\":\"group - retention\"}],\"fromTemplateId\":\"sentinel-SentinelCentral\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## View Azure Sentinel Incidents and details from any selected Workspaces \\r\\n\\r\\n\"},\"name\":\"text - 0\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"01868289-27ef-4b5e-ae83-1715cacde421\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"region\",\"label\":\"Region\",\"type\":2,\"description\":\"Filter by Azure Region (location)\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"Resources \\r\\n//| where type =~ \\\"microsoft.operationalinsights/workspaces\\\"\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| summarize WorkspaceCount = count(name) by location\\r\\n| order by location asc\\r\\n| project value=location, display=strcat(location,'(',WorkspaceCount,')')\",\"crossComponentResources\":[\"value::selected\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"1ca69445-60fc-4806-b43d-ac7e6aad630a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources\\r\\n| where '*' in ({region}) or location in ({region})\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| distinct subscriptionId, location\\r\\n| summarize by value = strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId\\r\\n| order by value asc\\r\\n\",\"crossComponentResources\":[\"value::selected\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"e94aafa3-c5d9-4523-89f0-4e87aa754511\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\n| extend customerID = trim(' ', tostring(properties.customerId))\\n| project id, customerID, name=tolower(name)\\n|join \\n(\\n\\tresources\\n\\t// Just show Workspaces that have Sentinel enabled\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\n\\t| where name has \\\"SecurityInsights\\\"\\n\\t| parse name with * '(' s_workspace ')'*\\n\\t| project name=tolower(s_workspace)\\n) on name\\n| project tolower(id), customerID, name\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"resourceTypeFilter\":{\"microsoft.operationalinsights/workspaces\":true},\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"value::all\"]},{\"id\":\"66f59acd-2628-457d-a5cd-176aa453472a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}},{\"id\":\"65e74c73-69f0-4eb5-a772-4fb5eae73d28\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"WorkspaceIDguid\",\"type\":1,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerID = trim(' ', tostring(properties.customerId))\\r\\n| project '{Workspace:name}', name, customerID\\r\\n| where '{Workspace:name}' has name\\r\\n//| project customerID, name\\r\\n// join two columns, seperate with a \\\":\\\"; ARG, will comma seperate each row by default\\r\\n| project strcat(customerID,\\\":\\\",name)\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"2af84437-b015-456b-9660-97c8415e72fd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Product\",\"label\":\"Product Name\",\"type\":2,\"description\":\"Filter on All or a named Product\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend productName_ = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| summarize by productName_\\r\\n\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"5a683c1d-5e10-4d94-bb2a-32c05b17da8e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"resourceGroup\",\"type\":1,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n//| where name ==  \\\"{Workspace:label}\\\" \\r\\n| project resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"306edc18-d122-478d-97aa-ebc5a4cb88db\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Owner\",\"type\":2,\"description\":\"Filter on All or a named Owner assigned to an Incident\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend owner = tostring(Owner.assignedTo) \\r\\n| summarize Count=count(IncidentNumber) by Owner= case(owner==\\\"\\\", \\\"Unassigned\\\",owner)\\r\\n| project Value = Owner, Label = strcat(Owner, \\\": \\\", Count)\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"04338a2a-010c-409d-91ac-4b74a0e9d56c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n { \\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Change Log\\\", \\\"label\\\": \\\"Change Log\\\"}\\r\\n]\",\"timeContextFromParameter\":\"TimeRange\",\"value\":\"Change Log\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 1\"},{\"type\":1,\"content\":{\"json\":\"## Sentinel Central\\r\\n### Change Log\\r\\nUse this report to view Incident and Alert data across many workspaces (works with Azure Lighthouse)\\r\\n\\r\\n\\r\\n|Version|Description|\\r\\n|---|---|\\r\\n|v1.2| View Alerts from multiple workspaces (Azure Lighhouse compatiable)|\\r\\n|v1.3| MSSP release |\\r\\n|v1.4| Add Workspace info |\\r\\n|v1.5| Add Workspace info |\\r\\n|v2.0| Multi workspace hunting. per Region selection from main drop down. |\\r\\n|v2.1| Addition of Workspace and Table specific retention. |\\r\\n\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Change Log\"},\"name\":\"text - 7\"},{\"type\":1,\"content\":{\"json\":\"## Sentinel Central Help\\r\\n#### Data sources: REST api, SentinelIncident and SecurityAlert Tables\\r\\n\\r\\n## Incident Overview: \\r\\nUse this report to view Incident (and Alert data) across many workspaces, this works with Azure Lighthouse and across any subscription you have access to. The Workbook is not intended to replace the Multiple Incidents across Workspace view/feature in the Azure Sentinel UI, it's just a way of seeing the data in a different way.\\r\\n- Workspaces not linked to Azure Sentinel will not be shown.\\r\\n\\r\\n## Hunting\\r\\nThis option allows you to use your own KQL (which you can write within the page, or copy from an example or existing query). This will run against *any* of the Workspaces you have selected in the parameters (local or via Azure Lighthouse), please remember the more Workspaces and time range selected, the slower the results.\\r\\n- Use case, this allows you to enter a simple KQL query that doesnt need the prefix of\\tworkspace(\\\"my workspace name\\\").my table name \\r\\n\\r\\ne.g. workspace(Demo\\\").Usage | limit 10\\r\\n\\r\\nor \\r\\n\\r\\n//Example query \\r\\nSecurityIncident\\r\\n| summarize High = countif(Severity ==\\\"High\\\"), Medium = countif(Severity ==\\\"Medium\\\"), MyIncidents=make_set(IncidentNumber ) by WorkspaceId=TenantId\\r\\n\\r\\n##### Note:\\r\\nIn your query it maybe useful to have the workspace ID returned, to do this you get the data from the TenantID column, as this name can be confusing we suggest you re-map it to WorkspaceID.\\r\\ne.g.\\r\\n\\tSecurityIncident | summarize count() by WorkspaceId=TenantId\\r\\n\\r\\n## Query Packs\\r\\nIf you are using Query Packs, use this Tab to open one (from any Resource Group), you can then click on a Query Pack and then on an individual query to run it. \\r\\n\\r\\n- Use case, storing queries this way enables you to share them and secure them (ARM and RBAC), this methods allows you to stay within the workbook to find and execute your queries.\\r\\n## Saved Searches\\r\\nAny Saved Searches from a selected Workspace can be run from this tab. \\r\\n\\r\\n- Use Case, you can see (if you have read rights) saved searches in a selected Workspace and click to run them. Much like the Query Pack method above.\\r\\n\\r\\n## Retention\\r\\nWorkspace and Table specific retention can be viewed in this tab.\\r\\n\\r\\n- Use Case, you can see (if you have read rights) the same or different level retention set on a table in a selected Workspace.\\r\\n\\r\\n\\r\\n\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 7 - Copy\"}],\"exportParameters\":true},\"name\":\"group - parameter and help\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"ad9f9173-35b3-4c1a-84e4-6f6062263c18\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Incident Overview\",\"subTarget\":\"incidents\",\"style\":\"link\"},{\"id\":\"f99135dc-8862-434b-ad1c-38714c1d8992\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Hunting\",\"subTarget\":\"hunting\",\"style\":\"link\"},{\"id\":\"f99e8417-fdad-434d-98a3-9b901c273650\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Query Pack\",\"subTarget\":\"querypack\",\"style\":\"link\"},{\"id\":\"a56b10fb-0e65-4308-9c9e-e6c56ef356c6\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Saved Searches\",\"subTarget\":\"saved\",\"style\":\"link\"},{\"id\":\"16449876-2e6f-4c55-9931-30b5d82baead\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Retention\",\"subTarget\":\"retention\",\"style\":\"link\"}]},\"name\":\"links - 7\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| summarize count(IncidentName) by   [\\\"Workspace\\\"] = workSpacename\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":4,\"title\":\"Count of Security Incidents for selected {$rowCount} Workspaces\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"wsName\"]},\"sortBy\":[{\"itemKey\":\"wsName\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"wsName\",\"sortOrder\":2}]},\"name\":\"query - 3 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| summarize High=  countif(Severity==\\\"High\\\"),\\r\\n            Medium=countif(Severity==\\\"Medium\\\"),\\r\\n            Low   =countif(Severity==\\\"Low\\\"), \\r\\n            Informational=countif(Severity==\\\"Informational\\\"),\\r\\n            Last_record =  datetime_diff(\\\"second\\\", now(), max(TimeGenerated)),\\r\\n            Total  = count()\\r\\n            by workSpacename\\r\\n| join\\r\\n(\\r\\nSecurityIncident\\r\\n// mean time to triage Section\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n//| where FirstModifiedTime  >= {TimeRange:start} and FirstModifiedTime  <= {TimeRange:end}\\r\\n| extend Owner = todynamic(Owner.assignedTo) \\r\\n| where Owner in ({Owner}) or '{Owner:label}' ==  \\\"All\\\"\\r\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\r\\n| where Product in ({Product}) or '{Product:label}' ==  \\\"All\\\"\\r\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\r\\n| extend TimeToTriage =  (FirstModifiedTime - CreatedTime)/1h\\r\\n| summarize 50th_PercentileMeanTime=percentile(TimeToTriage, 50) by workSpacename\\r\\n) on workSpacename\\r\\n|project-away workSpacename1\\r\\n| join\\r\\n(\\r\\nSecurityIncident\\r\\n// mean time to close Section\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| extend iD = TenantId\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n//| where ClosedTime >= {TimeRange:start} and ClosedTime <= {TimeRange:end}\\r\\n| extend Owner = todynamic(Owner.assignedTo) \\r\\n| where Owner in ({Owner}) or '{Owner:label}' ==  \\\"All\\\"\\r\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\r\\n| where Product in ({Product}) or '{Product:label}' ==  \\\"All\\\"\\r\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\r\\n| extend TimeToClosure =  (ClosedTime - CreatedTime)/1h\\r\\n| summarize 50th_PercentileCloseTime=percentile(TimeToClosure, 50) by workSpacename\\r\\n) on workSpacename\\r\\n|project-away workSpacename1\\r\\n| join\\r\\n(\\r\\nSecurityIncident\\r\\n    // Incident Trend by Workspace\\r\\n    // Get the Workspace Name(s) from a parameter\\r\\n    | extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n    | mv-expand stringtoSplit\\r\\n    | where stringtoSplit has TenantId\\r\\n    | extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n    | make-series IncidentTrend=count() on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by workSpacename\\r\\n) on workSpacename\\r\\n|project-away workSpacename1, TimeGenerated\\r\\n\\r\\n\",\"size\":1,\"title\":\"Security Incident summary for {$rowCount} Workspaces:  QueryTime {$queryTime}\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"workSpacename\",\"exportParameterName\":\"exportworkSpacename\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"High\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Medium\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Low\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Informational\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"Last_record\",\"formatter\":0,\"numberFormat\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}},{\"columnMatch\":\"Total\",\"formatter\":8,\"formatOptions\":{\"palette\":\"coldHot\"}},{\"columnMatch\":\"50th_PercentileMeanTime\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},{\"columnMatch\":\"50th_PercentileCloseTime\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":3}}},{\"columnMatch\":\"Trend\",\"formatter\":10,\"formatOptions\":{\"palette\":\"blueDark\"}},{\"columnMatch\":\"iD\",\"formatter\":5}],\"sortBy\":[{\"itemKey\":\"$gen_bar_High_1\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"workSpacename\",\"label\":\"Workspace Name\"},{\"columnId\":\"50th_PercentileMeanTime\",\"label\":\"Mean time to triage\"},{\"columnId\":\"50th_PercentileCloseTime\",\"label\":\"Mean time to closure\"}]},\"sortBy\":[{\"itemKey\":\"$gen_bar_High_1\",\"sortOrder\":2}]},\"name\":\"query - SecIncidents\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n | where type == \\\"microsoft.insights/workbooks\\\"\\r\\n | where properties.displayName has \\\"Security operations efficiency\\\" \\r\\n //| where properties.displayName has '{exportworkSpacename}'\\r\\n //| project properties.displayName, id\\r\\n | project id, note='Please select the Subscription and Workpsace names again in the new blade'\\r\\n | limit 1\\r\\n\\r\\n\",\"size\":4,\"title\":\"Open [Security Operations Efficiency] Workbook - if the Workbook exists locally?\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Click to Open [Security operations efficiency] workbook\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}],\"labelSettings\":[{\"columnId\":\"id\",\"label\":\"Open\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - open_SOC_workbook\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerWorkspaceID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerWorkspaceID, name=tolower(name), subscriptionId, tenantId\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace), subscriptionId, location, properties, resourceGroup\\r\\n) on name\\r\\n| where name =~ '{exportworkSpacename}'\\r\\n| project name, Open=tolower(id), tenantId, customerWorkspaceID,  subscriptionId, location, properties, resourceGroup\\r\\n\",\"size\":4,\"title\":\"Workspace details - click on \\\"name\\\" for more details\",\"exportedParameters\":[{\"fieldName\":\"tenantId\",\"parameterName\":\"exporttenantId\",\"parameterType\":1},{\"fieldName\":\"subscriptionId\",\"parameterName\":\"exportSubscriptionId\",\"parameterType\":1},{\"fieldName\":\"resourceGroup\",\"parameterName\":\"exportResourceGroup\",\"parameterType\":1},{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Click to Open [Security operations efficiency] workbook\",\"linkIsContextBlade\":false}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - Workspace Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/tenants?api-version=2020-01-01\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"\\\",\\\"value\\\":\\\"\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\"}}]}\",\"size\":4,\"title\":\"Tenant details\",\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"domains\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"Domain name(s)\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - Tenant Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{exportSubscriptionId}/resourceGroups/{exportResourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{exportworkSpacename}/providers/Microsoft.SecurityInsights/AlertRules\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"\\\",\\\"value\\\":\\\"\\\"},{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2020-01-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"properties.displayName\\\",\\\"columnid\\\":\\\"displayName\\\"},{\\\"path\\\":\\\"type\\\",\\\"columnid\\\":\\\"type\\\"},{\\\"path\\\":\\\"kind\\\",\\\"columnid\\\":\\\"kind\\\"},{\\\"path\\\":\\\"properties\\\",\\\"columnid\\\":\\\"properties\\\"},{\\\"path\\\":\\\"properties.lastModifiedUtc\\\",\\\"columnid\\\":\\\"lastModifiedUtc\\\"}]}}]}\",\"size\":4,\"title\":\"Rules details ('{exportName}' with {$rowCount} deployed Rules)\",\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"name\",\"formatter\":5},{\"columnMatch\":\"etag\",\"formatter\":5},{\"columnMatch\":\"domains\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"Domain name(s)\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}],\"rowLimit\":500,\"filter\":true,\"sortBy\":[{\"itemKey\":\"kind\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"kind\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportResourceGroup\",\"comparison\":\"isNotEqualTo\",\"value\":\"\"},\"name\":\"query - Rules details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"query - Workspace Details\\\",\\\"rightTable\\\":\\\"query - Tenant Details\\\",\\\"leftColumn\\\":\\\"tenantId\\\",\\\"rightColumn\\\":\\\"tenantId\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[query - Workspace Details].name\\\",\\\"mergedName\\\":\\\"name\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].Open\\\",\\\"mergedName\\\":\\\"Open\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].tenantId\\\",\\\"mergedName\\\":\\\"tenantId\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].customerWorkspaceID\\\",\\\"mergedName\\\":\\\"customerWorkspaceID\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].subscriptionId\\\",\\\"mergedName\\\":\\\"subscriptionId\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].location\\\",\\\"mergedName\\\":\\\"location\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].properties\\\",\\\"mergedName\\\":\\\"properties\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].id\\\",\\\"mergedName\\\":\\\"id\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantId\\\",\\\"mergedName\\\":\\\"tenantId1\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].countryCode\\\",\\\"mergedName\\\":\\\"countryCode\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].displayName\\\",\\\"mergedName\\\":\\\"displayName\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].domains\\\",\\\"mergedName\\\":\\\"domains\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantCategory\\\",\\\"mergedName\\\":\\\"tenantCategory\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].defaultDomain\\\",\\\"mergedName\\\":\\\"defaultDomain\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantType\\\",\\\"mergedName\\\":\\\"tenantType\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantBrandingLogoUrl\\\",\\\"mergedName\\\":\\\"tenantBrandingLogoUrl\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].resourceGroup\\\",\\\"mergedName\\\":\\\"resourceGroup\\\",\\\"fromId\\\":\\\"unknown\\\"}]}\",\"size\":4,\"title\":\"Tenant Details\",\"showExportToExcel\":true,\"queryType\":7,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"tenantId1\",\"formatter\":5},{\"columnMatch\":\"domains\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"Domain List\",\"linkIsContextBlade\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isNotEqualTo\"},\"showPin\":false,\"name\":\"query - merged Tenant view\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Classification and Tactics report\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| where Status == 'Closed'\\r\\n| order by LastModifiedTime \\r\\n| summarize count(), make_set(ClassificationComment) by workSpacename, Classification , ClassificationReason \\r\\n| evaluate pivot(Classification, sum(count_))\",\"size\":1,\"title\":\"Incident Classification report\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"set_ClassificationComment\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"BenignPositive\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"FalsePositive\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"TruePositive\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"Undetermined\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"set_ClassificationComment\",\"label\":\"Reason\"}]},\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":2}]},\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| extend Tactics_ = tostring(parse_json(tostring(AdditionalData.tactics)))\\r\\n| summarize  count()\\r\\n            by workSpacename, Tactics_\\r\\n| order by count_ desc\\r\\n| evaluate pivot(Tactics_, sum(count_))\",\"size\":1,\"title\":\"Incident Tactics report\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"set_ClassificationComment\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"TruePositive\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":1}],\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"workSpacename\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"[\\\"Collection\\\"]\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 10 - Tactics\"}]},\"name\":\"group - classification and tactics\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mvexpand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| summarize Total  = count()\\r\\n            by workSpacename\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":1,\"title\":\"Count of Security Incidents for selected Workspaces and Severity\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"High\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Medium\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Low\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Informational\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"labelSettings\":[{\"columnId\":\"workSpacename\",\"label\":\"Workspace Name\"}]}},\"customWidth\":\"40\",\"conditionalVisibility\":{\"parameterName\":\"hide\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - KQL for MAP count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n// Just show Workspaces that have Sentinel enabled\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| parse name with * '(' s_workspace ')'*\\r\\n| summarize count() by location, s_workspace\",\"size\":0,\"title\":\"Azure Sentinel Workspaces by Azure Region\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"mapSettings\":{\"locInfo\":\"AzureLoc\",\"locInfoColumn\":\"location\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"location\",\"legendMetric\":\"location\",\"legendAggregation\":\"Count\",\"itemColorSettings\":{\"nodeColorField\":\"count_\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"hide\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - ARG for MAp count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"query - KQL for MAP count\\\",\\\"rightTable\\\":\\\"query - ARG for MAp count\\\",\\\"leftColumn\\\":\\\"workSpacename\\\",\\\"rightColumn\\\":\\\"s_workspace\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[query - KQL for MAP count].workSpacename\\\",\\\"mergedName\\\":\\\"Workspace Name\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - KQL for MAP count].Total\\\",\\\"mergedName\\\":\\\"Total\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - ARG for MAp count].location\\\",\\\"mergedName\\\":\\\"location\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - ARG for MAp count].s_workspace\\\",\\\"mergedName\\\":\\\"s_workspace\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - ARG for MAp count].count_\\\",\\\"mergedName\\\":\\\"count_\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"}]}\",\"size\":0,\"title\":\"Azure Sentinel Incident Count by Region\",\"exportedParameters\":[{\"fieldName\":\"\",\"parameterName\":\"exportMap1\"},{\"fieldName\":\"location\",\"parameterName\":\"location\",\"parameterType\":1}],\"queryType\":7,\"visualization\":\"map\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"s_workspace\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"s_workspace\",\"sortOrder\":1}],\"mapSettings\":{\"locInfo\":\"AzureLoc\",\"locInfoColumn\":\"location\",\"sizeSettings\":\"Total\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"location\",\"legendMetric\":\"Total\",\"numberOfMetrics\":50,\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"Total\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n// Just show Workspaces that have Sentinel enabled\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| parse name with * '(' s_workspace ')'*\\r\\n| summarize count() by location, s_workspace\",\"size\":0,\"title\":\"Azure Sentinel Workspaces by Azure Region\",\"exportParameterName\":\"exportMap2\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"map\",\"mapSettings\":{\"locInfo\":\"AzureLoc\",\"locInfoColumn\":\"location\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"location\",\"legendMetric\":\"location\",\"legendAggregation\":\"Count\",\"itemColorSettings\":{\"nodeColorField\":\"count_\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"name\":\"query - 10\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"5443aca4-a73d-46ad-aaea-bd391acc3f0d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata1\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap1}')\\r\\n| project  ['region']=a.regionName,  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata2\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap2}')\\r\\n| project  ['region']=a.regionName,  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"793ac0c4-7518-4e52-9509-eb1bdf97854b\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata1_count\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap1}')\\r\\n| project  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"d4349432-c9cf-436e-9ede-2cd303c4bc9c\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata2_count\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap2}')\\r\\n| project  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"88076350-2736-407f-a272-6b473dc92c6c\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 8\"},{\"type\":1,\"content\":{\"json\":\"### Results from clicking on the Maps above\\r\\n--------------\\r\\n\\r\\n|Azure Region|Location|Incident Count|Workspace Counter|\\r\\n|---|---|---|\\r\\n|Azure Sentinel Incident Count by Region| {getMapdata1}|{getMapdata1_count}||\\r\\n|Azure Sentinel Workspaces by Azure Region| {getMapdata2}||{getMapdata2_count}|\\r\\n\\r\\n-----------\"},\"name\":\"text - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mvexpand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| extend Tactics_ = tostring(parse_json(tostring(AdditionalData.tactics)))\\r\\n| summarize  count()\\r\\n            by workSpacename, Tactics_\\r\\n| order by count_ desc\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":1,\"title\":\"Count of Tactics for selected Workspaces\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":3,\"formatOptions\":{\"palette\":\"coldHot\"}},{\"columnMatch\":\"High\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Medium\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Low\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Informational\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Total\",\"formatter\":8,\"formatOptions\":{\"palette\":\"coldHot\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"count\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"hide\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - 3 - Copy - Copy - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"incidents\"},\"name\":\"group - overview\"},{\"type\":1,\"content\":{\"json\":\"---------------\"},\"name\":\"text - 9\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Expand to Show: Incident details\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| where TimeGenerated > startofday(ago(0d))\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| extend productName_ = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| where productName_ in ({Product}) or '{Product:label}' ==\\\"All\\\"\\r\\n| summarize count() by IncidentNumber, Title, productName_, Severity, [\\\"Workspace\\\"] = workSpacename, IncidentUrl\\r\\n| order by Workspace asc , IncidentNumber desc\\r\\n//| top 50 by [\\\"Workspace\\\"]\",\"size\":1,\"title\":\"{$rowCount} Incidents in Workspaces today\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"exportedParameters\":[{\"fieldName\":\"IncidentNumber\",\"parameterName\":\"IncidentNumber\",\"parameterType\":1},{\"fieldName\":\"Workspace\",\"parameterName\":\"Workspace_export\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"productName_\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"greenDark\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Workspace\",\"formatter\":5},{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Open Azure Sentinel Incident\"}}],\"rowLimit\":5000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Workspace\"]},\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"productName_\",\"label\":\"Product Name\"}]},\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}]},\"name\":\"query - multi Alerts\"},{\"type\":1,\"content\":{\"json\":\"For further analysis I suggest you open the Azure Sentinel Incident Blade and _Investigate_ (use the hyper link provided in the table, if you have the correct RBAC).\\r\\n\\r\\nAlternatively open the [_Investigation Insights_] or [_Incident Overview_] Workbooks for guided and deeper investigation.  Open Incident Overview from the Portal, _Investigation Insights_ can be opened to the right --->.\\r\\n\\r\\n- You must have previoulsy SAVED these Workbooks in your workspace(s).  \\r\\n- Investigation Insights requires release v1.2 or above (you may have to manually select the Workspace), for prior versions you will have to select the matching Incident Number as well. \\r\\n- For the Workbooks to be listed, they need \\\"Investigation\\\" in the name when you save them.\"},\"customWidth\":\"50\",\"name\":\"text - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n | where type == \\\"microsoft.insights/workbooks\\\"\\r\\n | where properties.displayName has \\\"Investigation\\\" // or properties.displayName has \\\"Incident\\\"\\r\\n | where properties.displayName has '{Workspace_export}'\\r\\n | project properties.displayName, id,  {IncidentNumber}\\r\\n\",\"size\":4,\"title\":\"Workspace Name: {Workspace_export}\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"properties_displayName\",\"formatter\":1},{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Open Workbook\",\"linkIsContextBlade\":true}}],\"labelSettings\":[{\"columnId\":\"properties_displayName\",\"label\":\"Workbook Name\"},{\"columnId\":\"id\",\"label\":\"Open\"},{\"columnId\":\"Column1\",\"label\":\"Incident Number\"}]}},\"customWidth\":\"50\",\"name\":\"query - 11\"},{\"type\":1,\"content\":{\"json\":\"### Select a single workspace to see Incident level details \"},\"name\":\"text - 6\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"4383a3f4-7606-41a7-b1cf-e5bffd2d9ecb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"iWorkspace\",\"label\":\"Incident Workspace\",\"type\":7,\"query\":\"resources\\r\\n// Just show Workspaces that have Sentinel enabled\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| parse name with * '(' s_workspace ')'*\\r\\n| project name = s_workspace\\r\\n| sort by name asc\",\"crossComponentResources\":[\"{Subscription}\"],\"value\":\"\",\"typeSettings\":{\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"c2494755-05cc-4b93-b253-e8a0d4b7c899\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"iResourceGroup\",\"type\":1,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| where tolower(name) == \\\"{iWorkspace}\\\"\\r\\n| project resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of workspace validation, now match workspace to the selected parameter\\r\\n| where tolower(workSpacename) == tolower('{iWorkspace}')\\r\\n| summarize arg_max(TimeGenerated,*) by tostring(IncidentNumber)\\r\\n| extend Alerts = extract(\\\"\\\\\\\\[(.*?)\\\\\\\\]\\\", 1, tostring(AlertIds))\\r\\n| extend productName_ = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| where productName_ in ({Product}) or '{Product:label}' ==\\\"All\\\"\\r\\n| mv-expand AlertIds to typeof(string)\\r\\n| join \\r\\n(\\r\\n    SecurityAlert\\r\\n    | extend AlertEntities = parse_json(Entities)\\r\\n    | mv-expand AlertEntities\\r\\n) on $left.AlertIds == $right.SystemAlertId\\r\\n| summarize AlertCount=dcount(AlertIds), entityList=make_set(tostring(AlertEntities.Type)) by IncidentNumber, Status, Severity, Title,  Alerts, IncidentUrl, Owner=tostring(Owner.userPrincipalName) , Tactics =tostring(AdditionalData.tactics), workSpacename, productName_\\r\\n// set column order\\r\\n| project workSpacename, IncidentNumber, Severity, Status, AlertCount,Owner, Title, entityList, Tactics, IncidentUrl, productName_\\r\\n| order by IncidentNumber desc\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":0,\"title\":\"Details for {iWorkspace} Workspace, count of: {$rowCount} Incidents during {TimeRange:label}\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"workSpacename\",\"formatter\":5},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"greenDark\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"New\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AlertCount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"IncidentUrl\",\"formatter\":1,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Open Incident in Azure Sentinel \"}}],\"rowLimit\":500,\"filter\":true,\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"iWorkspace\",\"comparison\":\"isNotEqualTo\",\"value\":\"\"},\"name\":\"query - single alert\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"incidents\"},\"name\":\"group - Incidents\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Hunting: Hunt across selected workspaces, using any KQL you paste or edit in this field. \",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"fcc2456c-f4b5-4505-a188-aa4ebab3db67\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"queryTxt\",\"type\":1,\"description\":\"Add  workspace identity e.g SecurityIncident | summarize count() by WorkspaceId=TenantId\",\"value\":\"Perf \\r\\n| summarize count()  by WorkspaceId=TenantId\",\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"kql\"},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{queryTxt}\",\"size\":0,\"title\":\"Cross workspace Query results, rows: {$rowCount}, QueryTime: {$queryTime}.  Select a row for more details\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"WorkspaceId\",\"exportParameterName\":\"exportWorkspaceId\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Workspace\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}}]}},\"name\":\"query - crossWorkspaceQuery\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerWorkspaceID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerWorkspaceID, name=tolower(name), subscriptionId, tenantId\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace), subscriptionId, location, properties, resourceGroup\\r\\n) on name\\r\\n| where customerWorkspaceID in ('{exportWorkspaceId}')\\r\\n| project name, Open=tolower(id), tenantId, customerWorkspaceID,  subscriptionId, location, properties, resourceGroup\\r\\n\",\"size\":4,\"title\":\"{exportWorkspaceId} lookup  - used to identify tenant or workspace Ids from the results above\",\"exportedParameters\":[{\"fieldName\":\"tenantId\",\"parameterName\":\"exporttenantId\",\"parameterType\":1},{\"fieldName\":\"subscriptionId\",\"parameterName\":\"exportSubscriptionId\",\"parameterType\":1},{\"fieldName\":\"resourceGroup\",\"parameterName\":\"exportResourceGroup\",\"parameterType\":1},{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Click to Open [Security operations efficiency] workbook\",\"linkIsContextBlade\":false}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"tenantId\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"tenantId\",\"sortOrder\":1}]},\"conditionalVisibility\":{\"parameterName\":\"exportWorkspaceId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - Workspace Details\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"hunting\"},\"name\":\"group - hunting\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Query Pack: Use a Query Pack from any Resource Group, then pick a query to run from within the Query Pack\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"9a0c8c17-ac07-4b9a-b3d9-44060087935f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"description\":\"Find Query packs in specific subscriptions \",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"includeAll\":false,\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.operationalinsights/querypacks\\\"\\r\\n| project-away type, kind\",\"size\":0,\"exportedParameters\":[{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1},{\"fieldName\":\"resourceGroup\",\"parameterName\":\"resourceGroup\",\"parameterType\":1},{\"fieldName\":\"subscriptionId\",\"parameterName\":\"subscriptionId\",\"parameterType\":1}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"tenantId\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"location\",\"formatter\":17},{\"columnMatch\":\"resourceGroup\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"subscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":\"\",\"showIcon\":true}}]}},\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/microsoft.operationalInsights/querypacks/{exportName}/Queries\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2019-09-01-preview\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"properties.displayName\\\",\\\"columnid\\\":\\\"name\\\"},{\\\"path\\\":\\\"properties.body\\\",\\\"columnid\\\":\\\"body\\\"},{\\\"path\\\":\\\"properties.description\\\",\\\"columnid\\\":\\\"description\\\"},{\\\"path\\\":\\\"properties.tags\\\",\\\"columnid\\\":\\\"tags\\\"},{\\\"path\\\":\\\"systemData.lastModifiedAt\\\",\\\"columnid\\\":\\\"lastModifiedAt\\\"},{\\\"path\\\":\\\"systemData.lastModifiedBy\\\",\\\"columnid\\\":\\\"lastModifiedBy\\\"},{\\\"path\\\":\\\"systemData.createdBy\\\",\\\"columnid\\\":\\\"createdBy\\\"},{\\\"path\\\":\\\"systemData.createdBy\\\",\\\"columnid\\\":\\\"createdByType\\\"},{\\\"path\\\":\\\"systemData.createdAt\\\",\\\"columnid\\\":\\\"createdAt\\\"}]}}]}\",\"size\":1,\"title\":\"Select a Query to run from the list: {$rowCount} Queries in Query Pack: {exportName}\",\"exportedParameters\":[{\"fieldName\":\"body\",\"parameterName\":\"exportQuery\"},{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"body\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"createdByType\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"body\",\"label\":\"Query\"}]},\"sortBy\":[{\"itemKey\":\"createdByType\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"exportName\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query -Qp queries\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{exportQuery}\",\"size\":0,\"title\":\"Results of the selected Query: {exportName}\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"conditionalVisibility\":{\"parameterName\":\"exportQuery\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 3\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"querypack\"},\"name\":\"group - qp\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"KQL Saved Searches: Select a Workspace to check Saved Searches\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"54ab7c42-3983-46fd-bb6b-9a1d206eec3a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"description\":\"Lookup saved queries in any Azure Sentinel workspace\",\"isRequired\":true,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerID, name=tolower(name)\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace)\\r\\n) on name\\r\\n| project tolower(id), customerID, name\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"{Workspace}/SavedSearches\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2021-06-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"properties.displayName\\\",\\\"columnid\\\":\\\"displayName\\\"},{\\\"path\\\":\\\"properties.category\\\",\\\"columnid\\\":\\\"category\\\"},{\\\"path\\\":\\\"properties.query\\\",\\\"columnid\\\":\\\"query\\\"},{\\\"path\\\":\\\"properties.version\\\",\\\"columnid\\\":\\\"version\\\"},{\\\"path\\\":\\\"name\\\",\\\"columnid\\\":\\\"name\\\"}]}}]}\",\"size\":1,\"title\":\"Select a Query to run, or Search in all columns, Category, Name & Query\",\"noDataMessage\":\"no saved queries found in {Workspace:name}\",\"exportedParameters\":[{\"fieldName\":\"query\",\"parameterName\":\"query\",\"parameterType\":1,\"defaultValue\":\" \"},{\"fieldName\":\"displayName\",\"parameterName\":\"name\",\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"Subscription\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Workspace\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"saved query grid - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Saved Query - {name}\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f3f7beb8-b287-45fb-8af2-c528ef55b704\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"queryText\",\"type\":1,\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"kql\"},\"criteriaData\":[{\"condition\":\"else result = '{query}'\",\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"param\",\"resultValType\":\"static\",\"resultVal\":\"{query}\"}}],\"label\":\"Saved Query Text\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query text param\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{query}\",\"size\":2,\"title\":\"Query Results\",\"timeContext\":{\"durationMs\":1209600000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"query - 3\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"query\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Workspace\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"visible if query selected group\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"saved\"},\"name\":\"group - kql\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Workspace and Table Retention: Select a Workspace to check Workspace and Table Retention\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"54ab7c42-3983-46fd-bb6b-9a1d206eec3a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"description\":\"Lookup Workspace and Table Retention\",\"isRequired\":true,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerID, name=tolower(name)\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace)\\r\\n) on name\\r\\n| project tolower(id), customerID, name\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{Workspace:subscription}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}?api-version=2017-04-26-preview\\\",\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"columns\\\":[{\\\"path\\\":\\\"id\\\",\\\"columnid\\\":\\\"Workspace\\\"},{\\\"path\\\":\\\"properties.retentionInDays\\\",\\\"columnid\\\":\\\"RetentionInDays\\\"},{\\\"path\\\":\\\"location\\\",\\\"columnid\\\":\\\"Location\\\"},{\\\"path\\\":\\\"properties.workspaceCapping.dailyQuotaGb\\\",\\\"columnid\\\":\\\"DailyQuotaGb\\\"},{\\\"path\\\":\\\"properties.sku.name\\\",\\\"columnid\\\":\\\"SkuName\\\"}]}}]}\",\"size\":4,\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{Workspace:subscription}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/Tables?api-version=2017-04-26-preview\\\",\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"name\\\",\\\"columnid\\\":\\\"TableName\\\"},{\\\"path\\\":\\\"properties.retentionInDays\\\",\\\"columnid\\\":\\\"RetentionInDays\\\"}]}}]}\",\"size\":3,\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 13\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"retention\"},\"name\":\"group - retention\"}],\"fromTemplateId\":\"sentinel-SentinelCentral\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## View Azure Sentinel Incidents and details from any selected Workspaces \\r\\n\\r\\n\"},\"name\":\"text - 0\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"01868289-27ef-4b5e-ae83-1715cacde421\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"region\",\"label\":\"Region\",\"type\":2,\"description\":\"Filter by Azure Region (location)\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"Resources \\r\\n//| where type =~ \\\"microsoft.operationalinsights/workspaces\\\"\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| summarize WorkspaceCount = count(name) by location\\r\\n| order by location asc\\r\\n| project value=location, display=strcat(location,'(',WorkspaceCount,')')\",\"crossComponentResources\":[\"value::selected\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"1ca69445-60fc-4806-b43d-ac7e6aad630a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources\\r\\n| where '*' in ({region}) or location in ({region})\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| distinct subscriptionId, location\\r\\n| summarize by value = strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId\\r\\n| order by value asc\\r\\n\",\"crossComponentResources\":[\"value::selected\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"e94aafa3-c5d9-4523-89f0-4e87aa754511\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\n| extend customerID = trim(' ', tostring(properties.customerId))\\n| project id, customerID, name=tolower(name)\\n|join \\n(\\n\\tresources\\n\\t// Just show Workspaces that have Sentinel enabled\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\n\\t| where name has \\\"SecurityInsights\\\"\\n\\t| parse name with * '(' s_workspace ')'*\\n\\t| project name=tolower(s_workspace)\\n) on name\\n| project tolower(id), customerID, name\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"resourceTypeFilter\":{\"microsoft.operationalinsights/workspaces\":true},\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"value::all\"]},{\"id\":\"66f59acd-2628-457d-a5cd-176aa453472a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}},{\"id\":\"65e74c73-69f0-4eb5-a772-4fb5eae73d28\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"WorkspaceIDguid\",\"type\":1,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerID = trim(' ', tostring(properties.customerId))\\r\\n| project '{Workspace:name}', name, customerID\\r\\n| where '{Workspace:name}' has name\\r\\n//| project customerID, name\\r\\n// join two columns, seperate with a \\\":\\\"; ARG, will comma seperate each row by default\\r\\n| project strcat(customerID,\\\":\\\",name)\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"2af84437-b015-456b-9660-97c8415e72fd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Product\",\"label\":\"Product Name\",\"type\":2,\"description\":\"Filter on All or a named Product\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend productName_ = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| summarize by productName_\\r\\n\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"5a683c1d-5e10-4d94-bb2a-32c05b17da8e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"resourceGroup\",\"type\":1,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n//| where name ==  \\\"{Workspace:label}\\\" \\r\\n| project resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"306edc18-d122-478d-97aa-ebc5a4cb88db\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Owner\",\"type\":2,\"description\":\"Filter on All or a named Owner assigned to an Incident\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"SecurityIncident\\r\\n| extend owner = tostring(Owner.assignedTo) \\r\\n| summarize Count=count(IncidentNumber) by Owner= case(owner==\\\"\\\", \\\"Unassigned\\\",owner)\\r\\n| project Value = Owner, Label = strcat(Owner, \\\": \\\", Count)\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"04338a2a-010c-409d-91ac-4b74a0e9d56c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n { \\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Change Log\\\", \\\"label\\\": \\\"Change Log\\\"}\\r\\n]\",\"timeContextFromParameter\":\"TimeRange\",\"value\":\"Change Log\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 1\"},{\"type\":1,\"content\":{\"json\":\"## Sentinel Central\\r\\n### Change Log\\r\\nUse this report to view Incident and Alert data across many workspaces (works with Azure Lighthouse)\\r\\n\\r\\n\\r\\n|Version|Description|\\r\\n|---|---|\\r\\n|v1.2| View Alerts from multiple workspaces (Azure Lighhouse compatiable)|\\r\\n|v1.3| MSSP release |\\r\\n|v1.4| Add Workspace info |\\r\\n|v1.5| Add Workspace info |\\r\\n|v2.0| Multi workspace hunting. per Region selection from main drop down. |\\r\\n|v2.1| Addition of Workspace and Table specific retention. |\\r\\n\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Change Log\"},\"name\":\"text - 7\"},{\"type\":1,\"content\":{\"json\":\"## Sentinel Central Help\\r\\n#### Data sources: REST api, SentinelIncident and SecurityAlert Tables\\r\\n\\r\\n## Incident Overview: \\r\\nUse this report to view Incident (and Alert data) across many workspaces, this works with Azure Lighthouse and across any subscription you have access to. The Workbook is not intended to replace the Multiple Incidents across Workspace view/feature in the Azure Sentinel UI, it's just a way of seeing the data in a different way.\\r\\n- Workspaces not linked to Azure Sentinel will not be shown.\\r\\n\\r\\n## Hunting\\r\\nThis option allows you to use your own KQL (which you can write within the page, or copy from an example or existing query). This will run against *any* of the Workspaces you have selected in the parameters (local or via Azure Lighthouse), please remember the more Workspaces and time range selected, the slower the results.\\r\\n- Use case, this allows you to enter a simple KQL query that doesnt need the prefix of\\tworkspace(\\\"my workspace name\\\").my table name \\r\\n\\r\\ne.g. workspace(Demo\\\").Usage | limit 10\\r\\n\\r\\nor \\r\\n\\r\\n//Example query \\r\\nSecurityIncident\\r\\n| summarize High = countif(Severity ==\\\"High\\\"), Medium = countif(Severity ==\\\"Medium\\\"), MyIncidents=make_set(IncidentNumber ) by WorkspaceId=TenantId\\r\\n\\r\\n##### Note:\\r\\nIn your query it maybe useful to have the workspace ID returned, to do this you get the data from the TenantID column, as this name can be confusing we suggest you re-map it to WorkspaceID.\\r\\ne.g.\\r\\n\\tSecurityIncident | summarize count() by WorkspaceId=TenantId\\r\\n\\r\\n## Query Packs\\r\\nIf you are using Query Packs, use this Tab to open one (from any Resource Group), you can then click on a Query Pack and then on an individual query to run it. \\r\\n\\r\\n- Use case, storing queries this way enables you to share them and secure them (ARM and RBAC), this methods allows you to stay within the workbook to find and execute your queries.\\r\\n## Saved Searches\\r\\nAny Saved Searches from a selected Workspace can be run from this tab. \\r\\n\\r\\n- Use Case, you can see (if you have read rights) saved searches in a selected Workspace and click to run them. Much like the Query Pack method above.\\r\\n\\r\\n## Retention\\r\\nWorkspace and Table specific retention can be viewed in this tab.\\r\\n\\r\\n- Use Case, you can see (if you have read rights) the same or different level retention set on a table in a selected Workspace.\\r\\n\\r\\n\\r\\n\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 7 - Copy\"}],\"exportParameters\":true},\"name\":\"group - parameter and help\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"ad9f9173-35b3-4c1a-84e4-6f6062263c18\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Incident Overview\",\"subTarget\":\"incidents\",\"style\":\"link\"},{\"id\":\"f99135dc-8862-434b-ad1c-38714c1d8992\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Hunting\",\"subTarget\":\"hunting\",\"style\":\"link\"},{\"id\":\"f99e8417-fdad-434d-98a3-9b901c273650\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Query Pack\",\"subTarget\":\"querypack\",\"style\":\"link\"},{\"id\":\"a56b10fb-0e65-4308-9c9e-e6c56ef356c6\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Saved Searches\",\"subTarget\":\"saved\",\"style\":\"link\"},{\"id\":\"16449876-2e6f-4c55-9931-30b5d82baead\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Retention\",\"subTarget\":\"retention\",\"style\":\"link\"}]},\"name\":\"links - 7\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| summarize count(IncidentName) by   [\\\"Workspace\\\"] = workSpacename\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":4,\"title\":\"Count of Security Incidents for selected {$rowCount} Workspaces\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"wsName\"]},\"sortBy\":[{\"itemKey\":\"wsName\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"wsName\",\"sortOrder\":2}]},\"name\":\"query - 3 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| summarize High=  countif(Severity==\\\"High\\\"),\\r\\n            Medium=countif(Severity==\\\"Medium\\\"),\\r\\n            Low   =countif(Severity==\\\"Low\\\"), \\r\\n            Informational=countif(Severity==\\\"Informational\\\"),\\r\\n            Last_record =  datetime_diff(\\\"second\\\", now(), max(TimeGenerated)),\\r\\n            Total  = count()\\r\\n            by workSpacename\\r\\n| join\\r\\n(\\r\\nSecurityIncident\\r\\n// mean time to triage Section\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n//| where FirstModifiedTime  >= {TimeRange:start} and FirstModifiedTime  <= {TimeRange:end}\\r\\n| extend Owner = todynamic(Owner.assignedTo) \\r\\n| where Owner in ({Owner}) or '{Owner:label}' ==  \\\"All\\\"\\r\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\r\\n| where Product in ({Product}) or '{Product:label}' ==  \\\"All\\\"\\r\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\r\\n| extend TimeToTriage =  (FirstModifiedTime - CreatedTime)/1h\\r\\n| summarize 50th_PercentileMeanTime=percentile(TimeToTriage, 50) by workSpacename\\r\\n) on workSpacename\\r\\n|project-away workSpacename1\\r\\n| join\\r\\n(\\r\\nSecurityIncident\\r\\n// mean time to close Section\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| extend iD = TenantId\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n//| where ClosedTime >= {TimeRange:start} and ClosedTime <= {TimeRange:end}\\r\\n| extend Owner = todynamic(Owner.assignedTo) \\r\\n| where Owner in ({Owner}) or '{Owner:label}' ==  \\\"All\\\"\\r\\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \\r\\n| where Product in ({Product}) or '{Product:label}' ==  \\\"All\\\"\\r\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\r\\n| extend TimeToClosure =  (ClosedTime - CreatedTime)/1h\\r\\n| summarize 50th_PercentileCloseTime=percentile(TimeToClosure, 50) by workSpacename\\r\\n) on workSpacename\\r\\n|project-away workSpacename1\\r\\n| join\\r\\n(\\r\\nSecurityIncident\\r\\n    // Incident Trend by Workspace\\r\\n    // Get the Workspace Name(s) from a parameter\\r\\n    | extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n    | mv-expand stringtoSplit\\r\\n    | where stringtoSplit has TenantId\\r\\n    | extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n    | make-series IncidentTrend=count() on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by workSpacename\\r\\n) on workSpacename\\r\\n|project-away workSpacename1, TimeGenerated\\r\\n\\r\\n\",\"size\":1,\"title\":\"Security Incident summary for {$rowCount} Workspaces:  QueryTime {$queryTime}\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"workSpacename\",\"exportParameterName\":\"exportworkSpacename\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"High\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Medium\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Low\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Informational\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"Last_record\",\"formatter\":0,\"numberFormat\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}},{\"columnMatch\":\"Total\",\"formatter\":8,\"formatOptions\":{\"palette\":\"coldHot\"}},{\"columnMatch\":\"50th_PercentileMeanTime\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},{\"columnMatch\":\"50th_PercentileCloseTime\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":3}}},{\"columnMatch\":\"Trend\",\"formatter\":10,\"formatOptions\":{\"palette\":\"blueDark\"}},{\"columnMatch\":\"iD\",\"formatter\":5}],\"sortBy\":[{\"itemKey\":\"$gen_bar_High_1\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"workSpacename\",\"label\":\"Workspace Name\"},{\"columnId\":\"50th_PercentileMeanTime\",\"label\":\"Mean time to triage\"},{\"columnId\":\"50th_PercentileCloseTime\",\"label\":\"Mean time to closure\"}]},\"sortBy\":[{\"itemKey\":\"$gen_bar_High_1\",\"sortOrder\":2}]},\"name\":\"query - SecIncidents\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n | where type == \\\"microsoft.insights/workbooks\\\"\\r\\n | where properties.displayName has \\\"Security operations efficiency\\\" \\r\\n //| where properties.displayName has '{exportworkSpacename}'\\r\\n //| project properties.displayName, id\\r\\n | project id, note='Please select the Subscription and Workpsace names again in the new blade'\\r\\n | limit 1\\r\\n\\r\\n\",\"size\":4,\"title\":\"Open [Security Operations Efficiency] Workbook - if the Workbook exists locally?\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Click to Open [Security operations efficiency] workbook\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}],\"labelSettings\":[{\"columnId\":\"id\",\"label\":\"Open\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - open_SOC_workbook\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerWorkspaceID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerWorkspaceID, name=tolower(name), subscriptionId, tenantId\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace), subscriptionId, location, properties, resourceGroup\\r\\n) on name\\r\\n| where name =~ '{exportworkSpacename}'\\r\\n| project name, Open=tolower(id), tenantId, customerWorkspaceID,  subscriptionId, location, properties, resourceGroup\\r\\n\",\"size\":4,\"title\":\"Workspace details - click on \\\"name\\\" for more details\",\"exportedParameters\":[{\"fieldName\":\"tenantId\",\"parameterName\":\"exporttenantId\",\"parameterType\":1},{\"fieldName\":\"subscriptionId\",\"parameterName\":\"exportSubscriptionId\",\"parameterType\":1},{\"fieldName\":\"resourceGroup\",\"parameterName\":\"exportResourceGroup\",\"parameterType\":1},{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Click to Open [Security operations efficiency] workbook\",\"linkIsContextBlade\":false}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - Workspace Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/tenants?api-version=2020-01-01\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"\\\",\\\"value\\\":\\\"\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\"}}]}\",\"size\":4,\"title\":\"Tenant details\",\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"domains\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"Domain name(s)\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - Tenant Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{exportSubscriptionId}/resourceGroups/{exportResourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{exportworkSpacename}/providers/Microsoft.SecurityInsights/AlertRules\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"\\\",\\\"value\\\":\\\"\\\"},{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2020-01-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"properties.displayName\\\",\\\"columnid\\\":\\\"displayName\\\"},{\\\"path\\\":\\\"type\\\",\\\"columnid\\\":\\\"type\\\"},{\\\"path\\\":\\\"kind\\\",\\\"columnid\\\":\\\"kind\\\"},{\\\"path\\\":\\\"properties\\\",\\\"columnid\\\":\\\"properties\\\"},{\\\"path\\\":\\\"properties.lastModifiedUtc\\\",\\\"columnid\\\":\\\"lastModifiedUtc\\\"}]}}]}\",\"size\":4,\"title\":\"Rules details ('{exportName}' with {$rowCount} deployed Rules)\",\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"name\",\"formatter\":5},{\"columnMatch\":\"etag\",\"formatter\":5},{\"columnMatch\":\"domains\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"Domain name(s)\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}],\"rowLimit\":500,\"filter\":true,\"sortBy\":[{\"itemKey\":\"kind\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"kind\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"exportResourceGroup\",\"comparison\":\"isNotEqualTo\",\"value\":\"\"},\"name\":\"query - Rules details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"query - Workspace Details\\\",\\\"rightTable\\\":\\\"query - Tenant Details\\\",\\\"leftColumn\\\":\\\"tenantId\\\",\\\"rightColumn\\\":\\\"tenantId\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[query - Workspace Details].name\\\",\\\"mergedName\\\":\\\"name\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].Open\\\",\\\"mergedName\\\":\\\"Open\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].tenantId\\\",\\\"mergedName\\\":\\\"tenantId\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].customerWorkspaceID\\\",\\\"mergedName\\\":\\\"customerWorkspaceID\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].subscriptionId\\\",\\\"mergedName\\\":\\\"subscriptionId\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].location\\\",\\\"mergedName\\\":\\\"location\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].properties\\\",\\\"mergedName\\\":\\\"properties\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].id\\\",\\\"mergedName\\\":\\\"id\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantId\\\",\\\"mergedName\\\":\\\"tenantId1\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].countryCode\\\",\\\"mergedName\\\":\\\"countryCode\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].displayName\\\",\\\"mergedName\\\":\\\"displayName\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].domains\\\",\\\"mergedName\\\":\\\"domains\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantCategory\\\",\\\"mergedName\\\":\\\"tenantCategory\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].defaultDomain\\\",\\\"mergedName\\\":\\\"defaultDomain\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantType\\\",\\\"mergedName\\\":\\\"tenantType\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Tenant Details].tenantBrandingLogoUrl\\\",\\\"mergedName\\\":\\\"tenantBrandingLogoUrl\\\",\\\"fromId\\\":\\\"724f0ff2-e293-4655-9005-b25c4442a0de\\\"},{\\\"originalName\\\":\\\"[query - Workspace Details].resourceGroup\\\",\\\"mergedName\\\":\\\"resourceGroup\\\",\\\"fromId\\\":\\\"unknown\\\"}]}\",\"size\":4,\"title\":\"Tenant Details\",\"showExportToExcel\":true,\"queryType\":7,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"tenantId1\",\"formatter\":5},{\"columnMatch\":\"domains\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"Domain List\",\"linkIsContextBlade\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"exportworkSpacename\",\"comparison\":\"isNotEqualTo\"},\"showPin\":false,\"name\":\"query - merged Tenant view\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Classification and Tactics report\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| where Status == 'Closed'\\r\\n| order by LastModifiedTime \\r\\n| summarize count(), make_set(ClassificationComment) by workSpacename, Classification , ClassificationReason \\r\\n| evaluate pivot(Classification, sum(count_))\",\"size\":1,\"title\":\"Incident Classification report\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"set_ClassificationComment\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"BenignPositive\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"FalsePositive\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"TruePositive\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}},{\"columnMatch\":\"Undetermined\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"150px\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"set_ClassificationComment\",\"label\":\"Reason\"}]},\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":2}]},\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| extend Tactics_ = tostring(parse_json(tostring(AdditionalData.tactics)))\\r\\n| summarize  count()\\r\\n            by workSpacename, Tactics_\\r\\n| order by count_ desc\\r\\n| evaluate pivot(Tactics_, sum(count_))\",\"size\":1,\"title\":\"Incident Tactics report\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"set_ClassificationComment\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"TruePositive\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"workSpacename\",\"sortOrder\":1}],\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"workSpacename\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"[\\\"Collection\\\"]\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 10 - Tactics\"}]},\"name\":\"group - classification and tactics\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mvexpand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| summarize Total  = count()\\r\\n            by workSpacename\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":1,\"title\":\"Count of Security Incidents for selected Workspaces and Severity\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"High\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Medium\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Low\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Informational\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"labelSettings\":[{\"columnId\":\"workSpacename\",\"label\":\"Workspace Name\"}]}},\"customWidth\":\"40\",\"conditionalVisibility\":{\"parameterName\":\"hide\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - KQL for MAP count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n// Just show Workspaces that have Sentinel enabled\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| parse name with * '(' s_workspace ')'*\\r\\n| summarize count() by location, s_workspace\",\"size\":0,\"title\":\"Azure Sentinel Workspaces by Azure Region\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"mapSettings\":{\"locInfo\":\"AzureLoc\",\"locInfoColumn\":\"location\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"location\",\"legendMetric\":\"location\",\"legendAggregation\":\"Count\",\"itemColorSettings\":{\"nodeColorField\":\"count_\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"hide\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - ARG for MAp count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\",\\\"mergeType\\\":\\\"innerunique\\\",\\\"leftTable\\\":\\\"query - KQL for MAP count\\\",\\\"rightTable\\\":\\\"query - ARG for MAp count\\\",\\\"leftColumn\\\":\\\"workSpacename\\\",\\\"rightColumn\\\":\\\"s_workspace\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[query - KQL for MAP count].workSpacename\\\",\\\"mergedName\\\":\\\"Workspace Name\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - KQL for MAP count].Total\\\",\\\"mergedName\\\":\\\"Total\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - ARG for MAp count].location\\\",\\\"mergedName\\\":\\\"location\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - ARG for MAp count].s_workspace\\\",\\\"mergedName\\\":\\\"s_workspace\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"},{\\\"originalName\\\":\\\"[query - ARG for MAp count].count_\\\",\\\"mergedName\\\":\\\"count_\\\",\\\"fromId\\\":\\\"9862f923-5d48-4232-8b1d-54f18cd153d3\\\"}]}\",\"size\":0,\"title\":\"Azure Sentinel Incident Count by Region\",\"exportedParameters\":[{\"fieldName\":\"\",\"parameterName\":\"exportMap1\"},{\"fieldName\":\"location\",\"parameterName\":\"location\",\"parameterType\":1}],\"queryType\":7,\"visualization\":\"map\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"s_workspace\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"s_workspace\",\"sortOrder\":1}],\"mapSettings\":{\"locInfo\":\"AzureLoc\",\"locInfoColumn\":\"location\",\"sizeSettings\":\"Total\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"location\",\"legendMetric\":\"Total\",\"numberOfMetrics\":50,\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"Total\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n// Just show Workspaces that have Sentinel enabled\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| parse name with * '(' s_workspace ')'*\\r\\n| summarize count() by location, s_workspace\",\"size\":0,\"title\":\"Azure Sentinel Workspaces by Azure Region\",\"exportParameterName\":\"exportMap2\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"map\",\"mapSettings\":{\"locInfo\":\"AzureLoc\",\"locInfoColumn\":\"location\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"location\",\"legendMetric\":\"location\",\"legendAggregation\":\"Count\",\"itemColorSettings\":{\"nodeColorField\":\"count_\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"name\":\"query - 10\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"5443aca4-a73d-46ad-aaea-bd391acc3f0d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata1\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap1}')\\r\\n| project  ['region']=a.regionName,  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata2\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap2}')\\r\\n| project  ['region']=a.regionName,  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"793ac0c4-7518-4e52-9509-eb1bdf97854b\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata1_count\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap1}')\\r\\n| project  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"d4349432-c9cf-436e-9ede-2cd303c4bc9c\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"getMapdata2_count\",\"type\":1,\"isRequired\":true,\"query\":\"extend a = parse_json('{exportMap2}')\\r\\n| project  ['Incident Count']=a.legendValue\\r\\n| limit 1\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"88076350-2736-407f-a272-6b473dc92c6c\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 8\"},{\"type\":1,\"content\":{\"json\":\"### Results from clicking on the Maps above\\r\\n--------------\\r\\n\\r\\n|Azure Region|Location|Incident Count|Workspace Counter|\\r\\n|---|---|---|\\r\\n|Azure Sentinel Incident Count by Region| {getMapdata1}|{getMapdata1_count}||\\r\\n|Azure Sentinel Workspaces by Azure Region| {getMapdata2}||{getMapdata2_count}|\\r\\n\\r\\n-----------\"},\"name\":\"text - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mvexpand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| extend Tactics_ = tostring(parse_json(tostring(AdditionalData.tactics)))\\r\\n| summarize  count()\\r\\n            by workSpacename, Tactics_\\r\\n| order by count_ desc\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":1,\"title\":\"Count of Tactics for selected Workspaces\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":3,\"formatOptions\":{\"palette\":\"coldHot\"}},{\"columnMatch\":\"High\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Medium\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Low\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Informational\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"Total\",\"formatter\":8,\"formatOptions\":{\"palette\":\"coldHot\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"count\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"hide\",\"comparison\":\"isEqualTo\",\"value\":\"hide\"},\"name\":\"query - 3 - Copy - Copy - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"incidents\"},\"name\":\"group - overview\"},{\"type\":1,\"content\":{\"json\":\"---------------\"},\"name\":\"text - 9\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Expand to Show: Incident details\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| where TimeGenerated > startofday(ago(0d))\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of get workspace name section\\r\\n| extend productName_ = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| where productName_ in ({Product}) or '{Product:label}' ==\\\"All\\\"\\r\\n| summarize count() by IncidentNumber, Title, productName_, Severity, [\\\"Workspace\\\"] = workSpacename, IncidentUrl\\r\\n| order by Workspace asc , IncidentNumber desc\\r\\n//| top 50 by [\\\"Workspace\\\"]\",\"size\":1,\"title\":\"{$rowCount} Incidents in Workspaces today\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"exportedParameters\":[{\"fieldName\":\"IncidentNumber\",\"parameterName\":\"IncidentNumber\",\"parameterType\":1},{\"fieldName\":\"Workspace\",\"parameterName\":\"Workspace_export\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"productName_\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"greenDark\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Workspace\",\"formatter\":5},{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Open Azure Sentinel Incident\"}}],\"rowLimit\":5000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Workspace\"]},\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"productName_\",\"label\":\"Product Name\"}]},\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}]},\"name\":\"query - multi Alerts\"},{\"type\":1,\"content\":{\"json\":\"For further analysis I suggest you open the Azure Sentinel Incident Blade and _Investigate_ (use the hyper link provided in the table, if you have the correct RBAC).\\r\\n\\r\\nAlternatively open the [_Investigation Insights_] or [_Incident Overview_] Workbooks for guided and deeper investigation.  Open Incident Overview from the Portal, _Investigation Insights_ can be opened to the right --->.\\r\\n\\r\\n- You must have previoulsy SAVED these Workbooks in your workspace(s).  \\r\\n- Investigation Insights requires release v1.2 or above (you may have to manually select the Workspace), for prior versions you will have to select the matching Incident Number as well. \\r\\n- For the Workbooks to be listed, they need \\\"Investigation\\\" in the name when you save them.\"},\"customWidth\":\"50\",\"name\":\"text - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n | where type == \\\"microsoft.insights/workbooks\\\"\\r\\n | where properties.displayName has \\\"Investigation\\\" // or properties.displayName has \\\"Incident\\\"\\r\\n | where properties.displayName has '{Workspace_export}'\\r\\n | project properties.displayName, id,  {IncidentNumber}\\r\\n\",\"size\":4,\"title\":\"Workspace Name: {Workspace_export}\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"properties_displayName\",\"formatter\":1},{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Open Workbook\",\"linkIsContextBlade\":true}}],\"labelSettings\":[{\"columnId\":\"properties_displayName\",\"label\":\"Workbook Name\"},{\"columnId\":\"id\",\"label\":\"Open\"},{\"columnId\":\"Column1\",\"label\":\"Incident Number\"}]}},\"customWidth\":\"50\",\"name\":\"query - 11\"},{\"type\":1,\"content\":{\"json\":\"### Select a single workspace to see Incident level details \"},\"name\":\"text - 6\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"4383a3f4-7606-41a7-b1cf-e5bffd2d9ecb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"iWorkspace\",\"label\":\"Incident Workspace\",\"type\":7,\"query\":\"resources\\r\\n// Just show Workspaces that have Sentinel enabled\\r\\n| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| where name has \\\"SecurityInsights\\\"\\r\\n| parse name with * '(' s_workspace ')'*\\r\\n| project name = s_workspace\\r\\n| sort by name asc\",\"crossComponentResources\":[\"{Subscription}\"],\"value\":\"\",\"typeSettings\":{\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"c2494755-05cc-4b93-b253-e8a0d4b7c899\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"iResourceGroup\",\"type\":1,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| where tolower(name) == \\\"{iWorkspace}\\\"\\r\\n| project resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n// Get the Workspace Name(s) from a parameter\\r\\n| extend stringtoSplit = split(\\\"{WorkspaceIDguid}\\\",\\\",\\\")\\r\\n| mv-expand stringtoSplit\\r\\n| where stringtoSplit has TenantId\\r\\n| extend workSpacename = trim(@\\\"[^\\\\w]+\\\",tostring(split(stringtoSplit,\\\":\\\").[1]))\\r\\n// end of workspace validation, now match workspace to the selected parameter\\r\\n| where tolower(workSpacename) == tolower('{iWorkspace}')\\r\\n| summarize arg_max(TimeGenerated,*) by tostring(IncidentNumber)\\r\\n| extend Alerts = extract(\\\"\\\\\\\\[(.*?)\\\\\\\\]\\\", 1, tostring(AlertIds))\\r\\n| extend productName_ = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| where productName_ in ({Product}) or '{Product:label}' ==\\\"All\\\"\\r\\n| mv-expand AlertIds to typeof(string)\\r\\n| join \\r\\n(\\r\\n    SecurityAlert\\r\\n    | extend AlertEntities = parse_json(Entities)\\r\\n    | mv-expand AlertEntities\\r\\n) on $left.AlertIds == $right.SystemAlertId\\r\\n| summarize AlertCount=dcount(AlertIds), entityList=make_set(tostring(AlertEntities.Type)) by IncidentNumber, Status, Severity, Title,  Alerts, IncidentUrl, Owner=tostring(Owner.userPrincipalName) , Tactics =tostring(AdditionalData.tactics), workSpacename, productName_\\r\\n// set column order\\r\\n| project workSpacename, IncidentNumber, Severity, Status, AlertCount,Owner, Title, entityList, Tactics, IncidentUrl, productName_\\r\\n| order by IncidentNumber desc\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":0,\"title\":\"Details for {iWorkspace} Workspace, count of: {$rowCount} Incidents during {TimeRange:label}\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"workSpacename\",\"formatter\":5},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"greenDark\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"New\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AlertCount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"IncidentUrl\",\"formatter\":1,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Open Incident in Azure Sentinel \"}}],\"rowLimit\":500,\"filter\":true,\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"IncidentNumber\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"iWorkspace\",\"comparison\":\"isNotEqualTo\",\"value\":\"\"},\"name\":\"query - single alert\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"incidents\"},\"name\":\"group - Incidents\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Hunting: Hunt across selected workspaces, using any KQL you paste or edit in this field. \",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"fcc2456c-f4b5-4505-a188-aa4ebab3db67\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"queryTxt\",\"type\":1,\"description\":\"Add  workspace identity e.g SecurityIncident | summarize count() by WorkspaceId=TenantId\",\"value\":\"Perf \\r\\n| summarize count()  by WorkspaceId=TenantId\",\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"kql\"},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{queryTxt}\",\"size\":0,\"title\":\"Cross workspace Query results, rows: {$rowCount}, QueryTime: {$queryTime}.  Select a row for more details\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"WorkspaceId\",\"exportParameterName\":\"exportWorkspaceId\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Workspace\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}}]}},\"name\":\"query - crossWorkspaceQuery\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerWorkspaceID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerWorkspaceID, name=tolower(name), subscriptionId, tenantId\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace), subscriptionId, location, properties, resourceGroup\\r\\n) on name\\r\\n| where customerWorkspaceID in ('{exportWorkspaceId}')\\r\\n| project name, Open=tolower(id), tenantId, customerWorkspaceID,  subscriptionId, location, properties, resourceGroup\\r\\n\",\"size\":4,\"title\":\"{exportWorkspaceId} lookup  - used to identify tenant or workspace Ids from the results above\",\"exportedParameters\":[{\"fieldName\":\"tenantId\",\"parameterName\":\"exporttenantId\",\"parameterType\":1},{\"fieldName\":\"subscriptionId\",\"parameterName\":\"exportSubscriptionId\",\"parameterType\":1},{\"fieldName\":\"resourceGroup\",\"parameterName\":\"exportResourceGroup\",\"parameterType\":1},{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Open\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkLabel\":\"Workspace context blade\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"WorkbookTemplate\",\"linkLabel\":\"Click to Open [Security operations efficiency] workbook\",\"linkIsContextBlade\":false}},{\"columnMatch\":\"note\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"tenantId\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"tenantId\",\"sortOrder\":1}]},\"conditionalVisibility\":{\"parameterName\":\"exportWorkspaceId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - Workspace Details\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"hunting\"},\"name\":\"group - hunting\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Query Pack: Use a Query Pack from any Resource Group, then pick a query to run from within the Query Pack\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"9a0c8c17-ac07-4b9a-b3d9-44060087935f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"description\":\"Find Query packs in specific subscriptions \",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"includeAll\":false,\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.operationalinsights/querypacks\\\"\\r\\n| project-away type, kind\",\"size\":0,\"exportedParameters\":[{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1},{\"fieldName\":\"resourceGroup\",\"parameterName\":\"resourceGroup\",\"parameterType\":1},{\"fieldName\":\"subscriptionId\",\"parameterName\":\"subscriptionId\",\"parameterType\":1}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"tenantId\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"location\",\"formatter\":17},{\"columnMatch\":\"resourceGroup\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"subscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":\"\",\"showIcon\":true}}]}},\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/microsoft.operationalInsights/querypacks/{exportName}/Queries\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2019-09-01-preview\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"properties.displayName\\\",\\\"columnid\\\":\\\"name\\\"},{\\\"path\\\":\\\"properties.body\\\",\\\"columnid\\\":\\\"body\\\"},{\\\"path\\\":\\\"properties.description\\\",\\\"columnid\\\":\\\"description\\\"},{\\\"path\\\":\\\"properties.tags\\\",\\\"columnid\\\":\\\"tags\\\"},{\\\"path\\\":\\\"systemData.lastModifiedAt\\\",\\\"columnid\\\":\\\"lastModifiedAt\\\"},{\\\"path\\\":\\\"systemData.lastModifiedBy\\\",\\\"columnid\\\":\\\"lastModifiedBy\\\"},{\\\"path\\\":\\\"systemData.createdBy\\\",\\\"columnid\\\":\\\"createdBy\\\"},{\\\"path\\\":\\\"systemData.createdBy\\\",\\\"columnid\\\":\\\"createdByType\\\"},{\\\"path\\\":\\\"systemData.createdAt\\\",\\\"columnid\\\":\\\"createdAt\\\"}]}}]}\",\"size\":1,\"title\":\"Select a Query to run from the list: {$rowCount} Queries in Query Pack: {exportName}\",\"exportedParameters\":[{\"fieldName\":\"body\",\"parameterName\":\"exportQuery\"},{\"fieldName\":\"name\",\"parameterName\":\"exportName\",\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"body\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"createdByType\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"body\",\"label\":\"Query\"}]},\"sortBy\":[{\"itemKey\":\"createdByType\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"exportName\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query -Qp queries\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{exportQuery}\",\"size\":0,\"title\":\"Results of the selected Query: {exportName}\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"conditionalVisibility\":{\"parameterName\":\"exportQuery\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 3\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"querypack\"},\"name\":\"group - qp\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"KQL Saved Searches: Select a Workspace to check Saved Searches\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"54ab7c42-3983-46fd-bb6b-9a1d206eec3a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"description\":\"Lookup saved queries in any Azure Sentinel workspace\",\"isRequired\":true,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerID, name=tolower(name)\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace)\\r\\n) on name\\r\\n| project tolower(id), customerID, name\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"{Workspace}/SavedSearches\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2021-06-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"properties.displayName\\\",\\\"columnid\\\":\\\"displayName\\\"},{\\\"path\\\":\\\"properties.category\\\",\\\"columnid\\\":\\\"category\\\"},{\\\"path\\\":\\\"properties.query\\\",\\\"columnid\\\":\\\"query\\\"},{\\\"path\\\":\\\"properties.version\\\",\\\"columnid\\\":\\\"version\\\"},{\\\"path\\\":\\\"name\\\",\\\"columnid\\\":\\\"name\\\"}]}}]}\",\"size\":1,\"title\":\"Select a Query to run, or Search in all columns, Category, Name & Query\",\"noDataMessage\":\"no saved queries found in {Workspace:name}\",\"exportedParameters\":[{\"fieldName\":\"query\",\"parameterName\":\"query\",\"parameterType\":1,\"defaultValue\":\" \"},{\"fieldName\":\"displayName\",\"parameterName\":\"name\",\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"Subscription\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Workspace\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"saved query grid - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Saved Query - {name}\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f3f7beb8-b287-45fb-8af2-c528ef55b704\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"queryText\",\"type\":1,\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"kql\"},\"criteriaData\":[{\"condition\":\"else result = '{query}'\",\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"param\",\"resultValType\":\"static\",\"resultVal\":\"{query}\"}}],\"label\":\"Saved Query Text\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query text param\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{query}\",\"size\":2,\"title\":\"Query Results\",\"timeContext\":{\"durationMs\":1209600000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"query - 3\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"query\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Workspace\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"visible if query selected group\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"saved\"},\"name\":\"group - kql\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Workspace and Table Retention: Select a Workspace to check Workspace and Table Retention\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"54ab7c42-3983-46fd-bb6b-9a1d206eec3a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"description\":\"Lookup Workspace and Table Retention\",\"isRequired\":true,\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend customerID = trim(' ', tostring(properties.customerId))\\r\\n| project id, customerID, name=tolower(name)\\r\\n|join \\r\\n(\\r\\n\\tresources\\r\\n\\t// Just show Workspaces that have Sentinel enabled\\r\\n\\t| where type =~ \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n\\t| where name has \\\"SecurityInsights\\\"\\r\\n\\t| parse name with * '(' s_workspace ')'*\\r\\n\\t| project name=tolower(s_workspace)\\r\\n) on name\\r\\n| project tolower(id), customerID, name\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{Workspace:subscription}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}?api-version=2017-04-26-preview\\\",\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"columns\\\":[{\\\"path\\\":\\\"id\\\",\\\"columnid\\\":\\\"Workspace\\\"},{\\\"path\\\":\\\"properties.retentionInDays\\\",\\\"columnid\\\":\\\"RetentionInDays\\\"},{\\\"path\\\":\\\"location\\\",\\\"columnid\\\":\\\"Location\\\"},{\\\"path\\\":\\\"properties.workspaceCapping.dailyQuotaGb\\\",\\\"columnid\\\":\\\"DailyQuotaGb\\\"},{\\\"path\\\":\\\"properties.sku.name\\\",\\\"columnid\\\":\\\"SkuName\\\"}]}}]}\",\"size\":4,\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{Workspace:subscription}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/Tables?api-version=2017-04-26-preview\\\",\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[{\\\"path\\\":\\\"name\\\",\\\"columnid\\\":\\\"TableName\\\"},{\\\"path\\\":\\\"properties.retentionInDays\\\",\\\"columnid\\\":\\\"RetentionInDays\\\"}]}}]}\",\"size\":3,\"showExportToExcel\":true,\"queryType\":12,\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 13\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"retention\"},\"name\":\"group - retention\"}],\"fromTemplateId\":\"sentinel-SentinelCentral\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId13'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=SentinelCentral; logoFileName=Azure_Sentinel.svg; description=Use this report to view Incident (and Alert data) across many workspaces, this works with Azure Lighthouse and across any subscription you have access to.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=2.1.1; title=Microsoft Sentinel Central; templateRelativePath=SentinelCentral.json; subtitle=; provider=Microsoft Sentinel community}.description",
                "parentId": "[variables('workbookId13')]",
                "contentId": "[variables('_workbookContentId13')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion13')]",
                "source": {
                  "kind": "Solution",
                  "name": "SOC Handbook",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Community"
                },
                "support": {
                  "tier": "Community",
                  "name": "Community",
                  "link": "https://github.com/Azure/Azure-Sentinel/issues"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "SecurityIncident",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId13')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook13-name')]",
        "contentProductId": "[variables('_workbookcontentProductId13')]",
        "id": "[variables('_workbookcontentProductId13')]",
        "version": "[variables('workbookVersion13')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "SOC Handbook",
        "publisherDisplayName": "Community",
        "descriptionHtml": "<p><strong>Note:</strong> <em>There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</em></p>\n<p>The SOC Handbook solution for Microsoft Sentinel provides a collection of resources that enable and empower SOC Analysts to get better visibility and understanding of point-in-time security posture of organizational resources.</p>\n<p>All content packaged in this solution is built and supported by the Microsoft Sentinel community. For any support, please create an <a href=\"https://github.com/Azure/Azure-Sentinel/issues\">issue</a> on the Microsoft Sentinel GitHub repository.</p>\n<p><strong>Workbooks:</strong> 13</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Azure_Sentinel.svg\"width=\"75px\"height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "SOC Handbook",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Community"
        },
        "support": {
          "name": "Community",
          "tier": "Community",
          "link": "https://github.com/Azure/Azure-Sentinel/issues"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId2')]",
              "version": "[variables('workbookVersion2')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId3')]",
              "version": "[variables('workbookVersion3')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId4')]",
              "version": "[variables('workbookVersion4')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId5')]",
              "version": "[variables('workbookVersion5')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId6')]",
              "version": "[variables('workbookVersion6')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId7')]",
              "version": "[variables('workbookVersion7')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId8')]",
              "version": "[variables('workbookVersion8')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId9')]",
              "version": "[variables('workbookVersion9')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId10')]",
              "version": "[variables('workbookVersion10')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId11')]",
              "version": "[variables('workbookVersion11')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId12')]",
              "version": "[variables('workbookVersion12')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId13')]",
              "version": "[variables('workbookVersion13')]"
            }
          ]
        },
        "firstPublishDate": "2022-11-30",
        "providers": [
          "Community"
        ],
        "categories": {
          "domains": [
            "Security - Others"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
