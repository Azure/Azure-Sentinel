{
    "$schema":  "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion":  "1.0.0.0",
    "metadata":  {
        "title": "Incident tasks - Microsoft 365 Defender Ransomware Playbook for SecOps",
        "description": "This playbook add Incident Tasks based on Microsoft 365 Defender Ransomware Playbook for SecOps. This playbook will walk the analyst through four stages of responding to a ransomware incident: containment, investigation, eradication and recovery, and prevention. The step-by-step instructions will help you take the required remedial action to protect information and minimize further risks.",
        "prerequisites": "",
        "postDeployment": ["1. Add Microsoft Sentinel Responder role to the managed identity.", "2. Assign playbook to the automation rule."],
        "prerequisitesDeployTemplateFile": "",
        "lastUpdateTime": "2023-02-16T00:00:00.000Z",
        "entities": [],
        "tags": ["Tasks"],
        "support":  {
            "tier":  "community",
            "armtemplate":  "Generated from https://github.com/Azure/Azure-Sentinel/tree/master/Tools/Playbook-ARM-Template-Generator"
        },
        "author":  {
            "name":  "Benji Kovacevic"
        }
    },
    "parameters":  {
        "PlaybookName":  {
            "defaultValue":  "M365D_Ransomware_Playbook_for_SecOps-Tasks",
            "type":  "string"
        }
    },
    "variables":  {
        "MicrosoftSentinelConnectionName":  "[concat('MicrosoftSentinel-', parameters('PlaybookName'))]"
    },
    "resources":  [
        {
            "properties":  {
                "provisioningState":  "Succeeded",
                "state":  "Enabled",
                "definition":  {
                    "$schema":  "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                    "contentVersion":  "1.0.0.0",
                    "parameters":  {
                        "$connections":  {
                            "defaultValue":  {
                            },
                            "type":  "Object"
                        }
                    },
                    "triggers":  {
                        "Microsoft_Sentinel_incident":  {
                            "type":  "ApiConnectionWebhook",
                            "inputs":  {
                                "body":  {
                                    "callback_url":  "@{listCallbackUrl()}"
                                },
                                "host":  {
                                    "connection":  {
                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                    }
                                },
                                "path":  "/incident-creation"
                            }
                        }
                    },
                    "actions":  {
                        "Condition_-_if_alert_title_contains_ransomware":  {
                            "actions":  {
                                "Scope_Containment":  {
                                    "actions":  {
                                        "Add_task_to_incident_-_Containment_-_Step_1":  {
                                            "runAfter":  {
                                                "Compose_-_Containment_-_Step_1":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Containment_-_Step_1')}\u003c/p\u003e",
                                                    "taskTitle":  "Containment - Step 1: Assess the scope of the incident"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Containment_-_Step_2":  {
                                            "runAfter":  {
                                                "Compose_-_Containment_-_Step_2":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Containment_-_Step_2')}\u003c/p\u003e",
                                                    "taskTitle":  "Containment -Step 2: Preserve existing systems"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Containment_-_Step_3.1":  {
                                            "runAfter":  {
                                                "Compose_-_Containment_-_Step_3.1":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Containment_-_Step_3.1')}\u003c/p\u003e",
                                                    "taskTitle":  "Containment -Step 3.1: Prevent the spread"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Containment_-_Step_3.2":  {
                                            "runAfter":  {
                                                "Compose_-_Containment_-_Step_3.2":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Containment_-_Step_3.2')}\u003c/p\u003e",
                                                    "taskTitle":  "Containment -Step 3.2: Prevent the spread"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Compose_-_Containment_-_Step_1":  {
                                            "runAfter":  {
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eContainment and investigation should occur as simultaneously as possible; however, you should focus on quickly achieving containment, so you have more time to investigate. These steps help you determine the scope of the attack and to isolate it to only affected entities, such as user accounts and devices.\u003c/dt\u003e\n\u003cdt\u003eRun through this list of questions and tasks to discover the extent of the attack. Microsoft Sentinel and Microsoft 365 Defender can provide a consolidated view of all impacted or at-risk assets to aid in your incident response assessment. See \u003ca target='_blank' href=\"https://learn.microsoft.com/azure/sentinel/respond-threats-during-investigation\"\u003eRespond to threat actors while investigating or threat hunting in Microsoft Sentinel\u003c/a\u003e or \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender/incidents-overview?view=o365-worldwide\"\u003eIncident response with Microsoft 365 Defender\u003c/a\u003e. You can use the alerts and the evidence list in the incident to determine:\u003c/dt\u003e\n\u003cdt\u003e\u003cb\u003e�\tWhich user accounts might be compromised?\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\tWhich accounts were used to deliver the payload?\u003c/dd\u003e\n\u003cdt\u003e\u003cb\u003e�\tWhich \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/investigate-machines?view=o365-worldwide\"\u003eonboarded\u003c/a\u003e and \u003ca href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/device-discovery?view=o365-worldwide\"\u003ediscovered\u003c/a\u003e devices are affected and how?\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\tOriginating devices\u003c/dd\u003e\n\u003cdd\u003eo\tImpacted devices\u003c/dd\u003e\n\u003cdd\u003eo\tSuspicious devices\u003c/dd\u003e\n\u003cdt\u003e\u003cb\u003e�\tIdentify any network communication that is associated with the incident.\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e\u003cb\u003e�\tWhich applications are affected?\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e\u003cb\u003e�\tWhat payloads were spread?\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e\u003cb\u003e�\tHow is the attacker communicating with the compromised devices? (Network protection must be \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/enable-network-protection?view=o365-worldwide\"\u003eenabled\u003c/a\u003e):\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\tGo to the \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/indicator-ip-domain?view=o365-worldwide#create-an-indicator-for-ips-urls-or-domains-from-the-settings-page\"\u003eindicators page\u003c/a\u003e to add a block for the IP and URL (if you have that information).\u003c/dd\u003e\n\u003cdd\u003eo\t\u003ca target='_blank' href=\"https://learn.microsoft.com/azure/sentinel/add-entity-to-threat-intelligence?tabs=incidents\"\u003eAdd entities to threat intelligence in Microsoft Sentinel\u003c/a\u003e\u003c/dd\u003e\n\u003cdt\u003e\u003cb\u003e�\tWhat was the payload delivery medium?\u003c/b\u003e\u003c/dt\u003e"
                                        },
                                        "Compose_-_Containment_-_Step_2":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Containment_-_Step_1":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eRun through this list of tasks and questions to protect existing systems from attack:\u003cdt\u003e\n\u003cdt\u003e\u003cb\u003e�\tIf you have online backups, consider disconnecting the backup system from the network until you are confident that the attack is contained, see \u003ca target='_blank' href=\"https://docs.microsoft.com/security/compass/backup-plan-to-protect-against-ransomware\"\u003eBackup and restore plan to protect against ransomware\u003c/a\u003e.\u003c/b\u003e\u003cdt\u003e\n\u003cdt\u003e\u003cb\u003e�\tIf you are experiencing or expect an imminent and active ransomware deployment:\u003c/b\u003e\u003cdt\u003e\n\u003cdd\u003eo\t\u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender/investigate-users?view=o365-worldwide\"\u003eSuspend privileged and local accounts\u003c/a\u003e that you suspect are part of the attack. You can do this from the Users tab in the properties of the incident in the Microsoft 365 Defender portal, or \u003ca target='_blank' href=\"https://learn.microsoft.com/azure/sentinel/investigate-with-ueba\"\u003eInvestigate users with Microsoft Sentinel UEBA\u003c/a\u003e.\u003c/dd\u003e\n\u003cdd\u003eo\tStop all \u003ca target='_blank' href=\"https://docs.microsoft.com/defender-for-identity/playbook-domain-dominance\"\u003eremote logon sessions\u003c/a\u003e.\u003c/dd\u003e\n\u003cdd\u003eo\tReset the compromised user account passwords and require the users of compromised user accounts to sign in again - \u003ca target='_blank' href='https://learn.microsoft.com/azure/sentinel/respond-threats-during-investigation'\u003eRespond to threat actors while investigating or threat hunting in Microsoft Sentinel\u003c/a\u003e\u003c/dd\u003e\n\u003cdd\u003eo\tDo the same for user accounts that might be compromised.\u003c/dd\u003e\n\u003cdd\u003eo\tIf shared local accounts are compromised, have your IT admin help you to enforce a password change across all exposed devices. Example Kusto query:\u003c/dd\u003e\n\u003cdd\u003e\u003ccode\u003eDeviceLogonEvents | where DeviceName  contains (AccountDomain) | take 10\u003c/code\u003e\u003c/dd\u003e\n\u003cdt\u003e\u003cb\u003e�\tFor the devices that are not yet isolated and are not part of the critical infrastructure:\u003c/b\u003e\u003cdt\u003e\n\u003cdd\u003eo\tIsolate compromised devices from the network but do not shut them off  - \u003ca target='_blank' href='https://learn.microsoft.com/azure/sentinel/respond-threats-during-investigation'\u003eRespond to threat actors while investigating or threat hunting in Microsoft Sentinel\u003c/a\u003e\u003c/dd\u003e\n\u003cdd\u003eo\tIf you identify the originating or spreader devices, isolate those first.\u003c/dd\u003e\n\u003cdt\u003e\u003cb\u003e�\tPreserve compromised systems for analysis.\u003c/b\u003e\u003cdt\u003e"
                                        },
                                        "Compose_-_Containment_-_Step_3.1":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Containment_-_Step_2":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eUse this list to keep the attack from spreading to additional entities.\u003c/dt\u003e\n\u003cdt\u003e\u003cb\u003e�\tIf shared local accounts are being used in the attack, consider \u003ca target='_blank' href=\"https://techcommunity.microsoft.com/t5/microsoft-security-baselines/blocking-remote-use-of-local-accounts/ba-p/701042\"\u003eBlocking Remote Use of Local Accounts\u003c/a\u003e.\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\tKusto query for all network logons that are local admins:\u003c/dd\u003e\n\u003cdd\u003e\u003ccode\u003eDeviceLogonEvents\n\u003cbr\u003e| where IsLocalAdmin == true and AccountDomain == DeviceName\u003cbr\u003e\n| extend IsLocalLogon = tobool(todynamic(AdditionalFields).IsLocalLogon)\u003cbr\u003e\n| where IsLocalLogon==false\u003c/code\u003e\u003c/dd\u003e\n\u003cdd\u003eo\tKusto query for non-RDP logons (more realistic for most networks):\u003c/dd\u003e\n\u003cdd\u003e\u003ccode\u003eDeviceLogonEvents\u003cbr\u003e\n| where IsLocalAdmin == true and AccountDomain == DeviceName and LogonType != 'RemoteInteractive'\u003cbr\u003e\n| extend IsLocalLogon = tobool(todynamic(AdditionalFields).IsLocalLogon)\u003cbr\u003e\n| where IsLocalLogon==false\u003c/code\u003e\u003c/dd\u003e\n\u003cdt\u003e\u003cb\u003e�\tQuarantine and add indicators for files that are infected.\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e\u003cb\u003e�\tEnsure that your antivirus solution is configurable in its optimal protection state. For Microsoft Defender Antivirus, this includes:\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\t\u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/configure-real-time-protection-microsoft-defender-antivirus?view=o365-worldwide#real-time-protection-policy-settings\"\u003eReal time protection\u003c/a\u003e is enabled.\u003c/dd\u003e\n\u003cdd\u003eo\t\u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection?view=o365-worldwide\"\u003eTamper protection\u003c/a\u003e is enabled. In the Microsoft 365 Defender portal, select Settings \u003e Endpoints \u003e Advanced features \u003e Tamper protection.\u003c/dd\u003e\n\u003cdd\u003eo\t\u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/enable-attack-surface-reduction?view=o365-worldwide\"\u003eAttack surface reduction (ASR)\u003c/a\u003e rules are enabled.\u003c/dd\u003e\n\u003cdd\u003eo\t\u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/enable-cloud-protection-microsoft-defender-antivirus?view=o365-worldwide\"\u003eCloud protectio\u003c/a\u003en is enabled.\u003c/dd\u003e\n\u003cdt\u003eContinue to the task - Containment - Step 3.2: Prevent the spread\u003c/dt\u003e"
                                        },
                                        "Compose_-_Containment_-_Step_3.2":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Containment_-_Step_3.1":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e\u003cb\u003e�\tDisable Exchange ActiveSync and OneDrive sync.\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\tTo disable Exchange ActiveSync for a mailbox, see \u003ca target='_blank' href=\"https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/enable-or-disable-exchange-activesync\"\u003eHow to disable Exchange ActiveSync for users in Exchange Online\u003c/a\u003e.\u003c/dd\u003e\n\u003cdd\u003eo\tTo disable other types of access to a mailbox, see:\u003c/dd\u003e\n\u003cdd\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;-\t\u003ca target='_blank' href=\"https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/enable-or-disable-mapi\"\u003eEnable or disable MAPI for a mailbox\u003c/a\u003e.\u003c/dd\u003e\n\u003cdd\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;-\t\u003ca target='_blank' href=\"https://docs.microsoft.com/exchange/clients-and-mobile-in-exchange-online/pop3-and-imap4/enable-or-disable-pop3-or-imap4-access\"\u003eEnable or Disable POP3 or IMAP4 access for a user\u003ca/\u003e.\u003c/dd\u003e\n\u003cdd\u003eo\tPausing OneDrive sync will help protect your cloud data from being updated by potentially infected devices. For more information, see \u003ca target='_blank' href=\"https://support.microsoft.com/office/how-to-pause-and-resume-sync-in-onedrive-2152bfa4-a2a5-4d3a-ace8-92912fb4421e\"\u003eHow to Pause and Resume sync in OneDrive\u003c/a\u003e.\u003c/dd\u003e\n\u003cdt\u003e\u003cb\u003e�\tApply relevant patches and configuration changes on affected systems.\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e\u003cb\u003e�\tBlock ransomware communications using internal and external controls.\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e\u003cb\u003e�\tPurge cached content\u003c/b\u003e\u003c/dt\u003e"
                                        }
                                    },
                                    "runAfter":  {
                                        "Scope_Introduction":  [
                                            "Succeeded"
                                        ]
                                    },
                                    "type":  "Scope"
                                },
                                "Scope_Eradication_and_recovery":  {
                                    "actions":  {
                                        "Add_task_to_incident_-_Eradication_and_recovery_-_S1_-_Verify_your_backups":  {
                                            "runAfter":  {
                                                "Compose_-_Eradication_and_recovery_-_S1_-_Verify_your_backups":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Eradication_and_recovery_-_S1_-_Verify_your_backups')}\u003c/p\u003e",
                                                    "taskTitle":  "Eradication and recovery - Step 1: Verify your backups"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Eradication_and_recovery_-_S2_-_Add_indicators":  {
                                            "runAfter":  {
                                                "Compose_-_Eradication_and_recovery_-_S2_-_Add_indicators":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Eradication_and_recovery_-_S2_-_Add_indicators')}\u003c/p\u003e",
                                                    "taskTitle":  "Eradication and recovery - Step 2: Add indicators"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Eradication_and_recovery_-_S3_-_Reset_compromised_users":  {
                                            "runAfter":  {
                                                "Compose_-_Eradication_and_recovery_-_S3_-_Reset_compromised_users":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Eradication_and_recovery_-_S3_-_Reset_compromised_users')}\u003c/p\u003e",
                                                    "taskTitle":  "Eradication and recovery - Step 3: Reset compromised users"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Eradication_and_recovery_-_S4_-_Isolate_attacker_control":  {
                                            "runAfter":  {
                                                "Compose_-_Eradication_and_recovery_-_S4_-_Isolate_attacker_control_points":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Eradication_and_recovery_-_S4_-_Isolate_attacker_control_points')}\u003c/p\u003e",
                                                    "taskTitle":  "Eradication and recovery - Step 4: Isolate attacker control points"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Eradication_and_recovery_-_S5_-_Remove_the_malware":  {
                                            "runAfter":  {
                                                "Compose_-_Eradication_and_recovery_-_S5_-_Remove_the_malware":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Eradication_and_recovery_-_S5_-_Remove_the_malware')}\u003c/p\u003e",
                                                    "taskTitle":  "Eradication and recovery - Step 5: Remove the malware"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Eradication_and_recovery_-_S6_-_Recover_files_on_a_clean":  {
                                            "runAfter":  {
                                                "Compose_-_Eradication_and_recovery_-_S6_-_Recover_files_on_a_cleaned_device":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Eradication_and_recovery_-_S6_-_Recover_files_on_a_cleaned_device')}\u003c/p\u003e",
                                                    "taskTitle":  "Eradication and recovery - Step 6: Recover files on a cleaned device"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Eradication_and_recovery_-_S7_-_Recover_files_in_OneDrive":  {
                                            "runAfter":  {
                                                "Compose_-_Eradication_and_recovery_-_S7_-_Recover_files_in_OneDrive_for_Business":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Eradication_and_recovery_-_S7_-_Recover_files_in_OneDrive_for_Business')}\u003c/p\u003e",
                                                    "taskTitle":  "Eradication and recovery - Step 7: Recover files in OneDrive for Business"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Eradication_and_recovery_-_S8_-_Recover_deleted_email":  {
                                            "runAfter":  {
                                                "Compose_-_Eradication_and_recovery_-_S8_-_Recover_deleted_email":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Eradication_and_recovery_-_S8_-_Recover_deleted_email')}\u003c/p\u003e",
                                                    "taskTitle":  "Eradication and recovery - Step 8: Recover deleted email"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Eradication_and_recovery_-_S9_-_Re-enable_Exchange_Act":  {
                                            "runAfter":  {
                                                "Compose_-_Eradication_and_recovery_-_S9_-_Re-enable_Exchange_ActiveSync":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Eradication_and_recovery_-_S9_-_Re-enable_Exchange_ActiveSync')}\u003c/p\u003e",
                                                    "taskTitle":  "Eradication and recovery - Step 9: Re-enable Exchange ActiveSync and OneDrive Sync"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Compose_-_Eradication_and_recovery_-_S1_-_Verify_your_backups":  {
                                            "runAfter":  {
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eIf you have offline backups, you can probably restore the data that has been encrypted after you have removed the ransomware payload (malware) from your environment and after you have verified that there's no unauthorized access in your Microsoft 365 tenant.\u003c/dt\u003e\n\u003cdt\u003eContinue to Eradication and recovery - Step 2: Add indicators\u003c/dt\u003e"
                                        },
                                        "Compose_-_Eradication_and_recovery_-_S2_-_Add_indicators":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Eradication_and_recovery_-_S1_-_Verify_your_backups":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eAdd any known attacker communication channels as \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/manage-indicators?view=o365-worldwide\"\u003eindicators\u003c/a\u003e, blocked in firewalls, in your proxy servers, and on endpoints, and \u003ca target='_blank' href='https://learn.microsoft.com/azure/sentinel/add-entity-to-threat-intelligence?tabs=incidents'\u003eadd entities to threat intelligence in Microsoft Sentinel\u003c/a\u003e.\u003c/dt\u003e\n\u003cdt\u003eContinue to Eradication and recovery - Step 3: Reset compromised users\u003c/dt\u003e"
                                        },
                                        "Compose_-_Eradication_and_recovery_-_S3_-_Reset_compromised_users":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Eradication_and_recovery_-_S2_-_Add_indicators":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e\u003cb\u003eReset the passwords of any known compromised user accounts and require a new sign-in.\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e�\tConsider resetting the passwords for any privileged account with broad administrative authority, such as the members of the Domain Admins group.\u003c/dt\u003e\n\u003cdt\u003e�\tIf a user account might have been created by an attacker, disable the account. Do not delete the account unless there are no plans to perform security forensics for the incident.\u003cbr\u003e\u003c/dt\u003e\n\u003cdt\u003e\u003ca target='_blank' href='https://learn.microsoft.com/azure/sentinel/respond-threats-during-investigation'\u003eRespond to threat actors while investigating or threat hunting in Microsoft Sentinel\u003c/a\u003e\u003c/dt\u003e\n\u003cdt\u003eContinue to Eradication and recovery - Step 4: Isolate attacker control points\u003c/dt\u003e"
                                        },
                                        "Compose_-_Eradication_and_recovery_-_S4_-_Isolate_attacker_control_points":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Eradication_and_recovery_-_S3_-_Reset_compromised_users":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e\u003cb\u003eIsolate any known attacker control points inside the enterprise from the Internet.\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e\u003ca target='_blank' href='https://learn.microsoft.com/azure/sentinel/respond-threats-during-investigation'\u003eRespond to threat actors while investigating or threat hunting in Microsoft Sentinel\u003c/a\u003e\u003c/dt\u003e\n\u003cdt\u003eContinue to Eradication and recovery - Step 5: Remove the malware\u003c/dt\u003e"
                                        },
                                        "Compose_-_Eradication_and_recovery_-_S5_-_Remove_the_malware":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Eradication_and_recovery_-_S4_-_Isolate_attacker_control":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e\u003cb\u003eRemove the malware from the affected devices.\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e�\tRun a full, \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/respond-machine-alerts?view=o365-worldwide#run-microsoft-defender-antivirus-scan-on-devices\"\u003ecurrent antivirus scan\u003c/a\u003e on all suspected computers and devices to detect and remove the payload that is associated with the ransomware.\u003c/dt\u003e\n\u003cdt\u003e�\tDo not forget to scan devices that synchronize data or the targets of mapped network drives.\u003c/dt\u003e\n\u003cdt\u003eContinue to Eradication and recovery - Step 6: Recover files on a cleaned device\u003c/dt\u003e"
                                        },
                                        "Compose_-_Eradication_and_recovery_-_S6_-_Recover_files_on_a_cleaned_device":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Eradication_and_recovery_-_S5_-_Remove_the_malware":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e\u003cb\u003eRecover files on a cleaned device.\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e�\tYou can use \u003ca target='_blank' href=\"https://support.microsoft.com/help/17128\"\u003eFile History\u003c/a\u003e in Windows 11, Windows 10, Windows 8.1, and System Protection in Windows 7 to attempt to recover your local files and folders.\u003c/dt\u003e\n\u003cdt\u003eContinue to Eradication and recovery - Step 7: Recover files in OneDrive for Business\u003c/dt\u003e"
                                        },
                                        "Compose_-_Eradication_and_recovery_-_S7_-_Recover_files_in_OneDrive_for_Business":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Eradication_and_recovery_-_S6_-_Recover_files_on_a_clean":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e\u003cb\u003eRecover files in OneDrive for Business.\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e�\tFiles Restore in OneDrive for Business allows you to restore an entire OneDrive to a previous point in time within the last 30 days. For more information, see \u003ca target='_blank' href=\"https://support.microsoft.com/office/restore-your-onedrive-fa231298-759d-41cf-bcd0-25ac53eb8a15\"\u003eRestore your OneDrive\u003c/a\u003e.\u003c/dt\u003e\n\u003cdt\u003eContinue to Eradication and recovery - Step 8: Recover deleted email\u003c/dt\u003e"
                                        },
                                        "Compose_-_Eradication_and_recovery_-_S8_-_Recover_deleted_email":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Eradication_and_recovery_-_S7_-_Recover_files_in_OneDrive":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eIn the rare case that the ransomware deleted all your email, you can probably recover the deleted items. See \u003ca target='_blank' href=\"https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages\"\u003eRecover deleted messages in a user's mailbox in Exchange Online\u003c/a\u003e.\u003c/dt\u003e\n\u003cdt\u003eContinue to Eradication and recovery - Step 9: Re-enable Exchange ActiveSync and OneDrive Sync\u003c/dt\u003e"
                                        },
                                        "Compose_-_Eradication_and_recovery_-_S9_-_Re-enable_Exchange_ActiveSync":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Eradication_and_recovery_-_S8_-_Recover_deleted_email":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eAfter you have cleaned your computers and devices and recovered the data, you can re-enable Exchange ActiveSync and OneDrive sync that you previously disabled in step 3 of containment.\u003c/dt\u003e"
                                        }
                                    },
                                    "runAfter":  {
                                        "Scope_Investigation":  [
                                            "Succeeded"
                                        ]
                                    },
                                    "type":  "Scope"
                                },
                                "Scope_HumOR":  {
                                    "actions":  {
                                        "Add_task_to_incident_-_HumOR":  {
                                            "runAfter":  {
                                                "Compose_-_HumOR":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_HumOR')}\u003c/p\u003e",
                                                    "taskTitle":  "More data about Human-operated ransomware"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Compose_-_HumOR":  {
                                            "runAfter":  {
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eYou can get detailed information regards ransomware in \u003ca target='_blank' href=\"https://docs.microsoft.com/security/compass/human-operated-ransomware\"\u003eHuman-operated ransomware\u003c/a\u003e, as Microsoft best practices.\u003c/dt\u003e"
                                        },
                                        "Mark_a_task_as_completed_-_HumOR":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_HumOR":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "taskArmId":  "@body('Add_task_to_incident_-_HumOR')?['id']"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CompleteTask"
                                            }
                                        }
                                    },
                                    "runAfter":  {
                                        "Scope_Prevention":  [
                                            "Succeeded"
                                        ]
                                    },
                                    "type":  "Scope"
                                },
                                "Scope_Introduction":  {
                                    "actions":  {
                                        "Add_task_to_incident_-_Introduction":  {
                                            "runAfter":  {
                                                "Compose_-_Introduction":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Introduction')}\u003c/p\u003e",
                                                    "taskTitle":  "Introduction"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Compose_-_Introduction":  {
                                            "runAfter":  {
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eWhen you suspect you were or are currently under a ransomware attack, establish secure communications with your incident response team immediately. They can perform the following response phases to disrupt the attack and mitigate the damage:\u003c/dt\u003e\n\u003cdt\u003eNOTE: For information about preventing ransomware attacks, see \u003ca target='_blank' href=\"https://docs.microsoft.com/security/compass/protect-against-ransomware\"\u003eRapidly protect against ransomware and extortion\u003c/a\u003e.\u003c/dt\u003e\n\u003cdt\u003eClick on \"Containment - Step 1: Assess the scope of the incident\" task when you're ready to start.\u003c/dt\u003e"
                                        },
                                        "Mark_a_task_as_completed_-_Introduction":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Introduction":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "taskArmId":  "@body('Add_task_to_incident_-_Introduction')?['id']"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CompleteTask"
                                            }
                                        }
                                    },
                                    "runAfter":  {
                                    },
                                    "type":  "Scope"
                                },
                                "Scope_Investigation":  {
                                    "actions":  {
                                        "Add_task_to_incident_-_Investigate_-_Identify_the_line_of_business_(LOB)_apps":  {
                                            "runAfter":  {
                                                "Compose_-_Investigate_-_Identify_the_line_of_business_(LOB)_apps":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Investigate_-_Identify_the_line_of_business_(LOB)_apps')}\u003c/p\u003e",
                                                    "taskTitle":  "Investigate - Identify the line of business (LOB) apps that are unavailable due to the incident"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Investigation_-_Assess_the_current_situation":  {
                                            "runAfter":  {
                                                "Compose_-_Investigation_-_Assess_the_current_situation":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Investigation_-_Assess_the_current_situation')}\u003c/p\u003e",
                                                    "taskTitle":  "Investigation - Assess the current situation"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Investigation_-_Identify_the_ransomware_process":  {
                                            "runAfter":  {
                                                "Compose_-_Investigation_-_Identify_the_ransomware_process":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Investigation_-_Identify_the_ransomware_process')}\u003c/p\u003e",
                                                    "taskTitle":  "Investigation - Identify the ransomware process"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Investigation_-_Look_for_exposed_credentials_":  {
                                            "runAfter":  {
                                                "Compose_-_Investigation_-_Look_for_exposed_credentials_in_the_infected_machines":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Investigation_-_Look_for_exposed_credentials_in_the_infected_machines')}\u003c/p\u003e",
                                                    "taskTitle":  "Investigation - Look for exposed credentials in the infected machines"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Compose_-_Investigate_-_Identify_the_line_of_business_(LOB)_apps":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Investigation_-_Look_for_exposed_credentials_":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e\u003cb\u003e�\tDoes the app require an identity?\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\tHow is authentication performed?\u003c/dd\u003e\n\u003cdd\u003eo\tHow are credentials such as certificates or secrets stored and managed?\u003c/dd\u003e\n\u003cdt\u003e\u003cb\u003e�\tAre evaluated backups of the application, its configuration, and its data available?\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e\u003cb\u003e�\tDetermine your compromise recovery process.\u003c/b\u003e\u003c/dt\u003e"
                                        },
                                        "Compose_-_Investigation_-_Assess_the_current_situation":  {
                                            "runAfter":  {
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e\u003cb\u003e�\tWhat initially made you aware of the ransomware attack?\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\tIf IT staff identified the initial threat�such as noticing backups being deleted, antivirus alerts, endpoint detection and response (EDR) alerts, or suspicious system changes�it is often possible to take quick decisive measures to thwart the attack, typically by the containment actions described in this article.\u003c/dd\u003e\n\u003cdt\u003e\u003cb\u003e�\tWhat date and time did you first learn of the incident?\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\tWhat system and security updates were not installed on devices on that date? This is important to understand what vulnerabilities might have been leveraged so they can be addressed on other devices.\u003c/dd\u003e\n\u003cdd\u003eo\tWhat user accounts were used on that date?\u003c/dd\u003e\n\u003cdd\u003eo\tWhat new user accounts were created since that date?\u003c/dd\u003e\n\u003cdd\u003eo\tWhat programs were added to automatically start around the time that the incident occurred?\u003c/dd\u003e\n\u003cdt\u003e\u003cb\u003e�\tIs there any indication that the attacker is currently accessing systems?\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\tAre there any suspected compromised systems that are experiencing unusual activity?\u003c/dd\u003e\n\u003cdd\u003eo\tAre there any suspected compromised accounts that appear to be actively used by the adversary?\u003c/dd\u003e\n\u003cdd\u003eo\tIs there any evidence of active command-and-control (C2) servers in EDR, firewall, VPN, web proxy, and other logs?\u003c/dd\u003e"
                                        },
                                        "Compose_-_Investigation_-_Identify_the_ransomware_process":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Investigation_-_Assess_the_current_situation":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eUsing advanced hunting, search for this process in the process creation events on other devices.  \u003ca target='_blank' href=\"https://sip.security.microsoft.com/hunting?query=H4sIAAAAAAAEAJVSTUvDUBCcs-B_eIQeFPw8iHgQLKJQKOLBm1qIaZJGkyY0aSpW_7uz85Iq2Is8aOftm53dnc0QOWIs0GCEORKU2MUOPuGwwkwvMfEDMjJy4UsehwC3jPnIlKwSFU9M7BBSyf5zoiVxJCWLJGIWRKZbEDdSyIkishtqlswINl288p4x4jDcdHqDlrEpb6Zt-aUYAzESMo5-sUeq7LseMJIhZT9_OVbxmMdhTL0Sb6qbquuSLEeexXPUxPbW6tZ2s_kuq26muWYJ-W7-ZMxpVPuFjvRTWt-JvDDHajmzIjZvtm2hd_yOnEKRGVHNmgvNneFdm6kYi4ljYtf1vrclu5Djfjt1t5NUmQ5XzJ0w65GcQ3zghL8XeMY-1jjHF57on68xUJV-5_-rElC_V17jFAc4o3bAKja_7_xe30yk7BrXcqno6o3l-o8TphiSa-xKe1jqKwzwDd6nLz7oAgAA\u0026runQuery=true\u0026timeRangeId=month\"\u003eRun query in Advanced hunting\u003c/a\u003e.\u003c/dt\u003e\n\u003cdt\u003eYou can use also \u003ca target='_blank' href=\"https://learn.microsoft.com/azure/azure-monitor/reference/tables/deviceprocessevents\"\u003eDeviceProcessEvents table in Microsoft Sentinel Logs\u003c/a\u003e or in \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender/advanced-hunting-deviceprocessevents-table?view=o365-worldwide\"\u003eMicrosoft 365 Defender advanced hunting\u003c/a\u003e.\u003c/dt\u003e"
                                        },
                                        "Compose_-_Investigation_-_Look_for_exposed_credentials_in_the_infected_machines":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Investigation_-_Identify_the_ransomware_process":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e\u003cb\u003e�\tFor user accounts whose credentials were potentially compromised, reset the account passwords, and require the users to sign in again.\u003c/b\u003e\u003c/dt\u003e\n\u003cdt\u003e\u003cb\u003e�\tThe following IOAs might indicate lateral movement:\u003c/b\u003e\u003c/dt\u003e\n\u003cdd\u003eo\tSuspiciousExploratoryCommands\u003c/dd\u003e\n\u003cdd\u003eo\tMLFileBasedAlert\u003c/dd\u003e\n\u003cdd\u003eo\tIfeoDebuggerPersistence\u003c/dd\u003e\n\u003cdd\u003eo\tSuspiciousRemoteFileDropAndExecution\u003c/dd\u003e\n\u003cdd\u003eo\tExploratoryWindowsCommands\u003c/dd\u003e\n\u003cdd\u003eo\tIoaStickyKeys\u003c/dd\u003e\n\u003cdd\u003eo\tMimikatz Defender Amplifier\u003c/dd\u003e\n\u003cdd\u003eo\tNetwork scanning tool used by PARINACOTA\u003c/dd\u003e\n\u003cdd\u003eo\tDefenderServerAlertMSSQLServer\u003c/dd\u003e\n\u003cdd\u003eo\tSuspiciousLowReputationFileDrop\u003c/dd\u003e\n\u003cdd\u003eo\tSuspiciousServiceExecution\u003c/dd\u003e\n\u003cdd\u003eo\tAdminUserAddition\u003c/dd\u003e\n\u003cdd\u003eo\tMimikatzArtifactsDetector\u003c/dd\u003e\n\u003cdd\u003eo\tScuba-WdigestEnabledToAccessCredentials\u003c/dd\u003e\n\u003cdd\u003eo\tDefenderMalware\u003c/dd\u003e\n\u003cdd\u003eo\tMLSuspCmdBehavior\u003c/dd\u003e\n\u003cdd\u003eo\tMLSuspiciousRemoteInvocation\u003c/dd\u003e\n\u003cdd\u003eo\tSuspiciousRemoteComponentInvocation\u003c/dd\u003e\n\u003cdd\u003eo\tSuspiciousWmiProcessCreation\u003c/dd\u003e\n\u003cdd\u003eo\tMLCmdBasedWithRemoting\u003c/dd\u003e\n\u003cdd\u003eo\tProcess Accesses Lsass\u003c/dd\u003e\n\u003cdd\u003eo\tSuspicious Rundll32 Process Execution\u003c/dd\u003e\n\u003cdd\u003eo\tBitsAdmin\u003c/dd\u003e\n\u003cdd\u003eo\tDefenderCobaltStrikeDetection\u003c/dd\u003e\n\u003cdd\u003eo\tDefenderHacktool\u003c/dd\u003e\n\u003cdd\u003eo\tIoaSuspPSCommandline\u003c/dd\u003e\n\u003cdd\u003eo\tMetasploit\u003c/dd\u003e\n\u003cdd\u003eo\tMLSuspToolBehavior\u003c/dd\u003e\n\u003cdd\u003eo\tRegistryQueryForPasswords\u003c/dd\u003e\n\u003cdd\u003eo\tSuspiciousWdavExclusion\u003c/dd\u003e\n\u003cdd\u003eo\tASEPRegKey\u003c/dd\u003e\n\u003cdd\u003eo\tCobaltStrikeExecutionDetection\u003c/dd\u003e\n\u003cdd\u003eo\tDefenderBackdoor\u003c/dd\u003e\n\u003cdd\u003eo\tDefenderBehaviorSuspiciousActivity\u003c/dd\u003e\n\u003cdd\u003eo\tDefenderMalwareExecuted\u003c/dd\u003e\n\u003cdd\u003eo\tDefenderServerAlertDomainController\u003c/dd\u003e\n\u003cdd\u003eo\tDupTokenPrivilegeEscalationDetector\u003c/dd\u003e\n\u003cdd\u003eo\tFakeWindowsBinary\u003c/dd\u003e\n\u003cdd\u003eo\tIoaMaliciousCmdlets\u003c/dd\u003e\n\u003cdd\u003eo\tLivingOffTheLandBinary\u003c/dd\u003e\n\u003cdd\u003eo\tMicrosoftSignedBinaryAbuse\u003c/dd\u003e\n\u003cdd\u003eo\tMicrosoftSignedBinaryScriptletAbuse\u003c/dd\u003e\n\u003cdd\u003eo\tMLFileBasedWithRemoting\u003c/dd\u003e\n\u003cdd\u003eo\tMLSuspSvchostBehavior\u003c/dd\u003e\n\u003cdd\u003eo\tReadSensitiveMemory\u003c/dd\u003e\n\u003cdd\u003eo\tRemoteCodeInjection-IREnabled\u003c/dd\u003e\n\u003cdd\u003eo\tScuba-EchoSeenOverPipeOnLocalhost\u003c/dd\u003e\n\u003cdd\u003eo\tScuba-SuspiciousWebScriptFileDrop\u003c/dd\u003e\n\u003cdd\u003eo\tSuspicious DLL registration by odbcconf\u003c/dd\u003e\n\u003cdd\u003eo\tSuspicious DPAPI Activity\u003c/dd\u003e\n\u003cdd\u003eo\tSuspicious Exchange Process Execution\u003c/dd\u003e\n\u003cdd\u003eo\tSuspicious scheduled task launch\u003c/dd\u003e\n\u003cdd\u003eo\tSuspiciousLdapQueryDetector\u003c/dd\u003e\n\u003cdd\u003eo\tSuspiciousScheduledTaskRegistration\u003c/dd\u003e\n\u003cdd\u003eo\tUntrusted application opens a RDP connection\u003c/dd\u003e"
                                        }
                                    },
                                    "runAfter":  {
                                        "Scope_Containment":  [
                                            "Succeeded"
                                        ]
                                    },
                                    "type":  "Scope"
                                },
                                "Scope_Prevention":  {
                                    "actions":  {
                                        "Add_task_to_incident_-_Prevention_-_Device_protection_-_Part_1":  {
                                            "runAfter":  {
                                                "Compose_-_Prevention_-_Device_protection_-_Part_1":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Prevention_-_Device_protection_-_Part_1')}\u003c/p\u003e",
                                                    "taskTitle":  "Prevention - Device protection: Part 1"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Prevention_-_Device_protection_-_Part_2":  {
                                            "runAfter":  {
                                                "Compose_-_Prevention_-_Device_protection_-_Part_2":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Prevention_-_Device_protection_-_Part_2')}\u003c/p\u003e",
                                                    "taskTitle":  "Prevention - Device protection: Part 2"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Prevention_-_Email_management":  {
                                            "runAfter":  {
                                                "Compose_-_Prevention_-_Email_management":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Prevention_-_Email_management')}\u003c/p\u003e",
                                                    "taskTitle":  "Prevention - Email management"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Prevention_-_Identity_protection":  {
                                            "runAfter":  {
                                                "Compose_-_Prevention_-_Identity_protection":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Prevention_-_Identity_protection')}\u003c/p\u003e",
                                                    "taskTitle":  "Prevention - Identity protection"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Prevention_-_Information_protection":  {
                                            "runAfter":  {
                                                "Compose_-_Prevention_-_Information_protection":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Prevention_-_Information_protection')}\u003c/p\u003e",
                                                    "taskTitle":  "Prevention - Information protection"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Add_task_to_incident_-_Prevention_-_Vulnerability_management":  {
                                            "runAfter":  {
                                                "Compose_-_Prevention_-_Vulnerability_management":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "ApiConnection",
                                            "inputs":  {
                                                "body":  {
                                                    "incidentArmId":  "@triggerBody()?['object']?['id']",
                                                    "taskDescription":  "\u003cp\u003e@{outputs('Compose_-_Prevention_-_Vulnerability_management')}\u003c/p\u003e",
                                                    "taskTitle":  "Prevention - Vulnerability management"
                                                },
                                                "host":  {
                                                    "connection":  {
                                                        "name":  "@parameters('$connections')['microsoftsentinel']['connectionId']"
                                                    }
                                                },
                                                "method":  "post",
                                                "path":  "/Incidents/CreateTask"
                                            }
                                        },
                                        "Compose_-_Prevention_-_Device_protection_-_Part_1":  {
                                            "runAfter":  {
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003eThe full list of prevention actions can be found in the \u003ca target='_blank' href=\"https://security.microsoft.com/threatanalytics3/05658b6c-dc62-496d-ad3c-c6a795a33c27/analystreport\"\u003eransomware threat analytics report\u003c/a\u003e, and in \u003ca target='_blank' href=\"https://docs.microsoft.com/security/compass/protect-against-ransomware\"\u003eRapidly protect against ransomware and extortion | Microsoft Docs\u003c/a\u003e\u003c/dt\u003e\n\u003cdt\u003e�\tTurn on Microsoft Defender Antivirus. (Execution)\u003c/dt\u003e\n\u003cdt\u003e�\tTurn on Microsoft Defender Firewall. (Lateral movement)\u003c/dt\u003e\n\u003cdt\u003e�\tUse \u003ca target='_blank' href=\"https://docs.microsoft.com/Microsoft-365/security/defender-endpoint/attack-surface-reduction?view=o365-germany#use-advanced-protection-againsttarget='_blank' -ransomware\"\u003eadvanced protection\u003c/a\u003e against ransomware. (Impact)\u003c/dt\u003e\n\u003cdt\u003e�\tEnable \u003ca href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/network-protection?view=o365-worldwide\"\u003eNetwork Protection\u003c/a\u003e in Microsoft Defender for Endpoint and Microsoft 365 Defender. (Initial access)\u003c/dt\u003e\n\u003cdt\u003e�\tKeep \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/enable-cloud-protection-microsoft-defender-antivirus\"\u003ecloud-delivered protection\u003c/a\u003e in Microsoft Defender Antivirus turned on. (Defense evasion)\u003c/dt\u003e\n\u003cdt\u003e�\tKeep Microsoft Defender Antivirus \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/configure-real-time-protection-microsoft-defender-antivirus\"\u003ereal-time behavior monitoring\u003c/a\u003e turned on. (Defense evasion)\u003c/dt\u003e\n\u003cdt\u003e�\tTurn on \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/configure-real-time-protection-microsoft-defender-antivirus\"\u003ereal-time protection\u003c/a\u003e. (Defense evasion)\u003c/dt\u003e\n\u003cdt\u003e�\tTurn on \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection?view=o365-worldwide\"\u003etamper protection\u003c/a\u003e in Microsoft Defender for Endpoint, to prevent malicious changes to security settings. (Defense evasion)\u003c/dt\u003e\n\u003cdt\u003e�\tUpdate Microsoft Defender Antivirus definitions. (Lateral movement)\u003c/dt\u003e\n"
                                        },
                                        "Compose_-_Prevention_-_Device_protection_-_Part_2":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Prevention_-_Device_protection_-_Part_1":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e�\tConfigure \u003ca target='_blank' href=\"https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-smartscreen/microsoft-defender-smartscreen-available-settings\"\u003esite and download checking\u003c/a\u003e in Microsoft Defender SmartScreen to block or warn. (Initial access)\u003c/dt\u003e\n\u003cdt\u003e�\tConfigure \u003ca target='_blank' href=\"https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-smartscreen/microsoft-defender-smartscreen-available-settings\"\u003eapp and file checking\u003c/a\u003e in Microsoft Defender SmartScreen to block or warn. (Initial access)\u003c/dt\u003e\n\u003cdt\u003e�\tEnable \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/configure-advanced-scan-types-microsoft-defender-antivirus?view=o365-worldwide\"\u003eMicrosoft Defender Antivirus scanning\u003c/a\u003e of downloaded files and attachments. (Initial access)\u003c/dt\u003e\n\u003cdt\u003e�\tBlock Win32 API calls from Office macros. (Execution)\u003c/dt\u003e\n\u003cdt\u003e�\tMigrate all legacy workbooks requiring Excel 4.0 macros to the updated VBA macro format using \u003ca target='_blank' href=\"https://www.microsoft.com/microsoft-365/blog/2010/02/16/migrating-excel-4-macros-to-vba/\"\u003ethis process\u003c/a\u003e. (Execution)\u003c/dt\u003e\n\u003cdt\u003e�\t\u003ca target='_blank' href=\"https://support.microsoft.com/topic/enable-or-disable-macros-in-office-files-12b036fd-d140-4e74-b45e-16fed1a7e5c6\"\u003eDisable use of unsigned macros\u003ca/\u003e. Ensure all internal macros with business need are signed and leveraging \u003ca target='_blank' href=\"https://docs.microsoft.com/deployoffice/security/designate-trusted-locations-for-files-in-office\"\u003etrusted locations\u003c/a\u003e to ensure unknown macros will not run in your environment. (Execution)\u003c/dt\u003e\n\u003cdt\u003e�\tStop malicious XLM or VBA macros by ensuring runtime macro scanning by Antimalware Scan Interface (\u003ca target='_blank' href=\"https://www.microsoft.com/security/blog/2021/03/03/xlm-amsi-new-runtime-defense-against-excel-4-0-macro-malware/\"\u003eAMSI\u003c/a\u003e) is on. This feature�enabled by default�is on if the Group Policy setting for Macro Run Time Scan Scope is set to Enable for All Files or Enable for Low Trust Files. Get the \u003ca target='_blank' href=\"https://www.microsoft.com/download/details.aspx?id=49030\"\u003elatest group policy template files\u003c/a\u003e. (Execution)\u003c/dt\u003e\n\u003cdt\u003e�\tSet Remote Desktop security level to TLS in Microsoft Defender for Endpoint and Microsoft 365 Defender. (Initial access)\u003c/dt\u003e"
                                        },
                                        "Compose_-_Prevention_-_Email_management":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Prevention_-_Information_protection":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e�\tEnable Microsoft Defender Antivirus email scanning. (Initial access)\u003c/dt\u003e\n\u003cdt\u003e�\tUse Microsoft Defender for Office 365 for \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/office-365-security/anti-phishing-protection\"\u003eenhanced phishing protection\u003c/a\u003e and coverage against new threats and polymorphic variants. (Initial access)\u003c/dt\u003e\n\u003cdt\u003e�\tCheck your Office 365 email filtering settings to ensure you block spoofed emails, spam, and emails with malware. Use \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/office-365-security/office-365-atp\"\u003eMicrosoft Defender for Office 365\u003c/a\u003e for enhanced phishing protection and coverage against new threats and polymorphic variants. Configure Microsoft Defender for Office 365 to \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/office-365-security/atp-safe-links\"\u003erecheck links on click\u003c/a\u003e and \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/office-365-security/zero-hour-auto-purge\"\u003edelete delivered mails\u003c/a\u003e in response to newly acquired threat intelligence. (Initial access)\u003c/dt\u003e\n\u003cdt\u003e�\tReview and update to the latest?\u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/office-365-security/recommended-settings-for-eop-and-office365-atp\"\u003erecommended settings for EOP and Microsoft Defender for Office 365 security\u003ca/\u003e. (Initial access)\u003c/dt\u003e\n\u003cdt\u003e�\tConfigure Microsoft Defender for Office 365 to \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/office-365-security/set-up-safe-links-policies\"\u003erecheck links on click\u003c/a\u003e and delete delivered mails in response to newly acquired threat intelligence. (Initial access)\u003c/dt\u003e"
                                        },
                                        "Compose_-_Prevention_-_Identity_protection":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Prevention_-_Device_protection_-_Part_2":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e�\tIncrease password security by:\u003c/dt\u003e\n\u003cdd\u003eo\tUsing \u003ca target='_blank' href=\"https://docs.microsoft.com/azure/active-directory/authentication/concept-password-ban-bad\"\u003eAzure AD Identity Protection\u003c/a\u003e to prevent and detect attacks and extend blocking of known weak passwords to on-premises Active Directory\u003c/dd\u003e\n\u003cdd\u003eo\t\u003ca target='_blank' href=\"https://docs.microsoft.com/azure/active-directory/authentication/concept-password-ban-bad-on-premises\"\u003eExtending Azure AD Password Protection\u003c/a\u003e to on-premises active directory\u003c/dd\u003e\n\u003cdt\u003e�\tEnforce strong multi-factor authentication (MFA) or passwordless logon for all users starting with administrators by using one or more of:\u003c/dt\u003e\n\u003cdd\u003eo\tPasswordless authentication with \u003ca target='_blank' href=\"https://docs.microsoft.com/windows/security/identity-protection/hello-for-business/hello-identity-verification\"\u003eWindows Hello\u003c/a\u003e or \u003ca target='_blank' href=\"https://docs.microsoft.com/azure/active-directory/authentication/howto-authentication-phone-sign-in\"\u003eMicrosoft Authenticator app\u003c/a\u003e\u003c/dd\u003e\n\u003cdd\u003eo\t\u003ca target='_blank' href=\"https://docs.microsoft.com/azure/active-directory/authentication/howto-mfa-userstates\"\u003eAzure Multi-Factor Authentication\u003c/a\u003e\u003c/dd\u003e\n\u003cdd\u003eo\tThird-party MFA solutions\u003c/dd\u003e\n\u003cdt\u003e�\tPractice the principle of least-privilege and maintain credential hygiene. Avoid the use of domain-wide, admin-level service accounts. Restricting local administrative privileges can help limit installation of RATs and other unwanted applications. (Privilege escalation)\u003c/dt\u003e\n\u003cdt\u003e�\tEnforce end-to-end session security. Explicitly validate the trust of users and workstations before allowing access to administrative interfaces using \u003ca target='_blank' href=\"https://docs.microsoft.com/azure/active-directory/conditional-access/overview\"\u003eAzure AD Conditional Access\u003c/a\u003e.\u003c/dt\u003e\n\u003cdt\u003e�\tEnable Local Admin password management (Privilege escalation)\u003c/dt\u003e\n\u003cdt\u003e�\tDetermine where highly privileged accounts are logging on and exposing credentials. Highly privileged accounts should not be present on workstations. (Privilege escalation)\u003c/dt\u003e\n\u003cdt\u003e�\tDisable the local storage of passwords and credentials. (Privilege escalation)\u003c/dt\u003e"
                                        },
                                        "Compose_-_Prevention_-_Information_protection":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Prevention_-_Identity_protection":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e�\tImplement \u003ca target='_blank' href=\"https://support.microsoft.com/topic/ransomware-protection-in-windows-security-445039d6-537a-488a-ad53-48906f346363\"\u003econtrolled folder access\u003c/a\u003e to help prevent files from being altered or encrypted by ransomware. (Impact)\u003c/dt\u003e\n\u003cdd\u003eo\t\u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/security/defender-endpoint/enable-controlled-folders?view=o365-worldwide\"\u003eSet controlled folder access to Enabled or Audit mode\u003c/a\u003e.\u003c/dd\u003e\n\u003cdt\u003e�\tBack up important files regularly. Use the 3-2-1 rule. Keep three backups of your data, on two different storage types, and at least one backup offsite. (Impact)\u003c/dt\u003e\n\u003cdt\u003e�\tUse \u003ca target='_blank' href=\"https://www.microsoft.com/microsoft-365/onedrive/onedrive-for-business\"\u003eOneDrive cloud storage\u003c/a\u003e to protect and back up your files. (Impact)\u003c/dt\u003e"
                                        },
                                        "Compose_-_Prevention_-_Vulnerability_management":  {
                                            "runAfter":  {
                                                "Add_task_to_incident_-_Prevention_-_Email_management":  [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type":  "Compose",
                                            "inputs":  "\u003cdt\u003e�\tEnable \u003ca target='_blank' href=\"https://docs.microsoft.com/deployoffice/configure-update-settings-microsoft-365-apps\"\u003eAutomatic Updates\u003c/a\u003e. (Defense evasion)\u003c/dt\u003e\n\u003cdt\u003e�\tEnsure internet-facing assets have the latest security updates. \u003ca target='_blank' href=\"https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance\"\u003eAudit\u003c/a\u003e these assets regularly for suspicious activity. (Initial access)\u003c/dt\u003e"
                                        }
                                    },
                                    "runAfter":  {
                                        "Scope_Eradication_and_recovery":  [
                                            "Succeeded"
                                        ]
                                    },
                                    "type":  "Scope"
                                }
                            },
                            "runAfter":  {
                                "For_each_-_alert":  [
                                    "Succeeded"
                                ]
                            },
                            "expression":  {
                                "and":  [
                                    {
                                        "greater":  [
                                            "@length(variables('Alert title'))",
                                            0
                                        ]
                                    }
                                ]
                            },
                            "type":  "If"
                        },
                        "For_each_-_alert":  {
                            "foreach":  "@triggerBody()?['object']?['properties']?['Alerts']",
                            "actions":  {
                                "Condition":  {
                                    "actions":  {
                                        "Append_to_array_variable":  {
                                            "runAfter":  {
                                            },
                                            "type":  "AppendToArrayVariable",
                                            "inputs":  {
                                                "name":  "Alert title",
                                                "value":  "@items('For_each_-_alert')?['properties']?['alertDisplayName']"
                                            }
                                        }
                                    },
                                    "runAfter":  {
                                    },
                                    "expression":  {
                                        "or":  [
                                            {
                                                "contains":  [
                                                    "@items('For_each_-_alert')?['properties']?['alertDisplayName']",
                                                    "ransomware"
                                                ]
                                            },
                                            {
                                                "contains":  [
                                                    "@items('For_each_-_alert')?['properties']?['alertDisplayName']",
                                                    "Ransomware"
                                                ]
                                            }
                                        ]
                                    },
                                    "type":  "If"
                                }
                            },
                            "runAfter":  {
                                "Initialize_variable_-_Alert_title":  [
                                    "Succeeded"
                                ]
                            },
                            "type":  "Foreach"
                        },
                        "Initialize_variable_-_Alert_title":  {
                            "runAfter":  {
                            },
                            "type":  "InitializeVariable",
                            "inputs":  {
                                "variables":  [
                                    {
                                        "name":  "Alert title",
                                        "type":  "array"
                                    }
                                ]
                            }
                        }
                    },
                    "outputs":  {
                    }
                },
                "parameters":  {
                    "$connections":  {
                        "value":  {
                            "microsoftsentinel":  {
                                "connectionId":  "[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                                "connectionName":  "[variables('MicrosoftSentinelConnectionName')]",
                                "id":  "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', resourceGroup().location, '/managedApis/azuresentinel')]",
                                "connectionProperties":  {
                                    "authentication":  {
                                        "type":  "ManagedServiceIdentity"
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "name":  "[parameters('PlaybookName')]",
            "type":  "Microsoft.Logic/workflows",
            "location":  "[resourceGroup().location]",
            "tags":  {
                "hidden-SentinelTemplateName":  "M365D_Ransomware_Playbook_for_SecOps-Tasks",
                "hidden-SentinelTemplateVersion":  "1.0"
            },
            "identity":  {
                "type":  "SystemAssigned"
            },
            "apiVersion":  "2017-07-01",
            "dependsOn":  [
                "[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]"
            ]
        },
        {
            "type":  "Microsoft.Web/connections",
            "apiVersion":  "2016-06-01",
            "name":  "[variables('MicrosoftSentinelConnectionName')]",
            "location":  "[resourceGroup().location]",
            "kind":  "V1",
            "properties":  {
                "displayName":  "[variables('MicrosoftSentinelConnectionName')]",
                "customParameterValues":  {
                },
                "parameterValueType":  "Alternative",
                "api":  {
                    "id":  "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', resourceGroup().location, '/managedApis/azuresentinel')]"
                }
            }
        }
    ]
}
