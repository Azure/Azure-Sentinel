{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for Fortinet FortiGate Next-Generation Firewall connector for Microsoft Sentinel"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "FortiGate",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "Fortinet FortiGate Next-Generation Firewall connector for Microsoft Sentinel",
    "_solutionVersion": "3.0.7",
    "solutionId": "azuresentinel.azure-sentinel-solution-fortinetfortigate",
    "_solutionId": "[variables('solutionId')]",
    "FortinetFortigateFunctionApp": "FortinetFortigateFunctionApp",
    "_FortinetFortigateFunctionApp": "[variables('FortinetFortigateFunctionApp')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "FortinetFortigateFunctionApp",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-fa-',uniquestring(variables('_playbookContentId1'))))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','fa','-', uniqueString(concat(variables('_solutionId'),'-','AzureFunction','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "FortinetCustomConnector": "FortinetCustomConnector",
    "_FortinetCustomConnector": "[variables('FortinetCustomConnector')]",
    "TemplateEmptyArray": "[json('[]')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "FortinetCustomConnector",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','lc','-', uniqueString(concat(variables('_solutionId'),'-','LogicAppsCustomConnector','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "blanks": "[replace('b', 'b', '')]",
    "Fortinet_IncidentEnrichment": "Fortinet_IncidentEnrichment",
    "_Fortinet_IncidentEnrichment": "[variables('Fortinet_IncidentEnrichment')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "Fortinet_IncidentEnrichment",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "Fortinet_ResponseOnIP": "Fortinet_ResponseOnIP",
    "_Fortinet_ResponseOnIP": "[variables('Fortinet_ResponseOnIP')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "Fortinet_ResponseOnIP",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4'))))]",
    "_playbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId4'),'-', variables('playbookVersion4'))))]",
    "Fortinet_ResponseOnURL": "Fortinet_ResponseOnURL",
    "_Fortinet_ResponseOnURL": "[variables('Fortinet_ResponseOnURL')]",
    "playbookVersion5": "1.0",
    "playbookContentId5": "Fortinet_ResponseOnURL",
    "_playbookContentId5": "[variables('playbookContentId5')]",
    "playbookId5": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId5'))]",
    "playbookTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId5'))))]",
    "_playbookcontentProductId5": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId5'),'-', variables('playbookVersion5'))))]",
    "workbookVersion1": "1.1.0",
    "workbookContentId1": "FortigateWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "FortinetFortigateFunctionApp Playbook with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "FunctionAppName": {
              "type": "string",
              "defaultValue": "FortinetFortigateFunctionApp",
              "metadata": {
                "description": "Function App name is global uniqueness should not contain any special symbol"
              }
            },
            "Secret Identifier of Keyvault": {
              "type": "securestring",
              "defaultValue": "",
              "metadata": {
                "description": "Enter API key for all Azure function."
              }
            },
            "service_EndPoint": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Enter endpoint URL"
              }
            },
            "User Identifier Name": {
              "type": "string",
              "defaultValue": "fortinetuseridentity",
              "metadata": {
                "description": "User Identity"
              }
            },
            "location": {
              "type": "string",
              "minLength": 1,
              "defaultValue": "[concat('[resourceGroup().locatio', 'n]')]",
              "metadata": {
                "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
              }
            },
            "AppInsightsWorkspaceResourceID": {
              "type": "string",
              "metadata": {
                "description": "Migrate Classic Application Insights to Log Analytic Workspace which is retiring by 29 Febraury 2024. Use 'Log Analytic Workspace-->Properties' blade having 'Resource ID' property value. This is a fully qualified resourceId which is in format '/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName}'"
              }
            }
          },
          "variables": {
            "functionAppName": "[[parameters('FunctionAppName')]",
            "hostingPlanName": "[[parameters('FunctionAppName')]",
            "storageAccountName": "[[concat(uniquestring(resourceGroup().id), 'azfunctions')]",
            "StorageAccount": "Standard_LRS",
            "functionWorkerRuntime": "dotnet",
            "SecretIdentifierofKeyvault": "[[parameters('Secret Identifier of Keyvault')]",
            "appInsightsLocation": "[[parameters('location')]",
            "Endpoint": "[[parameters('service_EndPoint')]",
            "functionName": "Fortinet-GetEntityDetails",
            "UserIdentifier": "[[parameters('User Identifier Name')]",
            "applicationInsightsName": "Fortinet Fortigate Application Insights",
            "_applicationInsightsName": "[[variables('applicationInsightsName')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId1": "FortinetFortigateFunctionApp",
            "playbookId1": "[[resourceId('Microsoft.Logic/workflows', variables('playbookContentId1'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Storage/storageAccounts",
              "apiVersion": "2022-09-01",
              "name": "[[variables('storageAccountName')]",
              "location": "[[parameters('location')]",
              "sku": {
                "name": "[[variables('StorageAccount')]"
              },
              "kind": "Storage"
            },
            {
              "type": "Microsoft.Web/serverfarms",
              "apiVersion": "2020-06-01",
              "name": "[[variables('hostingPlanName')]",
              "location": "[[parameters('location')]",
              "sku": {
                "name": "Y1",
                "tier": "Dynamic"
              },
              "properties": {
                "name": "[[variables('hostingPlanName')]",
                "computeMode": "Dynamic"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2020-06-01",
              "name": "[[parameters('FunctionAppName')]",
              "location": "[[parameters('location')]",
              "kind": "functionapp",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/serverfarms', variables('hostingPlanName'))]",
                "[[resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName'))]"
              ],
              "properties": {
                "serverFarmId": "[[resourceId('Microsoft.Web/serverfarms', variables('hostingPlanName'))]",
                "siteConfig": {
                  "appSettings": [
                    {
                      "name": "AzureWebJobsStorage",
                      "value": "[[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageAccountName'), ';EndpointSuffix=', environment().suffixes.storage, ';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName')), '2023-04-01').keys[0].value)]"
                    },
                    {
                      "name": "WEBSITE_CONTENTAZUREFILECONNECTIONSTRING",
                      "value": "[[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageAccountName'), ';EndpointSuffix=', environment().suffixes.storage, ';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName')), '2023-04-01').keys[0].value)]"
                    },
                    {
                      "name": "WEBSITE_CONTENTSHARE",
                      "value": "[[toLower(variables('functionAppName'))]"
                    },
                    {
                      "name": "FUNCTIONS_EXTENSION_VERSION",
                      "value": "~2"
                    },
                    {
                      "name": "WEBSITE_NODE_DEFAULT_VERSION",
                      "value": "~10"
                    },
                    {
                      "name": "APPINSIGHTS_INSTRUMENTATIONKEY",
                      "value": "[[reference(resourceId('microsoft.insights/components', variables('_applicationInsightsName')), '2020-02-02').InstrumentationKey]"
                    },
                    {
                      "name": "FUNCTIONS_WORKER_RUNTIME",
                      "value": "[[variables('functionWorkerRuntime')]"
                    },
                    {
                      "name": "Authorization",
                      "value": "[[concat('@','Microsoft.KeyVault(SecretUri=',variables('SecretIdentifierofKeyvault'),')')]"
                    },
                    {
                      "name": "EndpointURL",
                      "value": "[[variables('Endpoint')]"
                    },
                    {
                      "name": "BaseURL",
                      "value": "/api/v2/cmdb/firewall/"
                    }
                  ]
                },
                "cors": {
                  "allowedOrigins": [
                    "https://functions.azure.com",
                    "https://functions-staging.azure.com",
                    "https://functions-next.azure.com"
                  ],
                  "supportCredentials": false
                }
              }
            },
            {
              "type": "microsoft.insights/components",
              "apiVersion": "2020-02-02",
              "name": "[[variables('_applicationInsightsName')]",
              "location": "[[variables('appInsightsLocation')]",
              "tags": {
                "[[concat('hidden-link:', resourceId('Microsoft.Web/sites', variables('_applicationInsightsName')))]": "Resource"
              },
              "properties": {
                "ApplicationId": "[[variables('_applicationInsightsName')]",
                "Request_Source": "IbizaWebAppExtensionCreate",
                "WorkspaceResourceId": "[[parameters('AppInsightsWorkspaceResourceID')]"
              }
            },
            {
              "apiVersion": "2019-08-01",
              "name": "[[concat(variables('FunctionappName'),'/', variables('functionName'))]",
              "type": "Microsoft.Web/sites/functions",
              "identity": {
                "type": "UserAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/serverfarms', variables('hostingPlanName'))]",
                "[[resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName'))]",
                "[[resourceId('Microsoft.Web/sites', variables('functionAppName'))]"
              ],
              "properties": {
                "config": {
                  "bindings": [
                    {
                      "name": "req",
                      "webHookType": "genericJson",
                      "direction": "in",
                      "type": "httpTrigger",
                      "authLevel": "anonymous"
                    },
                    {
                      "name": "res",
                      "direction": "out",
                      "type": "http"
                    }
                  ]
                },
                "files": {
                  "run.csx": "#r \"Newtonsoft.Json\"\r\n #r \"System.Net.Http\"\r\n using System.Net;\r\n using Microsoft.AspNetCore.Mvc;\r\n using Microsoft.Extensions.Primitives;\r\n using Newtonsoft.Json;\r\n using Newtonsoft.Json.Linq;\r\n public static async Task<IActionResult> Run(HttpRequest req, ILogger log)\r\n{\r\nlog.LogInformation(\"HTTP request recived.\");\r\n var entity = req.Query[\"entity\"];\r\nvar filter = req.Query[\"filter\"];\r\nvar key = Environment.GetEnvironmentVariable(\"Authorization\", EnvironmentVariableTarget.Process);\r\nvar endpointURL = Environment.GetEnvironmentVariable(\"EndpointURL\", EnvironmentVariableTarget.Process);\r\nvar baseURL = Environment.GetEnvironmentVariable(\"BaseURL\", EnvironmentVariableTarget.Process);\r\nJToken results = null;\r\nlog.LogInformation(filter);\r\nlog.LogInformation(entity);\r\nvar httpclient = new HttpClient();\r\nvar httpRequest = new HttpRequestMessage(HttpMethod.Get, new Uri(endpointURL + baseURL + entity + \"?\" + filter ));\r\nlog.LogInformation(httpRequest.RequestUri.ToString());\r\n if (key.StartsWith(\"Bearer\", StringComparison.InvariantCultureIgnoreCase)) {key = key.ToString() ;} else {key = \"Bearer \" + key.ToString();}\r\nhttpRequest.Headers.Add(\"Authorization\", key.ToString());\r\nvar response = httpclient.SendAsync(httpRequest).Result;\r\nvar responseJson = response.Content.ReadAsStringAsync().Result;\r\nif (responseJson != null)\r\n{\r\nJObject json = new JObject();\r\ndynamic obj = JsonConvert.DeserializeObject(responseJson);\r\njson = (JObject)obj;\r\nresults = json.SelectToken(\"results\");\r\nreturn new OkObjectResult(results);\r\n}\r\nreturn new OkObjectResult(results);\r\n}\r\n"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('AzureFunction-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "AzureFunction",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Fortinet FortiGate Next-Generation Firewall connector for Microsoft Sentinel",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Fortinet-FortiGate-FunctionApp",
            "description": "This function app connects to Fortinet service end point and fetch the details of the entities of the fortinet firewall.",
            "prerequisites": [
              "* Add new secret to the existing Key Vault (Create new if not exist) for Fortinet API key and capture the secret identifier of new key \n\n * Fortinet service end point should be known (ex: https://{yourVMIPorTrafficmanagername}/)"
            ],
            "lastUpdateTime": "2022-08-01T00:00:00Z",
            "postDeployment": [
              "* Create User Managed Identity in your subscription by following document. Refer this link [Create Managed Identity ](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal#create-a-user-assigned-managed-identity) \n\n * Assign role to user assigned identity. Refer this link [Assign role to user ](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal#assign-a-role-to-a-user-assigned-managed-identity) \n\n * Open created function app, follow below steps or refer steps documented [Function app setting](https://docs.microsoft.com/azure/logic-apps/logic-apps-azure-functions#enable-authentication-for-functions) \n\n - Go to Authentication / Authorization option \n\n - Enable App Service Authentication \n\n - Select 'Login with Microsoft Entra ID' for Action to take when request is not authenticated \n\n - Select Microsoft Entra ID as Authentication Providers \n\n - Select advanced option from the management mode and fill details \n\n - UserIdentity object id as client ID (ex: b1fd400b-e34b-40c0-996f506d8a98) \n\n - Issuer url (format should be https://sts.windows.net/<tenentID>), refer for to get tenentID [Get tenentID](https://ms.portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) \n\n - Allow token Audiences (ex: [parameters('AzureManagementLink')] \n\n - Click ok \n\n - Click on save \n\n * Open function app and go to Identify and capture the object ID [Capture Object ID](https://docs.microsoft.com/azure/app-service/overview-managed-identity?tabs=dotnet) \n\n * Add azure function app to key Vault access policy [Add access policy](https://docs.microsoft.com/azure/key-vault/general/assign-access-policy-portal)"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Fortinet-FortiGate-FunctionApp",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "AzureFunction",
        "displayName": "FortinetFortigateFunctionApp",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "FortinetCustomConnector Playbook with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "CustomConnectorName": {
              "defaultValue": "FortinetCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the Connector"
              }
            },
            "service_EndPoint": {
              "defaultValue": "https://{yourfortinetDomain}",
              "type": "String",
              "metadata": {
                "description": "enter the Fortinet endpoint (ex: https://{yourfortinetDomain})"
              }
            },
            "location": {
              "type": "string",
              "minLength": 1,
              "defaultValue": "[concat('[resourceGroup().locatio', 'n]')]",
              "metadata": {
                "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
              }
            }
          },
          "variables": {
            "FortinetConnectorname": "FortinetConnector",
            "operationId-Listaddressobjects": "Listaddressobjects",
            "_operationId-Listaddressobjects": "[[variables('operationId-Listaddressobjects')]",
            "operationId-CreateaddressObject": "CreateaddressObject",
            "_operationId-CreateaddressObject": "[[variables('operationId-CreateaddressObject')]",
            "operationId-Listaddressgroups": "Listaddressgroups",
            "_operationId-Listaddressgroups": "[[variables('operationId-Listaddressgroups')]",
            "operationId-Updateaddressgroup": "Updateaddressgroup",
            "_operationId-Updateaddressgroup": "[[variables('operationId-Updateaddressgroup')]",
            "operationId-AddURLtoaddressGroup": "AddURLtoaddressGroup",
            "_operationId-AddURLtoaddressGroup": "[[variables('operationId-AddURLtoaddressGroup')]",
            "operationId-CheckIFIP_URLBlocked": "CheckIFIP_URLBlocked",
            "_operationId-CheckIFIP_URLBlocked": "[[variables('operationId-CheckIFIP_URLBlocked')]",
            "operationId-GetAddressObject": "GetAddressObject",
            "_operationId-GetAddressObject": "[[variables('operationId-GetAddressObject')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId2": "FortinetCustomConnector",
            "playbookId2": "[[resourceId('Microsoft.Web/customApis', parameters('CustomConnectorName'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('CustomConnectorName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring",
                    "uiDefinition": {
                      "displayName": "API Key",
                      "description": "The API Key for this api",
                      "tooltip": "Provide your API Key",
                      "constraints": {
                        "tabIndex": 2,
                        "clearText": false,
                        "required": "true"
                      }
                    }
                  }
                },
                "backendService": {
                  "serviceUrl": "[[parameters('service_EndPoint')]"
                },
                "description": "Connector to FortiNet and FortiGate API's",
                "displayName": "[[parameters('CustomConnectorName')]",
                "iconUri": "data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABQAAD/4QOBaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzEzOCA3OS4xNTk4MjQsIDIwMTYvMDkvMTQtMDE6MDk6MDEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWI3MjVhZWEtZDExZi00MTE1LTg2MzMtYjJmNjhjMTBiN2M0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkI4Njg2Q0ZDRTIyOTExRTZCRkEyRkUxRTVERjJDQjE5IiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkI4Njg2Q0ZCRTIyOTExRTZCRkEyRkUxRTVERjJDQjE5IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6YWI3MjVhZWEtZDExZi00MTE1LTg2MzMtYjJmNjhjMTBiN2M0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOmFiNzI1YWVhLWQxMWYtNDExNS04NjMzLWIyZjY4YzEwYjdjNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv/uAA5BZG9iZQBkwAAAAAH/2wCEAAICAgICAgICAgIDAgICAwQDAgIDBAUEBAQEBAUGBQUFBQUFBgYHBwgHBwYJCQoKCQkMDAwMDAwMDAwMDAwMDAwBAwMDBQQFCQYGCQ0LCQsNDw4ODg4PDwwMDAwMDw8MDAwMDAwPDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDP/AABEIAJYBGAMBEQACEQEDEQH/xADIAAEAAgMAAwEBAAAAAAAAAAAACAkEBQoBBgcDAgEBAAIDAQEBAAAAAAAAAAAAAAcIAwUGBAIBEAABAgQCBQULCAkDBQAAAAAAAQIDBAUGEQcS05VXCCETs3UXMUEiFJQ1FlY3GDhRYbJzNLQVCXFSckOFtcWGR4EyYkKSI2MkEQABAgICCwwHBQcFAQAAAAAAAQIDBBEFITFx0ZJTVBUGFgdBUWGBkbESMnKTFDRCUrITczU2oSKCQ4PB4cIzs8NE8GLSIyRj/9oADAMBAAIRAxEAPwC/wAAAAAAA0dyXJQ7QodSuS5KlBpFEpMFY8/Px1waxqciIiJirnOVURrURVcqoiIqqYo0ZkFivetCIeyQkI8/HZLy7FfEetCIn+rCJbVVsIllbBUrnVxpXvek1N0bLmPMWRabXOhsn4Soyqzje5pvjNx8XRe6jYS6Sd969xOErHSKLGVWwfut3/SXj3OLlLM6JbJpGrmNiz6JGjW6F/lt4Eb6d11jealshVNTc1PzEacnpmLOTcw5Xx5qO90SI9y91XPcqqq/pU51zlctKrSpLUOEyE1GsREalpEShE4jHPk+wAACX/A77eaf1NUujab/RrziXFIu2v/IHfEZzl0hIpU4idxr/AA/3H1hS/vcM0WkfknXU5yS9kn1BC7L/AGVKTSOC24AAAAAAAAB0tSX2OU+ph/RQmJtpCgMbruuqZJ9GM5tLh8/1zrCZ6VxD8XruuqX4kfLw+y3mQ05jPUAAAb+3bpuW0ahDqtr16ft+ow1RWzkhHiQHqid5ysVNJPlRcUUywY8SC7pMcqLwHinqtlp+GsOZhtiN3nIjue1dQsl4fuNdavOSNn5xRIErNzLmwKbfMNrYMF8R2CNZPw2ojIeK/vWIjf1mtTFx2FVaR9NUhzFvcdfvkB6bbJPcMdNVUiq1LLoS2VRN+GtteytK7yr1Sx5FRURUVFRUxRU7iodeQMeQAAAAAAAAAAAAAAUt8W2fcxmjd8e1LfnV9AbSmHwpRITvAqE7DxZFm3YcjmtXFsL/AI4u/wCvBI6r6tFmovu2L9xv2rv3v3lstmWhbalk0mY7f/TFSlabbGLZRnAu6/hseiRANASgAAAAAAS/4HfbzT+pql0bTf6NecS4pF21/wCQO+IznLpCRSpxE7jX+H+4+sKX97hmi0j8k66nOSXsk+oIXZf7KlJpHBbcAAAAAAAAA6WpL7HKfUw/ooTE20hQGN13XVMk+jGc2lw+f651hM9K4h+L13XVL8SPl4fZbzIacxnqAAAAAALV+CfPuYuOT7IrtnVj1ejS6xbNn4zsXzElCT/ySjnLyq6A3wmf+vFORGcvcaOVosRPDxFsp1eFN7i3OC4Vu2t6FtlH50lm0MetEVEtNetp9x9p3+6hfSLDDrCDgAAAAAAAAAAACM/FlmXEy2yfrMSnzCy9fux6UKixGrg+Gsy1yzEZuHKisgNfg5O45Wmmr2c8NLLR1nfdTjt/YSBs00fSt64ho9KYcL/sdw9FU6KcblSlN1qKUaEaFwgAAAAAAAS/4HfbzT+pql0bTf6NecS4pF21/wCQO+IznLpCRSpxE7jX+H+4+sKX97hmi0j8k66nOSXsk+oIXZf7KlJpHBbcAAAAAAAAA6WpL7HKfUw/ooTE20hQGN13XVMk+jGc2lw+f651hM9K4h+L13XVL8SPl4fZbzIacxnqAAAAAAPYrSueq2Xc1CuyiRuYqtvzsGdk38uiroTkVWPw7rXpi1yd9FVDNAjOgxGxG20Wk8NZ1fCrCViS0ZKWRGq1ePdThS2m8p0QWnclPvG2LfuulO0qdcUhL1CURVxc1keGj9B3/JuOiqfKhLMCM2NDa9tpURSjNZyESr5qJLRetDcrV/CtFNxbacB7CZTwgAAAAAAAAAAqY/MAux9Qv+0bOhRdKVtujuno7EXkSZqMVUVHJ8qQpdip+0cJpVH6UZkPcalPGv7kLMbE6sSFV8aaVLMR/RTsw0/5OdyEAzliagAAAAAAAS/4HfbzT+pql0bTf6NecS4pF21/5A74jOcukJFKnETuNf4f7j6wpf3uGaLSPyTrqc5JeyT6ghdl/sqUmkcFtwAAAAAAAADpakvscp9TD+ihMTbSFAY3XddUyT6MZzaXD5/rnWEz0riH4vXddUvxI+Xh9lvMhpzGeoAAAAAAAFyvAvdj69kw+hzEXTmLNrEzIwWquLklphGzcJf0acWI1PmaSFozH95K9FfRVU4ls/tUqptiqxJWuvfNSxGY134m0sX7GtXjJnHREUAAAAAAAAAAApo4tLEzCuDPy96jSbLuCtUpWUuHT5+Sps1MS7mtpkrppDiQ4bmrhEVyLgvIuKEe17Kxok49WscqWKKEVfRQtZszrmrpWoJdkWPCY/76qjnta7+Y6ilFWm1RxEceynNHdtdOx53Umn8DMYt2Ct47zWSqsqg94y+OynNHdtdOx53UjwMxi3YK3hrJVWVQe8ZfHZTmju2unY87qR4GYxbsFbw1kqrKoPeMvjspzR3bXTsed1I8DMYt2Ct4ayVVlUHvGXx2U5o7trp2PO6keBmMW7BW8NZKqyqD3jL47Kc0d2107HndSPAzGLdgreGslVZVB7xl8lXwaWJfFv52SFRr1m1yiU9tIqEN09P06ZloKPcxui1YkWG1uK95MTeaPSsWHNormORKFtoqEbbVq5kZqpHQ4MeG93TZYa9rlt7yKqlvR3xWAjBxg0asV7Iy4KbQqVOVqoxZ6muhSEhAiTMdzWTTHOVIcJrnKiJyryGlr+G6JKORqKq0pas7pIey2bgytew4kZ7WNRr7LlRqdVd1aEKeeynNHdtdOx53Ukf+BmMW7BW8Wl1kqrKoPeMvjspzR3bXTsed1I8DMYt2Ct4ayVVlUHvGXx2U5o7trp2PO6keBmMW7BW8NZKqyqD3jL47Kc0d2107HndSPAzGLdgreGslVZVB7xl8dlOaO7a6djzupHgZjFuwVvDWSqsqg94y+OynNHdtdOx53UjwMxi3YK3hrJVWVQe8ZfHZTmju2unY87qR4GYxbsFbw1kqrKoPeMvnQ5JorZSVa5Fa5sFiKi8ioqNQlltpCjcVaXrdUyT9MZz317KzM6LXKzEh5c3REhxJ6YdDiNpE6rXNWK5UVFSFyopFMWSmFev/AFutr6K3i78lpHVaQIaLNQaein5jN66arspzR3bXTsed1Jj8DMYt2Ct49OslVZVB7xl8dlOaO7a6djzupHgZjFuwVvDWSqsqg94y+OynNHdtdOx53UjwMxi3YK3hrJVWVQe8ZfHZTmju2unY87qR4GYxbsFbw1kqrKoPeMvjspzR3bXTsed1I8DMYt2Ct4ayVVlUHvGXx2U5o7trp2PO6keBmMW7BW8NZKqyqD3jL5YvwEW1dttQc1Je5rdq1vwZl9FiU6HU5OPKJFciTyRlh88xmlgmhpYdzk+U67ReDEhJFR7VTq0Uoqb5BO2msJScdJul4rIip7xHdByOo/l0U9FVo3aOMsOOsINAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPX567bVpk1Fkalc1Jp87A0eek5mdgQorNJqObpMe9HJi1UVMU7hidHhtWhXIi3UPdBqybjMR8OE9zVtKjVVOVEMT08sf1zoW0ZbWHz4qD67eVDJmaexETAdeHp5Y/rnQtoy2sHioPrt5UGZp7ERMB14enlj+udC2jLaweKg+u3lQZmnsREwHXh6eWP650LaMtrB4qD67eVBmaexETAdeHp5Y/rnQtoy2sHioPrt5UGZp7ERMB14enlj+udC2jLaweKg+u3lQZmnsREwHXjNp902xVplJOlXHS6nNuarklZScgxoitb3V0GPVcE7/IfTI8N60NcirwKhhj1dNQG9KJCe1u+rVROVUN8ZTxgAAAAAAAAAAAAAAHqrr6sljnMfeNDY9iq17HVCWRUVORUVFiGDxML128qGxSp55UpSBEwHXjx6eWP650LaMtrB4qD67eVD9zNPYiJgOvD08sf1zoW0ZbWDxUH128qDM09iImA68PTyx/XOhbRltYPFQfXbyoMzT2IiYDrw9PLH9c6FtGW1g8VB9dvKgzNPYiJgOvD08sf1zoW0ZbWDxUH128qDM09iImA68PTyx/XOhbRltYPFQfXbyoMzT2IiYDrxtaXXqHW+f8AwWsyNX8V0fGfEpiFMc3p46OnzbnaOlorhj3cFPtkVj+qqLcWk80xJR5aj3sNzKbXSRW00W6KUNsZDzAAAAAAAAAAAo14xPiNzF/hH8okiNNIPPROL2ULhbLPpuV/U/qvIzGmJAAAAAAAABL/AIHfbzT+pql0bTf6NecS4pF21/5A74jOcukJFKnAAAAAAAAAAAAAAAHNpcPn+udYTPSuIfi9d11S/Ej5eH2W8yGnMZ6gAAAAAAAWZfl1f5h/t/8AqR2WiX5v4f4iv23X/B/V/tFmJ2RX4AAAAAAAAAAFGvGJ8RuYv8I/lEkRppB56JxeyhcLZZ9Nyv6n9V5GY0xIAAAAAAAAJf8AA77eaf1NUujab/RrziXFIu2v/IHfEZzl0hIpU4AAAAAAAAAAAAAAA5tLh8/1zrCZ6VxD8XruuqX4kfLw+y3mQ05jPUAAAAAAACzL8ur/ADD/AG//AFI7LRL838P8RX7br/g/q/2izE7Ir8AAAAAAAAAACjXjE+I3MX+EfyiSI00g89E4vZQuFss+m5X9T+q8jMaYkAAAAAAAAEv+B3280/qapdG03+jXnEuKRdtf+QO+IznLpCRSpwAAAAAAAAAAAAAABzaXD5/rnWEz0riH4vXddUvxI+Xh9lvMhpzGeoAAAAAAAFmX5dX+Yf7f/qR2WiX5v4f4iv23X/B/V/tFmJ2RX4AAAAAAAAAAFGvGJ8RuYv8ACP5RJEaaQeeicXsoXC2WfTcr+p/VeRmNMSAAAAAAAACX/A77eaf1NUujab/RrziXFIu2v/IHfEZzl0hIpU4AAAAAAAAAAAAAAA5tLh8/1zrCZ6VxD8XruuqX4kfLw+y3mQ05jPUAAAAAAACzL8ur/MP9v/1I7LRL838P8RX7br/g/q/2izE7Ir8AAAAAAAAAACoPiiyWzWu3PW+bgtqwqxWqJUPwzxKpysur4MXmqZKQn6Lk7ui9jmr86HA11V0xFm3vYxVRaLP4ULQbO9LKpkahl4ExMsZEb06WqtCpTEeqcqKinwH3dM891tweSuNVmibxbuQ7bXuosshYQ93TPPdbcHkrhmibxbuQa91FlkLCHu6Z57rbg8lcM0TeLdyDXuosshYQ93TPPdbcHkrhmibxbuQa91FlkLCHu6Z57rbg8lcM0TeLdyDXuosshYQ93TPPdbcHkrhmibxbuQa91FlkLCJPcImT+Z9mZySVcuux6tQaRDpU/BfUJyAsOEkSIxqMarl76943VQ1fMQZpHPYqJQtlSPNp+lNV1hUzoMtMMe/ptWhq0rQi2S1w7krYAAAAAAAAAAAAAAAUM1vh5zvj1qrx4OWFfiQY07MRIURsq5Uc10RyoqfpQjCJVM2r1VIbra7hc2T05qNsBjVm4aKjU9LgNX7umee624PJXGPNE3i3ch6de6iyyFhD3dM891tweSuGaJvFu5Br3UWWQsIe7pnnutuDyVwzRN4t3INe6iyyFhD3dM891tweSuGaJvFu5Br3UWWQsIe7pnnutuDyVwzRN4t3INe6iyyFhD3dM891tweSuGaJvFu5Br3UWWQsIn7wNZc31YHaj6aWtULa/FvwT8N8ehLC5/mPH+d0Me7o843H9KHVaNSkaX957xqtp6NFPGQpthr6QrTwnhIzYnQ970uitNHS93RTdoXkJ+nUkKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHz+t5sZYWzVJqiXFmDb1DrEloeOUueqUtLzELnGNiM04cR6ObpMcjkxTlRUU8sSel4Tla+I1FTcVUpN3J6NVpOQkjQJaK9jqaHNY5zVoWhaFRKLCoqXTU9uuS29e0tryetMec5XGswkPTqbXeRx+7deHbrktvXtLa8nrRnOVxrMJBqbXeRx+7deHbrktvXtLa8nrRnOVxrMJBqbXeRx+7deHbrktvXtLa8nrRnOVxrMJBqbXeRx+7deHbrktvXtLa8nrRnOVxrMJBqbXeRx+7deHbrktvXtLa8nrRnOVxrMJBqbXeRx+7deN3b+aOW911FtIti/KBcFVfDdFZTqfUJeZjqxnK5yQ4b3OwTvrgZIU7Aiu6LHtVd5FRTyTujtZSMP3sxLxIbKaOk5jmpStqyqHvZ6jTGmr1xUG1qbFrNy1mSoFJgOYyNUqhHZLwGOiORrEdEiK1qK5VwTlMcWMyE3pPVETfWweuSkZidipCl4boj1tNaiuWxbsJZPQu3XJbevaW15PWnlznK41mEhudTa7yOP3brw7dclt69pbXk9aM5yuNZhINTa7yOP3brw7dclt69pbXk9aM5yuNZhINTa7yOP3brw7dclt69pbXk9aM5yuNZhINTa7yOP3brw7dclt69pbXk9aM5yuNZhINTa7yOP3brw7dclt69pbXk9aM5yuNZhINTa7yOP3brw7dclt69pbXk9aM5yuNZhINTa7yOP3brx9Va5rmtc1Uc1yIrXJyoqL3FPcc4qUWDyD8PlkXPHJqDEiQY2alqQosJysiw3VeURzXNXBUVFiciop4lrKVT81vKh0bdD66ciKknGVF/+brx/HbrktvXtLa8nrT8znK41mEh+6m13kcfu3Xh265Lb17S2vJ60ZzlcazCQam13kcfu3Xh265Lb17S2vJ60ZzlcazCQam13kcfu3Xh265Lb17S2vJ60ZzlcazCQam13kcfu3Xh265Lb17S2vJ60ZzlcazCQam13kcfu3Xh265Lb17S2vJ60ZzlcazCQam13kcfu3Xj2u2L7su9fHvQ+7KTdH4ZzX4j+FzkGb5jntPm+c5pztHT5t2GPdwX5DPBmoUan3bkdRboWk1tYVNO1d0fFQXwulT0em1W00UU0UolNFKU3UPazOa0AAAAAAAAAAFIPGbIx5TiGvSYjNwh1SXpUzKr8sNtOl4Cr/wB8FyEbaRNVJ1679HMifsLebKIzYmjsBqW2rERbvvHO5nIRaNISMAAAAAAACX/A77eaf1NUujab/RrziXFIu2v/ACB3xGc5dISKVOInca/w/wBx9YUv73DNFpH5J11OckvZJ9QQuy/2VKTSOC24AAAAAAAAB0tSX2OU+ph/RQmJtpCgMbruuqZJ9GM5tLh8/wBc6wmelcQ/F67rql+JHy8Pst5kNOYz1AAAAAAAAs+/LukY8On5r1Jzf/mm5ijS0F3yxJdk696f6JHadpok1ejFdufd+ym+V526RmrEk4e6iRF4nKxE9lSyU7AgMAAAAAAAAAAFW/5g9nRINcsS/oEJVgVCTjUKoRUTkbElnumJfS+d7Y0TD5mHE6Vy9D2RU3UoXispzryFi9iFao6BMSSrZa5IiXHJ0XcitbhFchyJO4AAAAAAAJf8Dvt5p/U1S6Npv9GvOJcUi7a/8gd8RnOXSEilTiJ3Gv8AD/cfWFL+9wzRaR+SddTnJL2SfUELsv8AZUpNI4LbgAAAAAAAAHS1JfY5T6mH9FCYm2kKAxuu66pkn0Yzm0uHz/XOsJnpXEPxeu66pfiR8vD7LeZDTmM9QAAAAAAALtOC+zolqZG0acmYSwpy8ZyZrsZrk8Lm4ujAl+X5HQYLXp+0SPo7L+6lEVbblVf2J9iFR9rFapPV7EY1aWwWpD40pc7kc5U4iV5vSNQAAAAAAAAAAfF+IDLNM2Mq7ktWBDa6sshpULbe7BNGoSuL4TcV5E51NKEq95Hqa6tZPxcu5iW7aXUv2uM6zQnSDMdawplV+5T0X9h1hcGw660oJjQY0tGiy8xCfAmID3Q48CI1WvY9q4Oa5q8qKipgqKRaqKi0KXUY9HtRzVpRbKLvn5H4fQAAAAABL/gd9vNP6mqXRtN/o15xLikXbX/kDviM5y6QkUqcRO41/h/uPrCl/e4ZotI/JOupzkl7JPqCF2X+ypSaRwW3AAAAAAAAAOlqS+xyn1MP6KExNtIUBjdd11TJPoxnNpcPn+udYTPSuIfi9d11S/Ej5eH2W8yGnMZ6gAAAAAD6HlTl9Us0b/tuyaa17Vq8038Qmmpj4tJw/DmY697wIaKqY912De6p65GUdNRmw03Vs8Cbqmj0kryHUtXxZuJ6CWE9Z62Gt41t7yUruHQnTKdJUem0+kU2A2Vp1LloUpISrP8AbDgwGJDhsT5mtaiErsYjGo1LSJQUfmI75iI6LEWlzlVyrvqq0qvKZp9GEAAAAAAAAAAAAqy4zuHaZp1Rn84bMkFjUmoO52+KbAbi6VmF7s81qfu4n739V3hryOXR4nSKqVa5ZiGlhesm8u/cXd5SxuyjTpsWG2q5t1D22ITl9JuL7TfR32/dtolNdJyJOoAAAAABL/gd9vNP6mqXRtN/o15xLikXbX/kDviM5y6QkUqcRO41/h/uPrCl/e4ZotI/JOupzkl7JPqCF2X+ypSaRwW3AAAAAAAAAOlqS+xyn1MP6KExNtIUBjdd11TJPoxnNpcPn+udYTPSuIfi9d11S/Ej5eH2W8yGnMZ6gAAAAftLy8ebjwJWVgRJmamYjYUtLQmq+JEiPVGtYxrUVVVVXBEQ/URVWhLZ8ve1jVc5URESlVWwiIm6pdHwncPzsobZjXDc0u1L/umCzx+HyOWnyeKPZJo5MfCVcHRVTk0kRvLoYrItRVV4SH039d32JvX/ANxU3aXpslfTSQJdf/NCWx/vfaV9zcZwUr6VCS6N8RiAAAAAAAAAAAAAD8JnxbxaY8c5vxTm3+Nc9hzfN4Lp6elyaOGOOPJgfi0UWbR9w+l0k6FPSpsUW6dyjhKZM9bT4Z5+qVSr5U5pyNDqTY0Tx60YtOqsWmvitcuksjNwJOK1jVVFwamlDXHwXNbghHlZwJBzldAiIi+rQ6jiVE/cWu0OrPSeFCZCrKTc9tCUREfDSIibnvGOeiqu+th2+jlIfuREVURyORFwRyY4L86Y4Kc+Sih4AAAAJf8AA77eaf1NUujab/RrziXFIu2v/IHfEZzl0hIpU4idxr/D/cfWFL+9wzRaR+SddTnJL2SfUELsv9lSk0jgtuAAAAAAAAAdLUl9jlPqYf0UJibaQoDG67rqmSfRjObS4fP9c6wmelcQ/F67rql+JHy8Pst5kNOYz1AAAGfTZSXnp2BKzVUlqNAjOwiVKcbHfBhJ+s9stCjxVT9lin2xqOWhVROFaf2IqmGYiuhMVzWK9U9FvRpW50la3lchZvwqW9wy2/cMiyk5gSt+5qzENzpCYm5Ccp8CXVE8NlPhzsCE10TBV8JXLEVEXRa1NJDsqjhSEN6dF6Pi7lKKlHZpS39pXzaRPaTzUu5YsssCTRbKNcx7nbyxFY5VRvBQjUW2rloLHTryBgAAAAAAAf/Z",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "title": "Default title",
                    "description": "Connector to FortiNet and FortiGate API's",
                    "version": "1.0"
                  },
                  "host": "fortinetlactest1.trafficmanager.net",
                  "basePath": "/",
                  "schemes": [
                    "https"
                  ],
                  "consumes": "[variables('TemplateEmptyArray')]",
                  "produces": "[variables('TemplateEmptyArray')]",
                  "paths": {
                    "/api/v2/cmdb/firewall/address": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "name": {
                                    "type": "string",
                                    "description": "Name of the address object",
                                    "title": "name"
                                  },
                                  "q_origin_key": {
                                    "type": "string",
                                    "description": "q_origin_key of an address object",
                                    "title": "q_origin_key"
                                  },
                                  "uuid": {
                                    "type": "string",
                                    "description": "Unique id of address group",
                                    "title": "uuid"
                                  },
                                  "subnet": {
                                    "type": "string",
                                    "description": "subnet address of address object",
                                    "title": "subnet"
                                  },
                                  "type": {
                                    "type": "string",
                                    "description": "Type of the address object",
                                    "title": "type"
                                  },
                                  "sub-type": {
                                    "type": "string",
                                    "description": "Sub-type of address object",
                                    "title": "sub-type"
                                  },
                                  "clearpass-spt": {
                                    "type": "string",
                                    "description": "clear pass-spt of address object",
                                    "title": "clearpass-spt"
                                  },
                                  "start-mac": {
                                    "type": "string",
                                    "description": "Starting mac address of address object",
                                    "title": "start-mac"
                                  },
                                  "end-mac": {
                                    "type": "string",
                                    "description": "end-mac address of address object",
                                    "title": "end-mac"
                                  },
                                  "country": {
                                    "type": "string",
                                    "description": "Country of the address object",
                                    "title": "country"
                                  },
                                  "cache-ttl": {
                                    "type": "integer",
                                    "format": "int32",
                                    "description": "cache-ttl of the address",
                                    "title": "cache-ttl"
                                  },
                                  "sdn": {
                                    "type": "string",
                                    "description": "sdn",
                                    "title": "sdn"
                                  },
                                  "fsso-group": {
                                    "type": "array",
                                    "description": "fsso-group"
                                  },
                                  "interface": {
                                    "type": "string",
                                    "description": "Interface of address object",
                                    "title": "interface"
                                  },
                                  "obj-type": {
                                    "type": "string",
                                    "description": "object-type of an address",
                                    "title": "obj-type"
                                  },
                                  "comment": {
                                    "type": "string",
                                    "description": "Comment of the address object",
                                    "title": "comment"
                                  },
                                  "associated-interface": {
                                    "type": "string",
                                    "description": "associated-interface of the address object",
                                    "title": "associated-interface"
                                  },
                                  "color": {
                                    "type": "integer",
                                    "format": "int32",
                                    "description": "Color of the address object",
                                    "title": "color"
                                  },
                                  "filter": {
                                    "type": "string",
                                    "description": "filter of address object",
                                    "title": "filter"
                                  },
                                  "sdn-addr-type": {
                                    "type": "string",
                                    "description": "sdn-addr-type",
                                    "title": "sdn-addr-type"
                                  },
                                  "obj-id": {
                                    "type": "string",
                                    "description": "object_id of the address object",
                                    "title": "obj-id"
                                  },
                                  "list": {
                                    "type": "array",
                                    "description": "list"
                                  },
                                  "tagging": {
                                    "type": "array",
                                    "description": "tagging"
                                  },
                                  "allow-routing": {
                                    "type": "string",
                                    "description": "allow routing object is enable or disable",
                                    "title": "allow-routing"
                                  },
                                  "fabric-object": {
                                    "type": "string",
                                    "description": "fabric-object of address object",
                                    "title": "fabric-object"
                                  },
                                  "obj-tag": {
                                    "type": "string",
                                    "description": "object-tag of an object",
                                    "title": "obj-tag"
                                  },
                                  "start-ip": {
                                    "type": "string",
                                    "description": "start-ip of  address object",
                                    "title": "start-ip"
                                  },
                                  "end-ip": {
                                    "type": "string",
                                    "description": "end-ip of address object",
                                    "title": "end-ip"
                                  },
                                  "fqdn": {
                                    "type": "string",
                                    "description": "fqdn",
                                    "title": "fqdn"
                                  }
                                }
                              }
                            }
                          }
                        },
                        "summary": "List address objects",
                        "description": "action used to fetch details all address objects",
                        "operationId": "[[variables('_operationId-Listaddressobjects')]"
                      },
                      "post": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "mkey": {
                                  "type": "string",
                                  "description": "Name of the address object created",
                                  "title": "mkey"
                                },
                                "status": {
                                  "type": "string",
                                  "description": "status"
                                },
                                "path": {
                                  "type": "string",
                                  "description": "path of an address object",
                                  "title": "path"
                                },
                                "serial": {
                                  "type": "string",
                                  "description": "Serial number of the system",
                                  "title": "serial"
                                },
                                "version": {
                                  "type": "string",
                                  "description": "Version of the system",
                                  "title": "version"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Create an address object",
                        "description": "action used to create a new address object",
                        "operationId": "[[variables('_operationId-CreateaddressObject')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "description": "enter the address object name",
                                  "title": "name"
                                },
                                "type": {
                                  "type": "string",
                                  "description": "Type of address.ipmask:Standard IPv4 address with subnet mask. fqdn:Fully Qualified Domain Name address.",
                                  "title": "address type",
                                  "enum": [
                                    "iprange",
                                    "fqdn"
                                  ]
                                },
                                "start-ip": {
                                  "type": "string",
                                  "description": "start range of IPv4 addresses between two specified addresses (inclusive)",
                                  "title": "start-ip"
                                },
                                "end-ip": {
                                  "type": "string",
                                  "description": "end range of IPv4 addresses between two specified addresses (inclusive)",
                                  "title": "end-ip"
                                },
                                "fqdn": {
                                  "type": "string",
                                  "description": "Please provide the URL for ex gmail.com if type=fqdn",
                                  "title": "URL address"
                                }
                              },
                              "required": [
                                "name",
                                "type"
                              ]
                            }
                          }
                        ]
                      }
                    },
                    "/api/v2/cmdb/firewall/addrgrp": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "http_method": {
                                  "type": "string",
                                  "description": "http_method used to call the API",
                                  "title": "http_method"
                                },
                                "revision": {
                                  "type": "string",
                                  "description": "revision of the address group",
                                  "title": "revision"
                                },
                                "results": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "name": {
                                        "type": "string",
                                        "description": "Group name",
                                        "title": "name"
                                      },
                                      "q_origin_key": {
                                        "type": "string",
                                        "description": "q_origin_key of the group member",
                                        "title": "q_origin_key"
                                      },
                                      "type": {
                                        "type": "string",
                                        "description": "type of the group",
                                        "title": "type"
                                      },
                                      "uuid": {
                                        "type": "string",
                                        "description": "Unique ID of group",
                                        "title": "uuid"
                                      },
                                      "member": {
                                        "type": "array",
                                        "items": {
                                          "type": "object",
                                          "properties": {
                                            "name": {
                                              "type": "string",
                                              "description": "name"
                                            },
                                            "q_origin_key": {
                                              "type": "string",
                                              "description": "q_origin_key"
                                            }
                                          }
                                        },
                                        "description": "member"
                                      },
                                      "comment": {
                                        "type": "string",
                                        "description": "comment of the group",
                                        "title": "comment"
                                      },
                                      "exclude": {
                                        "type": "string",
                                        "description": "exclude"
                                      },
                                      "exclude-member": {
                                        "type": "array",
                                        "description": "exclude-member"
                                      },
                                      "color": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "color of the group",
                                        "title": "color"
                                      },
                                      "tagging": {
                                        "type": "array",
                                        "description": "tagging"
                                      },
                                      "allow-routing": {
                                        "type": "string",
                                        "description": "allow-routing"
                                      },
                                      "fabric-object": {
                                        "type": "string",
                                        "description": "fabric-object"
                                      }
                                    }
                                  },
                                  "description": "results"
                                },
                                "vdom": {
                                  "type": "string",
                                  "description": "virtual domain",
                                  "title": "vdom"
                                },
                                "path": {
                                  "type": "string",
                                  "description": "path",
                                  "title": "path"
                                },
                                "name": {
                                  "type": "string",
                                  "description": "name of the entities",
                                  "title": "name"
                                },
                                "status": {
                                  "type": "string",
                                  "description": "status of the API call",
                                  "title": "status"
                                },
                                "http_status": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "http_status of the API call",
                                  "title": "http_status"
                                },
                                "serial": {
                                  "type": "string",
                                  "description": "serial"
                                },
                                "version": {
                                  "type": "string",
                                  "description": "version of the address group",
                                  "title": "version"
                                },
                                "build": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "build of response",
                                  "title": "build"
                                }
                              }
                            }
                          }
                        },
                        "summary": "List address groups",
                        "description": "action used to create a new address groups",
                        "operationId": "[[variables('_operationId-Listaddressgroups')]",
                        "parameters": [
                          {
                            "name": "filter",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "enter the address object name to filter (e.g. member=@10.10.10.09)"
                          }
                        ]
                      }
                    },
                    "/api/v2/cmdb/firewall/addrgrp/{name}": {
                      "put": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "mkey": {
                                  "type": "string",
                                  "description": "Group name which address object is added",
                                  "title": "mkey"
                                },
                                "status": {
                                  "type": "string",
                                  "description": "Status code of the API call",
                                  "title": "status"
                                },
                                "http_status": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "Status of the \"IP add to an address object\" action",
                                  "title": "http_status"
                                },
                                "vdom": {
                                  "type": "string",
                                  "description": "virtual domain",
                                  "title": "vdom"
                                },
                                "path": {
                                  "type": "string",
                                  "description": "firewall path",
                                  "title": "path"
                                },
                                "name": {
                                  "type": "string",
                                  "description": "Entity name",
                                  "title": "name"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Update address group",
                        "description": "Action is used to add/remove an address object to an address group",
                        "operationId": "[[variables('_operationId-Updateaddressgroup')]",
                        "parameters": [
                          {
                            "name": "name",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "description": "enter the address group name"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "description": "enter the address group name",
                                  "title": "name"
                                },
                                "member": {
                                  "type": "object",
                                  "description": "Enter the whole array of members i.e existing and also new ones",
                                  "title": "member"
                                }
                              },
                              "required": [
                                "member",
                                "name"
                              ]
                            }
                          }
                        ]
                      }
                    },
                    "/api/v2/cmdb/firewall.wildcard-fqdn/group": {
                      "put": {
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "summary": "Add an URL to an address group",
                        "description": "Action used to add an URL to an address group",
                        "operationId": "[[variables('_operationId-AddURLtoaddressGroup')]",
                        "parameters": [
                          {
                            "name": "name",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "x-ms-visibility": "important",
                            "description": "please provide the name address group"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": false,
                            "schema": {
                              "type": "object"
                            }
                          }
                        ]
                      }
                    },
                    "/api/v2/cmdb/firewall/policy": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "policyid": {
                                    "type": "integer",
                                    "format": "int32",
                                    "description": "policyid of the policy",
                                    "title": "policyid"
                                  },
                                  "q_origin_key": {
                                    "type": "integer",
                                    "format": "int32",
                                    "description": "q_origin_key of the policy",
                                    "title": "q_origin_key"
                                  },
                                  "status": {
                                    "type": "string",
                                    "description": "status of the policy",
                                    "title": "status"
                                  },
                                  "name": {
                                    "type": "string",
                                    "description": "name of the policy",
                                    "title": "name"
                                  },
                                  "uuid": {
                                    "type": "string",
                                    "description": "unique Id of the Poilcy",
                                    "title": "uuid"
                                  },
                                  "srcintf": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "description": "name"
                                        },
                                        "q_origin_key": {
                                          "type": "string",
                                          "description": "q_origin_key"
                                        }
                                      }
                                    },
                                    "description": "srcintf"
                                  },
                                  "dstintf": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "description": "name"
                                        },
                                        "q_origin_key": {
                                          "type": "string",
                                          "description": "q_origin_key"
                                        }
                                      }
                                    },
                                    "description": "dstintf"
                                  },
                                  "srcaddr": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "description": "name"
                                        },
                                        "q_origin_key": {
                                          "type": "string",
                                          "description": "q_origin_key"
                                        }
                                      }
                                    },
                                    "description": "srcaddr"
                                  },
                                  "dstaddr": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "description": "name"
                                        },
                                        "q_origin_key": {
                                          "type": "string",
                                          "description": "q_origin_key"
                                        }
                                      }
                                    },
                                    "description": "dstaddr"
                                  },
                                  "srcaddr6": {
                                    "type": "array",
                                    "description": "srcaddr6"
                                  },
                                  "dstaddr6": {
                                    "type": "array",
                                    "description": "dstaddr6"
                                  },
                                  "internet-service": {
                                    "type": "string",
                                    "description": "internet-service of the policy",
                                    "title": "internet-service"
                                  },
                                  "internet-service-name": {
                                    "type": "array",
                                    "description": "internet-service-name"
                                  },
                                  "internet-service-group": {
                                    "type": "array",
                                    "description": "internet-service-group"
                                  },
                                  "internet-service-custom": {
                                    "type": "array",
                                    "description": "internet-service-custom"
                                  },
                                  "internet-service-custom-group": {
                                    "type": "array",
                                    "description": "internet-service-custom-group"
                                  },
                                  "internet-service-src": {
                                    "type": "string",
                                    "description": "internet-service-source",
                                    "title": "internet-service-src"
                                  },
                                  "internet-service-src-name": {
                                    "type": "array",
                                    "description": "internet-service-src-name"
                                  },
                                  "internet-service-src-group": {
                                    "type": "array",
                                    "description": "internet-service-src-group"
                                  },
                                  "internet-service-src-custom": {
                                    "type": "array",
                                    "description": "internet-service-src-custom"
                                  },
                                  "internet-service-src-custom-group": {
                                    "type": "array",
                                    "description": "internet-service-src-custom-group"
                                  },
                                  "reputation-minimum": {
                                    "type": "integer",
                                    "format": "int32",
                                    "description": "reputation-minimum of the policy",
                                    "title": "reputation-minimum"
                                  },
                                  "reputation-direction": {
                                    "type": "string",
                                    "description": "reputation-direction of the policy",
                                    "title": "reputation-direction"
                                  },
                                  "src-vendor-mac": {
                                    "type": "array",
                                    "description": "src-vendor-mac"
                                  },
                                  "rtp-nat": {
                                    "type": "string",
                                    "description": "rtp-nat of the policy",
                                    "title": "rtp-nat"
                                  },
                                  "rtp-addr": {
                                    "type": "array",
                                    "description": "rtp-addr"
                                  },
                                  "action": {
                                    "type": "string",
                                    "description": "Action of the policy",
                                    "title": "action"
                                  },
                                  "send-deny-packet": {
                                    "type": "string",
                                    "description": "send-deny-packet of  policy",
                                    "title": "send-deny-packet"
                                  },
                                  "firewall-session-dirty": {
                                    "type": "string",
                                    "description": "firewall-session-dirty of the policy",
                                    "title": "firewall-session-dirty"
                                  },
                                  "schedule": {
                                    "type": "string",
                                    "description": "schedule of the policy",
                                    "title": "schedule"
                                  },
                                  "schedule-timeout": {
                                    "type": "string",
                                    "description": "schedule-timeout of the poilcy",
                                    "title": "schedule-timeout"
                                  },
                                  "service": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "description": "name"
                                        },
                                        "q_origin_key": {
                                          "type": "string",
                                          "description": "q_origin_key"
                                        }
                                      }
                                    },
                                    "description": "service"
                                  },
                                  "tos": {
                                    "type": "string",
                                    "description": "tos of the policy",
                                    "title": "tos"
                                  },
                                  "tos-mask": {
                                    "type": "string",
                                    "description": "tos-mask of the policy",
                                    "title": "tos-mask"
                                  },
                                  "tos-negate": {
                                    "type": "string",
                                    "description": "tos-negate of the policy",
                                    "title": "tos-negate"
                                  },
                                  "anti-replay": {
                                    "type": "string",
                                    "description": "anti-replay of the policy",
                                    "title": "anti-replay"
                                  },
                                  "tcp-session-without-syn": {
                                    "type": "string",
                                    "description": "tcp-session-without-syn of policy",
                                    "title": "tcp-session-without-syn"
                                  },
                                  "geoip-anycast": {
                                    "type": "string",
                                    "description": "geoip-anycast of the policy",
                                    "title": "geoip-anycast"
                                  },
                                  "geoip-match": {
                                    "type": "string",
                                    "description": "geoip-match of the policy",
                                    "title": "geoip-match"
                                  },
                                  "utm-status": {
                                    "type": "string",
                                    "description": "utm-status of the policy",
                                    "title": "utm-status"
                                  },
                                  "inspection-mode": {
                                    "type": "string",
                                    "description": "inspection-mode of the policy",
                                    "title": "inspection-mode"
                                  },
                                  "http-policy-redirect": {
                                    "type": "string",
                                    "description": "http-policy-redirect of the policy",
                                    "title": "http-policy-redirect"
                                  },
                                  "ssh-policy-redirect": {
                                    "type": "string",
                                    "description": "ssh-policy-redirect of the policy",
                                    "title": "ssh-policy-redirect"
                                  },
                                  "webproxy-profile": {
                                    "type": "string",
                                    "description": "webproxy-profile of the policy",
                                    "title": "webproxy-profile"
                                  },
                                  "profile-type": {
                                    "type": "string",
                                    "description": "profile-type"
                                  },
                                  "profile-group": {
                                    "type": "string",
                                    "description": "profile-group of the policy",
                                    "title": "profile-group"
                                  },
                                  "profile-protocol-options": {
                                    "type": "string",
                                    "description": "profile-protocol-options"
                                  },
                                  "ssl-ssh-profile": {
                                    "type": "string",
                                    "description": "ssl-ssh-profile of the policy",
                                    "title": "ssl-ssh-profile"
                                  },
                                  "av-profile": {
                                    "type": "string",
                                    "description": "av-profile of policy",
                                    "title": "av-profile"
                                  },
                                  "webfilter-profile": {
                                    "type": "string",
                                    "description": "webfilter-profile of the policy",
                                    "title": "webfilter-profile"
                                  },
                                  "dnsfilter-profile": {
                                    "type": "string",
                                    "description": "dnsfilter-profile of the policy",
                                    "title": "dnsfilter-profile"
                                  },
                                  "emailfilter-profile": {
                                    "type": "string",
                                    "description": "emailfilter-profile of the policy",
                                    "title": "emailfilter-profile"
                                  },
                                  "dlp-sensor": {
                                    "type": "string",
                                    "description": "dlp-sensor of the policy",
                                    "title": "dlp-sensor"
                                  },
                                  "file-filter-profile": {
                                    "type": "string",
                                    "description": "file-filter-profile of the policy",
                                    "title": "file-filter-profile"
                                  },
                                  "ips-sensor": {
                                    "type": "string",
                                    "description": "ips-sensor"
                                  },
                                  "application-list": {
                                    "type": "string",
                                    "description": "application-list of the policy",
                                    "title": "application-list"
                                  },
                                  "voip-profile": {
                                    "type": "string",
                                    "description": "voip-profile"
                                  },
                                  "icap-profile": {
                                    "type": "string",
                                    "description": "icap-profile of the policy",
                                    "title": "icap-profile"
                                  },
                                  "cifs-profile": {
                                    "type": "string",
                                    "description": "cifs-profile of the policy",
                                    "title": "cifs-profile"
                                  },
                                  "waf-profile": {
                                    "type": "string",
                                    "description": "waf-profile of policy",
                                    "title": "waf-profile"
                                  },
                                  "ssh-filter-profile": {
                                    "type": "string",
                                    "description": "ssh-filter-profile of the policy",
                                    "title": "ssh-filter-profile"
                                  },
                                  "logtraffic": {
                                    "type": "string",
                                    "description": "logtraffic of the policy",
                                    "title": "logtraffic"
                                  },
                                  "logtraffic-start": {
                                    "type": "string",
                                    "description": "logtraffic-start of the policy",
                                    "title": "logtraffic-start"
                                  },
                                  "capture-packet": {
                                    "type": "string",
                                    "description": "capture-packet of the policy",
                                    "title": "capture-packet"
                                  },
                                  "auto-asic-offload": {
                                    "type": "string",
                                    "description": "auto-asic-offload",
                                    "title": "auto-asic-offload"
                                  },
                                  "wanopt": {
                                    "type": "string",
                                    "description": "wanopt of the policy",
                                    "title": "wanopt"
                                  },
                                  "wanopt-detection": {
                                    "type": "string",
                                    "description": "wanopt-detection of the policy",
                                    "title": "wanopt-detection"
                                  },
                                  "wanopt-passive-opt": {
                                    "type": "string",
                                    "description": "wanopt-passive-opt of the policy",
                                    "title": "wanopt-passive-opt"
                                  },
                                  "wanopt-profile": {
                                    "type": "string",
                                    "description": "wanopt-profile of the policy",
                                    "title": "wanopt-profile"
                                  },
                                  "wanopt-peer": {
                                    "type": "string",
                                    "description": "wanopt-peer of the policy",
                                    "title": "wanopt-peer"
                                  },
                                  "webcache": {
                                    "type": "string",
                                    "description": "webcache of the policy",
                                    "title": "webcache"
                                  },
                                  "webcache-https": {
                                    "type": "string",
                                    "description": "webcache-https of the policy",
                                    "title": "webcache-https"
                                  },
                                  "webproxy-forward-server": {
                                    "type": "string",
                                    "description": "webproxy-forward-server of the policy",
                                    "title": "webproxy-forward-server"
                                  },
                                  "traffic-shaper": {
                                    "type": "string",
                                    "description": "traffic-shaper of the policy",
                                    "title": "traffic-shaper"
                                  },
                                  "traffic-shaper-reverse": {
                                    "type": "string",
                                    "description": "traffic-shaper-reverse of the policy",
                                    "title": "traffic-shaper-reverse"
                                  },
                                  "per-ip-shaper": {
                                    "type": "string",
                                    "description": "per-ip-shaper of the policy",
                                    "title": "per-ip-shaper"
                                  },
                                  "nat": {
                                    "type": "string",
                                    "description": "nat of the policy",
                                    "title": "nat"
                                  },
                                  "permit-any-host": {
                                    "type": "string",
                                    "description": "permit-any-host of the policy",
                                    "title": "permit-any-host"
                                  },
                                  "permit-stun-host": {
                                    "type": "string",
                                    "description": "permit-stun-host of the policy",
                                    "title": "permit-stun-host"
                                  },
                                  "fixedport": {
                                    "type": "string",
                                    "description": "fixedport of the policy",
                                    "title": "fixedport"
                                  },
                                  "ippool": {
                                    "type": "string",
                                    "description": "ippool of the policy",
                                    "title": "ippool"
                                  },
                                  "poolname": {
                                    "type": "array",
                                    "description": "poolname"
                                  },
                                  "poolname6": {
                                    "type": "array",
                                    "description": "poolname6"
                                  },
                                  "session-ttl": {
                                    "type": "string",
                                    "description": "session-ttl"
                                  },
                                  "vlan-cos-fwd": {
                                    "type": "integer",
                                    "format": "int32",
                                    "description": "vlan-cos-fwd of the policy",
                                    "title": "vlan-cos-fwd"
                                  },
                                  "vlan-cos-rev": {
                                    "type": "integer",
                                    "format": "int32",
                                    "description": "vlan-cos-rev of the policy",
                                    "title": "vlan-cos-rev"
                                  },
                                  "inbound": {
                                    "type": "string",
                                    "description": "inbound of the policy",
                                    "title": "inbound"
                                  },
                                  "outbound": {
                                    "type": "string",
                                    "description": "outbound of the policy",
                                    "title": "outbound"
                                  },
                                  "natinbound": {
                                    "type": "string",
                                    "description": "natinbound of the policy",
                                    "title": "natinbound"
                                  },
                                  "natoutbound": {
                                    "type": "string",
                                    "description": "natoutbound"
                                  },
                                  "wccp": {
                                    "type": "string",
                                    "description": "wccp of the policy",
                                    "title": "wccp"
                                  },
                                  "ntlm": {
                                    "type": "string",
                                    "description": "ntlm of the policy",
                                    "title": "ntlm"
                                  },
                                  "ntlm-guest": {
                                    "type": "string",
                                    "description": "ntlm-guest of the policy",
                                    "title": "ntlm-guest"
                                  },
                                  "ntlm-enabled-browsers": {
                                    "type": "array",
                                    "description": "ntlm-enabled-browsers"
                                  },
                                  "fsso-agent-for-ntlm": {
                                    "type": "string",
                                    "description": "fsso-agent-for-ntlm of the policy",
                                    "title": "fsso-agent-for-ntlm"
                                  },
                                  "groups": {
                                    "type": "array",
                                    "description": "groups"
                                  },
                                  "users": {
                                    "type": "array",
                                    "description": "users"
                                  },
                                  "fsso-groups": {
                                    "type": "array",
                                    "description": "fsso-groups"
                                  },
                                  "auth-path": {
                                    "type": "string",
                                    "description": "authentication path of the policy",
                                    "title": "auth-path"
                                  },
                                  "disclaimer": {
                                    "type": "string",
                                    "description": "disclaimer of the policy",
                                    "title": "disclaimer"
                                  },
                                  "email-collect": {
                                    "type": "string",
                                    "description": "email-collect of the policy",
                                    "title": "email-collect"
                                  },
                                  "vpntunnel": {
                                    "type": "string",
                                    "description": "vpntunnel of the policy",
                                    "title": "vpntunnel"
                                  },
                                  "natip": {
                                    "type": "string",
                                    "description": "natip of the policy",
                                    "title": "natip"
                                  },
                                  "match-vip": {
                                    "type": "string",
                                    "description": "match-vip of the policy",
                                    "title": "match-vip"
                                  },
                                  "match-vip-only": {
                                    "type": "string",
                                    "description": "match-vip-only of the policy",
                                    "title": "match-vip-only"
                                  },
                                  "diffserv-forward": {
                                    "type": "string",
                                    "description": "diffserv-forward of the policy",
                                    "title": "diffserv-forward"
                                  },
                                  "diffserv-reverse": {
                                    "type": "string",
                                    "description": "diffserv-reverse of the policy",
                                    "title": "diffserv-reverse"
                                  },
                                  "diffservcode-forward": {
                                    "type": "string",
                                    "description": "diffservcode-forward of the policy",
                                    "title": "diffservcode-forward"
                                  },
                                  "diffservcode-rev": {
                                    "type": "string",
                                    "description": "diffservcode-rev of the policy",
                                    "title": "diffservcode-rev"
                                  },
                                  "tcp-mss-sender": {
                                    "type": "integer",
                                    "format": "int32",
                                    "description": "tcp-mss-sender of the policy",
                                    "title": "tcp-mss-sender"
                                  },
                                  "tcp-mss-receiver": {
                                    "type": "integer",
                                    "format": "int32",
                                    "description": "tcp-mss-receiver of the policy",
                                    "title": "tcp-mss-receiver"
                                  },
                                  "comments": {
                                    "type": "string",
                                    "description": "comments of the policy",
                                    "title": "comments"
                                  },
                                  "label": {
                                    "type": "string",
                                    "description": "label of the policy",
                                    "title": "label"
                                  },
                                  "global-label": {
                                    "type": "string",
                                    "description": "global-label of the policy",
                                    "title": "global-label"
                                  },
                                  "auth-cert": {
                                    "type": "string",
                                    "description": "authentication certificate of the policy",
                                    "title": "auth-cert"
                                  },
                                  "auth-redirect-addr": {
                                    "type": "string",
                                    "description": "authentication-redirect-address",
                                    "title": "auth-redirect-addr"
                                  },
                                  "redirect-url": {
                                    "type": "string",
                                    "description": "redirect-url of the policy",
                                    "title": "redirect-url"
                                  },
                                  "identity-based-route": {
                                    "type": "string",
                                    "description": "identity-based-route of the policy",
                                    "title": "identity-based-route"
                                  },
                                  "block-notification": {
                                    "type": "string",
                                    "description": "Block-notification of policy",
                                    "title": "block-notification"
                                  },
                                  "custom-log-fields": {
                                    "type": "array",
                                    "description": "custom-log-fields"
                                  },
                                  "replacemsg-override-group": {
                                    "type": "string",
                                    "description": "replacemsg-override-group of the policy",
                                    "title": "replacemsg-override-group"
                                  },
                                  "srcaddr-negate": {
                                    "type": "string",
                                    "description": "srouce address-negate of the policy",
                                    "title": "srcaddr-negate"
                                  },
                                  "dstaddr-negate": {
                                    "type": "string",
                                    "description": "dstaddr-negate of the policy",
                                    "title": "dstaddr-negate"
                                  },
                                  "service-negate": {
                                    "type": "string",
                                    "description": "service-negate of the policy",
                                    "title": "service-negate"
                                  },
                                  "internet-service-negate": {
                                    "type": "string",
                                    "description": "internet-service-negate"
                                  },
                                  "internet-service-src-negate": {
                                    "type": "string",
                                    "description": "internet-service-src-negate"
                                  },
                                  "timeout-send-rst": {
                                    "type": "string",
                                    "description": "timeout-send-rst of the policy",
                                    "title": "timeout-send-rst"
                                  },
                                  "captive-portal-exempt": {
                                    "type": "string",
                                    "description": "captive-portal-exempt of the policy",
                                    "title": "captive-portal-exempt"
                                  },
                                  "decrypted-traffic-mirror": {
                                    "type": "string",
                                    "description": "decrypted-traffic-mirror of the policy",
                                    "title": "decrypted-traffic-mirror"
                                  },
                                  "dsri": {
                                    "type": "string",
                                    "description": "dsri of the policy",
                                    "title": "dsri"
                                  },
                                  "radius-mac-auth-bypass": {
                                    "type": "string",
                                    "description": "radius-mac-authentication-bypass of the policy",
                                    "title": "radius-mac-auth-bypass"
                                  },
                                  "delay-tcp-npu-session": {
                                    "type": "string",
                                    "description": "delay-tcp-npu-session of the policy",
                                    "title": "delay-tcp-npu-session"
                                  },
                                  "vlan-filter": {
                                    "type": "string",
                                    "description": "vlan-filter of the policy",
                                    "title": "vlan-filter"
                                  }
                                }
                              }
                            }
                          }
                        },
                        "summary": "Check if IP/URL is blocked",
                        "description": "Action used to block IP/URL",
                        "operationId": "[[variables('_operationId-CheckIFIP_URLBlocked')]",
                        "parameters": "[variables('TemplateEmptyArray')]"
                      }
                    },
                    "/api/v2/cmdb/firewall/address/{name}": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "http_method": {
                                  "type": "string",
                                  "description": "http_method to call the API",
                                  "title": "http_method"
                                },
                                "revision": {
                                  "type": "string",
                                  "description": "revision of an address object",
                                  "title": "revision"
                                },
                                "results": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "name": {
                                        "type": "string",
                                        "description": "Name of an address object",
                                        "title": "name"
                                      },
                                      "q_origin_key": {
                                        "type": "string",
                                        "description": "q_origin_key of an address object",
                                        "title": "q_orgin_key"
                                      },
                                      "uuid": {
                                        "type": "string",
                                        "description": "unique of an address object",
                                        "title": "uuid"
                                      },
                                      "subnet": {
                                        "type": "string",
                                        "description": "subnet of an address object",
                                        "title": "subnet"
                                      },
                                      "type": {
                                        "type": "string",
                                        "description": "type",
                                        "title": "type"
                                      },
                                      "sub-type": {
                                        "type": "string",
                                        "description": "sub-type of an address object",
                                        "title": "sub-type"
                                      },
                                      "clearpass-spt": {
                                        "type": "string",
                                        "description": "clearpass-spt of an address object",
                                        "title": "clearpass-spt"
                                      },
                                      "start-mac": {
                                        "type": "string",
                                        "description": "start-mac of an address object",
                                        "title": "start-mac"
                                      },
                                      "end-mac": {
                                        "type": "string",
                                        "description": "end-mac address of the address object",
                                        "title": "end-mac"
                                      },
                                      "country": {
                                        "type": "string",
                                        "description": "country of the address object",
                                        "title": "country"
                                      },
                                      "cache-ttl": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "cache-ttl of the address group",
                                        "title": "cache-ttl"
                                      },
                                      "sdn": {
                                        "type": "string",
                                        "description": "sdn of an address object",
                                        "title": "sdn"
                                      },
                                      "fsso-group": {
                                        "type": "array",
                                        "description": "fsso-group"
                                      },
                                      "interface": {
                                        "type": "string",
                                        "description": "interface of an address group",
                                        "title": "interface"
                                      },
                                      "obj-type": {
                                        "type": "string",
                                        "description": "obj-type of an address object",
                                        "title": "obj-type"
                                      },
                                      "comment": {
                                        "type": "string",
                                        "description": "comment of the address object",
                                        "title": "comment"
                                      },
                                      "associated-interface": {
                                        "type": "string",
                                        "description": "associated-interface of the address object",
                                        "title": "associated-interface"
                                      },
                                      "color": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "color of the address object",
                                        "title": "color"
                                      },
                                      "filter": {
                                        "type": "string",
                                        "description": "filter of an address object",
                                        "title": "filter"
                                      },
                                      "sdn-addr-type": {
                                        "type": "string",
                                        "description": "sdn-addr-type of an address object",
                                        "title": "sdn-addr-type"
                                      },
                                      "obj-id": {
                                        "type": "string",
                                        "description": "obj-id  of an address object",
                                        "title": "obj-id"
                                      },
                                      "list": {
                                        "type": "array",
                                        "description": "list"
                                      },
                                      "tagging": {
                                        "type": "array",
                                        "description": "tagging"
                                      },
                                      "allow-routing": {
                                        "type": "string",
                                        "description": "allow-routing of the address object",
                                        "title": "allow-routing"
                                      },
                                      "fabric-object": {
                                        "type": "string",
                                        "description": "fabric-object of an address object",
                                        "title": "fabric-object"
                                      },
                                      "start-ip": {
                                        "type": "string",
                                        "description": "start-ip of an address object",
                                        "title": "start-ip"
                                      },
                                      "end-ip": {
                                        "type": "string",
                                        "description": "end-ip of the address object",
                                        "title": "end-ip"
                                      },
                                      "obj-tag": {
                                        "type": "string",
                                        "description": "obj-tag of an address object",
                                        "title": "obj-tag"
                                      },
                                      "fqdn": {
                                        "type": "string",
                                        "description": "fqdn of an address object",
                                        "title": "fqdn"
                                      }
                                    }
                                  },
                                  "description": "results"
                                },
                                "vdom": {
                                  "type": "string",
                                  "description": "virtual domain of an address object",
                                  "title": "vdom"
                                },
                                "path": {
                                  "type": "string",
                                  "description": "path of the address object",
                                  "title": "path"
                                },
                                "name": {
                                  "type": "string",
                                  "description": "Name of the entities",
                                  "title": "name"
                                },
                                "status": {
                                  "type": "string",
                                  "description": "status of an address object",
                                  "title": "status"
                                },
                                "http_status": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "http_status"
                                },
                                "serial": {
                                  "type": "string",
                                  "description": "serial of an address object",
                                  "title": "serial"
                                },
                                "version": {
                                  "type": "string",
                                  "description": "version of an address object",
                                  "title": "version"
                                },
                                "build": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "build number",
                                  "title": "build"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Get an address object",
                        "description": "Action used to fetch the details of particular address object",
                        "operationId": "[[variables('_operationId-GetAddressObject')]",
                        "parameters": [
                          {
                            "name": "name",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "description": "Please enter address object name which you like get details"
                          }
                        ]
                      }
                    }
                  },
                  "securityDefinitions": {
                    "API Key": {
                      "type": "apiKey",
                      "in": "header",
                      "name": "Authorization"
                    }
                  },
                  "security": [
                    {
                      "API Key": "[variables('TemplateEmptyArray')]"
                    }
                  ],
                  "tags": "[variables('TemplateEmptyArray')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Fortinet FortiGate Next-Generation Firewall connector for Microsoft Sentinel",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "comments": "This Fortinet custom connector uses Fortinet-Fortigate API to perform different actions on Forinet VM",
            "lastUpdateTime": "2024-11-14T15:07:30.498Z",
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "LogicAppsCustomConnector",
        "displayName": "FortinetCustomConnector",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Fortinet-FortiGate-IPEnrichment Playbook with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Fortinet-FortiGate-IPEnrichment",
              "type": "String",
              "metadata": {
                "description": "PlayBook Name"
              }
            },
            "Address Group": {
              "defaultValue": "AddressGroup",
              "type": "String",
              "metadata": {
                "description": "Address Group"
              }
            },
            "FunctionAppName": {
              "defaultValue": "FortinetFortigateFunctionApp",
              "type": "String",
              "metadata": {
                "description": "Function app Name"
              }
            },
            "User Identifier Name": {
              "defaultValue": "fortinetuseridentity",
              "type": "String",
              "metadata": {
                "description": "User identity"
              }
            },
            "AzureManagementLink": {
              "type": "String",
              "defaultValue": "[concat('https://management','.azure','.com')]"
            },
            "location": {
              "type": "string",
              "minLength": 1,
              "defaultValue": "[concat('[resourceGroup().locatio', 'n]')]",
              "metadata": {
                "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "UserIdentifier": "[[parameters('User Identifier Name')]",
            "Functionappname": "[[parameters('FunctionAppName')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "runAfter": {
                        "For_each_IP": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['object']?['id']",
                          "message": "<p>Fortinet Playbook ran and fetched the below Information:<br>\n@{variables('commentDes')}</p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      }
                    },
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      },
                      "description": "Get Entities get all IPs",
                      "runtimeConfiguration": {
                        "staticResult": {
                          "staticResultOptions": "Disabled",
                          "name": "Entities_-_Get_IPs0"
                        }
                      }
                    },
                    "For_each_IP": {
                      "type": "Foreach",
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Condition_to_check_if_Ip_address_already_present_in_list_of_address_objects": {
                          "type": "If",
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Parse_JSON_for_address_object_dynamic_content'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "actions": {
                            "Append_to_array_variable_address_object_details": {
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "commentDes",
                                "value": "@body('Create_HTML_table_address_object_details')"
                              },
                              "runAfter": {
                                "Create_HTML_table_address_object_details": [
                                  "Succeeded"
                                ]
                              },
                              "description": "This appends address object details"
                            },
                            "Condition_to_check_if_Ip_already_present_in_predefined_address_group": {
                              "type": "If",
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@length(body('Filter_array_address_name_from_address_group'))",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "actions": {
                                "Append_to_string_variable": {
                                  "type": "AppendToStringVariable",
                                  "inputs": {
                                    "name": "commentDes",
                                    "value": "There is an address object for this IP and this address object is a part of address group.\n"
                                  }
                                },
                                "Append_to_string_variable_comment_address_group_details": {
                                  "type": "AppendToStringVariable",
                                  "inputs": {
                                    "name": "commentDes",
                                    "value": "Below are the details:\nAddress group details:\n@{body('Create_HTML_table_for_address_group_details')}\nAddress object details:"
                                  },
                                  "runAfter": {
                                    "Create_HTML_table_for_address_group_details": [
                                      "Succeeded"
                                    ]
                                  }
                                },
                                "Create_HTML_table_for_address_group_details": {
                                  "type": "Table",
                                  "inputs": {
                                    "from": "@body('Parse_JSON_for_address_group_dynamic_content')",
                                    "format": "HTML",
                                    "columns": [
                                      {
                                        "header": "name",
                                        "value": "@item()['name']"
                                      },
                                      {
                                        "header": "groupId",
                                        "value": "@item()['uuid']"
                                      },
                                      {
                                        "header": "type",
                                        "value": "@item()['type']"
                                      },
                                      {
                                        "header": "q_origin_key",
                                        "value": "@item()['q_origin_key']"
                                      },
                                      {
                                        "header": "allow_routing",
                                        "value": "@item()['allow-routing']"
                                      }
                                    ]
                                  },
                                  "runAfter": {
                                    "Append_to_string_variable": [
                                      "Succeeded"
                                    ]
                                  },
                                  "description": "This creates table of objects from address group"
                                }
                              },
                              "runAfter": {
                                "Filter_array_address_name_from_address_group": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Append_to_string_variable_comment_if_address_object_exist": {
                                    "type": "AppendToStringVariable",
                                    "inputs": {
                                      "name": "commentDes",
                                      "value": "There is an address object for this IP and this address object is not a part of predefined address group.\nBelow are the address object details:"
                                    }
                                  }
                                }
                              },
                              "description": "condition to check the malicious IP address is present in the predefined address group"
                            },
                            "Create_HTML_table_address_object_details": {
                              "type": "Table",
                              "inputs": {
                                "from": "@body('Parse_JSON_for_address_object_dynamic_content')",
                                "format": "HTML",
                                "columns": [
                                  {
                                    "header": "name",
                                    "value": "@item()['name']"
                                  },
                                  {
                                    "header": "type",
                                    "value": "@item()?['type']"
                                  },
                                  {
                                    "header": "start-ip",
                                    "value": "@item()?['start-ip']"
                                  },
                                  {
                                    "header": "end-ip",
                                    "value": "@item()?['end-ip']"
                                  },
                                  {
                                    "header": "q_origin_key",
                                    "value": "@item()['q_origin_key']"
                                  },
                                  {
                                    "header": "start-mac",
                                    "value": "@item()?['start-mac']"
                                  },
                                  {
                                    "header": "end-mac",
                                    "value": "@item()?['end-mac']"
                                  },
                                  {
                                    "header": "addressobjectid",
                                    "value": "@item()?['uuid']"
                                  },
                                  {
                                    "header": "allow-routing",
                                    "value": "@item()?['allow-routing']"
                                  }
                                ]
                              },
                              "runAfter": {
                                "Condition_to_check_if_Ip_already_present_in_predefined_address_group": [
                                  "Succeeded"
                                ]
                              },
                              "description": "This create table of content for address object"
                            },
                            "Filter_array_address_name_from_address_group": {
                              "type": "Query",
                              "inputs": {
                                "from": "@body('Parse_JSON_for_address_group_dynamic_content')?[0]?['member']",
                                "where": "@contains(item()['name'], body('Parse_JSON_for_address_object_dynamic_content')?[0]?['name'])"
                              },
                              "description": "This filters the address name of address object from address group"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON_for_address_group_dynamic_content": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_to_array_variable_comment": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "Comment",
                                  "value": "There is no address object for this IP"
                                }
                              }
                            }
                          },
                          "description": "This checks if Ip is a member of any of the list of address objects"
                        },
                        "Construct_filter_for_address_group": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "filter",
                            "value": "filter=member=@{concat('@',body('Parse_JSON_for_address_object_dynamic_content')[0]?['name'])}"
                          },
                          "runAfter": {
                            "Parse_JSON_for_address_object_dynamic_content": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Construct_filter_for_address_object": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "filter",
                            "value": "filter=start-ip=@{concat('@',items('for_each_IP')?['Address'])}"
                          },
                          "description": "Filter construction to apply on get the details of address object API call"
                        },
                        "Fetch_the_details_of_the_address_object": {
                          "type": "Function",
                          "inputs": {
                            "method": "GET",
                            "queries": {
                              "entity": "address",
                              "filter": "@{variables('filter')}"
                            },
                            "authentication": {
                              "audience": "[[parameters('AzureManagementLink')]",
                              "identity": "[[variables('UserIdentifier')]",
                              "type": "ManagedServiceIdentity"
                            },
                            "function": {
                              "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/sites/',parameters('FunctionAppName'),'/functions/Fortinet-GetEntityDetails')]"
                            }
                          },
                          "runAfter": {
                            "Construct_filter_for_address_object": [
                              "Succeeded"
                            ]
                          },
                          "description": "This gets the address object details"
                        },
                        "Get_address_group_details": {
                          "type": "Function",
                          "inputs": {
                            "method": "GET",
                            "queries": {
                              "entity": "addrgrp",
                              "filter": "@variables('filter')"
                            },
                            "authentication": {
                              "audience": "[[parameters('AzureManagementLink')]",
                              "identity": "[[variables('UserIdentifier')]",
                              "type": "ManagedServiceIdentity"
                            },
                            "function": {
                              "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/sites/',parameters('FunctionAppName'),'/functions/Fortinet-GetEntityDetails')]"
                            }
                          },
                          "runAfter": {
                            "Construct_filter_for_address_group": [
                              "Succeeded"
                            ]
                          },
                          "description": "This gets the address group details"
                        },
                        "Parse_JSON_for_address_group_dynamic_content": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Parse_address_group_JSON')",
                            "schema": {
                              "items": {
                                "properties": {
                                  "allow-routing": {
                                    "description": "allow-routing of  of an address group",
                                    "type": "string"
                                  },
                                  "color": {
                                    "description": "color of  of an address group",
                                    "type": "integer"
                                  },
                                  "comment": {
                                    "description": "comment of  of an address group",
                                    "type": "string"
                                  },
                                  "exclude": {
                                    "description": "exclude of  of an address group",
                                    "type": "string"
                                  },
                                  "exclude-member": {
                                    "type": "array"
                                  },
                                  "fabric-object": {
                                    "description": "fabric-object of  of an address group",
                                    "type": "string"
                                  },
                                  "member": {
                                    "items": {
                                      "properties": {
                                        "name": {
                                          "description": "member name",
                                          "type": "string"
                                        },
                                        "q_origin_key": {
                                          "description": "member q_origin_key",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "name",
                                        "q_origin_key"
                                      ],
                                      "type": "object"
                                    },
                                    "type": "array"
                                  },
                                  "name": {
                                    "description": "name of an address group",
                                    "type": "string"
                                  },
                                  "q_origin_key": {
                                    "description": "q_origin_key of an address group",
                                    "type": "string"
                                  },
                                  "tagging": {
                                    "description": "tagging of an address group",
                                    "type": "array"
                                  },
                                  "type": {
                                    "description": "type of an address group",
                                    "type": "string"
                                  },
                                  "uuid": {
                                    "description": "uuid of an address group",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "name",
                                  "q_origin_key",
                                  "type",
                                  "uuid",
                                  "member",
                                  "comment",
                                  "exclude",
                                  "exclude-member",
                                  "color",
                                  "tagging",
                                  "allow-routing",
                                  "fabric-object"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          },
                          "runAfter": {
                            "Parse_address_group_JSON": [
                              "Succeeded"
                            ]
                          },
                          "description": "Parse JSON for the address group dynamic content"
                        },
                        "Parse_JSON_for_address_object_dynamic_content": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Parse_JSON_for_the_address_object_body')",
                            "schema": {
                              "items": {
                                "properties": {
                                  "allow-routing": {
                                    "description": "Allow routing enabling and disabling",
                                    "type": "string"
                                  },
                                  "associated-interface": {
                                    "description": "Associated interface",
                                    "type": "string"
                                  },
                                  "cache-ttl": {
                                    "description": "cache-ttl of an address object",
                                    "type": "integer"
                                  },
                                  "clearpass-spt": {
                                    "description": "clearpass-spt of an address object",
                                    "type": "string"
                                  },
                                  "color": {
                                    "description": "color of an adddress object",
                                    "type": "integer"
                                  },
                                  "comment": {
                                    "description": "comment of an address object",
                                    "type": "string"
                                  },
                                  "country": {
                                    "description": "comment of an address object",
                                    "type": "string"
                                  },
                                  "end-ip": {
                                    "description": "end-ip of an address object",
                                    "type": "string"
                                  },
                                  "end-mac": {
                                    "description": "end-mac of an address object",
                                    "type": "string"
                                  },
                                  "fabric-object": {
                                    "description": "fabric-object of an address object",
                                    "type": "string"
                                  },
                                  "filter": {
                                    "description": "filter of an address object",
                                    "type": "string"
                                  },
                                  "fsso-group": {
                                    "description": "fsso of an address object",
                                    "type": "array"
                                  },
                                  "interface": {
                                    "description": "type of an address object",
                                    "type": "string"
                                  },
                                  "list": {
                                    "description": "List of an address object",
                                    "type": "array"
                                  },
                                  "name": {
                                    "description": "Name of an address object",
                                    "type": "string"
                                  },
                                  "obj-id": {
                                    "description": "obj-id of an address object",
                                    "type": "string"
                                  },
                                  "obj-type": {
                                    "description": "obj-type of an address object",
                                    "type": "string"
                                  },
                                  "q_origin_key": {
                                    "description": "q_origin_key of an address object",
                                    "type": "string"
                                  },
                                  "sdn": {
                                    "description": "sdn of an address object",
                                    "type": "string"
                                  },
                                  "sdn-addr-type": {
                                    "description": "sdn-addr-type of an address object",
                                    "type": "string"
                                  },
                                  "start-ip": {
                                    "description": "start-ip of an address object",
                                    "type": "string"
                                  },
                                  "start-mac": {
                                    "description": "start-mac of an address object",
                                    "type": "string"
                                  },
                                  "sub-type": {
                                    "description": "sub-type of an address object",
                                    "type": "string"
                                  },
                                  "tagging": {
                                    "description": "tagging of an address object",
                                    "type": "array"
                                  },
                                  "type": {
                                    "description": "type of an address object",
                                    "type": "string"
                                  },
                                  "uuid": {
                                    "description": "UUid of an address object",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "name",
                                  "q_origin_key"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON_for_the_address_object_body": [
                              "Succeeded"
                            ]
                          },
                          "description": "Parse JSON for the address object dynamic content"
                        },
                        "Parse_JSON_for_the_address_object_body": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Fetch_the_details_of_the_address_object')",
                            "schema": {
                              "$schema": "http://json-schema.org/draft-04/schema#",
                              "items": [
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-tag": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-tag",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                }
                              ],
                              "type": "array"
                            }
                          },
                          "runAfter": {
                            "Fetch_the_details_of_the_address_object": [
                              "Succeeded"
                            ]
                          },
                          "description": "Parse body of the address object"
                        },
                        "Parse_address_group_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_address_group_details')",
                            "schema": {
                              "$schema": "http://json-schema.org/draft-04/schema#",
                              "items": [
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "exclude": {
                                      "type": "string"
                                    },
                                    "exclude-member": {
                                      "type": "array"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "member": {
                                      "items": [
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        }
                                      ],
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "type",
                                    "uuid",
                                    "member",
                                    "comment",
                                    "exclude",
                                    "exclude-member",
                                    "color",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                }
                              ],
                              "type": "array"
                            }
                          },
                          "runAfter": {
                            "Get_address_group_details": [
                              "Succeeded"
                            ]
                          },
                          "description": "To parse the output of the function address group in to JSON"
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_comment_Description": [
                          "Succeeded"
                        ]
                      },
                      "description": "loops on each malicious IP"
                    },
                    "Initialize_variable_comment_": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Comment",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "description": "This is used to comment in the incident"
                    },
                    "Initialize_variable_comment_Description": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "commentDes",
                            "type": "string"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_variable_filter": [
                          "Succeeded"
                        ]
                      }
                    },
                    "Initialize_variable_filter": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "filter",
                            "type": "string"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_variable_comment_": [
                          "Succeeded"
                        ]
                      },
                      "description": "Initialize variable for function call to apply filter on API call"
                    }
                  },
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "staticResults": {
                    "Entities_-_Get_IPs0": {
                      "status": "Succeeded",
                      "outputs": {
                        "body": {
                          "IPs": [
                            {
                              "Address": "81.42.197.222"
                            }
                          ]
                        },
                        "statusCode": "OK"
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/azuresentinel')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "UserAssigned"
              },
              "apiVersion": "2016-06-01",
              "tags": {
                "displayName": "LogicApp",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[parameters('location')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Fortinet FortiGate Next-Generation Firewall connector for Microsoft Sentinel",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "AzureFunction",
                      "contentId": "[variables('_FortinetFortigateFunctionApp')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Fortinet-FortiGate-IPEnrichment",
            "description": "This playbook enriches the incident with address object and address group.",
            "prerequisites": [
              "- Sentinel IP block group should create in the VM \n\n - Function App needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the Function doc page."
            ],
            "lastUpdateTime": "2022-08-01T00:00:00Z",
            "mainSteps": [
              "When a new Microsoft Sentinel is created, this playbook gets triggered and performs below actions: \n\n - It fetches details of the address object. \n\n - It retrieve the details of address groups which address object is belongs to. \n\n - Add the Summary of address object and its groups details to an incident."
            ],
            "entities": [
              "Ip"
            ],
            "postDeployment": [
              "** a. Authorize connections ** \n\n Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n ** b. Configurations in Sentinel ** \n\n - In Microsoft sentinel analytical rules should be configured to trigger an incident with IP Entity. \n\n - Configure the automation rules to trigger this playbook"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Fortinet-FortiGate-IPEnrichment",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "Fortinet-FortiGate-IPEnrichment",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Fortinet-FortiGate-ResponseOnBlockIP Playbook with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Fortinet-FortiGate-ResponseOnBlockIP",
              "type": "String"
            },
            "Teams GroupId": {
              "defaultValue": "TeamgroupId",
              "type": "String",
              "metadata": {
                "description": "GroupId of the Team channel"
              }
            },
            "Teams ChannelId": {
              "defaultValue": "TeamChannelId",
              "type": "String",
              "metadata": {
                "description": "Team ChannelId"
              }
            },
            "Address Group": {
              "defaultValue": "AddressGroup",
              "type": "String",
              "metadata": {
                "description": "Address Group"
              }
            },
            "FunctionAppName": {
              "defaultValue": "FortinetFortigateFunctionApp",
              "type": "String",
              "metadata": {
                "description": "Function app name"
              }
            },
            "User Identifier Name": {
              "defaultValue": "fortinetuseridentity",
              "type": "String",
              "metadata": {
                "description": "User Identity"
              }
            },
            "AzureManagementLink": {
              "type": "String",
              "defaultValue": "[concat('https://management','.azure','.com')]"
            },
            "CustomConnectorName": {
              "defaultValue": "FortinetCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Name of the Connector"
              }
            },
            "location": {
              "type": "string",
              "minLength": 1,
              "defaultValue": "[concat('[resourceGroup().locatio', 'n]')]",
              "metadata": {
                "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[[concat('teamsconnector-', parameters('PlaybookName'))]",
            "FortinetConnectorConnectionName": "[[concat('FortinetConnector-', parameters('PlaybookName'))]",
            "UserIdentifier": "[[parameters('User Identifier Name')]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/teams')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('FortinetConnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('TeamsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "UserAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('FortinetConnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Condition_based_on_the_incident_configuration_from_adaptive_card": {
                      "actions": {
                        "Add_comment_to_incident_(V3)_3": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>Fortinet Playbook ran and performed the following actions:<br>\n@{variables('Comments')}<br>\nActions taken on Sentinel : Add comment to incident and closure with classification reason &nbsp;: @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2')['data']['incidentStatus']}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Update_incident": {
                          "runAfter": {
                            "Add_comment_to_incident_(V3)_3": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "classification": {
                                "ClassificationAndReason": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2')['data']['incidentStatus']}"
                              },
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "severity": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2')['data']['incidentSeverity']}",
                              "status": "Closed"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          }
                        }
                      },
                      "runAfter": {
                        "For_each": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>Fortinet Playbook ran and performed the following actions:<br>\n@{variables('Comments')}<br>\nActions taken on Sentinel : Add comment to incident&nbsp;</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2')?['submitActionId']",
                              "Change incident configuration"
                            ]
                          }
                        ]
                      },
                      "type": "If",
                      "description": "This decides the action taken on the summarized adaptive card"
                    },
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      }
                    },
                    "For_each": {
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Append_to_string_variable_for_comment": {
                          "runAfter": {
                            "Create_HTML_table_comment": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "Comments",
                            "value": "@body('Create_HTML_table_comment')"
                          }
                        },
                        "Create_HTML_table_comment": {
                          "type": "Table",
                          "inputs": {
                            "columns": [
                              {
                                "header": "URL_Address",
                                "value": "@items('For_each')?['Address']"
                              },
                              {
                                "header": "Action_Taken",
                                "value": "@variables('actionName')"
                              }
                            ],
                            "format": "HTML",
                            "from": "@variables('IPAddressAction')"
                          },
                          "description": "Construct HTML table for the comment"
                        }
                      },
                      "runAfter": {
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_malicious_IP": {
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Address_group_details": {
                          "runAfter": {
                            "Set_variable_filter_for_address_group_function_call": [
                              "Succeeded"
                            ]
                          },
                          "type": "Function",
                          "inputs": {
                            "authentication": {
                              "audience": "[[parameters('AzureManagementLink')]",
                              "identity": "[[variables('UserIdentifier')]",
                              "type": "ManagedServiceIdentity"
                            },
                            "function": {
                              "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/sites/',parameters('FunctionAppName'),'/functions/Fortinet-GetEntityDetails')]"
                            },
                            "method": "GET",
                            "queries": {
                              "entity": "addrgrp",
                              "filter": "@{variables('filter')}"
                            }
                          },
                          "description": "This gets the address group details from fortinet"
                        },
                        "Check_address_object_is_already_exist_in_firewall": {
                          "runAfter": {
                            "Set_variable_filter_for_address_object_function_call": [
                              "Succeeded"
                            ]
                          },
                          "type": "Function",
                          "inputs": {
                            "authentication": {
                              "audience": "[[parameters('AzureManagementLink')]",
                              "identity": "[[variables('UserIdentifier')]",
                              "type": "ManagedServiceIdentity"
                            },
                            "function": {
                              "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/sites/',parameters('FunctionAppName'),'/functions/Fortinet-GetEntityDetails')]"
                            },
                            "method": "GET",
                            "queries": {
                              "entity": "address",
                              "filter": "@variables('filter')"
                            }
                          },
                          "description": "Getting the address object details from firewall"
                        },
                        "Condition_based_on_user_inputs_from_the_adaptive_card": {
                          "actions": {
                            "Append_to_variable_action_taken_on_IP_address": {
                              "runAfter": {
                                "Update_address_group": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "IPAddressAction",
                                "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']}  "
                              },
                              "description": "Append action taken and IP details to IPAddressAction"
                            },
                            "Condition_to_check_if_user_chosen_Block_IP": {
                              "actions": {
                                "Append_to_array_variable_for_new_address_object": {
                                  "runAfter": {
                                    "Create_an_address_object": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "memberCollection",
                                    "value": {
                                      "name": "@body('Create_an_address_object')?['mkey']",
                                      "q_origin_key": "@body('Create_an_address_object')?['mkey']"
                                    }
                                  },
                                  "description": "This appends address object to array variable for new address object"
                                },
                                "Create_an_address_object": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "end-ip": "@items('For_each_malicious_IP')?['Address']",
                                      "name": "Fortinet_@{items('For_each_malicious_IP')?['Address']}",
                                      "start-ip": "@items('For_each_malicious_IP')?['Address']",
                                      "type": "iprange"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['FortinetConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/api/v2/cmdb/firewall/address"
                                  },
                                  "description": "Create an address object to add an address in to firewall"
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                      "Block IP"
                                    ]
                                  },
                                  {
                                    "equals": [
                                      "@length(body('Parse_JSON_for_address_object_dynamic_content'))",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If",
                              "description": "This check if user chooses Block IP"
                            },
                            "Update_address_group": {
                              "runAfter": {
                                "Condition_to_check_if_user_chosen_Block_IP": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "member": "@variables('memberCollection')",
                                  "name": "@variables('Pre-definedGroupName')"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['FortinetConnector']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "/api/v2/cmdb/firewall/addrgrp/@{encodeURIComponent(variables('Pre-definedGroupName'))}"
                              }
                            }
                          },
                          "runAfter": {
                            "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_to_array_variable": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "IPAddressAction",
                                  "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status :  Success    "
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                    "Ignore"
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If",
                          "description": "condition to check the submit action is block / unblock or Ignore"
                        },
                        "Condition_to_check_if_Ip_address_already_present_in_list_of_address_objects": {
                          "actions": {
                            "Condition_to_check_if_Ip_already_present_in_predefined_address_group": {
                              "actions": {
                                "Append_to_adaptive_card_body_if_IP_is_a_member_of_blocked_address_group": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "adaptivecardBody",
                                    "value": {
                                      "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is already a member of the blocked address group",
                                      "type": "TextBlock",
                                      "wrap": true
                                    }
                                  },
                                  "description": "This appends the text to display If Ip is a member of blocked address group"
                                },
                                "For_each_address_object": {
                                  "foreach": "@body('Parse_JSON_for_address_object_dynamic_content')",
                                  "actions": {
                                    "Filter_array_address_objects_to_remove_from_address_group": {
                                      "type": "Query",
                                      "inputs": {
                                        "from": "@variables('memberCollection')",
                                        "where": "@not(equals(item()?['name'], items('For_each_address_object')['name']))"
                                      },
                                      "description": "This filter is used to remove address objects if already exist"
                                    },
                                    "Set_variable_address_group_members_in_unblock_case": {
                                      "runAfter": {
                                        "Filter_array_address_objects_to_remove_from_address_group": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "memberCollection",
                                        "value": "@body('Filter_array_address_objects_to_remove_from_address_group')"
                                      },
                                      "description": "This sets the address group members"
                                    }
                                  },
                                  "runAfter": {
                                    "Set_dynamic_action_name_variable_to_unblock": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach",
                                  "description": "For each address object member"
                                },
                                "Set_dynamic_action_name_variable_to_unblock": {
                                  "runAfter": {
                                    "Append_to_adaptive_card_body_if_IP_is_a_member_of_blocked_address_group": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "actionName",
                                    "value": "UnBlock IP"
                                  },
                                  "description": "variable to set action name dynamically"
                                }
                              },
                              "runAfter": {
                                "Filter_array_address_name_from_address_group": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Append_to_adaptive_card_body_text_if_IP_is_not_a_member_of_blocked_address_group": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "adaptivecardBody",
                                      "value": {
                                        "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is not a member of the blocked address group ",
                                        "type": "TextBlock",
                                        "wrap": true
                                      }
                                    },
                                    "description": "This appends the text to display If Ip is a member of blocked address group"
                                  },
                                  "For_each_address_object_member": {
                                    "foreach": "@body('Parse_JSON_for_address_object_dynamic_content')",
                                    "actions": {
                                      "Append_to_array_variable_address_object_group": {
                                        "type": "AppendToArrayVariable",
                                        "inputs": {
                                          "name": "memberCollection",
                                          "value": {
                                            "name": "@items('For_each_address_object_member')['name']",
                                            "q_origin_key": "@items('For_each_address_object_member')['name']"
                                          }
                                        },
                                        "description": "This appends address object members to existing members"
                                      }
                                    },
                                    "runAfter": {
                                      "Set_dynamic_variable_action_name": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "Foreach"
                                  },
                                  "Set_dynamic_variable_action_name": {
                                    "runAfter": {
                                      "Append_to_adaptive_card_body_text_if_IP_is_not_a_member_of_blocked_address_group": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "SetVariable",
                                    "inputs": {
                                      "name": "actionName",
                                      "value": "Block IP"
                                    },
                                    "description": "variable to set action name dynamically"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@length(body('Filter_array_address_name_from_address_group'))",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If",
                              "description": "condition to check the malicious IP address is present in the predefined address group"
                            },
                            "Filter_array_address_name_from_address_group": {
                              "type": "Query",
                              "inputs": {
                                "from": "@body('Parse_JSON_for_address_group_dynamic_content')?[0]?['member']",
                                "where": "@equals(item()?['name'], body('Parse_JSON_for_address_object_dynamic_content')?[0]?['name'])"
                              },
                              "description": "This filters the address name of address object from address group"
                            }
                          },
                          "runAfter": {
                            "Set_variable_address_group_members": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_to_adaptive_card_body_if_IP_is_not_a_member_of_blocked_address_group": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "adaptivecardBody",
                                  "value": {
                                    "text": "The IP @{items('For_each_malicious_IP')?['Address']} is not a member of the blocked address group ",
                                    "type": "TextBlock",
                                    "wrap": true
                                  }
                                },
                                "description": "This appends the text to display If Ip is not a member of blocked address group"
                              },
                              "For_each_new_IP": {
                                "foreach": "@body('Parse_JSON_for_address_object_dynamic_content')",
                                "actions": {
                                  "Append_to_address_group_members_in_case_of_new_IP": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "memberCollection",
                                      "value": {
                                        "name": "@items('For_each_new_IP')['name']",
                                        "q_origin_key": "@items('For_each_new_IP')['name']"
                                      }
                                    },
                                    "description": "Appends address objects to existing object"
                                  }
                                },
                                "runAfter": {
                                  "Set_variable_address_group_members_in_case_of_new_address_object": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Foreach",
                                "description": "iterates on address object body for each new IP"
                              },
                              "Set_variable_action_name_to_Block_Ip": {
                                "runAfter": {
                                  "Append_to_adaptive_card_body_if_IP_is_not_a_member_of_blocked_address_group": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "actionName",
                                  "value": "Block IP"
                                },
                                "description": "This sets the variable block IP"
                              },
                              "Set_variable_address_group_members_in_case_of_new_address_object": {
                                "runAfter": {
                                  "Set_variable_action_name_to_Block_Ip": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "memberCollection",
                                  "value": "@body('Parse_JSON_for_address_group_dynamic_content')?[0]?['member']"
                                },
                                "description": "This sets address group members"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Parse_JSON_for_address_object_dynamic_content'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If",
                          "description": "This checks if Ip is a member of any of the list of address objects"
                        },
                        "Parse_JSON_for_address_group_dynamic_content": {
                          "runAfter": {
                            "Parse_address_group_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Parse_address_group_JSON')",
                            "schema": {
                              "items": {
                                "properties": {
                                  "allow-routing": {
                                    "description": "allow-routing of  of an address group",
                                    "type": "string"
                                  },
                                  "color": {
                                    "description": "color of  of an address group",
                                    "type": "integer"
                                  },
                                  "comment": {
                                    "description": "comment of  of an address group",
                                    "type": "string"
                                  },
                                  "exclude": {
                                    "description": "exclude of  of an address group",
                                    "type": "string"
                                  },
                                  "exclude-member": {
                                    "type": "array"
                                  },
                                  "fabric-object": {
                                    "description": "fabric-object of  of an address group",
                                    "type": "string"
                                  },
                                  "member": {
                                    "items": {
                                      "properties": {
                                        "name": {
                                          "description": "member name",
                                          "type": "string"
                                        },
                                        "q_origin_key": {
                                          "description": "member q_origin_key",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "name",
                                        "q_origin_key"
                                      ],
                                      "type": "object"
                                    },
                                    "type": "array"
                                  },
                                  "name": {
                                    "description": "name of an address group",
                                    "type": "string"
                                  },
                                  "q_origin_key": {
                                    "description": "q_origin_key of an address group",
                                    "type": "string"
                                  },
                                  "tagging": {
                                    "description": "tagging of an address group",
                                    "type": "array"
                                  },
                                  "type": {
                                    "description": "type of an address group",
                                    "type": "string"
                                  },
                                  "uuid": {
                                    "description": "uuid of an address group",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "name",
                                  "q_origin_key",
                                  "type",
                                  "uuid",
                                  "member",
                                  "comment",
                                  "exclude",
                                  "exclude-member",
                                  "color",
                                  "tagging",
                                  "allow-routing",
                                  "fabric-object"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          }
                        },
                        "Parse_JSON_for_address_object_dynamic_content": {
                          "runAfter": {
                            "Parse_address_object_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Parse_address_object_JSON')",
                            "schema": {
                              "items": {
                                "properties": {
                                  "allow-routing": {
                                    "description": "Allow routing enabling and disabling",
                                    "type": "string"
                                  },
                                  "associated-interface": {
                                    "description": "Associated interface",
                                    "type": "string"
                                  },
                                  "cache-ttl": {
                                    "description": "cache-ttl of an address object",
                                    "type": "integer"
                                  },
                                  "clearpass-spt": {
                                    "description": "clearpass-spt of an address object",
                                    "type": "string"
                                  },
                                  "color": {
                                    "description": "color of an adddress object",
                                    "type": "integer"
                                  },
                                  "comment": {
                                    "description": "comment of an address object",
                                    "type": "string"
                                  },
                                  "country": {
                                    "description": "comment of an address object",
                                    "type": "string"
                                  },
                                  "end-ip": {
                                    "description": "end-ip of an address object",
                                    "type": "string"
                                  },
                                  "end-mac": {
                                    "description": "end-mac of an address object",
                                    "type": "string"
                                  },
                                  "fabric-object": {
                                    "description": "fabric-object of an address object",
                                    "type": "string"
                                  },
                                  "filter": {
                                    "description": "filter of an address object",
                                    "type": "string"
                                  },
                                  "fsso-group": {
                                    "description": "fsso of an address object",
                                    "type": "array"
                                  },
                                  "interface": {
                                    "description": "type of an address object",
                                    "type": "string"
                                  },
                                  "list": {
                                    "description": "List of an address object",
                                    "type": "array"
                                  },
                                  "name": {
                                    "description": "Name of an address object",
                                    "type": "string"
                                  },
                                  "obj-id": {
                                    "description": "obj-id of an address object",
                                    "type": "string"
                                  },
                                  "obj-type": {
                                    "description": "obj-type of an address object",
                                    "type": "string"
                                  },
                                  "q_origin_key": {
                                    "description": "q_origin_key of an address object",
                                    "type": "string"
                                  },
                                  "sdn": {
                                    "description": "sdn of an address object",
                                    "type": "string"
                                  },
                                  "sdn-addr-type": {
                                    "description": "sdn-addr-type of an address object",
                                    "type": "string"
                                  },
                                  "start-ip": {
                                    "description": "start-ip of an address object",
                                    "type": "string"
                                  },
                                  "start-mac": {
                                    "description": "start-mac of an address object",
                                    "type": "string"
                                  },
                                  "sub-type": {
                                    "description": "sub-type of an address object",
                                    "type": "string"
                                  },
                                  "tagging": {
                                    "description": "tagging of an address object",
                                    "type": "array"
                                  },
                                  "type": {
                                    "description": "type of an address object",
                                    "type": "string"
                                  },
                                  "uuid": {
                                    "description": "UUid of an address object",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "name",
                                  "q_origin_key"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          },
                          "description": "Parse body content and create dynamic content"
                        },
                        "Parse_address_group_JSON": {
                          "runAfter": {
                            "Address_group_details": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Address_group_details')",
                            "schema": {
                              "$schema": "http://json-schema.org/draft-04/schema#",
                              "items": [
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "exclude": {
                                      "type": "string"
                                    },
                                    "exclude-member": {
                                      "type": "array"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "member": {
                                      "items": [
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        }
                                      ],
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "type",
                                    "uuid",
                                    "member",
                                    "comment",
                                    "exclude",
                                    "exclude-member",
                                    "color",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                }
                              ],
                              "type": "array"
                            }
                          },
                          "description": "To parse the output of the function address group in to JSON"
                        },
                        "Parse_address_object_JSON": {
                          "runAfter": {
                            "Check_address_object_is_already_exist_in_firewall": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Check_address_object_is_already_exist_in_firewall')",
                            "schema": {
                              "$schema": "http://json-schema.org/draft-04/schema#",
                              "items": [
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-tag": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-tag",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-ip": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-ip": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "start-ip",
                                    "end-ip",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "subnet": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "subnet",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "associated-interface": {
                                      "type": "string"
                                    },
                                    "cache-ttl": {
                                      "type": "integer"
                                    },
                                    "clearpass-spt": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "country": {
                                      "type": "string"
                                    },
                                    "end-mac": {
                                      "type": "string"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "filter": {
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "type": "string"
                                    },
                                    "fsso-group": {
                                      "type": "array"
                                    },
                                    "interface": {
                                      "type": "string"
                                    },
                                    "list": {
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "obj-id": {
                                      "type": "string"
                                    },
                                    "obj-type": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "sdn": {
                                      "type": "string"
                                    },
                                    "sdn-addr-type": {
                                      "type": "string"
                                    },
                                    "start-mac": {
                                      "type": "string"
                                    },
                                    "sub-type": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "uuid",
                                    "type",
                                    "sub-type",
                                    "clearpass-spt",
                                    "start-mac",
                                    "end-mac",
                                    "fqdn",
                                    "country",
                                    "cache-ttl",
                                    "sdn",
                                    "fsso-group",
                                    "interface",
                                    "obj-type",
                                    "comment",
                                    "associated-interface",
                                    "color",
                                    "filter",
                                    "sdn-addr-type",
                                    "obj-id",
                                    "list",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                }
                              ],
                              "type": "array"
                            }
                          },
                          "description": "To parse the output of the function address object in to JSON"
                        },
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": {
                          "runAfter": {
                            "Condition_to_check_if_Ip_address_already_present_in_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnectionWebhook",
                          "inputs": {
                            "body": {
                              "body": {
                                "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\":@{variables('adaptivecardBody')} ,\n     \"actions\": [\n  {\n    \"title\": \"@{variables('actionName')}\",\n    \"type\": \"Action.Submit\"\n  },\n  {\n    \"title\": \"Ignore\",\n    \"type\": \"Action.Submit\"\n  }\n],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                "recipient": {
                                  "channelId": "19:7abc1180c1d84a3fba83770e34231132@thread.tacv2"
                                },
                                "shouldUpdateCard": true
                              },
                              "notificationUrl": "@{listCallbackUrl()}"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['teams']['connectionId']"
                              }
                            },
                            "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                            "queries": {
                              "groupId": "18de1100-ab2e-4505-be42-8263b915b221"
                            }
                          }
                        },
                        "Set_variable_adaptive_card_body": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "adaptivecardBody",
                            "value": [
                              {
                                "size": "Large",
                                "text": "Suspicious IP - Microsoft Sentinel",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Possible Comprised IP  detected by the provider ",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": " @{triggerBody()?['object']?['properties']?['severity']} Incident  @{triggerBody()?['object']?['properties']?['title']}",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": " Incident No :  @{triggerBody()?['object']?['properties']?['incidentNumber']} ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Incident description",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['description']}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "[[[[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "size": "Medium",
                                "text": "Response in Fortinet-Fortigate",
                                "type": "TextBlock",
                                "weight": "Bolder"
                              },
                              {
                                "size": "Small",
                                "style": "Person",
                                "type": "Image",
                                "url": "https://www.fortinet.com/content/dam/fortinet-blog/article-images/individual-images/logo.png"
                              }
                            ]
                          },
                          "description": "variable to hold adaptive card body"
                        },
                        "Set_variable_address_group_members": {
                          "runAfter": {
                            "Parse_JSON_for_address_group_dynamic_content": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "memberCollection",
                            "value": "@body('Parse_JSON_for_address_group_dynamic_content')?[0]?['member']"
                          },
                          "description": "assign list of address group members"
                        },
                        "Set_variable_filter_for_address_group_function_call": {
                          "runAfter": {
                            "Parse_JSON_for_address_object_dynamic_content": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "filter",
                            "value": "filter=name=@{concat('@',variables('Pre-definedGroupName'))}"
                          },
                          "description": "This sets the variable filter for address group azure function"
                        },
                        "Set_variable_filter_for_address_object_function_call": {
                          "runAfter": {
                            "Set_variable_adaptive_card_body": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "filter",
                            "value": "filter=start-ip=@{concat('@',items('For_each_malicious_IP')?['Address'])}"
                          },
                          "description": "This sets the variable filter for address object azure function"
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_comments": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "description": "For each IP which incident contains",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Initialize_variable_IP_address_action": {
                      "runAfter": {
                        "Initialize_variable_adaptive_card_body": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "IPAddressAction",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "This holds the action taken on each IP "
                    },
                    "Initialize_variable_action_name": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "actionName",
                            "type": "string"
                          }
                        ]
                      },
                      "description": "variable to store action name to be displayed on adaptive card"
                    },
                    "Initialize_variable_adaptive_card_body": {
                      "runAfter": {
                        "Initialize_variable_address_group_members": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "adaptivecardBody",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "variable to store adaptive card body json"
                    },
                    "Initialize_variable_address_group_members": {
                      "runAfter": {
                        "Initialize_variable_action_name": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "memberCollection",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "Array variable to assign member collection of pre-defined address group"
                    },
                    "Initialize_variable_comments": {
                      "runAfter": {
                        "Initialize_variable_pre-defined_group": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Comments",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_filter": {
                      "runAfter": {
                        "Initialize_variable_IP_address_action": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "filter",
                            "type": "string"
                          }
                        ]
                      },
                      "description": "This is used to hold the filter condition to use in the azure function"
                    },
                    "Initialize_variable_pre-defined_group": {
                      "runAfter": {
                        "Initialize_variable_filter": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Pre-definedGroupName",
                            "type": "string",
                            "value": "Sentinel IP Block"
                          }
                        ]
                      },
                      "description": "Pre-defined group name"
                    },
                    "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2": {
                      "runAfter": {
                        "Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "body": {
                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n           \n            \"weight\": \"Bolder\",\n            \"text\": \"Below is the summary of actions taken on IP's by SOC\",\n            \"wrap\": true\n        },\n  {\n    \"size\": \"Small\",\n    \"style\": \"Person\",\n    \"type\": \"Image\",\n    \"url\": \"https://www.fortinet.com/content/dam/fortinet-blog/article-images/individual-images/logo.png\"\n  },\n     {\n  \"columns\": [\n    {\n      \"items\":@{body('Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card')} ,\n      \"type\": \"Column\",\n      \"wrap\": true\n    }\n  ],\n  \"separator\": \"true\",\n  \"type\": \"ColumnSet\",\n  \"width\": \"stretch\"\n},\n {\n    \"text\": \" Incident No :  @{triggerBody()?['object']?['properties']?['incidentNumber']} \",\n    \"type\": \"TextBlock\",\n    \"weight\": \"Bolder\",\n    \"wrap\": true\n  },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})\",\n            \"wrap\": true\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration :\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Microsoft Sentinel incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                  \n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        }\n       \n     \n        \n    ],\n\"width\":\"auto\",\n   \"actions\": [\n                    {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Change incident configuration\"\n                    },\n {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Ignore\"\n                    }\n   ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                            "recipient": {
                              "channelId": "19:7abc1180c1d84a3fba83770e34231132@thread.tacv2"
                            },
                            "shouldUpdateCard": true
                          },
                          "notificationUrl": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['teams']['connectionId']"
                          }
                        },
                        "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                        "queries": {
                          "groupId": "18de1100-ab2e-4505-be42-8263b915b221"
                        }
                      }
                    },
                    "Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card": {
                      "runAfter": {
                        "For_each_malicious_IP": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select",
                      "inputs": {
                        "from": "@variables('IPAddressAction')",
                        "select": {
                          "text": "@item()",
                          "type": "TextBlock"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "FortinetConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('FortinetConnectorConnectionName'))]",
                        "connectionName": "[[variables('FortinetConnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/azuresentinel')]"
                      },
                      "teams": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[[variables('TeamsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/teams')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Fortinet FortiGate Next-Generation Firewall connector for Microsoft Sentinel",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_FortinetCustomConnector')]",
                      "version": "[variables('playbookVersion2')]"
                    },
                    {
                      "kind": "AzureFunction",
                      "contentId": "[variables('_FortinetFortigateFunctionApp')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Fortinet-FortiGate-ResponseOnBlockIP",
            "description": "This playbook allows the SOC users to automatically response to Microsoft Sentinel incidents which includes IPs, by adding/removing the IPs to the Microsoft Sentinel IP blocked group.",
            "prerequisites": [
              "- Sentinel IP block group should create in the VM \n\n - FortinetConnector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n - Function App needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the Function doc page. \n\n - FortinetConnector need to be authenticated with an API key. Relevant instructions can be found in the connector doc page."
            ],
            "lastUpdateTime": "2022-08-01T00:00:00Z",
            "entities": [
              "IP"
            ],
            "postDeployment": [
              "* Go to logic app designer. \n\n * Look for the function call actions. You can find them by the titles: \n\n - Fetch the details of the address object. \n\n - Get address group details. \n\n * For each one of the above function call actions and perform the below mentioned steps: \n\n - Go to 'Managed identity' dropdown and select user identity. \n\n - Save playbook. \n\n * Go to Microsoft Sentinel, hook playbook to Microsoft Sentinel rules. \n\n ** a. Authorize connections ** \n\n Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connection such as Team's connection \n\n ** b. Configurations in Sentinel ** \n\n - In Microsoft Sentinel analytical rules should be configured to trigger an incident with IP Entity. \n\n - Configure the automation rules to trigger this playbook"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Fortinet-FortiGate-ResponseOnBlockIP",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId4')]",
        "contentKind": "Playbook",
        "displayName": "Fortinet-FortiGate-ResponseOnBlockIP",
        "contentProductId": "[variables('_playbookcontentProductId4')]",
        "id": "[variables('_playbookcontentProductId4')]",
        "version": "[variables('playbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Fortinet-FortiGate-ResponseOnBlockURL Playbook with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion5')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Fortinet-FortiGate-ResponseOnBlockURL",
              "type": "String"
            },
            "Teams GroupId": {
              "defaultValue": "TeamgroupId",
              "type": "String",
              "metadata": {
                "description": "GroupId of the Team channel"
              }
            },
            "Teams ChannelId": {
              "defaultValue": "TeamChannelId",
              "type": "String",
              "metadata": {
                "description": "Team ChannelId"
              }
            },
            "Address Group": {
              "defaultValue": "AddressGroup",
              "type": "String",
              "metadata": {
                "description": "Address Group"
              }
            },
            "FunctionAppName": {
              "defaultValue": "FortinetFortigateFunctionApp",
              "type": "String",
              "metadata": {
                "description": "Function app name"
              }
            },
            "User Identifier Name": {
              "defaultValue": "fortinetuseridentity",
              "type": "String",
              "metadata": {
                "description": "User Identity"
              }
            },
            "AzureManagementLink": {
              "type": "String",
              "defaultValue": "[concat('https://management','.azure','.com')]"
            },
            "CustomConnectorName": {
              "defaultValue": "FortinetCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the Connector"
              }
            },
            "location": {
              "type": "string",
              "minLength": 1,
              "defaultValue": "[concat('[resourceGroup().locatio', 'n]')]",
              "metadata": {
                "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[[concat('teamsconnector-', parameters('PlaybookName'))]",
            "FortinetConnectorConnectionName": "[[concat('FortinetConnector-', parameters('PlaybookName'))]",
            "UserIdentifier": "[[parameters('User Identifier Name')]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/teams')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('FortinetConnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('TeamsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "UserAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('FortinetConnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Compose_actions_on_URL_to_be_displayed_on_adaptive_card": {
                      "runAfter": {
                        "For_each_malicious_URL": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select",
                      "inputs": {
                        "from": "@variables('URLAddressAction')",
                        "select": {
                          "text": "@item()",
                          "type": "TextBlock"
                        }
                      },
                      "description": "This is used to compose the list of actions taken by SOC on respective URL addresses"
                    },
                    "Condition_based_on_the_incident_configuration_from_adaptive_card": {
                      "actions": {
                        "Add_comment_to_incident_(V3)_3": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>Fortinet Playbook ran and performed the following actions:<br>\n@{variables('Comment')}<br>\nActions taken on Sentinel : Add comment to incident and closure with classification reason &nbsp;: @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2')['data']['incidentStatus']}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Update_incident": {
                          "runAfter": {
                            "Add_comment_to_incident_(V3)_3": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "classification": {
                                "ClassificationAndReason": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2')['data']['incidentStatus']}"
                              },
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "severity": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2')['data']['incidentSeverity']}",
                              "status": "Closed"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          }
                        }
                      },
                      "runAfter": {
                        "For_each": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>Fortinet Playbook ran and performed the following actions:<br>\n@{variables('Comment')}<br>\nActions taken on Sentinel : Add comment to incident&nbsp;</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2')?['submitActionId']",
                              "Change incident configuration"
                            ]
                          }
                        ]
                      },
                      "type": "If",
                      "description": "This decides the action taken on the summarized adaptive card"
                    },
                    "Entities_-_Get_URLs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/url"
                      }
                    },
                    "For_each": {
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "actions": {
                        "Append_to_string_variable": {
                          "runAfter": {
                            "Create_HTML_table_for_Comment": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "Comment",
                            "value": "@body('Create_HTML_table_for_Comment')"
                          }
                        },
                        "Create_HTML_table_for_Comment": {
                          "type": "Table",
                          "inputs": {
                            "columns": [
                              {
                                "header": "URL_Address",
                                "value": "@items('For_each')?['Url']"
                              },
                              {
                                "header": "Action_Taken",
                                "value": "@variables('actionName')"
                              }
                            ],
                            "format": "HTML",
                            "from": "@variables('URLAddressAction')"
                          },
                          "description": "Construct HTML table for the comment"
                        }
                      },
                      "runAfter": {
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_malicious_URL": {
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "actions": {
                        "Address_group_details": {
                          "runAfter": {
                            "Set_variable_filter_for_address_group_function_call": [
                              "Succeeded"
                            ]
                          },
                          "type": "Function",
                          "inputs": {
                            "authentication": {
                              "audience": "[[parameters('AzureManagementLink')]",
                              "identity": "[[variables('UserIdentifier')]",
                              "type": "ManagedServiceIdentity"
                            },
                            "function": {
                              "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/sites/',parameters('FunctionAppName'),'/functions/Fortinet-GetEntityDetails')]"
                            },
                            "queries": {
                              "entity": "addrgrp",
                              "filter": "@{variables('filter')}"
                            }
                          },
                          "description": "This gets the address group details from fortinet"
                        },
                        "Check_address_object_is_already_exist_in_firewall": {
                          "runAfter": {
                            "Set_variable_filter_for_address_object_function_call": [
                              "Succeeded"
                            ]
                          },
                          "type": "Function",
                          "inputs": {
                            "authentication": {
                              "audience": "[[parameters('AzureManagementLink')]",
                              "identity": "[[variables('UserIdentifier')]",
                              "type": "ManagedServiceIdentity"
                            },
                            "function": {
                              "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/sites/',parameters('FunctionAppName'),'/functions/Fortinet-GetEntityDetails')]"
                            },
                            "method": "GET",
                            "queries": {
                              "entity": "address",
                              "filter": "@variables('filter')"
                            }
                          },
                          "description": "Getting the address object details from firewall"
                        },
                        "Condition_based_on_user_inputs_from_the_adaptive_card": {
                          "actions": {
                            "Append_to_array_variable_action_taken_on_URL_address": {
                              "runAfter": {
                                "Update_pre-defined_address_group": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "URLAddressAction",
                                "value": "URL Address : @{items('For_each_malicious_URL')?['Url']} ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']}  "
                              }
                            },
                            "Condition_to_check_if_user_chosen_Block": {
                              "actions": {
                                "Append_to_array_variable_for_new_address_object": {
                                  "runAfter": {
                                    "Create_an_address_object": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "memberCollection",
                                    "value": {
                                      "name": "@body('Create_an_address_object')?['mkey']",
                                      "q_origin_key": "@body('Create_an_address_object')?['mkey']"
                                    }
                                  },
                                  "description": "This appends address object to array variable for new address object"
                                },
                                "Create_an_address_object": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "fqdn": "@{items('For_each_malicious_URL')?['Address']}",
                                      "name": "@{items('For_each_malicious_URL')?['Address']}",
                                      "type": "fqdn"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['FortinetConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/api/v2/cmdb/firewall/address"
                                  },
                                  "description": "Create an address object"
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                      "Block URL"
                                    ]
                                  },
                                  {
                                    "equals": [
                                      "@length(body('Parse_JSON_for_address_object_dynamic_content'))",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If",
                              "description": "This check if user chooses Block URL"
                            },
                            "Update_pre-defined_address_group": {
                              "runAfter": {
                                "Condition_to_check_if_user_chosen_Block": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "member": "@variables('memberCollection')",
                                  "name": "@variables('Pre-definedGroupName')"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['FortinetConnector']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "/api/v2/cmdb/firewall/addrgrp/@{encodeURIComponent(variables('Pre-definedGroupName'))}"
                              }
                            }
                          },
                          "runAfter": {
                            "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_to_array_variable_URL_address_action": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "URLAddressAction",
                                  "value": "URL Address : @{items('For_each_malicious_URL')?['Url']} ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']}"
                                },
                                "description": "This appends the array variable action taken on URL"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                    "Ignore"
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If",
                          "description": "condition to check the submit action is block / unblock or Ignore"
                        },
                        "Condition_to_check_if_URL_address_already_present_in_list_of_address_objects": {
                          "actions": {
                            "Condition_to_check_if_URL_already_present_in_predefined_address_group": {
                              "actions": {
                                "Append_to_adaptive_card_if_URL_is_a_member_of_blocked_address_group": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "adaptivecardBody",
                                    "value": {
                                      "text": "The URL  @{items('For_each_malicious_URL')?['Address']} is already a member of the blocked address group",
                                      "type": "TextBlock",
                                      "wrap": true
                                    }
                                  },
                                  "description": "This appends the text to display If URL is a member of blocked address group"
                                },
                                "For_each_address_object": {
                                  "foreach": "@body('Parse_JSON_for_address_object_dynamic_content')",
                                  "actions": {
                                    "Filter_array_address_objects_to_remove_from_address_group": {
                                      "type": "Query",
                                      "inputs": {
                                        "from": "@variables('memberCollection')",
                                        "where": "@not(equals(item()?['name'], items('For_each_address_object')['name']))"
                                      },
                                      "description": "This filter is used to remove address objects if already exist"
                                    },
                                    "Set_variable_address_group_members_in_unblock_case": {
                                      "runAfter": {
                                        "Filter_array_address_objects_to_remove_from_address_group": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "memberCollection",
                                        "value": "@body('Filter_array_address_objects_to_remove_from_address_group')"
                                      },
                                      "description": "This sets the address group members"
                                    }
                                  },
                                  "runAfter": {
                                    "Set_dynamic_variable_action_name_to_unblock": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach",
                                  "description": "For each address object member"
                                },
                                "Set_dynamic_variable_action_name_to_unblock": {
                                  "runAfter": {
                                    "Append_to_adaptive_card_if_URL_is_a_member_of_blocked_address_group": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "actionName",
                                    "value": "UnBlock URL"
                                  },
                                  "description": "variable to set action name dynamically"
                                }
                              },
                              "runAfter": {
                                "Filter_array_address_name_from_address_group": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Append_to_adaptive_card_text_if_URL_is_not_a_member_of_blocked_address_group": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "adaptivecardBody",
                                      "value": {
                                        "text": "The URL  @{items('For_each_malicious_URL')?['Address']} is not a member of the blocked address group ",
                                        "type": "TextBlock",
                                        "wrap": true
                                      }
                                    },
                                    "description": "This appends the text to display If URL is a member of blocked address group"
                                  },
                                  "For_each_address_object_member": {
                                    "foreach": "@body('Parse_JSON_for_address_object_dynamic_content')",
                                    "actions": {
                                      "Append_to_array_variable_address_object_group": {
                                        "type": "AppendToArrayVariable",
                                        "inputs": {
                                          "name": "memberCollection",
                                          "value": {
                                            "name": "@items('For_each_address_object_member')['name']",
                                            "q_origin_key": "@items('For_each_address_object_member')['name']"
                                          }
                                        },
                                        "description": "This appends address object members to existing members"
                                      }
                                    },
                                    "runAfter": {
                                      "Set_dynamic_variable_action_name_to_block": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "Foreach"
                                  },
                                  "Set_dynamic_variable_action_name_to_block": {
                                    "runAfter": {
                                      "Append_to_adaptive_card_text_if_URL_is_not_a_member_of_blocked_address_group": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "SetVariable",
                                    "inputs": {
                                      "name": "actionName",
                                      "value": "Block URL"
                                    },
                                    "description": "variable to set action name dynamically"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@length(body('Filter_array_address_name_from_address_group'))",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If",
                              "description": "condition to check the malicious URL address is present in the predefined address group"
                            },
                            "Filter_array_address_name_from_address_group": {
                              "type": "Query",
                              "inputs": {
                                "from": "@body('Parse_JSON_for_address_group_dynamic_content')?[0]?['member']",
                                "where": "@equals(item()?['name'], body('Parse_JSON_for_address_object_dynamic_content')?[0]?['name'])"
                              },
                              "description": "This filters the address name of address object from address group"
                            }
                          },
                          "runAfter": {
                            "Set_variable_address_group_members": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_to_adaptive_card_body_if_URL_is_not_a_member_of_blocked_address_group": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "adaptivecardBody",
                                  "value": {
                                    "text": "The URL @{items('For_each_malicious_URL')?['Address']} is not a member of the blocked address group ",
                                    "type": "TextBlock",
                                    "wrap": true
                                  }
                                },
                                "description": "This appends the text to display If URL is not a member of blocked address group"
                              },
                              "For_each_new_URL": {
                                "foreach": "@body('Parse_JSON_for_address_object_dynamic_content')",
                                "actions": {
                                  "Append_to_address_group_members_in_case_of_new_URL": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "memberCollection",
                                      "value": {
                                        "name": "@items('For_each_new_URL')['name']",
                                        "q_origin_key": "@items('For_each_new_URL')['name']"
                                      }
                                    },
                                    "description": "Appends address objects to existing object"
                                  }
                                },
                                "runAfter": {
                                  "Set_variable_address_group_members_in_case_of_new_address_object": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Foreach",
                                "description": "iterates on address object body for each new URL"
                              },
                              "Set_variable_action_name_to_Block_URL": {
                                "runAfter": {
                                  "Append_to_adaptive_card_body_if_URL_is_not_a_member_of_blocked_address_group": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "actionName",
                                  "value": "Block URL"
                                },
                                "description": "This sets the variable block URL"
                              },
                              "Set_variable_address_group_members_in_case_of_new_address_object": {
                                "runAfter": {
                                  "Set_variable_action_name_to_Block_URL": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "memberCollection",
                                  "value": "@body('Parse_JSON_for_address_group_dynamic_content')?[0]?['member']"
                                },
                                "description": "This sets address group members"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Parse_JSON_for_address_object_dynamic_content'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If",
                          "description": "This checks if URL is a member of any of the list of address objects"
                        },
                        "Parse_JSON_for_address_group_dynamic_content": {
                          "runAfter": {
                            "Parse_address_group_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Parse_address_group_JSON')",
                            "schema": {
                              "items": {
                                "properties": {
                                  "allow-routing": {
                                    "description": "allow-routing of  of an address group",
                                    "type": "string"
                                  },
                                  "color": {
                                    "description": "color of  of an address group",
                                    "type": "integer"
                                  },
                                  "comment": {
                                    "description": "comment of  of an address group",
                                    "type": "string"
                                  },
                                  "exclude": {
                                    "description": "exclude of  of an address group",
                                    "type": "string"
                                  },
                                  "exclude-member": {
                                    "type": "array"
                                  },
                                  "fabric-object": {
                                    "description": "fabric-object of  of an address group",
                                    "type": "string"
                                  },
                                  "member": {
                                    "items": {
                                      "properties": {
                                        "name": {
                                          "description": "member name",
                                          "type": "string"
                                        },
                                        "q_origin_key": {
                                          "description": "member q_origin_key",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "name",
                                        "q_origin_key"
                                      ],
                                      "type": "object"
                                    },
                                    "type": "array"
                                  },
                                  "name": {
                                    "description": "name of an address group",
                                    "type": "string"
                                  },
                                  "q_origin_key": {
                                    "description": "q_origin_key of an address group",
                                    "type": "string"
                                  },
                                  "tagging": {
                                    "description": "tagging of an address group",
                                    "type": "array"
                                  },
                                  "type": {
                                    "description": "type of an address group",
                                    "type": "string"
                                  },
                                  "uuid": {
                                    "description": "uuid of an address group",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "name",
                                  "q_origin_key",
                                  "type",
                                  "uuid",
                                  "member",
                                  "comment",
                                  "exclude",
                                  "exclude-member",
                                  "color",
                                  "tagging",
                                  "allow-routing",
                                  "fabric-object"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          }
                        },
                        "Parse_JSON_for_address_object_dynamic_content": {
                          "runAfter": {
                            "Parse_address_object_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Parse_address_object_JSON')",
                            "schema": {
                              "items": {
                                "properties": {
                                  "allow-routing": {
                                    "description": "allow-routing of  of an address object",
                                    "type": "string"
                                  },
                                  "associated-interface": {
                                    "description": "associated-interface of  of an address address object",
                                    "type": "string"
                                  },
                                  "cache-ttl": {
                                    "description": "cache-ttl of  of an address address object",
                                    "type": "integer"
                                  },
                                  "clearpass-spt": {
                                    "description": "clearpass-spt of  of an address address object",
                                    "type": "string"
                                  },
                                  "color": {
                                    "description": "color of  of an address address object",
                                    "type": "integer"
                                  },
                                  "comment": {
                                    "description": "comment of  of an address address object",
                                    "type": "string"
                                  },
                                  "country": {
                                    "description": "country of  of an address address object",
                                    "type": "string"
                                  },
                                  "end-mac": {
                                    "description": "end-mac of  of an address address object",
                                    "type": "string"
                                  },
                                  "fabric-object": {
                                    "description": "fabric-object of  of an address address object",
                                    "type": "string"
                                  },
                                  "filter": {
                                    "description": "filter of  of an address address object",
                                    "type": "string"
                                  },
                                  "fqdn": {
                                    "description": "fqdc of  of an address address object",
                                    "type": "string"
                                  },
                                  "fsso-group": {
                                    "description": "fsso-group of  of an address address object",
                                    "type": "array"
                                  },
                                  "interface": {
                                    "description": "interface of  of an address address object",
                                    "type": "string"
                                  },
                                  "list": {
                                    "description": "list of  of an address address object",
                                    "type": "array"
                                  },
                                  "name": {
                                    "decripation": "Name of address object",
                                    "type": "string"
                                  },
                                  "obj-id": {
                                    "description": "obj-id of  of an address address object",
                                    "type": "string"
                                  },
                                  "obj-type": {
                                    "description": "obj-type of  of an address address object",
                                    "type": "string"
                                  },
                                  "q_origin_key": {
                                    "description": "q_origin_key of  of an address address object",
                                    "type": "string"
                                  },
                                  "sdn": {
                                    "description": "sdn of  of an address address object",
                                    "type": "string"
                                  },
                                  "sdn-addr-type": {
                                    "description": "sdn-addr-type of  of an address address object",
                                    "type": "string"
                                  },
                                  "start-mac": {
                                    "description": "start-mac of  of an address address object",
                                    "type": "string"
                                  },
                                  "sub-type": {
                                    "description": "sub-type of  of an address address object",
                                    "type": "string"
                                  },
                                  "tagging": {
                                    "description": "tagging of  of an address address object",
                                    "type": "array"
                                  },
                                  "type": {
                                    "description": "type of  of an address address object",
                                    "type": "string"
                                  },
                                  "uuid": {
                                    "description": "uuid of  of an address address object",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "name",
                                  "q_origin_key",
                                  "uuid",
                                  "type",
                                  "sub-type",
                                  "clearpass-spt",
                                  "start-mac",
                                  "end-mac",
                                  "fqdn",
                                  "country",
                                  "cache-ttl",
                                  "sdn",
                                  "fsso-group",
                                  "interface",
                                  "obj-type",
                                  "comment",
                                  "associated-interface",
                                  "color",
                                  "filter",
                                  "sdn-addr-type",
                                  "obj-id",
                                  "list",
                                  "tagging",
                                  "allow-routing",
                                  "fabric-object"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          },
                          "description": "Parse body content and create dynamic content"
                        },
                        "Parse_address_group_JSON": {
                          "runAfter": {
                            "Address_group_details": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Address_group_details')",
                            "schema": {
                              "$schema": "http://json-schema.org/draft-04/schema#",
                              "items": [
                                {
                                  "properties": {
                                    "allow-routing": {
                                      "type": "string"
                                    },
                                    "color": {
                                      "type": "integer"
                                    },
                                    "comment": {
                                      "type": "string"
                                    },
                                    "exclude": {
                                      "type": "string"
                                    },
                                    "exclude-member": {
                                      "type": "array"
                                    },
                                    "fabric-object": {
                                      "type": "string"
                                    },
                                    "member": {
                                      "items": [
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        },
                                        {
                                          "properties": {
                                            "name": {
                                              "type": "string"
                                            },
                                            "q_origin_key": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "name",
                                            "q_origin_key"
                                          ],
                                          "type": "object"
                                        }
                                      ],
                                      "type": "array"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "q_origin_key": {
                                      "type": "string"
                                    },
                                    "tagging": {
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "uuid": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "name",
                                    "q_origin_key",
                                    "type",
                                    "uuid",
                                    "member",
                                    "comment",
                                    "exclude",
                                    "exclude-member",
                                    "color",
                                    "tagging",
                                    "allow-routing",
                                    "fabric-object"
                                  ],
                                  "type": "object"
                                }
                              ],
                              "type": "array"
                            }
                          },
                          "description": "To parse the output of the function address group in to JSON"
                        },
                        "Parse_address_object_JSON": {
                          "runAfter": {
                            "Check_address_object_is_already_exist_in_firewall": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Check_address_object_is_already_exist_in_firewall')",
                            "schema": {
                              "items": {
                                "properties": {
                                  "allow-routing": {
                                    "type": "string"
                                  },
                                  "associated-interface": {
                                    "type": "string"
                                  },
                                  "cache-ttl": {
                                    "type": "integer"
                                  },
                                  "clearpass-spt": {
                                    "type": "string"
                                  },
                                  "color": {
                                    "type": "integer"
                                  },
                                  "comment": {
                                    "type": "string"
                                  },
                                  "country": {
                                    "type": "string"
                                  },
                                  "end-mac": {
                                    "type": "string"
                                  },
                                  "fabric-object": {
                                    "type": "string"
                                  },
                                  "filter": {
                                    "type": "string"
                                  },
                                  "fqdn": {
                                    "type": "string"
                                  },
                                  "fsso-group": {
                                    "type": "array"
                                  },
                                  "interface": {
                                    "type": "string"
                                  },
                                  "list": {
                                    "type": "array"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "obj-id": {
                                    "type": "string"
                                  },
                                  "obj-type": {
                                    "type": "string"
                                  },
                                  "q_origin_key": {
                                    "type": "string"
                                  },
                                  "sdn": {
                                    "type": "string"
                                  },
                                  "sdn-addr-type": {
                                    "type": "string"
                                  },
                                  "start-mac": {
                                    "type": "string"
                                  },
                                  "sub-type": {
                                    "type": "string"
                                  },
                                  "tagging": {
                                    "type": "array"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "uuid": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "name",
                                  "q_origin_key",
                                  "uuid",
                                  "type",
                                  "sub-type",
                                  "clearpass-spt",
                                  "start-mac",
                                  "end-mac",
                                  "fqdn",
                                  "country",
                                  "cache-ttl",
                                  "sdn",
                                  "fsso-group",
                                  "interface",
                                  "obj-type",
                                  "comment",
                                  "associated-interface",
                                  "color",
                                  "filter",
                                  "sdn-addr-type",
                                  "obj-id",
                                  "list",
                                  "tagging",
                                  "allow-routing",
                                  "fabric-object"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          },
                          "description": "To parse the output of the function address object in to JSON"
                        },
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": {
                          "runAfter": {
                            "Condition_to_check_if_URL_address_already_present_in_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnectionWebhook",
                          "inputs": {
                            "body": {
                              "body": {
                                "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\":@{variables('adaptivecardBody')} ,\n     \"actions\": [\n  {\n    \"title\": \"@{variables('actionName')}\",\n    \"type\": \"Action.Submit\"\n  },\n  {\n    \"title\": \"Ignore\",\n    \"type\": \"Action.Submit\"\n  }\n],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                "recipient": {
                                  "channelId": "19:7abc1180c1d84a3fba83770e34231132@thread.tacv2"
                                },
                                "shouldUpdateCard": true
                              },
                              "notificationUrl": "@{listCallbackUrl()}"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['teams']['connectionId']"
                              }
                            },
                            "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                            "queries": {
                              "groupId": "18de1100-ab2e-4505-be42-8263b915b221"
                            }
                          }
                        },
                        "Set_variable_adaptive_card_body": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "adaptivecardBody",
                            "value": [
                              {
                                "size": "Large",
                                "text": "Suspicious URL - Microsoft Sentinel",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Possible Comprised URL  detected by the provider",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['severity']}  Incident  @{triggerBody()?['object']?['properties']?['title']} ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": " Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Incident description",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['description']}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "[[[[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "size": "Medium",
                                "text": "Response in Fortinet-Fortigate",
                                "type": "TextBlock",
                                "weight": "Bolder"
                              },
                              {
                                "size": "Small",
                                "style": "Person",
                                "type": "Image",
                                "url": "https://www.fortinet.com/content/dam/fortinet-blog/article-images/individual-images/logo.png"
                              }
                            ]
                          },
                          "description": "variable to hold adaptive card body"
                        },
                        "Set_variable_address_group_members": {
                          "runAfter": {
                            "Parse_JSON_for_address_group_dynamic_content": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "memberCollection",
                            "value": "@body('Parse_JSON_for_address_group_dynamic_content')?[0]?['member']"
                          },
                          "description": "assign list of address group members"
                        },
                        "Set_variable_filter_for_address_group_function_call": {
                          "runAfter": {
                            "Parse_JSON_for_address_object_dynamic_content": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "filter",
                            "value": "filter=name=@{concat('@',variables('Pre-definedGroupName'))}"
                          },
                          "description": "This sets the variable filter for address group azure function"
                        },
                        "Set_variable_filter_for_address_object_function_call": {
                          "runAfter": {
                            "Set_variable_adaptive_card_body": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "filter",
                            "value": "filter=fqdn=@{concat('@',items('For_each_malicious_URL')?['Url'])}"
                          },
                          "description": "This sets the variable filter for address object azure function"
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "description": "For each URL which incident contains",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Initialize_variable_Pre-definedGroupName": {
                      "runAfter": {
                        "Initialize_variable_filter": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Pre-definedGroupName",
                            "type": "string",
                            "value": "Sentinel URL Block"
                          }
                        ]
                      },
                      "description": "Pre-defined group name"
                    },
                    "Initialize_variable_URL_address_action": {
                      "runAfter": {
                        "Initialize_variable_adaptive_card_body": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "URLAddressAction",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "This holds the action taken on each URL "
                    },
                    "Initialize_variable_action_name": {
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "actionName",
                            "type": "string"
                          }
                        ]
                      },
                      "description": "variable to store action name to be displayed on adaptive card"
                    },
                    "Initialize_variable_adaptive_card_body": {
                      "runAfter": {
                        "Initialize_variable_address_group_members": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "adaptivecardBody",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "variable to store adaptive card body json"
                    },
                    "Initialize_variable_address_group_members": {
                      "runAfter": {
                        "Initialize_variable_action_name": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "memberCollection",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "Array variable to assign member collection of pre-defined address group"
                    },
                    "Initialize_variable_comment": {
                      "runAfter": {
                        "Initialize_variable_Pre-definedGroupName": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Comment",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_filter": {
                      "runAfter": {
                        "Initialize_variable_URL_address_action": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "filter",
                            "type": "string"
                          }
                        ]
                      },
                      "description": "This is used to hold the filter condition to use in the azure function"
                    },
                    "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_2": {
                      "runAfter": {
                        "Compose_actions_on_URL_to_be_displayed_on_adaptive_card": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "body": {
                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n           \n            \"weight\": \"Bolder\",\n            \"text\": \"Below is the summary of actions taken on URL's by SOC\",\n            \"wrap\": true\n        },\n {\n    \"size\": \"Small\",\n    \"style\": \"Person\",\n    \"type\": \"Image\",\n    \"url\": \"https://www.fortinet.com/content/dam/fortinet-blog/article-images/individual-images/logo.png\"\n  },\n       {\n  \"columns\": [\n    {\n      \"items\":@{body('Compose_actions_on_URL_to_be_displayed_on_adaptive_card')} ,\n      \"type\": \"Column\",\n      \"wrap\": true\n    }\n  ],\n  \"separator\": \"true\",\n  \"type\": \"ColumnSet\",\n  \"width\": \"stretch\"\n},\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident]()\",\n            \"wrap\": true\n        },\n\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration :\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Microsoft Sentinel incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                  \n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        }\n       \n     \n        \n    ],\n\"width\":\"auto\",\n   \"actions\": [\n                    {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Change incident configuration\"\n                    },\n {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Ignore\"\n                    }\n   ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                            "recipient": {
                              "channelId": "19:7abc1180c1d84a3fba83770e34231132@thread.tacv2"
                            },
                            "shouldUpdateCard": true
                          },
                          "notificationUrl": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['teams']['connectionId']"
                          }
                        },
                        "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                        "queries": {
                          "groupId": "18de1100-ab2e-4505-be42-8263b915b221"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "FortinetConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('FortinetConnectorConnectionName'))]",
                        "connectionName": "[[variables('FortinetConnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/azuresentinel')]"
                      },
                      "teams": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[[variables('TeamsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/teams')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId5'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId5')]",
                "contentId": "[variables('_playbookContentId5')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Fortinet FortiGate Next-Generation Firewall connector for Microsoft Sentinel",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_FortinetCustomConnector')]",
                      "version": "[variables('playbookVersion2')]"
                    },
                    {
                      "kind": "AzureFunction",
                      "contentId": "[variables('_FortinetFortigateFunctionApp')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Fortinet-FortiGate-ResponseOnBlockURL",
            "description": "This playbook allows the SOC users to automatically response to Microsoft Sentinel incidents which includes URL's, by adding the URLs to the Microsoft Sentinel URL blocked group.",
            "prerequisites": [
              "- Sentinel URL block group should create in the VM \n\n - FortinetConnector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n - Fortinet-GetRestAPIFunctionAPP needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the Function doc page. \n\n - FortinetConnector need to be authenticated with an API key. Relevant instructions can be found in the connector doc page. \n\n - This playbook will add new address object to existing VM."
            ],
            "lastUpdateTime": "2022-08-01T00:00:00Z",
            "entities": [
              "URL"
            ],
            "postDeployment": [
              "* Go to logic app designer. \n\n * Look for the function call actions. You can find them by the titles: \n\n - Fetch the details of the address object. \n\n - Get address group details. \n\n * For each one of the above function call actions and perform the below mentioned steps: \n\n - Go to 'Managed identity' dropdown and select user identity. \n\n - Save playbook. \n\n * Go to Microsoft Sentinel, hook playbook to Microsoft Sentinel rules. \n\n ** a. Authorize connections \n\n Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource. \n\n 2. Click edit API connection. \n\n 3. Click Authorize. \n\n 4. Sign in. \n\n 5. Click Save. \n\n 6. Repeat steps for other connection such as Team's connection \n\n ** b. Configurations in Sentinel ** \n\n 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with URL Entity. \n\n 2. Configure the automation rules to trigger this playbook."
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Fortinet-FortiGate-ResponseOnBlockURL",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId5')]",
        "contentKind": "Playbook",
        "displayName": "Fortinet-FortiGate-ResponseOnBlockURL",
        "contentProductId": "[variables('_playbookcontentProductId5')]",
        "id": "[variables('_playbookcontentProductId5')]",
        "version": "[variables('playbookVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Fortigate Workbook with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Gain insights into Fortigate firewalls by analyzing traffic and activities.\nThis workbook finds correlations in Fortigate threat events and identifies suspicious ports, users, protocols and IP addresses.\nYou can learn about trends across user and data traffic, and drill down into the Fortigate filter results.\nEasily detect attacks on your organization by monitoring management operations such as configuration and logins."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"\"},\"name\":\"text - 1\"},{\"type\":1,\"content\":{\"json\":\"## FortiGate overview\"},\"name\":\"text - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"query\":\"\",\"parameters\":[{\"id\":\"dc0f1964-cd27-4aa8-bef7-10054a908d4f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}},{\"id\":\"3741462d-c208-4438-b01e-cc6776be6939\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"LogSeverity\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| summarize Count = count() by LogSeverity\\r\\n| order by Count desc, LogSeverity asc\\r\\n| project Value = LogSeverity, Label = strcat(LogSeverity, ' - ', Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"90246516-998b-43f1-849e-63cf60e5bf14\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Action\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| where \\\"{LogSeverity:lable}\\\" == \\\"All\\\" or LogSeverity in ({LogSeverity})\\r\\n| parse Activity with Category \\\":\\\" SubCategory \\\" \\\" SubType\\r\\n| summarize Count = count() by SubType\\r\\n| order by Count desc, SubType asc\\r\\n| project Value = SubType, Label = strcat(SubType, ' - ', Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = materialize (CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| where \\\"{LogSeverity:lable}\\\" == \\\"All\\\" or LogSeverity in ({LogSeverity})\\r\\n| parse Activity with Category \\\":\\\" SubCategory \\\" \\\" SubType\\r\\n| where \\\"{Action:lable}\\\" == \\\"All\\\" or SubType in ({Action}));\\r\\ndata\\r\\n| summarize Count = count() by Category\\r\\n| join kind = fullouter (datatable(Category:string)['Medium', 'high', 'low']) on Category\\r\\n| project Category = iff(Category == '', Category1, Category), Count = iff(Category == '', 0, Count)\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Category)\\r\\n on Category\\r\\n| project-away Category1, TimeGenerated\\r\\n| extend Categorys = Category\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend Category = 'All', Categorys = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"Category\",\"exportParameterName\":\"CategoryFilter\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Event category\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Category\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"gray\",\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"query - 4\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = materialize (CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| where \\\"{LogSeverity:lable}\\\" == \\\"All\\\" or LogSeverity in ({LogSeverity})\\r\\n| parse Activity with Category \\\":\\\" *\\r\\n| where Category == '{CategoryFilter}' or '{CategoryFilter}'== \\\"All\\\"\\r\\n| parse Activity with * \\\":\\\" SubCategory \\\" \\\" *\\r\\n| parse Activity with  * \\\":\\\" * \\\" \\\" SubType\\r\\n| where \\\"{Action:lable}\\\" == \\\"All\\\" or SubType in ({Action}));\\r\\ndata\\r\\n| summarize Count = count() by SubCategory\\r\\n| join kind = fullouter (datatable(SubCategory:string)['Medium', 'high', 'low']) on SubCategory\\r\\n| project SubCategory = iff(SubCategory == '', SubCategory1, SubCategory), Count = iff(SubCategory == '', 0, Count)\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SubCategory)\\r\\n on SubCategory\\r\\n| project-away SubCategory1, TimeGenerated\\r\\n| extend SubCategorys = SubCategory\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend SubCategory = 'All', SubCategorys = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"SubCategory\",\"exportParameterName\":\"SubCategoryFilter\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Event type\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SubCategory\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"magenta\",\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"query - 5\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| where \\\"{LogSeverity:lable}\\\" == \\\"All\\\" or LogSeverity in ({LogSeverity})\\r\\n| parse Activity with Category \\\":\\\" *\\r\\n| where Category == '{CategoryFilter}' or '{CategoryFilter}'== \\\"All\\\"\\r\\n| parse Activity with * \\\":\\\" SubCategory \\\" \\\" * \\r\\n| where SubCategory == '{SubCategoryFilter}' or '{SubCategoryFilter}' == \\\"All\\\"\\r\\n| parse Activity with  * \\\":\\\" * \\\" \\\" SubType\\r\\n| where \\\"{Action:lable}\\\" == \\\"All\\\" or SubType in ({Action})\\r\\n| summarize count() by SubType, bin(TimeGenerated, 1d)\",\"size\":0,\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Event actions, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = materialize(CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| where \\\"{LogSeverity:lable}\\\" == \\\"All\\\" or LogSeverity in ({LogSeverity})\\r\\n| extend Category= extract('(.*):(.*)$',1,Activity)\\r\\n| where Category == '{CategoryFilter}' or '{CategoryFilter}'== \\\"All\\\"\\r\\n| extend B= extract('(.*):(.*$)',2,Activity)\\r\\n| extend SubCategory = extract('([a-zA-Z/-]*).*$',1,B)\\r\\n| where SubCategory == '{SubCategoryFilter}' or '{SubCategoryFilter}' == \\\"All\\\"\\r\\n| extend SubType= extract('([a-zA-Z/-]*) (.*)$',2,B)\\r\\n| where \\\"{Action:lable}\\\" == \\\"All\\\" or SubType in ({Action}));\\r\\ndata\\r\\n| summarize Count = count() by SubType\\r\\n| join kind = fullouter (datatable(SubType:string)['Medium', 'high', 'low']) on SubType\\r\\n| project SubType = iff(SubType == '', SubType1, SubType), Count = iff(SubType == '', 0, Count)\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SubType)\\r\\n on SubType\\r\\n| project-away SubType1, TimeGenerated\\r\\n| extend SubTypes = SubType\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend SubType = 'All', SubTypes = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n\",\"size\":4,\"exportFieldName\":\"SubType\",\"exportParameterName\":\"SubTypeFilter\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Event action\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SubType\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = materialize (CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| where \\\"{LogSeverity:lable}\\\" == \\\"All\\\" or LogSeverity in ({LogSeverity})\\r\\n| extend Category= extract('(.*):(.*)$',1,Activity)\\r\\n| extend B= extract('(.*):(.*$)',2,Activity)\\r\\n| extend SubCategory= extract('([a-zA-Z/-]*).*$',1,B)\\r\\n| extend SubType= extract('([a-zA-Z/-]*) (.*)$',2,B)\\r\\n| where Category == '{CategoryFilter}' or '{CategoryFilter}' == \\\"All\\\"\\r\\n| where SubCategory == '{SubCategoryFilter}' or '{SubCategoryFilter}' == \\\"All\\\"\\r\\n| where \\\"{Action:lable}\\\" == \\\"All\\\" or SubType in ({Action})\\r\\n| where SubType == '{SubTypeFilter}' or '{SubTypeFilter}' == \\\"All\\\"\\r\\n| where DestinationUserName != \\\"\\\");\\r\\nlet appData = data\\r\\n| summarize TotalCount = count() by DestinationUserName\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by DestinationUserName\\r\\n    | project-away TimeGenerated) on DestinationUserName\\r\\n| order by TotalCount desc, DestinationUserName asc\\r\\n| project DestinationUserName, TotalCount, Trend\\r\\n| serialize Id = row_number();\\r\\ndata\\r\\n| summarize TotalCount = count() by Activity , DestinationUserName\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by DestinationUserName, Activity\\r\\n    | project-away TimeGenerated) on DestinationUserName, Activity\\r\\n| order by TotalCount desc, DestinationUserName asc\\r\\n| project DestinationUserName, Activity, TotalCount, Trend\\r\\n| serialize Id = row_number(1000000)\\r\\n| join kind=inner (appData) on DestinationUserName\\r\\n| project Id, Name = Activity, Type = 'Activity', ['Activity Count'] = TotalCount, Trend, ParentId = Id1\\r\\n| union (appData \\r\\n    | project Id, Name = DestinationUserName, Type = 'DestinationUserName', ['Activity Count'] = TotalCount, Trend )\\r\\n| order by ['Activity Count'] desc, Name asc\\r\\n\",\"size\":1,\"exportFieldName\":\"DestinationUserName\",\"exportParameterName\":\"DestinationUserNameFilter\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"User activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Id\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Activity Count\",\"formatter\":4,\"formatOptions\":{\"min\":0,\"palette\":\"purple\",\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"ParentId\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DestinationUserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Amount\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true,\"hierarchySettings\":{\"idColumn\":\"Id\",\"parentColumn\":\"ParentId\",\"treeType\":0,\"expanderColumn\":\"Name\"}},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"DestinationUserName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Amount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| where \\\"{LogSeverity:lable}\\\" == \\\"All\\\" or LogSeverity in ({LogSeverity})\\r\\n| parse Activity with Category \\\":\\\" SubCategory \\\" \\\" SubType\\r\\n| where Category == '{CategoryFilter}' or '{CategoryFilter}' == \\\"All\\\"\\r\\n| where SubCategory == '{SubCategoryFilter}' or '{SubCategoryFilter}' == \\\"All\\\"\\r\\n| where \\\"{Action:lable}\\\" == \\\"All\\\" or SubType in ({Action})\\r\\n| where SubType == '{SubTypeFilter}' or '{SubTypeFilter}' == \\\"All\\\"\\r\\n| where ApplicationProtocol != \\\"\\\"\\r\\n| summarize SentDataMB = sum(SentBytes)/1048576 , DataRecievedMB =sum(ReceivedBytes)/1048576, Amount = count() by ApplicationProtocol, DestinationPort\\r\\n| order by Amount, SentDataMB, DataRecievedMB\\r\\n\\r\\n\",\"size\":0,\"exportFieldName\":\"ApplicationProtocol\",\"exportParameterName\":\"ApplicationProtocolFilter\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Application protocol activities\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SentDataMB\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DataRecievedMB\",\"formatter\":4,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Amount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"purple\",\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| where \\\"{LogSeverity:lable}\\\" == \\\"All\\\" or LogSeverity in ({LogSeverity})\\r\\n| parse Activity with Category \\\":\\\" SubCategory \\\" \\\" SubType\\r\\n| where Category == '{CategoryFilter}' or '{CategoryFilter}' == \\\"All\\\"\\r\\n| where SubCategory == '{SubCategoryFilter}' or '{SubCategoryFilter}' == \\\"All\\\"\\r\\n| where \\\"{Action:lable}\\\" == \\\"All\\\" or SubType in ({Action})\\r\\n| where SubType == '{SubTypeFilter}' or '{SubTypeFilter}' == \\\"All\\\"\\r\\n| where ApplicationProtocol == '{ApplicationProtocolFilter}' or '{ApplicationProtocolFilter}' == \\\"All\\\"\\r\\n| summarize SentDataMB = sum(SentBytes)/1048576 , DataRecievedMB =sum(ReceivedBytes)/1048576 by bin(TimeGenerated, 1d)\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Data flow (MB)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| where \\\"{LogSeverity:lable}\\\" == \\\"All\\\" or LogSeverity in ({LogSeverity})\\r\\n| parse Activity with Category \\\":\\\" SubCategory \\\" \\\" SubType\\r\\n| where Category == '{CategoryFilter}' or '{CategoryFilter}' == \\\"All\\\"\\r\\n| where SubCategory == '{SubCategoryFilter}' or '{SubCategoryFilter}' == \\\"All\\\"\\r\\n| where \\\"{Action:lable}\\\" == \\\"All\\\" or SubType in ({Action})\\r\\n| where SubType == '{SubTypeFilter}' or '{SubTypeFilter}' == \\\"All\\\"\\r\\n| where ApplicationProtocol == '{ApplicationProtocolFilter}' or '{ApplicationProtocolFilter}' == \\\"All\\\"\\r\\n| extend EventResult= extract(';FortinetFortiGatelogdesc=(.*?);',1, AdditionalExtensions) \\r\\n| summarize SentDataMB = sum(SentBytes)/1048576 , DataRecievedMB =sum(ReceivedBytes)/1048576, Amount = count() by Category, Type = SubCategory, Action = SubType, DeviceEventClassID, LogSeverity, EventResult , DestinationUserName, SourceIP, DestinationIP, DestinationPort, ApplicationProtocol, Message\\r\\n| order by Amount\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Action\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DeviceEventClassID\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"LogSeverity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"EventResult\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DestinationUserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DestinationIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DestinationPort\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Message\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SentDataMB\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DataRecievedMB\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Amount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"pink\",\"showIcon\":true}}],\"filter\":true}},\"name\":\"query - 6\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Forward data\"},\"name\":\"text - 11\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"query\":\"\",\"parameters\":[{\"id\":\"18e95949-7b4c-4611-94eb-19d4384987f3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DestinationIP\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n| where Activity contains \\\"forward\\\" \\r\\n| where DestinationIP != \\\"\\\"\\r\\n| summarize Count = count() by DestinationIP\\r\\n| order by Count desc, DestinationIP asc\\r\\n| project Value = DestinationIP, Label = strcat(DestinationIP, ' - ', Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"0acac6e9-fbb4-4ac3-8872-df386163d33b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DestinationPort\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor =~ 'Fortinet'\\r\\n| where DeviceProduct contains 'Fortigate'\\r\\n//| where Activity contains \\\"forward\\\"\\r\\n| where isempty(DestinationPort) != true\\r\\n| summarize Count = count() by DestinationPort\\r\\n| order by Count desc, DestinationPort asc\\r\\n| project Value = DestinationPort, Label = strcat(DestinationPort, \\\"- \\\", Count)\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 17\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Fortinet\\\" \\r\\n| where DeviceProduct contains \\\"Fortigate\\\"\\r\\n| where \\\"{DestinationIP:lable}\\\" == \\\"All\\\" or DestinationIP in ({DestinationIP}) \\r\\n| where \\\"{DestinationPort:lable}\\\" == \\\"All\\\" or DestinationPort in ({DestinationPort}) \\r\\n| summarize SentDataMB = sumif(SentBytes,Activity contains \\\"forward\\\" )/1048576 , DataRecievedMB =sumif(ReceivedBytes, Activity contains \\\"forward\\\")/1048576 by TimeGenerated \\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Forward data flow volume. by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"40\",\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Fortinet\\\" \\r\\n| where DeviceProduct contains \\\"Fortigate\\\"\\r\\n| where Activity contains \\\"forward\\\" \\r\\n| where DeviceInboundInterface == \\\"port1\\\"\\r\\n| where \\\"{DestinationIP:lable}\\\" == \\\"All\\\" or DestinationIP in ({DestinationIP}) \\r\\n| where \\\"{DestinationPort:lable}\\\" == \\\"All\\\" or DestinationPort in ({DestinationPort}) \\r\\n| where DestinationPort > 0\\r\\n| extend DestinationPorts= tostring(DestinationPort) \\r\\n| summarize TopDestinationPortsCount= count() by DestinationPorts, bin(TimeGenerated, 1d)\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Used ports over time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"query - 18\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Fortinet\\\" \\r\\n| where DeviceProduct contains \\\"Fortigate\\\"\\r\\n| where Activity contains \\\"forward\\\" \\r\\n| where DeviceInboundInterface == \\\"port1\\\"\\r\\n| where \\\"{DestinationIP:lable}\\\" == \\\"All\\\" or DestinationIP in ({DestinationIP}) \\r\\n| where \\\"{DestinationPort:lable}\\\" == \\\"All\\\" or DestinationPort in ({DestinationPort}) \\r\\n| where DestinationPort > 0\\r\\n| extend DestinationPorts= tostring(DestinationPort) \\r\\n| summarize TopDestinationPortsCount= count() by DestinationPorts\\r\\n| top 5 by TopDestinationPortsCount  desc \\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 inbound dstination ports\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Fortinet\\\" \\r\\n| where DeviceProduct contains \\\"Fortigate\\\"\\r\\n| where Activity contains \\\"forward\\\" \\r\\n| where DeviceInboundInterface == \\\"port2\\\"\\r\\n| where \\\"{DestinationIP:lable}\\\" == \\\"All\\\" or DestinationIP in ({DestinationIP}) \\r\\n| where \\\"{DestinationPort:lable}\\\" == \\\"All\\\" or DestinationPort in ({DestinationPort}) \\r\\n| where DestinationPort > 0\\r\\n| extend DestinationPorts= tostring(DestinationPort) \\r\\n| summarize TopDestinationPortsCount= count() by DestinationPorts\\r\\n| top 5 by TopDestinationPortsCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 outbound destination ports\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Fortinet\\\"\\r\\n| where DeviceProduct contains \\\"Fortigate\\\"\\r\\n| where Activity contains \\\"forward\\\"\\r\\n| where DeviceInboundInterface == \\\"port1\\\"\\r\\n| where DestinationTranslatedAddress contains \\\".\\\"\\r\\n| where \\\"{DestinationIP:lable}\\\" == \\\"All\\\" or DestinationIP in ({DestinationIP}) \\r\\n| where \\\"{DestinationPort:lable}\\\" == \\\"All\\\" or DestinationPort in ({DestinationPort}) \\r\\n| summarize InBoundCount= count() by DestinationTranslatedAddress\\r\\n| project-rename DestinationIP= DestinationTranslatedAddress\\r\\n| top 5 by InBoundCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 inbound destination IP addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 16\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Fortinet\\\" \\r\\n| where DeviceProduct contains \\\"Fortigate\\\"\\r\\n| where Activity contains \\\"forward\\\" \\r\\n| where DeviceInboundInterface == \\\"port2\\\"\\r\\n| where \\\"{DestinationIP:lable}\\\" == \\\"All\\\" or DestinationIP in ({DestinationIP}) \\r\\n| where \\\"{DestinationPort:lable}\\\" == \\\"All\\\" or DestinationPort in ({DestinationPort}) \\r\\n| summarize OutBoundCount= count() by DestinationIP\\r\\n| top 5 by OutBoundCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 outbound destination IP addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 16\"},{\"type\":1,\"content\":{\"json\":\"---\"},\"name\":\"text - 19\"}],\"fromTemplateId\":\"sentinel-Fortigate\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=FortigateWorkbook; logoFileName=fortinet_logo.svg; description=Gain insights into Fortigate firewalls by analyzing traffic and activities.\nThis workbook finds correlations in Fortigate threat events and identifies suspicious ports, users, protocols and IP addresses.\nYou can learn about trends across user and data traffic, and drill down into the Fortigate filter results.\nEasily detect attacks on your organization by monitoring management operations such as configuration and logins.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.1.0; title=FortiGate; templateRelativePath=Fortigate.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Fortinet FortiGate Next-Generation Firewall connector for Microsoft Sentinel",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "CommonSecurityLog",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "CefAma",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.7",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Fortinet FortiGate Next-Generation Firewall connector for Microsoft Sentinel",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Fortinet%20FortiGate%20Next-Generation%20Firewall%20connector%20for%20Microsoft%20Sentinel/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>Gain insight into your organization's network and improve your security operation capabilities with the <a href=\"https://www.fortinet.com/products/next-generation-firewall\">Fortinet FortiGate Next-generation Firewall</a> Solution for Microsoft Sentinel. It allows you to easily connect your FortiGate logs with Microsoft Sentinel. This enables you to view dashboards, create custom alerts, and improve investigation.</p>\n<p>Playbooks are included to help in automated remediation</p>\n<p>For questions about <a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/fortinet.fortinet_fortigate-vm_v5?tab=Overview\">FortiGate</a>, please contact Fortinet at <a href=\"mailto:azuresales@fortinet.com\">azuresales@fortinet.com</a>.</p>\n<p>This solution is dependent on the Common Event Format solution containing the CEF via AMA connector to collect the logs. The CEF solution will be installed as part of this solution installation.</p>\n<p><strong>NOTE:</strong> Microsoft recommends installation of CEF via AMA Connector. The existing connectors are about to be deprecated by <strong>Aug 31, 2024</strong>.</p>\n<p><strong>Workbooks:</strong> 1, <strong>Custom Azure Logic Apps Connectors:</strong> 1, <strong>Function Apps:</strong> 1, <strong>Playbooks:</strong> 3</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Azure_Sentinel.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Fortinet FortiGate Next-Generation Firewall connector for Microsoft Sentinel",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "criteria": [
            {
              "kind": "AzureFunction",
              "contentId": "[variables('_FortinetFortigateFunctionApp')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_FortinetCustomConnector')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Fortinet_IncidentEnrichment')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Fortinet_ResponseOnIP')]",
              "version": "[variables('playbookVersion4')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Fortinet_ResponseOnURL')]",
              "version": "[variables('playbookVersion5')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "Solution",
              "contentId": "azuresentinel.azure-sentinel-solution-commoneventformat"
            }
          ]
        },
        "firstPublishDate": "2021-08-13",
        "providers": [
          "Fortinet"
        ],
        "categories": {
          "domains": [
            "Security - Automation (SOAR)",
            "Security - Network"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
