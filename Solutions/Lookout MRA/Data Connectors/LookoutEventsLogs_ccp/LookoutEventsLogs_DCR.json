[
    {
        "name": "LookoutEventsLogsDCR",
        "apiVersion": "2021-09-01-preview",
        "type": "Microsoft.Insights/dataCollectionRules",
        "location": "{{location}}",
        "properties": {
            "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
            "streamDeclarations": {
                "Custom-LookoutPollingLogsV2_CL": {
                    "columns": [
                        {
                            "name": "oid",
                            "type": "string"
                        },
                        {
                            "name": "enterprise_guid",
                            "type": "string"
                        },
                        {
                            "name": "created_time",
                            "type": "datetime"
                        },                  
                        {
                            "name": "change_type",
                            "type": "string"
                        },
                        {
                            "name": "type",
                            "type": "string"
                        },
                        {
                            "name": "device",
                            "type": "dynamic"
                        },
                        {
                            "name": "threat",
                            "type": "dynamic"
                        },
                        {
                            "name": "smishing_alert",
                            "type": "dynamic"
                        },
                        {
                            "name": "audit",
                            "type": "dynamic"
                        },
                        {
                            "name": "target",
                            "type": "dynamic"
                        },
                        {
                            "name": "actor",
                            "type": "dynamic"
                        }
                    ]
                }
            },
            "destinations": {
                "logAnalytics": [
                    {
                        "workspaceResourceId": "{{workspaceResourceId}}",
                        "name": "clv2ws1"
                    }
                ]
            },
            "dataFlows": [
                {
                    "streams": [
                        "Custom-LookoutPollingLogsV2_CL"
                    ],
                    "destinations": [
                        "clv2ws1"
                    ],
                  "transformKql": "source | extend Oid=tostring(oid), Enterprise_guid=tostring(enterprise_guid), Actor_Device_guid=tostring(actor.guid), Created_time=todatetime(created_time), Event_type=tostring(type), Change_type=tostring(change_type), Device_guid=tostring(device.guid), Device_profile_type=tostring(device.profile_type), Device_platform=tostring(device.platform), Device_info=device.info, Device_status_security_status=tostring(device.status.security_status), Device_status_activation_status=tostring(device.status.activation_status), Device_status_protection_status=tostring(device.status.protection_status), Device_hardware_manufacturer=tostring(device.hardware.manufacturer), Device_hardware_model=tostring(device.hardware.model), Device_software_latest_os_version=tostring(device.software.latest_os_version), Device_software_latest_security_patch_level=tostring(device.software.latest_security_patch_level), Device_software_os_version_date=tostring(device.software.os_version_date), Device_software_os_version_rsr=tostring(device.software.os_version_rsr), Device_software_rsr=tostring(device.software.rsr), Device_software_os_version=tostring(device.software.os_version), Device_software_sdk_version=tostring(device.software.sdk_version), Device_software_security_patch_level=tostring(device.software.security_patch_level), Device_client_ota_version=tostring(device.client.ota_version), Device_client_package_name=tostring(device.client.package_name), Device_client_package_version=tostring(device.client.package_version), Device_client_lookout_sdk_version=tostring(device.client.lookout_sdk_version), Device_parent_status_parent_device_guid=tostring(device.parent_status.parent_device_guid), Device_parent_status_activation_status=tostring(device.parent_status.activation_status), Device_parent_status_security_status=tostring(device.parent_status.security_status), Device_parent_status_protection_status=tostring(device.parent_status.protection_status), Threat_guid=tostring(threat.guid), Threat_status=tostring(threat.status), Threat_resolved_at=tostring(threat.resolved_at), Threat_detected_at=tostring(threat.detected_at), Threat_severity=tostring(threat.severity), Threat_type=tostring(threat.type), Threat_classifications=threat.classifications, Threat_assessments=threat.assessments, Threat_details=threat.details, Target_guid=tostring(target.guid), Target_type=tostring(target.type), Audit_type=tostring(audit.type), Audit_attribute_changes=audit.attribute_changes, Smishing_alert_guid=tostring(smishing_alert.guid), Smishing_alert_detections=smishing_alert.detections, Actor_guid=tostring(actor.guid), Actor_type=tostring(actor.type), TimeGenerated=todatetime(created_time) | project Oid, Enterprise_guid, Actor_Device_guid, Created_time, Event_type, Change_type, Device_guid, Device_profile_type, Device_platform, Device_info, Device_status_security_status, Device_status_activation_status, Device_status_protection_status, Device_hardware_manufacturer, Device_hardware_model, Device_software_latest_os_version, Device_software_latest_security_patch_level, Device_software_os_version_date, Device_software_os_version_rsr, Device_software_rsr, Device_software_os_version, Device_software_sdk_version, Device_software_security_patch_level, Device_client_ota_version, Device_client_package_name, Device_client_package_version, Device_client_lookout_sdk_version, Device_parent_status_parent_device_guid, Device_parent_status_activation_status, Device_parent_status_security_status, Device_parent_status_protection_status, Threat_guid, Threat_status, Threat_resolved_at, Threat_detected_at, Threat_severity, Threat_type, Threat_classifications, Threat_assessments, Threat_details, Target_guid, Target_type, Audit_type, Audit_attribute_changes, Smishing_alert_guid, Smishing_alert_detections, Actor_guid, Actor_type, TimeGenerated",
                    "outputStream": "Custom-LookoutPollingLogsV2_CL"
                }
            ]
        }
    }
]