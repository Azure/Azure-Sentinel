id: 6107cba5-2974-4c22-8222-2a6f7bbea664
name: CiscoISE - Certificate has expired
description: |
  'Detects certificate expiration.'
severity: Medium
status: Available
requiredDataConnectors:
  - connectorId: SyslogAma
    datatypes:
      - Syslog
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - CredentialAccess
relevantTechniques:
  - T1552
query: |
  let lbtime = 1h;
  CiscoISEEvent
  | where TimeGenerated > ago(lbtime)
  | where EventId == '60167'
  | project SrcIpAddr, DvcIpAddr, DvcHostname, DstUserName, TimeGenerated
  | extend AccName = split("@", DstUserName)[0], UPNAddr = split("@", DstUserName)[1]
  | extend DvcName = split("@", DvcHostname)[0], NT = split("@", DvcHostname)[1]
  | summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated) by SrcIpAddr, DvcHostname, DvcIpAddr, DstUserName
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: DstUserName
      - identifier: Name
        columnName: AccName
      - identifier: UPNSuffix
        columnName: UPNAddr
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SrcIpAddr
  - entityType: Host
    fieldMappings:
      - identifier: FullName
        columnName: DvcHostname
      - identifier: HostName
        columnName: DvcName
      - identifier: NTDomain
        columnName: NT
version: 1.0.4
kind: Scheduled