{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "a4b4e975-fa7c-46a3-b669-850aacc88134",
            "version": "KqlParameterItem/1.0",
            "name": "Help",
            "label": "üîé Getting Started",
            "type": 10,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\": \"Yes\", \"label\": \"Yes\", \"selected\":true},\r\n    {\"value\": \"No\", \"label\": \"No\"}\r\n]",
            "value": "No"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "DefaultSubscription_Internal",
            "type": 1,
            "isRequired": true,
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| take 1\r\n| project subscriptionId",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "id": "314d02bf-4691-43fa-af59-d67073c8b8fa"
          },
          {
            "id": "e6ded9a1-a83c-4762-938d-5bf8ff3d3d38",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "summarize by subscriptionId\r\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "e3225ed0-6210-40a1-b2d0-66e42ffa71d6",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| order by name asc\r\n| summarize Selected = makelist(id, 10), All = makelist(id, 1000)\r\n| mvexpand All limit 100\r\n| project value = tostring(All), label = tostring(All), selected = iff(Selected contains All, true, false)",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "15b2c181-7397-43c1-900a-28e175ae8a6f",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 604800000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2592000000
                }
              ],
              "allowCustom": true
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "Parameter Selectors"
    },
    {
      "type": 1,
      "content": {
        "json": "<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> Please take time to answer a quick survey,\r\n</span>[<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> click here. </span>](https://forms.office.com/r/sxvBsuTcmM)"
      },
      "name": "Survey"
    },
    {
      "type": 1,
      "content": {
        "json": "## Getting Started\r\nThis solution leverages Azure Policy, Azure Resource Graph, and Azure Log Analytics to align directly with the Azure Security Benchmark. A filter set in guide, subscription, workspace, time, and ASB control are available for customized reporting and review. The documentation below provides getting started recommendations for centralizing log analytics data and enabling Microsoft Defender for Cloud Continuous Export. This offering includes integration with Microsoft 1st Party, Partner 3rd Party ecosystem, hybrid, on-premises, and multi-cloud workloads. Common use cases include conducting ASB assessments which custom reporting, time filtering, subscription filtering, workspace filtering, and guides. The report is exportable for print or PDF with the Print Workbook feature. The solution is organized by ASB control areas, each area has multiple control cards. Control cards include ASB logging over time, current ASB assessment recommendations, ASB status, documentation guides, recommendations, and links to product pages, documentation, and portals for all referenced products.<br>\r\n\r\n### [Recommended Microsoft Sentinel Roles](https://docs.microsoft.com/azure/sentinel/roles) / [Recommended Microsoft Defender for Cloud Roles](https://docs.microsoft.com/azure/defender-for-cloud/permissions#roles-and-allowed-actions)\r\n| <strong> Roles </strong> | <strong> Rights </strong> | \r\n|:--|:--|\r\n|Security Reader | View solutions, Analytics, Security Recommendations |\r\n|Security Contributor| Deploy/Modify solutions, Analytics, Apply Security Recommendations |\r\n|Owner| Assign Regulatory Compliance Initiatives|\r\n\r\n### Onboarding Prerequisites \r\n1Ô∏è‚É£ [Access Microsoft 365 Compliance Manager: Assessments](https://compliance.microsoft.com/compliancemanager?viewid=Assessments)<br>\r\n2Ô∏è‚É£  [Onboard Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/quickstart-onboard)<br>\r\n3Ô∏è‚É£  [Onboard Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/security-center-get-started)<br>\r\n4Ô∏è‚É£ [Add the Azure Security Benchmark Assessment to Your Dashboard](https://docs.microsoft.com/azure/security-center/update-regulatory-compliance-packages#add-a-regulatory-standard-to-your-dashboard)<br>\r\n5Ô∏è‚É£ [Continuously Export Security Center Data to Log Analytics Workspace](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\n6Ô∏è‚É£ [Extend Microsoft Sentinel Across Workspaces and Tenants](https://docs.microsoft.com/azure/sentinel/extend-sentinel-across-workspaces-tenants)<br>\r\n7Ô∏è‚É£ [Configure Auto Provisioning of Microsoft Defender for Cloud Agents](https://docs.microsoft.com/azure/defender-for-cloud/enable-data-collection)<br>\r\n8Ô∏è‚É£ [Review Microsoft Service Trust Portal Documentation/Audit/Resources](https://servicetrust.microsoft.com/)<br>\r\n\r\n### Print/Export Report\r\n1Ô∏è‚É£ Set Background Theme: Settings > Appearance > Theme: Azure > Apply<br>\r\n2Ô∏è‚É£ Print/Export Report: More Content Actions (...) > Print Content<br>\r\n3Ô∏è‚É£ Settings: Layout (Landscape), Pages (All), Print (One Sided), Scale (60), Pages Per Sheet (1), Quality (1,200 DPI), Margins (None) > Print<br>\r\n4Ô∏è‚É£ Executive Summary: Microsoft Defender for Cloud > Regulatory Compliance > Download Report > Report Standard (Azure Security Benchmark), Format (PDF)\r\n\r\n### Important\r\nThis solution demonstrates best practice guidance, but Microsoft does not guarantee nor imply compliance. All requirements, validations, and controls are governed by respective organizations. This solution provides visibility and situational awareness for security capabilities delivered with Microsoft technologies in predominantly cloud-based environments. Customer experience will vary by user and some panels may require additional configurations for operation. Recommendations do not imply coverage of respective controls as they are often one of several courses of action for approaching requirements which is unique to each customer. Recommendations should be considered a starting point for planning full or partial coverage of respective requirements. ",
        "style": "info"
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "Help"
    },
    {
      "type": 1,
      "content": {
        "json": "# [Azure Security Benchmark v3](https://docs.microsoft.com/security/benchmark/azure/)\n---\n\nThe Azure Security Benchmark v3 Solution is designed to enable Cloud Architects, Security Engineers, and Governance Risk Compliance Professionals to gain situational awareness for cloud security posture and hardening. Benchmark recommendations provide a starting point for selecting specific security configuration settings and facilitate risk reduction. The Azure Security Benchmark includes a collection of high-impact security recommendations for improving posture. This workbook provides visibility and situational awareness for security capabilities delivered with Microsoft technologies in predominantly cloud-based environments. Customer experience will vary by user and some panels may require additional configurations for operation. "
      },
      "customWidth": "79",
      "name": "Workbook Overview"
    },
    {
      "type": 1,
      "content": {
        "json": "![Image Name](https://azure.microsoft.com/svghandler/azure-sentinel?width=600&height=315) "
      },
      "customWidth": "20",
      "name": "Microsoft Sentinel Logo"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control Area\\\": \\\"Posture Assessment\\\", \\\"tab\\\": \\\"AT\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Controls Crosswalk\\\", \\\"tab\\\": \\\"CMA\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Network Security\\\", \\\"tab\\\": \\\"NS\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Identity Management\\\", \\\"tab\\\": \\\"IM\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Privileged Access\\\", \\\"tab\\\": \\\"PA\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Data Protection\\\", \\\"tab\\\": \\\"DP\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Asset Management\\\", \\\"tab\\\": \\\"AM\\\" }\\r\\n]\",\"transformers\":null}",
        "size": 3,
        "exportMultipleValues": true,
        "exportedParameters": [
          {
            "fieldName": "tab",
            "parameterName": "Tab",
            "parameterType": 1
          }
        ],
        "queryType": 8,
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Section",
              "formatter": 8,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "tab",
              "formatter": 5
            }
          ]
        }
      },
      "customWidth": "40",
      "name": "Control Areas",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "a30d01d0-38f1-4a91-9cf6-cdb181d676b5",
            "version": "KqlParameterItem/1.0",
            "name": "isATVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "AT",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "c01e9b8b-b285-4aae-8510-68741e0315c3",
            "version": "KqlParameterItem/1.0",
            "name": "isCMAVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "CMA",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isNSVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "NS",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "d41cb044-86ef-4603-ae24-c61e864c067d"
          },
          {
            "id": "7b682fc9-cb6b-4475-a24c-41dcb43d0cef",
            "version": "KqlParameterItem/1.0",
            "name": "isIMVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "IM",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isPAVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "PA",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "15158143-a4f8-417b-90b0-123dd13f1ff5"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isDPVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "DP",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "0077d493-a27d-49d7-b49d-5888805d501e"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isAMVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "AM",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "33690532-5a73-4ac3-8fbd-6fc449a6d166"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "10",
      "name": "Hidden Parameters"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control Area\\\": \\\"Logging & Threat Detection\\\", \\\"tab\\\": \\\"LT\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Incident Response\\\", \\\"tab\\\": \\\"IR\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Posture & Vulnerability Management\\\", \\\"tab\\\": \\\"PV\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Endpoint Security\\\", \\\"tab\\\": \\\"ES\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Backup & Recovery\\\", \\\"tab\\\": \\\"BR\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"DevOps Security\\\", \\\"tab\\\": \\\"DS\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Governance & Strategy\\\", \\\"tab\\\": \\\"GS\\\" }\\r\\n]\",\"transformers\":null}",
        "size": 3,
        "exportMultipleValues": true,
        "exportedParameters": [
          {
            "fieldName": "tab",
            "parameterName": "Tab",
            "parameterType": 1
          }
        ],
        "queryType": 8,
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Section",
              "formatter": 8,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "tab",
              "formatter": 5
            }
          ]
        }
      },
      "customWidth": "40",
      "name": "Control Areas - Copy",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "version": "KqlParameterItem/1.0",
            "name": "isLTVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "LT",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "b7db9449-1027-45a8-a5c1-2eb371722ba6"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isIRVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "IR",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "26b9ae7c-7cfe-4606-8318-d7ff172a1e1a"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isPVVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "PV",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "0ece4c93-cbf9-4b8c-a0ad-ddfa6635919a"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isESVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "ES",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "ebead9f9-b4cc-4ab4-9c06-a5d9ac643825"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isBRVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "BR",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "dcd1bbe4-4979-4459-8b8b-3d2a3f6f7783"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isDSVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "DS",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "342935cc-8a23-46f8-96a6-974808db01c5"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isGSVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "GS",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "a00fd6f7-5f8d-487d-948f-804ab0288aae"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "10",
      "name": "Hidden Parameters - Copy"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Posture Assessment](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n---\r\nThe Posture Assessment section provides a mechanism to find, fix, and resolve Azure Security Benchmark recommendations. A selector provides capability to filter by all, specific, or groups of control families. Upon selection, subordinate panels will summarize recommendations by control family, status over time, recommendations, and resources identified with deep-link for remediation."
            },
            "customWidth": "40",
            "name": "NS Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "10",
            "name": "text - 11"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "99a47f97-1aa4-4840-91ee-119aad6d6217",
                  "version": "KqlParameterItem/1.0",
                  "name": "ComplianceDomain",
                  "label": "Control Area",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| extend ComplianceDomain=iff(ComplianceControl contains \"AM.\", \"Asset Management\", iff(ComplianceControl contains \"BR.\", \"Backup & Recovery\", iff(ComplianceControl contains \"DP.\", \"Data Protection\", iff(ComplianceControl contains \"DS.\", \"DevOps Security\", iff(ComplianceControl contains \"ES.\", \"Endpoint Security\", iff(ComplianceControl contains \"GS.\", \"Governance & Strategy\", iff(ComplianceControl contains \"IM.\", \"Identity Management\", iff(ComplianceControl contains \"IR.\", \"Incident Response\", iff(ComplianceControl contains \"LT.\", \"Logging & Threat Detection\", iff(ComplianceControl contains \"NS.\", \"Network Security\", iff(ComplianceControl contains \"PA.\", \"Privileged Access\", iff(ComplianceControl contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| summarize count() by ComplianceDomain\r\n| sort by count_ desc\r\n| project-away count_\r\n",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "40",
            "name": "parameters - 26"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink) on RecommendationName\r\n| extend ComplianceDomain=iff(controlId contains \"AM.\", \"Asset Management\", iff(controlId contains \"BR.\", \"Backup & Recovery\", iff(controlId contains \"DP.\", \"Data Protection\", iff(controlId contains \"DS.\", \"DevOps Security\", iff(controlId contains \"ES.\", \"Endpoint Security\", iff(controlId contains \"GS.\", \"Governance & Strategy\", iff(controlId contains \"IM.\", \"Identity Management\", iff(controlId contains \"IR.\", \"Incident Response\", iff(controlId contains \"LT.\", \"Logging & Threat Detection\", iff(controlId contains \"NS.\", \"Network Security\", iff(controlId contains \"PA.\", \"Privileged Access\", iff(controlId contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ComplianceDomain in ({ComplianceDomain}) \r\n  | distinct RecommendationName, ComplianceDomain, tostring(RecommendationLink), tostring(state), tostring(complianceState)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\" or complianceState‚ÄØ==‚ÄØ\"Failed\") by ComplianceDomain\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n    | project ControlFamily=ComplianceDomain, Total, PassedControls, Passed, Failed\r\n    | sort by Total, Passed desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Recommendations by Control Area",
              "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ComplianceDomain",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Persistence",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "Passed",
                            "color": "green"
                          },
                          {
                            "columnName": "Failed",
                            "color": "redBright"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "PassedControls",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "count_",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellowOrangeRed"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_compositeBar_Total_1",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_compositeBar_Total_1",
                  "sortOrder": 2
                }
              ]
            },
            "customWidth": "50",
            "name": "query - 6"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ComplianceDomain in ({ComplianceDomain}) \r\n| extend Remediate=RecommendationLink\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
              "size": 0,
              "showAnalytics": true,
              "title": "Recommendations ",
              "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "RecommendationName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Gear",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "Passed",
                            "color": "green"
                          },
                          {
                            "columnName": "Failed",
                            "color": "redBright"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "Remediate",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "OpenBlade",
                      "linkLabel": "Remediate >>",
                      "bladeOpenContext": {
                        "bladeName": "RecommendationsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "assessmentKey",
                            "source": "column",
                            "value": "assessmentKey"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "PassedControls",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "assessmentKey",
                    "formatter": 5
                  }
                ],
                "filter": true
              },
              "sortBy": []
            },
            "customWidth": "50",
            "name": "query - 3"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend ComplianceDomain=iff(controlId contains \"AM.\", \"Asset Management\", iff(controlId contains \"BR.\", \"Backup & Recovery\", iff(controlId contains \"DP.\", \"Data Protection\", iff(controlId contains \"DS.\", \"DevOps Security\", iff(controlId contains \"ES.\", \"Endpoint Security\", iff(controlId contains \"GS.\", \"Governance & Strategy\", iff(controlId contains \"IM.\", \"Identity Management\", iff(controlId contains \"IR.\", \"Incident Response\", iff(controlId contains \"LT.\", \"Logging & Threat Detection\", iff(controlId contains \"NS.\", \"Network Security\", iff(controlId contains \"PA.\", \"Privileged Access\", iff(controlId contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ComplianceDomain in ({ComplianceDomain}) \r\n| distinct RecommendationName, resourceId, tostring(state), tostring(complianceState)\r\n| summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\") by resourceId\r\n|‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| where Failed > 0\r\n| project AssessedResourceId=resourceId, Total, PassedControls, Passed, Failed\r\n| sort by Total, Passed desc\r\n| limit 250\r\n",
              "size": 0,
              "showAnalytics": true,
              "title": "Recommendations by Asset",
              "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AssessedResourceId",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "Passed",
                            "color": "green"
                          },
                          {
                            "columnName": "Failed",
                            "color": "redBright"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "PassedControls",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "RecommendationName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Gear",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ComplianceDomain",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Persistence",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "count_",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellowOrangeRed"
                    }
                  }
                ],
                "filter": true
              }
            },
            "customWidth": "50",
            "name": "query - 9"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| extend ComplianceDomain=iff(ComplianceControl contains \"AM.\", \"Asset Management\", iff(ComplianceControl contains \"BR.\", \"Backup & Recovery\", iff(ComplianceControl contains \"DP.\", \"Data Protection\", iff(ComplianceControl contains \"DS.\", \"DevOps Security\", iff(ComplianceControl contains \"ES.\", \"Endpoint Security\", iff(ComplianceControl contains \"GS.\", \"Governance & Strategy\", iff(ComplianceControl contains \"IM.\", \"Identity Management\", iff(ComplianceControl contains \"IR.\", \"Incident Response\", iff(ComplianceControl contains \"LT.\", \"Logging & Threat Detection\", iff(ComplianceControl contains \"NS.\", \"Network Security\", iff(ComplianceControl contains \"PA.\", \"Privileged Access\", iff(ComplianceControl contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ComplianceDomain in ({ComplianceDomain})\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by ComplianceDomain\r\n| render timechart ",
              "size": 0,
              "showAnalytics": true,
              "title": "Recommendations over Time",
              "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "RecommendationDisplayName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "ControlID",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Recommendation",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Go to Recommendation >"
                    }
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "query - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend ComplianceDomain=iff(controlId contains \"AM.\", \"Asset Management\", iff(controlId contains \"BR.\", \"Backup & Recovery\", iff(controlId contains \"DP.\", \"Data Protection\", iff(controlId contains \"DS.\", \"DevOps Security\", iff(controlId contains \"ES.\", \"Endpoint Security\", iff(controlId contains \"GS.\", \"Governance & Strategy\", iff(controlId contains \"IM.\", \"Identity Management\", iff(controlId contains \"IR.\", \"Incident Response\", iff(controlId contains \"LT.\", \"Logging & Threat Detection\", iff(controlId contains \"NS.\", \"Network Security\", iff(controlId contains \"PA.\", \"Privileged Access\", iff(controlId contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ComplianceDomain in ({ComplianceDomain}) \r\n| where state‚ÄØ==‚ÄØ\"Unhealthy\"\r\n| extend FirstObserved = properties1.status.statusChangeDate\r\n| parse RecommendationLink with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| project ResourceID=resourceId, RecommendationName, ControlFamily=ComplianceDomain, ControlID=controlId, Severity=severity, CurrentState=state, Remediate=RecommendationLink, FirstObserved, assessmentKey\r\n| extend Rank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, 0)))\r\n| sort by Rank desc\r\n| limit 2500",
              "size": 0,
              "showAnalytics": true,
              "title": "Current Recommendation Details",
              "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ResourceID",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "RecommendationName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Gear",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ControlFamily",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Persistence",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ControlID",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "Sev2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev3",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Remediate",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "OpenBlade",
                      "linkLabel": "Remediate >>",
                      "linkIsContextBlade": false,
                      "bladeOpenContext": {
                        "bladeName": "RecommendationsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "assessmentKey",
                            "source": "column",
                            "value": "assessmentKey"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "FirstObserved",
                    "formatter": 6
                  },
                  {
                    "columnMatch": "assessmentKey",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Rank",
                    "formatter": 5
                  }
                ],
                "rowLimit": 5000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_thresholds_Severity_4",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_thresholds_Severity_4",
                  "sortOrder": 1
                }
              ]
            },
            "name": "query - 8"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isATVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Assessment"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Controls Crosswalk](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n---\r\nControls crosswalk provides a mapping of Azure Security Benchmark v3 controls across additional compliance frameworks. This provides free-text search capabilities mapping numerous frameworks including CIS v8, NIST SP 800-53 R4, and PCI-DSS v3. There is also a mapping for recommended Microsoft products for each of these control requirements. "
            },
            "customWidth": "40",
            "name": "Controls Mapping"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Crosswalk = datatable([\"Control Name\"]: string, [\"ASB v3\"]: string, [\"Control Area\"]: string, [\"CIS v8\"]: string, [\"NIST SP 800-53 R4\"]: string, [\"PCI-DSS v3\"]: string, [\"Recommended Products\"]: string) [\r\n\"NS-1: Establish network segmentation boundaries\",\t\"NS-1\",\t\"Network Security\",\t\"3.12 |  13.4 |  4.4\",\t\"\tAC-4 |  SC-2 |  SC-7\",\t\"1.1 |  1.2 |  1.3\",\t\"VirtualNetwork\",\r\n\"NS-2: Secure cloud services with network controls\",\t\"NS-2\",\t\"Network Security\",\t\"3.12 | 4.4\",\t\"AC-4 | SC-2 | SC-7\",\t\"1.1 | 1.2 | 1.3\",\t\"Virtual Network | Private Link\",\r\n\"NS-3: Deploy firewall at the edge of enterprise network\",\t\"NS-3\",\t\"Network Security\",\t\"4.4 | 4.8 | 13.10\",\t\"AC-4 | SC-7 | CM-7\",\t\"1.1 | 1.2 | 1.3\",\t\"Azure Firewall\",\r\n\"NS-4: Deploy intrusion detection/intrusion prevention systems (IDS/IPS)\",\t\"NS-4\",\t\"Network Security\",\t\"13.2 | 13.3 | 13.7 | 13.8\",\t\"SC-7 | SI-4\",\t\"11.4\",\t\"Azure Firewall | Microsoft Defender for Endpoint\",\r\n\"NS-5: Deploy DDOS protection\",\t\"NS-5\",\t\"Network Security\",\t\"13.1\",\t\"SC-5 | SC-7\",\t\"1.1 | 1.2 | 1.3 | 6.6\",\t\"Azure DDoS Protection\",\r\n\"NS-6: Deploy web application firewall\",\t\"NS-6\",\t\"Network Security\",\t\"13.1\",\t\"SC-7\",\t\"1.1 | 1.2 | 1.3\",\t\"Azure Web Application Firewall\",\r\n\"NS-7: Simplify network security configuration\",\t\"NS-7\",\t\"Network Security\",\t\"4.4 | 4.8\",\t\"AC-4 | SC-2 | SC-7\",\t\"1.1 | 1.2 | 1.3\",\t\"Azure Firewall Manager\",\r\n\"NS-8: Detect and disable insecure services and protocols\",\t\"NS-8\",\t\"Network Security\",\t\"4.4 | 4.8\",\t\"CM-2 | CM-6 | CM-7\",\t\"4.1 | A2.1 | A2.2 | A2.3\",\t\"Microsoft Sentinel | Azure Active Directory | Microsoft Defender for Endpoint\",\r\n\"NS-9: Connect on-premises or cloud network privately\",\t\"NS-9\",\t\"Network Security\",\t\"12.7\",\t\"CA-3 | AC-17 | AC-4\",\t\"N/A\",\t\"VPN Gateway | Azure ExpressRoute | Virtual Network\",\r\n\"NS-10: Ensure Domain Name System (DNS) security\",\t\"NS-10\",\t\"Network Security\",\t\"4.9 | 9.2\",\t\"SC-20 | SC-21\",\t\"N/A\",\t\"Azure DNS\",\r\n\"IM-1: Use centralized identity and authentication system\",\t\"IM-1\",\t\"Identity Management\",\t\"6.7 | 12.5\",\t\"AC-2 | AC-3 | IA-2 | IA-8\",\t\"7.2 | 8.3\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"IM-2: Protect identity and authentication systems\",\t\"IM-2\",\t\"Identity Management\",\t\"5.4 | 6.5\",\t\"AC-2 | AC-3 | IA-2 | IA-8 | SI-4\",\t\"8.2, 8.3\",\t\"Azure Active Directory\",\r\n\"IM-3: Manage application identities securely and automatically\",\t\"IM-3\",\t\"Identity Management\",\t\"N/A\",\t\"N/A\",\t\"N/A\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"IM-4: Authenticate server and services\",\t\"IM-4\",\t\"Identity Management\",\t\"N/A\",\t\"IA-9\",\t\"N/A\",\t\"Microsoft Defender for Cloud\",\r\n\"IM-5: Use single sign-on (SSO) for application access\",\t\"IM-5\",\t\"Identity Management\",\t\"12.5\",\t\"IA-4 | IA-2 | IA-8\",\t\"N/A\",\t\"Azure Active Directory\",\r\n\"IM-6: Use strong authentication controls\",\t\"IM-6\",\t\"Identity Management\",\t\"6.3 | 6.4\",\t\"AC-2 | AC-3 | IA-2 | IA-5 | IA-8\",\t\"7.2 | 8.2 | 8.3 | 8.4\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"IM-7: Restrict resource access based on conditions\",\t\"IM-7\",\t\"Identity Management\",\t\"3.3 | 6.4 | 13.5\",\t\"AC-2 | AC-3 | AC-6\",\t\"7.2\",\t\"Azure Active Directory\",\r\n\"IM-8: Restrict the exposure of credential and secrets\",\t\"IM-8\",\t\"Identity Management\",\t\"16.9 | 16.12\",\t\"IA-5\",\t\"3.5 | 6.3 | 8.2\",\t\"Microsoft Sentinel | Azure Active Directory | Microsoft Defender for Endpoint\",\r\n\"IM-9: Secure user access to existing applications\",\t\"IM-9\",\t\"Identity Management\",\t\"6.7 | 12.5\",\t\"AC-2 | AC-3 | SC-11\",\t\"N/A\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud Apps\",\r\n\"PA-1: Separate and limit highly privileged/administrative users\",\t\"PA-1\",\t\"Privileged Access\",\t\"5.4 | 6.8\",\t\"AC-2 | AC-6\",\t\"7.1 | 7.2 | 8.1\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"PA-2: Avoid standing access for user accounts and permissions\",\t\"PA-2\",\t\"Privileged Access\",\t\"7.1 | 7.2 | 8.1\",\t\"AC-2\",\t\"N/A\",\t\"Microsoft Defender for Cloud\",\r\n\"PA-3: Manage lifecycle of identities and entitlements\",\t\"PA-3\",\t\"Privileged Access\",\t\"N/A\",\t\"AC-5 | AC-6\",\t\"7.1 | 7.2 | 8.1\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"PA-4: Review and reconcile user access regularly\",\t\"PA-4\",\t\"Privileged Access\",\t\"5.1 | 5.3 | 5.5\",\t\"5.1 | 5.3 | 5.5\",\t\"7.1 | 7.2 | 8.1 | A3.4\",\t\"Azure Active Directory\",\r\n\"PA-5: Set up emergency access\",\t\"PA-5\",\t\"Privileged Access\",\t\"N/A\",\t\"AC-2\",\t\"N/A\",\t\"Azure Active Directory\",\r\n\"PA-6: Use privileged access workstations\",\t\"PA-6\",\t\"Privileged Access\",\t\"12.8 | 13.5\",\t\"AC-2 | SC-2 | SC-7\",\t\"N/A\",\t\"Azure Active Directory\",\r\n\"PA-7: Follow just enough administration (least privilege) principles\",\t\"PA-7\",\t\"Privileged Access\",\t\"3.3 | 6.8\",\t\"AC-2 | AC-3 | AC-6\",\t\"7.1 | 7.2\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"PA-8: Determine access process for cloud provider support\",\t\"PA-8\",\t\"Privileged Access\",\t\"6.1 | 6.2\",\t\"AC-4 | AC-2 | AC-3\",\t\"N/A\",\t\"Customer Lockbox\",\r\n\"DP-1: Discover | classify | and label sensitive data\",\t\"DP-1\",\t\"Data Protection\",\t\"3.2 | 3.7 | 3.13\",\t\"RA-2 | SC-28\",\t\"A3.2\",\t\"Azure Information Protection\",\r\n\"DP-2: Monitor anomalies and threats targeting sensitive data\",\t\"DP-2\",\t\"Data Protection\",\t\"3.13\",\t\"AC-4 | SI-4\",\t\"A3.2\",\t\"Microsoft Defender for Cloud | Microsoft Sentinel\",\r\n\"DP-3: Encrypt sensitive data in transit\",\t\"DP-3\",\t\"Data Protection\",\t\"3.1\",\t\"SC-8\",\t\"3.5 | 3.6 | 4.1\",\t\"Microsoft Defender for Cloud\",\r\n\"DP-4: Enable data at rest encryption by default\",\t\"DP-4\",\t\"Data Protection\",\t\"3.11\",\t\"SC-28\",\t\"3.4 | 3.5\",\t\"Microsoft Defender for Cloud\",\r\n\"DP-5: Use customer-managed key option in data at rest encryption when required\",\t\"DP-5\",\t\"Data Protection\",\t\"3.11\",\t\"SC-12 | SC-28\",\t\"3.4 | 3.5 | 3.6\",\t\"Microsoft Defender for Cloud | Key Vault\",\r\n\"DP-6: Use a secure key management process\",\t\"DP-6\",\t\"Data Protection\",\t\"N/A\",\t\"IA-5 | SC-12 | SC-28\",\t\"3.6\",\t\"Microsoft Defender for Cloud | Key Vault\",\r\n\"DP-7: Use a secure certificate management process\",\t\"DP-7\",\t\"Data Protection\",\t\"N/A\",\t\"IA-5 | SC-12 | SC-17\",\t\"3.6\",\t\"Microsoft Defender for Cloud | Microsoft Sentinel\",\r\n\"DP-8: Ensure security of key and certificate repository\",\t\"DP-8\",\t\"Data Protection\",\t\"N/A\",\t\"IA-5 | SC-12 | SC-17\",\t\"3.6\",\t\"Microsoft Defender for Cloud | Key Vault\",\r\n\"AM-1: Track asset inventory and their risks\",\t\"AM-1\",\t\"Asset Management\",\t\"1.1 | 1.5 | 2.1 | 2.4\",\t\"CM-8 | PM-5\",\t\"2.4\",\t\"Azure Resource Graph\",\r\n\"AM-2: Use only approved services\",\t\"AM-2\",\t\"Asset Management\",\t\"2.5 | 2.6 | 2.7 | 4.8\",\t\"CM-8 | PM-5\",\t\"6.3\",\t\"Microsoft Defender for Cloud | Azure Resource Graph\",\r\n\"AM-3: Ensure security of asset lifecycle management\",\t\"AM-3\",\t\"Asset Management\",\t\"1.1 | 2.1\",\t\"CM-8 | CM-7\",\t\"2.4\",\t\"Azure Monitor\",\r\n\"AM-4: Limit access to asset management\",\t\"AM-4\",\t\"Asset Management\",\t\"3.3\",\t\"AC-3\",\t\"N/A\",\t\"Azure Active Directory\",\r\n\"AM-5: Use only approved applications in virtual machine\",\t\"AM-5\",\t\"Asset Management\",\t\"2.5 | 2.6 | 2.7 | 4.8\",\t\"CM-8 | CM-7 | CM-10 | CM-11\",\t\"6.3\",\t\"Microsoft Defender for Cloud | Azure Automation\",\r\n\"LT-1: Enable threat detection capabilities\",\t\"LT-1\",\t\"Logging & Threat Detection\",\t\"8.11\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"10.6 | 10.8 | A3.5\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Microsoft Defender for Cloud Apps | Azure Active Directory | Microsoft Defender for Endpoint | Microsoft Defender for Office 365\",\r\n\"LT-2: Enable threat detection for identity and access management\",\t\"LT-2\",\t\"Logging & Threat Detection\",\t\"8.11\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"10.6 | 10.8 | A3.5\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"LT-3: Enable logging for security investigation\",\t\"LT-3\",\t\"Logging & Threat Detection\",\t\"8.2 | 8.5 | 8.12\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"10.1 | 10.2 | 10.3\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Azure Monitor\",\r\n\"LT-4: Enable network logging for security investigation\",\t\"LT-4\",\t\"Logging & Threat Detection\",\t\"8.2 | 8.5 | 8.6 | 8.7 | 13.6\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"10.8\",\t\"Microsoft Defender for Cloud | Azure Firewall | Azure Web Application Firewall | Application Gateway | Virtual Network | Azure Resource Graph\",\r\n\"LT-5: Centralize security log management and analysis\",\t\"LT-5\",\t\"Logging & Threat Detection\",\t\"8.9 | 8.11 | 13.1\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"N/A\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Azure Monitor\",\r\n\"LT-6: Configure log storage retention\",\t\"LT-6\",\t\"Logging & Threat Detection\",\t\"8.3 | 8.10\",\t\"AU-11\",\t\"10.5 | 10.7\",\t\"Microsoft Defender for Cloud | Azure Monitor\",\r\n\"LT-7: Use approved time synchronization sources\",\t\"LT-7\",\t\"Logging & Threat Detection\",\t\"8.4\",\t\"AU-8\",\t\"10.4\",\t\"Azure Active Directory Domain Services | Azure Policy | Virtual Machines\",\r\n\"IR-1: Preparation - update incident response plan and handling process\",\t\"IR-1\",\t\"Incident Response\",\t\"17.4 | 17.7\",\t\"IR-4 | IR-8\",\t\"10.8\",\t\"Microsoft Sentinel\",\r\n\"IR-2: Preparation - setup incident notification\",\t\"IR-2\",\t\"Incident Response\",\t\"17.1 | 17.3 | 17.6\",\t\"IR-4 | IR-8 | IR-5 | IR-6\",\t\"12.1\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Azure Logic Apps\",\r\n\"IR-3: Detection and analysis - create incidents based on high-quality alerts\",\t\"IR-3\",\t\"Incident Response\",\t\"17.9\",\t\"IR-4 | IR-5 | IR-7\",\t\"10.8\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud\",\r\n\"IR-4: Detection and analysis - investigate an incident\",\t\"IR-4\",\t\"Incident Response\",\t\"N/A\",\t\"IR-4\",\t\"12.1\",\t\"Microsoft Sentinel\",\r\n\"IR-5: Detection and analysis - prioritize incidents\",\t\"IR-5\",\t\"Incident Response\",\t\"17.4 | 17.9\",\t\"IR-4\",\t\"12.1\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud\",\r\n\"IR-6: Containment | eradication and recovery - automate the incident handling\",\t\"IR-6\",\t\"Incident Response\",\t\"N/A\",\t\"IR-4 | IR-5 | IR-6\",\t\"12.1\",\t\"Microsoft Sentinel | Azure Logic Apps\",\r\n\"IR-7: Post-incident activity - conduct lesson learned and retain evidence\",\t\"IR-7\",\t\"Incident Response\",\t\"17.8\",\t\"IR-4\",\t\"12.1\",\t\"Microsoft Sentinel | Azure Logic Apps\",\r\n\"PV-1: Define and establish secure configurations\",\t\"PV-1\",\t\"Posture & Vulnerability Management\",\t\"4.1 | 4.2\",\t\"CM-2 | CM-6\",\t\"1.1\",\t\"Azure Policy | Azure Blueprints\",\r\n\"PV-2: Audit and enforce secure configurations\",\t\"PV-2\",\t\"Posture & Vulnerability Management\",\t\"4.1 | 4.2\",\t\"CM-2 | CM-6\",\t\"2.2\",\t\"Microsoft Defender for Cloud\",\r\n\"PV-3: Define and establish secure configurations for compute resources\",\t\"PV-3\",\t\"Posture & Vulnerability Management\",\t\"4.1\",\t\"CM-2 | CM-6\",\t\"2.2\",\t\"Microsoft Defender for Cloud | Azure Automation\",\r\n\"PV-4: Audit and enforce secure configurations for compute resources\",\t\"PV-4\",\t\"Posture & Vulnerability Management\",\t\"4.1\",\t\"CM-2 | CM-6\",\t\"2.2\",\t\"Microsoft Defender for Cloud\",\r\n\"PV-5: Perform vulnerability assessments\",\t\"PV-5\",\t\"Posture & Vulnerability Management\",\t\"5.5 | 7.1 | 7.5 | 7.6\",\t\"RA-3 | RA-5\",\t\"6.1 | 6.2 | 6.6\",\t\"Microsoft Defender for Cloud | Microsoft Defender for Endpoint\",\r\n\"PV-6: Rapidly and automatically remediate vulnerabilities\",\t\"PV-6\",\t\"Posture & Vulnerability Management\",\t\"7.2 | 7.3 | 7.4 | 7.7\",\t\"RA-3 | RA-5 | SI-2\",\t\"6.1 | 6.2 | 6.5 | 11.2\",\t\"Microsoft Defender for Cloud | Azure Automation\",\r\n\"PV-7: Conduct regular red team operations\",\t\"PV-7\",\t\"Posture & Vulnerability Management\",\t\"18.1 | 18.2 | 18.3 | 18.4 | 18.5\",\t\"CA-8 | RA-5\",\t\"6.6 | 11.2 | 11.3\",\t\"Microsoft Sentinel | Microsoft 365 Compliance Manager\",\r\n\"ES-1: Use Endpoint Detection and Response (EDR)\",\t\"ES-1\",\t\"Endpoint Security\",\t\"13.7\",\t\"SC-3 | SI-2 | SI-3 | SI-16\",\t\"11.5\",\t\"Microsoft Defender for Cloud | Microsoft Defender for Endpoint\",\r\n\"ES-2: Use modern anti-malware software\",\t\"ES-2\",\t\"Endpoint Security\",\t\"10.1\",\t\"SC-3 | SI-2 | SI-3 | SI-16\",\t\"5.1\",\t\"Microsoft Defender for Cloud | Microsoft Defender for Endpoint\",\r\n\"ES-3: Ensure anti-malware software and signatures are updated\",\t\"ES-3\",\t\"Endpoint Security\",\t\"10.2\",\t\"SI-2 | SI-3\",\t\"5.2\",\t\"Microsoft Defender for Cloud | Microsoft Defender for Endpoint\",\r\n\"BR-1: Ensure regular automated backups\",\t\"BR-1\",\t\"Backup & Recovery\",\t\"11.2\",\t\"CP-2 | CP-4 | CP-9\",\t\"N/A\",\t\"Microsoft Defender for Cloud | Azure Backup\",\r\n\"BR-2: Protect backup and recovery data\",\t\"BR-2\",\t\"Backup & Recovery\",\t\"11.3\",\t\"CP-6 | CP-9\",\t\"3.4\",\t\"Microsoft Defender for Cloud | Azure Backup\",\r\n\"BR-3: Monitor backups\",\t\"BR-3\",\t\"Backup & Recovery\",\t\"11.3\",\t\"CP-9\",\t\"N/A\",\t\"Azure Backup | Key Vault\",\r\n\"BR-4: Regularly test backups\",\t\"BR-4\",\t\"Backup & Recovery\",\t\"11.5\",\t\"CP-4 | CP-9\",\t\"N/A\",\t\"Azure Backup | Key Vault\",\r\n\"DS-1: Conduct Threat Modeling\",\t\"DS-1\",\t\"DevOps Security\",\t\"16.10 | 16.14\",\t\"SA-15\",\t\"6.5 | 12.2\",\t\"Threat Modeling Tool | Microsoft Sentinel\",\r\n\"DS-2: Ensure Software Supply Chain Security\",\t\"DS-2\",\t\"DevOps Security\",\t\"16.4 | 16.6 | 16.11\",\t\"SA-12 | SA-15\",\t\"6.3 | 6.5\",\t\"Microsoft Defender for Cloud | GitHub\",\r\n\"DS-3: Secure DevOps Infrastructure\",\t\"DS-3\",\t\"DevOps Security\",\t\"16.7\",\t\"CM-2 | CM-6 | AC-2 | AC-3 | AC-6\",\t\"2.2 | 6.3 | 7.1\",\t\"Microsoft Sentinel\",\r\n\"DS-4: Integrate Static Application Security Testing into DevOps Pipeline\",\t\"DS-4\",\t\"DevOps Security\",\t\"16.12\",\t\"SA-11\",\t\"6.3 | 6.5\",\t\"Credential Scanner | Binskim | CodeQL | GitHub: Secret Scanning\",\r\n\"DS-5: Integrate Dynamic Application Security Testing into DevOps Pipeline\",\t\"DS-5\",\t\"DevOps Security\",\t\"16.12\",\t\"SA-11\",\t\"6.3 | 6.5\",\t\"Azure DevOps | Azure Marketplace\",\r\n\"DS-6: Enforce Security of Workload throughout DevOps Lifecycle\",\t\"DS-6\",\t\"DevOps Security\",\t\"7.5 | 7.6 | 7.7 | 16.1 | 16.7\",\t\"CM-2 | CM-6 | AC-2 | AC-3 | AC-6\",\t\"6.1 | 6.2 | 6.3\",\t\"Microsoft Defender for Cloud\",\r\n\"DS-7: Enable Logging and Monitoring in DevOps\",\t\"DS-7\",\t\"DevOps Security\",\t\"8.2 | 8.5 | 8.9 | 8.11\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"10.1 | 10.2 | 10.3 | 10.6\",\t\"Microsoft Sentinel | GitHub | Azure DevOps\",\r\n\"GS-1: Align organization roles | responsibilities and accountabilities\",\t\"GS-1\",\t\"Governance & Strategy\",\t\"14.9\",\t\"PL-9 | PM-10 | PM-13 | AT-1 | AT-3\",\t\"2.4\",\t\"Azure Active Directory\",\r\n\"GS-2: Define and implement enterprise segmentation/separation of duties strategy\",\t\"GS-2\",\t\"Governance & Strategy\",\t\"3.12\",\t\"AC-4 | SC-7 | SC-2\",\t\"1.2 | 6.4\",\t\"Azure ExpressRoute | VPN Gateway | Azure Active Directory\",\r\n\"GS-3: Define and implement data protection strategy\",\t\"GS-3\",\t\"Governance & Strategy\",\t\"3.1 | 3.7 | 3.12\",\t\"AC-4 | SI-4 | SC-8 | SC-12 | SC-17 | SC-28 | RA-2\",\t\"3.1 | 3.2 | 3.3 | 3.4 | 3.5 | 3.6 | 3.7 | 4.1 | A3.2\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Azure Information Protection | Microsoft Defender for Endpoint | Microsoft 365 Defender | Microsoft Defender for Office 365 | Microsoft Cloud App Security\",\r\n\"GS-4: Define and implement network security strategy\",\t\"GS-4\",\t\"Governance & Strategy\",\t\"12.2 | 12.4\",\t\"AC-4 | AC-17 | CA-3 | CM-1 | CM-2 | CM-6 | CM-7 | SC-1 | SC-2 | SC-5 | SC-7 | SC-20 | SC-21 | SI-4\",\t\"1.1 | 1.2 | 1.3 | 1.5 | 4.1 | 6.6 | 11.4 | A2.1 | A2.2 | A2.3 | A3.2\",\t\"Virtual Network | Azure Firewall | Azure Web Application Firewall\",\r\n\"GS-5: Define and implement security posture management strategy\",\t\"GS-5\",\t\"Governance & Strategy\",\t\"4.1 | 4.2\",\t\"CA-1 | CA-8 | CM-1 | CM-2 | CM-6 | RA-1 | RA-3 | RA-5 | SI-1 | SI-2 | SI-5\",\t\"1.1 | 1.2 | 2.2 | 6.1 | 6.2 | 6.5 | 6.6 | 11.2 | 11.3 | 11.5\",\t\"Microsoft Defender for Cloud\",\r\n\"GS-6: Define and implement identity and privileged access strategy\",\t\"GS-6\",\t\"Governance & Strategy\",\t\"5.6 | 6.5 | 6.7\",\t\"AC-1 | AC-2 | AC-3 | AC-4 | AC-5 | AC-6 | IA-1 | IA-2 | IA-4 | IA-5 | IA-8 | IA-9 | SI-4\",\t\"7.1 | 7.2 | 7.3 | 8.1 | 8.2 | 8.3 | 8.4 | 8.5 | 8.6 | 8.7 | 8.8 | A3.4\",\t\"Azure Active Directory\",\r\n\"GS-7: Define and implement logging | threat detection and incident response strategy\",\t\"GS-7\",\t\"Governance & Strategy\",\t\"8.1 | 13.1 | 17.2 | 17.4 | 17.7\",\t\"AU-1 | IR-1 | IR-2 | IR-10 | SI-1 | SI-5\",\t\"10.1 | 10.2 | 10.3 | 10.4 | 10.5 | 10.6 | 10.7 | 10.8 | 10.9 | 12.10 | A3.5\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Azure Monitor\",\r\n\"GS-8: Define and implement backup and recovery strategy\",\t\"GS-8\",\t\"Governance & Strategy\",\t\"11.1\",\t\"CP-1 | CP-9 | CP-10\",\t\"3.4\",\t\"Azure Backup\",\r\n\"GS-9: Define and implement endpoint security strategy\",\t\"GS-9\",\t\"Governance & Strategy\",\t\"4.4 | 10.1\",\t\"SI-2 | SI-3 | SC-3\",\t\"5.1 | 5.2 | 5.3 | 5.4 | 11.5\",\t\"Microsoft Defender for Endpoint | Microsoft Defender for Cloud\",\r\n\"GS-10: Define and implement DevOps security strategy\",\t\"GS-10\",\t\"Governance & Strategy\",\t\"4.1 | 4.2 | 16.1 | 16.2\",\t\"SA-12 | SA-15 | CM-1 | CM-2 | CM-6 | AC-2 | AC-3 | AC-6 | SA-11 | AU-6 | AU-12 | SI-4\",\t\"2.2 | 6.1 | 6.2 | 6.3 | 6.5 | 7.1 | 10.1 | 10.2 | 10.3 | 10.6 | 12.2\",\t\"GitHub | Azure DevOps\"\r\n];\r\nCrosswalk\r\n| project [\"Control Name\"], [\"Control Area\"], [\"Recommended Products\"], [\"NIST SP 800-53 R4\"], [\"CIS v8\"],[\"PCI-DSS v3\"]",
              "size": 0,
              "showAnalytics": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control Name",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Persistence",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Recommended Products",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "query - 1"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isCMAVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Controls Mapping"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Network Security (NS)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security)\r\n---\r\n\r\nNetwork Security covers controls to secure and protect Azure networks, including securing virtual networks, establishing private connections, preventing and mitigating external attacks, and securing DNS. "
            },
            "customWidth": "40",
            "name": "NS Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "text - 11"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Establish Network Segmentation Boundaries (NS-1)\\\", \\\"tab\\\": \\\"NS1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Secure Cloud Services with Network Controls (NS-2)\\\", \\\"tab\\\": \\\"NS2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Deploy Firewall at the Edge of Enterprise Network (NS-3)\\\", \\\"tab\\\": \\\"NS3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Deploy Intrusion Prevention Systems (NS-4)\\\", \\\"tab\\\": \\\"NS4\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Deploy DDOS Protection (NS-5)\\\", \\\"tab\\\": \\\"NS5\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isNS1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "NS1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isNS2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "NS2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "5a3550b0-a5cc-40f2-8de4-c6eeb7613825"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isNS3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "NS3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "56667767-7bc7-482e-a9ee-a586388dea35"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isNS4Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "NS4",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "97d1ea2a-9b09-41d5-9cc1-1bbe5c450c63"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isNS5Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "NS5",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "e3efe6ef-e4f9-4239-a56a-cb759f3232f7"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Deploy Web Application Firewall (NS-6)\\\", \\\"tab\\\": \\\"NS6\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Simplify Network Security Configuration (NS-7)\\\", \\\"tab\\\": \\\"NS7\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Detect and Disable Insecure Services and Protocols (NS-8)\\\", \\\"tab\\\": \\\"NS8\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Connect On-Premises or Cloud Network Privately (NS-9)\\\", \\\"tab\\\": \\\"NS9\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Ensure Domain Name System (DNS) Security (NS-10)\\\", \\\"tab\\\": \\\"NS10\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "9d73c278-b084-4ad5-a62c-34da79aeb1e4",
                  "version": "KqlParameterItem/1.0",
                  "name": "isNS6Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "NS6",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "632225ba-7633-4757-afac-3acd25aa16a7",
                  "version": "KqlParameterItem/1.0",
                  "name": "isNS7Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "NS7",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "556013a1-3233-4222-805a-4d9e645908cc",
                  "version": "KqlParameterItem/1.0",
                  "name": "isNS8Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "NS8",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "7910479a-d93a-4529-a520-3a9ee2cd797b",
                  "version": "KqlParameterItem/1.0",
                  "name": "isNS9Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "NS9",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "60660fc5-6d89-41e1-926b-feb8390baf2c",
                  "version": "KqlParameterItem/1.0",
                  "name": "isNS10Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "NS10",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Establish Network Segmentation Boundaries (NS-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-1-establish-network-segmentation-boundaries)\r\n\r\nEnsure that your virtual network deployment aligns to your enterprise segmentation strategy defined in the GS-2 security control. Any workload that could incur higher risk for the organization should be in isolated virtual networks.\r\n\r\n## Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/) <br>\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Azure Virtual Network concepts and best practices](https://docs.microsoft.com/azure/virtual-network/concepts-and-best-practices)<br>\r\nüí° [Add, change, or delete a virtual network subnet](https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-subnet)<br>\r\nüí° [How to create a network security group with security rules](https://docs.microsoft.com/azure/virtual-network/tutorial-filter-network-traffic)<br>\r\nüí° [Understand and use application security groups](https://docs.microsoft.com/azure/virtual-network/network-security-groups-overview#application-security-groups)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Network Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FNetworkSecurityGroups)<br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks)<br>\r\nüîÄ [Application Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FapplicationSecurityGroups)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isNSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "text - 5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"NS.1\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"securitygroups\" or type contains \"network\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "  Network Assets & Infrastructure",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 7"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where Category == \"NetworkSecurityGroupRuleCounter\"\r\n| summarize\r\n    Deny‚ÄØ=‚ÄØcountif(type_s == \"block\"),\r\n    Allow‚ÄØ=‚ÄØcountif(type_s == \"allow\"),\r\n    Total‚ÄØ=‚ÄØcountif(type_s == \"allow\" or type_s == \"block\")\r\n    by ruleName_s, ResourceId\r\n| project RuleName=ruleName_s, ResourceId, Total, Allow, Deny\r\n| sort by Total desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Network Security Group Rules by Action Count",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RuleName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "BlankDashboard",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Allow",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Deny",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 7 - Copy",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isNS1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Secure Cloud Services with Network Controls (NS-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-2-secure-cloud-services-with-network-controls)\r\n\r\nSecure cloud services by establishing a private access point for the resources. You should also disable or restrict access from public network when possible.\r\n\r\n## Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Private Link](https://azure.microsoft.com/services/private-link/) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/) <br>\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Understand Azure Private Link](https://docs.microsoft.com/azure/private-link/private-link-overview)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Private Link](https://portal.azure.com/#blade/Microsoft_Azure_Network/PrivateLinkCenterBlade/overview)<br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks)<br>\r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isNSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "NS-2"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"NS.2\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"private\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Private Links",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": " Private Links"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isNS2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Deploy Firewall at Edge of Enterprise Network (NS-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-3-deploy-firewall-at-the-edge-of-enterprise-network)\r\n\r\nDeploy a firewall to perform advanced filtering on network traffic to and from external networks. You can also use firewalls between internal segments to support a segmentation strategy. If required, use custom routes for your subnet to override the system route when you need to force the network traffic to go through a network appliance for security control purpose.\r\n\r\n## Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall](https://azure.microsoft.com/services/azure-firewall/)<br>\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [How to deploy Azure Firewall](https://docs.microsoft.com/azure/firewall/tutorial-firewall-deploy-portal)<br>\r\nüí° [Virtual network traffic routing](https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Azure Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FazureFirewalls)<br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks)<br>\r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isNSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "NS-3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"NS.3\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"firewall\" and type !contains \"web\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Firewalls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": " Firewalls"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//reference list posted here : https://docs.microsoft.com/azure/data-explorer/kusto/query/ipv4-lookup-plugin\r\nlet geoData = externaldata\r\n(network:string,geoname_id:string,continent_code:string,continent_name:string,\r\ncountry_iso_code:string,country_name:string,is_anonymous_proxy:string,is_satellite_provider:string)\r\n[@\"https://raw.githubusercontent.com/datasets/geoip2-ipv4/master/data/geoip2-ipv4.csv\"] with (ignoreFirstRecord=true, format=\"csv\");\r\nlet materializedData =\r\n(\r\nAzureDiagnostics\r\n| where Category == \"AzureFirewallNetworkRule\"\r\n| where OperationName <> \"AzureFirewallThreatIntelLog\"\r\n| where OperationName <> \"AzureFirewallIDSLog\"\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n| project msg_s, Resource, TimeGenerated,ResourceId , ResourceGroup , SubscriptionId);\r\nunion\r\n(\r\n// Azure Firewall Networking - Standard Log\r\nmaterializedData\r\n| where msg_s !has \"Type=\" and msg_s !has \"DNAT'ed\" and msg_s !has \"Rule Collection:\" and msg_s !has \"Policy:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \". Action: \" Action\r\n),\r\n(\r\n// Azure Firewall Networking with ICMP\r\nmaterializedData\r\n| where msg_s has \"Type=\"\r\n| parse msg_s with Protocol \" Type=\" ICMPType \" request from \" SourceIP \" to \" DestinationIP \". Action: \" Action\r\n),\r\n(\r\n// Azure Firewall Networking DNAT rule - Standard\r\nmaterializedData\r\n| where msg_s has \"DNAT'ed\" and msg_s !has \". Rule Collection:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \" was \" Action \" to \" NatDestination\r\n),\r\n(\r\n// Azure Firewall Networking DNAT rule (firewall not using policy)\r\nmaterializedData\r\n| where msg_s has \"DNAT'ed\" and msg_s has \". Rule Collection:\" and msg_s !has \"Policy:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \" was \" Action \" to \" NatDestination \". Rule Collection: \" RuleCollection \". Rule: \" Rule\r\n),\r\n(\r\n// Azure Firewall Networking DNAT rule (firewall using policy)\r\nmaterializedData\r\n| where msg_s has \"DNAT'ed\" and msg_s has \". Rule Collection:\" and msg_s has \"Policy:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \" was \" Action \" to \" NatDestination \". Policy: \" Policy \". Rule Collection Group:\" RuleCollectionGroup \". Rule Collection: \" RuleCollection \". Rule: \" Rule\r\n),\r\n(\r\n// Azure Firewall Network rule (firewall not using policy)\r\nmaterializedData\r\n| where msg_s has \"Rule Collection:\" and msg_s !has \"Policy:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \". Action: \" Action \". Rule Collection: \" RuleCollection \". Rule Name: \" Rule\r\n),\r\n(\r\n// Azure Firewall Network rule (firewall using policy)\r\nmaterializedData\r\n| where msg_s has \"Policy:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \". Action: \" Action \". Policy:\" Policy \". Rule Collection Group:\" RuleCollectionGroup \". Rule Collection: \" RuleCollection \". Rule Name: \" Rule\r\n)\r\n| summarize by TimeGenerated,Protocol, ICMPType, Action,SourceIP, SourcePort, DestinationIP , DestinationPort , NatDestination, ResourceId , ResourceGroup , SubscriptionId\r\n| evaluate ipv4_lookup (geoData, DestinationIP,  network, false)\r\n| project ResourceId, Action, Protocol, SourceIP, SourcePort, DestinationIP, DestinationPort, country_name,TimeGenerated \r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Azure Firewall Traffic",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Action",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "contains",
                                "thresholdValue": "Allow",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "contains",
                                "thresholdValue": "Deny",
                                "representation": "4",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "1",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RuleName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "BlankDashboard",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Allow",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Deny",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 7 - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isNS3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Deploy Intrusion Prevention Systems (NS-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-4-deploy-intrusion-detectionintrusion-prevention-systems-idsips)\r\n\r\nUse network intrusion detection and intrusion prevention systems (IDS/IPS) to inspect the network and payload traffic to or from your workload. Ensure that IDS/IPS is always tuned to provide high-quality alerts to your SIEM solution.\r\n\r\n## Recommended Logs\r\nüî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) <br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>  \r\n\r\n## Implementation\r\nüí° [Azure Firewall IDPS](https://docs.microsoft.com/azure/firewall/premium-features#idps)<br>\r\nüí° [Microsoft Defender for Endpoint capability](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/overview-endpoint-detection-response)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Azure Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FazureFirewalls)<br>\r\nüîÄ [Microsoft Defender XDR](https://security.microsoft.com/) <br> "
                        },
                        "conditionalVisibility": {
                          "parameterName": "isNS4Visible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "NS-4"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where ResourceType == \"AZUREFIREWALLS\"\r\n| where OperationName == \"AzureFirewallIDSLog\"\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestIP \":\" DestPort \". Action: \" Action \". Signature: \" SignatureID \". IDS:\" Message \". Priority:\" Priority \". Classification:\" Classification\r\n| extend IPS_Policy=strcat(\"IPS_Policy\")\r\n| project Action, IPS_Policy, SignatureID, Message, Protocol, SourceIP, SourcePort, DestIP, DestPort, TimeGenerated\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Intrusion Prevention Actions (Azure Firewall)",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Action",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IPS_Policy",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "IPS Policy >>",
                            "bladeOpenContext": {
                              "bladeName": "FirewallManagerMenuBlade",
                              "extensionName": "Microsoft_Azure_HybridNetworking",
                              "bladeParameters": []
                            }
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 7"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Title contains \"intrusion\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents: Intrusions",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isNS4Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Deploy DDoS Protection (NS-5)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-5-deploy-ddos-protection)\r\n\r\nDeploy distributed denial of service (DDoS) protection to protect your network and applications from attacks.\r\n\r\n## Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/AzureDiagnostics) ‚ú≥Ô∏è [Azure DDoS Protection](https://azure.microsoft.com/services/ddos-protection/)<br>  üî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br>\r\n\r\n## Implementation\r\nüí° [Manage Azure DDoS Protection Standard using the Azure portal](https://docs.microsoft.com/azure/virtual-network/manage-ddos-protection)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [DDoS Protection Plans](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isNSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "NS-5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"NS.5\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"dos\"\r\n| project id,type,resourceGroup\r\n| order by type asc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Azure DDoS Plans",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Rule",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Title contains \"dos\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents: DDoS",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isNS5Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Deploy Web Application Firewall (NS-6)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-6-deploy-web-application-firewall)\r\n\r\nDeploy a web application firewall (WAF) and configure the appropriate rules to protect your web applications and APIs from application-specific attacks.\r\n\r\n## Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter)üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Web Application Firewall](https://azure.microsoft.com/services/web-application-firewall/)<br> \r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n## Implementation\r\nüí° [How to deploy Azure WAF](https://docs.microsoft.com/azure/web-application-firewall/overview)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Web Application Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FFrontDoorWebApplicationFirewallPolicies)<br>"
                        },
                        "name": "NS-6"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"NS.6\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"webapplicationfirewall\"\r\n| project id,type,resourceGroup\r\n| order by type asc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Web Application Firewalls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Rule",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Title contains \"WAF\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents: WAF",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isNS6Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Simplify Network Security Configuration (NS-7)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-7-simplify-network-security-configuration)\r\n\r\nWhen managing a complex network environment, use tools to simplify, centralize and enhance the network security management.\r\n\r\n## Recommended Logs \r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Adaptive Network Hardening in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/security-center-adaptive-network-hardening)<br>\r\nüí° [Azure Firewall Manager](https://docs.microsoft.com/azure/firewall-manager/overview)<br>\r\nüí° [Create an Azure Firewall and a firewall policy - ARM template](https://docs.microsoft.com/azure/firewall-manager/quick-firewall-policy)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Firewall Manager](https://portal.azure.com/#blade/Microsoft_Azure_HybridNetworking/FirewallManagerMenuBlade/firewallManagerOverview)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isNSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "NS-6"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"NS.7\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isNS7Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS-7",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Detect & Disable Insecure Services & Protocols (NS-8)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-8-detect-and-disable-insecure-services-and--protocols)\r\n\r\nDetect and disable insecure services and protocols at the OS, application, or software package layer. Deploy compensating controls if disabling insecure services and protocols are not possible.\r\n\r\n## Recommended Logs \r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Microsoft Sentinel insecure protocols workbook](https://docs.microsoft.com/azure/sentinel/quickstart-get-visibility#use-built-in-workbooks)<br>\r\nüí° [Conditional Access: Block legacy authentication](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-policy-block-legacy)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Microsoft Entra ID: Conditional Access](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/Policies)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isNSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "text - 5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"NS.8\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\r\nlet legacyAuth = SigninLogs\r\n| where ResultType == 0\r\n| where ClientAppUsed !contains \"Browser\" and ClientAppUsed !contains \"Mobile Apps and Desktop clients\"\r\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), Protocol=\"AAD Legacy Auth\";\r\nSecurityEvent\r\n| parse EventData with * '\"TicketEncryptionType\">' TicketEncryptionType '<' *\r\n| union Event\r\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \"0x12\" and TicketEncryptionType != \"0x11\") or ((EventLog =~ \"System\" and Source =~ \"NETLOGON\") and EventID in (scEvents))\r\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), tostring(EventID)\r\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\r\n| extend Protocol = case(EventID == 4776, \"WDigest\", EventID == 4768 or EventID == 4769, \"Weak Kerberos Cipher\", EventID == 2889, \"Insecure LDAP\", EventID == 4624, \"NTLM v1\", EventID == 3000, \"SMBv1\", EventID in (scEvents), \"Vulnerable Secure Channel\", \"Unknown\")\r\n| project Protocol, Count, TimeGenerated\r\n| union legacyAuth\r\n| sort by Count desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Insecure Protocols Count over Time (Microsoft Entra ID)",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-S",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "barchart",
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        },
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5 - Copy",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\r\nlet legacyAuth = SigninLogs\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\", UserId)\r\n| where ResultType == 0\r\n| where ClientAppUsed !contains \"Browser\" and ClientAppUsed !contains \"Mobile Apps and Desktop clients\"\r\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), Protocol=\"AAD Legacy Auth\", UserPrincipalName, UserProfile, UserId;\r\nSecurityEvent\r\n| parse EventData with * '\"TicketEncryptionType\">' TicketEncryptionType '<' *\r\n| union Event\r\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \"0x12\" and TicketEncryptionType != \"0x11\") or ((EventLog =~ \"System\" and Source =~ \"NETLOGON\") and EventID in (scEvents))\r\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), tostring(EventID), Account\r\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\r\n| extend Protocol = case(EventID == 4776, \"WDigest\", EventID == 4768 or EventID == 4769, \"Weak Kerberos Cipher\", EventID == 2889, \"Insecure LDAP\", EventID == 4624, \"NTLM v1\", EventID == 3000, \"SMBv1\", EventID in (scEvents), \"Vulnerable Secure Channel\", \"Unknown\")\r\n| project Protocol, Count, Account, TimeGenerated\r\n| union legacyAuth\r\n| sort by Count desc\r\n| project Protocol, Count, UserPrincipalName, UserProfile, LastObserved=TimeGenerated,  Account, UserId\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Insecure Protocol Details",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Protocol",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "UserId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "UserProfile",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Entra ID User Profile >>",
                            "bladeOpenContext": {
                              "bladeName": "UserDetailsMenuBlade",
                              "extensionName": "Microsoft_AAD_IAM",
                              "bladeParameters": [
                                {
                                  "name": "userId",
                                  "source": "column",
                                  "value": "UserId"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "SignInCount",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "locInfoColumn": "Location",
                      "latitude": "latitude_",
                      "longitude": "longitude_",
                      "sizeSettings": "city_",
                      "sizeAggregation": "Count",
                      "labelSettings": "city_",
                      "legendMetric": "city_",
                      "numberOfMetrics": 100,
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "state_",
                        "colorAggregation": "Count",
                        "type": "heatmap",
                        "heatmapPalette": "coldHot"
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 9"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isNS8Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS-8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Connect On-Premises & Cloud Privately (NS-9)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-9-connect-on-premises-or-cloud-network-privately)\r\n\r\nUse private connections for secure communication between different networks, such as cloud service provider data centers and on-premises infrastructure in a co-location environment.\r\n\r\n## Recommended Logs \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [VPN Gateway](https://azure.microsoft.com/services/vpn-gateway/) ‚ú≥Ô∏è [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/)<br> \r\n\r\n## Implementation\r\nüí° [Azure VPN overview](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways)<br>\r\nüí° [What are the ExpressRoute connectivity models](https://docs.microsoft.com/azure/expressroute/expressroute-connectivity-models)<br>\r\nüí° [Virtual network peering](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Virtual Network Gateways](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworkGateways)<br>\r\nüîÄ [ExpressRoute](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FexpressRouteCircuits)<br>\r\nüîÄ [Peerings](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Peering%2Fpeerings)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isNSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "text - 5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"express\" or type contains \"gateway\" or type contains \"peer\"\r\n| project id,type,resourceGroup\r\n| order by type asc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Gateways, ExpressRoutes, Peerings",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Rule",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isNS9Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS-9",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Ensure Domain Name System Security (NS-10)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-10-ensure-domain-name-system-dns-security)\r\n\r\nEnsure that Domain Name System (DNS) security configuration protects against known risks.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance)  ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure DNS](https://azure.microsoft.com/services/dns/) <br>\r\n\r\n## Implementation\r\nüí° [Azure DNS overview](https://docs.microsoft.com/azure/dns/dns-overview)<br>\r\nüí° [Secure Domain Name System (DNS) Deployment Guide](https://csrc.nist.gov/publications/detail/sp/800-81/2/final)<br>\r\nüí° [Azure Private DNS](https://docs.microsoft.com/azure/dns/private-dns-overview)<br>\r\nüí° [Azure Defender for DNS](https://docs.microsoft.com/azure/security-center/defender-for-dns-introduction)<br>\r\nüí° [Prevent dangling DNS entries and avoid subdomain takeover](https://docs.microsoft.com/azure/security/fundamentals/subdomain-takeover)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [DNS Zones](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FdnsZones)<br>\r\nüîÄ [Private DNS Zones](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FprivateDnsZones)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isNSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "NS-7"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"NS.10\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"dns\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " DNS Assets",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Title contains \"dns\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents: DNS",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isNS10Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS-10",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isNSVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Network Security (NS)"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Identity Management (IM)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management) \r\n---\r\n\r\nIdentity Management covers controls to establish a secure identity and access controls using Microsoft Entra ID, including the use of single sign-on, strong authentications, managed identities (and service principles) for applications, conditional access, and account anomalies monitoring. "
                  },
                  "customWidth": "40",
                  "name": "IM Guide"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "60",
                  "name": "text - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Use Centralized Identity & Authentication (IM-1)\\\", \\\"tab\\\": \\\"IM1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Protect Identity & Authentication Systems (IM-2)\\\", \\\"tab\\\": \\\"IM2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Manage App Identities Securely (IM-3)\\\", \\\"tab\\\": \\\"IM3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Authenticate Server & Services (IM-4)\\\", \\\"tab\\\": \\\"IM4\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Use SSO for App Access (IM-5)\\\", \\\"tab\\\": \\\"IM5\\\" }\\r\\n]\",\"transformers\":null}",
                    "size": 3,
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "tab",
                        "parameterName": "Tab",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 8,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Control",
                          "formatter": 1,
                          "formatOptions": {
                            "customColumnWidthSetting": "90%"
                          }
                        },
                        {
                          "columnMatch": "tab",
                          "formatter": 5
                        }
                      ]
                    }
                  },
                  "customWidth": "40",
                  "name": "query - 8",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "a206a547-329b-4003-8832-c16daacca6c6",
                        "version": "KqlParameterItem/1.0",
                        "name": "isIM1Visible",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "criteriaData": [
                          {
                            "criteriaContext": {
                              "leftOperand": "Tab",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "IM1.",
                              "resultValType": "static",
                              "resultVal": "true"
                            }
                          },
                          {
                            "criteriaContext": {
                              "operator": "Default",
                              "rightValType": "param",
                              "resultValType": "static",
                              "resultVal": "false"
                            }
                          }
                        ],
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "isIM2Visible",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "criteriaData": [
                          {
                            "criteriaContext": {
                              "leftOperand": "Tab",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "IM2",
                              "resultValType": "static",
                              "resultVal": "true"
                            }
                          },
                          {
                            "criteriaContext": {
                              "operator": "Default",
                              "rightValType": "param",
                              "resultValType": "static",
                              "resultVal": "false"
                            }
                          }
                        ],
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "id": "7e34d95b-a1fd-4326-a960-8c43a4afd9b4"
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "isIM3Visible",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "criteriaData": [
                          {
                            "criteriaContext": {
                              "leftOperand": "Tab",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "IM3",
                              "resultValType": "static",
                              "resultVal": "true"
                            }
                          },
                          {
                            "criteriaContext": {
                              "operator": "Default",
                              "rightValType": "param",
                              "resultValType": "static",
                              "resultVal": "false"
                            }
                          }
                        ],
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "id": "85eac3da-ccbd-43cc-a9b3-cb41490ff565"
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "isIM4Visible",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "criteriaData": [
                          {
                            "criteriaContext": {
                              "leftOperand": "Tab",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "IM4",
                              "resultValType": "static",
                              "resultVal": "true"
                            }
                          },
                          {
                            "criteriaContext": {
                              "operator": "Default",
                              "rightValType": "param",
                              "resultValType": "static",
                              "resultVal": "false"
                            }
                          }
                        ],
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "id": "7b658bf7-dbbc-4a85-90e4-4998bb428a38"
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "isIM5Visible",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "criteriaData": [
                          {
                            "criteriaContext": {
                              "leftOperand": "Tab",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "IM5",
                              "resultValType": "static",
                              "resultVal": "true"
                            }
                          },
                          {
                            "criteriaContext": {
                              "operator": "Default",
                              "rightValType": "param",
                              "resultValType": "static",
                              "resultVal": "false"
                            }
                          }
                        ],
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "id": "271668c4-6655-43cd-ac75-2f1683932d4d"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "10",
                  "name": "Hidden Parameters Selectors"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Use Strong Authentication Controls (IM-6)\\\", \\\"tab\\\": \\\"IM6\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Restrict Resource Access Based on Conditions (IM-7)\\\", \\\"tab\\\": \\\"IM7\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Restrict the Exposure of Credentials & Secrets (IM-8)\\\", \\\"tab\\\": \\\"IM8\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Secure User Access to Existing Apps (IM-9)\\\", \\\"tab\\\": \\\"IM9\\\" }\\r\\n]\",\"transformers\":null}",
                    "size": 3,
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "tab",
                        "parameterName": "Tab",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 8,
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Control",
                          "formatter": 1,
                          "formatOptions": {
                            "customColumnWidthSetting": "90%"
                          }
                        },
                        {
                          "columnMatch": "tab",
                          "formatter": 5
                        }
                      ]
                    }
                  },
                  "customWidth": "40",
                  "name": "query - 8 - Copy",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "5a3550b0-a5cc-40f2-8de4-c6eeb7613825",
                        "version": "KqlParameterItem/1.0",
                        "name": "isIM6Visible",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "criteriaData": [
                          {
                            "criteriaContext": {
                              "leftOperand": "Tab",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "IM6",
                              "resultValType": "static",
                              "resultVal": "true"
                            }
                          },
                          {
                            "criteriaContext": {
                              "operator": "Default",
                              "rightValType": "param",
                              "resultValType": "static",
                              "resultVal": "false"
                            }
                          }
                        ],
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "isIM7Visible",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "criteriaData": [
                          {
                            "criteriaContext": {
                              "leftOperand": "Tab",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "IM7",
                              "resultValType": "static",
                              "resultVal": "true"
                            }
                          },
                          {
                            "criteriaContext": {
                              "operator": "Default",
                              "rightValType": "param",
                              "resultValType": "static",
                              "resultVal": "false"
                            }
                          }
                        ],
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "id": "28277e0e-d51f-40a6-8552-2fbd5fe38fcf"
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "isIM8Visible",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "criteriaData": [
                          {
                            "criteriaContext": {
                              "leftOperand": "Tab",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "IM8",
                              "resultValType": "static",
                              "resultVal": "true"
                            }
                          },
                          {
                            "criteriaContext": {
                              "operator": "Default",
                              "rightValType": "param",
                              "resultValType": "static",
                              "resultVal": "false"
                            }
                          }
                        ],
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "id": "53ff2b19-b478-4ebf-a112-82ef29db7fb9"
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "isIM9Visible",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "criteriaData": [
                          {
                            "criteriaContext": {
                              "leftOperand": "Tab",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "IM9",
                              "resultValType": "static",
                              "resultVal": "true"
                            }
                          },
                          {
                            "criteriaContext": {
                              "operator": "Default",
                              "rightValType": "param",
                              "resultValType": "static",
                              "resultVal": "false"
                            }
                          }
                        ],
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "id": "5b8d7037-4b7e-478a-a98e-73a24229c90d"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "10",
                  "name": "Hidden Parameters Selectors"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 1,
                              "content": {
                                "json": "# [Use Centralized Identity & Authentication (IM-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-1-use-centralized-identity-and-authentication-system)\r\n\r\nUse a centralized identity and authentication system to govern your organization's identities and authentications for cloud and non-cloud resources.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Microsoft Entra ID]( https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n## Implementation\r\nüí° [Tenancy in Microsoft Entra ID](https://docs.microsoft.com/azure/active-directory/develop/single-and-multi-tenant-apps)<br>\r\nüí° [How to Create and Configure an Microsoft Entra ID Instance](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-access-create-new-tenant)<br>\r\nüí° [Define Microsoft Entra ID Tenants](https://azure.microsoft.com/resources/securing-azure-environments-with-azure-active-directory/)<br>\r\nüí° [Use External Identity Providers for An Application](https://docs.microsoft.com/azure/active-directory/external-identities/identity-providers)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)<br>\r\n"
                              },
                              "conditionalVisibility": {
                                "parameterName": "isIMVisible",
                                "comparison": "isEqualTo",
                                "value": "true"
                              },
                              "name": "IM-1"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Control Assessment\r\n"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationStatus",
                                    "label": "Implementation Status",
                                    "type": 2,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": "Implemented"
                                  },
                                  {
                                    "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationDate",
                                    "label": "Implementation Date",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    }
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Notes",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "Status"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Notes <br>\r\n{Notes}"
                              },
                              "name": "text - 1"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "group - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"IM.1\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Security Policy Recommendations ",
                          "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RecommendationName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Gear",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Total",
                                "formatter": 22,
                                "formatOptions": {
                                  "compositeBarSettings": {
                                    "labelText": "[\"Passed\"]/[\"Total\"]",
                                    "columnSettings": [
                                      {
                                        "columnName": "Passed",
                                        "color": "green"
                                      },
                                      {
                                        "columnName": "Failed",
                                        "color": "redBright"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "Remediate",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Remediate >>",
                                  "bladeOpenContext": {
                                    "bladeName": "RecommendationsBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "assessmentKey",
                                        "source": "column",
                                        "value": "assessmentKey"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "PassedControls",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true,
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "Passed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Failed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "assessmentKey",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": [],
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Failed",
                                "color": "redBright"
                              },
                              {
                                "seriesName": "Passed",
                                "color": "green"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let LastObserved = SigninLogs\r\n| where ResultType == 0\r\n| summarize arg_max(TimeGenerated, *) by UserPrincipalName\r\n| project UserPrincipalName, LastSignIn=TimeGenerated;\r\nSigninLogs\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\", UserId)\r\n| where ResultType == 0\r\n| summarize count() by UserPrincipalName, UserProfile, UserId\r\n| join (LastObserved) on UserPrincipalName\r\n| project UserPrincipalName, SignInCount=count_, UserProfile, LastSignIn, UserId\r\n| sort by SignInCount desc\r\n| limit 250\r\n",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Review Valid Accounts",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "SignInCount",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "UserProfile",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Entra ID User Profile >>",
                                  "bladeOpenContext": {
                                    "bladeName": "UserDetailsMenuBlade",
                                    "extensionName": "Microsoft_AAD_IAM",
                                    "bladeParameters": [
                                      {
                                        "name": "userId",
                                        "source": "column",
                                        "value": "UserId"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "UserId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "yellowOrangeRed"
                                }
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": [],
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "locInfoColumn": "Location",
                            "latitude": "latitude_",
                            "longitude": "longitude_",
                            "sizeSettings": "city_",
                            "sizeAggregation": "Count",
                            "labelSettings": "city_",
                            "legendMetric": "city_",
                            "numberOfMetrics": 100,
                            "legendAggregation": "Count",
                            "itemColorSettings": {
                              "nodeColorField": "state_",
                              "colorAggregation": "Count",
                              "type": "heatmap",
                              "heatmapPalette": "coldHot"
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 9"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIM1Visible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IM-1",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 1,
                              "content": {
                                "json": "# [Protect Identity & Authentication Systems (IM-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management?WT.mc_id=Portal-fx#im-2-protect-identity-and-authentication-systems)\r\n\r\nSecure your identity and authentication system as a high priority in your organization's cloud security practice.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\nüî∑ [AADUserRiskEvents](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aaduserriskevents) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n## Implementation\r\nüí° [What is the identity secure score in Microsoft Entra ID](https://docs.microsoft.com/azure/active-directory/fundamentals/identity-secure-score)<br>\r\nüí° [Best Practices for Securing Active Directory](https://docs.microsoft.com/windows-server/identity/ad-ds/plan/security-best-practices/best-practices-for-securing-active-directory)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)<br>\r\nüîÄ [Microsoft Sentinel](https://ms.portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>"
                              },
                              "name": "IM-1"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Control Assessment\r\n"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationStatus",
                                    "label": "Implementation Status",
                                    "type": 2,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": "Implemented"
                                  },
                                  {
                                    "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationDate",
                                    "label": "Implementation Date",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    }
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Notes",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "Status"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Notes <br>\r\n{Notes}"
                              },
                              "name": "text - 1"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "group - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Tactics contains \"access\" or Tactics contains \"elevate\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Security Incidents: Identity ",
                          "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Incident Name",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Alert",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Severity",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "High",
                                      "representation": "Sev0",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Medium",
                                      "representation": "Sev1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Low",
                                      "representation": "Sev2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Sev3",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "IncidentUrl",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Incident >>",
                                  "bladeOpenContext": {
                                    "bladeName": "CaseBlade",
                                    "extensionName": "Microsoft_Azure_Security_Insights",
                                    "bladeParameters": [
                                      {
                                        "name": "id",
                                        "source": "column",
                                        "value": "IncidentBlade"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "IncidentBlade",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AADUserRiskEvents \r\n| extend RiskyUsers = strcat(\"https://ms.portal.azure.com/#blade/Microsoft_AAD_IAM/RiskyUsersBlade\")\r\n| summarize count() by UserPrincipalName, RiskLevel, RiskyUsers\r\n| extend Rank=iff(RiskLevel == \"high\", 3, iff(RiskLevel == \"medium\", 2, iff(RiskLevel == \"low\", 1, 0)))\r\n| where UserPrincipalName <> \"\"\r\n| project UserPrincipalName, RiskLevel, RiskyUsers, count_, Rank\r\n| sort by Rank,count_ desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Risky Users",
                          "noDataMessage": "Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and/or extend time thresholds for a larger data-set.  ",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "RiskLevel",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "high",
                                      "representation": "Sev0",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "medium",
                                      "representation": "Sev1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "low",
                                      "representation": "Sev2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Sev3",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "RiskyUsers",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Risky User Response >>",
                                  "bladeOpenContext": {
                                    "bladeName": "RiskyUsersBlade",
                                    "extensionName": "Microsoft_AAD_IAM",
                                    "bladeParameters": []
                                  }
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "redBright"
                                }
                              },
                              {
                                "columnMatch": "Rank",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "customWidth": "50",
                        "name": "query - 4"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIM2Visible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IM-2",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 1,
                              "content": {
                                "json": "# [Manage Application Identities Securely (IM-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-3-manage-application-identities-securely-and-automatically)\r\n\r\nUse managed application identities instead of creating human accounts for applications to access resources and execute code. Managed application identities provide benefits such as reducing the exposure of credentials. Automate the rotation of credential to ensure the security of the identities.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AADManagedIdentitySignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadmanagedidentitysigninlogs) üî∑ [AADServicePrincipalSignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadserviceprincipalsigninlogs) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n## Implementation\r\nüí° [Azure Managed Identities](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview)<br>\r\nüí° [Services that Support Managed Identities for Azure Resources](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities)<br>\r\nüí° [Azure Service Principal](https://docs.microsoft.com/powershell/azure/create-azure-service-principal-azureps)<br>\r\nüí° [Create a Service Principal with Certificates](https://docs.microsoft.com/azure/active-directory/develop/howto-authenticate-service-principal-powershell)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)<br>\r\nüîÄ [Managed Identities](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.ManagedIdentity%2FuserAssignedIdentities)<br>\r\nüîÄ [App Registrations](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)<br>"
                              },
                              "conditionalVisibility": {
                                "parameterName": "isIMVisible",
                                "comparison": "isEqualTo",
                                "value": "true"
                              },
                              "name": "IM-2"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Control Assessment\r\n"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationStatus",
                                    "label": "Implementation Status",
                                    "type": 2,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": "Implemented"
                                  },
                                  {
                                    "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationDate",
                                    "label": "Implementation Date",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    }
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Notes",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "Status"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Notes <br>\r\n{Notes}"
                              },
                              "name": "text - 1"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "group - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"IM.3\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Security Policy Recommendations ",
                          "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RecommendationName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Gear",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Total",
                                "formatter": 22,
                                "formatOptions": {
                                  "compositeBarSettings": {
                                    "labelText": "[\"Passed\"]/[\"Total\"]",
                                    "columnSettings": [
                                      {
                                        "columnName": "Passed",
                                        "color": "green"
                                      },
                                      {
                                        "columnName": "Failed",
                                        "color": "redBright"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "Remediate",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Remediate >>",
                                  "bladeOpenContext": {
                                    "bladeName": "RecommendationsBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "assessmentKey",
                                        "source": "column",
                                        "value": "assessmentKey"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "PassedControls",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true,
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "Passed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Failed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "assessmentKey",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": [],
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Failed",
                                "color": "redBright"
                              },
                              {
                                "seriesName": "Passed",
                                "color": "green"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let LastObserved = AADManagedIdentitySignInLogs\r\n| where ResultType == 0\r\n| summarize arg_max(TimeGenerated, *) by ServicePrincipalName\r\n| project ServicePrincipalName, LastSignIn=TimeGenerated;\r\nAADManagedIdentitySignInLogs\r\n| extend ManagedIdentities = strcat(\"Managed Identities\")\r\n| where ResultType == 0\r\n| summarize count() by ServicePrincipalName, ManagedIdentities\r\n| join (LastObserved) on ServicePrincipalName\r\n| project ServicePrincipalName, SignInCount=count_, ManagedIdentities, LastSignIn\r\n| sort by SignInCount desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Managed Identity Actions",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "ServicePrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "PersonWithFriend",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "SignInCount",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "ManagedIdentities",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Managed Identities >>",
                                  "bladeOpenContext": {
                                    "bladeName": "BrowseResource",
                                    "extensionName": "HubsExtension",
                                    "bladeParameters": [
                                      {
                                        "name": "resourceType",
                                        "source": "static",
                                        "value": "Microsoft.ManagedIdentity/userAssignedIdentities"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": [],
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "locInfoColumn": "Location",
                            "latitude": "latitude_",
                            "longitude": "longitude_",
                            "sizeSettings": "city_",
                            "sizeAggregation": "Count",
                            "labelSettings": "city_",
                            "legendMetric": "city_",
                            "numberOfMetrics": 100,
                            "legendAggregation": "Count",
                            "itemColorSettings": {
                              "nodeColorField": "state_",
                              "colorAggregation": "Count",
                              "type": "heatmap",
                              "heatmapPalette": "coldHot"
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 9"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let LastObserved = AADServicePrincipalSignInLogs \r\n| where ResultType == 0\r\n| summarize arg_max(TimeGenerated, *) by ServicePrincipalName\r\n| project ServicePrincipalName, LastSignIn=TimeGenerated;\r\nAADServicePrincipalSignInLogs \r\n| extend ServicePrincipals = strcat(\"Service Principals\")\r\n| where ResultType == 0\r\n| summarize count() by ServicePrincipalName, ServicePrincipals\r\n| join (LastObserved) on ServicePrincipalName\r\n| project ServicePrincipalName, SignInCount=count_, ServicePrincipals, LastSignIn\r\n| sort by SignInCount desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Service Principal Actions",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "ServicePrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "PersonWithFriend",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "SignInCount",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "green"
                                }
                              },
                              {
                                "columnMatch": "ServicePrincipals",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Service Principals >>",
                                  "bladeOpenContext": {
                                    "bladeName": "ActiveDirectoryMenuBlade",
                                    "extensionName": "Microsoft_AAD_IAM",
                                    "bladeParameters": []
                                  }
                                }
                              },
                              {
                                "columnMatch": "ManagedIdentities",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Managed Identities >>",
                                  "bladeOpenContext": {
                                    "bladeName": "BrowseResource",
                                    "extensionName": "HubsExtension",
                                    "bladeParameters": [
                                      {
                                        "name": "resourceType",
                                        "source": "static",
                                        "value": "Microsoft.ManagedIdentity/userAssignedIdentities"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": [],
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "locInfoColumn": "Location",
                            "latitude": "latitude_",
                            "longitude": "longitude_",
                            "sizeSettings": "city_",
                            "sizeAggregation": "Count",
                            "labelSettings": "city_",
                            "legendMetric": "city_",
                            "numberOfMetrics": 100,
                            "legendAggregation": "Count",
                            "itemColorSettings": {
                              "nodeColorField": "state_",
                              "colorAggregation": "Count",
                              "type": "heatmap",
                              "heatmapPalette": "coldHot"
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 9 - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIM3Visible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IM-3",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 1,
                              "content": {
                                "json": "# [Authenticate Server and Services (IM-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-4-authenticate-server-and-services)\r\n\r\nAuthenticate remote servers and services from your client side to ensure you are connecting to trusted server and services. The most common server authentication protocol is Transport Layer Security (TLS), where the client-side (often a browser or client device) verifies the server by verifying the server‚Äôs certificate was issued by a trusted certificate authority. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance)  ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Enforce Transport Layer Security (TLS) for a storage account](https://docs.microsoft.com/azure/storage/common/transport-layer-security-configure-minimum-version?tabs=portal#use-azure-policy-to-enforce-the-minimum-tls-version)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>"
                              },
                              "conditionalVisibility": {
                                "parameterName": "isIMVisible",
                                "comparison": "isEqualTo",
                                "value": "true"
                              },
                              "name": "IM-4"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Control Assessment\r\n"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationStatus",
                                    "label": "Implementation Status",
                                    "type": 2,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": "Implemented"
                                  },
                                  {
                                    "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationDate",
                                    "label": "Implementation Date",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    }
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Notes",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "Status"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Notes <br>\r\n{Notes}"
                              },
                              "name": "text - 1"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "group - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| where RecommendationName contains \"TLS\" or RecommendationName contains \"Auth\" or RecommendationName contains \"JIT\" or RecommendationName contains \"access\"\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Security Policy Recommendations ",
                          "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RecommendationName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Gear",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Total",
                                "formatter": 22,
                                "formatOptions": {
                                  "compositeBarSettings": {
                                    "labelText": "[\"Passed\"]/[\"Total\"]",
                                    "columnSettings": [
                                      {
                                        "columnName": "Passed",
                                        "color": "green"
                                      },
                                      {
                                        "columnName": "Failed",
                                        "color": "redBright"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "Remediate",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Remediate >>",
                                  "bladeOpenContext": {
                                    "bladeName": "RecommendationsBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "assessmentKey",
                                        "source": "column",
                                        "value": "assessmentKey"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "PassedControls",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true,
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "Passed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Failed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "assessmentKey",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": [],
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Failed",
                                "color": "redBright"
                              },
                              {
                                "seriesName": "Passed",
                                "color": "green"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 3"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIM4Visible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IM-4",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 1,
                              "content": {
                                "json": "# [Use Single Sign-on (SSO) for Application Access (IM-5)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-5-use-single-sign-on-sso-for-application-access)\r\n\r\nUse single sign-on (SSO) to simplify the user experience for authenticating to resources including applications and data across cloud services and on-premises environments. \r\n\r\n## Recommended Logs\r\nüî∑ [AADNonInteractiveUserSignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadnoninteractiveusersigninlogs) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n## Implementation\r\nüí° [Understand Application SSO with Microsoft Entra ID](https://docs.microsoft.com/azure/active-directory/manage-apps/what-is-single-sign-on)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                              },
                              "conditionalVisibility": {
                                "parameterName": "isIMVisible",
                                "comparison": "isEqualTo",
                                "value": "true"
                              },
                              "name": "IM-4"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Control Assessment\r\n"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationStatus",
                                    "label": "Implementation Status",
                                    "type": 2,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": "Implemented"
                                  },
                                  {
                                    "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationDate",
                                    "label": "Implementation Date",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    }
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Notes",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "Status"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Notes <br>\r\n{Notes}"
                              },
                              "name": "text - 1"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "group - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let LastObserved = AADNonInteractiveUserSignInLogs\r\n| where ResultType == 0\r\n| summarize arg_max(TimeGenerated, *) by UserPrincipalName\r\n| project UserPrincipalName, LastSignIn=TimeGenerated;\r\nAADNonInteractiveUserSignInLogs\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\", UserId)\r\n| where ResultType == 0\r\n| summarize count() by UserPrincipalName, UserProfile, UserId\r\n| join (LastObserved) on UserPrincipalName\r\n| project UserPrincipalName, SignInCount=count_, UserProfile, LastSignIn, UserId\r\n| sort by SignInCount desc\r\n| limit 250\r\n",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "SSO Activity by Non-Interactive Sign-ins",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "SignInCount",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "UserProfile",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Entra ID User Profile >>",
                                  "bladeOpenContext": {
                                    "bladeName": "UserDetailsMenuBlade",
                                    "extensionName": "Microsoft_AAD_IAM",
                                    "bladeParameters": [
                                      {
                                        "name": "userId",
                                        "source": "column",
                                        "value": "UserId"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "UserId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "yellowOrangeRed"
                                }
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": [],
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "locInfoColumn": "Location",
                            "latitude": "latitude_",
                            "longitude": "longitude_",
                            "sizeSettings": "city_",
                            "sizeAggregation": "Count",
                            "labelSettings": "city_",
                            "legendMetric": "city_",
                            "numberOfMetrics": 100,
                            "legendAggregation": "Count",
                            "itemColorSettings": {
                              "nodeColorField": "state_",
                              "colorAggregation": "Count",
                              "type": "heatmap",
                              "heatmapPalette": "coldHot"
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 9"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIM5Visible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IM-5",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 1,
                              "content": {
                                "json": "# [Use Strong Authentication Controls (IM-6)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-6-use-strong-authentication-controls)\r\n\r\nEnforce strong authentication controls (strong password-less authentication or multi-factor authentication) with your centralized identity and authentication management system for all access to resources. Authentication based on password credentials alone is considered legacy, as it is insecure and does not stand up to popular attack methods.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n## Implementation\r\nüí° [How to Enable MFA in Azure](https://docs.microsoft.com/azure/active-directory/authentication/howto-mfa-getstarted)<br>\r\nüí° [Introduction to Password-less Authentication Options for Microsoft Entra ID](https://docs.microsoft.com/azure/active-directory/authentication/concept-authentication-passwordless)<br>\r\nüí° [Microsoft Entra ID Default Password Policy](https://docs.microsoft.com/azure/active-directory/authentication/concept-sspr-policy#password-policies-that-only-apply-to-cloud-user-accounts)<br>\r\nüí° [Eliminate Bad Passwords Using Microsoft Entra ID Password Protection](https://docs.microsoft.com/azure/active-directory/authentication/concept-password-ban-bad)<br>\r\nüí° [Block legacy authentication](https://docs.microsoft.com/azure/active-directory/conditional-access/block-legacy-authentication)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                              },
                              "conditionalVisibility": {
                                "parameterName": "isIMVisible",
                                "comparison": "isEqualTo",
                                "value": "true"
                              },
                              "name": "IM-4"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Control Assessment\r\n"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationStatus",
                                    "label": "Implementation Status",
                                    "type": 2,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": "Implemented"
                                  },
                                  {
                                    "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationDate",
                                    "label": "Implementation Date",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    }
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Notes",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "Status"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Notes <br>\r\n{Notes}"
                              },
                              "name": "text - 1"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "group - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"IM.6\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Security Policy Recommendations ",
                          "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RecommendationName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Gear",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Total",
                                "formatter": 22,
                                "formatOptions": {
                                  "compositeBarSettings": {
                                    "labelText": "[\"Passed\"]/[\"Total\"]",
                                    "columnSettings": [
                                      {
                                        "columnName": "Passed",
                                        "color": "green"
                                      },
                                      {
                                        "columnName": "Failed",
                                        "color": "redBright"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "Remediate",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Remediate >>",
                                  "bladeOpenContext": {
                                    "bladeName": "RecommendationsBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "assessmentKey",
                                        "source": "column",
                                        "value": "assessmentKey"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "PassedControls",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true,
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "Passed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Failed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "assessmentKey",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": [],
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Failed",
                                "color": "redBright"
                              },
                              {
                                "seriesName": "Passed",
                                "color": "green"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let MFAFailures = SigninLogs\r\n| where AuthenticationRequirement == \"multiFactorAuthentication\"\r\n| where ResultType <> 0\r\n| extend FailureReason = tostring(Status.failureReason)\r\n| where FailureReason contains \"User did not pass the MFA\"\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\", UserId)\r\n| summarize count() by UserPrincipalName, UserId, UserProfile\r\n| extend FailedMFACount=count_;\r\nlet LastObserved = SigninLogs\r\n| where ResultType <> 0\r\n| summarize arg_max(TimeGenerated, *) by UserPrincipalName\r\n| project UserPrincipalName, LastFailedSignIn=TimeGenerated;\r\nSigninLogs\r\n| where AuthenticationRequirement == \"multiFactorAuthentication\"\r\n| where ResultType <> 0\r\n| extend FailureReason = tostring(Status.failureReason)\r\n| where FailureReason contains \"User did not pass the MFA\"\r\n| make-series Trend = dcount(FailureReason) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by UserPrincipalName\r\n| join (LastObserved) on UserPrincipalName\r\n| join (MFAFailures) on UserPrincipalName\r\n| project UserPrincipalName, UserProfile, FailedMFACount, Trend, LastFailedSignIn, UserId\r\n| sort by FailedMFACount desc\r\n| limit 250\r\n",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Monitor User MFA Failures",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "UserProfile",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Entra ID User Profile >>",
                                  "bladeOpenContext": {
                                    "bladeName": "UserDetailsMenuBlade",
                                    "extensionName": "Microsoft_AAD_IAM",
                                    "bladeParameters": [
                                      {
                                        "name": "userId",
                                        "source": "column",
                                        "value": "UserId"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "FailedMFACount",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "redBright"
                                }
                              },
                              {
                                "columnMatch": "Trend",
                                "formatter": 9,
                                "formatOptions": {
                                  "palette": "redBright"
                                }
                              },
                              {
                                "columnMatch": "UserId",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": [],
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "locInfoColumn": "Location",
                            "latitude": "latitude_",
                            "longitude": "longitude_",
                            "sizeSettings": "city_",
                            "sizeAggregation": "Count",
                            "labelSettings": "city_",
                            "legendMetric": "city_",
                            "numberOfMetrics": 100,
                            "legendAggregation": "Count",
                            "itemColorSettings": {
                              "nodeColorField": "state_",
                              "colorAggregation": "Count",
                              "type": "heatmap",
                              "heatmapPalette": "coldHot"
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 9"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIM6Visible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IM-6",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 1,
                              "content": {
                                "json": "# [Restrict Resource Access Based on Conditions (IM-7)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-7-restrict-resource-access-based-on--conditions)\r\n\r\nExplicitly validate trusted signals to allow or deny user access to resources, as part of a zero-trust access model. Signals to validate should include strong authentication of user account, behavioral analytics of user account, device trustworthiness, user or group membership, locations and so on.\r\n\r\n## Recommended Logs\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n## Implementation\r\nüí° [Azure Conditional Access Overview](https://docs.microsoft.com/azure/active-directory/conditional-access/overview)<br>\r\nüí° [Common Conditional Access Policies](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-policy-common)<br>\r\nüí° [Conditional Access insights and reporting](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-insights-reporting)<br>\r\nüí° [Configure Authentication Session Management with Conditional Access](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-session-lifetime)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Entra Id](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                              },
                              "conditionalVisibility": {
                                "parameterName": "isIMVisible",
                                "comparison": "isEqualTo",
                                "value": "true"
                              },
                              "name": "IM-6"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Control Assessment\r\n"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationStatus",
                                    "label": "Implementation Status",
                                    "type": 2,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": "Implemented"
                                  },
                                  {
                                    "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationDate",
                                    "label": "Implementation Date",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    }
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Notes",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "Status"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Notes <br>\r\n{Notes}"
                              },
                              "name": "text - 1"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "group - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status)\r\n| extend ConditionalAccessPolicies = parse_json(ConditionalAccessPolicies);\r\nlet data = \r\nunion SigninLogs,nonInteractive\r\n|extend CAStatus = case(ConditionalAccessStatus ==\"success\",\"Successful\",\r\n                    ConditionalAccessStatus == \"failure\", \"Failed\",                                     \r\n                    ConditionalAccessStatus == \"notApplied\", \"Not applied\",                                     \r\n                    isempty(ConditionalAccessStatus), \"Not applied\", \r\n                    \"Disabled\")\r\n|mvexpand ConditionalAccessPolicies\r\n|extend CAGrantControlName = tostring(ConditionalAccessPolicies.enforcedGrantControls[0])\r\n|extend CAGrantControl = case(CAGrantControlName contains \"MFA\", \"Require MFA\", \r\n                            CAGrantControlName contains \"Terms of Use\", \"Require Terms of Use\", \r\n                            CAGrantControlName contains \"Privacy\", \"Require Privacy Statement\", \r\n                            CAGrantControlName contains \"Device\", \"Require Device Compliant\", \r\n                            CAGrantControlName contains \"Azure AD Joined\", \"Require Hybrid Azure AD Joined Device\", \r\n                            CAGrantControlName contains \"Apps\", \"Require Approved Apps\",\r\n                            \"Other\");\r\ndata\r\n| summarize Count = dcount(Id) by CAStatus\r\n| join kind = inner (data\r\n                    | make-series Trend = dcount(Id) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CAStatus\r\n                    ) on CAStatus\r\n| project-away CAStatus1, TimeGenerated\r\n| order by Count desc",
                          "size": 4,
                          "showAnalytics": true,
                          "title": " Conditional Access Status ",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "CAStatus",
                              "formatter": 1
                            },
                            "subtitleContent": {
                              "columnMatch": "Category"
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SigninLogs\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by ConditionalAccessStatus\r\n| render areachart",
                          "size": 0,
                          "showAnalytics": true,
                          "title": " Conditional Access Status over Time",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "notApplied",
                                "color": "red"
                              },
                              {
                                "seriesName": "success",
                                "color": "greenDark"
                              }
                            ]
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 3"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIM7Visible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IM-7",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 1,
                              "content": {
                                "json": "# [Restrict Exposure of Credentials & Secrets (IM-8)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-8-restrict-the-exposure-of-credential-and-secrets)\r\n\r\nEnsure that application developers securely handle credentials and secrets\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) üî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n## Implementation\r\nüí° [How to Setup Credential Scanner](https://secdevtools.azurewebsites.net/helpcredscan.html)<br>\r\nüí° [GitHub Secret Scanning](https://docs.github.com/github/administering-a-repository/about-secret-scanning)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\nüîÄ [Microsoft Defender XDR](https://security.microsoft.com/) <br> "
                              },
                              "conditionalVisibility": {
                                "parameterName": "isIMVisible",
                                "comparison": "isEqualTo",
                                "value": "true"
                              },
                              "name": "IM-8"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Control Assessment\r\n"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationStatus",
                                    "label": "Implementation Status",
                                    "type": 2,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": "Implemented"
                                  },
                                  {
                                    "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationDate",
                                    "label": "Implementation Date",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    }
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Notes",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "Status"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Notes <br>\r\n{Notes}"
                              },
                              "name": "text - 1"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "group - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityAlert\r\n| where AlertName contains \"secret\" or AlertName contains \"cred\" or AlertName contains \"password\" or AlertName contains \"auth\" or AlertName contains \"cert\"\r\n| summarize count() by AlertName\r\n| render piechart",
                          "size": 0,
                          "showAnalytics": true,
                          "title": " Security Alerts for Credentials ",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AlertName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Fired",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "yellowOrangeRed"
                                }
                              },
                              {
                                "columnMatch": "Count",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "yellowOrangeRed"
                                }
                              },
                              {
                                "columnMatch": "AlertLink",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go to Alert >"
                                }
                              },
                              {
                                "columnMatch": "RecommendationName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "warning",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Recommendation",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go to Recommendation >"
                                }
                              },
                              {
                                "columnMatch": "RecommendationClick",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Click to Recommendation"
                                }
                              },
                              {
                                "columnMatch": "RecommendationLink",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go to Recommendation >"
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Title contains \"secret\" or Title contains \"cred\" or Title contains \"password\" or Title contains \"auth\" or Title contains \"cert\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Security Incidents: Secrets & Credentials",
                          "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Incident Name",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Alert",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Severity",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "High",
                                      "representation": "Sev0",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Medium",
                                      "representation": "Sev1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Low",
                                      "representation": "Sev2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Sev3",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "IncidentUrl",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Incident >>",
                                  "bladeOpenContext": {
                                    "bladeName": "CaseBlade",
                                    "extensionName": "Microsoft_Azure_Security_Insights",
                                    "bladeParameters": [
                                      {
                                        "name": "id",
                                        "source": "column",
                                        "value": "IncidentBlade"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "IncidentBlade",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 3"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIM8Visible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IM-8",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 1,
                              "content": {
                                "json": "# [Secure User Access to Existing Applications (IM-9)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-9-secure-user-access-to--existing-applications)\r\n\r\nIn a hybrid environment, where you have on-premises applications or non-native cloud applications using legacy authentication, consider solutions such as cloud access security broker (CASB), application proxy, single sign-on (SSO) to govern the access to these applications. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n## Implementation\r\nüí° [Microsoft Entra ID Application Proxy](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy#what-is-application-proxy)<br>\r\nüí° [Microsoft Defender for Cloud Apps Best Practices](https://docs.microsoft.com/cloud-app-security/best-practices)<br>\r\nüí° [Microsoft Entra ID secure hybrid access](https://docs.microsoft.com/azure/active-directory/manage-apps/secure-hybrid-access)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>"
                              },
                              "conditionalVisibility": {
                                "parameterName": "isIMVisible",
                                "comparison": "isEqualTo",
                                "value": "true"
                              },
                              "name": "IM-8"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Control Assessment\r\n"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationStatus",
                                    "label": "Implementation Status",
                                    "type": 2,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": "Implemented"
                                  },
                                  {
                                    "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ImplementationDate",
                                    "label": "Implementation Date",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    }
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Notes",
                                    "type": 1,
                                    "value": "",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "Status"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "## Notes <br>\r\n{Notes}"
                              },
                              "name": "text - 1"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "group - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Title contains \"app\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Security Incidents: Applications",
                          "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Incident Name",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Alert",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Severity",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "High",
                                      "representation": "Sev0",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Medium",
                                      "representation": "Sev1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Low",
                                      "representation": "Sev2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Sev3",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "IncidentUrl",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkLabel": "Incident >>",
                                  "bladeOpenContext": {
                                    "bladeName": "CaseBlade",
                                    "extensionName": "Microsoft_Azure_Security_Insights",
                                    "bladeParameters": [
                                      {
                                        "name": "id",
                                        "source": "column",
                                        "value": "IncidentBlade"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "IncidentBlade",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 3"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIM9Visible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IM-9",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isIMVisible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "Identity Management (IM)"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isIMVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Identity Management (IM)"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Privileged Access (PA)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access) \r\n---\r\nPrivileged Access covers controls to protect privileged access to your Azure tenant and resources, including a range of controls to protect your administrative model, administrative accounts, and privileged access workstations against deliberate and inadvertent risk. "
            },
            "customWidth": "40",
            "name": "PA Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "text - 11"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Separate & Limit Highly Privileged Users (PA-1)\\\", \\\"tab\\\": \\\"PA1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Avoid Standing Access for Accounts (PA-2)\\\", \\\"tab\\\": \\\"PA2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Manage Lifecycle of Identities & Entitlements (PA-3)\\\", \\\"tab\\\": \\\"PA3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Review User Access Regularly (PA-4)\\\", \\\"tab\\\": \\\"PA4\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isPA1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PA1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isPA2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PA2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "dbe2ebfe-02aa-4e6c-bd33-d134fe277f73"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isPA3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PA3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "8e735a1c-34be-4429-a6d5-ea7754b5450d"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isPA4Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PA4",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "8138f796-7f6a-45c4-acb3-40be84faf4d3"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Setup Emergency Access (PA-5)\\\", \\\"tab\\\": \\\"PA5\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Use Privileged Access Workstations (PA-6)\\\", \\\"tab\\\": \\\"PA6\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Follow Just Enough Administration Principle (PA-7)\\\", \\\"tab\\\": \\\"PA7\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Determine Access Process for Support (PA-8)\\\", \\\"tab\\\": \\\"PA8\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "f359d341-8d40-4cfb-8275-ad22d8424aa2",
                  "version": "KqlParameterItem/1.0",
                  "name": "isPA5Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PA5",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isPA6Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PA6",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "9d3bb081-76b4-48c9-a8bf-12fef2889550"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isPA7Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PA7",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "184c2260-e070-4898-8a28-53695c294fe4"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isPA8Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PA8",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "6cc54ea3-a296-4221-ba1a-5999de049ca2"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Separate & Limit Highly Privileged Users (PA-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-1-separate-and-limit-highly-privilegedadministrative-users)\r\n\r\nEnsure you are identifying all high business impact accounts. Limit the number of privileged/administrative accounts in your cloud's control plane, management plane and data/workload plane. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/)<br> \r\n\r\n## Implementation\r\nüí° [Administrator Role Permissions in Microsoft Entra ID](https://docs.microsoft.com/azure/active-directory/roles/permissions-reference)<br>\r\nüí° [Use Azure Privileged Identity Management Security Alerts](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-how-to-configure-security-alerts)<br>\r\nüí° [Securing Privileged Access for Hybrid and Cloud Deployments in Microsoft Entra ID](https://docs.microsoft.com/azure/active-directory/roles/security-planning)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Privileged Identity Management](https://ms.portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart) <br>"
                        },
                        "name": "PA-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"PA.1\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| where OperationName contains \"PIM\"\r\n| extend PIM = strcat(\"https://ms.portal.azure.com/#blade/Microsoft_Azure_PIMCommon/MyAuditsMenuBlade/aadmigratedroles\")\r\n| distinct OperationName, PIM, Identity, AADOperationType, TimeGenerated\r\n| sort by TimeGenerated desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Privileged Identity Management (PIM) Elevations",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "pending",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "PIM",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "PIM >>",
                            "linkIsContextBlade": false,
                            "bladeOpenContext": {
                              "bladeName": "MyAuditsMenuBlade",
                              "extensionName": "Microsoft_Azure_PIMCommon",
                              "bladeParameters": []
                            }
                          }
                        },
                        {
                          "columnMatch": "Identity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "GrantedTo",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "UserProfile",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go To: Entra ID Profile >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "locInfoColumn": "Location",
                      "latitude": "latitude_",
                      "longitude": "longitude_",
                      "sizeSettings": "city_",
                      "sizeAggregation": "Count",
                      "labelSettings": "city_",
                      "legendMetric": "city_",
                      "numberOfMetrics": 100,
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "state_",
                        "colorAggregation": "Count",
                        "type": "heatmap",
                        "heatmapPalette": "coldHot"
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPA1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PA-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Avoid Standing Access for Accounts (PA-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-2-avoid-standing-access-for-user-accounts-and-permissions)\r\n\r\nInstead of creating standing privileges, use just-in-time (JIT) mechanism to assign privileged access to the different resource tiers.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Azure PIM just-in-time access deployment](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-deployment-plan)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview)<br>\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPAVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PA-2"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"PA.2\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPA2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PA-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Manage Lifecycle of Identities & Entitlements (PA-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-3-manage-lifecycle-of-identities-and-entitlements)\r\n\r\nUse an automated process or technical control to manage the identity and access lifecycle including the request, review, approval, provision, and deprovision.\r\n\r\n## Recommended Logs\r\nüî∑ [IdentityInfo](https://docs.microsoft.com/azure/azure-monitor/reference/tables/identityinfo) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/)<br> \r\n\r\n## Implementation\r\nüí° [What are Microsoft Entra ID access reviews](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br>\r\nüí° [What is Microsoft Entra ID entitlement management](https://docs.microsoft.com/azure/active-directory/governance/entitlement-management-overview)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\nüîÄ [Identity Governance](https://ms.portal.azure.com/#blade/Microsoft_AAD_ERM/DashboardBlade/GettingStarted) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPAVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PA-3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Roles = IdentityInfo\r\n| summarize arg_max(TimeGenerated, *) by UserPrincipalName=AccountUPN\r\n| project UserPrincipalName, AssignedRoles=strcat(AssignedRoles), GroupMemberships=strcat(GroupMembership);\r\nSigninLogs\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\", UserId)\r\n| where ResultType == 0\r\n| summarize count() by UserPrincipalName, UserProfile, UserId\r\n| join (Roles) on UserPrincipalName\r\n| project UserPrincipalName, UserProfile, AssignedRoles, GroupMemberships, UserId\r\n| sort by UserPrincipalName asc\r\n| limit 2500",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Review User Roles and Groups",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "UserProfile",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Entra ID User Profile >>",
                            "bladeOpenContext": {
                              "bladeName": "UserDetailsMenuBlade",
                              "extensionName": "Microsoft_AAD_IAM",
                              "bladeParameters": [
                                {
                                  "name": "userId",
                                  "source": "column",
                                  "value": "UserId"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "LastSignIn",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          },
                          "numberFormat": {
                            "unit": 27,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "UserId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "SignInsBeforeInactive",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 2500,
                      "filter": true
                    },
                    "sortBy": [],
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "locInfoColumn": "Location",
                      "latitude": "latitude_",
                      "longitude": "longitude_",
                      "sizeSettings": "city_",
                      "sizeAggregation": "Count",
                      "labelSettings": "city_",
                      "legendMetric": "city_",
                      "numberOfMetrics": 100,
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "state_",
                        "colorAggregation": "Count",
                        "type": "heatmap",
                        "heatmapPalette": "coldHot"
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPA3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PA-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Review & Reconcile User Access Regularly (PA-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-4-review-and-reconcile-user-access-regularly)\r\n\r\nConduct regular review of privileged account entitlements. Ensure the access granted to the accounts is valid for administration of control plane, management plane, and workloads.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n## Implementation\r\nüí° [Create an access review of Azure resource roles in Privileged Identity Management (PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-resource-roles-start-access-review)<br>\r\nüí° [How to use Microsoft Entra ID identity and access reviews](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br>\r\n\r\n### Microsoft Portal\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPAVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PA-4"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"PA.4\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Title contains \"Account\" or Title contains \"User\" or Title contains \"Identity\" or Title contains \"Login\" or Title contains \"Sign\" or Title contains \"travel\" or Title contains \"impersonate\" or Title contains \"AAD\" or Title contains \"service principal\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents: User Access",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPA4Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PA-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Setup Emergency Access (PA-5)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-5-set-up-emergency-access)\r\n\r\nSet up emergency access to ensure that you are not accidentally locked out of your critical cloud infrastructure (such as your identity and access management system) in an emergency.\r\n\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n## Implementation\r\nüí° [Manage Emergency Access Accounts in Microsoft Entra ID](https://docs.microsoft.com/azure/active-directory/roles/security-emergency-access)<br>\r\nüí° [Identity and key management](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-identity-keys)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPAVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PA-5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Roles = IdentityInfo\r\n| summarize arg_max(TimeGenerated, *) by UserPrincipalName=AccountUPN\r\n| project UserPrincipalName, AssignedRoles=strcat(AssignedRoles), GroupMemberships=strcat(GroupMembership);\r\nSigninLogs\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\", UserId)\r\n| where ResultType == 0\r\n| summarize count() by UserPrincipalName, UserProfile, UserId\r\n| join (Roles) on UserPrincipalName\r\n| where AssignedRoles contains \"security\" or AssignedRoles contains \"admin\" or GroupMemberships contains \"security\" or GroupMemberships contains \"admin\"\r\n| project UserPrincipalName, UserProfile, SignInCount=count_, AssignedRoles, GroupMemberships, UserId\r\n| sort by SignInCount desc\r\n| limit 2500",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Designate Emergency Accounts & Monitor Access",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "UserProfile",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Entra ID User Profile >>",
                            "bladeOpenContext": {
                              "bladeName": "UserDetailsMenuBlade",
                              "extensionName": "Microsoft_AAD_IAM",
                              "bladeParameters": [
                                {
                                  "name": "userId",
                                  "source": "column",
                                  "value": "UserId"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "SignInCount",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "UserId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "LastSignIn",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          },
                          "numberFormat": {
                            "unit": 27,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "SignInsBeforeInactive",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 2500,
                      "filter": true
                    },
                    "sortBy": [],
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "locInfoColumn": "Location",
                      "latitude": "latitude_",
                      "longitude": "longitude_",
                      "sizeSettings": "city_",
                      "sizeAggregation": "Count",
                      "labelSettings": "city_",
                      "legendMetric": "city_",
                      "numberOfMetrics": 100,
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "state_",
                        "colorAggregation": "Count",
                        "type": "heatmap",
                        "heatmapPalette": "coldHot"
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPA5Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PA-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Use Privileged Access Workstations (PA-6)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-6-use-privileged-access-workstations)\r\n\r\nSecured, isolated workstations are critically important for the security of sensitive roles like administrator, developer, and critical service operator.\r\n\r\n## Implementation\r\nüí° [Understand Privileged Access Workstations](https://docs.microsoft.com/security/compass/privileged-access-deployment)<br>\r\n\r\n### Microsoft Portal\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPAVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PA-6"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## [Privileged Access Deployment](https://docs.microsoft.com/security/compass/privileged-access-deployment)\r\n![Image¬†Name](https://docs.microsoft.com/security/compass/media/privileged-access-deployment/privileged-access-deployment-profile-summary.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PA-4 - Copy",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPA6Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PA-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Follow Just Enough Administration Principle (PA-7)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-7-follow-just-enough-administration-least-privilege-principle)\r\n\r\nFollow the just enough administration (least privilege) principle to manage permissions at fine-grained level. Use features such as role-based access control (RBAC) to manage resource access through role assignments.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/)<br> \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Activity]( https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n## Implementation\r\nüí° [What is Azure Role-Based Access Control (Azure RBAC)](https://docs.microsoft.com/azure/role-based-access-control/overview)<br>\r\nüí° [How to Configure Azure RBAC](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal)<br>\r\nüí° [How to Use Microsoft Entra ID Identity and Access Reviews](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPAVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PA-7"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"PA.7\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| extend UserPrincipalName = tostring(InitiatedBy.user.userPrincipalName)\r\n| summarize Runs = count(), Success = countif(Result == 'success'), Fails = countif(Result != 'success') by OperationName // Summarize the total, successful and failed operations by name\r\n| extend SuccessRate = (Success * 100 / Runs) // Calculate the percentage of successful operations against the total\r\n| project OperationName, Runs, SuccessRate, Fails\r\n| sort by Runs desc\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Monitor Privileged User Operations",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Runs",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "SuccessRate",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redGreen"
                          }
                        },
                        {
                          "columnMatch": "Fails",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "red"
                          }
                        },
                        {
                          "columnMatch": "UserId",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OfficeWorkload",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Fails_3",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Fails_3",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let data = AuditLogs\r\n| extend UserPrincipalName = tostring(InitiatedBy.user.userPrincipalName)\r\n    | where \"All\" == \"All\" or Result in ('All')\r\n    | extend initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \"\", tostring(InitiatedBy.user.userPrincipalName), \"unknown\")\r\n    | where \"All\" == \"All\" or initiator in ('All')\r\n    | where \"All\" == \"All\" or Category in ('All')\r\n    | where Category == 'All' or 'All' == \"All\";\r\nlet appData = data\r\n    | summarize TotalCount = count() by OperationName, Category\r\n    | join kind=inner (data\r\n        | make-series Trend = count() default = 0 on TimeGenerated in range(ago(7d), now(), 3h) by OperationName\r\n        | project-away TimeGenerated)\r\n        on OperationName\r\n    | order by TotalCount desc, OperationName asc\r\n    | project OperationName, TotalCount, Trend, Category\r\n    | serialize Id = row_number();\r\ndata\r\n| summarize TotalCount = count() by initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \"\", tostring(InitiatedBy.user.userPrincipalName), \"unknown\"), Category, OperationName\r\n| join kind=inner (data\r\n    | make-series Trend = count() default = 0 on TimeGenerated in range(ago(7d), now(), 3h) by OperationName, initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \"\", tostring(InitiatedBy.user.userPrincipalName), \"unknown\")\r\n    | project-away TimeGenerated)\r\n    on OperationName, initiator\r\n| order by TotalCount desc, OperationName asc\r\n| project OperationName, initiator, TotalCount, Category, Trend\r\n| serialize Id = row_number(1000000)\r\n| join kind=inner (appData) on OperationName\r\n| project Id, Name = initiator, Type = 'initiator', ['Operations Count'] = TotalCount, Trend, ParentId = Id1\r\n| union (appData \r\n    | project Id, Name = OperationName, Type = 'Operation', ['Operations Count'] = TotalCount, Trend)\r\n| order by ['Operations Count'] desc, Name asc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Monitor Privileged User Activities",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "exportParameterName": "UserInfo",
                    "exportDefaultValue": "{ \"Name\":\"\", \"Type\":\"*\"}",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Id",
                          "formatter": 5,
                          "formatOptions": {
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Type",
                          "formatter": 5,
                          "formatOptions": {
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Operations Count",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue",
                            "showIcon": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 9,
                          "formatOptions": {
                            "min": 0,
                            "palette": "turquoise",
                            "showIcon": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "ParentId",
                          "formatter": 5,
                          "formatOptions": {
                            "showIcon": true
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "hierarchySettings": {
                        "idColumn": "Id",
                        "parentColumn": "ParentId",
                        "treeType": 0,
                        "expanderColumn": "Name"
                      }
                    },
                    "sortBy": [],
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "Location",
                      "latitude": "SourceIPLocation",
                      "longitude": "SourceIPLocation",
                      "sizeSettings": "Location",
                      "sizeAggregation": "Count",
                      "legendMetric": "Location",
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "Location",
                        "colorAggregation": "Count",
                        "type": "thresholds",
                        "thresholdsGrid": [
                          {
                            "operator": "Default",
                            "thresholdValue": null,
                            "representation": "blueDark"
                          }
                        ]
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPA7Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PA-7",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Determine Access Process for Support (PA-8)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-8-determine-access-process-for-cloud-provider-support)\r\n\r\nEstablish an approval process and access path for requesting and approving vendor support request and temporary access to your data through a secure channel.\r\n\r\n## Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Customer Lockbox](https://docs.microsoft.com/azure/security/fundamentals/customer-lockbox-overview) <br>\r\n\r\n## Implementation\r\nüí° [Understand Customer Lockbox](https://docs.microsoft.com/azure/security/fundamentals/customer-lockbox-overview)<br>\r\nüí° [Establish Approval Process for Vendor Support Access with Azure Lockbox](https://portal.azure.com/#blade/Microsoft_Azure_Lockbox/LockboxMenu/ActivityLog)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Customer Lockbox](https://portal.azure.com/#blade/Microsoft_Azure_Lockbox/LockboxMenu/Overview)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPAVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PA-8"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName contains \"lockbox\"\r\n| sort by TimeGenerated desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Customer Lockbox Activity",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPA8Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PA-8",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isPAVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Privileged Access Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Data Protection (DP)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection) \r\n---\r\nData Protection covers control of data protection at rest, in transit, and via authorized access mechanisms, including discover, classify, protect, and monitor sensitive data assets using access control, encryption, and logging in Azure."
            },
            "customWidth": "40",
            "name": "DP Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "text - 8 - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Discover, Classify, & Label Sensitive Data (DP-1)\\\", \\\"tab\\\": \\\"DP1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Monitor Anomalies & Threats Targeting Sensitive Data (DP-2)\\\", \\\"tab\\\": \\\"DP2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Encrypt Sensitive Data in Transit (DP-3)\\\", \\\"tab\\\": \\\"DP3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Enable Data at Rest Encryption by Default (DP-4)\\\", \\\"tab\\\": \\\"DP4\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDP1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DP1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isDP2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DP2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "1ecc3fc5-0702-423d-9bb8-5655a8dfbbeb"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isDP3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DP3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "17084acc-f6d3-468e-acf2-b8495a892526"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isDP4Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DP4",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "e3ffa459-386a-4c1e-925f-49f2fa7abeee"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Use Customer-Managed Keys (DP-5)\\\", \\\"tab\\\": \\\"DP5\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Use Secure Key Management (DP-6)\\\", \\\"tab\\\": \\\"DP6\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Use Secure Certificate Management (DP-7)\\\", \\\"tab\\\": \\\"DP7\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Ensure Security of Key & Certificate Repository (DP-8)\\\", \\\"tab\\\": \\\"DP8\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "dcbe4289-9536-4684-92a1-1b8ab38ae4d3",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDP5Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DP5",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "7989a6c0-1e87-4b65-bcd5-5825349ec18c",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDP6Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DP6",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "3bc5bd51-d93c-4c6c-9cd2-36f5b0b96443",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDP7Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DP7",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "892d1c80-5dd4-4937-9527-36b21bf9eacf",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDP8Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DP8",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Discover, Classify, & Label Sensitive Data (CP-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-1-discover-classify-and-label-sensitive-data)\r\n\r\nEstablish and maintain an inventory of the sensitive data, based on the defined sensitive data scope. Use tools to discover, classify and label the in- scope sensitive data.\r\n\r\n## Recommended Logs\r\nüî∑ [InformationProtectionLogs_CL](https://docs.microsoft.com/azure/information-protection/audit-logs) ‚ú≥Ô∏è [Azure Information Protection](https://azure.microsoft.com/services/information-protection/)<br>\r\n\r\n## Implementation\r\nüí° [Data classification overview](https://docs.microsoft.com/azure/cloud-adoption-framework/govern/policy-compliance/data-classification)<br>\r\nüí° [Label your sensitive data using Azure Purview](https://docs.microsoft.com/azure/purview/create-sensitivity-label)<br>\r\nüí° [Tag Sensitive Information Using Azure Information Protection](https://docs.microsoft.com/azure/information-protection/what-is-information-protection)<br>\r\nüí° [How to implement Azure SQL Data Discovery](https://docs.microsoft.com/azure/azure-sql/database/data-discovery-and-classification-overview)<br>\r\nüí° [Azure Purview data sources](https://docs.microsoft.com/azure/purview/purview-connector-overview#purview-data-sources)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Azure Information Protection](https://portal.azure.com/#blade/Microsoft_Azure_InformationProtection/DataClassGroupEditBlade/quickstartBlade) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDPVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "DP-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "InformationProtectionLogs_CL\r\n| extend AIP = strcat(\"https://portal.azure.com/#blade/Microsoft_Azure_InformationProtection/DataClassGroupEditBlade/ActivityLogsBlade\")\r\n| summarize count() by LabelName_s, AIP\r\n| sort by count_ desc\r\n\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Data Labeling via Azure Information Protection",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LabelName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AIP",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Azure Information Protection >>",
                            "bladeOpenContext": {
                              "bladeName": "DataClassGroupEditBlade",
                              "extensionName": "Microsoft_Azure_InformationProtection",
                              "bladeParameters": []
                            }
                          }
                        },
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ProtectionOwner",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "PersonWithFriend",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        },
                        {
                          "columnMatch": "UserId_s",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ProductName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "UPN",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Incident >"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "city_",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "state_",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blueDark",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "SigninStatus",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 9,
                        "formatOptions": {
                          "palette": "green"
                        }
                      },
                      "showBorder": false
                    },
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "Location",
                      "latitude": "SourceIPLocation",
                      "longitude": "SourceIPLocation",
                      "sizeSettings": "Location",
                      "sizeAggregation": "Count",
                      "legendMetric": "Location",
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "Location",
                        "colorAggregation": "Count",
                        "type": "thresholds",
                        "thresholdsGrid": [
                          {
                            "operator": "Default",
                            "thresholdValue": null,
                            "representation": "blueDark"
                          }
                        ]
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDP1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DP-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Monitor Anomalies & Threats Targeting Sensitive Data (DP-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-2-monitor-anomalies-and-threats-targeting-sensitive-data)\r\n\r\nMonitor for anomalies around sensitive data, such as unauthorized transfer of data to locations outside of enterprise visibility and control. This typically involves monitoring for anomalous activities (large or unusual transfers) that could indicate unauthorized data exfiltration.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n## Implementation\r\nüí° [Enable Azure Defender for SQL](https://docs.microsoft.com/azure/azure-sql/database/azure-defender-for-sql)<br>\r\nüí° [Enable Azure Defender for Storage](https://docs.microsoft.com/azure/storage/common/storage-advanced-threat-protection?tabs=azure-security-center)<br>\r\n\r\n### Microsoft Logs\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDPVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "DP-2"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"DP.2\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Title contains \"data\" or Title contains \"access\" or Title contains \"sensitive\" or Tactics == \"exfiltration\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents: Sensitive Data",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDP2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DP-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Encrypt Sensitive Data in Transit (DP-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-3-encrypt-sensitive-data-in-transit)\r\n\r\nProtect the data in transit against 'out of band' attacks (such as traffic capture) using encryption to ensure that attackers cannot easily read or modify the data.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Double encryption for Azure data in transit](https://docs.microsoft.com/azure/security/fundamentals/double-encryption#data-in-transit)<br>\r\nüí° [Understand encryption in transit with Azure](https://docs.microsoft.com/azure/security/fundamentals/encryption-overview#encryption-of-data-in-transit)<br>\r\nüí° [Information on TLS Security](https://docs.microsoft.com/security/engineering/solving-tls1-problem)<br>\r\nüí° [Enforce secure transfer in Azure storage](https://docs.microsoft.com/azure/storage/common/storage-require-secure-transfer?toc=/azure/storage/blobs/toc.json#require-secure-transfer-for-a-new-storage-account)<br>\r\n\r\n## Microsoft Portals \r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDPVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "DP-3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"DP.3\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDP3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DP-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Enable Data at Rest Encryption by Default (DP-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-4-enable-data-at-rest-encryption-by-default)\r\n\r\nTo complement access controls, data at rest should be protected against 'out of band' attacks (such as accessing underlying storage) using encryption. This helps ensure that attackers cannot easily read or modify the data.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Understand Encryption at Rest in Azure](https://docs.microsoft.com/azure/security/fundamentals/encryption-atrest#encryption-at-rest-in-microsoft-cloud-services)<br>\r\nüí° [Data at Rest Double Encryption in Azure](https://docs.microsoft.com/azure/security/fundamentals/double-encryption#data-at-rest)<br>\r\nüí° [Encryption Model and Key Management Table](https://docs.microsoft.com/azure/security/fundamentals/encryption-models)<br>\r\nüí° [Security architecture](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-architecture)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDPVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "DP-4"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"DP.4\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDP4Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DP-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Use Customer-Managed Key Option in Data at Rest Encryption When Required (DP-5)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-5-use-customer-managed-key-option-in-data-at-rest-encryption-when-required)\r\n\r\nIf required for regulatory compliance, define the use case and service scope where customer-managed key option is needed. Enable and implement data at rest encryption using customer-managed key in services. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Encryption model and key management table](https://docs.microsoft.com/azure/security/fundamentals/encryption-models)<br>\r\nüí° [Services that support encryption using customer-managed key](https://docs.microsoft.com/azure/security/fundamentals/encryption-models#supporting-services)<br>\r\nüí° [How to configure customer managed encryption keys in Azure Storage](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-portal)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Key Vault](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDPVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "DP-5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"DP.5\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDP5Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DP-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Use a Secure Key Management Process (DP-6)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-6-use-a-secure-key-management-process)\r\n\r\nDocument and implement an enterprise cryptographic key management standard, processes, and procedures to control your key lifecycle. When there is a need to use customer-managed key in the services, use a secured key vault service for key generation, distribution, and storage. Rotate and revoke your keys based on the defined schedule and when there is a key retirement or compromise.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Key Vault](https://azure.microsoft.com/services/key-vault/)\r\n\r\n## Implementation\r\nüí° [Azure Key Vault overview](https://docs.microsoft.com/azure/key-vault/general/overview)<br>\r\nüí° [Azure data encryption at rest--Key Hierarchy](https://docs.microsoft.com/azure/security/fundamentals/encryption-atrest#key-hierarchy)<br>\r\nüí° [BYOK (Bring Your Own Key) specification](https://docs.microsoft.com/azure/key-vault/keys/byok-specification)<br>\r\nüí° [Identity and key management](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-identity-keys)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Key Vault](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDPVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "DP-6"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"DP.6\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Run query to see results.\r\nresources\r\n| where type =~ 'Microsoft.KeyVault/vaults'\r\n| project name,resourceGroup,location,id,type,subscriptionId,kind,tags\r\n| extend typeDisplayName=case(type =~ 'microsoft.keyvault/vaults','Key vault',type)\r\n| extend locationDisplayName=case(location =~ 'eastus','East US',location =~ 'eastus2','East US 2',location =~ 'southcentralus','South Central US',location =~ 'westus2','West US 2',location =~ 'westus3','West US 3',location =~ 'australiaeast','Australia East',location =~ 'southeastasia','Southeast Asia',location =~ 'northeurope','North Europe',location =~ 'swedencentral','Sweden Central',location =~ 'uksouth','UK South',location =~ 'westeurope','West Europe',location =~ 'centralus','Central US',location =~ 'northcentralus','North Central US',location =~ 'westus','West US',location =~ 'southafricanorth','South Africa North',location =~ 'centralindia','Central India',location =~ 'eastasia','East Asia',location =~ 'japaneast','Japan East',location =~ 'jioindiawest','Jio India West',location =~ 'koreacentral','Korea Central',location =~ 'canadacentral','Canada Central',location =~ 'francecentral','France Central',location =~ 'germanywestcentral','Germany West Central',location =~ 'norwayeast','Norway East',location =~ 'switzerlandnorth','Switzerland North',location =~ 'uaenorth','UAE North',location =~ 'brazilsouth','Brazil South',location =~ 'centralusstage','Central US (Stage)',location =~ 'eastusstage','East US (Stage)',location =~ 'eastus2stage','East US 2 (Stage)',location =~ 'northcentralusstage','North Central US (Stage)',location =~ 'southcentralusstage','South Central US (Stage)',location =~ 'westusstage','West US (Stage)',location =~ 'westus2stage','West US 2 (Stage)',location =~ 'asia','Asia',location =~ 'asiapacific','Asia Pacific',location =~ 'australia','Australia',location =~ 'brazil','Brazil',location =~ 'canada','Canada',location =~ 'europe','Europe',location =~ 'france','France',location =~ 'germany','Germany',location =~ 'global','Global',location =~ 'india','India',location =~ 'japan','Japan',location =~ 'korea','Korea',location =~ 'norway','Norway',location =~ 'southafrica','South Africa',location =~ 'switzerland','Switzerland',location =~ 'uae','United Arab Emirates',location =~ 'uk','United Kingdom',location =~ 'unitedstates','United States',location =~ 'eastasiastage','East Asia (Stage)',location =~ 'southeastasiastage','Southeast Asia (Stage)',location =~ 'westcentralus','West Central US',location =~ 'southafricawest','South Africa West',location =~ 'australiacentral','Australia Central',location =~ 'australiacentral2','Australia Central 2',location =~ 'australiasoutheast','Australia Southeast',location =~ 'japanwest','Japan West',location =~ 'jioindiacentral','Jio India Central',location =~ 'koreasouth','Korea South',location =~ 'southindia','South India',location =~ 'westindia','West India',location =~ 'canadaeast','Canada East',location =~ 'francesouth','France South',location =~ 'germanynorth','Germany North',location =~ 'norwaywest','Norway West',location =~ 'switzerlandwest','Switzerland West',location =~ 'ukwest','UK West',location =~ 'uaecentral','UAE Central',location =~ 'brazilsoutheast','Brazil Southeast',location)\r\n| extend tagsString=tostring(tags)\r\n| where (type !~ ('dynatrace.observability/monitors'))\r\n| where (type !~ ('nginx.nginxplus/nginxdeployments'))\r\n| where (type !~ ('microsoft.agfoodplatform/farmbeats'))\r\n| where (type !~ ('microsoft.cdn/profiles/afdendpoints'))\r\n| where (type !~ ('microsoft.cdn/profiles/customdomains'))\r\n| where (type !~ ('microsoft.cdn/profiles/origingroups'))\r\n| where (type !~ ('microsoft.cdn/profiles/rulesets'))\r\n| where (type !~ ('microsoft.cdn/profiles/secrets'))\r\n| where (type !~ ('microsoft.cdn/profiles/securitypolicies'))\r\n| where (type !~ ('microsoft.cdn/profiles/afdendpoints/routes'))\r\n| where (type !~ ('microsoft.cdn/profiles/origingroups/origins'))\r\n| where (type !~ ('microsoft.cdn/profiles/rulesets/rules'))\r\n| where (type !~ ('microsoft.kubernetes/connectedclusters/microsoft.kubernetesconfiguration/fluxconfigurations'))\r\n| where (type !~ ('microsoft.containerservice/managedclusters/microsoft.kubernetesconfiguration/fluxconfigurations'))\r\n| where (type !~ ('microsoft.portal/extensions/deployments'))\r\n| where (type !~ ('microsoft.portal/extensions'))\r\n| where (type !~ ('microsoft.portal/extensions/slots'))\r\n| where (type !~ ('microsoft.portal/extensions/versions'))\r\n| where (type !~ ('microsoft.datacollaboration/workspaces'))\r\n| where (type !~ ('microsoft.network/dnsforwardingrulesets'))\r\n| where (type !~ ('microsoft.network/dnsresolvers'))\r\n| where (type !~ ('microsoft.azurestack/registrations'))\r\n| where (type !~ ('microsoft.communication/emailservices'))\r\n| where (type !~ ('microsoft.hdinsight/clusterpools/clusters'))\r\n| where (type !~ ('microsoft.hdinsight/clusterpools/clusters/sessionclusters'))\r\n| where (type !~ ('microsoft.hdinsight/clusterpools'))\r\n| where (type !~ ('microsoft.hpcworkbench/instances'))\r\n| where (type !~ ('microsoft.scvmm/vmmservers'))\r\n| where (type !~ ('microsoft.connectedvmwarevsphere/vcenters'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/assets'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/tests'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/executionplans'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/testplans'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins'))\r\n| where not((type =~ ('microsoft.network/serviceendpointpolicies')) and ((kind =~ ('internal'))))\r\n| where (type !~ ('microsoft.openlogisticsplatform/workspaces'))\r\n| where (type !~ ('microsoft.scom/managedinstances'))\r\n| where (type !~ ('microsoft.orbital/spacecrafts/contacts'))\r\n| where (type !~ ('microsoft.orbital/contactprofiles'))\r\n| where (type !~ ('microsoft.orbital/edgesites'))\r\n| where (type !~ ('microsoft.orbital/groundstations'))\r\n| where (type !~ ('microsoft.orbital/l2connections'))\r\n| where (type !~ ('microsoft.orbital/spacecrafts'))\r\n| where (type !~ ('microsoft.azurepercept/accounts'))\r\n| where (type !~ ('microsoft.workloads/phpworkloads'))\r\n| where (type !~ ('microsoft.playfab/playeraccountpools'))\r\n| where (type !~ ('microsoft.playfab/playfabresources'))\r\n| where (type !~ ('microsoft.playfab/titles'))\r\n| where (type !~ ('microsoft.recommendationsservice/accounts/modeling'))\r\n| where (type !~ ('microsoft.recommendationsservice/accounts/serviceendpoints'))\r\n| where (type !~ ('microsoft.recoveryservicesbvtd2/vaults'))\r\n| where (type !~ ('microsoft.recoveryservicesbvtd/vaults'))\r\n| where (type !~ ('microsoft.recoveryservicesintd/vaults'))\r\n| where (type !~ ('microsoft.recoveryservicesintd2/vaults'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances/applicationinstances'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances/centralinstances'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances/databaseinstances'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances'))\r\n| where (type !~ ('microsoft.datareplication/replicationvaults'))\r\n| where (type !~ ('microsoft.storagecache/amlfilesystems'))\r\n| where not((type =~ ('microsoft.synapse/workspaces/sqlpools')) and ((kind =~ ('v3'))))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks'))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks/sites'))\r\n| where (type !~ ('microsoft.mobilenetwork/packetcorecontrolplanes'))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks/services'))\r\n| where (type !~ ('microsoft.mobilenetwork/sims'))\r\n| where (type !~ ('microsoft.workloads/monitors'))\r\n| where not((type =~ ('microsoft.sql/servers/databases')) and ((kind in~ ('system','v2.0,system','v12.0,system','v12.0,user,datawarehouse,gen2,analytics'))))\r\n| where not((type =~ ('microsoft.sql/servers')) and ((kind =~ ('v12.0,analytics'))))\r\n| project id,typeDisplayName,resourceGroup,locationDisplayName,tagsString,name,type,kind,location,subscriptionId,tags\r\n| sort by (tolower(tostring(name))) asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Key Vault Assets",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDP6Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DP-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Use a Secure Certificate Management Process (DP-7)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-7-use-a-secure-certificate-management-process)\r\n\r\nDocument and implement an enterprise certificate management standard, processes and procedures which includes the certificate lifecycle control, and certificate policies (if a public key infrastructure is needed). \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n \r\n## Implementation\r\nüí° [Get started with Key Vault certificates](https://docs.microsoft.com/azure/key-vault/certificates/certificate-scenarios)<br>\r\nüí° [Certificate Access Control in Azure Key Vault](https://docs.microsoft.com/azure/key-vault/certificates/certificate-access-control)<br>\r\nüí° [Identity and key management](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-identity-keys)<br>\r\nüí° [Security architecture](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-architecture)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Key Vault](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults)<br>\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDPVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "DP-7"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"DP.7\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Title contains \"key\" or Title contains \"certificate\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents: Keys & Certificates",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDP7Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DP-7",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Ensure Security of Key & Certificate Repository (DP-8)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-8-ensure-security-of-key-and-certificate-repository)\r\n\r\nEnsure the security of the key vault service used for the cryptographic key and certificate lifecycle management. Harden your key vault service through access control, network security, logging and monitoring and backup to ensure keys and certificates are always protected using the maximum security.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Key Vault](https://azure.microsoft.com/services/key-vault/)\r\n \r\n## Implementation\r\nüí° [Azure Key Vault overview](https://docs.microsoft.com/azure/key-vault/general/overview)<br>\r\nüí° [Azure Key Vault security best practices](https://docs.microsoft.com/azure/key-vault/general/best-practices)<br>\r\nüí° [Use managed identity to access Azure Key Vault](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/tutorial-windows-vm-access-nonaad)<br>\r\nüí° [Identity and key management](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-identity-keys)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Key Vault](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults)<br>\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDPVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "DP-8"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"DP.8\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity \r\n| where OperationNameValue startswith \"Microsoft.KeyVault\"\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Key Vault: Access & Policy Changes",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url"
                          }
                        },
                        {
                          "columnMatch": "CompromisedEntity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Account",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Entra ID Profile >>"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 7 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where ResourceProvider == \"MICROSOFT.KEYVAULT\"\r\n| sort by TimeGenerated desc\r\n| limit 100\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Key Vault: Operations",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url"
                          }
                        },
                        {
                          "columnMatch": "CompromisedEntity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Account",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Entra ID Profile >>"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "rowLimit": 100,
                      "filter": true
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 5"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDP8Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DP-8",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isDPVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Data Protection Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Asset Management (AM)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management) \r\n---\r\nAsset Management covers controls to ensure security visibility and governance over Azure resources, including recommendations on permissions for security personnel, security access to asset inventory, and managing approvals for services and resources (inventory, track, and correct). "
            },
            "customWidth": "40",
            "name": "AM Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "A"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Track Asset Inventory & Risks (AM-1)\\\", \\\"tab\\\": \\\"AM1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Use Only Approved Services (AM-2)\\\", \\\"tab\\\": \\\"AM2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Ensure Security of Asset Lifecycle Management (AM-3)\\\", \\\"tab\\\": \\\"AM3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Limit Access to Asset Management (AM-4)\\\", \\\"tab\\\": \\\"AM4\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Use Only Approved Apps in Virtual Machine (AM-5)\\\", \\\"tab\\\": \\\"AM5\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isAM1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "AM1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isAM2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "AM2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "3b5c2b30-6e56-4326-9416-89041b15e51a"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isAM3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "AM3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "262d5814-d29c-45a0-bb16-6506c0e315fe"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isAM4Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "AM4",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "1765861c-fdf7-4445-9378-9996ac409814"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isAM5Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "AM5",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "5da235d1-704b-478b-9325-e2aa8d5458ee"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Track Asset Inventory & Risks (AM-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management#am-1-track-asset-inventory-and-their-risks)\r\n\r\nTrack your asset inventory by query and discover all your cloud resources. Logically organize your assets by tagging and grouping your assets based on their service nature, location, or other characteristics. Ensure your security organization has access to a continuously updated inventory of assets.\r\n\r\n## Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br> \r\n\r\n## Implementation\r\nüí° [How to Create Queries with Azure Resource Graph Explorer](https://docs.microsoft.com/azure/governance/resource-graph/first-query-portal)<br>\r\nüí° [Microsoft Defender for Cloud Asset Inventory Management](https://docs.microsoft.com/azure/security-center/asset-inventory)<br>\r\nüí° [For More Information About Tagging Assets, See the Resource Naming and Tagging Decision Guide](https://docs.microsoft.com/azure/cloud-adoption-framework/decision-guides/resource-tagging/?toc=%2fazure%2fazure-resource-manager%2fmanagement%2ftoc.json)<br>\r\nüí° [Overview of Security Reader Role](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#security-reader)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud: Inventory](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/25)<br>\r\nüîÄ [Microsoft Defender XDR: Software Inventory](https://security.microsoft.com/software-inventory/applications)<br>\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isAMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "AM-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| extend Azure_Inventory=location\r\n| extend M365_Inventory=strcat(\"https://security.microsoft.com/machines\")\r\n| project AssetID=id,AssetType=type, Azure_Inventory, M365_Inventory\r\n| sort by AssetID asc\r\n| limit 2500",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Asset Inventory",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Azure_Inventory",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Azure Inventory >>",
                            "bladeOpenContext": {
                              "bladeName": "InventoryBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "",
                                  "source": "static",
                                  "value": "25"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "DefenderXDR_Inventory",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "DefenderXDR Inventory >>"
                          }
                        }
                      ],
                      "rowLimit": 2500,
                      "filter": true
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "type",
                        "formatter": 16,
                        "formatOptions": {
                          "showIcon": true
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"microsoft\"\r\n| project id,type,resourceGroup, tags\r\n| extend tag = strcat(tags)\r\n| summarize count() by tag\r\n| where tag <> \"\" \r\n| where tag <> \"{}\" \r\n| sort by count_ desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Tags Currently In Use",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "properties_storageProfile_osDisk_osType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Windows",
                                "representation": "blue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Linux",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "green",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Tags Currently In Use",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isAM1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "AM-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Use Only Approved Services (AM-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management#am-2-use-only-approved-services)\r\n\r\nEnsure that only approved cloud services can be used, by auditing and restricting which services users can provision in the environment. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance)  ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br>\r\n\r\n## Implementation\r\nüí° [Configure and Manage Azure Policy](https://docs.microsoft.com/azure/governance/policy/tutorials/create-and-manage)<br>\r\nüí° [How to Deny a Specific Resource Type with Azure Policy](https://docs.microsoft.com/azure/governance/policy/samples/index)<br>\r\nüí° [How to Create Queries with Azure Resource Graph Explorer](https://docs.microsoft.com/azure/governance/resource-graph/first-query-portal)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isAMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "AM-2"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"AM.2\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| summarize count() by type\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Asset Count by Type",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "type",
                        "formatter": 16,
                        "formatOptions": {
                          "showIcon": true
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isAM2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "AM-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Ensure Security of Asset Lifecycle Management (AM-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management#am-3-ensure-security-of-asset-lifecycle-management)\r\n\r\nEnsure security attributes or configurations of the assets are always updated during the asset lifecycle. \r\n\r\n## Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n## Implementation\r\nüí° [Delete Azure Resource Group and Resource](https://docs.microsoft.com/azure/azure-resource-manager/management/delete-resource-group)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isAMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "AM-3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName contains \"delete\" or OperationName contains \"remove\" or OperationName contains \"update\" or OperationName contains \"create\"\r\n| summarize count() by OperationName, Caller\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Asset Activity by User/Account",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isAM3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "AM-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Limit Access to Asset Management (AM-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management#am-4-limit-access-to-asset-management)\r\n\r\nLimit users' access to asset management features, to avoid accidental or malicious modification of the assets in your cloud. \r\n\r\n## Recommended Logs\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n## Implementation\r\nüí° [How to Configure Conditional Access to Block Access to Azure Resources Manager](https://docs.microsoft.com/azure/role-based-access-control/conditional-access-azure-management)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isAMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "AM-4"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastObserved = SigninLogs\r\n| where ResultType == 0\r\n| where ResourceDisplayName contains \"Manage\" or ResourceDisplayName contains \"graph\"\r\n| summarize arg_max(TimeGenerated, *) by UserPrincipalName\r\n| project UserPrincipalName, LastObservedAccess=TimeGenerated;\r\nSigninLogs\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\", UserId)\r\n| where ResultType == 0\r\n| where ResourceDisplayName contains \"Manage\" or ResourceDisplayName contains \"graph\"\r\n| summarize count() by UserPrincipalName, ResourceDisplayName, UserProfile, UserId\r\n| join (LastObserved) on UserPrincipalName\r\n| project UserPrincipalName, SignInCount=count_, ResourceDisplayName, UserProfile, LastObservedAccess, UserId\r\n| sort by SignInCount desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Management Function Access",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "SignInCount",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "UserProfile",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Entra ID User Profile >>",
                            "bladeOpenContext": {
                              "bladeName": "UserDetailsMenuBlade",
                              "extensionName": "Microsoft_AAD_IAM",
                              "bladeParameters": [
                                {
                                  "name": "userId",
                                  "source": "column",
                                  "value": "UserId"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "UserId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "locInfoColumn": "Location",
                      "latitude": "latitude_",
                      "longitude": "longitude_",
                      "sizeSettings": "city_",
                      "sizeAggregation": "Count",
                      "labelSettings": "city_",
                      "legendMetric": "city_",
                      "numberOfMetrics": 100,
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "state_",
                        "colorAggregation": "Count",
                        "type": "heatmap",
                        "heatmapPalette": "coldHot"
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 9"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isAM4Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "AM-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Use Only Approved Apps in Virtual Machine (AM-5)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management#am-5-use-only-approved-applications-in-virtual-machine)\r\n\r\nEnsure that only authorized software executes by creating an allow list and block the unauthorized software from executing in your environment.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance)  ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [How to Use Microsoft Defender for Cloud Adaptive Application Controls](https://docs.microsoft.com/azure/security-center/security-center-adaptive-application)<br>\r\nüí° [Understand Azure Automation Change Tracking and Inventory](https://docs.microsoft.com/azure/automation/change-tracking/overview)<br>\r\nüí° [How to Control PowerShell Script Execution in Windows Environments](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/set-executionpolicy)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Automation Accounts](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isAMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "AM-5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"AM.5\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isAM5Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "AM-5",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isAMVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Asset Management Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Logging & Threat Detection (LT)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection) \r\n---\r\nLogging and Threat Detection covers controls for detecting threats on Azure and enabling, collecting, and storing audit logs for Azure services, including enabling detection, investigation, and remediation processes with controls to generate high-quality alerts with native threat detection in Azure services; it also includes collecting logs with Azure Monitor, centralizing security analysis with Microsoft Sentinel, time synchronization, and log retention."
            },
            "customWidth": "40",
            "name": "LT Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "text - 10"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Enable Threat Detection Capabilities (LT-1)\\\", \\\"tab\\\": \\\"LT1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Enable Threat Detection for Identity & Access Management (LT-2)\\\", \\\"tab\\\": \\\"LT2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Enable Logging for Security Investigation (LT-3)\\\", \\\"tab\\\": \\\"LT3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Limit Access to Asset Management (LT-4)\\\", \\\"tab\\\": \\\"LT4\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isLT1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "LT1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isLT2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "LT2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "61226164-0f22-4271-bd57-aebde7d72af1"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isLT3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "LT3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "1e93ea31-59fd-41fd-9f44-1ea9447c6779"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isLT4Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "LT4",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "c92c1ebd-90ac-466d-81b6-0b4a7e5e4cab"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Centralize Security Log Management & Analysis (LT-5)\\\", \\\"tab\\\": \\\"LT5\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Configure Log Storage Retention (LT-6)\\\", \\\"tab\\\": \\\"LT6\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Use Approved Time Synchronization Sources (LT-7)\\\", \\\"tab\\\": \\\"LT7\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "6ee1efad-6ae5-4c5b-9ecf-29c52d5999e1",
                  "version": "KqlParameterItem/1.0",
                  "name": "isLT5Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "LT5",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "5bc1802f-413f-426c-b292-074f215308e6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isLT6Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "LT6",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "11afdb83-5ddc-446a-832f-91dc11c06125",
                  "version": "KqlParameterItem/1.0",
                  "name": "isLT7Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "LT7",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Enable Threat Detection Capabilities (LT-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-1-enable-threat-detection-capabilities)\r\n\r\nTo support threat detection scenarios, monitor all known resource types for known and expected threats and anomalies. Configure your alert filtering and analytics rules to extract high-quality alerts from log data, agents, or other data sources to reduce false positives.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) üî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Microsoft Defender for Cloud Apps](https://www.microsoft.com/microsoft-365/enterprise-mobility-security/cloud-app-security) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender) ‚ú≥Ô∏è [Microsoft Defender for Identity]( https://www.microsoft.com/microsoft-365/security/identity-defender) <br>\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Threat Protection in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/azure-defender)<br>\r\nüí° [Microsoft Defender for Cloud Security Alerts Reference Guide](https://docs.microsoft.com/azure/security-center/alerts-reference)<br>\r\nüí° [Create Custom Analytics Rules to Detect Threats](https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom)<br>\r\nüí° [Cyber Threat Intelligence with Microsoft Sentinel](https://docs.microsoft.com/azure/architecture/example-scenario/data/sentinel-threat-intelligence)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Defender XDR](https://security.microsoft.com/) <br> \r\nüîÄ [Microsoft Defender for Cloud Apps Portal](https://portal.cloudappsecurity.com/)<br>\r\nüîÄ [Privileged Identity Management](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart)  <br> \r\nüîÄ [Microsoft Defender for IoT](https://portal.azure.com/#blade/Microsoft_Azure_IoT_Defender/IoTDefenderDashboard/Getting_Started)  <br>\r\nüîÄ [Microsoft Defender for Identity](https://portal.atp.azure.com/)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isLTVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "LT-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"LT.1\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string, Portal:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Microsoft Sentinel\", \"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel\",\r\n    \"MCAS\", \"Microsoft Defender for Cloud Apps\", \"https://portal.cloudappsecurity.com/\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\", \"https://security.microsoft.com/homepage\",\r\n    \"Azure Security Center\", \"Microsoft Defender for Cloud\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0\",\r\n    \"Detection-WarmPathV2\", \"Microsoft Defender for Cloud\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\", \"https://security.microsoft.com/homepage\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\", \"https://portal.azure.com/#blade/Microsoft_AAD_IAM/IdentityProtectionMenuBlade/Overview\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\", \"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\", \"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\", \"https://portal.atp.azure.com/\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\", \"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel\",\r\n    \"IoTSecurity\", \"Microsoft Defender for IoT\", \"https://portal.azure.com/#blade/Microsoft_Azure_IoT_Defender/IoTDefenderDashboard/Getting_Started\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\", \"https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\", \"https://security.microsoft.com/homepage\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\", \"https://security.microsoft.com/homepage\",\r\n    \"AdaptiveNetworkHardenings\", \"Microsoft Defender for Cloud\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\", \"https://portal.azure.com/#blade/Microsoft_Azure_Network/NetworkWatcherMenuBlade/overview\",\r\n    \"SQLThreatDetection\", \"Microsoft Defender for Cloud\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| summarize count() by Product, Portal\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Alerts Count by Product",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Product",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Defense Evasion",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Portal",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Portal >>"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ProductName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": ""
                          }
                        },
                        {
                          "columnMatch": "UPN",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Incident >"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "city_",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "state_",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blueDark",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "SigninStatus",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 9,
                        "formatOptions": {
                          "palette": "green"
                        }
                      },
                      "showBorder": false
                    },
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "Location",
                      "latitude": "SourceIPLocation",
                      "longitude": "SourceIPLocation",
                      "sizeSettings": "Location",
                      "sizeAggregation": "Count",
                      "legendMetric": "Location",
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "Location",
                        "colorAggregation": "Count",
                        "type": "thresholds",
                        "thresholdsGrid": [
                          {
                            "operator": "Default",
                            "thresholdValue": null,
                            "representation": "blueDark"
                          }
                        ]
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isLT1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "LT-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Enable Threat Detection for Identity & Access Management (LT-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-2-enable-threat-detection-for--identity-and-access-management)\r\n\r\nDetect threats for identities and access management by monitoring the user and application sign-in and access anomalies. Behavioral patterns such as excessive number of failed login attempts, and deprecated accounts in the subscription, should be alerted.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Microsoft Entra ID](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n## Implementation\r\nüí° [Audit activity reports in Microsoft Entra ID](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-audit-logs)<br>\r\nüí° [Enable Azure Identity Protection](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection)<br>\r\nüí° [Threat Protection in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/azure-defender)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Entra ID](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) "
                        },
                        "conditionalVisibility": {
                          "parameterName": "isLTVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "LT-2"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"LT.2\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let AnomalousSigninActivity = BehaviorAnalytics\r\n    | where ActionType == \"Sign-in\"\r\n    | where (UsersInsights.NewAccount == True or UsersInsights.DormantAccount == True) and (\r\n        ActivityInsights.FirstTimeUserAccessedResource == True and ActivityInsights.ResourceUncommonlyAccessedAmongPeers == True\r\n        or ActivityInsights.FirstTimeUserUsedApp == True and ActivityInsights.AppUncommonlyUsedAmongPeers == False)\r\n    | join (\r\n        SigninLogs | where Status.errorCode == 0 or Status.errorCode == 0 and RiskDetail != \"none\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Successful Logon\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Successful Sign-in with one or more of the following indications: sign by new or recently dormant accounts and sign in with resource for the first time (while none of their peers did) or to an app for the first time (while none of their peers did) or performed by a user with Risk indicaiton from AAD\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet critical = dynamic(['9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3', 'c4e39bd9-1100-46d3-8c65-fb160da0071f', '158c047a-c907-4556-b7ef-446551a6b5f7', '62e90394-69f5-4237-9190-012177145e10', 'd29b2b05-8046-44ba-8758-1e26182fcf32', '729827e3-9c14-49f7-bb1b-9608f156bbb8', '966707d0-3269-4727-9be2-8c3a10f19b9d', '194ae4cb-b126-40b2-bd5b-6091b380977d', 'fe930be7-5e62-47db-91af-98c3a49a38b1']);\r\nlet high = dynamic(['cf1c38e5-3621-4004-a7cb-879624dced7c', '7495fdc4-34c4-4d15-a289-98788ce399fd', 'aaf43236-0c0d-4d5f-883a-6955382ac081', '3edaf663-341e-4475-9f94-5c398ef6c070', '7698a772-787b-4ac8-901f-60d6b08affd2', 'b1be1c3e-b65d-4f19-8427-f6fa0d97feb9', '9f06204d-73c1-4d4c-880a-6edb90606fd8', '29232cdf-9323-42fd-ade2-1d097af3e4de', 'be2f45a1-457d-42af-a067-6ec1fa63bc45', '7be44c8a-adaf-4e2a-84d6-ab2649e08a13', 'e8611ab8-c189-46e8-94e1-60213ab1f814']);//witdstomstl\r\nlet AnomalousRoleAssignment = AuditLogs\r\n    | where TimeGenerated > ago(28d)\r\n    | where OperationName == \"Add member to role\"\r\n    | mv-expand TargetResources\r\n    | extend RoleId = tostring(TargetResources.modifiedProperties[0].newValue)\r\n    | where isnotempty(RoleId) and RoleId in (critical, high)\r\n    | extend RoleName = tostring(TargetResources.modifiedProperties[1].newValue)\r\n    | where isnotempty(RoleName)\r\n    | extend TargetId = tostring(TargetResources.id)\r\n    | extend Target = tostring(TargetResources.userPrincipalName)\r\n    | join kind=inner (\r\n        BehaviorAnalytics\r\n        | where ActionType == \"Add member to role\"\r\n        | where UsersInsights.BlasrRadius == \"High\" or ActivityInsights.FirstTimeUserPerformedAction == true\r\n        )\r\n        on $left._ItemId == $right.SourceRecordId\r\n    | extend AnomalyName = \"Anomalous Role Assignemt\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Account Manipulation\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may manipulate accounts to maintain access to victim systems. These actions include adding new accounts to high privilleged groups. Dragonfly 2.0, for example, added newly created accounts to the administrators group to maintain elevated access.  The query below generates an output of all high Blast Radius users performing Add member to priveleged role, or ones that add users for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, RoleName, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; let LogOns=materialize(\r\n    BehaviorAnalytics\r\n    | where ActivityType == \"LogOn\");\r\nlet AnomalousResourceAccess = LogOns\r\n    | where ActionType == \"ResourceAccess\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | extend AnomalyName = \"Anomalous Resource Access\",\r\n        Tactic = \"Lateral Movement\",\r\n        Technique = \"\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversary may be trying to move through the environment. APT29 and APT32, for example, has used PtH & PtT techniques to lateral move around the network. The query below generates an output of all users performing an resource access (4624:3) to devices for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousRDPActivity = LogOns\r\n    | where ActionType == \"RemoteInteractiveLogon\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | extend AnomalyName = \"Anomalous RDP Activity\",\r\n        Tactic = \"Lateral Movement\",\r\n        Technique = \"\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user. FIN10, for example, has used RDP to move laterally to systems in the victim environment. The query below generates an output of all users performing a remote interactive logon (4624:10) to a device for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousLogintoDevices = LogOns\r\n    | where ActionType == \"InteractiveLogon\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | where UsersInsights.DormantAccount == true or DevicesInsights.LocalAdmin == true\r\n    | extend AnomalyName = \"Anomalous Login To Devices\",\r\n        Tactic = \"Privilege Escalation\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may steal the credentials of a specific user or service account using Credential Access techniques or capture credentials earlier in their reconnaissance process through social engineering for means of gaining Initial Access. APT33, for example, has used valid accounts for initial access and privilege escalation. The query below generates an output of all administator users performing an interactive logon (4624:2) to a device for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousPasswordReset = BehaviorAnalytics\r\n    | where ActionType == \"Reset user password\"\r\n    | where ActivityInsights.FirstTimeUserPerformedAction == \"True\"\r\n    | join (\r\n        AuditLogs\r\n        | where OperationName == \"Reset user password\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | mv-expand TargetResources\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Password Reset\",\r\n        Tactic = \"Impact\",\r\n        Technique = \"Account Access Removal\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts. LockerGoga, for example, has been observed changing account passwords and logging off current users. The query below generates an output of all users performing Reset user password for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority\r\n    | sort by TimeGenerated desc;\r\nlet AnomalousGeoLocationLogon = BehaviorAnalytics\r\n    | where ActionType == \"Sign-in\"\r\n    | where ActivityInsights.FirstTimeUserConnectedFromCountry == True and (ActivityInsights.FirstTimeConnectionFromCountryObservedInTenant == True or ActivityInsights.CountryUncommonlyConnectedFromAmongPeers == True)\r\n    | join (\r\n        SigninLogs\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Successful Logon\",\r\n        Tactic = \"Initial Access\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may steal the credentials of a specific user or service account using Credential Access techniques or capture credentials earlier in their reconnaissance process through social engineering for means of gaining Initial Access. APT33, for example, has used valid accounts for initial access. The query below generates an output of successful Sign-in performed by a user from a new geo location he has never connected from before, and none of his peers as well.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousFailedLogon = BehaviorAnalytics\r\n    | where ActivityType == \"LogOn\"\r\n    | where UsersInsights.BlastRadius == \"High\"\r\n    | join (\r\n        SigninLogs  \r\n        | where Status.errorCode == 50126\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Failed Logon\",\r\n        Tactic = \"Credential Access\",\r\n        Technique = \"Brute Force\",\r\n        SubTechnique = \"Password Guessing\",\r\n        Description = \"Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Emotet, for example, has been observed using a hard coded list of passwords to brute force user accounts. The query below generates an output of all users with 'High' BlastRadius that perform failed Sign-in:Invalid username or password.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousAADAccountManipulation = AuditLogs\r\n    | where OperationName == \"Update user\"\r\n    | mv-expand AdditionalDetails\r\n    | where AdditionalDetails.key == \"UserPrincipalName\"\r\n    | mv-expand TargetResources\r\n    | extend RoleId = tostring(TargetResources.modifiedProperties[0].newValue)\r\n    | where isnotempty(RoleId) and RoleId in (critical, high)\r\n    | extend RoleName = tostring(TargetResources.modifiedProperties[1].newValue)\r\n    | where isnotempty(RoleName)\r\n    | extend TargetId = tostring(TargetResources.id)\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | join kind=inner ( \r\n        BehaviorAnalytics\r\n        | where ActionType == \"Update user\"\r\n        | where UsersInsights.BlasrRadius == \"High\" or ActivityInsights.FirstTimeUserPerformedAction == true\r\n        )\r\n        on $left._ItemId == $right.SourceRecordId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName) \r\n    | extend AnomalyName = \"Anomalous Account Manipulation\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Account Manipulation\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may manipulate accounts to maintain access to victim systems. These actions include adding new accounts to high privilleged groups. Dragonfly 2.0, for example, added newly created accounts to the administrators group to maintain elevated access. The query below generates an output of all high Blast Radius users performing 'Update user' (name change) to priveleged role, or ones that changed users for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, RoleName, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; let AnomalousAADAccountCreation = BehaviorAnalytics\r\n    | where ActionType == \"Add user\"\r\n    | where ActivityInsights.FirstTimeUserPerformedAction == True or ActivityInsights.FirstTimeActionPerformedInTenant == True or ActivityInsights.ActionUncommonlyPerformedAmongPeers == true\r\n    | join(\r\n        AuditLogs\r\n        | where OperationName == \"Add user\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | mv-expand TargetResources\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | extend DisplayName = tostring(UsersInsights.AccountDisplayName),\r\n        UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Account Creation\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Create Account\",\r\n        SubTechnique = \"Cloud Account\",\r\n        Description = \"Adversaries may create a cloud account to maintain access to victim systems. With a sufficient level of access, such accounts may be used to establish secondary credentialed access that does not require persistent remote access tools to be deployed on the system. The query below generates an output of all the users performing user creation for the first time and the target users that were created.\"\t\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority\r\n    | sort by TimeGenerated desc;\r\nlet AnomalyTable = union kind=outer AnomalousSigninActivity, AnomalousRoleAssignment, AnomalousResourceAccess, AnomalousRDPActivity, AnomalousPasswordReset, AnomalousLogintoDevices, AnomalousGeoLocationLogon, AnomalousAADAccountManipulation, AnomalousAADAccountCreation, AnomalousFailedLogon;\r\nlet TopUsersByAnomalies = AnomalyTable\r\n    | summarize hint.strategy = shuffle AnomalyCount=count() by UserName, UserPrincipalName, tostring(UsersInsights.OnPremSid), tostring(UsersInsights.AccountObjectId)\r\n    | project Name=tolower(UserName), UPN=tolower(UserPrincipalName), AadUserId=UsersInsights_AccountObjectId, Sid=UsersInsights_OnPremSid, AnomalyCount\r\n    | sort by AnomalyCount desc;\r\nlet TopUsersByIncidents = SecurityIncident\r\n    | summarize hint.strategy = shuffle arg_max(LastModifiedTime, *) by IncidentNumber\r\n    | where Status == \"New\" or Status == \"Active\"\r\n    | mv-expand AlertIds\r\n    | extend AlertId = tostring(AlertIds)\r\n    | join kind= innerunique ( \r\n        SecurityAlert \r\n        )\r\n        on $left.AlertId == $right.SystemAlertId\r\n    | summarize hint.strategy = shuffle arg_max(TimeGenerated, *), NumberOfUpdates = count() by SystemAlertId\r\n    | mv-expand todynamic(Entities)\r\n    | where Entities[\"Type\"] =~ \"account\"\r\n    | extend Name = tostring(tolower(Entities[\"Name\"])), NTDomain = tostring(Entities[\"NTDomain\"]), UPNSuffix = tostring(Entities[\"UPNSuffix\"]), AadUserId = tostring(Entities[\"AadUserId\"]), AadTenantId = tostring(Entities[\"AadTenantId\"]), \r\n        Sid = tostring(Entities[\"Sid\"]), IsDomainJoined = tobool(Entities[\"IsDomainJoined\"]), Host = tostring(Entities[\"Host\"])\r\n    | extend UPN = iff(Name != \"\" and UPNSuffix != \"\", strcat(Name, \"@\", UPNSuffix), \"\")\r\n    | union TopUsersByAnomalies\r\n    | extend \r\n        AadPivot = iff(isempty(AadUserId), iff(isempty(Sid), Name, Sid), AadUserId),\r\n        SidPivot = iff(isempty(Sid), iff(isempty(AadUserId), Name, AadUserId), Sid),\r\n        UPNExists = iff(isempty(UPN), false, true),\r\n        NameExists = iff(isempty(Name), false, true),\r\n        SidExists = iff(isempty(Sid), false, true),\r\n        AADExists = iff(isempty(AadUserId), false, true)\r\n    | summarize hint.strategy = shuffle IncidentCount=dcount(IncidentNumber, 4), AlertCount=dcountif(AlertId, isnotempty(AlertId), 4), AnomalyCount=sum(AnomalyCount), any(Title, Severity, Status, StartTime, IncidentNumber, IncidentUrl, Owner), UPNAnchor=anyif(UPN, UPNExists == true), NameAnchor=anyif(Name, NameExists == true), AadAnchor=anyif(AadUserId, AADExists == true), SidAnchor=anyif(Sid, SidExists == true), any(SidPivot) by AadPivot\r\n    | summarize hint.strategy = shuffle IncidentCount=sum(IncidentCount), AlertCount=sum(AlertCount), AnomalyCount=sum(AnomalyCount), UPNAnchor=anyif(UPNAnchor, isempty(UPNAnchor) == false), NameAnchor=anyif(NameAnchor, isempty(NameAnchor) == false), AadAnchor=anyif(AadAnchor, isempty(AadAnchor) == false), SidAnchor=anyif(SidAnchor, isempty(SidAnchor) == false), any(any_Title, any_Severity, any_StartTime, any_IncidentNumber, any_IncidentUrl) by any_SidPivot\r\n    | summarize hint.strategy = shuffle IncidentCount=sum(IncidentCount), AlertCount=sum(AlertCount), AnomalyCount=sum(AnomalyCount), UPNAnchor=anyif(UPNAnchor, isempty(UPNAnchor) == false), AadAnchor=anyif(AadAnchor, isempty(AadAnchor) == false), SidAnchor=anyif(SidAnchor, isempty(SidAnchor) == false), any(any_any_Title, any_any_Severity, any_any_StartTime, any_any_IncidentNumber, any_any_IncidentUrl) by NameAnchor\r\n    | project [\"UserName\"]=NameAnchor, IncidentCount, AlertCount, AnomalyCount, [\"AadUserId\"]=AadAnchor, [\"OnPremSid\"]=SidAnchor, [\"UserPrincipalName\"]=UPNAnchor;\r\nTopUsersByIncidents\r\n| where UserPrincipalName <> \"\"\r\n| where UserPrincipalName !contains \"[\"\r\n| project UserPrincipalName, IncidentCount, AlertCount, AnomalyCount\r\n| sort by AlertCount desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " User Entity Behavior Analytics (UEBA)",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.  ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "AlertCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        },
                        {
                          "columnMatch": "AnomalyCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellow"
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_AlertCount_2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_AlertCount_2",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "SigninStatus",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 9,
                        "formatOptions": {
                          "palette": "green"
                        }
                      },
                      "showBorder": false
                    },
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "Location",
                      "latitude": "SourceIPLocation",
                      "longitude": "SourceIPLocation",
                      "sizeSettings": "Location",
                      "sizeAggregation": "Count",
                      "legendMetric": "Location",
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "Location",
                        "colorAggregation": "Count",
                        "type": "thresholds",
                        "thresholdsGrid": [
                          {
                            "operator": "Default",
                            "thresholdValue": null,
                            "representation": "blueDark"
                          }
                        ]
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityAlert\r\n| where ProviderName == \"IPC\"\r\n| extend UserAccount = tostring(parse_json(ExtendedProperties).[\"User Account\"])\r\n| summarize count() by AlertName, AlertLink, ProductName, UserAccount\r\n| extend Count = count_\r\n| project AlertName, Count\r\n| sort by Count desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Entra ID Identity Protection: Security Alerts ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isLT2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "LT-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Enable Logging for Security Investigation (LT-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-3-enable-logging-for-security-investigation)\r\n\r\nEnable logging for your cloud resources to meet the requirements for security incident investigations and security response and compliance purposes.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Usage](https://docs.microsoft.com/azure/azure-monitor/reference/tables/usage) ‚ú≥Ô∏è [Azure Monitor](https://azure.microsoft.com/services/monitor/)<br> \r\n\r\n## Implementation\r\nüí° [Understand Logging and Different Log Types in Azure](https://docs.microsoft.com/azure/azure-monitor/essentials/platform-logs-overview)<br>\r\nüí° [Understand Microsoft Defender for Cloud Data Collection](https://docs.microsoft.com/azure/security-center/security-center-enable-data-collection)<br>\r\nüí° [Enable and configure antimalware monitoring](https://docs.microsoft.com/azure/security/fundamentals/antimalware#enable-and-configure-antimalware-monitoring-using-powershell-cmdlets)<br>\r\nüí° [Operating systems and application logs inside in your compute resources](https://learn.microsoft.com/en-us/azure/azure-monitor/data-sources#operating-system-guest)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br>"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "LT-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"LT.3\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource = Table_Name *\r\n| summarize count() by Table_Name\r\n| project-rename Log_Tables=Table_Name, Logs_Count=count_\r\n| sort by Logs_Count desc\r\n| limit 100\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Logs Count by Data Table",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "Log_Tables",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Logs_Count",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isLT3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "LT-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Enable Network Logging for Security Investigation (LT-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-4-enable-network-logging-for-security-investigation)\r\n\r\nEnable logging for your network services to support network-related incident investigations, threat hunting, and security alert generation. The network logs may include logs from network services such as IP filtering, network and application firewall, DNS, flow monitoring and so on. \r\n\r\n## Recommended Logs\r\nüî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) ‚ú≥Ô∏è [Azure Web Application Firewall]( https://azure.microsoft.com/services/web-application-firewall/) ‚ú≥Ô∏è [Application Gateway]( https://azure.microsoft.com/services/application-gateway/)<br>\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br>\r\n\r\n## Implementation\r\nüí° [How to Enable Network Security Group Flow Logs](https://docs.microsoft.com/azure/network-watcher/network-watcher-nsg-flow-logging-portal)<br>\r\nüí° [Azure Firewall Logs and Metrics](https://docs.microsoft.com/azure/firewall/logs-and-metrics)<br>\r\nüí° [Azure Networking Monitoring Solutions in Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/insights/azure-networking-analytics)<br>\r\nüí° [Gather Insights About Your DNS Infrastructure With the DNS Analytics Solution](https://docs.microsoft.com/azure/azure-monitor/insights/dns-analytics)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FazureFirewalls) <br>\r\nüîÄ [Azure Web Application Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FFrontDoorWebApplicationFirewallPolicies) <br>\r\nüîÄ [Network Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FNetworkSecurityGroups) <br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks) <br>\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isLTVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "LT-4"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"microsoft.network\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Networking Assets",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where OperationName == \"NetworkSecurityGroupEvents\"\r\n| summarize count() by ruleName_s\r\n| sort by count_ desc \r\n| render piechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Network Security Groups: Rules Triggered",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where OperationName == \"NetworkSecurityGroupEvents\"\r\n| extend NetworkMap=strcat(\"NetworkMap\")\r\n| summarize count() by ruleName_s, NetworkMap\r\n| project NetworkSecurityGroupRule=ruleName_s, FlowCount=count_, NetworkMap\r\n| sort by FlowCount desc ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Network Map & Flow Counts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "NetworkSecurityGroupRule",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Lateral_Movement",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "FlowCount",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "NetworkMap",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Network  Map >>",
                            "bladeOpenContext": {
                              "bladeName": "NetworkMapBlade",
                              "extensionName": "Microsoft_Azure_Security_R3",
                              "bladeParameters": []
                            }
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isLT4Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "LT-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Centralize Security Log Management & Analysis (LT-5)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-5-centralize-security-log-management-and-analysis)\r\n\r\nCentralize logging storage and analysis to enable correlation across log data. For each log source, ensure that you have assigned a data owner, access guidance, storage location, what tools are used to process and access the data, and data retention requirements. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Usage](https://docs.microsoft.com/azure/azure-monitor/reference/tables/usage) ‚ú≥Ô∏è [Azure Monitor](https://azure.microsoft.com/services/monitor/) <br> \r\n\r\n## Implementation\r\nüí° [How to Collect Platform Logs and Metrics with Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/essentials/diagnostic-settings)<br>\r\nüí° [How to Onboard Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/quickstart-onboard)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isLTVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "LT-5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"LT.5\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource=_TableName *\r\n| summarize Entries = count(), Size = sum(_BilledSize), last_log = datetime_diff(\"second\",now(), max(TimeGenerated)), estimate  = sumif(_BilledSize, _IsBillable==true)  by _TableName, _IsBillable\r\n| project ['Table Name'] = _TableName, ['Table Size'] = Size, ['Table Entries'] = Entries,\r\n          ['Size per Entry'] = 1.0 * Size / Entries, ['IsBillable'] = _IsBillable\r\n| order by ['Table Size']  desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Log Table Management",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Entries",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "turquoise"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Size per Entry",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "IsBillable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Important",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_thresholds_IsBillable_4",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_IsBillable_4",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "DataType",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource=_TableName *\r\n| summarize count() , Size = sum(_BilledSize) by bin(_TimeReceived, 1m), Type, _IsBillable\r\n| extend counttemp =count_ / 60\r\n| summarize \r\n           ['Current EPS Average']=avg(counttemp), ['Minimum EPS']=min(counttemp),\r\n           ['Maximum EPS']=max(counttemp)\r\n  by ['Table Name']=Type\r\n| order  by ['Current EPS Average'] desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Log Table Events Per Second (EPS) Management",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Current EPS Average",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blueDark"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "Minimum EPS",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "red"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "Maximum EPS",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "green"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Entries",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "turquoise"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Size per Entry",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "IsBillable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Important",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_Current EPS Average_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_Current EPS Average_1",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "DataType",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isLT5Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "LT-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Configure Log Storage Retention (LT-6)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-6-configure-log-storage-retention)\r\n\r\nPlan your log retention strategy according to your compliance, regulation, and business requirements. Configure the log retention policy at the individual logging services to ensure the logs are archived appropriately.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br>\r\n\r\n## Implementation\r\nüí° [Change the Data Retention Period in Log Analytics](https://docs.microsoft.com/azure/azure-monitor/logs/manage-cost-storage#change-the-data-retention-period)<br>\r\nüí° [How to Configure Retention Policy for Azure Storage Account Logs](https://docs.microsoft.com/azure/storage/common/manage-storage-analytics-logs#configure-logging)<br>\r\nüí° [Microsoft Defender for Cloud Alerts and Recommendations Export](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br>\r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isLTVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "LT-6"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"LT.6\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| extend state = trim(' ', tostring(properties.provisioningState))\r\n\t\t,sku   = trim(' ', tostring(properties.sku.name))\r\n        ,skuUpdate = trim(' ', tostring(properties.sku.lastSkuUpdate))\r\n\t\t,retentionDays = trim(' ', tostring(properties.retentionInDays))\r\n\t\t,dailyquotaGB  = trim(' ', tostring(properties.workspaceCapping.dailyQuotaGb))\r\n| extend dailyquotaGB = iif(dailyquotaGB !=-1.0, dailyquotaGB,\"Not set\")\r\n| extend skuUpdate    = iif(strlen(skuUpdate) > 0, skuUpdate,\"Unknown\")\r\n| extend sentinel     = iif(toint(retentionDays) < 90,\"If you have Sentinel, you can change your retention to 90days (free)?\",\"\")\r\n| project ['Workspace Name']=id, ['Data Retention(days)']=retentionDays, ['Daily Data Cap']=dailyquotaGB, ['Resource Group']=resourceGroup, location, ['License']=sku",
                    "size": 2,
                    "showAnalytics": true,
                    "title": " Log Retention Configurations",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 16,
                          "formatOptions": {
                            "showIcon": true
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_link_Workspace Name_0",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_link_Workspace Name_0",
                        "sortOrder": 1
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "type",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isLT6Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "LT-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Use Approved Time Synchronization Sources (LT-7)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-7-use-approved-time-synchronization-sources)\r\n\r\nUse approved time synchronization sources for your logging time stamp which include date, time and time zone information.\r\n\r\n## Recommended Logs\r\nüî∑ [_Im_NetworkSession](https://docs.microsoft.com/azure/sentinel/network-normalization-schema) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n## Implementation\r\nüí° [How to Configure Time Synchronization for Azure Windows Compute Resources](https://docs.microsoft.com/azure/virtual-machines/windows/time-sync)<br>\r\nüí° [How to Configure Time Synchronization for Azure Linux Compute Resources](https://docs.microsoft.com/azure/virtual-machines/linux/time-sync)<br>\r\nüí° [How to Disable Inbound UDP for Azure Services](https://support.microsoft.com/help/4558520/how-to-disable-inbound-udp-for-azure-services)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Entra ID Domain Services](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.AAD%2FdomainServices) <br>\r\nüîÄ [Virtual Machines](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Compute%2FVirtualMachines) <br>\r\nüîÄ [Azure Policy](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isLTVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "LT-7"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "_Im_NetworkSession\r\n| where NetworkProtocol == \"UDP\"\r\n| where NetworkDirection == \"outbound\"\r\n| where DstPortNumber == \"123\"\r\n| summarize count() by DstIpAddr\r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Network Time Protocol Calls by Destination IP",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isLT7Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "LT-7",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isLTVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Logging & Threat Detection Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Incident Response (IR)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response)\r\n---\r\nIncident Response covers controls in incident response life cycle - preparation, detection and analysis, containment, and post-incident activities, including using Azure services such as Microsoft Defender for Cloud and Sentinel to automate the incident response process. "
            },
            "customWidth": "40",
            "name": "IR Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "text - 9"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Update Incident Response Plan (IR-1)\\\", \\\"tab\\\": \\\"IR1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Setup Incident Notification (IR-2)\\\", \\\"tab\\\": \\\"IR2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Create Incidents Based in Alerts (IR-3)\\\", \\\"tab\\\": \\\"IR3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Investigate an Incident (IR-4)\\\", \\\"tab\\\": \\\"IR4\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isIR1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "IR1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "fe9f6742-6af1-4434-9bbc-3aa855136070",
                  "version": "KqlParameterItem/1.0",
                  "name": "isIR2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "IR2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "8f0c3fdc-2da1-482b-962f-8b81f2edc636",
                  "version": "KqlParameterItem/1.0",
                  "name": "isIR3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "IR3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "b16aea45-a93f-4278-add1-33a0d763920d",
                  "version": "KqlParameterItem/1.0",
                  "name": "isIR4Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "IR4",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Prioritize Incidents (IR-5)\\\", \\\"tab\\\": \\\"IR5\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Automate Incident Handling (IR-6)\\\", \\\"tab\\\": \\\"IR6\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Conduct Lessons Learned & Retain Evidence (IR-7)\\\", \\\"tab\\\": \\\"IR7\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "6ee1efad-6ae5-4c5b-9ecf-29c52d5999e1",
                  "version": "KqlParameterItem/1.0",
                  "name": "isIR5Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "IR5",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "5bc1802f-413f-426c-b292-074f215308e6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isIR6Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "IR6",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "11afdb83-5ddc-446a-832f-91dc11c06125",
                  "version": "KqlParameterItem/1.0",
                  "name": "isIR7Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "IR7",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Preparation - Update Incident Response Plan & Handling Process (IR-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-1-preparation---update-incident-response-plan-and-handling-process)\r\n\r\nEnsure your organization follows industry best practice to develop processes and plans to respond to security incidents on the cloud platforms. Be mindful about the shared responsibility model and the variances across IaaS, PaaS and SaaS services. This will have a direct impact to how you collaborate with your cloud provider in incident response and handling activities, such as incident notification and triage, evidence collection, investigation, eradication and recovery.\r\n\r\n## Implementation\r\nüí° [Implement Security Across the Enterprise Environment](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#3-process-assign-accountability-for-cloud-security-decisions)<br>\r\nüí° [Incident Response Reference Guide](https://docs.microsoft.com/microsoft-365/downloads/IR-Reference-Guide.pdf)<br>\r\nüí° [NIST SP 800-61 Computer Security Incident Handling Guide](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>"
                        },
                        "name": "IR-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Building Your Own Security Incident Response Process](https://msrc-blog.microsoft.com/2019/07/01/inside-the-msrc-building-your-own-security-incident-response-process/) \r\n![Image Name](https://msrc.microsoft.com/blog/2019/07/inside-the-msrc-building-your-own-security-incident-response-process/wp-content-uploads-2019-07-SSIRP-best-practices-headers_hu72b36f1b90d60f19ba86700a50132f62_74722_800x0_resize_q75_box.jpg)\r\n\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "text - 5"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isIR1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "IR-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Preparation - Setup Incident Notification (IR-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-2-preparation---setup-incident-notification)\r\n\r\nEnsure the security alerts and incident notification from the cloud service provider's platform and your environments can be received by correct contact in your incident response organization.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n## Implementation\r\nüí° [How to Set the Microsoft Defender for Cloud Security Contact](https://docs.microsoft.com/azure/security-center/security-center-provide-security-contact-details)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Logic Apps](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Logic%2Fworkflows) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIRVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IR-2"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"IR.2\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n|¬†where¬†type¬†==¬†\"microsoft.logic/workflows\"\r\n|¬†extend¬†Connection¬†=¬†parse_json(properties)[\"parameters\"][\"$connections\"][\"value\"]\r\n|¬†where¬†Connection¬†has¬†\"managedApis/azuresentinel\"\r\n| where id contains \"push\" or id contains \"send\" or id contains \"message\" or id contains \"text\" or id contains \"email\" or id contains \"notif\" or id contains \"team\" or id contains \"post\"\r\n| project id, type, resourceGroup",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Microsoft Sentinel (SOAR) Notification Playbooks Configured",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationNameValue startswith \"Microsoft.Logic\"\r\n| where ActivityStatusValue == \"Success\" or ActivityStatusValue == \"Succeeded\"\r\n| extend scope_ = tostring(Authorization_d.scope)\r\n| parse-where scope_ with * 'workflows/' PlaybookName '/' *\r\n| where PlaybookName contains \"notify\" or PlaybookName contains \"email\" or PlaybookName contains \"teams\" or PlaybookName contains \"ticket\" or PlaybookName contains \"post\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by PlaybookName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Microsoft Sentinel (SOAR) Notification Playbooks Triggered over Time",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5 - Copy",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isIR2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "IR-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Detection & Analysis - Create Incidents Based on High-Quality Alerts (IR-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-3-detection-and-analysis---create-incidents-based-on-high-quality-alerts)\r\n\r\nEnsure you have a process to create high-quality alerts and measure the quality of alerts. This allows you to learn lessons from past incidents and prioritize alerts for analysts, so they don't waste time on false positives.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n## Implementation\r\nüí° [How to Configure Export](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\nüí° [How to Stream Alerts Into Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/connect-azure-security-center)<br>\r\nüí° [Understand Security Coverage by the MITRE ATT&CK¬Æ Framework](https://docs.microsoft.com/azure/sentinel/mitre-coverage)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIRVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IR-3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"IR.3\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    }
                  },
                  "name": "query - 3"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "521d368e-c46e-41b5-bea0-fd07dc96b511",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Review Current MITRE Coverage >>",
                        "style": "secondary",
                        "bladeOpenContext": {
                          "bladeName": "MitrePage.ReactView",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": []
                        }
                      }
                    ]
                  },
                  "name": "links - 8"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isIR3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "IR-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Detection & Analysis - Investigate an Incident (IR-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-4-detection-and-analysis---investigate-an-incident)\r\n\r\nEnsure security operation team can query and use diverse data sources as they investigate potential incidents, to build a full view of what happened. Diverse logs should be collected to track the activities of a potential attacker across the kill chain to avoid blind spots. You should also ensure insights and learnings are captured for other analysts and for future historical reference.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n## Implementation\r\nüí° [Snapshot a Windows Machine's Disk](https://docs.microsoft.com/azure/virtual-machines/windows/snapshot-copy-managed-disk)<br>\r\nüí° [Snapshot a Linux Machine's Disk](https://docs.microsoft.com/azure/virtual-machines/linux/snapshot-copy-managed-disk)<br>\r\nüí° [Microsoft Azure Support Diagnostic Information and Memory Dump Collection](https://azure.microsoft.com/support/legal/support-diagnostic-information-collection/)<br>\r\nüí° [Investigate Incidents with Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/tutorial-investigate-cases)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIRVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IR-4"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident¬†\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| where Severity == \"High\"\r\n| summarize count() by [\"Incident Name\"]=Title\r\n| sort by count_ desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "High Severity Incident Types",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": ""
                          }
                        },
                        {
                          "columnMatch": "ComplianceDomain",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Persistence",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "locInfoColumn": "Location",
                      "latitude": "latitude_",
                      "longitude": "longitude_",
                      "sizeSettings": "city_",
                      "sizeAggregation": "Count",
                      "labelSettings": "city_",
                      "legendMetric": "city_",
                      "numberOfMetrics": 100,
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "state_",
                        "colorAggregation": "Count",
                        "type": "heatmap",
                        "heatmapPalette": "coldHot"
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 9"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident¬†\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| extend [\"MITRE ATT&CK¬Æ Tactics\"] = tostring(parse_json(tostring(AdditionalData.tactics))[0])\r\n| where [\"MITRE ATT&CK¬Æ Tactics\"] <> \"\"\r\n| summarize count() by [\"MITRE ATT&CK¬Æ Tactics\"]\r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "MITRE ATT&CK¬ÆTactics Observed",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": ""
                          }
                        },
                        {
                          "columnMatch": "ComplianceDomain",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Persistence",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "InitialAccess",
                          "color": "orange"
                        },
                        {
                          "seriesName": "Exfiltration",
                          "color": "orange"
                        },
                        {
                          "seriesName": "Execution",
                          "color": "orange"
                        },
                        {
                          "seriesName": "PrivilegeEscalation",
                          "color": "orange"
                        },
                        {
                          "seriesName": "Persistence",
                          "color": "orange"
                        },
                        {
                          "seriesName": "DefenseEvasion",
                          "color": "orange"
                        },
                        {
                          "seriesName": "CredentialAccess",
                          "color": "orange"
                        },
                        {
                          "seriesName": "Discovery",
                          "color": "orange"
                        },
                        {
                          "seriesName": "Collection",
                          "color": "orange"
                        },
                        {
                          "seriesName": "Impact",
                          "color": "orange"
                        },
                        {
                          "seriesName": "Other",
                          "color": "orange"
                        }
                      ]
                    },
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "locInfoColumn": "Location",
                      "latitude": "latitude_",
                      "longitude": "longitude_",
                      "sizeSettings": "city_",
                      "sizeAggregation": "Count",
                      "labelSettings": "city_",
                      "legendMetric": "city_",
                      "numberOfMetrics": 100,
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "state_",
                        "colorAggregation": "Count",
                        "type": "heatmap",
                        "heatmapPalette": "coldHot"
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 9"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Investigate Incidents with Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/tutorial-investigate-cases) \r\n![Image Name](https://docs.microsoft.com/azure/sentinel/media/tutorial-investigate-cases/investigation-map.png)\r\n\r\n"
                  },
                  "customWidth": "50",
                  "name": "text - 5"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isIR4Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "IR-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Detection & Analysis - Prioritize Incidents (IR-5)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-5-detection-and-analysis---prioritize-incidents)\r\n\r\nProvide context to security operations teams to help them determine which incidents ought to first be focused on, based on alert severity and asset sensitivity defined in your organization‚Äôs incident response plan. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br>\r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n## Implementation\r\nüí° [Security Alerts in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/security-center-alerts-overview)<br>\r\nüí° [Use Tags to Organize Your Azure Resources](https://docs.microsoft.com/azure/azure-resource-manager/management/tag-resources)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) "
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIRVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IR-5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| where Status <> \"Closed\"\r\n| summarize count() by Severity\r\n| render barchart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Open Incidents by Priority",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Low",
                          "color": "yellow"
                        },
                        {
                          "seriesName": "Medium",
                          "color": "orange"
                        },
                        {
                          "seriesName": "High",
                          "color": "red"
                        },
                        {
                          "seriesName": "Informational",
                          "color": "gray"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": " Open Incidents by Priority",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Severity\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Security Incident Severity Count over Time",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Low",
                          "color": "yellow"
                        },
                        {
                          "seriesName": "Medium",
                          "color": "orange"
                        },
                        {
                          "seriesName": "High",
                          "color": "red"
                        },
                        {
                          "seriesName": "Informational",
                          "color": "gray"
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Security Incident Priorities over Time"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isIR5Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "IR-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Containment, Eradication & Recovery - Automate Incident Handling (IR-6)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-6-containment-eradication-and-recovery---automate-the-incident-handling)\r\n\r\nAutomate the manual, repetitive tasks to speed up response time and reduce the burden on analysts. Manual tasks take longer to execute, slowing each incident and reducing how many incidents an analyst can handle. Manual tasks also increase analyst fatigue, which increases the risk of human error that causes delays and degrades the ability of analysts to focus effectively on complex tasks. \r\n\r\n## Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> üî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n## Implementation\r\nüí° [Configure Workflow Automation in Security Center](https://docs.microsoft.com/azure/security-center/workflow-automation)<br>\r\nüí° [Setup Automated Threat Responses in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/tutorial-security-incident#triage-security-alerts)<br>\r\nüí° [Setup Automated Threat Responses in Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/tutorial-respond-threats-playbook)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Logic Apps](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Logic%2Fworkflows) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIRVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IR-6"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n|¬†where¬†type¬†==¬†\"microsoft.logic/workflows\"\r\n|¬†extend¬†Connection¬†=¬†parse_json(properties)[\"parameters\"][\"$connections\"][\"value\"]\r\n|¬†where¬†Connection¬†has¬†\"managedApis/azuresentinel\"\r\n| project id, type, resourceGroup",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Microsoft Sentinel (SOAR) Playbooks Configured",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationNameValue startswith \"Microsoft.Logic\"\r\n| where ActivityStatusValue == \"Success\" or ActivityStatusValue == \"Succeeded\"\r\n| extend scope_ = tostring(Authorization_d.scope)\r\n| parse-where scope_ with * 'workflows/' PlaybookName '/' *\r\n| where PlaybookName contains \"notify\" or PlaybookName contains \"email\" or PlaybookName contains \"teams\" or PlaybookName contains \"ticket\" or PlaybookName contains \"post\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by PlaybookName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Microsoft Sentinel (SOAR) Playbooks Triggered over Time",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Resource",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isIR6Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "IR-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Post-Incident Activity - Conduct Lessons Learned & Retain Evidence (IR-7)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-7-post-incident-activity---conduct-lesson-learned-and-retain-evidence)\r\n\r\nConduct lesson learned in your organization periodically and/or after major incidents, to improve your future capability in incident response and handling. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n## Implementation\r\nüí° [Incident Response Process - Post-Incident Cleanup](https://docs.microsoft.com/security/compass/incident-response-process#2-post-incident-cleanup)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIRVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IR-7"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Incident Response/Resolution Times",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityIncident\n| extend Tactics = todynamic(AdditionalData.tactics)\n| extend Owner = todynamic(Owner.assignedTo) \n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \n| extend TimeToTriage =  (FirstModifiedTime - CreatedTime)/1h\n| where TimeToTriage <> 0\n| summarize 50th_Percentile=percentile(TimeToTriage, 50) \n",
                          "size": 1,
                          "showAnalytics": true,
                          "title": "Mean Time To Respond",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "50th_Percentile",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 26,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "maximumFractionDigits": 3
                                }
                              }
                            },
                            "showBorder": false,
                            "size": "auto"
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityIncident\n| where Status == \"Closed\"\n| summarize arg_max(TimeGenerated,*) by IncidentNumber\n| extend Tactics = todynamic(AdditionalData.tactics)\n| extend Owner = todynamic(Owner.assignedTo) \n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0]))  \n| extend TimeToClosure =  (ClosedTime - CreatedTime)/1h\n| where TimeToClosure <> 0\n| summarize 50th_Percentile=percentile(TimeToClosure, 50)",
                          "size": 1,
                          "showAnalytics": true,
                          "title": "Mean Time To Resolve",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Classification",
                              "formatter": 1,
                              "formatOptions": {}
                            },
                            "leftContent": {
                              "columnMatch": "50th_Percentile",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 26,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "maximumFractionDigits": 3
                                }
                              }
                            },
                            "showBorder": false,
                            "size": "auto"
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 2"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "Incident Response/Resolution Times"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber\r\n| where Status == \"Closed\"\r\n| extend TimeToRespond =  (CreatedTime - FirstActivityTime)/1d \r\n| extend TimeToResolve =  (ClosedTime - CreatedTime)/1d\r\n| extend AssignedAnalyst = tostring(Owner.assignedTo)\r\n| extend [\"MITRE ATT&CK Tactics\"] = tostring(parse_json(tostring(AdditionalData.tactics))[0])\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, ClosedTime desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, [\"MITRE ATT&CK Tactics\"], AssignedAnalyst, Classification, ClassificationComment, ClassificationReason, Description, TimeToRespond, TimeToResolve, IncidentStartTime=CreatedTime, IncidentClosedTime=ClosedTime, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Incident Closure Reports",
                    "noDataMessage": "No Incidents Observed Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Go to Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "TimeToRespond",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 27,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "TimeToResolve",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 27,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "locInfoColumn": "Location",
                      "latitude": "latitude_",
                      "longitude": "longitude_",
                      "sizeSettings": "city_",
                      "sizeAggregation": "Count",
                      "labelSettings": "city_",
                      "legendMetric": "city_",
                      "numberOfMetrics": 100,
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "state_",
                        "colorAggregation": "Count",
                        "type": "heatmap",
                        "heatmapPalette": "coldHot"
                      }
                    }
                  },
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isIR7Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "IR-7",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isIRVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Incident Response Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Posture & Vulnerability Management (PV)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management)\r\n---\r\nPosture and Vulnerability Management focuses on controls for assessing and improving Azure security posture, including vulnerability scanning, penetration testing and remediation, as well as security configuration tracking, reporting, and correction in Azure resources. "
            },
            "customWidth": "40",
            "name": "PV Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "text - 11"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Define & Establish Secure Configurations (PV-1)\\\", \\\"tab\\\": \\\"PV1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Audit & Enforce Secure Configurations (PV-2)\\\", \\\"tab\\\": \\\"PV2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Define & Establish Secure Configurations for Compute Resources (PV-3)\\\", \\\"tab\\\": \\\"PV3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Audit & Enforce Secure Configurations for Compute Resources (PV-4)\\\", \\\"tab\\\": \\\"PV4\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isPV1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PV1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isPV2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PV2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "88da2310-858d-4451-a58a-ce067a466f15"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isPV3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PV3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "e00258ef-49b5-4ac0-82d2-c67148d616d9"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isPV4Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PV4",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "9dfe4f44-10f2-4eb2-a98c-abd4a36b69a8"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Perform Vulnerability Assessments (PV-5)\\\", \\\"tab\\\": \\\"PV5\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Rapidly & Automatically Remediate Vulnerabilities (PV-6)\\\", \\\"tab\\\": \\\"PV6\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Conduct Regular Red Team Operations (PV-7)\\\", \\\"tab\\\": \\\"PV7\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "c12c9953-b31b-4d5d-b39d-8142caaa046b",
                  "version": "KqlParameterItem/1.0",
                  "name": "isPV5Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PV5",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "69a28041-108a-4881-bd8d-aabaa851fab6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isPV6Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PV6",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "7eec1f60-b3eb-45ea-81f5-64feb69dfb96",
                  "version": "KqlParameterItem/1.0",
                  "name": "isPV7Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "PV7",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Define & Establish Secure Configurations (PV-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-1-define-and-establish-secure-configurations)\r\n\r\nDefine the secure configuration baselines for different resource types in the cloud. Alternatively, use configuration management tools to establish the configuration baseline automatically before or during resource deployment so the environment can be compliant by default after the deployment.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Illustration of Guardrails Implementation in Enterprise-Scale Landing Zone](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/architecture#landing-zone-expanded-definition)<br>\r\nüí° [Working with Security Policies in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/tutorial-security-policy)<br>\r\nüí° [Tutorial: Create and manage policies to enforce compliance](https://docs.microsoft.com/azure/governance/policy/tutorials/create-and-manage)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Azure Policy](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview)<br>\r\nüîÄ [Microsoft Defender for Cloud: Regulatory Compliance](https://ms.portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPVVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PV-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| summarize count() by ComplianceStandard\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Regulatory Compliance Assessments by Standard Policy Checks",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.  ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPV1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PV-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Audit & Enforce Secure Configurations (PV-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-2-audit-and-enforce-secure-configurations)\r\n\r\nContinuously monitor and alert when there is a deviation from the defined configuration baseline. Enforce the desired configuration according to the baseline configuration by denying the non-compliant configuration or deploy a configuration. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Understand Azure Policy Effects](https://docs.microsoft.com/azure/governance/policy/concepts/effects)<br>\r\nüí° [Create and Manage Policies to Enforce Compliance](https://docs.microsoft.com/azure/governance/policy/tutorials/create-and-manage)<br>\r\nüí° [Get compliance data of Azure resources](https://docs.microsoft.com/azure/governance/policy/how-to/get-compliance-data)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPVVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PV-2"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"PV.2\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPV2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PV-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Define & Establish Secure Configurations for Compute Resources (PV-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-3-define-and-establish-secure-configurations-for-compute-resources)\r\n\r\nDefine the secure configuration baselines for your compute resources, such as VMs and containers. Use configuration management tools to establish the configuration baseline automatically before or during the compute resource deployment so the environment can be compliant by default after the deployment. Alternatively, use a pre-configured image to build the desired configuration baseline into the compute resource image template. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityBaselines](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securitybaseline) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br>  \r\n\r\n## Implementation\r\nüí° [Apply Azure security baselines to machines](https://docs.microsoft.com/azure/defender-for-cloud/apply-security-baseline)<br>\r\nüí° [Linux OS security configuration baseline](https://docs.microsoft.com/azure/governance/policy/samples/guest-configuration-baseline-linux)<br>\r\nüí° [Windows OS security configuration baseline](https://docs.microsoft.com/azure/governance/policy/samples/guest-configuration-baseline-windows)<br>\r\nüí° [Security configuration recommendation for compute resources](https://docs.microsoft.com/azure/security-center/recommendations-reference)<br>\r\nüí° [Azure Automation State Configuration Overview](https://docs.microsoft.com/azure/automation/automation-dsc-overview)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud: Recommendations](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/5)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPVVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PV-3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let FailedAssets=SecurityBaseline\r\n| summarize arg_max(TimeGenerated, *) by _ResourceId, Description\r\n| where AnalyzeResult == \"Failed\"\r\n| summarize FailedAssets = makelist(Computer) by Description;\r\nlet PassedAssets=SecurityBaseline\r\n| summarize arg_max(TimeGenerated, *) by _ResourceId, Description\r\n| where AnalyzeResult == \"Passed\"\r\n| summarize PassedAssets = makelist(Computer) by Description;\r\nSecurityBaseline\r\n| summarize arg_max(TimeGenerated, *) by _ResourceId, Description\r\n| summarize\r\n    Failed‚ÄØ=‚ÄØcountif(AnalyzeResult == \"Failed\"),\r\n    Passed‚ÄØ=‚ÄØcountif(AnalyzeResult == \"Passed\"),\r\n    Total‚ÄØ=‚ÄØcountif(AnalyzeResult == \"Failed\" or AnalyzeResult == \"Passed\")\r\n    by Description\r\n| extend PassedControls‚ÄØ= (Passed / todouble(Total)) * 100\r\n| join kind=fullouter(FailedAssets) on Description\r\n| join kind=fullouter(PassedAssets) on Description\r\n| project Description, Total, PassedControls, Passed, Failed, PassedAssets, FailedAssets\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Configure Security Baselines",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Description",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ControlNumber",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "AllServices",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationState",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "!=",
                                "thresholdValue": "Healthy",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPV3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PV-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Audit & Enforce Secure Configurations for Compute Resources (PV-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-4-audit-and-enforce-secure-configurations-for-compute-resources)\r\n\r\nContinuously monitor and alert when there is a deviation from the defined configuration baseline in your compute resources. Enforce the desired configuration according to the baseline configuration by denying the non-compliant configuration or deploy a configuration in compute resources. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [How to Implement Microsoft Defender for Cloud Vulnerability Assessment Recommendations](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüí° [How to Create an Azure Virtual Machine from an ARM Template](https://docs.microsoft.com/azure/virtual-machines/windows/ps-template)<br>\r\nüí° [Azure Automation State Configuration Overview](https://docs.microsoft.com/azure/automation/automation-dsc-overview)<br>\r\nüí° [Create a Windows Virtual Machine in the Azure portal](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal)<br>\r\nüí° [Container Security in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/container-security)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPVVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PV-4"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"PV.4\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPV4Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PV-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Perform Vulnerability Assessments (PV-5)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-5-perform-vulnerability-assessments)\r\n\r\nPerform vulnerabilities assessment for your cloud resources at all tiers in a fixed schedule or on-demand. Track and compare the scan results to verify the vulnerabilities are remediated. The assessment should include all type of vulnerabilities, such as vulnerabilities in Azure services, network, web, operating systems, misconfigurations, and so on.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) üî∑ [SecurityNestedRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) üî∑ [SecurityBaseline](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securitybaseline) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [How to Implement Microsoft Defender for Cloud Vulnerability Assessment Recommendations](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüí° [Integrated Vulnerability Scanner for Virtual Machines](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüí° [SQL Vulnerability Assessment](https://docs.microsoft.com/azure/azure-sql/database/sql-vulnerability-assessment)<br>\r\nüí° [Exporting Microsoft Defender for Cloud Vulnerability Scan Results](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Defender XDR](https://security.microsoft.com/)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPVVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PV-5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"PV.5\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityNestedRecommendation\r\n| where RecommendationState == \"Unhealthy\"\r\n| summarize count() by RecommendationName, RecommendationSeverity\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " Patches, Updates & Vulnerabilities",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Link_",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url"
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"1195afff-c881-495e-9bc5-1486211ae03f\"\r\n | project Resource = tolower(extract(\"([\\\\s\\\\S]*?)(/providers/Microsoft.Security.*)\",1,id)), ResourceGroup = trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)), ResourceType = tolower(split(id,\"/\").[6]), subscriptionId, severity = tostring(parse_json(properties).status.severity), status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), description = tostring(parse_json(properties).displayName), patchable = parse_json(properties.additionalData).patchable, cve = parse_json(properties.additionalData).cve\r\n | where status == 'Unhealthy'\r\n | summarize dcount(VulnId) by ResourceGroup, Resource, severity, VulnId, description, tostring(patchable), tostring(cve)\r\n | summarize Total = count(dcount_VulnId), sevH=countif(severity=='High'), sevM=countif(severity=='Medium'), sevL=countif(severity=='Low'), patchAvailable = countif(patchable=='true'), CVEcount =countif(cve!='[]') by ResourceGroup, Resource\r\n | order by sevH desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Vulnerability Scanning >> Select Asset for Details Below",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                    "exportFieldName": "Resource",
                    "exportParameterName": "selectedServer",
                    "exportDefaultValue": "All",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 13,
                          "formatOptions": {
                            "linkColumn": "Resource",
                            "linkTarget": "Resource",
                            "showIcon": true,
                            "customColumnWidthSetting": "30ch"
                          }
                        },
                        {
                          "columnMatch": "ResourceGroup",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Resource",
                          "formatter": 5,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 1,
                          "formatOptions": {
                            "customColumnWidthSetting": "10ch"
                          }
                        },
                        {
                          "columnMatch": "sevH",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "redBright",
                            "customColumnWidthSetting": "12ch"
                          }
                        },
                        {
                          "columnMatch": "sevM",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellow",
                            "customColumnWidthSetting": "13ch"
                          }
                        },
                        {
                          "columnMatch": "sevL",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blueDark",
                            "customColumnWidthSetting": "10ch"
                          }
                        },
                        {
                          "columnMatch": "patchAvailable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "pending",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            },
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "CVEcount",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "4",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "10ch"
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "ResourceGroup"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "Resource"
                      },
                      "labelSettings": [
                        {
                          "columnId": "ResourceGroup",
                          "label": "Resource group"
                        },
                        {
                          "columnId": "sevH",
                          "label": "High"
                        },
                        {
                          "columnId": "sevM",
                          "label": "Medium"
                        },
                        {
                          "columnId": "sevL",
                          "label": "Low"
                        },
                        {
                          "columnId": "patchAvailable",
                          "label": "Available patches"
                        },
                        {
                          "columnId": "CVEcount",
                          "label": "CVEs"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"1195afff-c881-495e-9bc5-1486211ae03f\"\r\n| project Resource = tolower(extract(\"([\\\\s\\\\S]*?)(/providers/Microsoft.Security.*)\",1,id)), ResourceGroup = trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)), ResourceType = tolower(split(id,\"/\").[6]), subscriptionId, Severity = tostring(parse_json(properties).status.severity), Status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), Description = tostring(parse_json(properties).displayName), Patchable = parse_json(properties.additionalData).patchable, CVE = properties.additionalData.cve, Category = tostring(properties.category), TimeGenerated = tostring(properties.timeGenerated), Remediation = tostring(properties.remediation), Impact = tostring(properties.impact), Threat = tostring(properties.additionalData.threat)\r\n| where Status == 'Unhealthy'\r\n| where '{selectedServer}' == 'All' or Resource == '{selectedServer}'\r\n| project Severity, VulnId, Description, tostring(Patchable), Category, Resource, ResourceGroup, CVE, TimeGenerated, Remediation, Impact, Threat\r\n| mv-expand CveExpand = split (CVE, \"},\") to typeof(string)\r\n| parse CveExpand with * '\"title\":\"' singleCve '\"' *\r\n| summarize CVEs = tostring(make_list(singleCve)) by Severity, VulnId, Description, tostring(Patchable), Category, Resource, ResourceGroup, TimeGenerated, Threat, Impact, Remediation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Vulnerability Details >> Select Asset Above",
                    "noDataMessage": "Select Asset in Vulnerability Scanning Panel Above",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Severity",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "VulnId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Resource",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 6,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "Remediation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "GenericDetails",
                            "linkIsContextBlade": true
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Severity"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "VulnId"
                      },
                      "labelSettings": [
                        {
                          "columnId": "ResourceGroup",
                          "label": "Resource group"
                        },
                        {
                          "columnId": "TimeGenerated",
                          "label": "Time generated"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "name": "query - 0"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPV5Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PV-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Rapidly Automatically Remediate Vulnerabilities (PV-6)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-6-rapidly-and-automatically-remediate-vulnerabilities)\r\n\r\nRapidly and automatically deploy patches and updates to remediate vulnerabilities in your cloud resources. Use the appropriate risk-based approach to prioritize the remediation of the vulnerabilities. For example, more severe vulnerabilities in a higher value asset should be addressed as a higher priority. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [How to Configure Update Management for Virtual Machines in Azure](https://docs.microsoft.com/azure/automation/update-management/overview)<br>\r\nüí° [Manage Updates and Patches for Your Azure VMs](https://docs.microsoft.com/azure/automation/update-management/manage-updates-for-vm)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Automation Accounts](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPVVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PV-6"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"PV.6\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPV6Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PV-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Conduct Regular Red Team Operations (PV-7)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-7-conduct-regular-red-team-operations)\r\n\r\nSimulate real-world attacks to provide a more complete view of your organization's vulnerability. Red team operations and penetration testing complement the traditional vulnerability scanning approach to discover risks.\r\n\r\n## Implementation\r\nüí° [Penetration Testing in Azure](https://docs.microsoft.com/azure/security/fundamentals/pen-testing)<br>\r\nüí° [Penetration Testing Rules of Engagement](https://www.microsoft.com/msrc/pentest-rules-of-engagement?rtc=1)<br>\r\nüí° [Microsoft Cloud Red Teaming](https://download.microsoft.com/download/C/1/9/C1990DBA-502F-4C2A-848D-392B93D9B9C3/Microsoft_Enterprise_Cloud_Red_Teaming.pdf)<br>\r\nüí° [Technical Guide to Information Security Testing and Assessment](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-115.pdf)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft 365 Compliance Center](https://compliance.microsoft.com/) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isPVVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "PV-7"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [SimuLand for Attack Simulation](https://www.microsoft.com/security/blog/2021/05/20/simuland-understand-adversary-tradecraft-and-improve-detection-strategies/)\r\n![Image¬†Name](https://www.microsoft.com/security/blog/wp-content/uploads/2021/05/Map-of-threat-research.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "text - 3 - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Attack Simulator in the Security & Compliance Center](https://docs.microsoft.com/azure/automation/update-management/overview)\r\n![Image¬†Name](https://docs.microsoft.com/microsoft-365/media/9bd65af4-1f9d-45c1-8c06-796d7ccfd425.jpg)¬†\r\n\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "text - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isPV7Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "PV-7",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isPVVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Posture & Vulnerability Management"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Endpoint Security (ES)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security) \r\n---\r\nEndpoint Security covers controls in endpoint detection and response, including use of endpoint detection and response (EDR) and anti-malware service for endpoints in Azure environments. "
            },
            "customWidth": "40",
            "name": "ES Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "text - 6"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Use Endpoint Detection & Response (ES-1)\\\", \\\"tab\\\": \\\"ES1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Use Modern Anti-Malware Software (ES-2)\\\", \\\"tab\\\": \\\"ES2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Ensure Anti-Malware Software/Signature Updates (ES-3)\\\", \\\"tab\\\": \\\"ES3\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isES1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "ES1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isES2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "ES2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "75f1caed-7990-4221-bcb9-084b788cec87"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isES3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "ES3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "3afd9d5a-2e29-476f-8508-478a4322a1a7"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Use Endpoint Detection & Response (ES-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security#es-1-use-endpoint-detection-and-response-edr)\r\n\r\nEnable Endpoint Detection and Response (EDR) capabilities for VMs and integrate with SIEM and security operations processes.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n## Implementation\r\nüí° [Microsoft Defender for Cloud introduction](https://docs.microsoft.com/azure/security-center/defender-for-servers-introduction)<br>\r\nüí° [Microsoft Defender for Endpoint Overview](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/microsoft-defender-advanced-threat-protection)<br>\r\nüí° [Microsoft Defender for Cloud feature coverage for machines](https://docs.microsoft.com/azure/security-center/security-center-services?tabs=features-windows)<br>\r\nüí° [Connector for Defender for servers integration into SIEM](https://docs.microsoft.com/azure/security-center/security-center-wdatp?WT.mc_id=Portal-Microsoft_Azure_Security_CloudNativeCompute&tabs=windows)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Defender XDR](https://security.microsoft.com/) <br> \r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isESVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "ES-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where RecommendationName contains \"endpoint protection\" or RecommendationName contains \"virus\" or RecommendationName contains \"defender for servers\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Description contains \"endpoint\" or Description contains \"EDR\" or Description contains \"virus\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents: EDR",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isES1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "ES-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Use Modern Anti-Malware Software (ES-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security#es-2-use-modern-anti-malware-software)\r\n\r\nMicrosoft Defender for Cloud can automatically identify the use of a number of popular anti-malware solutions for your virtual machines and on-premises machines with Azure Arc configured, and report the endpoint protection running status and make recommendations.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n## Implementation\r\nüí° [Supported Endpoint Protection Solutions](https://docs.microsoft.com/azure/security-center/security-center-services?tabs=features-windows#supported-endpoint-protection-solutions-)<br>\r\nüí° [How to Configure Microsoft Antimalware for Cloud Services and Virtual Machines](https://docs.microsoft.com/azure/security/fundamentals/antimalware)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Defender XDR](https://security.microsoft.com/) <br> \r\nüîÄ [Microsoft Sentinel](https://ms.portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isESVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "ES-2"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"ES.2\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Title contains \"tool\" or Title contains \"mal\" or Title contains \"ware\" or Title contains \"mining\" or Title contains \"anti\" or Title contains \"exploit\" or Title contains \"inject\" or Title contains \"program\" or Title contains \"virus\" or Title contains \"worm\"\r\n| where Title !contains \"URL\"\r\n| where Title !contains \"net\"\r\n| where Title !contains \"web\"\r\n| where Title !contains \"normalization\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| parse IncidentUrl with * 'https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\r\n| extend SeverityRank=iff(Severity == \"High\", 3, iff(Severity == \"Medium\", 2, iff(Severity == \"Low\", 1, iff(Severity == \"Informational\", 0, 0))))\r\n| sort by SeverityRank, TimeGenerated desc\r\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, FirstActivityTime, IncidentBlade\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Incidents: Malware",
                    "noDataMessage": "No Incidents Observed For This Technique Within These Thresholds",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Incident Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Alert",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "Sev2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Incident >>",
                            "bladeOpenContext": {
                              "bladeName": "CaseBlade",
                              "extensionName": "Microsoft_Azure_Security_Insights",
                              "bladeParameters": [
                                {
                                  "name": "id",
                                  "source": "column",
                                  "value": "IncidentBlade"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "IncidentBlade",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isES2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "ES-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Ensure Anti-Malware Software & Signatures are Updated (ES-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security#es-3-ensure-anti-malware-software-and-signatures-are-updated)\r\n\r\nEnsure anti-malware signatures are updated rapidly and consistently for the anti-malware solution.\r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) üî∑ [ProtectionStatus](https://docs.microsoft.com/azure/azure-monitor/reference/tables/protectionstatus) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [How to Deploy Microsoft Antimalware for Azure Cloud Services and Virtual Machines](https://docs.microsoft.com/azure/security/fundamentals/antimalware)<br>\r\nüí° [Endpoint protection assessment and recommendations in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/security-center-endpoint-protection)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Defender XDR](https://security.microsoft.com/) <br> "
                        },
                        "conditionalVisibility": {
                          "parameterName": "isESVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "ES-3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"ES.3\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ProtectionStatus\r\n| project ResourceId, OSName, SignatureVersion, ProtectionStatus, ProtectionStatusDetails, TypeofProtection, ScanDate\r\n| sort by ScanDate desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Protection Status",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ProtectionStatus",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "No real time protection",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Signatures out of date",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Real time protection",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Unknown",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Threat Detected",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Not Reporting",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url"
                          }
                        },
                        {
                          "columnMatch": "CompromisedEntity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Account",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Entra ID Profile >>"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "name": "query - 7 - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isES3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "ES-3",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isESVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Endpoint Security Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Backup & Recovery (BR)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery) \r\n---\r\nBackup and Recovery covers controls to ensure that data and configuration backups at the different service tiers are performed, validated, and protected."
            },
            "customWidth": "40",
            "name": "BR Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "text - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Ensure Regular Automated Backups (BR-1)\\\", \\\"tab\\\": \\\"BR1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Protect Backup & Recovery Data (BR-2)\\\", \\\"tab\\\": \\\"BR2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Monitor Backups (BR-3)\\\", \\\"tab\\\": \\\"BR3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Regularly Test Backups (BR-4)\\\", \\\"tab\\\": \\\"BR4\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isBR1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "BR1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isBR2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "BR2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "6ae2b31b-c2e7-4098-a83f-056deb37259e"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isBR3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "BR3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "c2825810-37fd-4aa3-810d-66a6fb91861b"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isBR4Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "BR4",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "9359e468-1457-462f-ba71-063894d31a58"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Ensure Regular Automated Backups (BR-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery?WT.mc_id=Portal-fx#br-1-ensure-regular-automated-backups)\r\n\r\nEnsure backup of business-critical resources, either during resource creation or enforced through policy for existing resources. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Backup](https://azure.microsoft.com/services/backup/)<br>\r\n\r\n## Implementation\r\nüí° [How to Enable Azure Backup](https://learn.microsoft.com/en-us/azure/backup/)<br>\r\nüí° [Auto-Enable Backup on VM Creation using Azure Policy](https://docs.microsoft.com/azure/backup/backup-azure-auto-enable-backup)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) "
                        },
                        "conditionalVisibility": {
                          "parameterName": "isBRVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "BR-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"BR.1\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type contains \"recovery\"\r\n| project id,type,location,resourceGroup\r\n| order by location asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Recovery Services Vaults",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isBR1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "BR-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Protect Backup & Recovery Data (BR-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery?WT.mc_id=Portal-fx#br-2-protect-backup-and-recovery-data)\r\n\r\nEnsure backup data and operations are protected from data exfiltration, data compromise, ransomware/malware and malicious insiders. The security controls that should be applied include user and network access control, data encryption at-rest and in-transit. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Overview of Security Features in Azure Backup](https://docs.microsoft.com/azure/backup/security-overview)<br>\r\nüí° [Encryption of Backup Data Using Customer-Managed Keys](https://docs.microsoft.com/azure/backup/encryption-at-rest-with-cmk)<br>\r\nüí° [Security features to help protect hybrid backups from attacks](https://docs.microsoft.com/azure/backup/backup-azure-security-feature#prevent-attacks)<br>\r\nüí° [Azure Backup - set cross region restore](https://docs.microsoft.com/azure/backup/backup-create-rs-vault#set-cross-region-restore)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) "
                        },
                        "conditionalVisibility": {
                          "parameterName": "isBRVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "BR-2"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"BR.2\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isBR2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "BR-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Monitor Backups (BR-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery?WT.mc_id=Portal-fx#br-3-monitor-backups)\r\n\r\nEnsure all business-critical protectable resources are compliant with the defined backup policy and standard. \r\n\r\n## Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Backup](https://azure.microsoft.com/services/backup/)<br>\r\n\r\n## Implementation\r\nüí° [Govern your backup estate using Backup Center](https://docs.microsoft.com/azure/backup/backup-center-govern-environment)<br>\r\nüí° [Monitor and operate backups using Backup center](https://docs.microsoft.com/azure/backup/backup-center-monitor-operate)<br>\r\nüí° [Monitoring and reporting solutions for Azure Backup](https://docs.microsoft.com/azure/backup/monitoring-and-alerts-overview)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Center](https://portal.azure.com/#blade/Microsoft_Azure_DataProtection/BackupCenterMenuBlade/overview)"
                        },
                        "name": "BR-3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationNameValue contains \"recovery\"\r\n| summarize count() by Caller\r\n| render piechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Users Interacting with Backups",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 1 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationNameValue contains \"recovery\"\r\n| project OperationName, Caller, OperationNameValue, ResourceId, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Backup Activity",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "name": "query - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isBR3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "BR-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Regularly Test Backups (BR-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery?WT.mc_id=Portal-fx#br-4-regularly-test-backup)\r\n\r\nPeriodically perform data recovery tests of your backup to verify that the backup configurations and availability of the backup data meets the recovery needs as per defined in the RTO (Recovery Time Objective) and RPO (Recovery Point Objective).\r\n\r\n## Implementation\r\nüí° [How to recover files from Azure Virtual Machine backup](https://docs.microsoft.com/azure/backup/backup-azure-restore-files-from-vm)<br>\r\nüí° [How to restore Key Vault keys in Azure](https://docs.microsoft.com/powershell/module/azurerm.keyvault/restore-azurekeyvaultkey)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br>\r\nüîÄ [Key Vaults](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults) <br>\r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isBRVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "BR-4"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Regularly test backups](https://docs.microsoft.com/azure/backup/backup-overview)\r\n![Image¬†Name](https://docs.microsoft.com/azure/backup/media/backup-overview/azure-backup-overview.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "name": "text - 2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isBR4Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "BR-4",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isBRVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Backup & Recovery Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [DevOps Security (DS)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security) \r\n---\r\nDevOps Security covers the controls related to the security engineering and operations in the DevOps processes, including deployment of critical security checks (such as static application security testing, vulnerability management) prior to the deployment phase to ensure the security throughout the DevOps process; it also includes common topics such as threat modeling and software supply security. "
            },
            "customWidth": "40",
            "name": "BR Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "text - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Conduct Threat Modeling (DS-1)\\\", \\\"tab\\\": \\\"DS1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Ensure Software Supply Chain Security (DS-2)\\\", \\\"tab\\\": \\\"DS2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Secure DevOps Infrastructure (DS-3)\\\", \\\"tab\\\": \\\"DS3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Integrate Static Application Security Testing into DevOps Pipeline (DS-4)\\\", \\\"tab\\\": \\\"DS4\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDS1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DS1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "432231f5-e330-4608-a6f0-2586469caa56",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDS2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DS2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "3cae8cdf-ea83-4785-ae80-bd30a12bb879",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDS3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DS3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "bdbb6088-a8a5-42fe-a440-cb4b07c58f06",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDS4Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DS4",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Integrate Dynamic Application Security Testing into DevOps Pipeline (DS-5)\\\", \\\"tab\\\": \\\"DS5\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Enforce Security of Workload throughout DevOps Lifecycle (DS-6)\\\", \\\"tab\\\": \\\"DS6\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Enable Logging & Monitoring in DevOps (DS-7)\\\", \\\"tab\\\": \\\"DS7\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "448e20b4-58fd-4677-b2f4-3786a984351d",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDS5Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DS5",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "8c41d5dc-518b-48b3-83df-2f6d065023a3",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDS6Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DS6",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "263e3b56-f7f9-4c8d-b79e-5eb8c1c5f66a",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDS7Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "DS7",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Conduct Threat Modeling (DS-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-1-conduct-threat-modeling)\r\n\r\nPerform threat modeling to identify the potential threats and enumerate the mitigating controls. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n## Implementation\r\nüí° [Threat Modeling Overview](https://www.microsoft.com/securityengineering/sdl/threatmodeling)<br>\r\nüí° [Application threat analysis (including STRIDE + questionnaire based method)](https://docs.microsoft.com/azure/architecture/framework/security/design-threat-model)<br>\r\nüí° [Azure Template - Microsoft Security Threat Model Stencil](https://github.com/AzureArchitecture/threat-model-templates)<br>\r\nüí° [Hunt for threats with Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/hunting)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [GitHub](https://github.com/)<br>\r\nüîÄ [Azure DevOps](https://azure.microsoft.com/services/devops/)<br>\r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "text - 1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## üí°[Getting started with the Threat Modeling Tool](https://docs.microsoft.com/azure/security/develop/threat-modeling-tool-getting-started)\r\n![Image Name](https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE2K1Za?ver=0327&q=90&m=8&h=450&w=800&b=%23FFFFFFFF&l=f&x=0&y=79&s=1709&d=961&aim=true)<br>\r\n"
                  },
                  "customWidth": "50",
                  "name": "text - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\r\n| where Tactics <> \"[]\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Tactics\r\n| render timechart \r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "MITRE ATT&CK¬Æ Tactics Observed",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "ControlNumber",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "AllServices",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationState",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "!=",
                                "thresholdValue": "Healthy",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "name": "query - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDS1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DS-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Ensure Software Supply Chain Security (DS-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-2-ensure-software-supply-chain-security)\r\n\r\nEnsure your enterprise‚Äôs SDLC (Software Development Lifecycle) or process include a set of security controls to govern the in-house and third-party software components (including both proprietary and open-source software) where your applications have dependencies. Define gating criteria to prevent vulnerable or malicious components being integrated and deployed into the environment. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance)  ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [GitHub Dependency Graph](https://docs.github.com/code-security/supply-chain-security/understanding-your-software-supply-chain/about-the-dependency-graph)<br>\r\nüí° [GitHub Dependabot](https://docs.github.com/code-security/supply-chain-security/keeping-your-dependencies-updated-automatically/about-dependabot-version-updates)<br>\r\nüí° [Identify vulnerable container images in your CI/CD workflows](https://docs.microsoft.com/azure/security-center/defender-for-container-registries-cicd)<br>\r\nüí° [Azure DevOps Marketplace ‚Äì supply chain security](https://marketplace.visualstudio.com/search?term=tag%3ASupply%20Chain%20Security&target=VSTS)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [GitHub](https://github.com/)<br>\r\nüîÄ [Azure DevOps](https://azure.microsoft.com/services/devops/)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "text - 1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where RecommendationName contains \"contain\" or RecommendationName contains \"aks\" or RecommendationName contains \"kube\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDS2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DS-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Secure DevOps Infrastructure (DS-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-3-secure-devops-infrastructure)\r\n\r\nEnsure the DevOps infrastructure and pipeline follow security best practices across environments including your build, test, and production stages.\r\n\r\n## Recommended Logs\r\nüî∑ [GitHubAuditLogPolling_CL](https://portal.azure.com/#create/microsoftcorporation1622712991604.sentinel4githubsentinel4github) üî∑ [AzureDevOpsAuditing](https://docs.microsoft.com/azure/devops/organizations/audit/auditing-streaming) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/)<br> \r\n\r\n## Implementation\r\nüí° [DevSecOps controls overview ‚Äì secure pipelines](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/devsecops-controls)<br>\r\nüí° [Secure your GitHub organization](https://docs.github.com/code-security/getting-started/securing-your-organization)<br>\r\nüí° [Azure DevOps pipeline ‚Äì Microsoft hosted agent security considerations](https://docs.microsoft.com/azure/devops/pipelines/agents/hosted?view=azure-devops&preserve-view=true&tabs=yaml#security)<br>\r\nüí° [Protecting your GitHub assets with Microsoft Sentinel](https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/protecting-your-github-assets-with-azure-sentinel/ba-p/1457721)<br>\r\nüí° [Deploy Microsoft Sentinel: Continuous Threat Monitoring for GitHub Solution](https://portal.azure.com/#create/microsoftcorporation1622712991604.sentinel4githubsentinel4github)<br>\r\nüí° [Azure DevOps - audit streaming](https://docs.microsoft.com/azure/devops/organizations/audit/auditing-streaming?view=azure-devops&preserve-view=true)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [GitHub](https://github.com/)<br>\r\nüîÄ [Azure DevOps](https://azure.microsoft.com/services/devops/)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "text - 1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "GitHubAuditLogPolling_CL \r\n| project actor_s, org_s, repo_s, action_s, name_s, _document_id_s, visibility_s, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "GitHub Audit Logs",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "actor_s",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "action_s",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "ControlNumber",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "AllServices",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationState",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "!=",
                                "thresholdValue": "Healthy",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDevOpsAuditing\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Azure DevOps Audit Logs",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "ControlNumber",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "AllServices",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationState",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "!=",
                                "thresholdValue": "Healthy",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDS3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DS-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Integrate Static Application Security Testing into DevOps Pipeline (DS-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-4-integrate-static-application-security-testing-into-devops-pipeline)\r\n\r\nEnsure static application security testing (SAST) is part of the gating controls in the CI/CD workflow. The gating can be set based on the testing results to prevent vulnerable packages from committing into the repository, building into the packages, or deploying into the production. \r\n\r\n## Implementation\r\nüí° [GitHub CodeQL](https://codeql.github.com/docs/)<br>\r\nüí° [BinSkim Binary Analyzer](https://github.com/microsoft/binskim)<br>\r\nüí° [Azure DevOps Credential Scan](https://secdevtools.azurewebsites.net/helpcredscan.html)<br>\r\nüí° [GitHub secret scanning](https://docs.github.com/code-security/secret-security/about-secret-scanning)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [GitHub](https://github.com/)<br>\r\nüîÄ [Azure DevOps](https://azure.microsoft.com/services/devops/)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "text - 1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## üí°[Getting started with Credential Scanner](https://secdevtools.azurewebsites.net/helpcredscan.html)\r\n![ImageName](https://secdevtools.azurewebsites.net/img/1_AddBuildTask.png)"
                  },
                  "customWidth": "50",
                  "name": "text - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDS4Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DS-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Integrate Dynamic Application Security Testing into DevOps Pipeline (DS-5)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-5-integrate-dynamic-application-security-testing-into-devops-pipeline)\r\n\r\nEnsure dynamic application security testing (DAST) are part of the gating controls in the CI/CD workflow. The gating can be set based on the testing results to prevent vulnerability from building into the packages or deploying into the production. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityNestedRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [DAST tools in Azure DevOps marketplace](https://marketplace.visualstudio.com/search?term=DAST&target=AzureDevOps&category=All%20categories)<br>\r\nüí° [How to Implement Microsoft Defender for Cloud Vulnerability Assessment Recommendations](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüí° [Integrated Vulnerability Scanner for Virtual Machines](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüí° [SQL Vulnerability Assessment](https://docs.microsoft.com/azure/azure-sql/database/sql-vulnerability-assessment)<br>\r\nüí° [Exporting Microsoft Defender for Cloud Vulnerability Scan Results](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Defender XDR](https://security.microsoft.com/)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "BR-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityNestedRecommendation\r\n| extend CVE = tostring(parse_json(tostring(AdditionalData.Cve))[0].Title)\r\n| where Description <> \"\"\r\n| where Description <> \"N/A\"\r\n| summarize count() by Description, CVE\r\n| sort by count_ desc\r\n| project Description, CVE, count_\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " System/Application Vulnerabilities",
                    "noDataMessage": "Confirm ASC SecurityNestedRecommendation logging is enabled and/or extend time thresholds for a larger data-set.  ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Description",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Execution",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "ComplianceDomain",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Persistence",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 6"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDS5Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DS-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Enforce Security of Workload throughout DevOps Lifecycle (DS-6)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-6-enforce-security-of-workload-throughout-devops-lifecycle)\r\n\r\nEnsure the workload is secured throughout the entire lifecycle in development, testing, and deployment stage. Use Azure Security Benchmark to evaluate the controls (such as network security, identity management, privileged access and so on) that can be set as guardrails by default or shift left prior to the deployment stage. \r\n\r\n## Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n## Implementation\r\nüí° [Shared Image Gallery overview](https://docs.microsoft.com/azure/virtual-machines/windows/shared-image-galleries)<br>\r\nüí° [How to implement Azure Defender for Cloud vulnerability assessment recommendations](https://docs.microsoft.com/azure/security-center/security-center-vulnerability-assessment-recommendations)<br>\r\nüí° [Security considerations for Azure Container](https://docs.microsoft.com/azure/container-instances/container-instances-image-security)<br>\r\nüí° [Azure Defender for container registries](https://docs.microsoft.com/azure/security-center/defender-for-container-registries-introduction)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "text - 3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName \r\n| extend Remediate=RecommendationLink\r\n| where ControlID == \"DS.6\"\r\n| parse Remediate with * 'portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/' assessmentKey '/' *\r\n| distinct RecommendationName, Total, Remediate, PassedControls, Passed, Failed, assessmentKey\r\n| sort by Total, Passed desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Security Policy Recommendations ",
                    "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"Passed\"]/[\"Total\"]",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Remediate",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkLabel": "Remediate >>",
                            "bladeOpenContext": {
                              "bladeName": "RecommendationsBlade",
                              "extensionName": "Microsoft_Azure_Security",
                              "bladeParameters": [
                                {
                                  "name": "assessmentKey",
                                  "source": "column",
                                  "value": "assessmentKey"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "assessmentKey",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Failed",
                          "color": "redBright"
                        },
                        {
                          "seriesName": "Passed",
                          "color": "green"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDS6Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DS-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Enable Logging and Monitoring in DevOps (DS-7)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-7-enable-logging-and-monitoring-in-devops)\r\n\r\nEnsure your logging and monitoring scope includes non-production environments and CI/CD workflow elements used in DevOps (and any other development processes). The vulnerabilities and threats targeting these environments can introduce significant risks to your production environment if they are not monitored properly. The events from the CI/CD build, test and deployment workflow should also be monitored to identify any deviations in the CI/CD workflow jobs. \r\n\r\n## Recommended Logs\r\nüî∑ [GitHubAuditLogPolling_CL](https://portal.azure.com/#create/microsoftcorporation1622712991604.sentinel4githubsentinel4github) üî∑ [AzureDevOpsAuditing](https://docs.microsoft.com/azure/devops/organizations/audit/auditing-streaming) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/)<br> \r\n\r\n## Implementation\r\nüí° [Azure DevOps - audit streaming](https://docs.microsoft.com/azure/devops/organizations/audit/auditing-streaming?view=azure-devops&preserve-view=true)<br>\r\nüí° [GitHub logging](https://docs.github.com/organizations/keeping-your-organization-secure/reviewing-the-audit-log-for-your-organization)<br>\r\nüí° [Protecting your GitHub assets with Microsoft Sentinel](https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/protecting-your-github-assets-with-azure-sentinel/ba-p/1457721)<br>\r\nüí° [Deploy Microsoft Sentinel: Continuous Threat Monitoring for GitHub Solution](https://portal.azure.com/#create/microsoftcorporation1622712991604.sentinel4githubsentinel4github)<br>\r\n\r\n## Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [GitHub](https://github.com/)<br>\r\nüîÄ [Azure DevOps](https://azure.microsoft.com/services/devops/)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isDSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "BR-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## üí°[Enable Azure DevOps Audit streaming](https://docs.microsoft.com/azure/devops/organizations/audit/auditing-streaming?view=azure-devops)\r\n![Image](https://docs.microsoft.com/azure/devops/organizations/audit/media/auditing-streaming/create-new-auditing-stream.png?view=azure-devops)"
                  },
                  "customWidth": "50",
                  "name": "text - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "GitHubAuditLogPolling_CL \r\n| project actor_s, org_s, repo_s, action_s, name_s, _document_id_s, visibility_s, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "GitHub Audit Logs",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "actor_s",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "action_s",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "ControlNumber",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "AllServices",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationState",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "!=",
                                "thresholdValue": "Healthy",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDevOpsAuditing\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Azure DevOps Audit Logs",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Total",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "Passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "Failed",
                                  "color": "redBright"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "PassedControls",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "ControlNumber",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "AllServices",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationState",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "!=",
                                "thresholdValue": "Healthy",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isDS7Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "DS-7",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isDSVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "DevOps Security"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Governance & Strategy (GS)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy) \r\n---\r\nGovernance and Strategy provides guidance for ensuring a coherent security strategy and documented governance approach to guide and sustain security assurance, including establishing roles and responsibilities for the different cloud security functions, unified technical strategy, and supporting policies and standards. "
            },
            "customWidth": "40",
            "name": "GS Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "60",
            "name": "text - 11"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Align Organization Roles & Responsibilities (GS-1)\\\", \\\"tab\\\": \\\"GS1.\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Define Enterprise Segmentation Strategy (GS-2)\\\", \\\"tab\\\": \\\"GS2\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Define & Implement Data Protection Strategy (GS-3)\\\", \\\"tab\\\": \\\"GS3\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Define & Implement Network Security Strategy (GS-4)\\\", \\\"tab\\\": \\\"GS4\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Define & Implement security Posture Management Strategy (GS-5)\\\", \\\"tab\\\": \\\"GS5\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a206a547-329b-4003-8832-c16daacca6c6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isGS1Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "GS1.",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isGS2Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "GS2",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "bf30d754-c4b6-463d-9683-751c1d04c6be"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isGS3Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "GS3",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "faf2c7d2-4fba-42cb-b2af-46acfb3e86af"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isGS4Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "GS4",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "6ce04d53-ba6b-4798-98ac-5e187cefa6ee"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "isGS5Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "GS5",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "ed6784f0-b512-4d1f-bfdf-716b7cb92ca0"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control\\\": \\\"Define & Implement Identity Strategy (GS-6)\\\", \\\"tab\\\": \\\"GS6\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Define & Implement Logging & IR Strategy (GS-7)\\\", \\\"tab\\\": \\\"GS7\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Define & Implement Backup & Recovery Strategy (GS-8)\\\", \\\"tab\\\": \\\"GS8\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Define & Implement Endpoint Security Strategy (GS-9)\\\", \\\"tab\\\": \\\"GS9\\\" },\\r\\n\\t{ \\\"Control\\\": \\\"Define & Implement DevOps Security Strategy (GS-10)\\\", \\\"tab\\\": \\\"GS10\\\" }\\r\\n]\",\"transformers\":null}",
              "size": 3,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "tab",
                  "parameterName": "Tab",
                  "parameterType": 1
                }
              ],
              "queryType": 8,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Control",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  },
                  {
                    "columnMatch": "tab",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "40",
            "name": "query - 8 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "74a2acdf-58b1-4894-9751-df3d37c60c0a",
                  "version": "KqlParameterItem/1.0",
                  "name": "isGS6Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "GS6",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "430132bd-1307-4751-9e7c-d8e5d4c35a60",
                  "version": "KqlParameterItem/1.0",
                  "name": "isGS7Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "GS7",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "60452be3-bb0d-46b6-8b64-a0dd85f8c184",
                  "version": "KqlParameterItem/1.0",
                  "name": "isGS8Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "GS8",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "ab4776ea-1780-4461-b79e-0158cd70dcfe",
                  "version": "KqlParameterItem/1.0",
                  "name": "isGS9Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "GS9",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "7b8c13cd-cea6-40ff-b96d-f533b1cadd04",
                  "version": "KqlParameterItem/1.0",
                  "name": "isGS10Visible",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "GS10",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "name": "Hidden Parameters Selectors - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Align Organization Roles, Responsibilities & Accountabilities (GS-1)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-1-align-organization-roles-responsibilities-and-accountabilities)\r\n\r\nEnsure that you define and communicate a clear strategy for roles and responsibilities in your security organization. Prioritize providing clear accountability for security decisions, educating everyone on the shared responsibility model, and educate technical teams on technology to secure the cloud.\r\n\r\n## Strategy\r\nüí° [Azure Security Best Practice 1 ‚Äì People: Educate Teams on Cloud Security Journey](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#1-people-educate-teams-about-the-cloud-security-journey)<br>\r\nüí° [Azure Security Best Practice 2 - People: Educate Teams on Cloud Security Technology](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#2-people-educate-teams-on-cloud-security-technology)<br>\r\nüí° [Azure Security Best Practice 3 - Process: Assign Accountability for Cloud Security Decisions](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#4-process-update-incident-response-ir-processes-for-cloud)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isGSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "GS-1"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Align Organization Roles, Responsibilities, and Accountabilities](https://docs.microsoft.com/security/zero-trust/identity)\r\n![Image Name](https://docs.microsoft.com/azure/role-based-access-control/media/rbac-and-directory-admin-roles/rbac-admin-roles.png)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isGS1Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GS-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [GS-2: Define & Implement Enterprise Segmentation/Separation of Duties Strategy (GS-2)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-duties-strategy)\r\n\r\nEstablish an enterprise-wide strategy to segment access to assets using a combination of identity, network, application, subscription, management group, and other controls.\r\n\r\n## Strategy\r\nüí° [Security in the Microsoft Cloud Adoption Framework for Azure - Segmentation: Separate to Protect](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/access-control#segmentation-separate-to-protect)<br>\r\nüí° [Security in the Microsoft Cloud Adoption Framework for Azure - Architecture: Establish Unified Security Strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/security-top-10#11-architecture-establish-a-single-unified-security-strategy)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isGSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "GS-2"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Segment and Enforce the External Boundaries](https://docs.microsoft.com/security/zero-trust/networks#segment-and-enforce-the-external-boundaries)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-servers-devices-boundaries-azure-vpn.png)¬†\r\n\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isGS2Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GS-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Define & Implement Data Protection Strategy (GS-3)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-3-define-and-implement-data-protection-strategy)\r\n\r\nEstablish an enterprise-wide strategy for data protection in Azure\r\n\r\n## Strategy\r\nüí° [Azure Security Benchmark - Data Protection](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection)<br>\r\nüí° [Cloud Adoption Framework - Azure data security and encryption best practices](https://docs.microsoft.com/azure/security/fundamentals/data-encryption-best-practices)<br>\r\nüí° [Azure Security Fundamentals - Azure Data security, encryption, and storage](https://docs.microsoft.com/azure/security/fundamentals/encryption-overview)<br>"
                        },
                        "name": "GS-4"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Asset Management and Data Protection Strategy](https://docs.microsoft.com/security/zero-trust/data)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-monitor-remediate-data.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isGS3Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GS-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Define & Implement Network Security Strategy (GS-4)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-4-define-and-implement-network-security-strategy)\r\n\r\nEstablish an Azure network security strategy as part of your organization's overall security strategy for access control.\r\n\r\n## Strategy\r\nüí° [Azure Security Best Practice 11 - Architecture. Single Unified Security Strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#11-architecture-establish-a-single-unified-security-strategy)<br>\r\nüí° [Azure Security Benchmark - Network Security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security)<br>\r\nüí° [Azure Network Security Overview](https://docs.microsoft.com/azure/security/fundamentals/network-overview)<br>\r\nüí° [Enterprise Network Architecture Strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/architecture)<br>"
                        },
                        "name": "GS-4"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Network Security Strategy](https://docs.microsoft.com/security/zero-trust/networks)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-azure-region-virtual-network-servers.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isGS4Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GS-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Define & Implement Security Posture Management Strategy (GS-5)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-5-define-and-implement-security-posture-management-strategy)\r\n\r\nEstablish a policy, procedure and standard to ensure the security configuration management and vulnerability management are in place in your cloud security mandate.\r\n\r\n## Strategy\r\nüí° [Azure Security Benchmark - Posture and Vulnerability Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management)<br>\r\nüí° [Azure Security Best Practice 9 - Establish security posture management](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/security-top-10#5-process-establish-security-posture-management)<br>"
                        },
                        "conditionalVisibility": {
                          "parameterName": "isGSVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "GS-3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Security Posture Management Strategy](https://docs.microsoft.com/security/zero-trust/visibility-automation-orchestration)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-provide-integrated-capabilities-manage-threats.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isGS5Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GS-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Define & Implement Identity & Privileged Access Strategy (GS-6)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-6-define-and-implement-identity-and-privileged-access-strategy)\r\n\r\nEstablish an Azure identity and privileged access approach as part of your organization's overall security access control strategy. \r\n\r\n## Strategy\r\nüí° [Azure Security Benchmark - Identity Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management)<br>\r\nüí° [Azure Security Benchmark - Privileged Access](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access)<br>\r\nüí° [Azure Security Best Practice 11 - Architecture. Single Unified Security Strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#11-architecture-establish-a-single-unified-security-strategy)<br>\r\nüí° [Azure Identity Management Security Overview](https://docs.microsoft.com/azure/security/fundamentals/identity-management-overview)<br>"
                        },
                        "name": "GS-6"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Identity and Privileged Access Strategy](https://docs.microsoft.com/security/zero-trust/identity)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-conditional-access-policies.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isGS6Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GS-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Define & Implement Logging, Threat Detection & Incident Response Strategy (GS-7)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-7-define-and-implement-logging-threat-detection-and-incident-response-strategy)\r\n\r\nEstablish a logging, threat detection and incident response strategy to rapidly detect and remediate threats and meeting compliance requirements. Security operations (SecOps / SOC) team should prioritize high quality alerts and seamless experiences so that they can focus on threats rather than log integration and manual steps.\r\n\r\n## Strategy\r\nüí° [Azure Security Benchmark - Logging and Threat Detection](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection)<br>\r\nüí° [Azure Security Benchmark - Incident Response](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response)<br>\r\nüí° [Azure Security Best Practice 4 - Process. Update Incident Response Processes for Cloud](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#3-process-assign-accountability-for-cloud-security-decisions)<br>\r\nüí° [Azure Adoption Framework, Logging, and Reporting Decision Guide](https://docs.microsoft.com/azure/cloud-adoption-framework/decision-guides/logging-and-reporting/)<br>\r\nüí° [Azure Enterprise Scale, Management, and Monitoring](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-and-monitoring)<br>"
                        },
                        "name": "GS-7"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Logging and Threat Response Strategy](https://docs.microsoft.com/azure/sentinel/overview)\r\n![Image¬†Name](https://docs.microsoft.com/azure/sentinel/media/overview/core-capabilities.png)¬†\r\n"
                  },
                  "customWidth": "35",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS7",
                  "styleSettings": {
                    "maxWidth": "35"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isGS7Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GS-7",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Define & Implement Backup & Recovery Strategy (GS-8)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-8-define-and-implement-backup-and-recovery-strategy)\r\n\r\nEstablish an Azure backup and recovery strategy for your organization. \r\n\r\n## Strategy\r\nüí° [Azure Security Benchmark - Backup and Recovery](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery)<br>\r\nüí° [Azure Well-Architecture Framework - Backup and Disaster Recover for Azure Applications](https://docs.microsoft.com/azure/architecture/framework/resiliency/backup-and-recovery)<br>\r\nüí° [Azure Adoption Framework - Business Continuity and Disaster Recovery](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/business-continuity-and-disaster-recovery)<br>\r\nüí° [Backup and restore plan to protect against ransomware](https://docs.microsoft.com/azure/security/fundamentals/backup-plan-to-protect-against-ransomware)<br>"
                        },
                        "name": "GS-8"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Backup and Recovery Strategy](https://docs.microsoft.com/azure/backup/backup-overview)\r\n![Image¬†Name](https://docs.microsoft.com/azure/backup/media/backup-overview/azure-backup-overview.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isGS8Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GS-8",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Define & Implement Endpoint Security Strategy (GS-9)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-9-define-and-implement-endpoint-security-strategy)\r\n\r\nEstablish a cloud endpoint security strategy.\r\n\r\n## Strategy\r\nüí° [Azure Security Benchmark - Endpoint security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security)<br>\r\nüí° [Best practices for endpoint security on Azure](https://docs.microsoft.com/azure/architecture/framework/security/design-network-endpoints)<br>"
                        },
                        "name": "GS-9"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Endpoint Security Strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security)\r\n![Image¬†Name](https://docs.microsoft.com/microsoft-365/media/mde-p1/mde-p1-overview-diagram.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isGS9Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GS-9",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [Define & Implement DevOps Security Strategy (GS-10)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-10-define-and-implement-devops-security-strategy)\r\n\r\nMandate the security controls as part of the organization's DevOps engineering and operation standard. Define the security objectives, control requirements, and tooling specifications in accordance with enterprise and cloud security standards in your organization.\r\n\r\n## Strategy\r\nüí° [Azure Security Benchmark - DevOps security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security)<br>\r\nüí° [Secure DevOps](https://www.microsoft.com/securityengineering/devsecops)<br>\r\nüí° [Cloud Adoption Framework - DevSecOps controls](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/devsecops-controls)<br>"
                        },
                        "name": "GS-10"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Control Assessment\r\n"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "52668f65-b44a-4e14-82d8-c87410e7e5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationStatus",
                              "label": "Implementation Status",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\": \"Not Implemented\", \"label\": \"Not Implemented\", \"selected\":true},\r\n    {\"value\": \"Implemented\", \"label\": \"Implemented\"},\r\n    {\"value\": \"Alternate Implementation\", \"label\": \"Alternate Implementation\"},\r\n    {\"value\": \"Planned\", \"label\": \"Planned\"},\r\n    {\"value\": \"Out of Scope\", \"label\": \"Out of Scope\"}\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "Implemented"
                            },
                            {
                              "id": "578b8620-30b9-4b92-abc6-997998bc8156",
                              "version": "KqlParameterItem/1.0",
                              "name": "ImplementationDate",
                              "label": "Implementation Date",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "version": "KqlParameterItem/1.0",
                              "name": "Notes",
                              "type": 1,
                              "value": "",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "id": "7bd0d384-d3c3-4c77-9dae-d75e823edfcf"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Status"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "## Notes <br>\r\n{Notes}"
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "group - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define and implement DevOps security strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security?WT.mc_id=Portal-fx)\r\n![Image¬†Name](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/media/devsecops-controls.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isGS10Visible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GS-10",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isGSVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Governance & Strategy Group"
    }
  ],
  "fromTemplateId": "sentinel-AzureSecurityBenchmark",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}