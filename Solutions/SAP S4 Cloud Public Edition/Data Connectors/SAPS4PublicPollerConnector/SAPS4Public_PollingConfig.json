{
    "name": "SAPS4PublicAlertsPolling",
    "apiVersion": "2023-02-01-preview",
    "type": "Microsoft.SecurityInsights/dataConnectors",
    "location": "{{location}}",
    "kind": "RestApiPoller",
    "properties": {
      "connectorDefinitionName": "SAPS4PublicAlerts",
      "dataType": "S4PublicCloudAuditLog_CL",
      "dcrConfig": {
        "dataCollectionEndpoint": "{{dataCollectionEndpoint}}",
        "dataCollectionRuleImmutableId": "{{dataCollectionRuleImmutableId}}",
        "streamName": "Custom-S4PublicCloudAuditLog_CL"
      },
      "addOnAttributes": {
        "S4HANACloudHost": "[[parameters('s4hanaHost')]"
      },
      "auth": {
        "type": "Basic",
        "userName": "{{username}}",
        "password": "{{password}}"
      },
      "request": {
        "apiEndpoint": "[[concat(parameters('s4hanaHost'), '/sap/opu/odata4/sap/rsau_log_api/srvd_a2x/sap/rsau_log_api/0001/SecurityAuditLog')]",
        "queryWindowInMin": 1,
        "httpMethod": "Get",
        "retryCount": 3,
        "timeoutInSeconds": 60,
        "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
        "queryParameters": {
          "$filter": "log_tstmp gt {_QueryWindowStartTime} and log_tstmp le {_QueryWindowEndTime}"
        },
        "headers": {
          "Accept": "application/json;odata.metadata=minimal;charset=utf-8",
          "User-Agent": "Scuba"
        }
      },
      "response": {
        "eventsJsonPaths": [
          "$.value"
        ],
        "format": "json"
      },
      "paging": {
        "pagingType": "LinkHeader",
        "linkHeaderTokenJsonPath": "$.['@odata.nextLink']"
      }
    }
}