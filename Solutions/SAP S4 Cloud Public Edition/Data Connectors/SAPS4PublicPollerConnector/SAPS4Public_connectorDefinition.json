{
    "name": "SAPS4PublicAlerts",
    "apiVersion": "2025-06-01",
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": {
      "connectorUiConfig": {
        "id": "SAPS4PublicAlerts",
        "title": "SAP S/4HANA Cloud Public Edition",
        "logo": "SapLogo.svg",
        "publisher": "SAP",
        "descriptionMarkdown": "The SAP S/4HANA Cloud Public Edition data connector enables ingestion of SAP's security audit log into the Microsoft Sentinel Solution for SAP, supporting cross-correlation, alerting, and threat hunting. Looking for alternative authentication mechanisms? See [here](https://github.com/Azure-Samples/Sentinel-For-SAP-Community/tree/main/integration-artifacts).",
        "graphQueriesTableName": "ABAPAuditLog",
        "graphQueries": [
          {
            "metricName": "Total events received",
            "legend": "SAP SAL Events",
            "baseQuery": "{{graphQueriesTableName}}"
          }
        ],
        "sampleQueries": [
          {
            "description": "Get Sample of SAP SAL Events",
            "query": "{{graphQueriesTableName}}\n | take 10"
          }
        ],
        "dataTypes": [
          {
            "name": "{{graphQueriesTableName}}",
            "lastDataReceivedQuery": "{{graphQueriesTableName}}\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
          }
        ],
        "connectivityCriteria": [
          {
            "type": "HasDataConnectors"
          }
        ],
        "availability": {
          "isPreview": true
        },
        "permissions": {
          "resourceProvider": [
            {
              "provider": "Microsoft.OperationalInsights/workspaces",
              "permissionsDisplayText": "Read and Write permissions are required.",
              "providerDisplayName": "Workspace",
              "scope": "Workspace",
              "requiredPermissions": {
                "write": true,
                "read": true,
                "delete": true
              }
            },
            {
              "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
              "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
              "providerDisplayName": "Keys",
              "scope": "Workspace",
              "requiredPermissions": {
                "action": true
              }
            }
          ],
          "customs": [
            {
                "name": "Client Id and Client Secret for Audit Retrieval API",
                "description": "Enable API access in BTP."
            }
          ]
        },
        "instructionSteps": [
          {
            "description": "**Step 1 - Configuration steps for SAP S/4HANA Cloud Public Edition**\n\nTo connect to SAP S/4HANA Cloud Public Edition, you will need:\n\n1. **SAP S/4HANA Cloud Public Edition tenant API URL**\n2. **Valid username and password** for your SAP S/4HANA Cloud system\n3. **Appropriate authorizations** to access audit log data via OData services\n\nEnsure that your SAP S/4HANA Cloud Public Edition system has the necessary OData services enabled for audit log retrieval and that your user account has the required permissions to access security audit logs.\n\n>**NOTE:** Basic authentication must be enabled in your SAP S/4HANA Cloud Public Edition system for this data connector to work properly."
          },
          {
            "description": "Connect using Basic authentication",
            "title": "Connect events from SAP S/4HANA Cloud Public Edition to Microsoft Sentinel Solution for SAP",
            "instructions": [
              {
                "type": "ContextPane",
                "parameters": {
                  "contextPaneType": "DataConnectorsContextPane",
                  "label": "Add account",
                  "isPrimary": true,
                  "title": "S/4HANA Cloud Public Edition connection",
                  "instructionSteps": [
                    {
                      "title": "Account Details",
                      "instructions": [
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Username",
                            "placeholder": "Enter your SAP S/4HANA Cloud username",
                            "type": "text",
                            "name": "username"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Password",
                            "placeholder": "Enter your SAP S/4HANA Cloud password",
                            "type": "password",
                            "name": "password"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "SAP S/4HANA Cloud API URL",
                            "placeholder": "https://my123456-api.s4hana.cloud.sap",
                            "type": "text",
                            "name": "s4hanaHost"
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            ]
          },
          {
            "title": "S/4HANA Cloud Public Edition connections",
            "description": "Each row represents a connected S/4HANA Cloud Public Edition system",
            "instructions": [
              {
                "type": "DataConnectorsGrid",
                "parameters": {
                  "mapping": [
                    {
                      "columnName": "S/4HANA Cloud API endpoint",
                      "columnValue": "properties.request.apiEndpoint"
                    }
                  ],
                  "menuItems": [
                    "DeleteConnector"
                  ]
                }
              }
            ]
          }
        ]
      }
    }
}