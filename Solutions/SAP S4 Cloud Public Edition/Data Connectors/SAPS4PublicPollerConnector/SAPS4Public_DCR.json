{
    "name": "SAPS4PublicDCR",
    "apiVersion": "2022-06-01",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "{{location}}",
    "properties": {
      "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
      "streamDeclarations": {
        "Custom-S4PublicCloudAuditLog_CL": {
          "columns": [
            {
              "name": "eventID",
              "type": "string"
            },
            {
              "name": "log_tstmp",
              "type": "datetime"
            },
            {
              "name": "slgmand",
              "type": "string"
            },
            {
              "name": "sid",
              "type": "string"
            },
            {
              "name": "counter",
              "type": "int"
            },
            {
              "name": "terminal_name",
              "type": "string"
            },
            {
              "name": "user_fullname",
              "type": "string"
            },
            {
              "name": "param_a",
              "type": "string"
            },
            {
              "name": "param_b",
              "type": "string"
            },
            {
              "name": "param_c",
              "type": "string"
            },
            {
              "name": "param_d",
              "type": "string"
            },
            {
              "name": "slgtc",
              "type": "string"
            },
            {
              "name": "slgrepna",
              "type": "string"
            },
            {
              "name": "rsau_text",
              "type": "string"
            },
            {
              "name": "UserID",
              "type": "string"
            },
            {
              "name": "useralias",
              "type": "string"
            },
            {
              "name": "email_adress",
              "type": "string"
            },
            {
              "name": "UserDescription",
              "type": "string"
            }
          ]
        }
      },
      "destinations": {
        "logAnalytics": [
          {
            "workspaceResourceId": "{{workspaceResourceId}}",
            "name": "clv2ws1"
          }
        ]
      },
      "dataFlows": [
        {
          "streams": [
            "Custom-S4PublicCloudAuditLog_CL"
          ],
          "destinations": [
            "clv2ws1"
          ],
          "transformKql": "source\n| extend TimeGenerated = now(), AgentId = \"S4-Public-Cloud\", ClientID = slgmand, Computer = terminal_name, Email = email_adress, MessageClass = eventID, MessageText = rsau_text, SystemID = sid, UpdatedOn = todatetime(log_tstmp), TransactionCode = slgtc, User = UserID, Variable1 = param_a, Variable2 = param_b, Variable3 = param_c, Variable4 = param_d\n| project TimeGenerated, AgentId, ClientID, Computer, Email, MessageClass, MessageText, SystemID, UpdatedOn, TransactionCode, User, Variable1, Variable2, Variable3, Variable4",
          "outputStream": "Microsoft-ABAPAuditLog"
        }
      ]
    }
}