{
    "name": "OneTrustMetadataDCR",
    "apiVersion": "22023-03-11",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "[parameters('workspace-location')]",
    "properties": {
       "streamDeclarations": {
            "Custom-OneTrustMetadata": {
                "columns": [
                    {
                        "name": "IngestionTime",
                        "type": "datetime"
                    },
                    {
                        "name": "TimeGenerated",
                        "type": "datetime"
                    },
                    {
                        "name": "AssetID",
                        "type": "string"
                    },
                    {
                        "name": "CreatedDateTime",
                        "type": "datetime"
                    },
                    {
                        "name": "AssetOwner",
                        "type": "dynamic"
                    },
                    {
                        "name": "AssetName",
                        "type": "string"
                    },
                    {
                        "name": "AssetType",
                        "type": "string"
                    },
                    {
                        "name": "AssetPermissions",
                        "type": "dynamic"
                    },
                    {
                        "name": "AdditionalFields",
                        "type": "dynamic"
                    },
                    {
                        "name": "Provider",
                        "type": "string"
                    },
                    {
                        "name": "AssetSource",
                        "type": "string"
                    },
                    {
                        "name": "TenantId",
                        "type": "string"
                    },
                    {
                        "name": "Workload",
                        "type": "string"
                    },
                    {
                        "name": "SubWorkload",
                        "type": "string"
                    },
                    {
                        "name": "Location",
                        "type": "string"
                    },
                    {
                        "name": "Region",
                        "type": "string"
                    },
                    {
                        "name": "Classification",
                        "type": "string"
                    },
                    {
                        "name": "ClassificationLastScanDateTime",
                        "type": "datetime"
                    },
                    {
                        "name": "IsProtectedByDlp",
                        "type": "boolean"
                    },
                    {
                        "name": "Risks",
                        "type": "string"
                    },
                    {
                        "name": "IdentityDirectorySource",
                        "type": "string"
                    },
                    {
                        "name": "LastAccessDateTime",
                        "type": "datetime"
                    },
                    {
                        "name": "LastModifiedDateTime",
                        "type": "datetime"
                    },
                    {
                        "name": "SensitivityLabel",
                        "type": "string"
                    },
                    {
                        "name": "ThreatDetected",
                        "type": "boolean"
                    },
                    {
                        "name": "ThreatCategory",
                        "type": "dynamic"
                    },
                    {
                        "name": "ThreatName",
                        "type": "dynamic"
                    },
                    {
                        "name": "RelatedIndicators",
                        "type": "string"
                    },
                    {
                        "name": "RequestSourceIP",
                        "type": "string"
                    },
                    {
                        "name": "RequestDestinationIP",
                        "type": "string"
                    },
                    {
                        "name": "AssetPath",
                        "type": "string"
                    },
                    {
                        "name": "InternalUserWithPermissionCount",
                        "type": "int"
                    },
                    {
                        "name": "ExternalUserWithPermissionCount",
                        "type": "int"
                    },
                    {
                        "name": "DeviceName",
                        "type": "string"
                    },
                    {
                        "name": "UserName",
                        "type": "string"
                    },
                    {
                        "name": "AssetSize",
                        "type": "string"
                    },
                    {
                        "name": "MD5",
                        "type": "string"
                    },
                    {
                        "name": "SHA1",
                        "type": "string"
                    },
                    {
                        "name": "SHA256",
                        "type": "string"
                    },
                    {
                        "name": "Extension",
                        "type": "string"
                    },
                    {
                        "name": "SignatureStatus",
                        "type": "string"
                    },
                    {
                        "name": "DomainName",
                        "type": "string"
                    },
                    {
                        "name": "Subdomain",
                        "type": "string"
                    },
                    {
                        "name": "TopLevelDomain",
                        "type": "string"
                    },
                    {
                        "name": "IPAddress",
                        "type": "string"
                    },
                    {
                        "name": "URL",
                        "type": "string"
                    },
                    {
                        "name": "ISP",
                        "type": "string"
                    },
                    {
                        "name": "ASN",
                        "type": "string"
                    }
                ]
            }
        },
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceResourceId": "[variables('workspaceResourceId')]",
                    "name": "clv2ws1"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-OneTrustMetadata"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source | extend IngestionTime = now(), Provider = \"OneTrust\"",
                "outputStream": "Custom-OneTrustMetadata_CL"
            }
        ],
        "dataCollectionEndpointId": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]"
    }
}