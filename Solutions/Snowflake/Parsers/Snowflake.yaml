id: 2757535d-ca8d-4083-8ea2-ac9ba5237b95
Function:
  Title: Parser for Snowflake
  Version: '1.0.4'
  LastUpdated: '2025-12-11'
Category: Microsoft Sentinel Parser
FunctionName: Snowflake
FunctionAlias: Snowflake
FunctionQuery: |
  let Snowflake_view = view () {
    Snowflake_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | extend
      EventStartTime = column_ifexists('START_TIME_t', ''),
      EventType = column_ifexists('EVENT_TYPE_s', ''),
      TargetUsername = column_ifexists('USER_NAME_s', ''),
      SrcDvcIpAddr = column_ifexists('CLIENT_IP_s', ''),
      QueryType = column_ifexists('QUERY_TYPE_s', ''),
      QueryText = column_ifexists('QUERY_TEXT_s',''),
      QueryExecutionStatus = column_ifexists('EXECUTION_STATUS_s', ''),
      QueryTotalElapsedTime = toreal(column_ifexists('TOTAL_ELAPSED_TIME_d', '0')),
      LoginIsSuccess = column_ifexists('IS_SUCCESS_s',''),
      QueryCreditsUsedCloudServices = iff(isempty(CREDITS_USED_CLOUD_SERVICES_d), toreal(0), toreal(CREDITS_USED_CLOUD_SERVICES_d)),
      QueryExecutionTime = toreal(column_ifexists('EXECUTION_TIME_d','0')),
      RoleName = column_ifexists('ROLE_NAME_s','')
    | extend
      User=TargetUsername,
      EventEndTime=iff(isnotempty(EVENT_TIMESTAMP_t), EVENT_TIMESTAMP_t, END_TIME_t)
  };
  let SnowflakeLogin_view = view () {
    SnowflakeLogin_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | mv-expand OuterArray = todynamic(Data)
    | mv-expand innerArray = OuterArray
    | extend JsonString = tostring(innerArray)
    | extend Time = extractjson("$.EVENT_TIMESTAMP", JsonString)
    | extend
      SrcDvcIpAddr = extractjson("$.CLIENT_IP", JsonString),
      LoginClientPrivateLinkId = extractjson("$.CLIENT_PRIVATE_LINK_ID", JsonString),
      LoginConnection = extractjson("$.CONNECTION", JsonString),
      LoginErrorCode = extractjson("$.ERROR_CODE", JsonString),
      LoginErrorMessage = extractjson("$.ERROR_MESSAGE", JsonString),
      LoginEventId = extractjson("$.EVENT_ID", JsonString),
      LoginEventEndTime = todatetime(substring(Time, 0, 23)) - tolong(substring(Time, 24, 3)) * 1h,
      LoginEventType = extractjson("$.EVENT_TYPE", JsonString),
      LoginFirstAuthenticationFactor = extractjson("$.FIRST_AUTHENTICATION_FACTOR", JsonString),
      LoginIsSuccess = extractjson("$.IS_SUCCESS", JsonString),
      LoginRelatedEventId = extractjson("$.RELATED_EVENT_ID", JsonString),
      LoginReportedClientType = extractjson("$.REPORTED_CLIENT_TYPE", JsonString),
      LoginReportedClientVersion = extractjson("$.REPORTED_CLIENT_VERSION", JsonString),
      LoginSecondAuthenticationFactor = extractjson("$.SECOND_AUTHENTICATION_FACTOR", JsonString),
      TargetUsername = extractjson("$.USER_NAME", JsonString)
    | extend User = TargetUsername
  };
  let SnowflakeUserGrant_view = view () {
  SnowflakeUserGrant_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | mv-expand OuterArray = todynamic(Data)
    | mv-expand innerArray = OuterArray
    | extend JsonString = tostring(innerArray)
    | extend
      CTime = extractjson("$.CREATED_ON", JsonString),
      DTime = extractjson("$.DELETED_ON", JsonString)
    | extend
      UserGrantCreatedOn = todatetime(substring(CTime, 0, 23)) - tolong(substring(CTime, 24, 3)) * 1h,
      UserGrantDeletedOn = todatetime(substring(DTime, 0, 23)) - tolong(substring(DTime, 24, 3)) * 1h,
      UserRole = extractjson("$.ROLE", JsonString),
      UserGrantGrantedTo = extractjson("$.GRANTED_TO", JsonString),
      UserGrantGranteeName = extractjson("$.GRANTEE_NAME", JsonString),
      UserGrantGrantedBy = extractjson("$.GRANTED_BY", JsonString)
  };
  let SnowflakeMaterializedView_view = view () {
    SnowflakeMaterializedView_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | mv-expand OuterArray = todynamic(Data)
    | mv-expand innerArray = OuterArray
    | extend JsonString = tostring(innerArray)
    | extend
      STime = extractjson("$.START_TIME", JsonString),
      ETime = extractjson("$.END_TIME", JsonString)
    | extend
      MaterializedViewStartTime = todatetime(substring(STime, 0, 23)) - tolong(substring(STime, 24, 3)) * 1h,
      MaterializedViewEndTime = todatetime(substring(ETime, 0, 23)) - tolong(substring(ETime, 24, 3)) * 1h,
      MaterializedViewCreditsUsed = extractjson("$.CREDITS_USED", JsonString),
      MaterializedViewTableId = extractjson("$.TABLE_ID", JsonString),
      MaterializedViewTableName = extractjson("$.TABLE_NAME", JsonString),
      MaterializedViewSchemaId = extractjson("$.SCHEMA_ID", JsonString),
      MaterializedViewSchemaName = extractjson("$.SCHEMA_NAME", JsonString),
      MaterializedViewDatabaseId = extractjson("$.DATABASE_ID", JsonString),
      MaterializedViewDatabaseName = extractjson("$.DATABASE_NAME", JsonString)
  };
  let SnowflakeRoles_view = view () {
    SnowflakeRoles_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | mv-expand OuterArray = todynamic(Data)
    | mv-expand innerArray = OuterArray
    | extend JsonString = tostring(innerArray)
    | extend
      CTime = extractjson("$.CREATED_ON", JsonString),
      DTime = extractjson("$.DELETED_ON", JsonString)
    | extend
      RoleId = extractjson("$.ROLE_ID", JsonString),
      RoleCreatedOn = todatetime(substring(CTime, 0, 23)) - tolong(substring(CTime, 24, 3)) * 1h,
      RoleDeletedOn = todatetime(substring(DTime, 0, 23)) - tolong(substring(DTime, 24, 3)) * 1h,
      RoleName = extractjson("$.NAME", JsonString),
      RoleComment = extractjson("$.COMMENT", JsonString),
      RoleOwner = extractjson("$.OWNER", JsonString),
      RoleType = extractjson("$.ROLE_TYPE", JsonString),
      RoleDatabaseName = extractjson("$.ROLE_DATABASE_NAME", JsonString),
      RoleInstanceId = extractjson("$.ROLE_INSTANCE_ID", JsonString),
      OwnerRoleType = extractjson("$.OWNER_ROLE_TYPE", JsonString)
  };
  let SnowflakeRoleGrant_view = view () {
    SnowflakeRoleGrant_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | mv-expand OuterArray = todynamic(Data)
    | mv-expand innerArray = OuterArray
    | extend JsonString = tostring(innerArray)
    | extend
      CTime = extractjson("$.CREATED_ON", JsonString),
      MTime = extractjson("$.MODIFIED_ON", JsonString),
      DTime = extractjson("$.DELETED_ON", JsonString)
    | extend
      RoleGrantCreatedOn = todatetime(substring(CTime, 0, 23)) - tolong(substring(CTime, 24, 3)) * 1h,
      RoleGrantModifiedOn = todatetime(substring(MTime, 0, 23)) - tolong(substring(MTime, 24, 3)) * 1h,
      RoleGrantPrivilege = extractjson("$.PRIVILEGE", JsonString),
      RoleGrantGrantedOn = extractjson("$.GRANTED_ON", JsonString),
      RoleGrantName = extractjson("$.NAME", JsonString),
      RoleGrantTableCatalog = extractjson("$.TABLE_CATALOG", JsonString),
      RoleGrantTableSchema = extractjson("$.TABLE_SCHEMA", JsonString),
      RoleGrantGrantedTo = extractjson("$.GRANTED_TO", JsonString),
      RoleGrantGranteeName = extractjson("$.GRANTEE_NAME", JsonString),
      RoleGrantGrantOption = extractjson("$.GRANT_OPTION", JsonString),
      RoleGrantGrantedBy = extractjson("$.GRANTED_BY", JsonString),
      RoleGrantDeletedOn = todatetime(substring(DTime, 0, 23)) - tolong(substring(DTime, 24, 3)) * 1h,
      RoleGrantGrantedByRoleType = extractjson("$.GRANTED_BY_ROLE_TYPE", JsonString),
      RoleGrantObjectInstance = extractjson("$.OBJECT_INSTANCE", JsonString)
  };
  let SnowflakeLoad_view = view () {
    SnowflakeLoad_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | mv-expand OuterArray = todynamic(Data)
    | mv-expand innerArray = OuterArray
    | extend JsonString = tostring(innerArray)
    | extend LTime = extractjson("$.LAST_LOAD_TIME", JsonString)
    | extend
      LoadTableId = extractjson("$.TABLE_ID", JsonString),
      LoadTableName = extractjson("$.TABLE_NAME", JsonString),
      LoadSchemaId = extractjson("$.SCHEMA_ID", JsonString),
      LoadSchemaName = extractjson("$.SCHEMA_NAME", JsonString),
      LoadCatalogId = extractjson("$.CATALOG_ID", JsonString),
      LoadCatalogName = extractjson("$.CATALOG_NAME", JsonString),
      LoadFileName = extractjson("$.FILE_NAME", JsonString),
      LastLoadTime = todatetime(substring(LTime, 0, 23)) - tolong(substring(LTime, 24, 3)) * 1h,
      LoadStatus = extractjson("$.STATUS", JsonString),
      LoadRowCount = extractjson("$.ROW_COUNT", JsonString),
      LoadRowParsed = extractjson("$.ROW_PARSED", JsonString),
      LoadFirstErrorMessage = extractjson("$.FIRST_ERROR_MESSAGE", JsonString),
      LoadFirstErrorLineNumber = extractjson("$.FIRST_ERROR_LINE_NUMBER", JsonString),
      LoadFirstErrorCharacterPosition = extractjson("$.FIRST_ERROR_CHARACTER_POSITION", JsonString),
      LoadFirstErrorColName = extractjson("$.FIRST_ERROR_COL_NAME", JsonString),
      LoadErrorCount = extractjson("$.ERROR_COUNT", JsonString),
      LoadErrorLimit = extractjson("$.ERROR_LIMIT", JsonString)
  };
  let SnowflakeTableStorageMetrics_view = view () {
    SnowflakeTableStorageMetrics_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | mv-expand OuterArray = todynamic(Data)
    | mv-expand innerArray = OuterArray
    | extend JsonString = tostring(innerArray)
    | extend
      TCTime = extractjson("$.TABLE_CREATED", JsonString),
      TDTime = extractjson("$.TABLE_DROPPED", JsonString),
      TFTime = extractjson("$.TABLE_ENTERED_FAILSAFE", JsonString),
      SCTime = extractjson("$.SCHEMA_CREATED", JsonString),
      SDTime = extractjson("$.SCHEMA_DROPPED", JsonString),
      CCTime = extractjson("$.CATALOG_CREATED", JsonString),
      CDTime = extractjson("$.CATALOG_DROPPED", JsonString)
    | extend
      TableStorageMetricsId = extractjson("$.ID", JsonString),
      TableStorageMetricsTableName = extractjson("$.TABLE_NAME", JsonString),
      TableStorageMetricsTableSchemaId = extractjson("$.TABLE_SCHEMA_ID", JsonString),
      TableStorageMetricsTableSchema = extractjson("$.TABLE_SCHEMA", JsonString),
      TableStorageMetricsTableCatalogId = extractjson("$.TABLE_CATALOG_ID", JsonString),
      TableStorageMetricsTableCatalog = extractjson("$.TABLE_CATALOG", JsonString),
      TableStorageMetricsCloneGroupId = extractjson("$.CLONE_GROUP_ID", JsonString),
      TableStorageMetricsIsTransient = extractjson("$.IS_TRANSIENT", JsonString),
      TableStorageMetricsActiveBytes = extractjson("$.ACTIVE_BYTES", JsonString),
      TableStorageMetricsTimeTravelBytes = extractjson("$.TIME_TRAVEL_BYTES", JsonString),
      TableStorageMetricsFailsafeBytes = extractjson("$.FAILSAFE_BYTES", JsonString),
      TableStorageMetricsRetainedForCloneBytes = extractjson("$.RETAINED_FOR_CLONE_BYTES", JsonString),
      TableStorageMetricsDeleted = extractjson("$.DELETED", JsonString),
      TableStorageMetricsTableCreated = todatetime(substring(TCTime, 0, 23)) - tolong(substring(TCTime, 24, 3)) * 1h,
      TableStorageMetricsTableDropped = todatetime(substring(TDTime, 0, 23)) - tolong(substring(TDTime, 24, 3)) * 1h,
      TableStorageMetricsTableEnteredFailsafe = todatetime(substring(TFTime, 0, 23)) - tolong(substring(TFTime, 24, 3)) * 1h,
      TableStorageMetricsSchemaCreated = todatetime(substring(SCTime, 0, 23)) - tolong(substring(SCTime, 24, 3)) * 1h,
      TableStorageMetricsSchemaDropped = todatetime(substring(SDTime, 0, 23)) - tolong(substring(SDTime, 24, 3)) * 1h,
      TableStorageMetricsCatalogCreated = todatetime(substring(CCTime, 0, 23)) - tolong(substring(CCTime, 24, 3)) * 1h,
      TableStorageMetricsCatalogDropped = todatetime(substring(CDTime, 0, 23)) - tolong(substring(CDTime, 24, 3)) * 1h,
      TableStorageMetricsComment = extractjson("$.COMMENT", JsonString),
      TableStorageMetricsInstanceId = extractjson("$.INSTANCE_ID", JsonString)
  };
  let SnowflakeTables_view = view () {
    SnowflakeTables_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | mv-expand OuterArray = todynamic(Data)
    | mv-expand innerArray = OuterArray
    | extend JsonString = tostring(innerArray)
    | extend
      TCTime = extractjson("$.CREATED", JsonString),
      LATime = extractjson("$.LAST_ALTERED", JsonString),
      LDTime = extractjson("$.LAST_DDL", JsonString),
      TDTime = extractjson("$.DELETED", JsonString)
    | extend
      TableId = extractjson("$.TABLE_ID", JsonString),
      TableName = extractjson("$.TABLE_NAME", JsonString),
      TableSchemaId = extractjson("$.TABLE_SCHEMA_ID", JsonString),
      TableSchema = extractjson("$.TABLE_SCHEMA", JsonString),
      TableCatalogId = extractjson("$.TABLE_CATALOG_ID", JsonString),
      TableCatalog = extractjson("$.TABLE_CATALOG", JsonString),
      TableOwner = extractjson("$.TABLE_OWNER", JsonString),
      TableType = extractjson("$.TABLE_TYPE", JsonString),
      TableIsTransient = extractjson("$.IS_TRANSIENT", JsonString),
      TableIsIceberg = extractjson("$.IS_ICEBERG", JsonString),
      TableIsDynamic = extractjson("$.IS_DYNAMIC", JsonString),
      TableIsHybrid = extractjson("$.IS_HYBRID", JsonString),
      TableClusteringKey = extractjson("$.CLUSTERING_KEY", JsonString),
      TableRowCount = extractjson("$.ROW_COUNT", JsonString),
      TableBytes = extractjson("$.BYTES", JsonString),
      TableRetentionTime = extractjson("$.RETENTION_TIME", JsonString),
      TableSelfReferencingColumnName = extractjson("$.SELF_REFERENCING_COLUMN_NAME", JsonString),
      TableReferenceGeneration = extractjson("$.REFERENCE_GENERATION", JsonString),
      TableUserDefinedTypeCatalog = extractjson("$.USER_DEFINED_TYPE_CATALOG", JsonString),
      TableUserDefinedTypeSchema = extractjson("$.USER_DEFINED_TYPE_SCHEMA", JsonString),
      TableUserDefinedTypeName = extractjson("$.USER_DEFINED_TYPE_NAME", JsonString),
      TableIsInsertableInto = extractjson("$.IS_INSERTABLE_INTO", JsonString),
      TableIsTyped = extractjson("$.IS_TYPED", JsonString),
      TableCommitAction = extractjson("$.COMMIT_ACTION", JsonString),
      TableCreated = todatetime(substring(TCTime, 0, 23)) - tolong(substring(TCTime, 24, 3)) * 1h,
      TableLastAltered = todatetime(substring(LATime, 0, 23)) - tolong(substring(LATime, 24, 3)) * 1h,
      TableLastDDL = todatetime(substring(LDTime, 0, 23)) - tolong(substring(LDTime, 24, 3)) * 1h,
      TableLastDDLBy = extractjson("$.LAST_DDL_BY", JsonString),
      TableDeleted = todatetime(substring(TDTime, 0, 23)) - tolong(substring(TDTime, 24, 3)) * 1h,
      TableAutoClusteringOn = extractjson("$.AUTO_CLUSTERING_ON", JsonString),
      TableComment = extractjson("$.COMMENT", JsonString),
      TableOwnerRoleType = extractjson("$.OWNER_ROLE_TYPE", JsonString),
      TableInstanceId = extractjson("$.INSTANCE_ID", JsonString)
  };
  let SnowflakeUsers_view = view () {
    SnowflakeUsers_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | mv-expand OuterArray = todynamic(Data)
    | mv-expand innerArray = OuterArray
    | extend JsonString = tostring(innerArray)
    | extend
      CTime = extractjson("$.CREATED_ON", JsonString),
      DTime = extractjson("$.DELETED_ON", JsonString),
      BMTime = extractjson("$.BYPASS_MFA_UNTIL", JsonString),
      LSLTime = extractjson("$.LAST_SUCCESS_LOGIN", JsonString),
      ETime = extractjson("$.EXPIRES_AT", JsonString),
      LUTime = extractjson("$.LOCKED_UNTIL_TIME", JsonString),
      PLSTime = extractjson("$.PASSWORD_LAST_SET_TIME", JsonString)
    | extend
      UserId = extractjson("$.USER_ID", JsonString),
      UserName = extractjson("$.NAME", JsonString),
      UserCreatedOn = extractjson("$.CREATED_ON", JsonString),
      UserDeletedOn = extractjson("$.DELETED_ON", JsonString),
      UserLoginName = extractjson("$.LOGIN_NAME", JsonString),
      UserDisplayName = extractjson("$.DISPLAY_NAME", JsonString),
      UserFirstName = extractjson("$.FIRST_NAME", JsonString),
      UserLastName = extractjson("$.LAST_NAME", JsonString),
      UserEmail = extractjson("$.EMAIL", JsonString),
      UserMustChangePassword = extractjson("$.MUST_CHANGE_PASSWORD", JsonString),
      UserHasPassword = extractjson("$.HAS_PASSWORD", JsonString),
      UserComment = extractjson("$.COMMENT", JsonString),
      UserDisabled = extractjson("$.DISABLED", JsonString),
      UserSnowflakeLock = extractjson("$.SNOWFLAKE_LOCK", JsonString),
      UserDefaultWarehouse = extractjson("$.DEFAULT_WAREHOUSE", JsonString),
      UserDefaultNamespace = extractjson("$.DEFAULT_NAMESPACE", JsonString),
      UserDefaultRole = extractjson("$.DEFAULT_ROLE", JsonString),
      UserExtAuthnDuo = extractjson("$.EXT_AUTHN_DUO", JsonString),
      UserExtAuthnUid = extractjson("$.EXT_AUTHN_UID", JsonString),
      UserHasMFA = extractjson("$.HAS_MFA", JsonString),
      UserBypassMFAUntil = todatetime(substring(BMTime, 0, 23)) - tolong(substring(BMTime, 24, 3)) * 1h,
      UserLastSuccessLogin = todatetime(substring(LSLTime, 0, 23)) - tolong(substring(LSLTime, 24, 3)) * 1h,
      UserExpiresAt = todatetime(substring(ETime, 0, 23)) - tolong(substring(ETime, 24, 3)) * 1h,
      UserLockedUntilTime = todatetime(substring(LUTime, 0, 23)) - tolong(substring(LUTime, 24, 3)) * 1h,
      UserHasRSAPublicKey = extractjson("$.HAS_RSA_PUBLIC_KEY", JsonString),
      UserPasswordLastSetTime = todatetime(substring(PLSTime, 0, 23)) - tolong(substring(PLSTime, 24, 3)) * 1h,
      UserOwner = extractjson("$.OWNER", JsonString),
      UserDefaultSecondaryRole = extractjson("$.DEFAULT_SECONDARY_ROLE", JsonString),
      UserType = extractjson("$.TYPE", JsonString),
      UserDatabaseName = extractjson("$.DATABASE_NAME", JsonString),
      UserDatabaseId = extractjson("$.DATABASE_ID", JsonString),
      UserSchemaName = extractjson("$.SCHEMA_NAME", JsonString),
      UserSchemaId = extractjson("$.SCHEMA_ID", JsonString)
  };
  let SnowflakeQuery_view = view () {
    SnowflakeQuery_CL
    | extend EventVendor = 'Snowflake'
    | extend EventProduct = 'Snowflake'
    | mv-expand OuterArray = todynamic(Data)
    | mv-expand innerArray = OuterArray
    | extend JsonString = tostring(innerArray)
    | extend
      QSTime = extractjson("$.START_TIME", JsonString),
      QETime = extractjson("$.END_TIME", JsonString),
      QueryTotalElapsedTime = toreal(extractjson("$.TOTAL_ELAPSED_TIME", JsonString)),
      QueryExecutionTime = toreal(extractjson("$.EXECUTION_TIME", JsonString))
    | extend
      QueryStartTime = todatetime(substring(QSTime, 0, 23)) - tolong(substring(QSTime, 24, 3)) * 1h,
      QueryEndTime = todatetime(substring(QETime, 0, 23)) - tolong(substring(QETime, 24, 3)) * 1h
    | extend
      QueryId = extractjson("$.QUERY_ID", JsonString),
      QueryText = extractjson("$.QUERY_TEXT", JsonString),
      QueryDatabaseId = extractjson("$.DATABASE_ID", JsonString),
      QueryDatabaseName = extractjson("$.DATABASE_NAME", JsonString),
      QuerySchemaId = extractjson("$.SCHEMA_ID", JsonString),
      QuerySchemaName = extractjson("$.SCHEMA_NAME", JsonString),
      QueryType = extractjson("$.QUERY_TYPE", JsonString),
      QuerySessionId = extractjson("$.SESSION_ID", JsonString),
      QueryUserName = extractjson("$.USER_NAME", JsonString),
      QueryRoleName = extractjson("$.ROLE_NAME", JsonString),
      QueryWarehouseId = extractjson("$.WAREHOUSE_ID", JsonString),
      QueryWarehouseName = extractjson("$.WAREHOUSE_NAME", JsonString),
      QueryWarehouseSize = extractjson("$.WAREHOUSE_SIZE", JsonString),
      QueryWarehouseType = extractjson("$.WAREHOUSE_TYPE", JsonString),
      QueryClusterNumber = extractjson("$.CLUSTER_NUMBER", JsonString),
      QueryTag = extractjson("$.TAG", JsonString),
      QueryBytesScanned = extractjson("$.BYTES_SCANNED", JsonString),
      QueryPercentageScannedFromCache = extractjson("$.PERCENTAGE_SCANNED_FROM_CACHE", JsonString),
      QueryBytesWritten = extractjson("$.BYTES_WRITTEN", JsonString),
      QueryBytesWrittenToResult = extractjson("$.BYTES_WRITTEN_TO_RESULT", JsonString),
      QueryBytesReadFromResult = extractjson("$.BYTES_READ_FROM_RESULT", JsonString),
      QueryRowsProduced = extractjson("$.ROWS_PRODUCED", JsonString),
      QueryRowsInserted = extractjson("$.ROWS_INSERTED", JsonString),
      QueryRowsUpdated = extractjson("$.ROWS_UPDATED", JsonString),
      QueryRowsDeleted = extractjson("$.ROWS_DELETED", JsonString),
      QueryRowsUnloaded = extractjson("$.ROWS_UNLOADED", JsonString),
      QueryBytesDeleted = extractjson("$.BYTES_DELETED", JsonString),
      QueryQueuedProvisioningTime = extractjson("$.PROVISIONING_TIME", JsonString),
      QueryQueuedRepairTime = extractjson("$.QUEUED_REPAIR_TIME", JsonString),
      QueryQueuedOverloadTime = extractjson("$.QUEUED_OVERLOAD_TIME", JsonString),
      QueryTransactionBlockedTime = extractjson("$.TRANSACTION_BLOCKED_TIME", JsonString),
      QueryOutboundDataTransferCloud = extractjson("$.OUTBOUND_DATA_TRANSFER_CLOUD", JsonString),
      QueryOutboundDataTransferRegion = extractjson("$.OUTBOUND_DATA_TRANSFER_REGION", JsonString),
      QueryOutboundDataTransferBytes = extractjson("$.OUTBOUND_DATA_TRANSFER_BYTES", JsonString),
      QueryInboundDataTransferCloud = extractjson("$.INBOUND_DATA_TRANSFER_CLOUD", JsonString),
      QueryInboundDataTransferRegion = extractjson("$.INBOUND_DATA_TRANSFER_REGION", JsonString),
      QueryInboundDataTransferBytes = extractjson("$.INBOUND_DATA_TRANSFER_BYTES", JsonString),
      QueryPartitionsScanned = extractjson("$.PARTITIONS_SCANNED", JsonString),
      QueryPartitionsTotal = extractjson("$.PARTITIONS_TOTAL", JsonString),
      QueryBytesSpilledToLocalStorage = extractjson("$.BYTES_SPILLED_TO_LOCAL_STORAGE", JsonString),
      QueryBytesSpilledToRemoteStorage = extractjson("$.BYTES_SPILLED_TO_REMOTE_STORAGE", JsonString),
      QueryBytesSentOverTheNetwork = extractjson("$.BYTES_SENT_OVER_THE_NETWORK", JsonString),
      QueryCompilationTime = extractjson("$.COMPILATION_TIME", JsonString),
      QueryExecutionStatus = extractjson("$.EXECUTION_STATUS", JsonString),
      QueryErrorCode = extractjson("$.ERROR_CODE", JsonString),
      QueryErrorMessage = extractjson("$.ERROR_MESSAGE", JsonString),
      QueryListExternalFilesTime = extractjson("$.LIST_EXTERNAL_FILES_TIME", JsonString),
      QueryCreditsUsedCloudServices = iff(isempty(extractjson("$.CREDITS_USED_CLOUD_SERVICES", JsonString)), toreal(0), toreal(extractjson("$.CREDITS_USED_CLOUD_SERVICES", JsonString))),
      QueryReleaseVersion = extractjson("$.RELEASE_VERSION", JsonString),
      QueryExternalFunctionTotalInvocations = extractjson("$.EXTERNAL_FUNCTION_TOTAL_INVOCATIONS", JsonString),
      QueryExternalFunctionTotalSentRows = extractjson("$.EXTERNAL_FUNCTION_TOTAL_SENT_ROWS", JsonString),
      QueryExternalFunctionTotalReceivedRows = extractjson("$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS", JsonString),
      QueryExternalFunctionTotalSentBytes = extractjson("$.EXTERNAL_FUNCTION_TOTAL_SENT_BYTES", JsonString),
      QueryExternalFunctionTotalReceivedBytes = extractjson("$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES", JsonString),
      QueryIsClientGeneratedStatement = extractjson("$.IS_CLIENT_GENERATED_STATEMENT", JsonString),
      QueryAccelerationBytesScanned = extractjson("$.ACCELERATION_BYTES_SCANNED", JsonString),
      QueryAccelerationPartitionsScanned = extractjson("$.ACCELERATION_PARTITIONS_SCANNED", JsonString),
      QueryAccelerationUpperLimitScaleFactor = extractjson("$.ACCELERATION_UPPER_LIMIT_SCALE_FACTOR", JsonString),
      QueryTransactionId = extractjson("$.TRANSACTION_ID", JsonString),
      QueryLoadPercent = extractjson("$.QUERY_LOAD_PERCENT", JsonString),
      ChildQueriesWaitTime = extractjson("$.CHILD_QUERIES_WAIT_TIME", JsonString),
      QueryRoleType = extractjson("$.ROLE_TYPE", JsonString),
      QueryHash = extractjson("$.HASH", JsonString),
      QueryHashVersion = extractjson("$.HASH_VERSION", JsonString),
      QueryParameterizedHash = extractjson("$.PARAMETERIZED_HASH", JsonString),
      QueryParameterizedHashVersion = extractjson("$.PARAMETERIZED_HASH_VERSION", JsonString),
      QuerySecondaryRoleStats = extractjson("$.SECONDARY_ROLE_STATS", JsonString),
      QueryRowsWrittenToResult = extractjson("$.ROWS_WRITTEN_TO_RESULT", JsonString),
      QueryRetryTime = extractjson("$.RETRY_TIME", JsonString),
      QueryRetryCause = extractjson("$.RETRY_CAUSE", JsonString),
      QueryFaultHandlingTime = extractjson("$.FAULT_HANDLING_TIME", JsonString),
      QueryUserType = extractjson("$.USER_TYPE", JsonString),
      QueryUserDatabaseName = extractjson("$.USER_DATABASE_NAME", JsonString),
      QueryUserDatabaseId = extractjson("$.USER_DATABASE_ID", JsonString),
      QueryUserSchemaId = extractjson("$.USER_SCHEMA_ID", JsonString),
      QueryUserSchemaName = extractjson("$.USER_SCHEMA_NAME", JsonString)
  };
  union isfuzzy=true
      (Snowflake_view),
      (SnowflakeLogin_view),
      (SnowflakeUserGrant_view),
      (SnowflakeMaterializedView_view),
      (SnowflakeRoles_view),
      (SnowflakeRoleGrant_view),
      (SnowflakeLoad_view),
      (SnowflakeTableStorageMetrics_view),
      (SnowflakeTables_view),
      (SnowflakeUsers_view),
      (SnowflakeQuery_view)
  | extend DatabaseName = coalesce(QueryDatabaseName, UserDatabaseName, RoleDatabaseName, MaterializedViewDatabaseName)
  | extend TableNames = coalesce(TableName, MaterializedViewTableName, LoadTableName, TableStorageMetricsTableName)
  | extend EventStartTime = column_ifexists('EventStartTime', '')
  | project
      EventVendor,
      EventProduct,
      EventStartTime,
      LoginEventType,
      TargetUsername,
      SrcDvcIpAddr,
      User,
      LoginEventEndTime,
      LoginEventId,
      LoginReportedClientType,
      LoginReportedClientVersion,
      LoginFirstAuthenticationFactor,
      LoginSecondAuthenticationFactor,
      LoginIsSuccess,
      LoginErrorCode,
      LoginErrorMessage,
      LoginRelatedEventId,
      LoginConnection,
      LoginClientPrivateLinkId,
      UserGrantCreatedOn,
      UserGrantDeletedOn,
      UserRole,
      UserGrantGrantedTo,
      UserGrantGranteeName,
      UserGrantGrantedBy,
      MaterializedViewStartTime,
      MaterializedViewEndTime,
      MaterializedViewCreditsUsed,
      MaterializedViewTableId,
      MaterializedViewTableName,
      MaterializedViewSchemaId,
      MaterializedViewSchemaName,
      MaterializedViewDatabaseId,
      MaterializedViewDatabaseName,
      RoleId,
      RoleCreatedOn,
      RoleDeletedOn,
      RoleName,
      RoleComment,
      RoleOwner,
      RoleType,
      RoleDatabaseName,
      RoleInstanceId,
      OwnerRoleType,
      RoleGrantCreatedOn,
      RoleGrantModifiedOn,
      RoleGrantPrivilege,
      RoleGrantGrantedOn,
      RoleGrantName,
      RoleGrantTableCatalog,
      RoleGrantTableSchema,
      RoleGrantGrantedTo,
      RoleGrantGranteeName,
      RoleGrantGrantOption,
      RoleGrantGrantedBy,
      RoleGrantDeletedOn,
      RoleGrantGrantedByRoleType,
      RoleGrantObjectInstance,
      LoadTableId,
      LoadTableName,
      LoadSchemaId,
      LoadSchemaName,
      LoadCatalogId,
      LoadCatalogName,
      LoadFileName,
      LastLoadTime,
      LoadStatus,
      LoadRowCount,
      LoadRowParsed,
      LoadFirstErrorMessage,
      LoadFirstErrorLineNumber,
      LoadFirstErrorCharacterPosition,
      LoadFirstErrorColName,
      LoadErrorCount,
      LoadErrorLimit,
      TableStorageMetricsId,
      TableStorageMetricsTableName,
      TableStorageMetricsTableSchemaId,
      TableStorageMetricsTableSchema,
      TableStorageMetricsTableCatalogId,
      TableStorageMetricsTableCatalog,
      TableStorageMetricsCloneGroupId,
      TableStorageMetricsIsTransient,
      TableStorageMetricsActiveBytes,
      TableStorageMetricsTimeTravelBytes,
      TableStorageMetricsFailsafeBytes,
      TableStorageMetricsRetainedForCloneBytes,
      TableStorageMetricsDeleted,
      TableStorageMetricsTableCreated,
      TableStorageMetricsTableDropped,
      TableStorageMetricsTableEnteredFailsafe,
      TableStorageMetricsSchemaCreated,
      TableStorageMetricsSchemaDropped,
      TableStorageMetricsCatalogCreated,
      TableStorageMetricsCatalogDropped,
      TableStorageMetricsComment,
      TableStorageMetricsInstanceId,
      TableId,
      TableName,
      TableNames,
      TableSchemaId,
      TableSchema,
      TableCatalogId,
      TableCatalog,
      TableOwner,
      TableType,
      TableIsTransient,
      TableIsIceberg,
      TableIsDynamic,
      TableIsHybrid,
      TableClusteringKey,
      TableRowCount,
      TableBytes,
      TableRetentionTime,
      TableSelfReferencingColumnName,
      TableReferenceGeneration,
      TableUserDefinedTypeCatalog,
      TableUserDefinedTypeSchema,
      TableUserDefinedTypeName,
      TableIsInsertableInto,
      TableIsTyped,
      TableCommitAction,
      TableCreated,
      TableLastAltered,
      TableLastDDL,
      TableLastDDLBy,
      TableDeleted,
      TableAutoClusteringOn,
      TableComment,
      TableOwnerRoleType,
      TableInstanceId,
      UserId,
      UserName,
      UserCreatedOn,
      UserDeletedOn,
      UserLoginName,
      UserDisplayName,
      UserFirstName,
      UserLastName,
      UserEmail,
      UserMustChangePassword,
      UserHasPassword,
      UserComment,
      UserDisabled,
      UserSnowflakeLock,
      UserDefaultWarehouse,
      UserDefaultNamespace,
      UserDefaultRole,
      UserExtAuthnDuo,
      UserExtAuthnUid,
      UserHasMFA,
      UserBypassMFAUntil,
      UserLastSuccessLogin,
      UserExpiresAt,
      UserLockedUntilTime,
      UserHasRSAPublicKey,
      UserPasswordLastSetTime,
      UserOwner,
      UserDefaultSecondaryRole,
      UserType,
      UserDatabaseName,
      UserDatabaseId,
      UserSchemaName,
      UserSchemaId,
      QueryId,
      QueryText,
      QueryDatabaseId,
      QueryDatabaseName,
      QuerySchemaId,
      QuerySchemaName,
      QueryType,
      QuerySessionId,
      QueryUserName,
      QueryRoleName,
      QueryWarehouseId,
      QueryWarehouseName,
      QueryWarehouseSize,
      QueryWarehouseType,
      QueryClusterNumber,
      QueryTag,
      QueryExecutionStatus,
      QueryErrorCode,
      QueryErrorMessage,
      QueryStartTime,
      QueryTotalElapsedTime,
      QueryBytesScanned,
      QueryPercentageScannedFromCache,
      QueryBytesWritten,
      QueryBytesWrittenToResult,
      QueryBytesReadFromResult,
      QueryRowsProduced,
      QueryRowsInserted,
      QueryRowsUpdated,
      QueryRowsDeleted,
      QueryRowsUnloaded,
      QueryBytesDeleted,
      QueryPartitionsScanned,
      QueryPartitionsTotal,
      QueryBytesSpilledToLocalStorage,
      QueryBytesSpilledToRemoteStorage,
      QueryBytesSentOverTheNetwork,
      QueryCompilationTime,
      QueryExecutionTime,
      QueryQueuedProvisioningTime,
      QueryQueuedRepairTime,
      QueryQueuedOverloadTime,
      QueryTransactionBlockedTime,
      QueryOutboundDataTransferCloud,
      QueryOutboundDataTransferRegion,
      QueryOutboundDataTransferBytes,
      QueryInboundDataTransferCloud,
      QueryInboundDataTransferRegion,
      QueryInboundDataTransferBytes,
      QueryListExternalFilesTime,
      QueryCreditsUsedCloudServices,
      QueryReleaseVersion,
      QueryExternalFunctionTotalInvocations,
      QueryExternalFunctionTotalSentRows,
      QueryExternalFunctionTotalReceivedRows,
      QueryExternalFunctionTotalSentBytes,
      QueryExternalFunctionTotalReceivedBytes,
      QueryLoadPercent,
      QueryIsClientGeneratedStatement,
      QueryAccelerationBytesScanned,
      QueryAccelerationPartitionsScanned,
      QueryAccelerationUpperLimitScaleFactor,
      QueryTransactionId,
      ChildQueriesWaitTime,
      QueryRoleType,
      QueryHash,
      QueryHashVersion,
      QueryParameterizedHash,
      QueryParameterizedHashVersion,
      QuerySecondaryRoleStats,
      QueryRowsWrittenToResult,
      QueryRetryTime,
      QueryRetryCause,
      QueryFaultHandlingTime,
      QueryUserType,
      QueryUserDatabaseName,
      QueryUserDatabaseId,
      QueryUserSchemaName,
      QueryUserSchemaId,
      DatabaseName,
      TimeGenerated,
      Type