{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for Snowflake"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Snowflake",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "Snowflake",
    "_solutionVersion": "3.0.7",
    "solutionId": "azuresentinel.azure-sentinel-solution-snowflake",
    "_solutionId": "[variables('solutionId')]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.2",
      "_analyticRulecontentId1": "09b8dfc7-87b0-4215-b34b-bab363d685cb",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '09b8dfc7-87b0-4215-b34b-bab363d685cb')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('09b8dfc7-87b0-4215-b34b-bab363d685cb')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','09b8dfc7-87b0-4215-b34b-bab363d685cb','-', '1.0.2')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.1",
      "_analyticRulecontentId2": "1376f5e5-855a-4f88-8591-19eba4575a0f",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '1376f5e5-855a-4f88-8591-19eba4575a0f')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('1376f5e5-855a-4f88-8591-19eba4575a0f')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','1376f5e5-855a-4f88-8591-19eba4575a0f','-', '1.0.1')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.2",
      "_analyticRulecontentId3": "5f8a81d9-7d27-4ff5-a0ce-4285ee02c2c8",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '5f8a81d9-7d27-4ff5-a0ce-4285ee02c2c8')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('5f8a81d9-7d27-4ff5-a0ce-4285ee02c2c8')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','5f8a81d9-7d27-4ff5-a0ce-4285ee02c2c8','-', '1.0.2')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.2",
      "_analyticRulecontentId4": "e05cc333-d499-430f-907c-7f28a9e4d1b5",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'e05cc333-d499-430f-907c-7f28a9e4d1b5')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('e05cc333-d499-430f-907c-7f28a9e4d1b5')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','e05cc333-d499-430f-907c-7f28a9e4d1b5','-', '1.0.2')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.2",
      "_analyticRulecontentId5": "b7d22407-1391-4256-b09a-414a9719443c",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'b7d22407-1391-4256-b09a-414a9719443c')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('b7d22407-1391-4256-b09a-414a9719443c')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','b7d22407-1391-4256-b09a-414a9719443c','-', '1.0.2')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.1",
      "_analyticRulecontentId6": "c2f93727-e4b0-4cb9-8f80-f52ebbd96ece",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'c2f93727-e4b0-4cb9-8f80-f52ebbd96ece')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('c2f93727-e4b0-4cb9-8f80-f52ebbd96ece')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','c2f93727-e4b0-4cb9-8f80-f52ebbd96ece','-', '1.0.1')))]"
    },
    "analyticRuleObject7": {
      "analyticRuleVersion7": "1.0.1",
      "_analyticRulecontentId7": "627a4ff1-036b-4375-a9f9-288d5e1d7d37",
      "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '627a4ff1-036b-4375-a9f9-288d5e1d7d37')]",
      "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('627a4ff1-036b-4375-a9f9-288d5e1d7d37')))]",
      "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','627a4ff1-036b-4375-a9f9-288d5e1d7d37','-', '1.0.1')))]"
    },
    "analyticRuleObject8": {
      "analyticRuleVersion8": "1.0.1",
      "_analyticRulecontentId8": "f258fa0c-e26c-4e2b-94fb-88b6cef0ca6e",
      "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'f258fa0c-e26c-4e2b-94fb-88b6cef0ca6e')]",
      "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('f258fa0c-e26c-4e2b-94fb-88b6cef0ca6e')))]",
      "_analyticRulecontentProductId8": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','f258fa0c-e26c-4e2b-94fb-88b6cef0ca6e','-', '1.0.1')))]"
    },
    "analyticRuleObject9": {
      "analyticRuleVersion9": "1.0.1",
      "_analyticRulecontentId9": "1dd1d9e5-3ebf-43cb-be07-6082d5eabe79",
      "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '1dd1d9e5-3ebf-43cb-be07-6082d5eabe79')]",
      "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('1dd1d9e5-3ebf-43cb-be07-6082d5eabe79')))]",
      "_analyticRulecontentProductId9": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','1dd1d9e5-3ebf-43cb-be07-6082d5eabe79','-', '1.0.1')))]"
    },
    "analyticRuleObject10": {
      "analyticRuleVersion10": "1.0.1",
      "_analyticRulecontentId10": "5ed33eee-0ab6-4bf5-9e9b-6100db83d39a",
      "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '5ed33eee-0ab6-4bf5-9e9b-6100db83d39a')]",
      "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('5ed33eee-0ab6-4bf5-9e9b-6100db83d39a')))]",
      "_analyticRulecontentProductId10": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','5ed33eee-0ab6-4bf5-9e9b-6100db83d39a','-', '1.0.1')))]"
    },
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "SnowflakeLogsCCPDefinition",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "SnowflakeLogsCCPDefinitionConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "huntingQueryObject1": {
      "huntingQueryVersion1": "1.0.0",
      "_huntingQuerycontentId1": "6aae5700-79da-4b41-98cc-f77bf7489f01",
      "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('6aae5700-79da-4b41-98cc-f77bf7489f01')))]"
    },
    "huntingQueryObject2": {
      "huntingQueryVersion2": "1.0.0",
      "_huntingQuerycontentId2": "09cc7b43-2ea1-464f-a72c-2ec187405505",
      "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('09cc7b43-2ea1-464f-a72c-2ec187405505')))]"
    },
    "huntingQueryObject3": {
      "huntingQueryVersion3": "1.0.0",
      "_huntingQuerycontentId3": "5736df91-ec99-4fb2-b162-a17607d20ee8",
      "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('5736df91-ec99-4fb2-b162-a17607d20ee8')))]"
    },
    "huntingQueryObject4": {
      "huntingQueryVersion4": "1.0.0",
      "_huntingQuerycontentId4": "fcc5f12b-bfa7-45f1-8722-a72eb77a5a4a",
      "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('fcc5f12b-bfa7-45f1-8722-a72eb77a5a4a')))]"
    },
    "huntingQueryObject5": {
      "huntingQueryVersion5": "1.0.0",
      "_huntingQuerycontentId5": "b4a062d1-c95b-4b55-b984-a7efbc2e3a0f",
      "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('b4a062d1-c95b-4b55-b984-a7efbc2e3a0f')))]"
    },
    "huntingQueryObject6": {
      "huntingQueryVersion6": "1.0.0",
      "_huntingQuerycontentId6": "6e8315eb-86a0-4a15-925d-a36c29d13bbd",
      "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('6e8315eb-86a0-4a15-925d-a36c29d13bbd')))]"
    },
    "huntingQueryObject7": {
      "huntingQueryVersion7": "1.0.0",
      "_huntingQuerycontentId7": "8f8a8ac1-82aa-4569-b3ec-46dbf2676bf0",
      "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('8f8a8ac1-82aa-4569-b3ec-46dbf2676bf0')))]"
    },
    "huntingQueryObject8": {
      "huntingQueryVersion8": "1.0.0",
      "_huntingQuerycontentId8": "98f57314-b6d3-4f3a-8e10-c691d8c946d5",
      "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('98f57314-b6d3-4f3a-8e10-c691d8c946d5')))]"
    },
    "huntingQueryObject9": {
      "huntingQueryVersion9": "1.0.0",
      "_huntingQuerycontentId9": "112311cc-6361-4c56-9520-1147371b01ac",
      "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('112311cc-6361-4c56-9520-1147371b01ac')))]"
    },
    "huntingQueryObject10": {
      "huntingQueryVersion10": "1.0.0",
      "_huntingQuerycontentId10": "169b4c88-10f5-42c2-a45f-0959689ca22a",
      "huntingQueryTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('169b4c88-10f5-42c2-a45f-0959689ca22a')))]"
    },
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','Snowflake')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'Snowflake')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('Snowflake-Parser')))]",
      "parserVersion1": "1.0.3",
      "parserContentId1": "Snowflake-Parser"
    },
    "workbookVersion1": "1.0.1",
    "workbookContentId1": "SnowflakeWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeDiscoveryActivity_AnalyticalRules Analytics Rule with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects possible discovery activity.",
                "displayName": "Snowflake - Possible discovery activity",
                "enabled": false,
                "query": "let threshold = 20;\nSnowflake\n| where QueryType =~ 'SHOW'\n| where QueryExecutionStatus =~ 'SUCCESS'\n| summarize count() by TargetUsername, bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend AccountCustomEntity = TargetUsername\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Snowflake"
                    ],
                    "connectorId": "Snowflake"
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "techniques": [
                  "T1526"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "Snowflake Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Snowflake - Possible discovery activity",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeLongQueryProcessTime_AnalyticalRules Analytics Rule with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects query with abnormal proccess time.",
                "displayName": "Snowflake - Abnormal query process time",
                "enabled": false,
                "query": "let threshold = 10000;\nSnowflake\n| where QueryTotalElapsedTime > threshold\n| extend AccountCustomEntity = TargetUsername\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Snowflake"
                    ],
                    "connectorId": "Snowflake"
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1499"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "Snowflake Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "Snowflake - Abnormal query process time",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeMultipleFailedQueries_AnalyticalRules Analytics Rule with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects multiple failed queries in short timeframe.",
                "displayName": "Snowflake - Multiple failed queries",
                "enabled": false,
                "query": "let threshold = 50;\nSnowflake\n| where QueryExecutionStatus !~ 'SUCCESS'\n| summarize count() by TargetUsername, bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend AccountCustomEntity = TargetUsername\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Snowflake"
                    ],
                    "connectorId": "Snowflake"
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "techniques": [
                  "T1518",
                  "T1082"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "Snowflake Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "Snowflake - Multiple failed queries",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeMultipleLoginFailure_AnalyticalRules Analytics Rule with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects multiple login failures by user.",
                "displayName": "Snowflake - Multiple login failures by user",
                "enabled": false,
                "query": "let threshold = 10;\nSnowflake\n| where EventType =~ 'LOGIN'\n| where LoginIsSuccess =~ 'No'\n| summarize count() by TargetUsername, bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend AccountCustomEntity = TargetUsername\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Snowflake"
                    ],
                    "connectorId": "Snowflake"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "Snowflake Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "Snowflake - Multiple login failures by user",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeMultipleLoginFailureFromIP_AnalyticalRules Analytics Rule with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects Mmltiple login failures from single IP.",
                "displayName": "Snowflake - Multiple login failures from single IP",
                "enabled": false,
                "query": "let threshold = 10;\nSnowflake\n| where EventType =~ 'LOGIN'\n| where LoginIsSuccess =~ 'No'\n| summarize count() by SrcDvcIpAddr, bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend IPCustomEntity = SrcDvcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Snowflake"
                    ],
                    "connectorId": "Snowflake"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "Snowflake Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "Snowflake - Multiple login failures from single IP",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakePossibleDataDestruction_AnalyticalRules Analytics Rule with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects possible data destruction.",
                "displayName": "Snowflake - Possible data destraction",
                "enabled": false,
                "query": "let threshold = 10;\nSnowflake\n| where QueryType =~ 'DROP'\n| where QueryExecutionStatus =~ 'SUCCESS'\n| summarize count() by TargetUsername, bin(TimeGenerated, 5m)\n| where count_ > threshold\n| extend AccountCustomEntity = TargetUsername\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Snowflake"
                    ],
                    "connectorId": "Snowflake"
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1485"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "Snowflake Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "Snowflake - Possible data destraction",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject7').analyticRuleTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakePrivilegesDiscovery_AnalyticalRules Analytics Rule with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject7').analyticRuleVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects possible privileges discovery activity.",
                "displayName": "Snowflake - Possible privileges discovery activity",
                "enabled": false,
                "query": "Snowflake\n| where QueryType =~ 'SHOW'\n| where QueryText has_all ('SHOW', 'ROLES')\n| extend AccountCustomEntity = TargetUsername\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Snowflake"
                    ],
                    "connectorId": "Snowflake"
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "techniques": [
                  "T1087"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject7').analyticRuleId7,'/'))))]",
              "properties": {
                "description": "Snowflake Analytics Rule 7",
                "parentId": "[variables('analyticRuleObject7').analyticRuleId7]",
                "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject7').analyticRuleVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
        "contentKind": "AnalyticsRule",
        "displayName": "Snowflake - Possible privileges discovery activity",
        "contentProductId": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "id": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject8').analyticRuleTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeQueryOnSensitiveTable_AnalyticalRules Analytics Rule with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject8').analyticRuleVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects query on sensitive or restricted table.",
                "displayName": "Snowflake - Query on sensitive or restricted table",
                "enabled": false,
                "query": "let r_tbl = dynamic(['table_name']);\nSnowflake\n| where QueryType =~ 'SELECT'\n| where QueryExecutionStatus =~ 'SUCCESS'\n| extend tbl = extract(@'(FROM|from)\\s(\\S+)\\s', 2, QueryText)\n| where tbl in~ (r_tbl)\n| extend AccountCustomEntity = TargetUsername\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Snowflake"
                    ],
                    "connectorId": "Snowflake"
                  }
                ],
                "tactics": [
                  "Collection"
                ],
                "techniques": [
                  "T1119"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject8').analyticRuleId8,'/'))))]",
              "properties": {
                "description": "Snowflake Analytics Rule 8",
                "parentId": "[variables('analyticRuleObject8').analyticRuleId8]",
                "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject8').analyticRuleVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
        "contentKind": "AnalyticsRule",
        "displayName": "Snowflake - Query on sensitive or restricted table",
        "contentProductId": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "id": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject9').analyticRuleTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeUnusualQuery_AnalyticalRules Analytics Rule with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject9').analyticRuleVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects unusual query.",
                "displayName": "Snowflake - Unusual query",
                "enabled": false,
                "query": "Snowflake\n| where QueryType =~ 'SELECT'\n| where QueryExecutionStatus =~ 'SUCCESS'\n| where QueryText startswith @'SELECT *'\n| extend AccountCustomEntity = TargetUsername\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Snowflake"
                    ],
                    "connectorId": "Snowflake"
                  }
                ],
                "tactics": [
                  "Collection"
                ],
                "techniques": [
                  "T1119"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject9').analyticRuleId9,'/'))))]",
              "properties": {
                "description": "Snowflake Analytics Rule 9",
                "parentId": "[variables('analyticRuleObject9').analyticRuleId9]",
                "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject9').analyticRuleVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
        "contentKind": "AnalyticsRule",
        "displayName": "Snowflake - Unusual query",
        "contentProductId": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "id": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject10').analyticRuleTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeUserAddAdminPrivileges_AnalyticalRules Analytics Rule with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject10').analyticRuleVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when user asigned admin privileges.",
                "displayName": "Snowflake - User granted admin privileges",
                "enabled": false,
                "query": "let adm_roles = dynamic(['SECURITYADMIN', 'SYSADMIN', 'ACCOUNTADMIN']);\nSnowflake\n| where QueryType =~ 'GRANT'\n| where QueryText startswith 'GRANT ROLE'\n| extend granted_role = extract(@'GRANT ROLE\\s(\\S+)\\sto\\suser', 1, QueryText)\n| where granted_role in~ (adm_roles)\n| extend usr = extract(@'GRANT ROLE\\s(\\S+)\\sto\\suser(\\S+)', 2, QueryText)\n| extend AccountCustomEntity = usr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Snowflake"
                    ],
                    "connectorId": "Snowflake"
                  }
                ],
                "tactics": [
                  "PrivilegeEscalation"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject10').analyticRuleId10,'/'))))]",
              "properties": {
                "description": "Snowflake Analytics Rule 10",
                "parentId": "[variables('analyticRuleObject10').analyticRuleId10]",
                "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject10').analyticRuleVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
        "contentKind": "AnalyticsRule",
        "displayName": "Snowflake - User granted admin privileges",
        "contentProductId": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "id": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "Snowflake (via Codeless Connector Framework)",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "SnowflakeLogsCCPDefinition",
                  "title": "Snowflake (via Codeless Connector Framework)",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": "The Snowflake data connector provides the capability to ingest Snowflake [Login History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/login_history), [Query History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/query_history), [User-Grant Logs](https://docs.snowflake.com/en/sql-reference/account-usage/grants_to_users), [Role-Grant Logs](https://docs.snowflake.com/en/sql-reference/account-usage/grants_to_roles), [Load History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/load_history), [Materialized View Refresh History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/materialized_view_refresh_history), [Roles Logs](https://docs.snowflake.com/en/sql-reference/account-usage/roles), [Tables Logs](https://docs.snowflake.com/en/sql-reference/account-usage/tables), [Table Storage Metrics Logs](https://docs.snowflake.com/en/sql-reference/account-usage/table_storage_metrics), [Users Logs](https://docs.snowflake.com/en/sql-reference/account-usage/users) into Microsoft Sentinel using the Snowflake SQL API. Refer to [Snowflake SQL API documentation](https://docs.snowflake.com/en/developer-guide/sql-api/reference) for more information.",
                  "graphQueries": [
                    {
                      "metricName": "Total Login events received",
                      "legend": "Snowflake Login History Logs",
                      "baseQuery": "SnowflakeLogin_CL"
                    },
                    {
                      "metricName": "Total Query events received",
                      "legend": "Snowflake Query History Logs",
                      "baseQuery": "SnowflakeQuery_CL"
                    },
                    {
                      "metricName": "Total Grants to User events received",
                      "legend": "Snowflake User Grant Logs",
                      "baseQuery": "SnowflakeUserGrant_CL"
                    },
                    {
                      "metricName": "Total Grants to Role events received",
                      "legend": "Snowflake Role Grant Logs",
                      "baseQuery": "SnowflakeRoleGrant_CL"
                    },
                    {
                      "metricName": "Total Load History events received",
                      "legend": "Snowflake Load History Logs",
                      "baseQuery": "SnowflakeLoad_CL"
                    },
                    {
                      "metricName": "Total Materialized View Refresh History events received",
                      "legend": "Snowflake Materialized View Refresh History Logs",
                      "baseQuery": "SnowflakeMaterializedView_CL"
                    },
                    {
                      "metricName": "Total Role Events received",
                      "legend": "Snowflake Roles Logs",
                      "baseQuery": "SnowflakeRoles_CL"
                    },
                    {
                      "metricName": "Total Table Events received",
                      "legend": "Snowflake Tables Logs",
                      "baseQuery": "SnowflakeTables_CL"
                    },
                    {
                      "metricName": "Total Table Storage Metrics Events received",
                      "legend": "Snowflake Table Storage Metrics Logs",
                      "baseQuery": "SnowflakeTableStorageMetrics_CL"
                    },
                    {
                      "metricName": "Total Users Events received",
                      "legend": "Snowflake Users Logs",
                      "baseQuery": "SnowflakeUsers_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Get Sample Login Events of Snowflake",
                      "query": "SnowflakeLogin_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend Time = toreal(extractjson(\"$.EVENT_TIMESTAMP\", JsonString))\r\n| extend\r\n    SrcDvcIpAddr = extractjson(\"$.CLIENT_IP\", JsonString),\r\n    LoginClientPrivateLinkId = extractjson(\"$.CLIENT_PRIVATE_LINK_ID\", JsonString),\r\n    LoginConnection = extractjson(\"$.CONNECTION\", JsonString),\r\n    LoginErrorCode = extractjson(\"$.ERROR_CODE\", JsonString),\r\n    LoginErrorMessage = extractjson(\"$.ERROR_MESSAGE\", JsonString),\r\n    LoginEventId = extractjson(\"$.EVENT_ID\", JsonString),\r\n    LoginEventEndTime = unixtime_seconds_todatetime(Time),\r\n    LoginEventType = extractjson(\"$.EVENT_TYPE\", JsonString),\r\n    LoginFirstAuthenticationFactor = extractjson(\"$.FIRST_AUTHENTICATION_FACTOR\", JsonString),\r\n    LoginIsSuccess = extractjson(\"$.IS_SUCCESS\", JsonString),\r\n    LoginRelatedEventId = extractjson(\"$.RELATED_EVENT_ID\", JsonString),\r\n    LoginReportedClientType = extractjson(\"$.REPORTED_CLIENT_TYPE\", JsonString),\r\n    LoginReportedClientVersion = extractjson(\"$.REPORTED_CLIENT_VERSION\", JsonString),\r\n    LoginSecondAuthenticationFactor = extractjson(\"$.SECOND_AUTHENTICATION_FACTOR\", JsonString),\r\n    TargetUsername = extractjson(\"$.USER_NAME\", JsonString)\r\n| extend User = TargetUsername\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
                    },
                    {
                      "description": "Get Sample Query Events of Snowflake",
                      "query": "SnowflakeQuery_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    QueryStartTime = unixtime_seconds_todatetime(toreal(extractjson(\"$.START_TIME\", JsonString))),\r\n    QueryEndTime = unixtime_seconds_todatetime(toreal(extractjson(\"$.END_TIME\", JsonString))),\r\n    QueryTotalElapsedTime = toreal(extractjson(\"$.TOTAL_ELAPSED_TIME\", JsonString)),\r\n    QueryExecutionTime = toreal(extractjson(\"$.EXECUTION_TIME\", JsonString))\r\n| extend\r\n    QueryId = extractjson(\"$.QUERY_ID\", JsonString),\r\n    QueryText = extractjson(\"$.QUERY_TEXT\", JsonString),\r\n    QueryDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\r\n    QueryDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString),\r\n    QuerySchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\r\n    QuerySchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    QueryType = extractjson(\"$.QUERY_TYPE\", JsonString),\r\n    QuerySessionId = extractjson(\"$.SESSION_ID\", JsonString),\r\n    QueryUserName = extractjson(\"$.USER_NAME\", JsonString),\r\n    QueryRoleName = extractjson(\"$.ROLE_NAME\", JsonString),\r\n    QueryWarehouseId = extractjson(\"$.WAREHOUSE_ID\", JsonString),\r\n    QueryWarehouseName = extractjson(\"$.WAREHOUSE_NAME\", JsonString),\r\n    QueryWarehouseSize = extractjson(\"$.WAREHOUSE_SIZE\", JsonString),\r\n    QueryWarehouseType = extractjson(\"$.WAREHOUSE_TYPE\", JsonString),\r\n    QueryClusterNumber = extractjson(\"$.CLUSTER_NUMBER\", JsonString),\r\n    QueryTag = extractjson(\"$.TAG\", JsonString),\r\n    QueryBytesScanned = extractjson(\"$.BYTES_SCANNED\", JsonString),\r\n    QueryPercentageScannedFromCache = extractjson(\"$.PERCENTAGE_SCANNED_FROM_CACHE\", JsonString),\r\n    QueryBytesWritten = extractjson(\"$.BYTES_WRITTEN\", JsonString),\r\n    QueryBytesWrittenToResult = extractjson(\"$.BYTES_WRITTEN_TO_RESULT\", JsonString),\r\n    QueryBytesReadFromResult = extractjson(\"$.BYTES_READ_FROM_RESULT\", JsonString),\r\n    QueryRowsProduced = extractjson(\"$.ROWS_PRODUCED\", JsonString),\r\n    QueryRowsInserted = extractjson(\"$.ROWS_INSERTED\", JsonString),\r\n    QueryRowsUpdated = extractjson(\"$.ROWS_UPDATED\", JsonString),\r\n    QueryRowsDeleted = extractjson(\"$.ROWS_DELETED\", JsonString),\r\n    QueryRowsUnloaded = extractjson(\"$.ROWS_UNLOADED\", JsonString),\r\n    QueryBytesDeleted = extractjson(\"$.BYTES_DELETED\", JsonString),\r\n    QueryQueuedProvisioningTime = extractjson(\"$.PROVISIONING_TIME\", JsonString),\r\n    QueryQueuedRepairTime = extractjson(\"$.QUEUED_REPAIR_TIME\", JsonString),\r\n    QueryQueuedOverloadTime = extractjson(\"$.QUEUED_OVERLOAD_TIME\", JsonString),\r\n    QueryTransactionBlockedTime = extractjson(\"$.TRANSACTION_BLOCKED_TIME\", JsonString),\r\n    QueryOutboundDataTransferCloud = extractjson(\"$.OUTBOUND_DATA_TRANSFER_CLOUD\", JsonString),\r\n    QueryOutboundDataTransferRegion = extractjson(\"$.OUTBOUND_DATA_TRANSFER_REGION\", JsonString),\r\n    QueryOutboundDataTransferBytes = extractjson(\"$.OUTBOUND_DATA_TRANSFER_BYTES\", JsonString),\r\n    QueryInboundDataTransferCloud = extractjson(\"$.INBOUND_DATA_TRANSFER_CLOUD\", JsonString),\r\n    QueryInboundDataTransferRegion = extractjson(\"$.INBOUND_DATA_TRANSFER_REGION\", JsonString),\r\n    QueryInboundDataTransferBytes = extractjson(\"$.INBOUND_DATA_TRANSFER_BYTES\", JsonString),\r\n    QueryPartitionsScanned = extractjson(\"$.PARTITIONS_SCANNED\", JsonString),\r\n    QueryPartitionsTotal = extractjson(\"$.PARTITIONS_TOTAL\", JsonString),\r\n    QueryBytesSpilledToLocalStorage = extractjson(\"$.BYTES_SPILLED_TO_LOCAL_STORAGE\", JsonString),\r\n    QueryBytesSpilledToRemoteStorage = extractjson(\"$.BYTES_SPILLED_TO_REMOTE_STORAGE\", JsonString),\r\n    QueryBytesSentOverTheNetwork = extractjson(\"$.BYTES_SENT_OVER_THE_NETWORK\", JsonString),\r\n    QueryCompilationTime = extractjson(\"$.COMPILATION_TIME\", JsonString),\r\n    QueryExecutionStatus = extractjson(\"$.EXECUTION_STATUS\", JsonString),\r\n    QueryErrorCode = extractjson(\"$.ERROR_CODE\", JsonString),\r\n    QueryErrorMessage = extractjson(\"$.ERROR_MESSAGE\", JsonString),\r\n    QueryListExternalFilesTime = extractjson(\"$.LIST_EXTERNAL_FILES_TIME\", JsonString),\r\n    QueryCreditsUsedCloudServices = extractjson(\"$.CREDITS_USED_CLOUD_SERVICES\", JsonString),\r\n    QueryReleaseVersion = extractjson(\"$.RELEASE_VERSION\", JsonString),\r\n    QueryExternalFunctionTotalInvocations = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_INVOCATIONS\", JsonString),\r\n    QueryExternalFunctionTotalSentRows = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_SENT_ROWS\", JsonString),\r\n    QueryExternalFunctionTotalReceivedRows = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS\", JsonString),\r\n    QueryExternalFunctionTotalSentBytes = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_SENT_BYTES\", JsonString),\r\n    QueryExternalFunctionTotalReceivedBytes = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES\", JsonString),\r\n    QueryIsClientGeneratedStatement = extractjson(\"$.IS_CLIENT_GENERATED_STATEMENT\", JsonString),\r\n    QueryAccelerationBytesScanned = extractjson(\"$.ACCELERATION_BYTES_SCANNED\", JsonString),\r\n    QueryAccelerationPartitionsScanned = extractjson(\"$.ACCELERATION_PARTITIONS_SCANNED\", JsonString),\r\n    QueryAccelerationUpperLimitScaleFactor = extractjson(\"$.ACCELERATION_UPPER_LIMIT_SCALE_FACTOR\", JsonString),\r\n    QueryTransactionId = extractjson(\"$.TRANSACTION_ID\", JsonString),\r\n    QueryLoadPercent = extractjson(\"$.QUERY_LOAD_PERCENT\", JsonString),\r\n    ChildQueriesWaitTime = extractjson(\"$.CHILD_QUERIES_WAIT_TIME\", JsonString),\r\n    QueryRoleType = extractjson(\"$.ROLE_TYPE\", JsonString),\r\n    QueryHash = extractjson(\"$.HASH\", JsonString),\r\n    QueryHashVersion = extractjson(\"$.HASH_VERSION\", JsonString),\r\n    QueryParameterizedHash = extractjson(\"$.PARAMETERIZED_HASH\", JsonString),\r\n    QueryParameterizedHashVersion = extractjson(\"$.PARAMETERIZED_HASH_VERSION\", JsonString),\r\n    QuerySecondaryRoleStats = extractjson(\"$.SECONDARY_ROLE_STATS\", JsonString),\r\n    QueryRowsWrittenToResult = extractjson(\"$.ROWS_WRITTEN_TO_RESULT\", JsonString),\r\n    QueryRetryTime = extractjson(\"$.RETRY_TIME\", JsonString),\r\n    QueryRetryCause = extractjson(\"$.RETRY_CAUSE\", JsonString),\r\n    QueryFaultHandlingTime = extractjson(\"$.FAULT_HANDLING_TIME\", JsonString),\r\n    QueryUserType = extractjson(\"$.USER_TYPE\", JsonString),\r\n    QueryUserDatabaseName = extractjson(\"$.USER_DATABASE_NAME\", JsonString),\r\n    QueryUserDatabaseId = extractjson(\"$.USER_DATABASE_ID\", JsonString),\r\n    QueryUserSchemaId = extractjson(\"$.USER_SCHEMA_ID\", JsonString),\r\n    QueryUserSchemaName = extractjson(\"$.USER_SCHEMA_NAME\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
                    },
                    {
                      "description": "Get Sample User Grant Events of Snowflake",
                      "query": "SnowflakeUserGrant_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\r\n| extend\r\n    UserGrantCreatedOn = unixtime_seconds_todatetime(CTime),\r\n    UserGrantDeletedOn = unixtime_seconds_todatetime(DTime),\r\n    UserRole = extractjson(\"$.ROLE\", JsonString),\r\n    UserGrantGrantedTo = extractjson(\"$.GRANTED_TO\", JsonString),\r\n    UserGrantGranteeName = extractjson(\"$.GRANTEE_NAME\", JsonString),\r\n    UserGrantGrantedBy = extractjson(\"$.GRANTED_BY\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
                    },
                    {
                      "description": "Get Sample Role Grant Events of Snowflake",
                      "query": "SnowflakeRoleGrant_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend \r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    MTime = toreal(extractjson(\"$.MODIFIED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\r\n| extend\r\n    RoleGrantCreatedOn = unixtime_seconds_todatetime(CTime),\r\n    RoleGrantModifiedOn = unixtime_seconds_todatetime(MTime),\r\n    RoleGrantPrivilege = extractjson(\"$.PRIVILEGE\", JsonString),\r\n    RoleGrantGrantedOn = extractjson(\"$.GRANTED_ON\", JsonString),\r\n    RoleGrantName = extractjson(\"$.NAME\", JsonString),\r\n    RoleGrantTableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\r\n    RoleGrantTableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\r\n    RoleGrantGrantedTo = extractjson(\"$.GRANTED_TO\", JsonString),\r\n    RoleGrantGranteeName = extractjson(\"$.GRANTEE_NAME\", JsonString),\r\n    RoleGrantGrantOption = extractjson(\"$.GRANT_OPTION\", JsonString),\r\n    RoleGrantGrantedBy = extractjson(\"$.GRANTED_BY\", JsonString),\r\n    RoleGrantDeletedOn = unixtime_seconds_todatetime(DTime),\r\n    RoleGrantGrantedByRoleType = extractjson(\"$.GRANTED_BY_ROLE_TYPE\", JsonString),\r\n    RoleGrantObjectInstance = extractjson(\"$.OBJECT_INSTANCE\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
                    },
                    {
                      "description": "Get Sample Load History Events of Snowflake",
                      "query": "SnowflakeLoad_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend LTime = toreal(extractjson(\"$.LAST_LOAD_TIME\", JsonString))\r\n| extend\r\n    LoadTableId = extractjson(\"$.TABLE_ID\", JsonString),\r\n    LoadTableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    LoadSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\r\n    LoadSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    LoadCatalogId = extractjson(\"$.CATALOG_ID\", JsonString),\r\n    LoadCatalogName = extractjson(\"$.CATALOG_NAME\", JsonString),\r\n    LoadFileName = extractjson(\"$.FILE_NAME\", JsonString),\r\n    LastLoadTime = unixtime_seconds_todatetime(LTime),\r\n    LoadStatus = extractjson(\"$.STATUS\", JsonString),\r\n    LoadRowCount = extractjson(\"$.ROW_COUNT\", JsonString),\r\n    LoadRowParsed = extractjson(\"$.ROW_PARSED\", JsonString),\r\n    LoadFirstErrorMessage = extractjson(\"$.FIRST_ERROR_MESSAGE\", JsonString),\r\n    LoadFirstErrorLineNumber = extractjson(\"$.FIRST_ERROR_LINE_NUMBER\", JsonString),\r\n    LoadFirstErrorCharacterPosition = extractjson(\"$.FIRST_ERROR_CHARACTER_POSITION\", JsonString),\r\n    LoadFirstErrorColName = extractjson(\"$.FIRST_ERROR_COL_NAME\", JsonString),\r\n    LoadErrorCount = extractjson(\"$.ERROR_COUNT\", JsonString),\r\n    LoadErrorLimit = extractjson(\"$.ERROR_LIMIT\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
                    },
                    {
                      "description": "Get Sample Materialized View Refresh History Events of Snowflake",
                      "query": "SnowflakeMaterializedView_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    STime = toreal(extractjson(\"$.START_TIME\", JsonString)),\r\n    ETime = toreal(extractjson(\"$.END_TIME\", JsonString))\r\n| extend\r\n    MaterializedViewStartTime = unixtime_seconds_todatetime(STime),\r\n    MaterializedViewEndTime = unixtime_seconds_todatetime(ETime),\r\n    MaterializedViewCreditsUsed = extractjson(\"$.CREDITS_USED\", JsonString),\r\n    MaterializedViewTableId = extractjson(\"$.TABLE_ID\", JsonString),\r\n    MaterializedViewTableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    MaterializedViewSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\r\n    MaterializedViewSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    MaterializedViewDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\r\n    MaterializedViewDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
                    },
                    {
                      "description": "Get Sample Role Events of Snowflake",
                      "query": "SnowflakeRoles_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend \r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\r\n| extend\r\n    RoleId = extractjson(\"$.ROLE_ID\", JsonString),\r\n    RoleCreatedOn = unixtime_seconds_todatetime(CTime),\r\n    RoleDeletedOn = unixtime_seconds_todatetime(DTime),\r\n    RoleName = extractjson(\"$.NAME\", JsonString),\r\n    RoleComment = extractjson(\"$.COMMENT\", JsonString),\r\n    RoleOwner = extractjson(\"$.OWNER\", JsonString),\r\n    RoleType = extractjson(\"$.ROLE_TYPE\", JsonString),\r\n    RoleDatabaseName = extractjson(\"$.ROLE_DATABASE_NAME\", JsonString),\r\n    RoleInstanceId = extractjson(\"$.ROLE_INSTANCE_ID\", JsonString),\r\n    OwnerRoleType = extractjson(\"$.OWNER_ROLE_TYPE\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
                    },
                    {
                      "description": "Get Sample Table Events of Snowflake",
                      "query": "SnowflakeTables_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    TCTime = toreal(extractjson(\"$.CREATED\", JsonString)),\r\n    LATime = toreal(extractjson(\"$.LAST_ALTERED\", JsonString)),\r\n    LDTime = toreal(extractjson(\"$.LAST_DDL\", JsonString)),\r\n    TDTime = toreal(extractjson(\"$.DELETED\", JsonString))\r\n| extend\r\n    TableId = extractjson(\"$.TABLE_ID\", JsonString),\r\n    TableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    TableSchemaId = extractjson(\"$.TABLE_SCHEMA_ID\", JsonString),\r\n    TableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\r\n    TableCatalogId = extractjson(\"$.TABLE_CATALOG_ID\", JsonString),\r\n    TableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\r\n    TableOwner = extractjson(\"$.TABLE_OWNER\", JsonString),\r\n    TableType = extractjson(\"$.TABLE_TYPE\", JsonString),\r\n    TableIsTransient = extractjson(\"$.IS_TRANSIENT\", JsonString),\r\n    TableIsIceberg = extractjson(\"$.IS_ICEBERG\", JsonString),\r\n    TableIsDynamic = extractjson(\"$.IS_DYNAMIC\", JsonString),\r\n    TableIsHybrid = extractjson(\"$.IS_HYBRID\", JsonString),\r\n    TableClusteringKey = extractjson(\"$.CLUSTERING_KEY\", JsonString),\r\n    TableRowCount = extractjson(\"$.ROW_COUNT\", JsonString),\r\n    TableBytes = extractjson(\"$.BYTES\", JsonString),\r\n    TableRetentionTime = extractjson(\"$.RETENTION_TIME\", JsonString),\r\n    TableSelfReferencingColumnName = extractjson(\"$.SELF_REFERENCING_COLUMN_NAME\", JsonString),\r\n    TableReferenceGeneration = extractjson(\"$.REFERENCE_GENERATION\", JsonString),\r\n    TableUserDefinedTypeCatalog = extractjson(\"$.USER_DEFINED_TYPE_CATALOG\", JsonString),\r\n    TableUserDefinedTypeSchema = extractjson(\"$.USER_DEFINED_TYPE_SCHEMA\", JsonString),\r\n    TableUserDefinedTypeName = extractjson(\"$.USER_DEFINED_TYPE_NAME\", JsonString),\r\n    TableIsInsertableInto = extractjson(\"$.IS_INSERTABLE_INTO\", JsonString),\r\n    TableIsTyped = extractjson(\"$.IS_TYPED\", JsonString),\r\n    TableCommitAction = extractjson(\"$.COMMIT_ACTION\", JsonString),\r\n    TableCreated = unixtime_seconds_todatetime(TCTime),\r\n    TableLastAltered = unixtime_seconds_todatetime(LATime),\r\n    TableLastDDL = unixtime_seconds_todatetime(LDTime),\r\n    TableLastDDLBy = extractjson(\"$.LAST_DDL_BY\", JsonString),\r\n    TableDeleted = unixtime_seconds_todatetime(TDTime),\r\n    TableAutoClusteringOn = extractjson(\"$.AUTO_CLUSTERING_ON\", JsonString),\r\n    TableComment = extractjson(\"$.COMMENT\", JsonString),\r\n    TableOwnerRoleType = extractjson(\"$.OWNER_ROLE_TYPE\", JsonString),\r\n    TableInstanceId = extractjson(\"$.INSTANCE_ID\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
                    },
                    {
                      "description": "Get Sample Table Storage Metrics Events of Snowflake",
                      "query": "SnowflakeTableStorageMetrics_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    TCTime = toreal(extractjson(\"$.TABLE_CREATED\", JsonString)),\r\n    TDTime = toreal(extractjson(\"$.TABLE_DROPPED\", JsonString)),\r\n    TFTime = toreal(extractjson(\"$.TABLE_ENTERED_FAILSAFE\", JsonString)),\r\n    SCTime = toreal(extractjson(\"$.SCHEMA_CREATED\", JsonString)),\r\n    SDTime = toreal(extractjson(\"$.SCHEMA_DROPPED\", JsonString)),\r\n    CCTime = toreal(extractjson(\"$.CATALOG_CREATED\", JsonString)),\r\n    CDTime = toreal(extractjson(\"$.CATALOG_DROPPED\", JsonString))\r\n| extend\r\n    TableStorageMetricsId = extractjson(\"$.ID\", JsonString),\r\n    TableStorageMetricsTableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    TableStorageMetricsTableSchemaId = extractjson(\"$.TABLE_SCHEMA_ID\", JsonString),\r\n    TableStorageMetricsTableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\r\n    TableStorageMetricsTableCatalogId = extractjson(\"$.TABLE_CATALOG_ID\", JsonString),\r\n    TableStorageMetricsTableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\r\n    TableStorageMetricsCloneGroupId = extractjson(\"$.CLONE_GROUP_ID\", JsonString),\r\n    TableStorageMetricsIsTransient = extractjson(\"$.IS_TRANSIENT\", JsonString),\r\n    TableStorageMetricsActiveBytes = extractjson(\"$.ACTIVE_BYTES\", JsonString),\r\n    TableStorageMetricsTimeTravelBytes = extractjson(\"$.TIME_TRAVEL_BYTES\", JsonString),\r\n    TableStorageMetricsFailsafeBytes = extractjson(\"$.FAILSAFE_BYTES\", JsonString),\r\n    TableStorageMetricsRetainedForCloneBytes = extractjson(\"$.RETAINED_FOR_CLONE_BYTES\", JsonString),\r\n    TableStorageMetricsDeleted = extractjson(\"$.DELETED\", JsonString),\r\n    TableStorageMetricsTableCreated = unixtime_seconds_todatetime(TCTime),\r\n    TableStorageMetricsTableDropped = unixtime_seconds_todatetime(TDTime),\r\n    TableStorageMetricsTableEnteredFailsafe = unixtime_seconds_todatetime(TFTime),\r\n    TableStorageMetricsSchemaCreated = unixtime_seconds_todatetime(SCTime),\r\n    TableStorageMetricsSchemaDropped = unixtime_seconds_todatetime(SDTime),\r\n    TableStorageMetricsCatalogCreated = unixtime_seconds_todatetime(CCTime),\r\n    TableStorageMetricsCatalogDropped = unixtime_seconds_todatetime(CDTime),\r\n    TableStorageMetricsComment = extractjson(\"$.COMMENT\", JsonString),\r\n    TableStorageMetricsInstanceId = extractjson(\"$.INSTANCE_ID\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
                    },
                    {
                      "description": "Get Sample Users of Snowflake",
                      "query": "SnowflakeUsers_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString)),\r\n    BMTime = toreal(extractjson(\"$.BYPASS_MFA_UNTIL\", JsonString)),\r\n    LSLTime = toreal(extractjson(\"$.LAST_SUCCESS_LOGIN\", JsonString)),\r\n    ETime = toreal(extractjson(\"$.EXPIRES_AT\", JsonString)),\r\n    LUTime = toreal(extractjson(\"$.LOCKED_UNTIL_TIME\", JsonString)),\r\n    PLSTime = toreal(extractjson(\"$.PASSWORD_LAST_SET_TIME\", JsonString))\r\n| extend\r\n    UserId = extractjson(\"$.USER_ID\", JsonString),\r\n    UserName = extractjson(\"$.NAME\", JsonString),\r\n    UserCreatedOn = extractjson(\"$.CREATED_ON\", JsonString),\r\n    UserDeletedOn = extractjson(\"$.DELETED_ON\", JsonString),\r\n    UserLoginName = extractjson(\"$.LOGIN_NAME\", JsonString),\r\n    UserDisplayName = extractjson(\"$.DISPLAY_NAME\", JsonString),\r\n    UserFirstName = extractjson(\"$.FIRST_NAME\", JsonString),\r\n    UserLastName = extractjson(\"$.LAST_NAME\", JsonString),\r\n    UserEmail = extractjson(\"$.EMAIL\", JsonString),\r\n    UserMustChangePassword = extractjson(\"$.MUST_CHANGE_PASSWORD\", JsonString),\r\n    UserHasPassword = extractjson(\"$.HAS_PASSWORD\", JsonString),\r\n    UserComment = extractjson(\"$.COMMENT\", JsonString),\r\n    UserDisabled = extractjson(\"$.DISABLED\", JsonString),\r\n    UserSnowflakeLock = extractjson(\"$.SNOWFLAKE_LOCK\", JsonString),\r\n    UserDefaultWarehouse = extractjson(\"$.DEFAULT_WAREHOUSE\", JsonString),\r\n    UserDefaultNamespace = extractjson(\"$.DEFAULT_NAMESPACE\", JsonString),\r\n    UserDefaultRole = extractjson(\"$.DEFAULT_ROLE\", JsonString),\r\n    UserExtAuthnDuo = extractjson(\"$.EXT_AUTHN_DUO\", JsonString),\r\n    UserExtAuthnUid = extractjson(\"$.EXT_AUTHN_UID\", JsonString),\r\n    UserHasMFA = extractjson(\"$.HAS_MFA\", JsonString),\r\n    UserBypassMFAUntil = unixtime_seconds_todatetime(BMTime),\r\n    UserLastSuccessLogin = unixtime_seconds_todatetime(LSLTime),\r\n    UserExpiresAt = unixtime_seconds_todatetime(ETime),\r\n    UserLockedUntilTime = unixtime_seconds_todatetime(LUTime),\r\n    UserHasRSAPublicKey = extractjson(\"$.HAS_RSA_PUBLIC_KEY\", JsonString),\r\n    UserPasswordLastSetTime = unixtime_seconds_todatetime(PLSTime),\r\n    UserOwner = extractjson(\"$.OWNER\", JsonString),\r\n    UserDefaultSecondaryRole = extractjson(\"$.DEFAULT_SECONDARY_ROLE\", JsonString),\r\n    UserType = extractjson(\"$.TYPE\", JsonString),\r\n    UserDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString),\r\n    UserDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\r\n    UserSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    UserSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "SnowflakeLoad_CL",
                      "lastDataReceivedQuery": "SnowflakeLoad_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    },
                    {
                      "name": "SnowflakeLogin_CL",
                      "lastDataReceivedQuery": "SnowflakeLogin_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    },
                    {
                      "name": "SnowflakeMaterializedView_CL",
                      "lastDataReceivedQuery": "SnowflakeMaterializedView_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    },
                    {
                      "name": "SnowflakeQuery_CL",
                      "lastDataReceivedQuery": "SnowflakeQuery_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    },
                    {
                      "name": "SnowflakeRoleGrant_CL",
                      "lastDataReceivedQuery": "SnowflakeRoleGrant_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    },
                    {
                      "name": "SnowflakeRoles_CL",
                      "lastDataReceivedQuery": "SnowflakeRoles_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    },
                    {
                      "name": "SnowflakeTables_CL",
                      "lastDataReceivedQuery": "SnowflakeTables_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    },
                    {
                      "name": "SnowflakeTableStorageMetrics_CL",
                      "lastDataReceivedQuery": "SnowflakeTableStorageMetrics_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    },
                    {
                      "name": "SnowflakeUserGrant_CL",
                      "lastDataReceivedQuery": "SnowflakeUserGrant_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    },
                    {
                      "name": "SnowflakeUsers_CL",
                      "lastDataReceivedQuery": "SnowflakeUsers_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "availability": {
                    "isPreview": false,
                    "status": 1
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true,
                          "action": false
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "title": "Connect Snowflake to Microsoft Sentinel",
                      "instructions": [
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": ">**NOTE:** To ensure data is presented in separate columns for each field, execute the parser using the **Snowflake()** function"
                          }
                        },
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "To gather data from Snowflake, you need to provide the following resources"
                          }
                        },
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "#### 1. Account Identifier \n To gather data from Snowflake, you'll need Snowflake Account Identifier."
                          }
                        },
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "#### 2. Programmatic Access Token \n To gather data from Snowflake, you'll need the Snowflake Programmatic Access Token"
                          }
                        },
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "For detailed instructions on retrieving the Account Identifier and Programmatic Access Token, please refer to the [Connector Tutorial](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Snowflake/Data%20Connectors/Readme.md)."
                          }
                        },
                        {
                          "type": "DataConnectorsGrid",
                          "parameters": {
                            "mapping": [
                              {
                                "columnName": "Account-Identifier",
                                "columnValue": "properties.addOnAttributes.AccountId"
                              },
                              {
                                "columnName": "Table Name",
                                "columnValue": "properties.dataType"
                              }
                            ],
                            "menuItems": [
                              "DeleteConnector"
                            ]
                          }
                        },
                        {
                          "type": "ContextPane",
                          "parameters": {
                            "isPrimary": true,
                            "label": "Add Account",
                            "title": "Add Account",
                            "subtitle": "Add Account",
                            "contextPaneType": "DataConnectorsContextPane",
                            "instructionSteps": [
                              {
                                "instructions": [
                                  {
                                    "type": "Textbox",
                                    "parameters": {
                                      "label": "Snowflake Account Identifier",
                                      "placeholder": "Enter Snowflake Account Identifier",
                                      "type": "text",
                                      "name": "accountId",
                                      "validations": {
                                        "required": true
                                      }
                                    }
                                  },
                                  {
                                    "type": "Textbox",
                                    "parameters": {
                                      "label": "Snowflake PAT",
                                      "placeholder": "Enter Snowflake PAT",
                                      "type": "password",
                                      "name": "apikey",
                                      "validations": {
                                        "required": true
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "SnowflakeDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-SnowflakeLoad": {
                    "columns": [
                      {
                        "name": "data",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-SnowflakeLogin": {
                    "columns": [
                      {
                        "name": "data",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-SnowflakeMaterializedView": {
                    "columns": [
                      {
                        "name": "data",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-SnowflakeQuery": {
                    "columns": [
                      {
                        "name": "data",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-SnowflakeRoleGrant": {
                    "columns": [
                      {
                        "name": "data",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-SnowflakeRoles": {
                    "columns": [
                      {
                        "name": "data",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-SnowflakeTable": {
                    "columns": [
                      {
                        "name": "data",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-SnowflakeTableStorageMetrics": {
                    "columns": [
                      {
                        "name": "data",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-SnowflakeUserGrant": {
                    "columns": [
                      {
                        "name": "data",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-SnowflakeUsers": {
                    "columns": [
                      {
                        "name": "data",
                        "type": "dynamic"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-SnowflakeLoad"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-SnowflakeLoad_CL",
                    "transformKql": "source \r\n| extend Data = tostring(data), TimeGenerated = now() \r\n| where Data !contains \"[]\"\r\n| project TimeGenerated, Data"
                  },
                  {
                    "streams": [
                      "Custom-SnowflakeLogin"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-SnowflakeLogin_CL",
                    "transformKql": "source \r\n| extend Data = tostring(data), TimeGenerated = now() \r\n| where Data !contains \"[]\"\r\n| project TimeGenerated, Data"
                  },
                  {
                    "streams": [
                      "Custom-SnowflakeMaterializedView"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-SnowflakeMaterializedView_CL",
                    "transformKql": "source \r\n| extend Data = tostring(data), TimeGenerated = now() \r\n| where Data !contains \"[]\"\r\n| project TimeGenerated, Data"
                  },
                  {
                    "streams": [
                      "Custom-SnowflakeQuery"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-SnowflakeQuery_CL",
                    "transformKql": "source \r\n| extend Data = tostring(data), TimeGenerated = now() \r\n| where Data !contains \"[]\"\r\n| project TimeGenerated, Data"
                  },
                  {
                    "streams": [
                      "Custom-SnowflakeRoleGrant"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-SnowflakeRoleGrant_CL",
                    "transformKql": "source \r\n| extend Data = tostring(data), TimeGenerated = now() \r\n| where Data !contains \"[]\"\r\n| project TimeGenerated, Data"
                  },
                  {
                    "streams": [
                      "Custom-SnowflakeRoles"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-SnowflakeRoles_CL",
                    "transformKql": "source \r\n| extend Data = tostring(data), TimeGenerated = now() \r\n| where Data !contains \"[]\"\r\n| project TimeGenerated, Data"
                  },
                  {
                    "streams": [
                      "Custom-SnowflakeTable"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-SnowflakeTables_CL",
                    "transformKql": "source \r\n| extend Data = tostring(data), TimeGenerated = now() \r\n| where Data !contains \"[]\"\r\n| project TimeGenerated, Data"
                  },
                  {
                    "streams": [
                      "Custom-SnowflakeTableStorageMetrics"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-SnowflakeTableStorageMetrics_CL",
                    "transformKql": "source \r\n| extend Data = tostring(data), TimeGenerated = now() \r\n| where Data !contains \"[]\"\r\n| project TimeGenerated, Data"
                  },
                  {
                    "streams": [
                      "Custom-SnowflakeUserGrant"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-SnowflakeUserGrant_CL",
                    "transformKql": "source \r\n| extend Data = tostring(data), TimeGenerated = now() \r\n| where Data !contains \"[]\"\r\n| project TimeGenerated, Data"
                  },
                  {
                    "streams": [
                      "Custom-SnowflakeUsers"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-SnowflakeUsers_CL",
                    "transformKql": "source \r\n| extend Data = tostring(data), TimeGenerated = now() \r\n| where Data !contains \"[]\"\r\n| project TimeGenerated, Data"
                  }
                ]
              }
            },
            {
              "name": "SnowflakeLoad_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "retentionInDays": 180,
                "schema": {
                  "name": "SnowflakeLoad_CL",
                  "description": "Snowflake Load Data",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true
                    },
                    {
                      "name": "Data",
                      "type": "string",
                      "description": "Dynamic data column"
                    }
                  ]
                }
              }
            },
            {
              "name": "SnowflakeLogin_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "retentionInDays": 180,
                "schema": {
                  "name": "SnowflakeLogin_CL",
                  "description": "Snowflake Login Data",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true
                    },
                    {
                      "name": "Data",
                      "type": "string",
                      "description": "Dynamic data column"
                    }
                  ]
                }
              }
            },
            {
              "name": "SnowflakeMaterializedView_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "retentionInDays": 180,
                "schema": {
                  "name": "SnowflakeMaterializedView_CL",
                  "description": "Snowflake Materialized View Data",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true
                    },
                    {
                      "name": "Data",
                      "type": "string",
                      "description": "Dynamic data column"
                    }
                  ]
                }
              }
            },
            {
              "name": "SnowflakeQuery_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "retentionInDays": 180,
                "schema": {
                  "name": "SnowflakeQuery_CL",
                  "description": "Snowflake Query Data",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true
                    },
                    {
                      "name": "Data",
                      "type": "string",
                      "description": "Dynamic data column"
                    }
                  ]
                }
              }
            },
            {
              "name": "SnowflakeRoleGrant_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "retentionInDays": 180,
                "schema": {
                  "name": "SnowflakeRoleGrant_CL",
                  "description": "Snowflake Role Grant Data",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true
                    },
                    {
                      "name": "Data",
                      "type": "string",
                      "description": "Dynamic data column"
                    }
                  ]
                }
              }
            },
            {
              "name": "SnowflakeRoles_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "retentionInDays": 180,
                "schema": {
                  "name": "SnowflakeRoles_CL",
                  "description": "Snowflake Roles Data",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true
                    },
                    {
                      "name": "Data",
                      "type": "string",
                      "description": "Dynamic data column"
                    }
                  ]
                }
              }
            },
            {
              "name": "SnowflakeTables_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "retentionInDays": 180,
                "schema": {
                  "name": "SnowflakeTables_CL",
                  "description": "Snowflake Tables Data",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true
                    },
                    {
                      "name": "Data",
                      "type": "string",
                      "description": "Dynamic data column"
                    }
                  ]
                }
              }
            },
            {
              "name": "SnowflakeTableStorageMetrics_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "retentionInDays": 180,
                "schema": {
                  "name": "SnowflakeTableStorageMetrics_CL",
                  "description": "Snowflake Table Storage Metrics Data",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true
                    },
                    {
                      "name": "Data",
                      "type": "string",
                      "description": "Dynamic data column"
                    }
                  ]
                }
              }
            },
            {
              "name": "SnowflakeUserGrant_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "retentionInDays": 180,
                "schema": {
                  "name": "SnowflakeUserGrant_CL",
                  "description": "Snowflake User Grant Data",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true
                    },
                    {
                      "name": "Data",
                      "type": "string",
                      "description": "Dynamic data column"
                    }
                  ]
                }
              }
            },
            {
              "name": "SnowflakeUsers_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "retentionInDays": 180,
                "schema": {
                  "name": "SnowflakeUsers_CL",
                  "description": "Snowflake Users Data",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true
                    },
                    {
                      "name": "Data",
                      "type": "string",
                      "description": "Dynamic data column"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "SnowflakeLogsCCPDefinition",
          "title": "Snowflake (via Codeless Connector Framework)",
          "publisher": "Microsoft",
          "descriptionMarkdown": "The Snowflake data connector provides the capability to ingest Snowflake [Login History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/login_history), [Query History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/query_history), [User-Grant Logs](https://docs.snowflake.com/en/sql-reference/account-usage/grants_to_users), [Role-Grant Logs](https://docs.snowflake.com/en/sql-reference/account-usage/grants_to_roles), [Load History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/load_history), [Materialized View Refresh History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/materialized_view_refresh_history), [Roles Logs](https://docs.snowflake.com/en/sql-reference/account-usage/roles), [Tables Logs](https://docs.snowflake.com/en/sql-reference/account-usage/tables), [Table Storage Metrics Logs](https://docs.snowflake.com/en/sql-reference/account-usage/table_storage_metrics), [Users Logs](https://docs.snowflake.com/en/sql-reference/account-usage/users) into Microsoft Sentinel using the Snowflake SQL API. Refer to [Snowflake SQL API documentation](https://docs.snowflake.com/en/developer-guide/sql-api/reference) for more information.",
          "graphQueries": [
            {
              "metricName": "Total Login events received",
              "legend": "Snowflake Login History Logs",
              "baseQuery": "SnowflakeLogin_CL"
            },
            {
              "metricName": "Total Query events received",
              "legend": "Snowflake Query History Logs",
              "baseQuery": "SnowflakeQuery_CL"
            },
            {
              "metricName": "Total Grants to User events received",
              "legend": "Snowflake User Grant Logs",
              "baseQuery": "SnowflakeUserGrant_CL"
            },
            {
              "metricName": "Total Grants to Role events received",
              "legend": "Snowflake Role Grant Logs",
              "baseQuery": "SnowflakeRoleGrant_CL"
            },
            {
              "metricName": "Total Load History events received",
              "legend": "Snowflake Load History Logs",
              "baseQuery": "SnowflakeLoad_CL"
            },
            {
              "metricName": "Total Materialized View Refresh History events received",
              "legend": "Snowflake Materialized View Refresh History Logs",
              "baseQuery": "SnowflakeMaterializedView_CL"
            },
            {
              "metricName": "Total Role Events received",
              "legend": "Snowflake Roles Logs",
              "baseQuery": "SnowflakeRoles_CL"
            },
            {
              "metricName": "Total Table Events received",
              "legend": "Snowflake Tables Logs",
              "baseQuery": "SnowflakeTables_CL"
            },
            {
              "metricName": "Total Table Storage Metrics Events received",
              "legend": "Snowflake Table Storage Metrics Logs",
              "baseQuery": "SnowflakeTableStorageMetrics_CL"
            },
            {
              "metricName": "Total Users Events received",
              "legend": "Snowflake Users Logs",
              "baseQuery": "SnowflakeUsers_CL"
            }
          ],
          "sampleQueries": [
            {
              "description": "Get Sample Login Events of Snowflake",
              "query": "SnowflakeLogin_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend Time = toreal(extractjson(\"$.EVENT_TIMESTAMP\", JsonString))\r\n| extend\r\n    SrcDvcIpAddr = extractjson(\"$.CLIENT_IP\", JsonString),\r\n    LoginClientPrivateLinkId = extractjson(\"$.CLIENT_PRIVATE_LINK_ID\", JsonString),\r\n    LoginConnection = extractjson(\"$.CONNECTION\", JsonString),\r\n    LoginErrorCode = extractjson(\"$.ERROR_CODE\", JsonString),\r\n    LoginErrorMessage = extractjson(\"$.ERROR_MESSAGE\", JsonString),\r\n    LoginEventId = extractjson(\"$.EVENT_ID\", JsonString),\r\n    LoginEventEndTime = unixtime_seconds_todatetime(Time),\r\n    LoginEventType = extractjson(\"$.EVENT_TYPE\", JsonString),\r\n    LoginFirstAuthenticationFactor = extractjson(\"$.FIRST_AUTHENTICATION_FACTOR\", JsonString),\r\n    LoginIsSuccess = extractjson(\"$.IS_SUCCESS\", JsonString),\r\n    LoginRelatedEventId = extractjson(\"$.RELATED_EVENT_ID\", JsonString),\r\n    LoginReportedClientType = extractjson(\"$.REPORTED_CLIENT_TYPE\", JsonString),\r\n    LoginReportedClientVersion = extractjson(\"$.REPORTED_CLIENT_VERSION\", JsonString),\r\n    LoginSecondAuthenticationFactor = extractjson(\"$.SECOND_AUTHENTICATION_FACTOR\", JsonString),\r\n    TargetUsername = extractjson(\"$.USER_NAME\", JsonString)\r\n| extend User = TargetUsername\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
            },
            {
              "description": "Get Sample Query Events of Snowflake",
              "query": "SnowflakeQuery_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    QueryStartTime = unixtime_seconds_todatetime(toreal(extractjson(\"$.START_TIME\", JsonString))),\r\n    QueryEndTime = unixtime_seconds_todatetime(toreal(extractjson(\"$.END_TIME\", JsonString))),\r\n    QueryTotalElapsedTime = toreal(extractjson(\"$.TOTAL_ELAPSED_TIME\", JsonString)),\r\n    QueryExecutionTime = toreal(extractjson(\"$.EXECUTION_TIME\", JsonString))\r\n| extend\r\n    QueryId = extractjson(\"$.QUERY_ID\", JsonString),\r\n    QueryText = extractjson(\"$.QUERY_TEXT\", JsonString),\r\n    QueryDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\r\n    QueryDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString),\r\n    QuerySchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\r\n    QuerySchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    QueryType = extractjson(\"$.QUERY_TYPE\", JsonString),\r\n    QuerySessionId = extractjson(\"$.SESSION_ID\", JsonString),\r\n    QueryUserName = extractjson(\"$.USER_NAME\", JsonString),\r\n    QueryRoleName = extractjson(\"$.ROLE_NAME\", JsonString),\r\n    QueryWarehouseId = extractjson(\"$.WAREHOUSE_ID\", JsonString),\r\n    QueryWarehouseName = extractjson(\"$.WAREHOUSE_NAME\", JsonString),\r\n    QueryWarehouseSize = extractjson(\"$.WAREHOUSE_SIZE\", JsonString),\r\n    QueryWarehouseType = extractjson(\"$.WAREHOUSE_TYPE\", JsonString),\r\n    QueryClusterNumber = extractjson(\"$.CLUSTER_NUMBER\", JsonString),\r\n    QueryTag = extractjson(\"$.TAG\", JsonString),\r\n    QueryBytesScanned = extractjson(\"$.BYTES_SCANNED\", JsonString),\r\n    QueryPercentageScannedFromCache = extractjson(\"$.PERCENTAGE_SCANNED_FROM_CACHE\", JsonString),\r\n    QueryBytesWritten = extractjson(\"$.BYTES_WRITTEN\", JsonString),\r\n    QueryBytesWrittenToResult = extractjson(\"$.BYTES_WRITTEN_TO_RESULT\", JsonString),\r\n    QueryBytesReadFromResult = extractjson(\"$.BYTES_READ_FROM_RESULT\", JsonString),\r\n    QueryRowsProduced = extractjson(\"$.ROWS_PRODUCED\", JsonString),\r\n    QueryRowsInserted = extractjson(\"$.ROWS_INSERTED\", JsonString),\r\n    QueryRowsUpdated = extractjson(\"$.ROWS_UPDATED\", JsonString),\r\n    QueryRowsDeleted = extractjson(\"$.ROWS_DELETED\", JsonString),\r\n    QueryRowsUnloaded = extractjson(\"$.ROWS_UNLOADED\", JsonString),\r\n    QueryBytesDeleted = extractjson(\"$.BYTES_DELETED\", JsonString),\r\n    QueryQueuedProvisioningTime = extractjson(\"$.PROVISIONING_TIME\", JsonString),\r\n    QueryQueuedRepairTime = extractjson(\"$.QUEUED_REPAIR_TIME\", JsonString),\r\n    QueryQueuedOverloadTime = extractjson(\"$.QUEUED_OVERLOAD_TIME\", JsonString),\r\n    QueryTransactionBlockedTime = extractjson(\"$.TRANSACTION_BLOCKED_TIME\", JsonString),\r\n    QueryOutboundDataTransferCloud = extractjson(\"$.OUTBOUND_DATA_TRANSFER_CLOUD\", JsonString),\r\n    QueryOutboundDataTransferRegion = extractjson(\"$.OUTBOUND_DATA_TRANSFER_REGION\", JsonString),\r\n    QueryOutboundDataTransferBytes = extractjson(\"$.OUTBOUND_DATA_TRANSFER_BYTES\", JsonString),\r\n    QueryInboundDataTransferCloud = extractjson(\"$.INBOUND_DATA_TRANSFER_CLOUD\", JsonString),\r\n    QueryInboundDataTransferRegion = extractjson(\"$.INBOUND_DATA_TRANSFER_REGION\", JsonString),\r\n    QueryInboundDataTransferBytes = extractjson(\"$.INBOUND_DATA_TRANSFER_BYTES\", JsonString),\r\n    QueryPartitionsScanned = extractjson(\"$.PARTITIONS_SCANNED\", JsonString),\r\n    QueryPartitionsTotal = extractjson(\"$.PARTITIONS_TOTAL\", JsonString),\r\n    QueryBytesSpilledToLocalStorage = extractjson(\"$.BYTES_SPILLED_TO_LOCAL_STORAGE\", JsonString),\r\n    QueryBytesSpilledToRemoteStorage = extractjson(\"$.BYTES_SPILLED_TO_REMOTE_STORAGE\", JsonString),\r\n    QueryBytesSentOverTheNetwork = extractjson(\"$.BYTES_SENT_OVER_THE_NETWORK\", JsonString),\r\n    QueryCompilationTime = extractjson(\"$.COMPILATION_TIME\", JsonString),\r\n    QueryExecutionStatus = extractjson(\"$.EXECUTION_STATUS\", JsonString),\r\n    QueryErrorCode = extractjson(\"$.ERROR_CODE\", JsonString),\r\n    QueryErrorMessage = extractjson(\"$.ERROR_MESSAGE\", JsonString),\r\n    QueryListExternalFilesTime = extractjson(\"$.LIST_EXTERNAL_FILES_TIME\", JsonString),\r\n    QueryCreditsUsedCloudServices = extractjson(\"$.CREDITS_USED_CLOUD_SERVICES\", JsonString),\r\n    QueryReleaseVersion = extractjson(\"$.RELEASE_VERSION\", JsonString),\r\n    QueryExternalFunctionTotalInvocations = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_INVOCATIONS\", JsonString),\r\n    QueryExternalFunctionTotalSentRows = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_SENT_ROWS\", JsonString),\r\n    QueryExternalFunctionTotalReceivedRows = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS\", JsonString),\r\n    QueryExternalFunctionTotalSentBytes = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_SENT_BYTES\", JsonString),\r\n    QueryExternalFunctionTotalReceivedBytes = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES\", JsonString),\r\n    QueryIsClientGeneratedStatement = extractjson(\"$.IS_CLIENT_GENERATED_STATEMENT\", JsonString),\r\n    QueryAccelerationBytesScanned = extractjson(\"$.ACCELERATION_BYTES_SCANNED\", JsonString),\r\n    QueryAccelerationPartitionsScanned = extractjson(\"$.ACCELERATION_PARTITIONS_SCANNED\", JsonString),\r\n    QueryAccelerationUpperLimitScaleFactor = extractjson(\"$.ACCELERATION_UPPER_LIMIT_SCALE_FACTOR\", JsonString),\r\n    QueryTransactionId = extractjson(\"$.TRANSACTION_ID\", JsonString),\r\n    QueryLoadPercent = extractjson(\"$.QUERY_LOAD_PERCENT\", JsonString),\r\n    ChildQueriesWaitTime = extractjson(\"$.CHILD_QUERIES_WAIT_TIME\", JsonString),\r\n    QueryRoleType = extractjson(\"$.ROLE_TYPE\", JsonString),\r\n    QueryHash = extractjson(\"$.HASH\", JsonString),\r\n    QueryHashVersion = extractjson(\"$.HASH_VERSION\", JsonString),\r\n    QueryParameterizedHash = extractjson(\"$.PARAMETERIZED_HASH\", JsonString),\r\n    QueryParameterizedHashVersion = extractjson(\"$.PARAMETERIZED_HASH_VERSION\", JsonString),\r\n    QuerySecondaryRoleStats = extractjson(\"$.SECONDARY_ROLE_STATS\", JsonString),\r\n    QueryRowsWrittenToResult = extractjson(\"$.ROWS_WRITTEN_TO_RESULT\", JsonString),\r\n    QueryRetryTime = extractjson(\"$.RETRY_TIME\", JsonString),\r\n    QueryRetryCause = extractjson(\"$.RETRY_CAUSE\", JsonString),\r\n    QueryFaultHandlingTime = extractjson(\"$.FAULT_HANDLING_TIME\", JsonString),\r\n    QueryUserType = extractjson(\"$.USER_TYPE\", JsonString),\r\n    QueryUserDatabaseName = extractjson(\"$.USER_DATABASE_NAME\", JsonString),\r\n    QueryUserDatabaseId = extractjson(\"$.USER_DATABASE_ID\", JsonString),\r\n    QueryUserSchemaId = extractjson(\"$.USER_SCHEMA_ID\", JsonString),\r\n    QueryUserSchemaName = extractjson(\"$.USER_SCHEMA_NAME\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
            },
            {
              "description": "Get Sample User Grant Events of Snowflake",
              "query": "SnowflakeUserGrant_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\r\n| extend\r\n    UserGrantCreatedOn = unixtime_seconds_todatetime(CTime),\r\n    UserGrantDeletedOn = unixtime_seconds_todatetime(DTime),\r\n    UserRole = extractjson(\"$.ROLE\", JsonString),\r\n    UserGrantGrantedTo = extractjson(\"$.GRANTED_TO\", JsonString),\r\n    UserGrantGranteeName = extractjson(\"$.GRANTEE_NAME\", JsonString),\r\n    UserGrantGrantedBy = extractjson(\"$.GRANTED_BY\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
            },
            {
              "description": "Get Sample Role Grant Events of Snowflake",
              "query": "SnowflakeRoleGrant_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend \r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    MTime = toreal(extractjson(\"$.MODIFIED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\r\n| extend\r\n    RoleGrantCreatedOn = unixtime_seconds_todatetime(CTime),\r\n    RoleGrantModifiedOn = unixtime_seconds_todatetime(MTime),\r\n    RoleGrantPrivilege = extractjson(\"$.PRIVILEGE\", JsonString),\r\n    RoleGrantGrantedOn = extractjson(\"$.GRANTED_ON\", JsonString),\r\n    RoleGrantName = extractjson(\"$.NAME\", JsonString),\r\n    RoleGrantTableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\r\n    RoleGrantTableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\r\n    RoleGrantGrantedTo = extractjson(\"$.GRANTED_TO\", JsonString),\r\n    RoleGrantGranteeName = extractjson(\"$.GRANTEE_NAME\", JsonString),\r\n    RoleGrantGrantOption = extractjson(\"$.GRANT_OPTION\", JsonString),\r\n    RoleGrantGrantedBy = extractjson(\"$.GRANTED_BY\", JsonString),\r\n    RoleGrantDeletedOn = unixtime_seconds_todatetime(DTime),\r\n    RoleGrantGrantedByRoleType = extractjson(\"$.GRANTED_BY_ROLE_TYPE\", JsonString),\r\n    RoleGrantObjectInstance = extractjson(\"$.OBJECT_INSTANCE\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
            },
            {
              "description": "Get Sample Load History Events of Snowflake",
              "query": "SnowflakeLoad_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend LTime = toreal(extractjson(\"$.LAST_LOAD_TIME\", JsonString))\r\n| extend\r\n    LoadTableId = extractjson(\"$.TABLE_ID\", JsonString),\r\n    LoadTableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    LoadSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\r\n    LoadSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    LoadCatalogId = extractjson(\"$.CATALOG_ID\", JsonString),\r\n    LoadCatalogName = extractjson(\"$.CATALOG_NAME\", JsonString),\r\n    LoadFileName = extractjson(\"$.FILE_NAME\", JsonString),\r\n    LastLoadTime = unixtime_seconds_todatetime(LTime),\r\n    LoadStatus = extractjson(\"$.STATUS\", JsonString),\r\n    LoadRowCount = extractjson(\"$.ROW_COUNT\", JsonString),\r\n    LoadRowParsed = extractjson(\"$.ROW_PARSED\", JsonString),\r\n    LoadFirstErrorMessage = extractjson(\"$.FIRST_ERROR_MESSAGE\", JsonString),\r\n    LoadFirstErrorLineNumber = extractjson(\"$.FIRST_ERROR_LINE_NUMBER\", JsonString),\r\n    LoadFirstErrorCharacterPosition = extractjson(\"$.FIRST_ERROR_CHARACTER_POSITION\", JsonString),\r\n    LoadFirstErrorColName = extractjson(\"$.FIRST_ERROR_COL_NAME\", JsonString),\r\n    LoadErrorCount = extractjson(\"$.ERROR_COUNT\", JsonString),\r\n    LoadErrorLimit = extractjson(\"$.ERROR_LIMIT\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
            },
            {
              "description": "Get Sample Materialized View Refresh History Events of Snowflake",
              "query": "SnowflakeMaterializedView_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    STime = toreal(extractjson(\"$.START_TIME\", JsonString)),\r\n    ETime = toreal(extractjson(\"$.END_TIME\", JsonString))\r\n| extend\r\n    MaterializedViewStartTime = unixtime_seconds_todatetime(STime),\r\n    MaterializedViewEndTime = unixtime_seconds_todatetime(ETime),\r\n    MaterializedViewCreditsUsed = extractjson(\"$.CREDITS_USED\", JsonString),\r\n    MaterializedViewTableId = extractjson(\"$.TABLE_ID\", JsonString),\r\n    MaterializedViewTableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    MaterializedViewSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\r\n    MaterializedViewSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    MaterializedViewDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\r\n    MaterializedViewDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
            },
            {
              "description": "Get Sample Role Events of Snowflake",
              "query": "SnowflakeRoles_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend \r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\r\n| extend\r\n    RoleId = extractjson(\"$.ROLE_ID\", JsonString),\r\n    RoleCreatedOn = unixtime_seconds_todatetime(CTime),\r\n    RoleDeletedOn = unixtime_seconds_todatetime(DTime),\r\n    RoleName = extractjson(\"$.NAME\", JsonString),\r\n    RoleComment = extractjson(\"$.COMMENT\", JsonString),\r\n    RoleOwner = extractjson(\"$.OWNER\", JsonString),\r\n    RoleType = extractjson(\"$.ROLE_TYPE\", JsonString),\r\n    RoleDatabaseName = extractjson(\"$.ROLE_DATABASE_NAME\", JsonString),\r\n    RoleInstanceId = extractjson(\"$.ROLE_INSTANCE_ID\", JsonString),\r\n    OwnerRoleType = extractjson(\"$.OWNER_ROLE_TYPE\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
            },
            {
              "description": "Get Sample Table Events of Snowflake",
              "query": "SnowflakeTables_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    TCTime = toreal(extractjson(\"$.CREATED\", JsonString)),\r\n    LATime = toreal(extractjson(\"$.LAST_ALTERED\", JsonString)),\r\n    LDTime = toreal(extractjson(\"$.LAST_DDL\", JsonString)),\r\n    TDTime = toreal(extractjson(\"$.DELETED\", JsonString))\r\n| extend\r\n    TableId = extractjson(\"$.TABLE_ID\", JsonString),\r\n    TableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    TableSchemaId = extractjson(\"$.TABLE_SCHEMA_ID\", JsonString),\r\n    TableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\r\n    TableCatalogId = extractjson(\"$.TABLE_CATALOG_ID\", JsonString),\r\n    TableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\r\n    TableOwner = extractjson(\"$.TABLE_OWNER\", JsonString),\r\n    TableType = extractjson(\"$.TABLE_TYPE\", JsonString),\r\n    TableIsTransient = extractjson(\"$.IS_TRANSIENT\", JsonString),\r\n    TableIsIceberg = extractjson(\"$.IS_ICEBERG\", JsonString),\r\n    TableIsDynamic = extractjson(\"$.IS_DYNAMIC\", JsonString),\r\n    TableIsHybrid = extractjson(\"$.IS_HYBRID\", JsonString),\r\n    TableClusteringKey = extractjson(\"$.CLUSTERING_KEY\", JsonString),\r\n    TableRowCount = extractjson(\"$.ROW_COUNT\", JsonString),\r\n    TableBytes = extractjson(\"$.BYTES\", JsonString),\r\n    TableRetentionTime = extractjson(\"$.RETENTION_TIME\", JsonString),\r\n    TableSelfReferencingColumnName = extractjson(\"$.SELF_REFERENCING_COLUMN_NAME\", JsonString),\r\n    TableReferenceGeneration = extractjson(\"$.REFERENCE_GENERATION\", JsonString),\r\n    TableUserDefinedTypeCatalog = extractjson(\"$.USER_DEFINED_TYPE_CATALOG\", JsonString),\r\n    TableUserDefinedTypeSchema = extractjson(\"$.USER_DEFINED_TYPE_SCHEMA\", JsonString),\r\n    TableUserDefinedTypeName = extractjson(\"$.USER_DEFINED_TYPE_NAME\", JsonString),\r\n    TableIsInsertableInto = extractjson(\"$.IS_INSERTABLE_INTO\", JsonString),\r\n    TableIsTyped = extractjson(\"$.IS_TYPED\", JsonString),\r\n    TableCommitAction = extractjson(\"$.COMMIT_ACTION\", JsonString),\r\n    TableCreated = unixtime_seconds_todatetime(TCTime),\r\n    TableLastAltered = unixtime_seconds_todatetime(LATime),\r\n    TableLastDDL = unixtime_seconds_todatetime(LDTime),\r\n    TableLastDDLBy = extractjson(\"$.LAST_DDL_BY\", JsonString),\r\n    TableDeleted = unixtime_seconds_todatetime(TDTime),\r\n    TableAutoClusteringOn = extractjson(\"$.AUTO_CLUSTERING_ON\", JsonString),\r\n    TableComment = extractjson(\"$.COMMENT\", JsonString),\r\n    TableOwnerRoleType = extractjson(\"$.OWNER_ROLE_TYPE\", JsonString),\r\n    TableInstanceId = extractjson(\"$.INSTANCE_ID\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
            },
            {
              "description": "Get Sample Table Storage Metrics Events of Snowflake",
              "query": "SnowflakeTableStorageMetrics_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    TCTime = toreal(extractjson(\"$.TABLE_CREATED\", JsonString)),\r\n    TDTime = toreal(extractjson(\"$.TABLE_DROPPED\", JsonString)),\r\n    TFTime = toreal(extractjson(\"$.TABLE_ENTERED_FAILSAFE\", JsonString)),\r\n    SCTime = toreal(extractjson(\"$.SCHEMA_CREATED\", JsonString)),\r\n    SDTime = toreal(extractjson(\"$.SCHEMA_DROPPED\", JsonString)),\r\n    CCTime = toreal(extractjson(\"$.CATALOG_CREATED\", JsonString)),\r\n    CDTime = toreal(extractjson(\"$.CATALOG_DROPPED\", JsonString))\r\n| extend\r\n    TableStorageMetricsId = extractjson(\"$.ID\", JsonString),\r\n    TableStorageMetricsTableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    TableStorageMetricsTableSchemaId = extractjson(\"$.TABLE_SCHEMA_ID\", JsonString),\r\n    TableStorageMetricsTableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\r\n    TableStorageMetricsTableCatalogId = extractjson(\"$.TABLE_CATALOG_ID\", JsonString),\r\n    TableStorageMetricsTableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\r\n    TableStorageMetricsCloneGroupId = extractjson(\"$.CLONE_GROUP_ID\", JsonString),\r\n    TableStorageMetricsIsTransient = extractjson(\"$.IS_TRANSIENT\", JsonString),\r\n    TableStorageMetricsActiveBytes = extractjson(\"$.ACTIVE_BYTES\", JsonString),\r\n    TableStorageMetricsTimeTravelBytes = extractjson(\"$.TIME_TRAVEL_BYTES\", JsonString),\r\n    TableStorageMetricsFailsafeBytes = extractjson(\"$.FAILSAFE_BYTES\", JsonString),\r\n    TableStorageMetricsRetainedForCloneBytes = extractjson(\"$.RETAINED_FOR_CLONE_BYTES\", JsonString),\r\n    TableStorageMetricsDeleted = extractjson(\"$.DELETED\", JsonString),\r\n    TableStorageMetricsTableCreated = unixtime_seconds_todatetime(TCTime),\r\n    TableStorageMetricsTableDropped = unixtime_seconds_todatetime(TDTime),\r\n    TableStorageMetricsTableEnteredFailsafe = unixtime_seconds_todatetime(TFTime),\r\n    TableStorageMetricsSchemaCreated = unixtime_seconds_todatetime(SCTime),\r\n    TableStorageMetricsSchemaDropped = unixtime_seconds_todatetime(SDTime),\r\n    TableStorageMetricsCatalogCreated = unixtime_seconds_todatetime(CCTime),\r\n    TableStorageMetricsCatalogDropped = unixtime_seconds_todatetime(CDTime),\r\n    TableStorageMetricsComment = extractjson(\"$.COMMENT\", JsonString),\r\n    TableStorageMetricsInstanceId = extractjson(\"$.INSTANCE_ID\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
            },
            {
              "description": "Get Sample Users of Snowflake",
              "query": "SnowflakeUsers_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString)),\r\n    BMTime = toreal(extractjson(\"$.BYPASS_MFA_UNTIL\", JsonString)),\r\n    LSLTime = toreal(extractjson(\"$.LAST_SUCCESS_LOGIN\", JsonString)),\r\n    ETime = toreal(extractjson(\"$.EXPIRES_AT\", JsonString)),\r\n    LUTime = toreal(extractjson(\"$.LOCKED_UNTIL_TIME\", JsonString)),\r\n    PLSTime = toreal(extractjson(\"$.PASSWORD_LAST_SET_TIME\", JsonString))\r\n| extend\r\n    UserId = extractjson(\"$.USER_ID\", JsonString),\r\n    UserName = extractjson(\"$.NAME\", JsonString),\r\n    UserCreatedOn = extractjson(\"$.CREATED_ON\", JsonString),\r\n    UserDeletedOn = extractjson(\"$.DELETED_ON\", JsonString),\r\n    UserLoginName = extractjson(\"$.LOGIN_NAME\", JsonString),\r\n    UserDisplayName = extractjson(\"$.DISPLAY_NAME\", JsonString),\r\n    UserFirstName = extractjson(\"$.FIRST_NAME\", JsonString),\r\n    UserLastName = extractjson(\"$.LAST_NAME\", JsonString),\r\n    UserEmail = extractjson(\"$.EMAIL\", JsonString),\r\n    UserMustChangePassword = extractjson(\"$.MUST_CHANGE_PASSWORD\", JsonString),\r\n    UserHasPassword = extractjson(\"$.HAS_PASSWORD\", JsonString),\r\n    UserComment = extractjson(\"$.COMMENT\", JsonString),\r\n    UserDisabled = extractjson(\"$.DISABLED\", JsonString),\r\n    UserSnowflakeLock = extractjson(\"$.SNOWFLAKE_LOCK\", JsonString),\r\n    UserDefaultWarehouse = extractjson(\"$.DEFAULT_WAREHOUSE\", JsonString),\r\n    UserDefaultNamespace = extractjson(\"$.DEFAULT_NAMESPACE\", JsonString),\r\n    UserDefaultRole = extractjson(\"$.DEFAULT_ROLE\", JsonString),\r\n    UserExtAuthnDuo = extractjson(\"$.EXT_AUTHN_DUO\", JsonString),\r\n    UserExtAuthnUid = extractjson(\"$.EXT_AUTHN_UID\", JsonString),\r\n    UserHasMFA = extractjson(\"$.HAS_MFA\", JsonString),\r\n    UserBypassMFAUntil = unixtime_seconds_todatetime(BMTime),\r\n    UserLastSuccessLogin = unixtime_seconds_todatetime(LSLTime),\r\n    UserExpiresAt = unixtime_seconds_todatetime(ETime),\r\n    UserLockedUntilTime = unixtime_seconds_todatetime(LUTime),\r\n    UserHasRSAPublicKey = extractjson(\"$.HAS_RSA_PUBLIC_KEY\", JsonString),\r\n    UserPasswordLastSetTime = unixtime_seconds_todatetime(PLSTime),\r\n    UserOwner = extractjson(\"$.OWNER\", JsonString),\r\n    UserDefaultSecondaryRole = extractjson(\"$.DEFAULT_SECONDARY_ROLE\", JsonString),\r\n    UserType = extractjson(\"$.TYPE\", JsonString),\r\n    UserDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString),\r\n    UserDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\r\n    UserSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    UserSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "SnowflakeLoad_CL",
              "lastDataReceivedQuery": "SnowflakeLoad_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            },
            {
              "name": "SnowflakeLogin_CL",
              "lastDataReceivedQuery": "SnowflakeLogin_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            },
            {
              "name": "SnowflakeMaterializedView_CL",
              "lastDataReceivedQuery": "SnowflakeMaterializedView_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            },
            {
              "name": "SnowflakeQuery_CL",
              "lastDataReceivedQuery": "SnowflakeQuery_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            },
            {
              "name": "SnowflakeRoleGrant_CL",
              "lastDataReceivedQuery": "SnowflakeRoleGrant_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            },
            {
              "name": "SnowflakeRoles_CL",
              "lastDataReceivedQuery": "SnowflakeRoles_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            },
            {
              "name": "SnowflakeTables_CL",
              "lastDataReceivedQuery": "SnowflakeTables_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            },
            {
              "name": "SnowflakeTableStorageMetrics_CL",
              "lastDataReceivedQuery": "SnowflakeTableStorageMetrics_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            },
            {
              "name": "SnowflakeUserGrant_CL",
              "lastDataReceivedQuery": "SnowflakeUserGrant_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            },
            {
              "name": "SnowflakeUsers_CL",
              "lastDataReceivedQuery": "SnowflakeUsers_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "availability": {
            "isPreview": false,
            "status": 1
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true,
                  "action": false
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "title": "Connect Snowflake to Microsoft Sentinel",
              "instructions": [
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": ">**NOTE:** To ensure data is presented in separate columns for each field, execute the parser using the **Snowflake()** function"
                  }
                },
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "To gather data from Snowflake, you need to provide the following resources"
                  }
                },
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "#### 1. Account Identifier \n To gather data from Snowflake, you'll need Snowflake Account Identifier."
                  }
                },
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "#### 2. Programmatic Access Token \n To gather data from Snowflake, you'll need the Snowflake Programmatic Access Token"
                  }
                },
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "For detailed instructions on retrieving the Account Identifier and Programmatic Access Token, please refer to the [Connector Tutorial](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Snowflake/Data%20Connectors/Readme.md)."
                  }
                },
                {
                  "type": "DataConnectorsGrid",
                  "parameters": {
                    "mapping": [
                      {
                        "columnName": "Account-Identifier",
                        "columnValue": "properties.addOnAttributes.AccountId"
                      },
                      {
                        "columnName": "Table Name",
                        "columnValue": "properties.dataType"
                      }
                    ],
                    "menuItems": [
                      "DeleteConnector"
                    ]
                  }
                },
                {
                  "type": "ContextPane",
                  "parameters": {
                    "isPrimary": true,
                    "label": "Add Account",
                    "title": "Add Account",
                    "subtitle": "Add Account",
                    "contextPaneType": "DataConnectorsContextPane",
                    "instructionSteps": [
                      {
                        "instructions": [
                          {
                            "type": "Textbox",
                            "parameters": {
                              "label": "Snowflake Account Identifier",
                              "placeholder": "Enter Snowflake Account Identifier",
                              "type": "text",
                              "name": "accountId",
                              "validations": {
                                "required": true
                              }
                            }
                          },
                          {
                            "type": "Textbox",
                            "parameters": {
                              "label": "Snowflake PAT",
                              "placeholder": "Enter Snowflake PAT",
                              "type": "password",
                              "name": "apikey",
                              "validations": {
                                "required": true
                              }
                            }
                          }
                        ]
                      }
                    ]
                  }
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "Snowflake (via Codeless Connector Framework)",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "connectorDefinitionName": {
              "defaultValue": "Snowflake (via Codeless Connector Framework)",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "accountId": {
              "defaultValue": "accountId",
              "type": "securestring",
              "minLength": 1
            },
            "apikey": {
              "defaultValue": "apikey",
              "type": "securestring",
              "minLength": 1
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SnowflakeLoadPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apikey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','/api/v2/statements?retry=true')]",
                  "httpMethod": "POST",
                  "queryWindowInMin": 10,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "retryCount": 5,
                  "timeoutInSeconds": 180,
                  "isPostPayloadJson": true,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "nullable": "false"
                  },
                  "queryParametersTemplate": "{\r\n                        \"statement\": \"SELECT OBJECT_CONSTRUCT_KEEP_NULL(*) AS data FROM LOAD_HISTORY WHERE LAST_LOAD_TIME > '{_QueryWindowStartTime}' AND LAST_LOAD_TIME < '{_QueryWindowEndTime}' ORDER BY LAST_LOAD_TIME ASC\",\r\n                        \"database\": \"SNOWFLAKE\",\r\n                        \"schema\": \"ACCOUNT_USAGE\"\r\n                    }"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','$.statementStatusUrl')]"
                },
                "connectorDefinitionName": "SnowflakeLogsCCPDefinition",
                "dataType": "SnowflakeLoad_CL",
                "dcrConfig": {
                  "streamName": "Custom-SnowflakeLoad",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "addOnAttributes": {
                  "AccountId": "[[parameters('accountId')]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SnowflakeLoginPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','/api/v2/statements?retry=true')]",
                  "httpMethod": "POST",
                  "queryWindowInMin": 10,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "retryCount": 5,
                  "timeoutInSeconds": 180,
                  "isPostPayloadJson": true,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "nullable": "false"
                  },
                  "queryParametersTemplate": "{\r\n                        \"statement\": \"SELECT OBJECT_CONSTRUCT_KEEP_NULL(*) AS data FROM LOGIN_HISTORY WHERE EVENT_TIMESTAMP > '{_QueryWindowStartTime}' AND EVENT_TIMESTAMP < '{_QueryWindowEndTime}' ORDER BY EVENT_TIMESTAMP ASC\",\r\n                        \"database\": \"SNOWFLAKE\",\r\n                        \"schema\": \"ACCOUNT_USAGE\"\r\n                    }"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','$.statementStatusUrl')]"
                },
                "connectorDefinitionName": "SnowflakeLogsCCPDefinition",
                "dataType": "SnowflakeLogin_CL",
                "dcrConfig": {
                  "streamName": "Custom-SnowflakeLogin",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "addOnAttributes": {
                  "AccountId": "[[parameters('accountId')]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SnowflakeMaterializedViewPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','/api/v2/statements?retry=true')]",
                  "httpMethod": "POST",
                  "queryWindowInMin": 10,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "retryCount": 5,
                  "timeoutInSeconds": 180,
                  "isPostPayloadJson": true,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "nullable": "false"
                  },
                  "queryParametersTemplate": "{\r\n                        \"statement\": \"SELECT OBJECT_CONSTRUCT_KEEP_NULL(*) AS data FROM MATERIALIZED_VIEW_REFRESH_HISTORY WHERE START_TIME > '{_QueryWindowStartTime}' AND START_TIME < '{_QueryWindowEndTime}' ORDER BY START_TIME ASC\",\r\n                        \"database\": \"SNOWFLAKE\",\r\n                        \"schema\": \"ACCOUNT_USAGE\"\r\n                    }"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','$.statementStatusUrl')]"
                },
                "connectorDefinitionName": "SnowflakeLogsCCPDefinition",
                "dataType": "SnowflakeMaterializedView_CL",
                "dcrConfig": {
                  "streamName": "Custom-SnowflakeMaterializedView",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "addOnAttributes": {
                  "AccountId": "[[parameters('accountId')]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SnowflakeQueryPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','/api/v2/statements?retry=true')]",
                  "httpMethod": "POST",
                  "queryWindowInMin": 10,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "retryCount": 5,
                  "timeoutInSeconds": 180,
                  "isPostPayloadJson": true,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "nullable": "false"
                  },
                  "queryParametersTemplate": "{\r\n                        \"statement\": \"SELECT OBJECT_CONSTRUCT_KEEP_NULL(*) AS data FROM QUERY_HISTORY WHERE START_TIME > '{_QueryWindowStartTime}' AND START_TIME < '{_QueryWindowEndTime}' ORDER BY START_TIME ASC\",\r\n                        \"database\": \"SNOWFLAKE\",\r\n                        \"schema\": \"ACCOUNT_USAGE\"\r\n                    }"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','$.statementStatusUrl')]"
                },
                "connectorDefinitionName": "SnowflakeLogsCCPDefinition",
                "dataType": "SnowflakeQuery_CL",
                "dcrConfig": {
                  "streamName": "Custom-SnowflakeQuery",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "addOnAttributes": {
                  "AccountId": "[[parameters('accountId')]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SnowflakeRoleGrantPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','/api/v2/statements?retry=true')]",
                  "httpMethod": "POST",
                  "queryWindowInMin": 10,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "retryCount": 5,
                  "timeoutInSeconds": 180,
                  "isPostPayloadJson": true,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "nullable": "false"
                  },
                  "queryParametersTemplate": "{\r\n                        \"statement\": \"SELECT OBJECT_CONSTRUCT_KEEP_NULL(*) AS data FROM GRANTS_TO_ROLES WHERE CREATED_ON > '{_QueryWindowStartTime}' AND CREATED_ON < '{_QueryWindowEndTime}' ORDER BY CREATED_ON ASC\",\r\n                        \"database\": \"SNOWFLAKE\",\r\n                        \"schema\": \"ACCOUNT_USAGE\"\r\n                    }"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','$.statementStatusUrl')]"
                },
                "connectorDefinitionName": "SnowflakeLogsCCPDefinition",
                "dataType": "SnowflakeRoleGrant_CL",
                "dcrConfig": {
                  "streamName": "Custom-SnowflakeRoleGrant",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "addOnAttributes": {
                  "AccountId": "[[parameters('accountId')]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SnowflakeRolesPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','/api/v2/statements?retry=true')]",
                  "httpMethod": "POST",
                  "queryWindowInMin": 10,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "retryCount": 5,
                  "timeoutInSeconds": 180,
                  "isPostPayloadJson": true,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "nullable": "false"
                  },
                  "queryParametersTemplate": "{\r\n                        \"statement\": \"SELECT OBJECT_CONSTRUCT_KEEP_NULL(*) AS data FROM ROLES WHERE CREATED_ON > '{_QueryWindowStartTime}' AND CREATED_ON < '{_QueryWindowEndTime}' ORDER BY CREATED_ON ASC\",\r\n                        \"database\": \"SNOWFLAKE\",\r\n                        \"schema\": \"ACCOUNT_USAGE\"\r\n                    }"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','$.statementStatusUrl')]"
                },
                "connectorDefinitionName": "SnowflakeLogsCCPDefinition",
                "dataType": "SnowflakeRoles_CL",
                "dcrConfig": {
                  "streamName": "Custom-SnowflakeRoles",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "addOnAttributes": {
                  "AccountId": "[[parameters('accountId')]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SnowflakeTablesPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','/api/v2/statements?retry=true')]",
                  "httpMethod": "POST",
                  "queryWindowInMin": 10,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "retryCount": 5,
                  "timeoutInSeconds": 180,
                  "isPostPayloadJson": true,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "nullable": "false"
                  },
                  "queryParametersTemplate": "{\r\n                        \"statement\": \"SELECT OBJECT_CONSTRUCT_KEEP_NULL(*) AS data FROM TABLES WHERE CREATED > '{_QueryWindowStartTime}' AND CREATED < '{_QueryWindowEndTime}' ORDER BY CREATED ASC\",\r\n                        \"database\": \"SNOWFLAKE\",\r\n                        \"schema\": \"ACCOUNT_USAGE\"\r\n                    }"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','$.statementStatusUrl')]"
                },
                "connectorDefinitionName": "SnowflakeLogsCCPDefinition",
                "dataType": "SnowflakeTables_CL",
                "dcrConfig": {
                  "streamName": "Custom-SnowflakeTable",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "addOnAttributes": {
                  "AccountId": "[[parameters('accountId')]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SnowflakeTableStorageMetricsPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','/api/v2/statements?retry=true')]",
                  "httpMethod": "POST",
                  "queryWindowInMin": 10,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "retryCount": 5,
                  "timeoutInSeconds": 180,
                  "isPostPayloadJson": true,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "nullable": "false"
                  },
                  "queryParametersTemplate": "{\r\n                        \"statement\": \"SELECT OBJECT_CONSTRUCT_KEEP_NULL(*) AS data FROM TABLE_STORAGE_METRICS WHERE TABLE_CREATED > '{_QueryWindowStartTime}' AND TABLE_CREATED < '{_QueryWindowEndTime}' ORDER BY TABLE_CREATED ASC\",\r\n                        \"database\": \"SNOWFLAKE\",\r\n                        \"schema\": \"ACCOUNT_USAGE\"\r\n                    }"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','$.statementStatusUrl')]"
                },
                "connectorDefinitionName": "SnowflakeLogsCCPDefinition",
                "dataType": "SnowflakeTableStorageMetrics_CL",
                "dcrConfig": {
                  "streamName": "Custom-SnowflakeTableStorageMetrics",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "addOnAttributes": {
                  "AccountId": "[[parameters('accountId')]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SnowflakeUserGrantPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','/api/v2/statements?retry=true')]",
                  "httpMethod": "POST",
                  "queryWindowInMin": 10,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "retryCount": 5,
                  "timeoutInSeconds": 180,
                  "isPostPayloadJson": true,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "nullable": "false"
                  },
                  "queryParametersTemplate": "{\r\n                        \"statement\": \"SELECT OBJECT_CONSTRUCT_KEEP_NULL(*) AS data FROM GRANTS_TO_USERS WHERE CREATED_ON > '{_QueryWindowStartTime}' AND CREATED_ON < '{_QueryWindowEndTime}' ORDER BY CREATED_ON ASC\",\r\n                        \"database\": \"SNOWFLAKE\",\r\n                        \"schema\": \"ACCOUNT_USAGE\"\r\n                    }"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','$.statementStatusUrl')]"
                },
                "connectorDefinitionName": "SnowflakeLogsCCPDefinition",
                "dataType": "SnowflakeUserGrant_CL",
                "dcrConfig": {
                  "streamName": "Custom-SnowflakeUserGrant",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "addOnAttributes": {
                  "AccountId": "[[parameters('accountId')]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SnowflakeUsersPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','/api/v2/statements?retry=true')]",
                  "httpMethod": "POST",
                  "queryWindowInMin": 10,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "retryCount": 5,
                  "timeoutInSeconds": 180,
                  "isPostPayloadJson": true,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "nullable": "false"
                  },
                  "queryParametersTemplate": "{\r\n                        \"statement\": \"SELECT OBJECT_CONSTRUCT_KEEP_NULL(*) AS data FROM USERS WHERE CREATED_ON > '{_QueryWindowStartTime}' AND CREATED_ON < '{_QueryWindowEndTime}' ORDER BY CREATED_ON ASC\",\r\n                        \"database\": \"SNOWFLAKE\",\r\n                        \"schema\": \"ACCOUNT_USAGE\"\r\n                    }"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader",
                  "linkHeaderTokenJsonPath": "[[concat('https://',parameters('accountId'),'.snowflakecomputing.com','$.statementStatusUrl')]"
                },
                "connectorDefinitionName": "SnowflakeLogsCCPDefinition",
                "dataType": "SnowflakeUsers_CL",
                "dcrConfig": {
                  "streamName": "Custom-SnowflakeUsers",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "addOnAttributes": {
                  "AccountId": "[[parameters('accountId')]"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject1').huntingQueryTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeAdminSources_HuntingQueries Hunting Query with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject1').huntingQueryVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Snowflake_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Snowflake - Privileged users' source IP addresses",
                "category": "Hunting Queries",
                "query": "Snowflake\n| where TimeGenerated > ago(24h)\n| where QUERY_TYPE_s =~ 'SELECT'\n| summarize roles = makeset(ROLE_NAME_s) by TargetUsername\n| join(Snowflake\n      | where TimeGenerated > ago(24h)\n      | where EventType =~ 'LOGIN') on TargetUsername\n| project-away TargetUsername1\n| where roles has_any ('SECURITYADMIN', 'SYSADMIN', 'ACCOUNTADMIN')\n| summarize ip_lst = makeset(SrcDvcIpAddr) by TargetUsername\n| extend AccountCustomEntity = TargetUsername, IPCustomEntity = ip_lst\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for privileged users' source IP addresses."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1),'/'))))]",
              "properties": {
                "description": "Snowflake Hunting Query 1",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1)]",
                "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject1').huntingQueryVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
        "contentKind": "HuntingQuery",
        "displayName": "Snowflake - Privileged users' source IP addresses",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject2').huntingQueryTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeDeletedDatabases_HuntingQueries Hunting Query with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject2').huntingQueryVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Snowflake_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Snowflake - Deleted databases",
                "category": "Hunting Queries",
                "query": "Snowflake\n| where TimeGenerated > ago(24h)\n| where QUERY_TYPE_s =~ 'DROP'\n| where QUERY_TEXT_s has 'database'\n| where EXECUTION_STATUS_s =~ 'SUCCESS'\n| extend AccountCustomEntity = TargetUsername\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for deleted databases."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1485"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2),'/'))))]",
              "properties": {
                "description": "Snowflake Hunting Query 2",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2)]",
                "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject2').huntingQueryVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
        "contentKind": "HuntingQuery",
        "displayName": "Snowflake - Deleted databases",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject3').huntingQueryTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeDeletedTables_HuntingQueries Hunting Query with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject3').huntingQueryVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Snowflake_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Snowflake - Deleted tables",
                "category": "Hunting Queries",
                "query": "Snowflake\n| where TimeGenerated > ago(24h)\n| where QUERY_TYPE_s =~ 'DROP'\n| where QUERY_TEXT_s has 'table'\n| where EXECUTION_STATUS_s =~ 'SUCCESS'\n| extend AccountCustomEntity = TargetUsername\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for deleted tables."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1485"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3),'/'))))]",
              "properties": {
                "description": "Snowflake Hunting Query 3",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3)]",
                "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject3').huntingQueryVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
        "contentKind": "HuntingQuery",
        "displayName": "Snowflake - Deleted tables",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject4').huntingQueryTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeDormantUser_HuntingQueries Hunting Query with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject4').huntingQueryVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Snowflake_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Snowflake - Rarely used account",
                "category": "Hunting Queries",
                "query": "Snowflake\n| where TimeGenerated > ago(30d)\n| where EventType =~ 'LOGIN'\n| where IS_SUCCESS_s =~ 'Yes'\n| summarize last_login_time = max(TimeGenerated) by TargetUsername\n| where last_login_time < ago(20d)\n| extend AccountCustomEntity = TargetUsername\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for rarely used accounts."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4),'/'))))]",
              "properties": {
                "description": "Snowflake Hunting Query 4",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4)]",
                "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject4').huntingQueryVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
        "contentKind": "HuntingQuery",
        "displayName": "Snowflake - Rarely used account",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject5').huntingQueryTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeFailedLogins_HuntingQueries Hunting Query with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject5').huntingQueryVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Snowflake_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Snowflake - Failed logins",
                "category": "Hunting Queries",
                "query": "Snowflake\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'LOGIN'\n| where IS_SUCCESS_s =~ 'No'\n| summarize count() by TargetUsername\n| extend AccountCustomEntity = TargetUsername\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for failed logins."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5),'/'))))]",
              "properties": {
                "description": "Snowflake Hunting Query 5",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5)]",
                "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject5').huntingQueryVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
        "contentKind": "HuntingQuery",
        "displayName": "Snowflake - Failed logins",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject6').huntingQueryTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeHighCreditConsumingQueries_HuntingQueries Hunting Query with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject6').huntingQueryVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Snowflake_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Snowflake - Credit consuming queries",
                "category": "Hunting Queries",
                "query": "let acceptable_credits = 0.00001;\nSnowflake\n| where TimeGenerated > ago(24h)\n| where CREDITS_USED_CLOUD_SERVICES_d > acceptable_credits\n| summarize by QUERY_TEXT_s, CREDITS_USED_CLOUD_SERVICES_d, TargetUsername\n| order by CREDITS_USED_CLOUD_SERVICES_d\n| extend AccountCustomEntity = TargetUsername\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for queries which consume abnormal amount of credits."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1499"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6),'/'))))]",
              "properties": {
                "description": "Snowflake Hunting Query 6",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6)]",
                "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject6').huntingQueryVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
        "contentKind": "HuntingQuery",
        "displayName": "Snowflake - Credit consuming queries",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject7').huntingQueryTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeTimeConsumingQueries_HuntingQueries Hunting Query with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject7').huntingQueryVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Snowflake_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Snowflake - Time consuming queries",
                "category": "Hunting Queries",
                "query": "let acceptable_duration = 1000;\nSnowflake\n| where TimeGenerated > ago(24h)\n| where TOTAL_ELAPSED_TIME_d > acceptable_duration\n| summarize by QUERY_TEXT_s, TOTAL_ELAPSED_TIME_d, TargetUsername\n| order by TOTAL_ELAPSED_TIME_d\n| extend AccountCustomEntity = TargetUsername\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for time consuming queries."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1499"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7),'/'))))]",
              "properties": {
                "description": "Snowflake Hunting Query 7",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7)]",
                "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject7').huntingQueryVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
        "contentKind": "HuntingQuery",
        "displayName": "Snowflake - Time consuming queries",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject8').huntingQueryTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeUnknownQueryType_HuntingQueries Hunting Query with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject8').huntingQueryVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Snowflake_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Snowflake - Unknown query type",
                "category": "Hunting Queries",
                "query": "Snowflake\n| where TimeGenerated > ago(24h)\n| where QUERY_TYPE_s =~ 'UNKNOWN'\n| summarize by QUERY_TEXT_s, TargetUsername\n| extend AccountCustomEntity = TargetUsername\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for queries of type UNKNOWN."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1499"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8),'/'))))]",
              "properties": {
                "description": "Snowflake Hunting Query 8",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8)]",
                "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject8').huntingQueryVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
        "contentKind": "HuntingQuery",
        "displayName": "Snowflake - Unknown query type",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject9').huntingQueryTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeUnusedAdmins_HuntingQueries Hunting Query with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject9').huntingQueryVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Snowflake_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Snowflake - Rarely used privileged users",
                "category": "Hunting Queries",
                "query": "Snowflake\n| where TimeGenerated > ago(30d)\n| where QUERY_TYPE_s =~ 'SELECT'\n| summarize roles = makeset(ROLE_NAME_s) by TargetUsername\n| join(Snowflake\n      | where TimeGenerated > ago(30d)\n      | where EventType =~ 'LOGIN'\n      | summarize last_login_t = max(TimeGenerated) by TargetUsername) on TargetUsername\n| project-away TargetUsername1\n| where roles has_any ('SECURITYADMIN', 'SYSADMIN', 'ACCOUNTADMIN')\n| where last_login_t < ago(20d)\n| extend AccountCustomEntity = TargetUsername\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for rarely used privileged users."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9),'/'))))]",
              "properties": {
                "description": "Snowflake Hunting Query 9",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9)]",
                "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject9').huntingQueryVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
        "contentKind": "HuntingQuery",
        "displayName": "Snowflake - Rarely used privileged users",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject10').huntingQueryTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SnowflakeUserSources_HuntingQueries Hunting Query with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject10').huntingQueryVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Snowflake_Hunting_Query_10",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Snowflake - Users' source IP addresses",
                "category": "Hunting Queries",
                "query": "Snowflake\n| where TimeGenerated > ago(24h)\n| where EventType =~ 'LOGIN'\n| where IS_SUCCESS_s =~ 'Yes'\n| summarize ip_lst = makeset(SrcDvcIpAddr) by TargetUsername\n| extend AccountCustomEntity = TargetUsername, IPCustomEntity = ip_lst\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for users' source IP addresses."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject10')._huntingQuerycontentId10),'/'))))]",
              "properties": {
                "description": "Snowflake Hunting Query 10",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject10')._huntingQuerycontentId10)]",
                "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject10').huntingQueryVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
        "contentKind": "HuntingQuery",
        "displayName": "Snowflake - Users' source IP addresses",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject10')._huntingQuerycontentId10,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject10')._huntingQuerycontentId10,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Snowflake Data Parser with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for Snowflake",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "Snowflake",
                "query": "let Snowflake_view = view () {\n  Snowflake_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend \n    EventStartTime = column_ifexists('START_TIME_t', ''),\n    EventType = column_ifexists('EVENT_TYPE_s', ''),\n    TargetUsername = column_ifexists('USER_NAME_s', ''),\n    SrcDvcIpAddr = column_ifexists('CLIENT_IP_s', ''),\n    QueryType = column_ifexists('QUERY_TYPE_s', ''),\n    QueryText = column_ifexists('QUERY_TEXT_s',''),\n    QueryExecutionStatus = column_ifexists('EXECUTION_STATUS_s', ''),\n    QueryTotalElapsedTime = toreal(column_ifexists('TOTAL_ELAPSED_TIME_d', '0')),\n    LoginIsSuccess = column_ifexists('IS_SUCCESS_s',''),\n    QueryCreditsUsedCloudServices = toreal(column_ifexists('CREDITS_USED_CLOUD_SERVICES_d','0')),\n    QueryExecutionTime = toreal(column_ifexists('EXECUTION_TIME_d','0')),\n    RoleName = column_ifexists('ROLE_NAME_s','')\n  | extend \n    User=TargetUsername,\n    EventEndTime=iff(isnotempty(EVENT_TIMESTAMP_t), EVENT_TIMESTAMP_t, END_TIME_t)\n};\nlet SnowflakeLogin_view = view () {\n  SnowflakeLogin_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeLogin'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend Time = toreal(extractjson(\"$.EVENT_TIMESTAMP\", JsonString))\n  | extend\n    SrcDvcIpAddr = extractjson(\"$.CLIENT_IP\", JsonString),\n    LoginClientPrivateLinkId = extractjson(\"$.CLIENT_PRIVATE_LINK_ID\", JsonString),\n    LoginConnection = extractjson(\"$.CONNECTION\", JsonString),\n    LoginErrorCode = extractjson(\"$.ERROR_CODE\", JsonString),\n    LoginErrorMessage = extractjson(\"$.ERROR_MESSAGE\", JsonString),\n    LoginEventId = extractjson(\"$.EVENT_ID\", JsonString),\n    LoginEventEndTime = unixtime_seconds_todatetime(Time),\n    LoginEventType = extractjson(\"$.EVENT_TYPE\", JsonString),\n    LoginFirstAuthenticationFactor = extractjson(\"$.FIRST_AUTHENTICATION_FACTOR\", JsonString),\n    LoginIsSuccess = extractjson(\"$.IS_SUCCESS\", JsonString),\n    LoginRelatedEventId = extractjson(\"$.RELATED_EVENT_ID\", JsonString),\n    LoginReportedClientType = extractjson(\"$.REPORTED_CLIENT_TYPE\", JsonString),\n    LoginReportedClientVersion = extractjson(\"$.REPORTED_CLIENT_VERSION\", JsonString),\n    LoginSecondAuthenticationFactor = extractjson(\"$.SECOND_AUTHENTICATION_FACTOR\", JsonString),\n    TargetUsername = extractjson(\"$.USER_NAME\", JsonString)\n  | extend User = TargetUsername\n};\nlet SnowflakeUserGrant_view = view () {\n  SnowflakeUserGrant_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeUserGrant'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\n  | extend\n    UserGrantCreatedOn = unixtime_seconds_todatetime(CTime),\n    UserGrantDeletedOn = unixtime_seconds_todatetime(DTime),\n    UserRole = extractjson(\"$.ROLE\", JsonString),\n    UserGrantGrantedTo = extractjson(\"$.GRANTED_TO\", JsonString),\n    UserGrantGranteeName = extractjson(\"$.GRANTEE_NAME\", JsonString),\n    UserGrantGrantedBy = extractjson(\"$.GRANTED_BY\", JsonString)\n};\nlet SnowflakeMaterializedView_view = view () {\n  SnowflakeMaterializedView_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeMaterializedView'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    STime = toreal(extractjson(\"$.START_TIME\", JsonString)),\n    ETime = toreal(extractjson(\"$.END_TIME\", JsonString))\n  | extend\n    MaterializedViewStartTime = unixtime_seconds_todatetime(STime),\n    MaterializedViewEndTime = unixtime_seconds_todatetime(ETime),\n    MaterializedViewCreditsUsed = extractjson(\"$.CREDITS_USED\", JsonString),\n    MaterializedViewTableId = extractjson(\"$.TABLE_ID\", JsonString),\n    MaterializedViewTableName = extractjson(\"$.TABLE_NAME\", JsonString),\n    MaterializedViewSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\n    MaterializedViewSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\n    MaterializedViewDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\n    MaterializedViewDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString)\n};\nlet SnowflakeRoles_view = view () {\n  SnowflakeRoles_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeRoles'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend \n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\n  | extend\n    RoleId = extractjson(\"$.ROLE_ID\", JsonString),\n    RoleCreatedOn = unixtime_seconds_todatetime(CTime),\n    RoleDeletedOn = unixtime_seconds_todatetime(DTime),\n    RoleName = extractjson(\"$.NAME\", JsonString),\n    RoleComment = extractjson(\"$.COMMENT\", JsonString),\n    RoleOwner = extractjson(\"$.OWNER\", JsonString),\n    RoleType = extractjson(\"$.ROLE_TYPE\", JsonString),\n    RoleDatabaseName = extractjson(\"$.ROLE_DATABASE_NAME\", JsonString),\n    RoleInstanceId = extractjson(\"$.ROLE_INSTANCE_ID\", JsonString),\n    OwnerRoleType = extractjson(\"$.OWNER_ROLE_TYPE\", JsonString)\n};\nlet SnowflakeRoleGrant_view = view () {\n  SnowflakeRoleGrant_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeRoleGrant'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend \n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\n    MTime = toreal(extractjson(\"$.MODIFIED_ON\", JsonString)),\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\n  | extend\n    RoleGrantCreatedOn = unixtime_seconds_todatetime(CTime),\n    RoleGrantModifiedOn = unixtime_seconds_todatetime(MTime),\n    RoleGrantPrivilege = extractjson(\"$.PRIVILEGE\", JsonString),\n    RoleGrantGrantedOn = extractjson(\"$.GRANTED_ON\", JsonString),\n    RoleGrantName = extractjson(\"$.NAME\", JsonString),\n    RoleGrantTableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\n    RoleGrantTableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\n    RoleGrantGrantedTo = extractjson(\"$.GRANTED_TO\", JsonString),\n    RoleGrantGranteeName = extractjson(\"$.GRANTEE_NAME\", JsonString),\n    RoleGrantGrantOption = extractjson(\"$.GRANT_OPTION\", JsonString),\n    RoleGrantGrantedBy = extractjson(\"$.GRANTED_BY\", JsonString),\n    RoleGrantDeletedOn = unixtime_seconds_todatetime(DTime),\n    RoleGrantGrantedByRoleType = extractjson(\"$.GRANTED_BY_ROLE_TYPE\", JsonString),\n    RoleGrantObjectInstance = extractjson(\"$.OBJECT_INSTANCE\", JsonString)\n};\nlet SnowflakeLoad_view = view () {\n  SnowflakeLoad_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeLoad'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend LTime = toreal(extractjson(\"$.LAST_LOAD_TIME\", JsonString))\n  | extend\n    LoadTableId = extractjson(\"$.TABLE_ID\", JsonString),\n    LoadTableName = extractjson(\"$.TABLE_NAME\", JsonString),\n    LoadSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\n    LoadSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\n    LoadCatalogId = extractjson(\"$.CATALOG_ID\", JsonString),\n    LoadCatalogName = extractjson(\"$.CATALOG_NAME\", JsonString),\n    LoadFileName = extractjson(\"$.FILE_NAME\", JsonString),\n    LastLoadTime = unixtime_seconds_todatetime(LTime),\n    LoadStatus = extractjson(\"$.STATUS\", JsonString),\n    LoadRowCount = extractjson(\"$.ROW_COUNT\", JsonString),\n    LoadRowParsed = extractjson(\"$.ROW_PARSED\", JsonString),\n    LoadFirstErrorMessage = extractjson(\"$.FIRST_ERROR_MESSAGE\", JsonString),\n    LoadFirstErrorLineNumber = extractjson(\"$.FIRST_ERROR_LINE_NUMBER\", JsonString),\n    LoadFirstErrorCharacterPosition = extractjson(\"$.FIRST_ERROR_CHARACTER_POSITION\", JsonString),\n    LoadFirstErrorColName = extractjson(\"$.FIRST_ERROR_COL_NAME\", JsonString),\n    LoadErrorCount = extractjson(\"$.ERROR_COUNT\", JsonString),\n    LoadErrorLimit = extractjson(\"$.ERROR_LIMIT\", JsonString)\n};\nlet SnowflakeTableStorageMetrics_view = view () {\n  SnowflakeTableStorageMetrics_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeTableStorageMetrics'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    TCTime = toreal(extractjson(\"$.TABLE_CREATED\", JsonString)),\n    TDTime = toreal(extractjson(\"$.TABLE_DROPPED\", JsonString)),\n    TFTime = toreal(extractjson(\"$.TABLE_ENTERED_FAILSAFE\", JsonString)),\n    SCTime = toreal(extractjson(\"$.SCHEMA_CREATED\", JsonString)),\n    SDTime = toreal(extractjson(\"$.SCHEMA_DROPPED\", JsonString)),\n    CCTime = toreal(extractjson(\"$.CATALOG_CREATED\", JsonString)),\n    CDTime = toreal(extractjson(\"$.CATALOG_DROPPED\", JsonString))\n  | extend\n    TableStorageMetricsId = extractjson(\"$.ID\", JsonString),\n    TableStorageMetricsTableName = extractjson(\"$.TABLE_NAME\", JsonString),\n    TableStorageMetricsTableSchemaId = extractjson(\"$.TABLE_SCHEMA_ID\", JsonString),\n    TableStorageMetricsTableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\n    TableStorageMetricsTableCatalogId = extractjson(\"$.TABLE_CATALOG_ID\", JsonString),\n    TableStorageMetricsTableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\n    TableStorageMetricsCloneGroupId = extractjson(\"$.CLONE_GROUP_ID\", JsonString),\n    TableStorageMetricsIsTransient = extractjson(\"$.IS_TRANSIENT\", JsonString),\n    TableStorageMetricsActiveBytes = extractjson(\"$.ACTIVE_BYTES\", JsonString),\n    TableStorageMetricsTimeTravelBytes = extractjson(\"$.TIME_TRAVEL_BYTES\", JsonString),\n    TableStorageMetricsFailsafeBytes = extractjson(\"$.FAILSAFE_BYTES\", JsonString),\n    TableStorageMetricsRetainedForCloneBytes = extractjson(\"$.RETAINED_FOR_CLONE_BYTES\", JsonString),\n    TableStorageMetricsDeleted = extractjson(\"$.DELETED\", JsonString),\n    TableStorageMetricsTableCreated = unixtime_seconds_todatetime(TCTime),\n    TableStorageMetricsTableDropped = unixtime_seconds_todatetime(TDTime),\n    TableStorageMetricsTableEnteredFailsafe = unixtime_seconds_todatetime(TFTime),\n    TableStorageMetricsSchemaCreated = unixtime_seconds_todatetime(SCTime),\n    TableStorageMetricsSchemaDropped = unixtime_seconds_todatetime(SDTime),\n    TableStorageMetricsCatalogCreated = unixtime_seconds_todatetime(CCTime),\n    TableStorageMetricsCatalogDropped = unixtime_seconds_todatetime(CDTime),\n    TableStorageMetricsComment = extractjson(\"$.COMMENT\", JsonString),\n    TableStorageMetricsInstanceId = extractjson(\"$.INSTANCE_ID\", JsonString)\n};\nlet SnowflakeTables_view = view () {\n  SnowflakeTables_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeTables'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    TCTime = toreal(extractjson(\"$.CREATED\", JsonString)),\n    LATime = toreal(extractjson(\"$.LAST_ALTERED\", JsonString)),\n    LDTime = toreal(extractjson(\"$.LAST_DDL\", JsonString)),\n    TDTime = toreal(extractjson(\"$.DELETED\", JsonString))\n  | extend\n    TableId = extractjson(\"$.TABLE_ID\", JsonString),\n    TableName = extractjson(\"$.TABLE_NAME\", JsonString),\n    TableSchemaId = extractjson(\"$.TABLE_SCHEMA_ID\", JsonString),\n    TableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\n    TableCatalogId = extractjson(\"$.TABLE_CATALOG_ID\", JsonString),\n    TableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\n    TableOwner = extractjson(\"$.TABLE_OWNER\", JsonString),\n    TableType = extractjson(\"$.TABLE_TYPE\", JsonString),\n    TableIsTransient = extractjson(\"$.IS_TRANSIENT\", JsonString),\n    TableIsIceberg = extractjson(\"$.IS_ICEBERG\", JsonString),\n    TableIsDynamic = extractjson(\"$.IS_DYNAMIC\", JsonString),\n    TableIsHybrid = extractjson(\"$.IS_HYBRID\", JsonString),\n    TableClusteringKey = extractjson(\"$.CLUSTERING_KEY\", JsonString),\n    TableRowCount = extractjson(\"$.ROW_COUNT\", JsonString),\n    TableBytes = extractjson(\"$.BYTES\", JsonString),\n    TableRetentionTime = extractjson(\"$.RETENTION_TIME\", JsonString),\n    TableSelfReferencingColumnName = extractjson(\"$.SELF_REFERENCING_COLUMN_NAME\", JsonString),\n    TableReferenceGeneration = extractjson(\"$.REFERENCE_GENERATION\", JsonString),\n    TableUserDefinedTypeCatalog = extractjson(\"$.USER_DEFINED_TYPE_CATALOG\", JsonString),\n    TableUserDefinedTypeSchema = extractjson(\"$.USER_DEFINED_TYPE_SCHEMA\", JsonString),\n    TableUserDefinedTypeName = extractjson(\"$.USER_DEFINED_TYPE_NAME\", JsonString),\n    TableIsInsertableInto = extractjson(\"$.IS_INSERTABLE_INTO\", JsonString),\n    TableIsTyped = extractjson(\"$.IS_TYPED\", JsonString),\n    TableCommitAction = extractjson(\"$.COMMIT_ACTION\", JsonString),\n    TableCreated = unixtime_seconds_todatetime(TCTime),\n    TableLastAltered = unixtime_seconds_todatetime(LATime),\n    TableLastDDL = unixtime_seconds_todatetime(LDTime),\n    TableLastDDLBy = extractjson(\"$.LAST_DDL_BY\", JsonString),\n    TableDeleted = unixtime_seconds_todatetime(TDTime),\n    TableAutoClusteringOn = extractjson(\"$.AUTO_CLUSTERING_ON\", JsonString),\n    TableComment = extractjson(\"$.COMMENT\", JsonString),\n    TableOwnerRoleType = extractjson(\"$.OWNER_ROLE_TYPE\", JsonString),\n    TableInstanceId = extractjson(\"$.INSTANCE_ID\", JsonString)\n};\nlet SnowflakeUsers_view = view () {\n  SnowflakeUsers_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeUsers'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString)),\n    BMTime = toreal(extractjson(\"$.BYPASS_MFA_UNTIL\", JsonString)),\n    LSLTime = toreal(extractjson(\"$.LAST_SUCCESS_LOGIN\", JsonString)),\n    ETime = toreal(extractjson(\"$.EXPIRES_AT\", JsonString)),\n    LUTime = toreal(extractjson(\"$.LOCKED_UNTIL_TIME\", JsonString)),\n    PLSTime = toreal(extractjson(\"$.PASSWORD_LAST_SET_TIME\", JsonString))\n  | extend\n    UserId = extractjson(\"$.USER_ID\", JsonString),\n    UserName = extractjson(\"$.NAME\", JsonString),\n    UserCreatedOn = extractjson(\"$.CREATED_ON\", JsonString),\n    UserDeletedOn = extractjson(\"$.DELETED_ON\", JsonString),\n    UserLoginName = extractjson(\"$.LOGIN_NAME\", JsonString),\n    UserDisplayName = extractjson(\"$.DISPLAY_NAME\", JsonString),\n    UserFirstName = extractjson(\"$.FIRST_NAME\", JsonString),\n    UserLastName = extractjson(\"$.LAST_NAME\", JsonString),\n    UserEmail = extractjson(\"$.EMAIL\", JsonString),\n    UserMustChangePassword = extractjson(\"$.MUST_CHANGE_PASSWORD\", JsonString),\n    UserHasPassword = extractjson(\"$.HAS_PASSWORD\", JsonString),\n    UserComment = extractjson(\"$.COMMENT\", JsonString),\n    UserDisabled = extractjson(\"$.DISABLED\", JsonString),\n    UserSnowflakeLock = extractjson(\"$.SNOWFLAKE_LOCK\", JsonString),\n    UserDefaultWarehouse = extractjson(\"$.DEFAULT_WAREHOUSE\", JsonString),\n    UserDefaultNamespace = extractjson(\"$.DEFAULT_NAMESPACE\", JsonString),\n    UserDefaultRole = extractjson(\"$.DEFAULT_ROLE\", JsonString),\n    UserExtAuthnDuo = extractjson(\"$.EXT_AUTHN_DUO\", JsonString),\n    UserExtAuthnUid = extractjson(\"$.EXT_AUTHN_UID\", JsonString),\n    UserHasMFA = extractjson(\"$.HAS_MFA\", JsonString),\n    UserBypassMFAUntil = unixtime_seconds_todatetime(BMTime),\n    UserLastSuccessLogin = unixtime_seconds_todatetime(LSLTime),\n    UserExpiresAt = unixtime_seconds_todatetime(ETime),\n    UserLockedUntilTime = unixtime_seconds_todatetime(LUTime),\n    UserHasRSAPublicKey = extractjson(\"$.HAS_RSA_PUBLIC_KEY\", JsonString),\n    UserPasswordLastSetTime = unixtime_seconds_todatetime(PLSTime),\n    UserOwner = extractjson(\"$.OWNER\", JsonString),\n    UserDefaultSecondaryRole = extractjson(\"$.DEFAULT_SECONDARY_ROLE\", JsonString),\n    UserType = extractjson(\"$.TYPE\", JsonString),\n    UserDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString),\n    UserDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\n    UserSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\n    UserSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString)\n};\nlet SnowflakeQuery_view = view () {\n  SnowflakeQuery_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeQuery'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    QueryStartTime = unixtime_seconds_todatetime(toreal(extractjson(\"$.START_TIME\", JsonString))),\n    QueryEndTime = unixtime_seconds_todatetime(toreal(extractjson(\"$.END_TIME\", JsonString))),\n    QueryTotalElapsedTime = toreal(extractjson(\"$.TOTAL_ELAPSED_TIME\", JsonString)),\n    QueryExecutionTime = toreal(extractjson(\"$.EXECUTION_TIME\", JsonString))\n  | extend\n    QueryId = extractjson(\"$.QUERY_ID\", JsonString),\n    QueryText = extractjson(\"$.QUERY_TEXT\", JsonString),\n    QueryDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\n    QueryDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString),\n    QuerySchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\n    QuerySchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\n    QueryType = extractjson(\"$.QUERY_TYPE\", JsonString),\n    QuerySessionId = extractjson(\"$.SESSION_ID\", JsonString),\n    QueryAuthnEventId = extractjson(\"$.AUTHN_EVENT_ID\", JsonString),\n    QueryUserName = extractjson(\"$.USER_NAME\", JsonString),\n    QueryRoleName = extractjson(\"$.ROLE_NAME\", JsonString),\n    QueryWarehouseId = extractjson(\"$.WAREHOUSE_ID\", JsonString),\n    QueryWarehouseName = extractjson(\"$.WAREHOUSE_NAME\", JsonString),\n    QueryWarehouseSize = extractjson(\"$.WAREHOUSE_SIZE\", JsonString),\n    QueryWarehouseType = extractjson(\"$.WAREHOUSE_TYPE\", JsonString),\n    QueryClusterNumber = extractjson(\"$.CLUSTER_NUMBER\", JsonString),\n    QueryTag = extractjson(\"$.TAG\", JsonString),\n    QueryBytesScanned = extractjson(\"$.BYTES_SCANNED\", JsonString),\n    QueryPercentageScannedFromCache = extractjson(\"$.PERCENTAGE_SCANNED_FROM_CACHE\", JsonString),\n    QueryBytesWritten = extractjson(\"$.BYTES_WRITTEN\", JsonString),\n    QueryBytesWrittenToResult = extractjson(\"$.BYTES_WRITTEN_TO_RESULT\", JsonString),\n    QueryBytesReadFromResult = extractjson(\"$.BYTES_READ_FROM_RESULT\", JsonString),\n    QueryRowsProduced = extractjson(\"$.ROWS_PRODUCED\", JsonString),\n    QueryRowsInserted = extractjson(\"$.ROWS_INSERTED\", JsonString),\n    QueryRowsUpdated = extractjson(\"$.ROWS_UPDATED\", JsonString),\n    QueryRowsDeleted = extractjson(\"$.ROWS_DELETED\", JsonString),\n    QueryRowsUnloaded = extractjson(\"$.ROWS_UNLOADED\", JsonString),\n    QueryBytesDeleted = extractjson(\"$.BYTES_DELETED\", JsonString),\n    QueryQueuedProvisioningTime = extractjson(\"$.PROVISIONING_TIME\", JsonString),\n    QueryQueuedRepairTime = extractjson(\"$.QUEUED_REPAIR_TIME\", JsonString),\n    QueryQueuedOverloadTime = extractjson(\"$.QUEUED_OVERLOAD_TIME\", JsonString),\n    QueryTransactionBlockedTime = extractjson(\"$.TRANSACTION_BLOCKED_TIME\", JsonString),\n    QueryOutboundDataTransferCloud = extractjson(\"$.OUTBOUND_DATA_TRANSFER_CLOUD\", JsonString),\n    QueryOutboundDataTransferRegion = extractjson(\"$.OUTBOUND_DATA_TRANSFER_REGION\", JsonString),\n    QueryOutboundDataTransferBytes = extractjson(\"$.OUTBOUND_DATA_TRANSFER_BYTES\", JsonString),\n    QueryInboundDataTransferCloud = extractjson(\"$.INBOUND_DATA_TRANSFER_CLOUD\", JsonString),\n    QueryInboundDataTransferRegion = extractjson(\"$.INBOUND_DATA_TRANSFER_REGION\", JsonString),\n    QueryInboundDataTransferBytes = extractjson(\"$.INBOUND_DATA_TRANSFER_BYTES\", JsonString),\n    QueryPartitionsScanned = extractjson(\"$.PARTITIONS_SCANNED\", JsonString),\n    QueryPartitionsTotal = extractjson(\"$.PARTITIONS_TOTAL\", JsonString),\n    QueryBytesSpilledToLocalStorage = extractjson(\"$.BYTES_SPILLED_TO_LOCAL_STORAGE\", JsonString),\n    QueryBytesSpilledToRemoteStorage = extractjson(\"$.BYTES_SPILLED_TO_REMOTE_STORAGE\", JsonString),\n    QueryBytesSentOverTheNetwork = extractjson(\"$.BYTES_SENT_OVER_THE_NETWORK\", JsonString),\n    QueryCompilationTime = extractjson(\"$.COMPILATION_TIME\", JsonString),\n    QueryExecutionStatus = extractjson(\"$.EXECUTION_STATUS\", JsonString),\n    QueryErrorCode = extractjson(\"$.ERROR_CODE\", JsonString),\n    QueryErrorMessage = extractjson(\"$.ERROR_MESSAGE\", JsonString),\n    QueryListExternalFilesTime = extractjson(\"$.LIST_EXTERNAL_FILES_TIME\", JsonString),\n    QueryCreditsUsedCloudServices = extractjson(\"$.CREDITS_USED_CLOUD_SERVICES\", JsonString),\n    QueryReleaseVersion = extractjson(\"$.RELEASE_VERSION\", JsonString),\n    QueryExternalFunctionTotalInvocations = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_INVOCATIONS\", JsonString),\n    QueryExternalFunctionTotalSentRows = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_SENT_ROWS\", JsonString),\n    QueryExternalFunctionTotalReceivedRows = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS\", JsonString),\n    QueryExternalFunctionTotalSentBytes = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_SENT_BYTES\", JsonString),\n    QueryExternalFunctionTotalReceivedBytes = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES\", JsonString),\n    QueryIsClientGeneratedStatement = extractjson(\"$.IS_CLIENT_GENERATED_STATEMENT\", JsonString),\n    QueryAccelerationBytesScanned = extractjson(\"$.ACCELERATION_BYTES_SCANNED\", JsonString),\n    QueryAccelerationPartitionsScanned = extractjson(\"$.ACCELERATION_PARTITIONS_SCANNED\", JsonString),\n    QueryAccelerationUpperLimitScaleFactor = extractjson(\"$.ACCELERATION_UPPER_LIMIT_SCALE_FACTOR\", JsonString),\n    QueryTransactionId = extractjson(\"$.TRANSACTION_ID\", JsonString),\n    QueryLoadPercent = extractjson(\"$.QUERY_LOAD_PERCENT\", JsonString),\n    ChildQueriesWaitTime = extractjson(\"$.CHILD_QUERIES_WAIT_TIME\", JsonString),\n    QueryRoleType = extractjson(\"$.ROLE_TYPE\", JsonString),\n    QueryHash = extractjson(\"$.HASH\", JsonString),\n    QueryHashVersion = extractjson(\"$.HASH_VERSION\", JsonString),\n    QueryParameterizedHash = extractjson(\"$.PARAMETERIZED_HASH\", JsonString),\n    QueryParameterizedHashVersion = extractjson(\"$.PARAMETERIZED_HASH_VERSION\", JsonString),\n    QuerySecondaryRoleStats = extractjson(\"$.SECONDARY_ROLE_STATS\", JsonString),\n    QueryRowsWrittenToResult = extractjson(\"$.ROWS_WRITTEN_TO_RESULT\", JsonString),\n    QueryRetryTime = extractjson(\"$.RETRY_TIME\", JsonString),\n    QueryRetryCause = extractjson(\"$.RETRY_CAUSE\", JsonString),\n    QueryFaultHandlingTime = extractjson(\"$.FAULT_HANDLING_TIME\", JsonString),\n    QueryUserType = extractjson(\"$.USER_TYPE\", JsonString),\n    QueryUserDatabaseName = extractjson(\"$.USER_DATABASE_NAME\", JsonString),\n    QueryUserDatabaseId = extractjson(\"$.USER_DATABASE_ID\", JsonString),\n    QueryUserSchemaId = extractjson(\"$.USER_SCHEMA_ID\", JsonString),\n    QueryUserSchemaName = extractjson(\"$.USER_SCHEMA_NAME\", JsonString)\n};\nunion isfuzzy=true\n    (SnowflakeLogin_view),\n    (SnowflakeUserGrant_view),\n    (SnowflakeMaterializedView_view),\n    (SnowflakeRoles_view),\n    (SnowflakeRoleGrant_view),\n    (SnowflakeLoad_view),\n    (SnowflakeTableStorageMetrics_view),\n    (SnowflakeTables_view),\n    (SnowflakeUsers_view),\n    (SnowflakeQuery_view)\n| extend DatabaseName = coalesce(QueryDatabaseName, UserDatabaseName, RoleDatabaseName, MaterializedViewDatabaseName)\n| extend TableNames = coalesce(TableName, MaterializedViewTableName, LoadTableName, TableStorageMetricsTableName)\n| extend EventStartTime = column_ifexists('EventStartTime', '')\n| project\n    EventVendor, \n    EventProduct,\n    EventType, \n    EventStartTime,\n    LoginEventType,\n    TargetUsername,\n    SrcDvcIpAddr,\n    User,\n    LoginEventEndTime,\n    LoginEventId,\n    LoginReportedClientType,\n    LoginReportedClientVersion,\n    LoginFirstAuthenticationFactor,\n    LoginSecondAuthenticationFactor,\n    LoginIsSuccess,\n    LoginErrorCode,\n    LoginErrorMessage,\n    LoginRelatedEventId,\n    LoginConnection,\n    LoginClientPrivateLinkId,\n    UserGrantCreatedOn,\n    UserGrantDeletedOn,\n    UserRole,\n    UserGrantGrantedTo,\n    UserGrantGranteeName,\n    UserGrantGrantedBy,\n    MaterializedViewStartTime,\n    MaterializedViewEndTime,\n    MaterializedViewCreditsUsed,\n    MaterializedViewTableId,\n    MaterializedViewTableName,\n    MaterializedViewSchemaId,\n    MaterializedViewSchemaName,\n    MaterializedViewDatabaseId,\n    MaterializedViewDatabaseName,\n    RoleId,\n    RoleCreatedOn,\n    RoleDeletedOn,\n    RoleName,\n    RoleComment,\n    RoleOwner,\n    RoleType,\n    RoleDatabaseName,\n    RoleInstanceId,\n    OwnerRoleType,\n    RoleGrantCreatedOn,\n    RoleGrantModifiedOn,\n    RoleGrantPrivilege,\n    RoleGrantGrantedOn,\n    RoleGrantName,\n    RoleGrantTableCatalog,\n    RoleGrantTableSchema,\n    RoleGrantGrantedTo,\n    RoleGrantGranteeName,\n    RoleGrantGrantOption,\n    RoleGrantGrantedBy,\n    RoleGrantDeletedOn,\n    RoleGrantGrantedByRoleType,\n    RoleGrantObjectInstance,\n    LoadTableId,\n    LoadTableName,\n    LoadSchemaId,\n    LoadSchemaName,\n    LoadCatalogId,\n    LoadCatalogName,\n    LoadFileName,\n    LastLoadTime,\n    LoadStatus,\n    LoadRowCount,\n    LoadRowParsed,\n    LoadFirstErrorMessage,\n    LoadFirstErrorLineNumber,\n    LoadFirstErrorCharacterPosition,\n    LoadFirstErrorColName,\n    LoadErrorCount,\n    LoadErrorLimit,\n    TableStorageMetricsId,\n    TableStorageMetricsTableName,\n    TableStorageMetricsTableSchemaId,\n    TableStorageMetricsTableSchema,\n    TableStorageMetricsTableCatalogId,\n    TableStorageMetricsTableCatalog,\n    TableStorageMetricsCloneGroupId,\n    TableStorageMetricsIsTransient,\n    TableStorageMetricsActiveBytes,\n    TableStorageMetricsTimeTravelBytes,\n    TableStorageMetricsFailsafeBytes,\n    TableStorageMetricsRetainedForCloneBytes,\n    TableStorageMetricsDeleted,\n    TableStorageMetricsTableCreated,\n    TableStorageMetricsTableDropped,\n    TableStorageMetricsTableEnteredFailsafe,\n    TableStorageMetricsSchemaCreated,\n    TableStorageMetricsSchemaDropped,\n    TableStorageMetricsCatalogCreated,\n    TableStorageMetricsCatalogDropped,\n    TableStorageMetricsComment,\n    TableStorageMetricsInstanceId,\n    TableId,\n    TableName,\n    TableNames,\n    TableSchemaId,\n    TableSchema,\n    TableCatalogId,\n    TableCatalog,\n    TableOwner,\n    TableType,\n    TableIsTransient,\n    TableIsIceberg,\n    TableIsDynamic,\n    TableIsHybrid,\n    TableClusteringKey,\n    TableRowCount,\n    TableBytes,\n    TableRetentionTime,\n    TableSelfReferencingColumnName,\n    TableReferenceGeneration,\n    TableUserDefinedTypeCatalog,\n    TableUserDefinedTypeSchema,\n    TableUserDefinedTypeName,\n    TableIsInsertableInto,\n    TableIsTyped,\n    TableCommitAction,\n    TableCreated,\n    TableLastAltered,\n    TableLastDDL,\n    TableLastDDLBy,\n    TableDeleted,\n    TableAutoClusteringOn,\n    TableComment,\n    TableOwnerRoleType,\n    TableInstanceId,\n    UserId,\n    UserName,\n    UserCreatedOn,\n    UserDeletedOn,\n    UserLoginName,\n    UserDisplayName,\n    UserFirstName,\n    UserLastName,\n    UserEmail,\n    UserMustChangePassword,\n    UserHasPassword,\n    UserComment,\n    UserDisabled,\n    UserSnowflakeLock,\n    UserDefaultWarehouse,\n    UserDefaultNamespace,\n    UserDefaultRole,\n    UserExtAuthnDuo,\n    UserExtAuthnUid,\n    UserHasMFA,\n    UserBypassMFAUntil,\n    UserLastSuccessLogin,\n    UserExpiresAt,\n    UserLockedUntilTime,\n    UserHasRSAPublicKey,\n    UserPasswordLastSetTime,\n    UserOwner,\n    UserDefaultSecondaryRole,\n    UserType,\n    UserDatabaseName,\n    UserDatabaseId,\n    UserSchemaName,\n    UserSchemaId,\n    QueryId,\n    QueryText,\n    QueryDatabaseId,\n    QueryDatabaseName,\n    QuerySchemaId,\n    QuerySchemaName,\n    QueryType,\n    QuerySessionId,\n    QueryUserName,\n    QueryRoleName,\n    QueryWarehouseId,\n    QueryWarehouseName,\n    QueryWarehouseSize,\n    QueryWarehouseType,\n    QueryClusterNumber,\n    QueryTag,\n    QueryExecutionStatus,\n    QueryErrorCode,\n    QueryErrorMessage,\n    QueryStartTime,\n    QueryTotalElapsedTime,\n    QueryBytesScanned,\n    QueryPercentageScannedFromCache,\n    QueryBytesWritten,\n    QueryBytesWrittenToResult,\n    QueryBytesReadFromResult,\n    QueryRowsProduced,\n    QueryRowsInserted,\n    QueryRowsUpdated,\n    QueryRowsDeleted,\n    QueryRowsUnloaded,\n    QueryBytesDeleted,\n    QueryPartitionsScanned,\n    QueryPartitionsTotal,\n    QueryBytesSpilledToLocalStorage,\n    QueryBytesSpilledToRemoteStorage,\n    QueryBytesSentOverTheNetwork,\n    QueryCompilationTime,\n    QueryExecutionTime,\n    QueryQueuedProvisioningTime,\n    QueryQueuedRepairTime,\n    QueryQueuedOverloadTime,\n    QueryTransactionBlockedTime,\n    QueryOutboundDataTransferCloud,\n    QueryOutboundDataTransferRegion,\n    QueryOutboundDataTransferBytes,\n    QueryInboundDataTransferCloud,\n    QueryInboundDataTransferRegion,\n    QueryInboundDataTransferBytes,\n    QueryListExternalFilesTime,\n    QueryCreditsUsedCloudServices,\n    QueryReleaseVersion,\n    QueryExternalFunctionTotalInvocations,\n    QueryExternalFunctionTotalSentRows,\n    QueryExternalFunctionTotalReceivedRows,\n    QueryExternalFunctionTotalSentBytes,\n    QueryExternalFunctionTotalReceivedBytes,\n    QueryLoadPercent,\n    QueryIsClientGeneratedStatement,\n    QueryAccelerationBytesScanned,\n    QueryAccelerationPartitionsScanned,\n    QueryAccelerationUpperLimitScaleFactor,\n    QueryTransactionId,\n    ChildQueriesWaitTime,\n    QueryRoleType,\n    QueryHash,\n    QueryHashVersion,\n    QueryParameterizedHash,\n    QueryParameterizedHashVersion,\n    QuerySecondaryRoleStats,\n    QueryRowsWrittenToResult,\n    QueryRetryTime,\n    QueryRetryCause,\n    QueryFaultHandlingTime,\n    QueryUserType,\n    QueryUserDatabaseName,\n    QueryUserDatabaseId,\n    QueryUserSchemaName,\n    QueryUserSchemaId,\n    DatabaseName,\n    TimeGenerated\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'Snowflake')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "Snowflake",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "Parser for Snowflake",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.3')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.3')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for Snowflake",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "Snowflake",
        "query": "let Snowflake_view = view () {\n  Snowflake_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend \n    EventStartTime = column_ifexists('START_TIME_t', ''),\n    EventType = column_ifexists('EVENT_TYPE_s', ''),\n    TargetUsername = column_ifexists('USER_NAME_s', ''),\n    SrcDvcIpAddr = column_ifexists('CLIENT_IP_s', ''),\n    QueryType = column_ifexists('QUERY_TYPE_s', ''),\n    QueryText = column_ifexists('QUERY_TEXT_s',''),\n    QueryExecutionStatus = column_ifexists('EXECUTION_STATUS_s', ''),\n    QueryTotalElapsedTime = toreal(column_ifexists('TOTAL_ELAPSED_TIME_d', '0')),\n    LoginIsSuccess = column_ifexists('IS_SUCCESS_s',''),\n    QueryCreditsUsedCloudServices = toreal(column_ifexists('CREDITS_USED_CLOUD_SERVICES_d','0')),\n    QueryExecutionTime = toreal(column_ifexists('EXECUTION_TIME_d','0')),\n    RoleName = column_ifexists('ROLE_NAME_s','')\n  | extend \n    User=TargetUsername,\n    EventEndTime=iff(isnotempty(EVENT_TIMESTAMP_t), EVENT_TIMESTAMP_t, END_TIME_t)\n};\nlet SnowflakeLogin_view = view () {\n  SnowflakeLogin_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeLogin'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend Time = toreal(extractjson(\"$.EVENT_TIMESTAMP\", JsonString))\n  | extend\n    SrcDvcIpAddr = extractjson(\"$.CLIENT_IP\", JsonString),\n    LoginClientPrivateLinkId = extractjson(\"$.CLIENT_PRIVATE_LINK_ID\", JsonString),\n    LoginConnection = extractjson(\"$.CONNECTION\", JsonString),\n    LoginErrorCode = extractjson(\"$.ERROR_CODE\", JsonString),\n    LoginErrorMessage = extractjson(\"$.ERROR_MESSAGE\", JsonString),\n    LoginEventId = extractjson(\"$.EVENT_ID\", JsonString),\n    LoginEventEndTime = unixtime_seconds_todatetime(Time),\n    LoginEventType = extractjson(\"$.EVENT_TYPE\", JsonString),\n    LoginFirstAuthenticationFactor = extractjson(\"$.FIRST_AUTHENTICATION_FACTOR\", JsonString),\n    LoginIsSuccess = extractjson(\"$.IS_SUCCESS\", JsonString),\n    LoginRelatedEventId = extractjson(\"$.RELATED_EVENT_ID\", JsonString),\n    LoginReportedClientType = extractjson(\"$.REPORTED_CLIENT_TYPE\", JsonString),\n    LoginReportedClientVersion = extractjson(\"$.REPORTED_CLIENT_VERSION\", JsonString),\n    LoginSecondAuthenticationFactor = extractjson(\"$.SECOND_AUTHENTICATION_FACTOR\", JsonString),\n    TargetUsername = extractjson(\"$.USER_NAME\", JsonString)\n  | extend User = TargetUsername\n};\nlet SnowflakeUserGrant_view = view () {\n  SnowflakeUserGrant_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeUserGrant'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\n  | extend\n    UserGrantCreatedOn = unixtime_seconds_todatetime(CTime),\n    UserGrantDeletedOn = unixtime_seconds_todatetime(DTime),\n    UserRole = extractjson(\"$.ROLE\", JsonString),\n    UserGrantGrantedTo = extractjson(\"$.GRANTED_TO\", JsonString),\n    UserGrantGranteeName = extractjson(\"$.GRANTEE_NAME\", JsonString),\n    UserGrantGrantedBy = extractjson(\"$.GRANTED_BY\", JsonString)\n};\nlet SnowflakeMaterializedView_view = view () {\n  SnowflakeMaterializedView_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeMaterializedView'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    STime = toreal(extractjson(\"$.START_TIME\", JsonString)),\n    ETime = toreal(extractjson(\"$.END_TIME\", JsonString))\n  | extend\n    MaterializedViewStartTime = unixtime_seconds_todatetime(STime),\n    MaterializedViewEndTime = unixtime_seconds_todatetime(ETime),\n    MaterializedViewCreditsUsed = extractjson(\"$.CREDITS_USED\", JsonString),\n    MaterializedViewTableId = extractjson(\"$.TABLE_ID\", JsonString),\n    MaterializedViewTableName = extractjson(\"$.TABLE_NAME\", JsonString),\n    MaterializedViewSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\n    MaterializedViewSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\n    MaterializedViewDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\n    MaterializedViewDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString)\n};\nlet SnowflakeRoles_view = view () {\n  SnowflakeRoles_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeRoles'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend \n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\n  | extend\n    RoleId = extractjson(\"$.ROLE_ID\", JsonString),\n    RoleCreatedOn = unixtime_seconds_todatetime(CTime),\n    RoleDeletedOn = unixtime_seconds_todatetime(DTime),\n    RoleName = extractjson(\"$.NAME\", JsonString),\n    RoleComment = extractjson(\"$.COMMENT\", JsonString),\n    RoleOwner = extractjson(\"$.OWNER\", JsonString),\n    RoleType = extractjson(\"$.ROLE_TYPE\", JsonString),\n    RoleDatabaseName = extractjson(\"$.ROLE_DATABASE_NAME\", JsonString),\n    RoleInstanceId = extractjson(\"$.ROLE_INSTANCE_ID\", JsonString),\n    OwnerRoleType = extractjson(\"$.OWNER_ROLE_TYPE\", JsonString)\n};\nlet SnowflakeRoleGrant_view = view () {\n  SnowflakeRoleGrant_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeRoleGrant'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend \n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\n    MTime = toreal(extractjson(\"$.MODIFIED_ON\", JsonString)),\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\n  | extend\n    RoleGrantCreatedOn = unixtime_seconds_todatetime(CTime),\n    RoleGrantModifiedOn = unixtime_seconds_todatetime(MTime),\n    RoleGrantPrivilege = extractjson(\"$.PRIVILEGE\", JsonString),\n    RoleGrantGrantedOn = extractjson(\"$.GRANTED_ON\", JsonString),\n    RoleGrantName = extractjson(\"$.NAME\", JsonString),\n    RoleGrantTableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\n    RoleGrantTableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\n    RoleGrantGrantedTo = extractjson(\"$.GRANTED_TO\", JsonString),\n    RoleGrantGranteeName = extractjson(\"$.GRANTEE_NAME\", JsonString),\n    RoleGrantGrantOption = extractjson(\"$.GRANT_OPTION\", JsonString),\n    RoleGrantGrantedBy = extractjson(\"$.GRANTED_BY\", JsonString),\n    RoleGrantDeletedOn = unixtime_seconds_todatetime(DTime),\n    RoleGrantGrantedByRoleType = extractjson(\"$.GRANTED_BY_ROLE_TYPE\", JsonString),\n    RoleGrantObjectInstance = extractjson(\"$.OBJECT_INSTANCE\", JsonString)\n};\nlet SnowflakeLoad_view = view () {\n  SnowflakeLoad_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeLoad'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend LTime = toreal(extractjson(\"$.LAST_LOAD_TIME\", JsonString))\n  | extend\n    LoadTableId = extractjson(\"$.TABLE_ID\", JsonString),\n    LoadTableName = extractjson(\"$.TABLE_NAME\", JsonString),\n    LoadSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\n    LoadSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\n    LoadCatalogId = extractjson(\"$.CATALOG_ID\", JsonString),\n    LoadCatalogName = extractjson(\"$.CATALOG_NAME\", JsonString),\n    LoadFileName = extractjson(\"$.FILE_NAME\", JsonString),\n    LastLoadTime = unixtime_seconds_todatetime(LTime),\n    LoadStatus = extractjson(\"$.STATUS\", JsonString),\n    LoadRowCount = extractjson(\"$.ROW_COUNT\", JsonString),\n    LoadRowParsed = extractjson(\"$.ROW_PARSED\", JsonString),\n    LoadFirstErrorMessage = extractjson(\"$.FIRST_ERROR_MESSAGE\", JsonString),\n    LoadFirstErrorLineNumber = extractjson(\"$.FIRST_ERROR_LINE_NUMBER\", JsonString),\n    LoadFirstErrorCharacterPosition = extractjson(\"$.FIRST_ERROR_CHARACTER_POSITION\", JsonString),\n    LoadFirstErrorColName = extractjson(\"$.FIRST_ERROR_COL_NAME\", JsonString),\n    LoadErrorCount = extractjson(\"$.ERROR_COUNT\", JsonString),\n    LoadErrorLimit = extractjson(\"$.ERROR_LIMIT\", JsonString)\n};\nlet SnowflakeTableStorageMetrics_view = view () {\n  SnowflakeTableStorageMetrics_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeTableStorageMetrics'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    TCTime = toreal(extractjson(\"$.TABLE_CREATED\", JsonString)),\n    TDTime = toreal(extractjson(\"$.TABLE_DROPPED\", JsonString)),\n    TFTime = toreal(extractjson(\"$.TABLE_ENTERED_FAILSAFE\", JsonString)),\n    SCTime = toreal(extractjson(\"$.SCHEMA_CREATED\", JsonString)),\n    SDTime = toreal(extractjson(\"$.SCHEMA_DROPPED\", JsonString)),\n    CCTime = toreal(extractjson(\"$.CATALOG_CREATED\", JsonString)),\n    CDTime = toreal(extractjson(\"$.CATALOG_DROPPED\", JsonString))\n  | extend\n    TableStorageMetricsId = extractjson(\"$.ID\", JsonString),\n    TableStorageMetricsTableName = extractjson(\"$.TABLE_NAME\", JsonString),\n    TableStorageMetricsTableSchemaId = extractjson(\"$.TABLE_SCHEMA_ID\", JsonString),\n    TableStorageMetricsTableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\n    TableStorageMetricsTableCatalogId = extractjson(\"$.TABLE_CATALOG_ID\", JsonString),\n    TableStorageMetricsTableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\n    TableStorageMetricsCloneGroupId = extractjson(\"$.CLONE_GROUP_ID\", JsonString),\n    TableStorageMetricsIsTransient = extractjson(\"$.IS_TRANSIENT\", JsonString),\n    TableStorageMetricsActiveBytes = extractjson(\"$.ACTIVE_BYTES\", JsonString),\n    TableStorageMetricsTimeTravelBytes = extractjson(\"$.TIME_TRAVEL_BYTES\", JsonString),\n    TableStorageMetricsFailsafeBytes = extractjson(\"$.FAILSAFE_BYTES\", JsonString),\n    TableStorageMetricsRetainedForCloneBytes = extractjson(\"$.RETAINED_FOR_CLONE_BYTES\", JsonString),\n    TableStorageMetricsDeleted = extractjson(\"$.DELETED\", JsonString),\n    TableStorageMetricsTableCreated = unixtime_seconds_todatetime(TCTime),\n    TableStorageMetricsTableDropped = unixtime_seconds_todatetime(TDTime),\n    TableStorageMetricsTableEnteredFailsafe = unixtime_seconds_todatetime(TFTime),\n    TableStorageMetricsSchemaCreated = unixtime_seconds_todatetime(SCTime),\n    TableStorageMetricsSchemaDropped = unixtime_seconds_todatetime(SDTime),\n    TableStorageMetricsCatalogCreated = unixtime_seconds_todatetime(CCTime),\n    TableStorageMetricsCatalogDropped = unixtime_seconds_todatetime(CDTime),\n    TableStorageMetricsComment = extractjson(\"$.COMMENT\", JsonString),\n    TableStorageMetricsInstanceId = extractjson(\"$.INSTANCE_ID\", JsonString)\n};\nlet SnowflakeTables_view = view () {\n  SnowflakeTables_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeTables'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    TCTime = toreal(extractjson(\"$.CREATED\", JsonString)),\n    LATime = toreal(extractjson(\"$.LAST_ALTERED\", JsonString)),\n    LDTime = toreal(extractjson(\"$.LAST_DDL\", JsonString)),\n    TDTime = toreal(extractjson(\"$.DELETED\", JsonString))\n  | extend\n    TableId = extractjson(\"$.TABLE_ID\", JsonString),\n    TableName = extractjson(\"$.TABLE_NAME\", JsonString),\n    TableSchemaId = extractjson(\"$.TABLE_SCHEMA_ID\", JsonString),\n    TableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\n    TableCatalogId = extractjson(\"$.TABLE_CATALOG_ID\", JsonString),\n    TableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\n    TableOwner = extractjson(\"$.TABLE_OWNER\", JsonString),\n    TableType = extractjson(\"$.TABLE_TYPE\", JsonString),\n    TableIsTransient = extractjson(\"$.IS_TRANSIENT\", JsonString),\n    TableIsIceberg = extractjson(\"$.IS_ICEBERG\", JsonString),\n    TableIsDynamic = extractjson(\"$.IS_DYNAMIC\", JsonString),\n    TableIsHybrid = extractjson(\"$.IS_HYBRID\", JsonString),\n    TableClusteringKey = extractjson(\"$.CLUSTERING_KEY\", JsonString),\n    TableRowCount = extractjson(\"$.ROW_COUNT\", JsonString),\n    TableBytes = extractjson(\"$.BYTES\", JsonString),\n    TableRetentionTime = extractjson(\"$.RETENTION_TIME\", JsonString),\n    TableSelfReferencingColumnName = extractjson(\"$.SELF_REFERENCING_COLUMN_NAME\", JsonString),\n    TableReferenceGeneration = extractjson(\"$.REFERENCE_GENERATION\", JsonString),\n    TableUserDefinedTypeCatalog = extractjson(\"$.USER_DEFINED_TYPE_CATALOG\", JsonString),\n    TableUserDefinedTypeSchema = extractjson(\"$.USER_DEFINED_TYPE_SCHEMA\", JsonString),\n    TableUserDefinedTypeName = extractjson(\"$.USER_DEFINED_TYPE_NAME\", JsonString),\n    TableIsInsertableInto = extractjson(\"$.IS_INSERTABLE_INTO\", JsonString),\n    TableIsTyped = extractjson(\"$.IS_TYPED\", JsonString),\n    TableCommitAction = extractjson(\"$.COMMIT_ACTION\", JsonString),\n    TableCreated = unixtime_seconds_todatetime(TCTime),\n    TableLastAltered = unixtime_seconds_todatetime(LATime),\n    TableLastDDL = unixtime_seconds_todatetime(LDTime),\n    TableLastDDLBy = extractjson(\"$.LAST_DDL_BY\", JsonString),\n    TableDeleted = unixtime_seconds_todatetime(TDTime),\n    TableAutoClusteringOn = extractjson(\"$.AUTO_CLUSTERING_ON\", JsonString),\n    TableComment = extractjson(\"$.COMMENT\", JsonString),\n    TableOwnerRoleType = extractjson(\"$.OWNER_ROLE_TYPE\", JsonString),\n    TableInstanceId = extractjson(\"$.INSTANCE_ID\", JsonString)\n};\nlet SnowflakeUsers_view = view () {\n  SnowflakeUsers_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeUsers'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString)),\n    BMTime = toreal(extractjson(\"$.BYPASS_MFA_UNTIL\", JsonString)),\n    LSLTime = toreal(extractjson(\"$.LAST_SUCCESS_LOGIN\", JsonString)),\n    ETime = toreal(extractjson(\"$.EXPIRES_AT\", JsonString)),\n    LUTime = toreal(extractjson(\"$.LOCKED_UNTIL_TIME\", JsonString)),\n    PLSTime = toreal(extractjson(\"$.PASSWORD_LAST_SET_TIME\", JsonString))\n  | extend\n    UserId = extractjson(\"$.USER_ID\", JsonString),\n    UserName = extractjson(\"$.NAME\", JsonString),\n    UserCreatedOn = extractjson(\"$.CREATED_ON\", JsonString),\n    UserDeletedOn = extractjson(\"$.DELETED_ON\", JsonString),\n    UserLoginName = extractjson(\"$.LOGIN_NAME\", JsonString),\n    UserDisplayName = extractjson(\"$.DISPLAY_NAME\", JsonString),\n    UserFirstName = extractjson(\"$.FIRST_NAME\", JsonString),\n    UserLastName = extractjson(\"$.LAST_NAME\", JsonString),\n    UserEmail = extractjson(\"$.EMAIL\", JsonString),\n    UserMustChangePassword = extractjson(\"$.MUST_CHANGE_PASSWORD\", JsonString),\n    UserHasPassword = extractjson(\"$.HAS_PASSWORD\", JsonString),\n    UserComment = extractjson(\"$.COMMENT\", JsonString),\n    UserDisabled = extractjson(\"$.DISABLED\", JsonString),\n    UserSnowflakeLock = extractjson(\"$.SNOWFLAKE_LOCK\", JsonString),\n    UserDefaultWarehouse = extractjson(\"$.DEFAULT_WAREHOUSE\", JsonString),\n    UserDefaultNamespace = extractjson(\"$.DEFAULT_NAMESPACE\", JsonString),\n    UserDefaultRole = extractjson(\"$.DEFAULT_ROLE\", JsonString),\n    UserExtAuthnDuo = extractjson(\"$.EXT_AUTHN_DUO\", JsonString),\n    UserExtAuthnUid = extractjson(\"$.EXT_AUTHN_UID\", JsonString),\n    UserHasMFA = extractjson(\"$.HAS_MFA\", JsonString),\n    UserBypassMFAUntil = unixtime_seconds_todatetime(BMTime),\n    UserLastSuccessLogin = unixtime_seconds_todatetime(LSLTime),\n    UserExpiresAt = unixtime_seconds_todatetime(ETime),\n    UserLockedUntilTime = unixtime_seconds_todatetime(LUTime),\n    UserHasRSAPublicKey = extractjson(\"$.HAS_RSA_PUBLIC_KEY\", JsonString),\n    UserPasswordLastSetTime = unixtime_seconds_todatetime(PLSTime),\n    UserOwner = extractjson(\"$.OWNER\", JsonString),\n    UserDefaultSecondaryRole = extractjson(\"$.DEFAULT_SECONDARY_ROLE\", JsonString),\n    UserType = extractjson(\"$.TYPE\", JsonString),\n    UserDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString),\n    UserDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\n    UserSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\n    UserSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString)\n};\nlet SnowflakeQuery_view = view () {\n  SnowflakeQuery_CL\n  | extend EventVendor = 'Snowflake'\n  | extend EventProduct = 'Snowflake'\n  | extend EventType = 'SnowflakeQuery'\n  | mv-expand OuterArray = todynamic(Data)\n  | mv-expand innerArray = OuterArray\n  | extend JsonString = tostring(innerArray)\n  | extend\n    QueryStartTime = unixtime_seconds_todatetime(toreal(extractjson(\"$.START_TIME\", JsonString))),\n    QueryEndTime = unixtime_seconds_todatetime(toreal(extractjson(\"$.END_TIME\", JsonString))),\n    QueryTotalElapsedTime = toreal(extractjson(\"$.TOTAL_ELAPSED_TIME\", JsonString)),\n    QueryExecutionTime = toreal(extractjson(\"$.EXECUTION_TIME\", JsonString))\n  | extend\n    QueryId = extractjson(\"$.QUERY_ID\", JsonString),\n    QueryText = extractjson(\"$.QUERY_TEXT\", JsonString),\n    QueryDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\n    QueryDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString),\n    QuerySchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\n    QuerySchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\n    QueryType = extractjson(\"$.QUERY_TYPE\", JsonString),\n    QuerySessionId = extractjson(\"$.SESSION_ID\", JsonString),\n    QueryAuthnEventId = extractjson(\"$.AUTHN_EVENT_ID\", JsonString),\n    QueryUserName = extractjson(\"$.USER_NAME\", JsonString),\n    QueryRoleName = extractjson(\"$.ROLE_NAME\", JsonString),\n    QueryWarehouseId = extractjson(\"$.WAREHOUSE_ID\", JsonString),\n    QueryWarehouseName = extractjson(\"$.WAREHOUSE_NAME\", JsonString),\n    QueryWarehouseSize = extractjson(\"$.WAREHOUSE_SIZE\", JsonString),\n    QueryWarehouseType = extractjson(\"$.WAREHOUSE_TYPE\", JsonString),\n    QueryClusterNumber = extractjson(\"$.CLUSTER_NUMBER\", JsonString),\n    QueryTag = extractjson(\"$.TAG\", JsonString),\n    QueryBytesScanned = extractjson(\"$.BYTES_SCANNED\", JsonString),\n    QueryPercentageScannedFromCache = extractjson(\"$.PERCENTAGE_SCANNED_FROM_CACHE\", JsonString),\n    QueryBytesWritten = extractjson(\"$.BYTES_WRITTEN\", JsonString),\n    QueryBytesWrittenToResult = extractjson(\"$.BYTES_WRITTEN_TO_RESULT\", JsonString),\n    QueryBytesReadFromResult = extractjson(\"$.BYTES_READ_FROM_RESULT\", JsonString),\n    QueryRowsProduced = extractjson(\"$.ROWS_PRODUCED\", JsonString),\n    QueryRowsInserted = extractjson(\"$.ROWS_INSERTED\", JsonString),\n    QueryRowsUpdated = extractjson(\"$.ROWS_UPDATED\", JsonString),\n    QueryRowsDeleted = extractjson(\"$.ROWS_DELETED\", JsonString),\n    QueryRowsUnloaded = extractjson(\"$.ROWS_UNLOADED\", JsonString),\n    QueryBytesDeleted = extractjson(\"$.BYTES_DELETED\", JsonString),\n    QueryQueuedProvisioningTime = extractjson(\"$.PROVISIONING_TIME\", JsonString),\n    QueryQueuedRepairTime = extractjson(\"$.QUEUED_REPAIR_TIME\", JsonString),\n    QueryQueuedOverloadTime = extractjson(\"$.QUEUED_OVERLOAD_TIME\", JsonString),\n    QueryTransactionBlockedTime = extractjson(\"$.TRANSACTION_BLOCKED_TIME\", JsonString),\n    QueryOutboundDataTransferCloud = extractjson(\"$.OUTBOUND_DATA_TRANSFER_CLOUD\", JsonString),\n    QueryOutboundDataTransferRegion = extractjson(\"$.OUTBOUND_DATA_TRANSFER_REGION\", JsonString),\n    QueryOutboundDataTransferBytes = extractjson(\"$.OUTBOUND_DATA_TRANSFER_BYTES\", JsonString),\n    QueryInboundDataTransferCloud = extractjson(\"$.INBOUND_DATA_TRANSFER_CLOUD\", JsonString),\n    QueryInboundDataTransferRegion = extractjson(\"$.INBOUND_DATA_TRANSFER_REGION\", JsonString),\n    QueryInboundDataTransferBytes = extractjson(\"$.INBOUND_DATA_TRANSFER_BYTES\", JsonString),\n    QueryPartitionsScanned = extractjson(\"$.PARTITIONS_SCANNED\", JsonString),\n    QueryPartitionsTotal = extractjson(\"$.PARTITIONS_TOTAL\", JsonString),\n    QueryBytesSpilledToLocalStorage = extractjson(\"$.BYTES_SPILLED_TO_LOCAL_STORAGE\", JsonString),\n    QueryBytesSpilledToRemoteStorage = extractjson(\"$.BYTES_SPILLED_TO_REMOTE_STORAGE\", JsonString),\n    QueryBytesSentOverTheNetwork = extractjson(\"$.BYTES_SENT_OVER_THE_NETWORK\", JsonString),\n    QueryCompilationTime = extractjson(\"$.COMPILATION_TIME\", JsonString),\n    QueryExecutionStatus = extractjson(\"$.EXECUTION_STATUS\", JsonString),\n    QueryErrorCode = extractjson(\"$.ERROR_CODE\", JsonString),\n    QueryErrorMessage = extractjson(\"$.ERROR_MESSAGE\", JsonString),\n    QueryListExternalFilesTime = extractjson(\"$.LIST_EXTERNAL_FILES_TIME\", JsonString),\n    QueryCreditsUsedCloudServices = extractjson(\"$.CREDITS_USED_CLOUD_SERVICES\", JsonString),\n    QueryReleaseVersion = extractjson(\"$.RELEASE_VERSION\", JsonString),\n    QueryExternalFunctionTotalInvocations = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_INVOCATIONS\", JsonString),\n    QueryExternalFunctionTotalSentRows = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_SENT_ROWS\", JsonString),\n    QueryExternalFunctionTotalReceivedRows = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS\", JsonString),\n    QueryExternalFunctionTotalSentBytes = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_SENT_BYTES\", JsonString),\n    QueryExternalFunctionTotalReceivedBytes = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES\", JsonString),\n    QueryIsClientGeneratedStatement = extractjson(\"$.IS_CLIENT_GENERATED_STATEMENT\", JsonString),\n    QueryAccelerationBytesScanned = extractjson(\"$.ACCELERATION_BYTES_SCANNED\", JsonString),\n    QueryAccelerationPartitionsScanned = extractjson(\"$.ACCELERATION_PARTITIONS_SCANNED\", JsonString),\n    QueryAccelerationUpperLimitScaleFactor = extractjson(\"$.ACCELERATION_UPPER_LIMIT_SCALE_FACTOR\", JsonString),\n    QueryTransactionId = extractjson(\"$.TRANSACTION_ID\", JsonString),\n    QueryLoadPercent = extractjson(\"$.QUERY_LOAD_PERCENT\", JsonString),\n    ChildQueriesWaitTime = extractjson(\"$.CHILD_QUERIES_WAIT_TIME\", JsonString),\n    QueryRoleType = extractjson(\"$.ROLE_TYPE\", JsonString),\n    QueryHash = extractjson(\"$.HASH\", JsonString),\n    QueryHashVersion = extractjson(\"$.HASH_VERSION\", JsonString),\n    QueryParameterizedHash = extractjson(\"$.PARAMETERIZED_HASH\", JsonString),\n    QueryParameterizedHashVersion = extractjson(\"$.PARAMETERIZED_HASH_VERSION\", JsonString),\n    QuerySecondaryRoleStats = extractjson(\"$.SECONDARY_ROLE_STATS\", JsonString),\n    QueryRowsWrittenToResult = extractjson(\"$.ROWS_WRITTEN_TO_RESULT\", JsonString),\n    QueryRetryTime = extractjson(\"$.RETRY_TIME\", JsonString),\n    QueryRetryCause = extractjson(\"$.RETRY_CAUSE\", JsonString),\n    QueryFaultHandlingTime = extractjson(\"$.FAULT_HANDLING_TIME\", JsonString),\n    QueryUserType = extractjson(\"$.USER_TYPE\", JsonString),\n    QueryUserDatabaseName = extractjson(\"$.USER_DATABASE_NAME\", JsonString),\n    QueryUserDatabaseId = extractjson(\"$.USER_DATABASE_ID\", JsonString),\n    QueryUserSchemaId = extractjson(\"$.USER_SCHEMA_ID\", JsonString),\n    QueryUserSchemaName = extractjson(\"$.USER_SCHEMA_NAME\", JsonString)\n};\nunion isfuzzy=true\n    (SnowflakeLogin_view),\n    (SnowflakeUserGrant_view),\n    (SnowflakeMaterializedView_view),\n    (SnowflakeRoles_view),\n    (SnowflakeRoleGrant_view),\n    (SnowflakeLoad_view),\n    (SnowflakeTableStorageMetrics_view),\n    (SnowflakeTables_view),\n    (SnowflakeUsers_view),\n    (SnowflakeQuery_view)\n| extend DatabaseName = coalesce(QueryDatabaseName, UserDatabaseName, RoleDatabaseName, MaterializedViewDatabaseName)\n| extend TableNames = coalesce(TableName, MaterializedViewTableName, LoadTableName, TableStorageMetricsTableName)\n| extend EventStartTime = column_ifexists('EventStartTime', '')\n| project\n    EventVendor, \n    EventProduct,\n    EventType, \n    EventStartTime,\n    LoginEventType,\n    TargetUsername,\n    SrcDvcIpAddr,\n    User,\n    LoginEventEndTime,\n    LoginEventId,\n    LoginReportedClientType,\n    LoginReportedClientVersion,\n    LoginFirstAuthenticationFactor,\n    LoginSecondAuthenticationFactor,\n    LoginIsSuccess,\n    LoginErrorCode,\n    LoginErrorMessage,\n    LoginRelatedEventId,\n    LoginConnection,\n    LoginClientPrivateLinkId,\n    UserGrantCreatedOn,\n    UserGrantDeletedOn,\n    UserRole,\n    UserGrantGrantedTo,\n    UserGrantGranteeName,\n    UserGrantGrantedBy,\n    MaterializedViewStartTime,\n    MaterializedViewEndTime,\n    MaterializedViewCreditsUsed,\n    MaterializedViewTableId,\n    MaterializedViewTableName,\n    MaterializedViewSchemaId,\n    MaterializedViewSchemaName,\n    MaterializedViewDatabaseId,\n    MaterializedViewDatabaseName,\n    RoleId,\n    RoleCreatedOn,\n    RoleDeletedOn,\n    RoleName,\n    RoleComment,\n    RoleOwner,\n    RoleType,\n    RoleDatabaseName,\n    RoleInstanceId,\n    OwnerRoleType,\n    RoleGrantCreatedOn,\n    RoleGrantModifiedOn,\n    RoleGrantPrivilege,\n    RoleGrantGrantedOn,\n    RoleGrantName,\n    RoleGrantTableCatalog,\n    RoleGrantTableSchema,\n    RoleGrantGrantedTo,\n    RoleGrantGranteeName,\n    RoleGrantGrantOption,\n    RoleGrantGrantedBy,\n    RoleGrantDeletedOn,\n    RoleGrantGrantedByRoleType,\n    RoleGrantObjectInstance,\n    LoadTableId,\n    LoadTableName,\n    LoadSchemaId,\n    LoadSchemaName,\n    LoadCatalogId,\n    LoadCatalogName,\n    LoadFileName,\n    LastLoadTime,\n    LoadStatus,\n    LoadRowCount,\n    LoadRowParsed,\n    LoadFirstErrorMessage,\n    LoadFirstErrorLineNumber,\n    LoadFirstErrorCharacterPosition,\n    LoadFirstErrorColName,\n    LoadErrorCount,\n    LoadErrorLimit,\n    TableStorageMetricsId,\n    TableStorageMetricsTableName,\n    TableStorageMetricsTableSchemaId,\n    TableStorageMetricsTableSchema,\n    TableStorageMetricsTableCatalogId,\n    TableStorageMetricsTableCatalog,\n    TableStorageMetricsCloneGroupId,\n    TableStorageMetricsIsTransient,\n    TableStorageMetricsActiveBytes,\n    TableStorageMetricsTimeTravelBytes,\n    TableStorageMetricsFailsafeBytes,\n    TableStorageMetricsRetainedForCloneBytes,\n    TableStorageMetricsDeleted,\n    TableStorageMetricsTableCreated,\n    TableStorageMetricsTableDropped,\n    TableStorageMetricsTableEnteredFailsafe,\n    TableStorageMetricsSchemaCreated,\n    TableStorageMetricsSchemaDropped,\n    TableStorageMetricsCatalogCreated,\n    TableStorageMetricsCatalogDropped,\n    TableStorageMetricsComment,\n    TableStorageMetricsInstanceId,\n    TableId,\n    TableName,\n    TableNames,\n    TableSchemaId,\n    TableSchema,\n    TableCatalogId,\n    TableCatalog,\n    TableOwner,\n    TableType,\n    TableIsTransient,\n    TableIsIceberg,\n    TableIsDynamic,\n    TableIsHybrid,\n    TableClusteringKey,\n    TableRowCount,\n    TableBytes,\n    TableRetentionTime,\n    TableSelfReferencingColumnName,\n    TableReferenceGeneration,\n    TableUserDefinedTypeCatalog,\n    TableUserDefinedTypeSchema,\n    TableUserDefinedTypeName,\n    TableIsInsertableInto,\n    TableIsTyped,\n    TableCommitAction,\n    TableCreated,\n    TableLastAltered,\n    TableLastDDL,\n    TableLastDDLBy,\n    TableDeleted,\n    TableAutoClusteringOn,\n    TableComment,\n    TableOwnerRoleType,\n    TableInstanceId,\n    UserId,\n    UserName,\n    UserCreatedOn,\n    UserDeletedOn,\n    UserLoginName,\n    UserDisplayName,\n    UserFirstName,\n    UserLastName,\n    UserEmail,\n    UserMustChangePassword,\n    UserHasPassword,\n    UserComment,\n    UserDisabled,\n    UserSnowflakeLock,\n    UserDefaultWarehouse,\n    UserDefaultNamespace,\n    UserDefaultRole,\n    UserExtAuthnDuo,\n    UserExtAuthnUid,\n    UserHasMFA,\n    UserBypassMFAUntil,\n    UserLastSuccessLogin,\n    UserExpiresAt,\n    UserLockedUntilTime,\n    UserHasRSAPublicKey,\n    UserPasswordLastSetTime,\n    UserOwner,\n    UserDefaultSecondaryRole,\n    UserType,\n    UserDatabaseName,\n    UserDatabaseId,\n    UserSchemaName,\n    UserSchemaId,\n    QueryId,\n    QueryText,\n    QueryDatabaseId,\n    QueryDatabaseName,\n    QuerySchemaId,\n    QuerySchemaName,\n    QueryType,\n    QuerySessionId,\n    QueryUserName,\n    QueryRoleName,\n    QueryWarehouseId,\n    QueryWarehouseName,\n    QueryWarehouseSize,\n    QueryWarehouseType,\n    QueryClusterNumber,\n    QueryTag,\n    QueryExecutionStatus,\n    QueryErrorCode,\n    QueryErrorMessage,\n    QueryStartTime,\n    QueryTotalElapsedTime,\n    QueryBytesScanned,\n    QueryPercentageScannedFromCache,\n    QueryBytesWritten,\n    QueryBytesWrittenToResult,\n    QueryBytesReadFromResult,\n    QueryRowsProduced,\n    QueryRowsInserted,\n    QueryRowsUpdated,\n    QueryRowsDeleted,\n    QueryRowsUnloaded,\n    QueryBytesDeleted,\n    QueryPartitionsScanned,\n    QueryPartitionsTotal,\n    QueryBytesSpilledToLocalStorage,\n    QueryBytesSpilledToRemoteStorage,\n    QueryBytesSentOverTheNetwork,\n    QueryCompilationTime,\n    QueryExecutionTime,\n    QueryQueuedProvisioningTime,\n    QueryQueuedRepairTime,\n    QueryQueuedOverloadTime,\n    QueryTransactionBlockedTime,\n    QueryOutboundDataTransferCloud,\n    QueryOutboundDataTransferRegion,\n    QueryOutboundDataTransferBytes,\n    QueryInboundDataTransferCloud,\n    QueryInboundDataTransferRegion,\n    QueryInboundDataTransferBytes,\n    QueryListExternalFilesTime,\n    QueryCreditsUsedCloudServices,\n    QueryReleaseVersion,\n    QueryExternalFunctionTotalInvocations,\n    QueryExternalFunctionTotalSentRows,\n    QueryExternalFunctionTotalReceivedRows,\n    QueryExternalFunctionTotalSentBytes,\n    QueryExternalFunctionTotalReceivedBytes,\n    QueryLoadPercent,\n    QueryIsClientGeneratedStatement,\n    QueryAccelerationBytesScanned,\n    QueryAccelerationPartitionsScanned,\n    QueryAccelerationUpperLimitScaleFactor,\n    QueryTransactionId,\n    ChildQueriesWaitTime,\n    QueryRoleType,\n    QueryHash,\n    QueryHashVersion,\n    QueryParameterizedHash,\n    QueryParameterizedHashVersion,\n    QuerySecondaryRoleStats,\n    QueryRowsWrittenToResult,\n    QueryRetryTime,\n    QueryRetryCause,\n    QueryFaultHandlingTime,\n    QueryUserType,\n    QueryUserDatabaseName,\n    QueryUserDatabaseId,\n    QueryUserSchemaName,\n    QueryUserSchemaId,\n    DatabaseName,\n    TimeGenerated\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'Snowflake')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "Snowflake",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Snowflake Workbook with template version 3.0.7",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Sets the time name for analysis"
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"**NOTE**: This data connector depends on a parser based on Kusto Function **Snowflake** to work as expected. [Follow steps to get this Kusto Function](https://aka.ms/sentinel-SnowflakeDataConnector-parser)\"},\"name\":\"text - 8\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"cd8447d9-b096-4673-92d8-2a1e8291a125\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"description\":\"Sets the time name for analysis\",\"value\":{\"durationMs\":7776000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\r\\n| make-series TotalEvents = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain};\",\"size\":0,\"title\":\"Events Over Time\",\"color\":\"green\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"graphSettings\":{\"type\":0}},\"customWidth\":\"60\",\"name\":\"query - 12\",\"styleSettings\":{\"maxWidth\":\"55\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n| where isnotempty(DatabaseName)\\n| summarize dcount(DatabaseName)\",\"size\":3,\"title\":\"Total Databases\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"customWidth\":\"50\",\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n| where isnotempty(TableNames)\\n| summarize dcount(TableNames)\",\"size\":3,\"title\":\"Total Tables\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"customWidth\":\"50\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n| summarize s=sum(QueryExecutionTime)\\n| project s_time = strcat(s/1000, ' sec')\",\"size\":3,\"title\":\"Total Query Time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"customWidth\":\"30\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n| where isnotempty(QueryType)\\n| summarize count()\",\"size\":3,\"title\":\"Total Queries Run\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"customWidth\":\"30\",\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n| summarize cs = sum(QueryCreditsUsedCloudServices)\\n| project round(cs, 8)\",\"size\":3,\"title\":\"Credits Spent\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"customWidth\":\"40\",\"name\":\"query - 4\"}]},\"customWidth\":\"40\",\"name\":\"group - 0\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n| where isnotempty(TableNames)\\n| summarize count() by TableNames\",\"size\":3,\"title\":\"Table Events Summary\",\"color\":\"orange\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"TableNames\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"query - 0\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n| where isnotempty(DatabaseName)\\n| summarize count() by DatabaseName\",\"size\":3,\"title\":\"Database Events Summary\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DatabaseName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"query - 1\",\"styleSettings\":{\"showBorder\":true}}]},\"customWidth\":\"30\",\"name\":\"group - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n| where isnotempty(SrcDvcIpAddr)\\n| summarize count() by SrcDvcIpAddr\",\"size\":3,\"title\":\"Source Addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"30\",\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n| where QueryExecutionTime > 0\\n| top 10 by QueryExecutionTime desc\\n| project Query=QueryText, User=TargetUsername, ExecutionTime=QueryExecutionTime\\n\",\"size\":0,\"title\":\"Query Execution Time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ExecutionTime\",\"formatter\":8,\"formatOptions\":{\"palette\":\"coldHot\"}}]}},\"customWidth\":\"35\",\"name\":\"query - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n| where QueryCreditsUsedCloudServices > 0\\n| summarize by QueryText, QueryCreditsUsedCloudServices\\n| top 10 by QueryCreditsUsedCloudServices desc\\n| project Query=QueryText, CreditsSpent=QueryCreditsUsedCloudServices\",\"size\":0,\"title\":\"Credits Spent by Queries\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CreditsSpent\",\"formatter\":8,\"formatOptions\":{\"palette\":\"coldHot\",\"compositeBarSettings\":{\"labelText\":\"\"}},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":10}}}]}},\"customWidth\":\"35\",\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\r\\n| where QueryType == 'CREATE_USER'\\r\\n| extend n_usr = extract(@'USER\\\\s(\\\\S+)', 1, QueryText)\\r\\n| project Username=n_usr\",\"size\":0,\"title\":\"New Users\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"URL Category\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"purple\"}},\"showBorder\":false},\"textSettings\":{\"style\":\"bignumber\"}},\"customWidth\":\"20\",\"name\":\"query - 0\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Snowflake\\n\\n| where QueryType =~ 'SELECT'\\n| summarize roles = makeset(RoleName) by TargetUsername\\n| join(Snowflake\\n        | where EventType =~ 'LOGIN') on TargetUsername\\n| project EventTime=TimeGenerated, TargetUsername, SourceAddress=SrcDvcIpAddr, Status=strcat(iif(LoginIsSuccess =~ 'No', ' - Login Failure' , ' - Logged in'))\",\"size\":0,\"title\":\"Privileged Sessions\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"User\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"TotalMailsReceived\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":10,\"formatOptions\":{\"palette\":\"magenta\"}},\"showBorder\":false}},\"customWidth\":\"45\",\"name\":\"query - 10\"}],\"fromTemplateId\":\"sentinel-SnowflakeWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=SnowflakeWorkbook; logoFileName=Azure_Sentinel.svg; description=Sets the time name for analysis; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.1; title=Snowflake; templateRelativePath=Snowflake.json; subtitle=; provider=Snowflake}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Snowflake",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "Snowflake",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SnowflakeDataConnector",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.7",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Snowflake",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Snowflake/ReleaseNotes.md\">Release Notes</a></p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The Snowflake CCF data connector provides the capability to ingest Snowflake <a href=\"https://docs.snowflake.com/en/sql-reference/account-usage/login_history\">Login History Logs</a>, <a href=\"https://docs.snowflake.com/en/sql-reference/account-usage/query_history\">Query History Logs</a>, <a href=\"https://docs.snowflake.com/en/sql-reference/account-usage/grants_to_users\">User-Grant Logs</a>, <a href=\"https://docs.snowflake.com/en/sql-reference/account-usage/grants_to_roles\">Role-Grant Logs</a>, <a href=\"https://docs.snowflake.com/en/sql-reference/account-usage/load_history\">Load History Logs</a>, <a href=\"https://docs.snowflake.com/en/sql-reference/account-usage/materialized_view_refresh_history\">Materialized View Refresh History Logs</a>, <a href=\"https://docs.snowflake.com/en/sql-reference/account-usage/roles\">Roles Logs</a>, <a href=\"https://docs.snowflake.com/en/sql-reference/account-usage/tables\">Tables Logs</a>, <a href=\"https://docs.snowflake.com/en/sql-reference/account-usage/table_storage_metrics\">Table Storage Metrics Logs</a>, <a href=\"https://docs.snowflake.com/en/sql-reference/account-usage/users\">Users Logs</a> into Microsoft Sentinel using the Snowflake SQL API. Refer to <a href=\"https://docs.snowflake.com/en/developer-guide/sql-api/reference\">Snowflake SQL API documentation</a> for more information.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<p> <a href=\"https://aka.ms/Sentinel-CCP_Platform\">Microsoft Sentinel Codeless Connector Framework</a></p>\n<p><strong>Data Connectors:</strong> 1, <strong>Parsers:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 10, <strong>Hunting Queries:</strong> 10</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Azure_Sentinel.svg\"width=\"75px\"height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Snowflake",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
              "version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
              "version": "[variables('huntingQueryObject2').huntingQueryVersion2]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
              "version": "[variables('huntingQueryObject3').huntingQueryVersion3]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
              "version": "[variables('huntingQueryObject4').huntingQueryVersion4]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
              "version": "[variables('huntingQueryObject5').huntingQueryVersion5]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
              "version": "[variables('huntingQueryObject6').huntingQueryVersion6]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
              "version": "[variables('huntingQueryObject7').huntingQueryVersion7]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
              "version": "[variables('huntingQueryObject8').huntingQueryVersion8]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
              "version": "[variables('huntingQueryObject9').huntingQueryVersion9]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
              "version": "[variables('huntingQueryObject10').huntingQueryVersion10]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            }
          ]
        },
        "firstPublishDate": "2021-10-23",
        "providers": [
          "Snowflake"
        ],
        "categories": {
          "domains": [
            "Application"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
