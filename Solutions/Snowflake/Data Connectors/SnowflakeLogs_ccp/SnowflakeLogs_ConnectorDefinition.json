{
  "name": "SnowflakeLogsCCPDefinition",
  "apiVersion": "2025-03-01",
  "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
  "location": "{{location}}",
  "kind": "Customizable",
  "properties": {
    "connectorUiConfig": {
      "id": "SnowflakeLogsCCPDefinition",
      "title": "Snowflake (via Codeless Connector Framework)",
      "publisher": "Microsoft",
      "descriptionMarkdown": "The Snowflake data connector provides the capability to ingest Snowflake [Login History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/login_history), [Query History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/query_history), [User-Grant Logs](https://docs.snowflake.com/en/sql-reference/account-usage/grants_to_users), [Role-Grant Logs](https://docs.snowflake.com/en/sql-reference/account-usage/grants_to_roles), [Load History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/load_history), [Materialized View Refresh History Logs](https://docs.snowflake.com/en/sql-reference/account-usage/materialized_view_refresh_history), [Roles Logs](https://docs.snowflake.com/en/sql-reference/account-usage/roles), [Tables Logs](https://docs.snowflake.com/en/sql-reference/account-usage/tables), [Table Storage Metrics Logs](https://docs.snowflake.com/en/sql-reference/account-usage/table_storage_metrics), [Users Logs](https://docs.snowflake.com/en/sql-reference/account-usage/users) into Microsoft Sentinel using the Snowflake SQL API. Refer to [Snowflake SQL API documentation](https://docs.snowflake.com/en/developer-guide/sql-api/reference) for more information.",
      "graphQueries": [
        {
          "metricName": "Total Login events received",
          "legend": "Snowflake Login History Logs",
          "baseQuery": "SnowflakeLogin_CL"
        },
        {
          "metricName": "Total Query events received",
          "legend": "Snowflake Query History Logs",
          "baseQuery": "SnowflakeQuery_CL"
        },
        {
          "metricName": "Total Grants to User events received",
          "legend": "Snowflake User Grant Logs",
          "baseQuery": "SnowflakeUserGrant_CL"
        },
        {
          "metricName": "Total Grants to Role events received",
          "legend": "Snowflake Role Grant Logs",
          "baseQuery": "SnowflakeRoleGrant_CL"
        },
        {
          "metricName": "Total Load History events received",
          "legend": "Snowflake Load History Logs",
          "baseQuery": "SnowflakeLoad_CL"
        },
        {
          "metricName": "Total Materialized View Refresh History events received",
          "legend": "Snowflake Materialized View Refresh History Logs",
          "baseQuery": "SnowflakeMaterializedView_CL"
        },
        {
          "metricName": "Total Role Events received",
          "legend": "Snowflake Roles Logs",
          "baseQuery": "SnowflakeRoles_CL"
        },
        {
          "metricName": "Total Table Events received",
          "legend": "Snowflake Tables Logs",
          "baseQuery": "SnowflakeTables_CL"
        },
        {
          "metricName": "Total Table Storage Metrics Events received",
          "legend": "Snowflake Table Storage Metrics Logs",
          "baseQuery": "SnowflakeTableStorageMetrics_CL"
        },
        {
          "metricName": "Total Users Events received",
          "legend": "Snowflake Users Logs",
          "baseQuery": "SnowflakeUsers_CL"
        }
      ],
      "sampleQueries": [
        {
          "description": "Get Sample Login Events of Snowflake",
          "query": "SnowflakeLogin_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend Time = toreal(extractjson(\"$.EVENT_TIMESTAMP\", JsonString))\r\n| extend\r\n    SrcDvcIpAddr = extractjson(\"$.CLIENT_IP\", JsonString),\r\n    LoginClientPrivateLinkId = extractjson(\"$.CLIENT_PRIVATE_LINK_ID\", JsonString),\r\n    LoginConnection = extractjson(\"$.CONNECTION\", JsonString),\r\n    LoginErrorCode = extractjson(\"$.ERROR_CODE\", JsonString),\r\n    LoginErrorMessage = extractjson(\"$.ERROR_MESSAGE\", JsonString),\r\n    LoginEventId = extractjson(\"$.EVENT_ID\", JsonString),\r\n    LoginEventEndTime = unixtime_seconds_todatetime(Time),\r\n    LoginEventType = extractjson(\"$.EVENT_TYPE\", JsonString),\r\n    LoginFirstAuthenticationFactor = extractjson(\"$.FIRST_AUTHENTICATION_FACTOR\", JsonString),\r\n    LoginIsSuccess = extractjson(\"$.IS_SUCCESS\", JsonString),\r\n    LoginRelatedEventId = extractjson(\"$.RELATED_EVENT_ID\", JsonString),\r\n    LoginReportedClientType = extractjson(\"$.REPORTED_CLIENT_TYPE\", JsonString),\r\n    LoginReportedClientVersion = extractjson(\"$.REPORTED_CLIENT_VERSION\", JsonString),\r\n    LoginSecondAuthenticationFactor = extractjson(\"$.SECOND_AUTHENTICATION_FACTOR\", JsonString),\r\n    TargetUsername = extractjson(\"$.USER_NAME\", JsonString)\r\n| extend User = TargetUsername\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
        },
        {
          "description": "Get Sample Query Events of Snowflake",
          "query": "SnowflakeQuery_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    QueryStartTime = unixtime_seconds_todatetime(toreal(extractjson(\"$.START_TIME\", JsonString))),\r\n    QueryEndTime = unixtime_seconds_todatetime(toreal(extractjson(\"$.END_TIME\", JsonString))),\r\n    QueryTotalElapsedTime = toreal(extractjson(\"$.TOTAL_ELAPSED_TIME\", JsonString)),\r\n    QueryExecutionTime = toreal(extractjson(\"$.EXECUTION_TIME\", JsonString))\r\n| extend\r\n    QueryId = extractjson(\"$.QUERY_ID\", JsonString),\r\n    QueryText = extractjson(\"$.QUERY_TEXT\", JsonString),\r\n    QueryDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\r\n    QueryDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString),\r\n    QuerySchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\r\n    QuerySchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    QueryType = extractjson(\"$.QUERY_TYPE\", JsonString),\r\n    QuerySessionId = extractjson(\"$.SESSION_ID\", JsonString),\r\n    QueryUserName = extractjson(\"$.USER_NAME\", JsonString),\r\n    QueryRoleName = extractjson(\"$.ROLE_NAME\", JsonString),\r\n    QueryWarehouseId = extractjson(\"$.WAREHOUSE_ID\", JsonString),\r\n    QueryWarehouseName = extractjson(\"$.WAREHOUSE_NAME\", JsonString),\r\n    QueryWarehouseSize = extractjson(\"$.WAREHOUSE_SIZE\", JsonString),\r\n    QueryWarehouseType = extractjson(\"$.WAREHOUSE_TYPE\", JsonString),\r\n    QueryClusterNumber = extractjson(\"$.CLUSTER_NUMBER\", JsonString),\r\n    QueryTag = extractjson(\"$.TAG\", JsonString),\r\n    QueryBytesScanned = extractjson(\"$.BYTES_SCANNED\", JsonString),\r\n    QueryPercentageScannedFromCache = extractjson(\"$.PERCENTAGE_SCANNED_FROM_CACHE\", JsonString),\r\n    QueryBytesWritten = extractjson(\"$.BYTES_WRITTEN\", JsonString),\r\n    QueryBytesWrittenToResult = extractjson(\"$.BYTES_WRITTEN_TO_RESULT\", JsonString),\r\n    QueryBytesReadFromResult = extractjson(\"$.BYTES_READ_FROM_RESULT\", JsonString),\r\n    QueryRowsProduced = extractjson(\"$.ROWS_PRODUCED\", JsonString),\r\n    QueryRowsInserted = extractjson(\"$.ROWS_INSERTED\", JsonString),\r\n    QueryRowsUpdated = extractjson(\"$.ROWS_UPDATED\", JsonString),\r\n    QueryRowsDeleted = extractjson(\"$.ROWS_DELETED\", JsonString),\r\n    QueryRowsUnloaded = extractjson(\"$.ROWS_UNLOADED\", JsonString),\r\n    QueryBytesDeleted = extractjson(\"$.BYTES_DELETED\", JsonString),\r\n    QueryQueuedProvisioningTime = extractjson(\"$.PROVISIONING_TIME\", JsonString),\r\n    QueryQueuedRepairTime = extractjson(\"$.QUEUED_REPAIR_TIME\", JsonString),\r\n    QueryQueuedOverloadTime = extractjson(\"$.QUEUED_OVERLOAD_TIME\", JsonString),\r\n    QueryTransactionBlockedTime = extractjson(\"$.TRANSACTION_BLOCKED_TIME\", JsonString),\r\n    QueryOutboundDataTransferCloud = extractjson(\"$.OUTBOUND_DATA_TRANSFER_CLOUD\", JsonString),\r\n    QueryOutboundDataTransferRegion = extractjson(\"$.OUTBOUND_DATA_TRANSFER_REGION\", JsonString),\r\n    QueryOutboundDataTransferBytes = extractjson(\"$.OUTBOUND_DATA_TRANSFER_BYTES\", JsonString),\r\n    QueryInboundDataTransferCloud = extractjson(\"$.INBOUND_DATA_TRANSFER_CLOUD\", JsonString),\r\n    QueryInboundDataTransferRegion = extractjson(\"$.INBOUND_DATA_TRANSFER_REGION\", JsonString),\r\n    QueryInboundDataTransferBytes = extractjson(\"$.INBOUND_DATA_TRANSFER_BYTES\", JsonString),\r\n    QueryPartitionsScanned = extractjson(\"$.PARTITIONS_SCANNED\", JsonString),\r\n    QueryPartitionsTotal = extractjson(\"$.PARTITIONS_TOTAL\", JsonString),\r\n    QueryBytesSpilledToLocalStorage = extractjson(\"$.BYTES_SPILLED_TO_LOCAL_STORAGE\", JsonString),\r\n    QueryBytesSpilledToRemoteStorage = extractjson(\"$.BYTES_SPILLED_TO_REMOTE_STORAGE\", JsonString),\r\n    QueryBytesSentOverTheNetwork = extractjson(\"$.BYTES_SENT_OVER_THE_NETWORK\", JsonString),\r\n    QueryCompilationTime = extractjson(\"$.COMPILATION_TIME\", JsonString),\r\n    QueryExecutionStatus = extractjson(\"$.EXECUTION_STATUS\", JsonString),\r\n    QueryErrorCode = extractjson(\"$.ERROR_CODE\", JsonString),\r\n    QueryErrorMessage = extractjson(\"$.ERROR_MESSAGE\", JsonString),\r\n    QueryListExternalFilesTime = extractjson(\"$.LIST_EXTERNAL_FILES_TIME\", JsonString),\r\n    QueryCreditsUsedCloudServices = extractjson(\"$.CREDITS_USED_CLOUD_SERVICES\", JsonString),\r\n    QueryReleaseVersion = extractjson(\"$.RELEASE_VERSION\", JsonString),\r\n    QueryExternalFunctionTotalInvocations = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_INVOCATIONS\", JsonString),\r\n    QueryExternalFunctionTotalSentRows = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_SENT_ROWS\", JsonString),\r\n    QueryExternalFunctionTotalReceivedRows = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS\", JsonString),\r\n    QueryExternalFunctionTotalSentBytes = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_SENT_BYTES\", JsonString),\r\n    QueryExternalFunctionTotalReceivedBytes = extractjson(\"$.EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES\", JsonString),\r\n    QueryIsClientGeneratedStatement = extractjson(\"$.IS_CLIENT_GENERATED_STATEMENT\", JsonString),\r\n    QueryAccelerationBytesScanned = extractjson(\"$.ACCELERATION_BYTES_SCANNED\", JsonString),\r\n    QueryAccelerationPartitionsScanned = extractjson(\"$.ACCELERATION_PARTITIONS_SCANNED\", JsonString),\r\n    QueryAccelerationUpperLimitScaleFactor = extractjson(\"$.ACCELERATION_UPPER_LIMIT_SCALE_FACTOR\", JsonString),\r\n    QueryTransactionId = extractjson(\"$.TRANSACTION_ID\", JsonString),\r\n    QueryLoadPercent = extractjson(\"$.QUERY_LOAD_PERCENT\", JsonString),\r\n    ChildQueriesWaitTime = extractjson(\"$.CHILD_QUERIES_WAIT_TIME\", JsonString),\r\n    QueryRoleType = extractjson(\"$.ROLE_TYPE\", JsonString),\r\n    QueryHash = extractjson(\"$.HASH\", JsonString),\r\n    QueryHashVersion = extractjson(\"$.HASH_VERSION\", JsonString),\r\n    QueryParameterizedHash = extractjson(\"$.PARAMETERIZED_HASH\", JsonString),\r\n    QueryParameterizedHashVersion = extractjson(\"$.PARAMETERIZED_HASH_VERSION\", JsonString),\r\n    QuerySecondaryRoleStats = extractjson(\"$.SECONDARY_ROLE_STATS\", JsonString),\r\n    QueryRowsWrittenToResult = extractjson(\"$.ROWS_WRITTEN_TO_RESULT\", JsonString),\r\n    QueryRetryTime = extractjson(\"$.RETRY_TIME\", JsonString),\r\n    QueryRetryCause = extractjson(\"$.RETRY_CAUSE\", JsonString),\r\n    QueryFaultHandlingTime = extractjson(\"$.FAULT_HANDLING_TIME\", JsonString),\r\n    QueryUserType = extractjson(\"$.USER_TYPE\", JsonString),\r\n    QueryUserDatabaseName = extractjson(\"$.USER_DATABASE_NAME\", JsonString),\r\n    QueryUserDatabaseId = extractjson(\"$.USER_DATABASE_ID\", JsonString),\r\n    QueryUserSchemaId = extractjson(\"$.USER_SCHEMA_ID\", JsonString),\r\n    QueryUserSchemaName = extractjson(\"$.USER_SCHEMA_NAME\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
        },
        {
          "description": "Get Sample User Grant Events of Snowflake",
          "query": "SnowflakeUserGrant_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\r\n| extend\r\n    UserGrantCreatedOn = unixtime_seconds_todatetime(CTime),\r\n    UserGrantDeletedOn = unixtime_seconds_todatetime(DTime),\r\n    UserRole = extractjson(\"$.ROLE\", JsonString),\r\n    UserGrantGrantedTo = extractjson(\"$.GRANTED_TO\", JsonString),\r\n    UserGrantGranteeName = extractjson(\"$.GRANTEE_NAME\", JsonString),\r\n    UserGrantGrantedBy = extractjson(\"$.GRANTED_BY\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
        },
        {
          "description": "Get Sample Role Grant Events of Snowflake",
          "query": "SnowflakeRoleGrant_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend \r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    MTime = toreal(extractjson(\"$.MODIFIED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\r\n| extend\r\n    RoleGrantCreatedOn = unixtime_seconds_todatetime(CTime),\r\n    RoleGrantModifiedOn = unixtime_seconds_todatetime(MTime),\r\n    RoleGrantPrivilege = extractjson(\"$.PRIVILEGE\", JsonString),\r\n    RoleGrantGrantedOn = extractjson(\"$.GRANTED_ON\", JsonString),\r\n    RoleGrantName = extractjson(\"$.NAME\", JsonString),\r\n    RoleGrantTableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\r\n    RoleGrantTableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\r\n    RoleGrantGrantedTo = extractjson(\"$.GRANTED_TO\", JsonString),\r\n    RoleGrantGranteeName = extractjson(\"$.GRANTEE_NAME\", JsonString),\r\n    RoleGrantGrantOption = extractjson(\"$.GRANT_OPTION\", JsonString),\r\n    RoleGrantGrantedBy = extractjson(\"$.GRANTED_BY\", JsonString),\r\n    RoleGrantDeletedOn = unixtime_seconds_todatetime(DTime),\r\n    RoleGrantGrantedByRoleType = extractjson(\"$.GRANTED_BY_ROLE_TYPE\", JsonString),\r\n    RoleGrantObjectInstance = extractjson(\"$.OBJECT_INSTANCE\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
        },
        {
          "description": "Get Sample Load History Events of Snowflake",
          "query": "SnowflakeLoad_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend LTime = toreal(extractjson(\"$.LAST_LOAD_TIME\", JsonString))\r\n| extend\r\n    LoadTableId = extractjson(\"$.TABLE_ID\", JsonString),\r\n    LoadTableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    LoadSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\r\n    LoadSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    LoadCatalogId = extractjson(\"$.CATALOG_ID\", JsonString),\r\n    LoadCatalogName = extractjson(\"$.CATALOG_NAME\", JsonString),\r\n    LoadFileName = extractjson(\"$.FILE_NAME\", JsonString),\r\n    LastLoadTime = unixtime_seconds_todatetime(LTime),\r\n    LoadStatus = extractjson(\"$.STATUS\", JsonString),\r\n    LoadRowCount = extractjson(\"$.ROW_COUNT\", JsonString),\r\n    LoadRowParsed = extractjson(\"$.ROW_PARSED\", JsonString),\r\n    LoadFirstErrorMessage = extractjson(\"$.FIRST_ERROR_MESSAGE\", JsonString),\r\n    LoadFirstErrorLineNumber = extractjson(\"$.FIRST_ERROR_LINE_NUMBER\", JsonString),\r\n    LoadFirstErrorCharacterPosition = extractjson(\"$.FIRST_ERROR_CHARACTER_POSITION\", JsonString),\r\n    LoadFirstErrorColName = extractjson(\"$.FIRST_ERROR_COL_NAME\", JsonString),\r\n    LoadErrorCount = extractjson(\"$.ERROR_COUNT\", JsonString),\r\n    LoadErrorLimit = extractjson(\"$.ERROR_LIMIT\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
        },
        {
          "description": "Get Sample Materialized View Refresh History Events of Snowflake",
          "query": "SnowflakeMaterializedView_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    STime = toreal(extractjson(\"$.START_TIME\", JsonString)),\r\n    ETime = toreal(extractjson(\"$.END_TIME\", JsonString))\r\n| extend\r\n    MaterializedViewStartTime = unixtime_seconds_todatetime(STime),\r\n    MaterializedViewEndTime = unixtime_seconds_todatetime(ETime),\r\n    MaterializedViewCreditsUsed = extractjson(\"$.CREDITS_USED\", JsonString),\r\n    MaterializedViewTableId = extractjson(\"$.TABLE_ID\", JsonString),\r\n    MaterializedViewTableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    MaterializedViewSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString),\r\n    MaterializedViewSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    MaterializedViewDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\r\n    MaterializedViewDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
        },
        {
          "description": "Get Sample Role Events of Snowflake",
          "query": "SnowflakeRoles_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend \r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString))\r\n| extend\r\n    RoleId = extractjson(\"$.ROLE_ID\", JsonString),\r\n    RoleCreatedOn = unixtime_seconds_todatetime(CTime),\r\n    RoleDeletedOn = unixtime_seconds_todatetime(DTime),\r\n    RoleName = extractjson(\"$.NAME\", JsonString),\r\n    RoleComment = extractjson(\"$.COMMENT\", JsonString),\r\n    RoleOwner = extractjson(\"$.OWNER\", JsonString),\r\n    RoleType = extractjson(\"$.ROLE_TYPE\", JsonString),\r\n    RoleDatabaseName = extractjson(\"$.ROLE_DATABASE_NAME\", JsonString),\r\n    RoleInstanceId = extractjson(\"$.ROLE_INSTANCE_ID\", JsonString),\r\n    OwnerRoleType = extractjson(\"$.OWNER_ROLE_TYPE\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
        },
        {
          "description": "Get Sample Table Events of Snowflake",
          "query": "SnowflakeTables_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    TCTime = toreal(extractjson(\"$.CREATED\", JsonString)),\r\n    LATime = toreal(extractjson(\"$.LAST_ALTERED\", JsonString)),\r\n    LDTime = toreal(extractjson(\"$.LAST_DDL\", JsonString)),\r\n    TDTime = toreal(extractjson(\"$.DELETED\", JsonString))\r\n| extend\r\n    TableId = extractjson(\"$.TABLE_ID\", JsonString),\r\n    TableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    TableSchemaId = extractjson(\"$.TABLE_SCHEMA_ID\", JsonString),\r\n    TableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\r\n    TableCatalogId = extractjson(\"$.TABLE_CATALOG_ID\", JsonString),\r\n    TableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\r\n    TableOwner = extractjson(\"$.TABLE_OWNER\", JsonString),\r\n    TableType = extractjson(\"$.TABLE_TYPE\", JsonString),\r\n    TableIsTransient = extractjson(\"$.IS_TRANSIENT\", JsonString),\r\n    TableIsIceberg = extractjson(\"$.IS_ICEBERG\", JsonString),\r\n    TableIsDynamic = extractjson(\"$.IS_DYNAMIC\", JsonString),\r\n    TableIsHybrid = extractjson(\"$.IS_HYBRID\", JsonString),\r\n    TableClusteringKey = extractjson(\"$.CLUSTERING_KEY\", JsonString),\r\n    TableRowCount = extractjson(\"$.ROW_COUNT\", JsonString),\r\n    TableBytes = extractjson(\"$.BYTES\", JsonString),\r\n    TableRetentionTime = extractjson(\"$.RETENTION_TIME\", JsonString),\r\n    TableSelfReferencingColumnName = extractjson(\"$.SELF_REFERENCING_COLUMN_NAME\", JsonString),\r\n    TableReferenceGeneration = extractjson(\"$.REFERENCE_GENERATION\", JsonString),\r\n    TableUserDefinedTypeCatalog = extractjson(\"$.USER_DEFINED_TYPE_CATALOG\", JsonString),\r\n    TableUserDefinedTypeSchema = extractjson(\"$.USER_DEFINED_TYPE_SCHEMA\", JsonString),\r\n    TableUserDefinedTypeName = extractjson(\"$.USER_DEFINED_TYPE_NAME\", JsonString),\r\n    TableIsInsertableInto = extractjson(\"$.IS_INSERTABLE_INTO\", JsonString),\r\n    TableIsTyped = extractjson(\"$.IS_TYPED\", JsonString),\r\n    TableCommitAction = extractjson(\"$.COMMIT_ACTION\", JsonString),\r\n    TableCreated = unixtime_seconds_todatetime(TCTime),\r\n    TableLastAltered = unixtime_seconds_todatetime(LATime),\r\n    TableLastDDL = unixtime_seconds_todatetime(LDTime),\r\n    TableLastDDLBy = extractjson(\"$.LAST_DDL_BY\", JsonString),\r\n    TableDeleted = unixtime_seconds_todatetime(TDTime),\r\n    TableAutoClusteringOn = extractjson(\"$.AUTO_CLUSTERING_ON\", JsonString),\r\n    TableComment = extractjson(\"$.COMMENT\", JsonString),\r\n    TableOwnerRoleType = extractjson(\"$.OWNER_ROLE_TYPE\", JsonString),\r\n    TableInstanceId = extractjson(\"$.INSTANCE_ID\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
        },
        {
          "description": "Get Sample Table Storage Metrics Events of Snowflake",
          "query": "SnowflakeTableStorageMetrics_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    TCTime = toreal(extractjson(\"$.TABLE_CREATED\", JsonString)),\r\n    TDTime = toreal(extractjson(\"$.TABLE_DROPPED\", JsonString)),\r\n    TFTime = toreal(extractjson(\"$.TABLE_ENTERED_FAILSAFE\", JsonString)),\r\n    SCTime = toreal(extractjson(\"$.SCHEMA_CREATED\", JsonString)),\r\n    SDTime = toreal(extractjson(\"$.SCHEMA_DROPPED\", JsonString)),\r\n    CCTime = toreal(extractjson(\"$.CATALOG_CREATED\", JsonString)),\r\n    CDTime = toreal(extractjson(\"$.CATALOG_DROPPED\", JsonString))\r\n| extend\r\n    TableStorageMetricsId = extractjson(\"$.ID\", JsonString),\r\n    TableStorageMetricsTableName = extractjson(\"$.TABLE_NAME\", JsonString),\r\n    TableStorageMetricsTableSchemaId = extractjson(\"$.TABLE_SCHEMA_ID\", JsonString),\r\n    TableStorageMetricsTableSchema = extractjson(\"$.TABLE_SCHEMA\", JsonString),\r\n    TableStorageMetricsTableCatalogId = extractjson(\"$.TABLE_CATALOG_ID\", JsonString),\r\n    TableStorageMetricsTableCatalog = extractjson(\"$.TABLE_CATALOG\", JsonString),\r\n    TableStorageMetricsCloneGroupId = extractjson(\"$.CLONE_GROUP_ID\", JsonString),\r\n    TableStorageMetricsIsTransient = extractjson(\"$.IS_TRANSIENT\", JsonString),\r\n    TableStorageMetricsActiveBytes = extractjson(\"$.ACTIVE_BYTES\", JsonString),\r\n    TableStorageMetricsTimeTravelBytes = extractjson(\"$.TIME_TRAVEL_BYTES\", JsonString),\r\n    TableStorageMetricsFailsafeBytes = extractjson(\"$.FAILSAFE_BYTES\", JsonString),\r\n    TableStorageMetricsRetainedForCloneBytes = extractjson(\"$.RETAINED_FOR_CLONE_BYTES\", JsonString),\r\n    TableStorageMetricsDeleted = extractjson(\"$.DELETED\", JsonString),\r\n    TableStorageMetricsTableCreated = unixtime_seconds_todatetime(TCTime),\r\n    TableStorageMetricsTableDropped = unixtime_seconds_todatetime(TDTime),\r\n    TableStorageMetricsTableEnteredFailsafe = unixtime_seconds_todatetime(TFTime),\r\n    TableStorageMetricsSchemaCreated = unixtime_seconds_todatetime(SCTime),\r\n    TableStorageMetricsSchemaDropped = unixtime_seconds_todatetime(SDTime),\r\n    TableStorageMetricsCatalogCreated = unixtime_seconds_todatetime(CCTime),\r\n    TableStorageMetricsCatalogDropped = unixtime_seconds_todatetime(CDTime),\r\n    TableStorageMetricsComment = extractjson(\"$.COMMENT\", JsonString),\r\n    TableStorageMetricsInstanceId = extractjson(\"$.INSTANCE_ID\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
        },
        {
          "description": "Get Sample Users of Snowflake",
          "query": "SnowflakeUsers_CL\r\n| mv-expand OuterArray = todynamic(Data)\r\n| mv-expand innerArray = OuterArray\r\n| extend JsonString = tostring(innerArray)\r\n| extend\r\n    CTime = toreal(extractjson(\"$.CREATED_ON\", JsonString)),\r\n    DTime = toreal(extractjson(\"$.DELETED_ON\", JsonString)),\r\n    BMTime = toreal(extractjson(\"$.BYPASS_MFA_UNTIL\", JsonString)),\r\n    LSLTime = toreal(extractjson(\"$.LAST_SUCCESS_LOGIN\", JsonString)),\r\n    ETime = toreal(extractjson(\"$.EXPIRES_AT\", JsonString)),\r\n    LUTime = toreal(extractjson(\"$.LOCKED_UNTIL_TIME\", JsonString)),\r\n    PLSTime = toreal(extractjson(\"$.PASSWORD_LAST_SET_TIME\", JsonString))\r\n| extend\r\n    UserId = extractjson(\"$.USER_ID\", JsonString),\r\n    UserName = extractjson(\"$.NAME\", JsonString),\r\n    UserCreatedOn = extractjson(\"$.CREATED_ON\", JsonString),\r\n    UserDeletedOn = extractjson(\"$.DELETED_ON\", JsonString),\r\n    UserLoginName = extractjson(\"$.LOGIN_NAME\", JsonString),\r\n    UserDisplayName = extractjson(\"$.DISPLAY_NAME\", JsonString),\r\n    UserFirstName = extractjson(\"$.FIRST_NAME\", JsonString),\r\n    UserLastName = extractjson(\"$.LAST_NAME\", JsonString),\r\n    UserEmail = extractjson(\"$.EMAIL\", JsonString),\r\n    UserMustChangePassword = extractjson(\"$.MUST_CHANGE_PASSWORD\", JsonString),\r\n    UserHasPassword = extractjson(\"$.HAS_PASSWORD\", JsonString),\r\n    UserComment = extractjson(\"$.COMMENT\", JsonString),\r\n    UserDisabled = extractjson(\"$.DISABLED\", JsonString),\r\n    UserSnowflakeLock = extractjson(\"$.SNOWFLAKE_LOCK\", JsonString),\r\n    UserDefaultWarehouse = extractjson(\"$.DEFAULT_WAREHOUSE\", JsonString),\r\n    UserDefaultNamespace = extractjson(\"$.DEFAULT_NAMESPACE\", JsonString),\r\n    UserDefaultRole = extractjson(\"$.DEFAULT_ROLE\", JsonString),\r\n    UserExtAuthnDuo = extractjson(\"$.EXT_AUTHN_DUO\", JsonString),\r\n    UserExtAuthnUid = extractjson(\"$.EXT_AUTHN_UID\", JsonString),\r\n    UserHasMFA = extractjson(\"$.HAS_MFA\", JsonString),\r\n    UserBypassMFAUntil = unixtime_seconds_todatetime(BMTime),\r\n    UserLastSuccessLogin = unixtime_seconds_todatetime(LSLTime),\r\n    UserExpiresAt = unixtime_seconds_todatetime(ETime),\r\n    UserLockedUntilTime = unixtime_seconds_todatetime(LUTime),\r\n    UserHasRSAPublicKey = extractjson(\"$.HAS_RSA_PUBLIC_KEY\", JsonString),\r\n    UserPasswordLastSetTime = unixtime_seconds_todatetime(PLSTime),\r\n    UserOwner = extractjson(\"$.OWNER\", JsonString),\r\n    UserDefaultSecondaryRole = extractjson(\"$.DEFAULT_SECONDARY_ROLE\", JsonString),\r\n    UserType = extractjson(\"$.TYPE\", JsonString),\r\n    UserDatabaseName = extractjson(\"$.DATABASE_NAME\", JsonString),\r\n    UserDatabaseId = extractjson(\"$.DATABASE_ID\", JsonString),\r\n    UserSchemaName = extractjson(\"$.SCHEMA_NAME\", JsonString),\r\n    UserSchemaId = extractjson(\"$.SCHEMA_ID\", JsonString)\r\n| project-away Data, OuterArray, innerArray, JsonString\r\n| take 10"
        }
      ],
      "dataTypes": [
        {
          "name": "SnowflakeLoad_CL",
          "lastDataReceivedQuery": "SnowflakeLoad_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        },
        {
          "name": "SnowflakeLogin_CL",
          "lastDataReceivedQuery": "SnowflakeLogin_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        },
        {
          "name": "SnowflakeMaterializedView_CL",
          "lastDataReceivedQuery": "SnowflakeMaterializedView_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        },
        {
          "name": "SnowflakeQuery_CL",
          "lastDataReceivedQuery": "SnowflakeQuery_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        },
        {
          "name": "SnowflakeRoleGrant_CL",
          "lastDataReceivedQuery": "SnowflakeRoleGrant_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        },
        {
          "name": "SnowflakeRoles_CL",
          "lastDataReceivedQuery": "SnowflakeRoles_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        },
        {
          "name": "SnowflakeTables_CL",
          "lastDataReceivedQuery": "SnowflakeTables_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        },
        {
          "name": "SnowflakeTableStorageMetrics_CL",
          "lastDataReceivedQuery": "SnowflakeTableStorageMetrics_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        },
        {
          "name": "SnowflakeUserGrant_CL",
          "lastDataReceivedQuery": "SnowflakeUserGrant_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        },
        {
          "name": "SnowflakeUsers_CL",
          "lastDataReceivedQuery": "SnowflakeUsers_CL\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
        }
      ],
      "connectivityCriteria": [
        {
          "type": "HasDataConnectors"
        }
      ],
      "availability": {
        "isPreview": false,
        "status": 1
      },
      "permissions": {
        "resourceProvider": [
          {
            "provider": "Microsoft.OperationalInsights/workspaces",
            "permissionsDisplayText": "Read and Write permissions are required.",
            "providerDisplayName": "Workspace",
            "scope": "Workspace",
            "requiredPermissions": {
              "write": true,
              "read": true,
              "delete": true,
              "action": false
            }
          }
        ]
      },
      "instructionSteps": [
        {
          "title": "Connect Snowflake to Microsoft Sentinel",
          "instructions": [
            {
              "type": "Markdown",
              "parameters": {
                "content": ">**NOTE:** To ensure data is presented in separate columns for each field, execute the parser using the **Snowflake()** function"
              }
            },
            {
              "type": "Markdown",
              "parameters": {
                "content": "To gather data from Snowflake, you need to provide the following resources"
              }
            },
            {
              "type": "Markdown",
              "parameters": {
                "content": "#### 1. Account Identifier \n To gather data from Snowflake, you'll need Snowflake Account Identifier."
              }
            },
            {
              "type": "Markdown",
              "parameters": {
                "content": "#### 2. Programmatic Access Token \n To gather data from Snowflake, you'll need the Snowflake Programmatic Access Token"
              }
            },
            {
              "type": "Markdown",
              "parameters": {
                "content": "For detailed instructions on retrieving the Account Identifier and Programmatic Access Token, please refer to the [Connector Tutorial](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Snowflake/Data%20Connectors/Readme.md)."
              }
            },
            {
              "type": "DataConnectorsGrid",
              "parameters": {
                "mapping": [
                  {
                    "columnName": "Account-Identifier",
                    "columnValue": "properties.addOnAttributes.AccountId"
                  },
                  {
                    "columnName": "Table Name",
                    "columnValue": "properties.dataType"
                  }
                ],
                "menuItems": [
                  "DeleteConnector"
                ]
              }
            },
            {
              "type": "ContextPane",
              "parameters": {
                "isPrimary": true,
                "label": "Add Account",
                "title": "Add Account",
                "subtitle": "Add Account",
                "contextPaneType": "DataConnectorsContextPane",
                "instructionSteps": [
                  {
                    "instructions": [
                      {
                        "type": "Textbox",
                        "parameters": {
                          "label": "Snowflake Account Identifier",
                          "placeholder": "Enter Snowflake Account Identifier",
                          "type": "text",
                          "name": "accountId",
                          "validations": {
                            "required": true
                          }
                        }
                      },
                      {
                        "type": "Textbox",
                        "parameters": {
                          "label": "Snowflake PAT",
                          "placeholder": "Enter Snowflake PAT",
                          "type": "password",
                          "name": "apikey",
                          "validations": {
                            "required": true
                          }
                        }
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ]
    }
  }
}