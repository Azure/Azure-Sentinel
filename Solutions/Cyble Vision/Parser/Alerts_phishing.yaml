id: F23DF96D-B2A7-47B3-AC88-85E5AE2903B0
Function:
  Title: Parser to extract Phishing alerts from Cyble Vision Alerts
  Version: '1.0.0'
  LastUpdated: '2025-12-09'
Category: Microsoft Sentinel Parser
FunctionName: Alerts_phishing
FunctionAlias: Alerts_phishing
FunctionQuery: |
  CybleVisionAlerts_CL
  | where Service == "phishing"
  | extend Data = parse_json(Data)
  // Extract PH_* attributes
  | extend
      PH_Domain           = tostring(Domain),
      PH_ContentUpdatedOn = tostring(Content_Updated_On),
      // Nested phishing data
      PH_Brand              = tostring(Data.brand),
      PH_BrandIndustry      = tostring(Data.brand_industry),
      PH_BrandWebsite       = tostring(Data.brand_website),
      PH_DomainName         = tostring(Data.domain_name),     // nested domain_name (the phishing landing)
      PH_HostName           = tostring(Data.host_name),
      PH_Title              = tostring(Data.['title']),
      PH_ScreenshotURL      = tostring(Data.screenshot_url),
      PH_Source             = tostring(Data.source),
      PH_DetectedAt         = tostring(Data.detected_at),
      PH_LastLiveOn         = tostring(Data.last_live_on),
      PH_IsLive             = tostring(Data.is_live),
      PH_IsTakedown         = tostring(Data.is_takedown),
      PH_StatusCode         = tostring(Data.status_code),
      PH_LogoMatch          = tostring(Data.logo_match),
      PH_ContentMatch       = tostring(Data.content_match),
      PH_IPDetail           = tostring(Data.IPDetail),
      PH_AWSObjectName      = tostring(Data.aws_object_name),
      PH_DOObjectName       = tostring(Data.do_object_name),
      PH_Score              = tostring(Data.score),
      PH_URLs               = tostring(Data.urls),
      PH_PhishingKeyword    = tostring(Data.phishing_keyword_name), 
      PH_PhishingStatus     = tostring(Data.phishing_status),
      // Risk normalization (consistent with your standard)
      Risk_Score = pack("s", RiskScore_s, "e", RiskScore_e, "c", RiskScore_c)
  | project
      TimeGenerated,
      AlertID = tostring(ID),
      EntityID,
      KeywordName,
      CompanyID,
      Status,
      Severity,
      UserSeverity,
      BucketID,
      BucketName,
      Domain,
      TruePositive,
      LLMProcessed,
      LLMExplanation,
      Service,
      Risk_Score,
      // Phishing specific extracted fields
      PH_Brand,
      PH_BrandIndustry,
      PH_BrandWebsite,
      PH_DomainName,
      PH_HostName,
      PH_Title,
      PH_ScreenshotURL,
      PH_Source,
      PH_DetectedAt,
      PH_LastLiveOn,
      PH_IsLive,
      PH_IsTakedown,
      PH_StatusCode,
      PH_LogoMatch,
      PH_ContentMatch,
      PH_IPDetail,
      PH_AWSObjectName,
      PH_DOObjectName,
      PH_Score,
      PH_URLs,
      PH_PhishingKeyword,
      PH_PhishingStatus,
      Data
