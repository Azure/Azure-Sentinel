id: 68ED8105-D7BD-42FB-B2CB-2EBF7F4C4242
Function:
  Title: Parser to extract Domain Watchlist alerts from Cyble Vision Alerts
  Version: '1.0.0'
  LastUpdated: '2025-12-09'
Category: Microsoft Sentinel Parser
FunctionName: Alerts_domain_watchlist
FunctionAlias: Alerts_domain_watchlist
FunctionQuery: |
  CybleVisionAlerts_CL
  | where Service == "domain_watchlist"
  // Parse inner dataset
  | extend Data = parse_json(Data)
  | extend Data = (Data.data)
  // Extract updated fields list
  | extend DW_UpdatedFields = tostring(Data.updated_fields)
  // Old DNS record
  | extend Old = Data.old_dns_record
  | extend
      DW_Old_Domain = tostring(Old.domain),
      DW_Old_A = tostring(Old.a_records),
      DW_Old_NS = tostring(Old.ns_records),
      DW_Old_MX = tostring(Old.mx_records),
      DW_Old_SOA = tostring(Old.soa_records),
      DW_Old_TXT = tostring(Old.txt_records)
  // New DNS record
  | extend New = Data.new_dns_record
  | extend
      DW_New_Domain = tostring(New.domain),
      DW_New_A = tostring(New.a_records),
      DW_New_NS = tostring(New.ns_records),
      DW_New_MX = tostring(New.mx_records),
      DW_New_SOA = tostring(New.soa_records),
      DW_New_TXT = tostring(New.txt_records)
  // Normalize risk score (your standard)
  | extend Risk_Score = pack("s", RiskScore_s, "e", RiskScore_e, "c", RiskScore_c)
  // Final projection
  | project
      TimeGenerated,
      AlertID = tostring(ID),
      EntityID,
      KeywordName,
      CompanyID,
      Status,
      Severity,
      UserSeverity,
      BucketID,
      Domain,
      BucketName,
      TruePositive,
      LLMProcessed,
      LLMExplanation,
      IP,
      Service,
      Risk_Score,
      // Domain Watchlist additions
      DW_UpdatedFields,
      DW_Old_Domain,
      DW_Old_A,
      DW_Old_NS,
      DW_Old_MX,
      DW_Old_SOA,
      DW_Old_TXT,
      DW_New_Domain,
      DW_New_A,
      DW_New_NS,
      DW_New_MX,
      DW_New_SOA,
      DW_New_TXT
