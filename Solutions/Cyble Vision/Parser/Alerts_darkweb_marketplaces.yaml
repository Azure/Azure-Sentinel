id: 8C60E9DB-E89A-4943-AE48-05A1E187F640
Function:
  Title: Parser to extract DarkWeb Marketplace alerts from Cyble Vision Alerts
  Version: '1.0.0'
  LastUpdated: '2025-12-11'
Category: Microsoft Sentinel Parser
FunctionName: Alerts_darkweb_marketplaces
FunctionAlias: Alerts_darkweb_marketplaces
FunctionQuery: |
  CybleVisionAlerts_CL
  | where Service == "darkweb_marketplaces"
  | extend MappedSeverity = Severity
  | extend Risk_Score = pack("s", RiskScore_s, "e", RiskScore_e, "c", RiskScore_c)
  | extend AlertID = ID
  | extend Data = parse_json(Data)
  // Extract BANK Information
  | extend Bank = Data.bank
  | extend
  DW_Bank_BIN            = tostring(Bank.bin),
  DW_Bank_Brand          = tostring(Bank.['card'].brand),
  DW_Bank_CardNo         = tostring(Bank.['card'].card_no),
  DW_Bank_CardType       = tostring(Bank.['card'].card_type),
  DW_Bank_CVR            = tostring(Bank.['card'].cvr),
  DW_Bank_CVV            = tostring(Bank.['card'].cvv),
  DW_Bank_Expiry         = tostring(Bank.['card'].expiry),
  DW_Bank_Level          = tostring(Bank.['card'].level),
  DW_Bank_Country        = tostring(Bank.isocountry),
  DW_Bank_Phone          = tostring(Bank.phone),
  DW_Bank_RealName       = tostring(Bank.real_name),
  DW_Bank_RefName        = tostring(Bank.ref_name),
  DW_Bank_Site           = tostring(Bank.site)
  // Extract general marketplace fields
  | extend
  DW_Marketplace         = tostring(marketplace),
  DW_StealerName         = tostring(stealer),
  DW_ContentUpdatedOn    = tostring(Content_Updated_On),
  DW_Country             = tostring(Data.country),
  DW_Region              = tostring(Data.region),
  DW_Size                = tostring(Data.size),
  DW_Vendor              = tostring(Data.vendor),
  DW_Price               = tostring(Data.price),
  DW_Date                = tostring(Data.['date']),
  DW_OS                  = tostring(Data.os),
  DW_IP                  = tostring(Data.ip),
  DW_Browser             = tostring(Data.browser),
  DW_InstalledDate       = tostring(Data.installed_date),
  DW_CompanyLeaked       = tostring(Data.company_leaked)
  // Extract huge list of links (CSV to array)
  | extend DW_Links = split(tostring(Data.links), ",")
  // Extract other metadata fields
  | extend
  DW_Outlook             = tostring(Data.outlook),
  DW_Info                = tostring(Data.info),
  DW_RawData             = tostring(Data.raw_data),
  DW_ConfigUpdate        = tostring(Data.config_update),
  DW_Cookies             = tostring(Data.cookies),
  DW_CookiesDate         = tostring(Data.cookies_date),
  DW_UserAgent           = tostring(Data.userAgent),
  DW_UpdatedDate         = tostring(Data.updated_date)
  // Tags
  | extend DW_Tags = tostring(Tags)
  | project
      TimeGenerated,
      AlertID,
      EntityID,
      KeywordName,
      CompanyID,
      Status,
      Severity,
      UserSeverity,
      BucketID,
      Domain,
      BucketName,
      TruePositive,
      LLMProcessed,
      LLMExplanation,
      IP,
      Service,
      Risk_Score,
      DW_Marketplace,
      DW_StealerName,
      DW_ContentUpdatedOn,
      DW_Country,
      DW_Region,
      DW_Size,
      DW_Vendor,
      DW_Price,
      DW_Date,
      DW_OS,
      DW_IP,
      DW_Browser,
      DW_InstalledDate,
      DW_CompanyLeaked,
      DW_Links,
      DW_Outlook,
      DW_Info,
      DW_RawData,
      DW_ConfigUpdate,
      DW_Cookies,
      DW_CookiesDate,
      DW_UserAgent,
      DW_UpdatedDate,
      DW_Bank_BIN,
      DW_Bank_Brand,
      DW_Bank_CardNo,
      DW_Bank_CardType,
      DW_Bank_CVR,
      DW_Bank_CVV,
      DW_Bank_Expiry,
      DW_Bank_Level,
      DW_Bank_Country,
      DW_Bank_Phone,
      DW_Bank_RealName,
      DW_Bank_RefName,
      DW_Bank_Site,
      DW_Tags
