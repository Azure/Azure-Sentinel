[
    {
        "name": "CloudflareDCR",
        "apiVersion": "2021-09-01-preview",
        "type": "Microsoft.Insights/dataCollectionRules",
        "location": "{{location}}",
        "properties": {
            "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
            "streamDeclarations": {
                "Custom-CybleVisionAlerts_CL": {
                    "columns": [
                        {
                            "name": "created_at",
                            "type": "datetime"
                        },
                        {
                            "name": "updated_at",
                            "type": "datetime"
                        },
                        {
                            "name": "deleted_at",
                            "type": "datetime"
                        },
                        {
                            "name": "id",
                            "type": "guid"
                        },
                        {
                            "name": "data_id",
                            "type": "guid"
                        },
                        {
                            "name": "entity_id",
                            "type": "guid"
                        },
                        {
                            "name": "keyword_name",
                            "type": "string"
                        },
                        {
                            "name": "entity_type",
                            "type": "int"
                        },
                        {
                            "name": "service",
                            "type": "string"
                        },
                        {
                            "name": "company_id",
                            "type": "int"
                        },
                        {
                            "name": "description",
                            "type": "string"
                        },
                        {
                            "name": "status",
                            "type": "string"
                        },
                        {
                            "name": "assignee_id",
                            "type": "guid"
                        },
                        {
                            "name": "assignment_date",
                            "type": "datetime"
                        },
                        {
                            "name": "archive_date",
                            "type": "datetime"
                        },
                        {
                            "name": "severity",
                            "type": "string"
                        },
                        {
                            "name": "updated_by_id",
                            "type": "guid"
                        },
                        {
                            "name": "created_by",
                            "type": "string"
                        },
                        {
                            "name": "user_severity",
                            "type": "string"
                        },
                        {
                            "name": "risk_score",
                            "type": "string"
                        },
                        {
                            "name": "bucket_id",
                            "type": "int"
                        },
                        {
                            "name": "filename",
                            "type": "string"
                        },
                        {
                            "name": "repository_name",
                            "type": "string"
                        },
                        {
                            "name": "owner_name",
                            "type": "string"
                        },
                        {
                            "name": "bucket_name",
                            "type": "string"
                        },
                        {
                            "name": "true_positive",
                            "type": "string"
                        },
                        {
                            "name": "llm_processed",
                            "type": "string"
                        },
                        {
                            "name": "llm_explanation",
                            "type": "string"
                        },
                        {
                            "name": "tags",
                            "type": "string"
                        }
                    ]
                }
            },
            "destinations": {
                "logAnalytics": [
                    {
                        "workspaceResourceId": "{{workspaceResourceId}}",
                        "name": "clv2ws1"
                    }
                ]
            },
            "dataFlows": [
                {
                    "streams": [
                        "Custom-CybleVisionAlerts_CL"
                    ],
                    "destinations": [
                        "clv2ws1"
                    ],
                    "transformKql": "source | project  TimeGenerated = now(), IncidentId=incident_id, IncidentName=incident_name, CreationTime=datetime(1970-01-01) + (creation_time * 1ms), ModificationTime=datetime(1970-01-01) + (modification_time * 1ms), DetectionTime=datetime(1970-01-01) + (detection_time * 1ms), Status=status, Severity=severity, Description=description, AssignedUserMail=assigned_user_mail, assignedUserPrettyName=assigned_user_pretty_name, AlertCount=alert_count, LowSeverityAlertCount=low_severity_alert_count, MedSeverityAlertCount=med_severity_alert_count, HighSeverityAlertCount=high_severity_alert_count, CriticalSeverityAlertCount=critical_severity_alert_count, UserCount=user_count, HostCount=host_count, Notes=notes, ResolveComment=resolve_comment, ResolvedTimestamp=datetime(1970-01-01) + (resolved_timestamp * 1ms), ManualSeverity=manual_severity, ManualDescription=manual_description, XdrUrl=xdr_url, Starred=starred, Hosts=todynamic(hosts), Users=todynamic(users), IncidentSources=todynamic(incident_sources), RuleBasedScore=rule_based_score, ManualScore=manual_score, WildfireHits=wildfire_hits, AlertsGroupingStatus=alerts_grouping_status, MitreTacticsIdsAndNames=todynamic(mitre_tactics_ids_and_names), MitreTechniquesIdsAndNames=todynamic(mitre_techniques_ids_and_names), AlertCategories=todynamic(alert_categories), OriginalTags=todynamic(original_tags), Tags=todynamic(tags)",
                    "outputStream": "Custom-CybleVisionAlerts_CL"
                }
            ]
        }
    }
]

