[
    {
        "name": "CybleVisionAlertsDCR",
        "apiVersion": "2021-09-01-preview",
        "type": "Microsoft.Insights/dataCollectionRules",
        "location": "{{location}}",
        "properties": {
            "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
            "streamDeclarations": {
                "Custom-CybleVisionAlerts_CL": {
                    "columns": [
                        {
                            "name": "created_at",
                            "type": "datetime"
                        },
                        {
                            "name": "updated_at",
                            "type": "datetime"
                        },
                        {
                            "name": "deleted_at",
                            "type": "string"
                        },
                        {
                            "name": "id",
                            "type": "string"
                        },
                        {
                            "name": "data_id",
                            "type": "string"
                        },
                        {
                            "name": "entity_id",
                            "type": "int"
                        },
                        {
                            "name": "keyword_name",
                            "type": "string"
                        },
                        {
                            "name": "entity_type",
                            "type": "int"
                        },
                        {
                            "name": "service",
                            "type": "string"
                        },
                        {
                            "name": "company_id",
                            "type": "int"
                        },
                        {
                            "name": "description",
                            "type": "string"
                        },
                        {
                            "name": "status",
                            "type": "string"
                        },
                        {
                            "name": "assignee_id",
                            "type": "string"
                        },
                        {
                            "name": "assignment_date",
                            "type": "string"
                        },
                        {
                            "name": "archive_date",
                            "type": "string"
                        },
                        {
                            "name": "severity",
                            "type": "string"
                        },
                        {
                            "name": "updated_by_id",
                            "type": "string"
                        },
                        {
                            "name": "created_by",
                            "type": "string"
                        },
                        {
                            "name": "user_severity",
                            "type": "string"
                        },
                        {
                            "name": "bucket_id",
                            "type": "int"
                        },
                        {
                            "name": "asset",
                            "type": "string"
                        },
                        {
                            "name": "last_detected_at",
                            "type": "string"
                        },
                        {
                            "name": "filename",
                            "type": "string"
                        },
                        {
                            "name": "repository_name",
                            "type": "string"
                        },
                        {
                            "name": "owner_name",
                            "type": "string"
                        },
                        {
                            "name": "extension",
                            "type": "string"
                        },
                        {
                            "name": "compromised_date",
                            "type": "string"
                        },
                        {
                            "name": "article_name",
                            "type": "string"
                        },
                        {
                            "name": "breach_source",
                            "type": "string"
                        },
                        {
                            "name": "breach_date",
                            "type": "string"
                        },
                        {
                            "name": "channel_name",
                            "type": "string"
                        },
                        {
                            "name": "server_name",
                            "type": "string"
                        },
                        {
                            "name": "content_updated_on",
                            "type": "string"
                        },
                        {
                            "name": "discussion_date",
                            "type": "string"
                        },
                        {
                            "name": "discussion_by",
                            "type": "string"
                        },
                        {
                            "name": "source_name",
                            "type": "string"
                        },
                        {
                            "name": "topic_name",
                            "type": "string"
                        },
                        {
                            "name": "source",
                            "type": "string"
                        },
                        {
                            "name": "type",
                            "type": "string"
                        },
                        {
                            "name": "content_added_on",
                            "type": "string"
                        },
                        {
                            "name": "ioc",
                            "type": "string"
                        },
                        {
                            "name": "first_seen_on",
                            "type": "string"
                        },
                        {
                            "name": "last_seen_on",
                            "type": "string"
                        },
                        {
                            "name": "old_risk_score",
                            "type": "string"
                        },
                        {
                            "name": "new_risk_score",
                            "type": "string"
                        },
                        {
                            "name": "ip",
                            "type": "dynamic"
                        },
                        {
                            "name": "host",
                            "type": "string"
                        },
                        {
                            "name": "port",
                            "type": "int"
                        },
                        {
                            "name": "application_name",
                            "type": "string"
                        },
                        {
                            "name": "market_source",
                            "type": "string"
                        },
                        {
                            "name": "uploaded_at",
                            "type": "string"
                        },
                        {
                            "name": "cve",
                            "type": "string"
                        },
                        {
                            "name": "subdomain",
                            "type": "string"
                        },
                        {
                            "name": "domain",
                            "type": "string"
                        },
                        {
                            "name": "chat_title",
                            "type": "string"
                        },
                        {
                            "name": "username",
                            "type": "string"
                        },
                        {
                            "name": "search_engine",
                            "type": "string"
                        },
                        {
                            "name": "category",
                            "type": "string"
                        },
                        {
                            "name": "sentiment",
                            "type": "string"
                        },
                        {
                            "name": "name",
                            "type": "string"
                        },
                        {
                            "name": "true_positive",
                            "type": "boolean"
                        },
                        {
                            "name": "llm_processed",
                            "type": "boolean"
                        },
                        {
                            "name": "llm_explanation",
                            "type": "string"
                        },
                        {
                            "name": "bucket_name",
                            "type": "string"
                        },
                        {
                            "name": "tags",
                            "type": "dynamic"
                        },
                        {
                            "name": "risk_score",
                            "type": "dynamic"
                        },
                        {
                            "name": "marketplace",
                            "type": "string"
                        },
                        {
                            "name": "stealer",
                            "type": "string"
                        },
                        {
                            "name": "data",
                            "type": "dynamic"
                        }

                    ]
                }
            },
            "destinations": {
                "logAnalytics": [
                    {
                        "workspaceResourceId": "{{workspaceResourceId}}",
                        "name": "clv2ws1"
                    }
                ]
            },
            "dataFlows": [
                {
                    "streams": [
                        "Custom-CybleVisionAlerts_CL"
                    ],
                    "destinations": [
                        "clv2ws1"
                    ],
                    "transformKql": "source | extend TimeGenerated = now(), Created_At = todatetime(created_at), Updated_At = todatetime(updated_at), Deleted_At = deleted_at, DataID = data_id, EntityID = entity_id, KeywordName = keyword_name, EntityType = entity_type, Service = service, CompanyID = company_id, Description = description, Status = status, AssigneeID = assignee_id, AssignmentDate = assignment_date, ArchiveDate = archive_date, Severity = severity, UpdatedBy = updated_by_id, CreatedBy = created_by, UserSeverity = user_severity, BucketID = bucket_id, Filename = filename, RepositoryName = repository_name, OwnerName = owner_name, BucketName = bucket_name, TruePositive = true_positive, LLMProcessed = llm_processed, LLMExplanation = llm_explanation, Tags = tags, ID = id, Asset = asset, Last_Detected_At = last_detected_at, Extension = extension, Compromised_Date = compromised_date, Article_Name = article_name, Breach_Source = breach_source, Breach_Date = breach_date, Channel_Name = channel_name, Server_Name = server_name, Content_Updated_On = content_updated_on, Discussion_Date = discussion_date, Discussion_By = discussion_by, Source_Name = source_name, Topic_Name = topic_name, Source = source, Alert_Type = type, Content_Added_On = content_added_on, IOC = ioc, First_Seen_On = first_seen_on, Last_Seen_On = last_seen_on, Old_Risk_Score = old_risk_score, New_Risk_Score = new_risk_score, IP = ip, Host = host, Port = port, Application_Name = application_name, Market_Source = market_source, Uploaded_At = uploaded_at, CVE = cve, Subdomain = subdomain, Domain = domain, Chat_Title = chat_title, Username = username, Search_Engine = search_engine, Category = category, Sentiment = sentiment, Name = name, RiskScore_s = tostring(risk_score.s), RiskScore_e = tostring(risk_score.e), RiskScore_c = tostring(risk_score.c), Data = tostring(data), Marketplace = tostring(marketplace), Stealer = tostring(stealer)",
                    "outputStream": "Custom-CybleVisionAlerts_CL"
                }
            ]
        }
    }
]