{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for AbuseIPDB"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "AbuseIPDB",
    "_solutionVersion": "3.0.0",
    "solutionId": "azuresentinel.azure-sentinel-solution-abuseipdb",
    "_solutionId": "[variables('solutionId')]",
    "AbuseIPDBAPIConnector": "AbuseIPDBAPIConnector",
    "_AbuseIPDBAPIConnector": "[variables('AbuseIPDBAPIConnector')]",
    "TemplateEmptyArray": "[json('[]')]",
    "blanks": "[replace('b', 'b', '')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "AbuseIPDBAPIConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1'))))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','lc','-', uniqueString(concat(variables('_solutionId'),'-','LogicAppsCustomConnector','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "AbuseIPDB-EnrichIncidentByIPInfo": "AbuseIPDB-EnrichIncidentByIPInfo",
    "_AbuseIPDB-EnrichIncidentByIPInfo": "[variables('AbuseIPDB-EnrichIncidentByIPInfo')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "AbuseIPDB-EnrichIncidentByIPInfo",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams": "AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams",
    "_AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams": "[variables('AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "AbuseIPDB-BlacklistIpToThreatIntelligence": "AbuseIPDB-BlacklistIpToThreatIntelligence",
    "_AbuseIPDB-BlacklistIpToThreatIntelligence": "[variables('AbuseIPDB-BlacklistIpToThreatIntelligence')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "AbuseIPDB-BlacklistIpToThreatIntelligence",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4'))))]",
    "_playbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId4'),'-', variables('playbookVersion4'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AbuseIPDBAPIConnector Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "customApis_AbuseIPDBAPI_name": {
              "defaultValue": "AbuseIPDBAPI",
              "type": "string",
              "metadata": {
                "description": "Name of the AbuseIPDBAPI Connector"
              }
            }
          },
          "variables": {
            "operationId-check_endpoint": "check_endpoint",
            "_operationId-check_endpoint": "[[variables('operationId-check_endpoint')]",
            "operationId-blacklist_endpoint": "blacklist_endpoint",
            "_operationId-blacklist_endpoint": "[[variables('operationId-blacklist_endpoint')]",
            "operationId-report_endpoint": "report_endpoint",
            "_operationId-report_endpoint": "[[variables('operationId-report_endpoint')]",
            "operationId-check_block_endpoint": "check_block_endpoint",
            "_operationId-check_block_endpoint": "[[variables('operationId-check_block_endpoint')]",
            "operationId-clear_address_endpoint": "clear_address_endpoint",
            "_operationId-clear_address_endpoint": "[[variables('operationId-clear_address_endpoint')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId1": "AbuseIPDBAPIConnector",
            "playbookId1": "[[resourceId('Microsoft.Web/customApis', parameters('customApis_AbuseIPDBAPI_name'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('customApis_AbuseIPDBAPI_name')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring",
                    "uiDefinition": {
                      "displayName": "API Key",
                      "description": "The API Key for this api",
                      "tooltip": "Provide your API Key",
                      "constraints": {
                        "tabIndex": 2,
                        "clearText": false,
                        "required": "true"
                      }
                    }
                  }
                },
                "brandColor": "#FFFFFF",
                "description": "Connector for AbuseIPDB API",
                "displayName": "[[parameters('customApis_AbuseIPDBAPI_name')]",
                "iconUri": "data:image/png;base64,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",
                "backendService": {
                  "serviceUrl": "https://api.abuseipdb.com/api/v2/"
                },
                "apiType": "Rest",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "title": "Default title",
                    "description": "[variables('blanks')]",
                    "version": "1.0"
                  },
                  "host": "api.abuseipdb.com",
                  "basePath": "/api/v2/",
                  "schemes": [
                    "https"
                  ],
                  "consumes": "[variables('TemplateEmptyArray')]",
                  "produces": "[variables('TemplateEmptyArray')]",
                  "paths": {
                    "/check": {
                      "get": {
                        "responses": {
                          "200": {
                            "description": "OK",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "ipAddress": {
                                      "type": "string",
                                      "description": "ipAddress"
                                    },
                                    "isPublic": {
                                      "type": "boolean",
                                      "description": "isPublic"
                                    },
                                    "ipVersion": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "ipVersion"
                                    },
                                    "isWhitelisted": {
                                      "type": "boolean",
                                      "description": "isWhitelisted"
                                    },
                                    "abuseConfidenceScore": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "abuseConfidenceScore"
                                    },
                                    "countryCode": {
                                      "type": "string",
                                      "description": "countryCode"
                                    },
                                    "countryName": {
                                      "type": "string",
                                      "description": "countryName"
                                    },
                                    "usageType": {
                                      "type": "string",
                                      "description": "usageType"
                                    },
                                    "isp": {
                                      "type": "string",
                                      "description": "isp"
                                    },
                                    "domain": {
                                      "type": "string",
                                      "description": "domain"
                                    },
                                    "hostnames": {
                                      "type": "array",
                                      "description": "hostnames"
                                    },
                                    "totalReports": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "totalReports"
                                    },
                                    "numDistinctUsers": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "numDistinctUsers"
                                    },
                                    "lastReportedAt": {
                                      "type": "string",
                                      "description": "lastReportedAt"
                                    },
                                    "reports": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "reportedAt": {
                                            "type": "string",
                                            "description": "reportedAt"
                                          },
                                          "comment": {
                                            "type": "string",
                                            "description": "comment"
                                          },
                                          "categories": {
                                            "type": "array",
                                            "items": {
                                              "type": "integer",
                                              "format": "int32"
                                            },
                                            "description": "categories"
                                          },
                                          "reporterId": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "reporterId"
                                          },
                                          "reporterCountryCode": {
                                            "type": "string",
                                            "description": "reporterCountryCode"
                                          },
                                          "reporterCountryName": {
                                            "type": "string",
                                            "description": "reporterCountryName"
                                          }
                                        }
                                      },
                                      "description": "reports"
                                    }
                                  },
                                  "description": "data"
                                }
                              }
                            }
                          },
                          "401": {
                            "description": "Authentication failed."
                          },
                          "422": {
                            "description": "The max age in days must be between 1 and 365."
                          },
                          "429": {
                            "description": "Daily rate limit of requests exceeded for this endpoint."
                          }
                        },
                        "summary": "CHECK Endpoint",
                        "description": "The check endpoint accepts a single IP address (v4 or v6). Optionally you may set the maxAgeInDays parameter to only return reports within the last x amount of days.  The desired data is stored in the data property. Here you can inspect details regarding the IP address queried, such as version, country of origin, usage type, ISP, and domain name. And of course, there is the valuable abusive reports.",
                        "operationId": "[[variables('_operationId-check_endpoint')]",
                        "parameters": [
                          {
                            "name": "ipAddress",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "description": "IP Address"
                          },
                          {
                            "name": "maxAgeInDays",
                            "in": "query",
                            "type": "integer",
                            "required": false,
                            "description": "The maxAgeInDays parameter determines how far back in time we go to fetch reports. In this example, we ask for reports no older than 90 days. The default is 30."
                          }
                        ]
                      }
                    },
                    "/blacklist": {
                      "get": {
                        "responses": {
                          "200": {
                            "description": "Ok",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "meta": {
                                  "type": "object",
                                  "properties": {
                                    "generatedAt": {
                                      "type": "string",
                                      "description": "generatedAt"
                                    }
                                  },
                                  "description": "meta"
                                },
                                "data": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "ipAddress": {
                                        "type": "string",
                                        "description": "ipAddress"
                                      },
                                      "abuseConfidenceScore": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "abuseConfidenceScore"
                                      },
                                      "lastReportedAt": {
                                        "type": "string",
                                        "description": "lastReportedAt"
                                      }
                                    }
                                  },
                                  "description": "data"
                                }
                              }
                            }
                          },
                          "401": {
                            "description": "Authentication failed."
                          },
                          "429": {
                            "description": "Daily rate limit of requests exceeded for this endpoint."
                          }
                        },
                        "summary": "BLACKLIST Endpoint",
                        "description": "The blacklist is the culmination of all of the valiant reporting by AbuseIPDB users. It's a list of the most reported IP addresses.",
                        "operationId": "[[variables('_operationId-blacklist_endpoint')]",
                        "parameters": [
                          {
                            "name": "confidenceMinimum",
                            "in": "query",
                            "type": "integer",
                            "required": false,
                            "default": 25,
                            "description": "abuseConfidenceScore is our calculated evaluation on how abusive the IP is based on the users that reported it. We place a hard minimum of 25% on the abuseConfidenceScore"
                          },
                          {
                            "name": "limit",
                            "in": "query",
                            "type": "integer",
                            "required": false,
                            "default": 10000,
                            "description": "The number of IP addresses included in the list is capped to a hard limit, depending on your subscription. You can set the limit between 1 and your hard limit using the limit parameter. If you always want the largest list available, setting the limit to 500,000 will guarantee the max size allowable by your subscription, since 500,000 is the max limit for the highest tier."
                          },
                          {
                            "name": "onlyCountries",
                            "in": "query",
                            "type": "integer",
                            "required": false,
                            "description": "You can also filter by country. Both the onlyCountries and exceptCountries parameters accept a comma delineated list of ISO 3166 alpha-2 codes. The onlyCountries parameter retrieves IPs that only originate in the given country or countries."
                          },
                          {
                            "name": "exceptCountries",
                            "in": "query",
                            "type": "integer",
                            "required": false,
                            "description": "You can also filter by country. Both the onlyCountries and exceptCountries parameters accept a comma delineated list of ISO 3166 alpha-2 codes.  The exceptCountries parameter retrieves all IPs except those that originate in the given country or countries."
                          }
                        ]
                      }
                    },
                    "/report": {
                      "post": {
                        "responses": {
                          "200": {
                            "description": "Ok",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "ipAddress": {
                                      "type": "string",
                                      "description": "ipAddress"
                                    },
                                    "abuseConfidenceScore": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "abuseConfidenceScore"
                                    }
                                  },
                                  "description": "data"
                                }
                              }
                            }
                          },
                          "401": {
                            "description": "Authentication failed."
                          },
                          "429": {
                            "description": "Daily rate limit of requests exceeded for this endpoint. You can only report the same IP address (`127.0.0.2`) once in 15 minutes."
                          }
                        },
                        "summary": "REPORT Endpoint",
                        "description": "Reporting IP addresses is the core feature of AbuseIPDB. When you report what you observe, everyone benefits, including yourself. To report an IP address, send a POST request. At least one category is required, but you may add additional categories using commas to separate the integer IDs. Related details can be included in the comment field.",
                        "operationId": "[[variables('_operationId-report_endpoint')]",
                        "parameters": [
                          {
                            "name": "ip",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "description": "IP Address"
                          },
                          {
                            "name": "categories",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "description": "Comma separated values; Reference: https://www.abuseipdb.com/categories"
                          },
                          {
                            "name": "comment",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Related information (server logs, timestamps, etc.)"
                          }
                        ]
                      }
                    },
                    "/check-block": {
                      "get": {
                        "responses": {
                          "200": {
                            "description": "Ok",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "reportedAddress": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "ipAddress": {
                                            "type": "string",
                                            "description": "ipAddress"
                                          },
                                          "numReports": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "numReports"
                                          },
                                          "mostRecentReport": {
                                            "type": "string",
                                            "description": "mostRecentReport"
                                          },
                                          "abuseConfidenceScore": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "abuseConfidenceScore"
                                          },
                                          "countryCode": {
                                            "type": "string",
                                            "description": "countryCode"
                                          }
                                        }
                                      },
                                      "description": "reportedAddress"
                                    }
                                  },
                                  "description": "data"
                                }
                              }
                            }
                          },
                          "401": {
                            "description": "Authentication failed."
                          },
                          "402": {
                            "description": "Exceeding a parameter limit will return a 402 Payment Required response."
                          },
                          "422": {
                            "description": "The max age in days must be between 1 and 365."
                          },
                          "429": {
                            "description": "Daily rate limit of requests exceeded for this endpoint."
                          }
                        },
                        "summary": "CHECK-BLOCK Endpoint",
                        "operationId": "[[variables('_operationId-check_block_endpoint')]",
                        "description": "The check-block endpoint accepts a subnet (v4 or v6) denoted with CIDR notation.",
                        "parameters": [
                          {
                            "name": "network",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "description": "Due to the depth & breath of the these searches, the range of the parameters is capped by plan tier.  For most use cases, /24 is enough to an entire network. Many autonomous systems will sometimes have blocks of /20. Some of the largest autonomous systems will have blocks of /18 or /17."
                          },
                          {
                            "name": "maxAgeInDays",
                            "in": "query",
                            "type": "integer",
                            "required": false,
                            "description": "The maxAgeInDays parameter determines how old the reports considered in the query search can be."
                          }
                        ]
                      }
                    },
                    "/clear-address": {
                      "delete": {
                        "responses": {
                          "200": {
                            "description": "Ok",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "numReportsDeleted": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "numReportsDeleted"
                                    }
                                  },
                                  "description": "data"
                                }
                              }
                            }
                          },
                          "429": {
                            "description": "Daily rate limit of requests exceeded for this endpoint."
                          }
                        },
                        "summary": "CLEAR-ADDRESS Endpoint",
                        "operationId": "[[variables('_operationId-clear_address_endpoint')]",
                        "description": "The clear-address endpoint accepts a single IP address (v4 or v6).  The only property it returns is the number of reports deleted from your account. This endpoint is ONLY used to delete reports for an specific address from YOUR account. It cannot delete another user's reports. If this is what you are looking to do, the correct channel is the takedown request form available on an IP's web page.",
                        "parameters": [
                          {
                            "name": "ipAddress",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "description": "IP Address"
                          }
                        ]
                      }
                    }
                  },
                  "securityDefinitions": {
                    "API Key": {
                      "type": "apiKey",
                      "in": "header",
                      "name": "Key"
                    }
                  },
                  "security": [
                    {
                      "API Key": "[variables('TemplateEmptyArray')]"
                    }
                  ],
                  "tags": "[variables('TemplateEmptyArray')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "AbuseIPDB",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "LogicAppsCustomConnector",
        "displayName": "AbuseIPDBAPIConnector",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AbuseIPDB-EnrichIncidentByIPInfo Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AbuseIPDB-EnrichIncidentByIPInfo",
              "type": "String"
            },
            "customApis_AbuseIPDBAPI_name": {
              "defaultValue": "AbuseIPDBAPI",
              "type": "string",
              "metadata": {
                "description": "Name of the AbuseIPDBAPI Connector"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "AbuseIPDBConnectionName": "[[concat('abuseipdb-connection-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AbuseIPDBConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AbuseIPDBConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['object']?['id']",
                          "message": "<p><span style=\"font-size: 14px\"><strong></strong></span><span style=\"font-size: 14px\"><strong>@{outputs('Get_Logo')}</strong></span><span style=\"font-size: 14px\"><strong><br>\nAbuseIPDB IP Checking Results:</strong></span><br>\n@{outputs('Compose')}</p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      },
                      "runAfter": {
                        "Compose": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    },
                    "Check_each_IP_in_AbuseIPDB": {
                      "actions": {
                        "Append_Result_to_Result_List": {
                          "inputs": {
                            "name": "Result List",
                            "value": {
                              "abuseConfidenceScore": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['abuseConfidenceScore']",
                              "hostnames": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['hostnames']",
                              "ipAddress": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['ipAddress']",
                              "ipVersion": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['ipVersion']",
                              "isPublic": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['isPublic']",
                              "isWhitelisted": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['isWhitelisted']",
                              "isp": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['isp']",
                              "lastReportedAt": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['lastReportedAt']",
                              "numDistinctUsers": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['numDistinctUsers']",
                              "totalReports": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['totalReports']",
                              "usageType": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['usageType']"
                            }
                          },
                          "runAfter": {
                            "AuseIPDB_CHECK_Endpoint": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable"
                        },
                        "AuseIPDB_CHECK_Endpoint": {
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['AbuseIPDBAPI']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/check",
                            "queries": {
                              "ipAddress": "@items('Check_each_IP_in_AbuseIPDB')?['Address']"
                            }
                          },
                          "type": "ApiConnection"
                        }
                      },
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "runAfter": {
                        "Initialize_Results_List": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Compose": {
                      "inputs": "@body('Create_HTML_table_with_Results')",
                      "runAfter": {
                        "Create_HTML_table_with_Results": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose"
                    },
                    "Create_HTML_table_with_Results": {
                      "inputs": {
                        "format": "HTML",
                        "from": "@variables('Result List')"
                      },
                      "runAfter": {
                        "Check_each_IP_in_AbuseIPDB": [
                          "Succeeded"
                        ]
                      },
                      "type": "Table"
                    },
                    "Entities_-_Get_IPs": {
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      },
                      "type": "ApiConnection"
                    },
                    "Get_Logo": {
                      "inputs": "<img src=\"https://www.abuseipdb.com/img/abuseipdb.png.pagespeed.ce.CI8T6WsXU7.png\"  width=\"152\" height=\"32\"> ",
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose"
                    },
                    "Initialize_Results_List": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "Result List",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Get_Logo": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId, '/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]"
                      },
                      "AbuseIPDBAPI": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]",
                        "connectionName": "[[variables('AbuseIPDBConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "AbuseIPDB",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_AbuseIPDBAPIConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "AbuseIPDB Enrich Incident By IP Info",
            "description": "Once a new sentinal incident is created, this playbook gets triggered and performs the following actions:\n 1. [Gets Information](https://docs.abuseipdb.com/#check-endpoint) from AbuseIPDB by IP`s, provided in the alert custom entities. \n 2. Enriches the incident with the obtained info.",
            "prerequisites": [
              "1. AbuseIPDBAPI Custom Connector has to be deployed prior to the deployment of this playbook under the same subscription."
            ],
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, authorize each connection.",
              "1. Open playbook which has been deployed.",
              "2. Click API connection on left side blade.",
              "3. Click the Microsoft Sentinel connection resource.",
              "4. Click edit API connection.",
              "5. Click Authorize.",
              "6. Sign in.",
              "7. Click Save.",
              "8. Repeat steps for other connections."
            ],
            "lastUpdateTime": "2022-09-20T00:00:00Z",
            "entities": [
              "Ip"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "AbuseIPDB Enrich Incident By IP Info",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "AbuseIPDB-EnrichIncidentByIPInfo",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams",
              "type": "String"
            },
            "customApis_AbuseIPDBAPI_name": {
              "defaultValue": "AbuseIPDBAPI",
              "type": "string",
              "metadata": {
                "description": "Name of the AbuseIPDBAPI Connector"
              }
            },
            "MSTeamsGroupId": {
              "defaultValue": "<MSTeamsGroupId>",
              "type": "String",
              "metadata": {
                "description": "Value of the MSTeamsGroupId parameter in the AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams playbook. Id of the Teams Group where the adaptive card will be posted."
              }
            },
            "MSTeamsChannelId": {
              "defaultValue": "<MSTeamsChannelId>",
              "type": "String",
              "metadata": {
                "description": "Value of the MSTeamsChannelId parameter in the AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams playbook. Id of the Teams Channel where the adaptive card will be posted."
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "AbuseIPDBConnectionName": "[[concat('abuseipdb-connection-', parameters('PlaybookName'))]",
            "MSTeamsConnectionName": "[[concat('msteams-connection-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MSTeamsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('MSTeamsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AbuseIPDBConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AbuseIPDBConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Entities_-_Get_IPs": {
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      },
                      "type": "ApiConnection"
                    },
                    "For_each": {
                      "actions": {
                        "Condition": {
                          "actions": {
                            "REPORT_Endpoint": {
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['AbuseIPDBAPI']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/report",
                                "queries": {
                                  "categories": "@{body('Post_adaptive_card_and_wait_for_a_response')['data']['AbuseCategories']}",
                                  "comment": "@{body('Post_adaptive_card_and_wait_for_a_response')['data']['AbuseIPDBComment']}",
                                  "ip": "@items('For_each')?['Address']"
                                }
                              },
                              "type": "ApiConnection"
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "contains": [
                                  "@body('Post_adaptive_card_and_wait_for_a_response')",
                                  "data"
                                ]
                              },
                              {
                                "contains": [
                                  "@body('Post_adaptive_card_and_wait_for_a_response')['data']",
                                  "AbuseCategories"
                                ]
                              },
                              {
                                "contains": [
                                  "@body('Post_adaptive_card_and_wait_for_a_response')['data']",
                                  "AbuseIPDBComment"
                                ]
                              }
                            ]
                          },
                          "runAfter": {
                            "Post_adaptive_card_and_wait_for_a_response": [
                              "Succeeded"
                            ]
                          },
                          "type": "If"
                        },
                        "Get_Adaptive_Card_Body": {
                          "inputs": {
                            "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
                            "actions": [
                              {
                                "id": "btnSubmit",
                                "title": "Submit",
                                "type": "Action.Submit"
                              },
                              {
                                "id": "btnIgnore",
                                "title": "Ignore",
                                "type": "Action.Submit"
                              }
                            ],
                            "body": [
                              {
                                "size": "large",
                                "text": "Microsoft Sentinel - Report IP to AbuseIPDB",
                                "type": "TextBlock",
                                "weight": "bolder",
                                "wrap": true
                              },
                              {
                                "text": " Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['description']}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "For more details check the incident:",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "[[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "id": "PollQuestionAction",
                                "text": "Select AbuseIPDB attack categories associated with this IP Address: @{items('For_each')?['Address']}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "choices": [
                                  {
                                    "title": "DNS Compromise",
                                    "value": "1"
                                  },
                                  {
                                    "title": "DNS Poisoning",
                                    "value": "2"
                                  },
                                  {
                                    "title": "Fraud Orders",
                                    "value": "3"
                                  },
                                  {
                                    "title": "DDoS Attack",
                                    "value": "4"
                                  },
                                  {
                                    "title": "FTP Brute-Force",
                                    "value": "5"
                                  },
                                  {
                                    "title": "Ping of Death",
                                    "value": "6"
                                  },
                                  {
                                    "title": "Phishing",
                                    "value": "7"
                                  },
                                  {
                                    "title": "Fraud VoIP",
                                    "value": "8"
                                  },
                                  {
                                    "title": "Open Proxy",
                                    "value": "9"
                                  },
                                  {
                                    "title": "Web Spam",
                                    "value": "10"
                                  },
                                  {
                                    "title": "Email Spam",
                                    "value": "11"
                                  },
                                  {
                                    "title": "Blog Spam",
                                    "value": "12"
                                  },
                                  {
                                    "title": "VPN IP",
                                    "value": "13"
                                  },
                                  {
                                    "title": "Port Scan",
                                    "value": "14"
                                  },
                                  {
                                    "title": "Hacking",
                                    "value": "15"
                                  },
                                  {
                                    "title": "SQL Injection",
                                    "value": "16"
                                  },
                                  {
                                    "title": "Spoofing",
                                    "value": "17"
                                  },
                                  {
                                    "title": "Brute-Force",
                                    "value": "18"
                                  },
                                  {
                                    "title": "Bad Web Bot",
                                    "value": "19"
                                  },
                                  {
                                    "title": "Exploited Host",
                                    "value": "20"
                                  },
                                  {
                                    "title": "Web App Attack",
                                    "value": "21"
                                  },
                                  {
                                    "title": "SSH",
                                    "value": "22"
                                  },
                                  {
                                    "title": "IoT Targeted",
                                    "value": "23"
                                  }
                                ],
                                "id": "AbuseCategories",
                                "isMultiSelect": true,
                                "placeholder": "Attack categories",
                                "style": "compact",
                                "type": "Input.ChoiceSet"
                              },
                              {
                                "text": "Please add comment with relative information:",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "id": "AbuseIPDBComment",
                                "placeholder": "{AbuseIPDBComment}",
                                "type": "Input.Text"
                              }
                            ],
                            "type": "AdaptiveCard",
                            "version": "1.0"
                          },
                          "type": "Compose"
                        },
                        "Post_adaptive_card_and_wait_for_a_response": {
                          "inputs": {
                            "body": {
                              "body": {
                                "messageBody": "@{outputs('Get_Adaptive_Card_Body')}",
                                "recipient": {
                                  "channelId": "@variables('TeamsChannelId')",
                                  "groupId": "@variables('TeamsGroupId')"
                                },
                                "updateMessage": "Thanks for your response!"
                              },
                              "notificationUrl": "@{listCallbackUrl()}"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['teams']['connectionId']"
                              }
                            },
                            "path": "/v1.0/teams/conversation/gatherinput/poster/Flow bot/location/@{encodeURIComponent('Channel')}/$subscriptions"
                          },
                          "runAfter": {
                            "Get_Adaptive_Card_Body": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnectionWebhook"
                        }
                      },
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "runAfter": {
                        "Initialize_TeamsChannelId": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Get_Logo": {
                      "inputs": "<img src=\"https://www.abuseipdb.com/img/abuseipdb.png.pagespeed.ce.CI8T6WsXU7.png\"  width=\"152\" height=\"32\"> ",
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose"
                    },
                    "Initialize_TeamsChannelId": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "TeamsChannelId",
                            "type": "string",
                            "value": "[[parameters('MSTeamsChannelId')]"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_TeamsGroupId": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_TeamsGroupId": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "TeamsGroupId",
                            "type": "string",
                            "value": "[[parameters('MSTeamsGroupId')]"
                          }
                        ]
                      },
                      "runAfter": {
                        "Get_Logo": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId, '/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]"
                      },
                      "teams": {
                        "connectionName": "[[variables('MSTeamsConnectionName')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MSTeamsConnectionName'))]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]"
                      },
                      "AbuseIPDBAPI": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]",
                        "connectionName": "[[variables('AbuseIPDBConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "AbuseIPDB",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_AbuseIPDBAPIConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": " AbuseIPDB Report a IPs To AbuselPDB After Checking By User In MSTeams",
            "description": "When a new sentinel incident is created, this playbook gets triggered and performs the following actions:\n 1. Sends an adaptive card to the Teams channel where the analyst can choose an action to be taken.",
            "prerequisites": [
              "1. Prior to the deployment of this playbook, AbuseIPDB Connector needs to be deployed under the same subscription.",
              "2. Obtain AbuseIPDB API credentials.",
              "3. Obtain Teams group id and channel id."
            ],
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, authorize each connection.",
              "1. Open playbook which has been deployed.",
              "2. Click API connection on left side blade.",
              "3. Click the Microsoft Sentinel connection resource.",
              "4. Click edit API connection.",
              "5. Click Authorize.",
              "6. Sign in.",
              "7. Click Save.",
              "8. Repeat steps for other connections."
            ],
            "lastUpdateTime": "2022-09-20T00:00:00Z",
            "entities": [
              "Ip"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "AbuseIPDB Report a IPs To AbuselPDB After Checking By User In MSTeams",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AbuseIPDB-BlacklistIpToThreatIntelligence Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AbuseIPDB-BlacklistIpToThreatIntelligence",
              "type": "String"
            },
            "customApis_AbuseIPDBAPI_name": {
              "defaultValue": "AbuseIPDBAPI",
              "type": "string",
              "metadata": {
                "description": "Name of the AbuseIPDBAPI Connector"
              }
            }
          },
          "variables": {
            "AbuseIPDBConnectionName": "[[concat('abuseipdb-', parameters('PlaybookName'))]",
            "ThreatIntelligenceConnectionName": "[[concat('ThreatIntelligence-connection-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/microsoftgraphsecurity')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AbuseIPDBConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AbuseIPDBConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('ThreatIntelligenceConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('ThreatIntelligenceConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('ThreatIntelligenceConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "BLACKLIST_Endpoint": {
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['AbuseIPDBAPI']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/blacklist",
                        "queries": {
                          "confidenceMinimum": 25,
                          "limit": 10000
                        }
                      },
                      "type": "ApiConnection"
                    },
                    "Initialize_Results_Array": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "Results_Array",
                            "type": "array",
                            "value": "@body('Select')"
                          }
                        ]
                      },
                      "runAfter": {
                        "Select": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_Temp_Array": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "Temp_Array",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_Working_Array": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_Working_Array": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "Working_array",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_Results_Array": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Select": {
                      "inputs": {
                        "from": "@body('BLACKLIST_Endpoint')?['data']",
                        "select": {
                          "action": "alert",
                          "confidence": "@item()['abuseConfidenceScore']",
                          "description": "AbuseIPDB BLACKLIST Indicator ",
                          "expirationDateTime": "@addDays(utcNow(),7)",
                          "lastReportedDateTime": "@item()['lastReportedAt']",
                          "networkDestinationIPv4": "@item()['ipAddress']",
                          "targetProduct": "Azure Sentinel",
                          "threatType": "WatchList",
                          "tlpLevel": "unknown"
                        }
                      },
                      "runAfter": {
                        "BLACKLIST_Endpoint": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select"
                    },
                    "Until": {
                      "actions": {
                        "Remove_Items_From_Results_Array": {
                          "inputs": {
                            "name": "Results_Array",
                            "value": "@variables('Temp_Array')"
                          },
                          "runAfter": {
                            "Set_Temp_Array": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable"
                        },
                        "Set_Temp_Array": {
                          "inputs": {
                            "name": "Temp_Array",
                            "value": "@skip(variables('Results_Array'),100)"
                          },
                          "runAfter": {
                            "Submit_multiple_tiIndicators": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable"
                        },
                        "Set_Working_Array": {
                          "inputs": {
                            "name": "Working_array",
                            "value": "@take(variables('Results_Array'), 100)"
                          },
                          "type": "SetVariable"
                        },
                        "Submit_multiple_tiIndicators": {
                          "inputs": {
                            "body": {
                              "value": "@variables('Working_array')"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['microsoftgraphsecurity']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/beta/security/tiIndicators/submitTiIndicators"
                          },
                          "runAfter": {
                            "Set_Working_Array": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection"
                        }
                      },
                      "expression": "@equals(length(variables('Results_Array')), 0)",
                      "limit": {
                        "count": 5000,
                        "timeout": "PT1H"
                      },
                      "runAfter": {
                        "Initialize_Temp_Array": [
                          "Succeeded"
                        ]
                      },
                      "type": "Until"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "evaluatedRecurrence": {
                        "frequency": "Day",
                        "interval": 1
                      },
                      "recurrence": {
                        "frequency": "Day",
                        "interval": 1
                      },
                      "type": "Recurrence"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "AbuseIPDBAPI": {
                        "connectionName": "[[variables('AbuseIPDBConnectionName')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]"
                      },
                      "microsoftgraphsecurity": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('ThreatIntelligenceConnectionName'))]",
                        "connectionName": "[[variables('ThreatIntelligenceConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/microsoftgraphsecurity')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "AbuseIPDB",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_AbuseIPDBAPIConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "AbuseIPDB Blacklist Ip To Threat Intelligence",
            "description": "By every day reccurence, this playbook gets triggered and performs the following actions:\n 1. Gets [list](https://docs.abuseipdb.com/#blacklist-endpoint) of the most reported IP addresses form the Blacklist Endpoint.",
            "prerequisites": [
              "1. AbuseIPDBAPI Custom Connector has to be deployed prior to the deployment of this playbook under the same subscription.",
              "2. To use the Microsoft Graph Security connector actions, Azure Active Directory (AD) tenant administrator consent needs to be provided. The Microsoft Graph Security connector application ID and name for Azure AD in is as follows for Azure AD administrator consent:\n- Application Name - MicrosoftGraphSecurityConnector\n- Application ID - c4829704-0edc-4c3d-a347-7c4a67586f3c",
              "3.To view the Threat Indicators submitted by Microsoft Graph Security connector, 'Threat Intelligence Platforms' connector from 'Threat Intelligence' Solution need be installed."
            ],
            "preDeployment": [
              "1. AbuseIPDB Custom Connector has to be deployed prior to the deployment of this playbook under the same subscription."
            ],
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, authorize each connection.",
              "1. Open playbook which has been deployed.",
              "2. Click API connection on left side blade.",
              "3. Click the Microsoft Sentinel connection resource.",
              "4. Click edit API connection.",
              "5. Click Authorize.",
              "6. Sign in.",
              "7. Click Save.",
              "8. Repeat steps for tiIndicators connector API Connection."
            ],
            "lastUpdateTime": "2023-01-15T15:00:00Z",
            "entities": [
              "Ip"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "AbuseIPDB Blacklist Ip To Threat Intelligence",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId4')]",
        "contentKind": "Playbook",
        "displayName": "AbuseIPDB-BlacklistIpToThreatIntelligence",
        "contentProductId": "[variables('_playbookcontentProductId4')]",
        "id": "[variables('_playbookcontentProductId4')]",
        "version": "[variables('playbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "AbuseIPDB",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> <em>There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</em></p>\n<p>The <a href=\"https://www.abuseipdb.com/about\">AbuseIPDB</a> solution for Microsoft Sentinel allows you to check the reputation of IP addresses in log data and perform automated actions like enriching a Microsoft Sentinel incident by IP reputation information, add blacklisted IP addresses to ThreatIntelligenceIndicator table and reporting IPs to Abuse IPDB based on a user response in Teams.</p>\n<p><strong>Custom Azure Logic Apps Connectors:</strong> 1, <strong>Playbooks:</strong> 3</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Azure_Sentinel.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "AbuseIPDB",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_AbuseIPDBAPIConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_AbuseIPDB-EnrichIncidentByIPInfo')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_AbuseIPDB-BlacklistIpToThreatIntelligence')]",
              "version": "[variables('playbookVersion4')]"
            }
          ]
        },
        "firstPublishDate": "2022-05-23",
        "providers": [
          "Microsoft"
        ],
        "categories": {
          "domains": [
            "Security - Automation (SOAR)"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
