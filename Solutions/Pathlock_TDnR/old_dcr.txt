{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "dataCollectionEndpointId": {
      "type": "string"
    },
    "workspaceResourceId": {
      "type": "string"
    },
    "location": {
      "type": "string"
    }
  },
  "resources": [
    {
      "type": "Microsoft.Insights/dataCollectionRules",
      "apiVersion": "2022-06-01",
      "name": "Pathlock-TDnR-DCR",
      "location": "[parameters('location')]",
      "properties": {
        "dataCollectionEndpointId": "[parameters('dataCollectionEndpointId')]",
        "streamDeclarations": {
          "Custom-Pathlock_TDnR_CL": {
            "columns": [
              {
                "name": "AbapProgramName",
                "type": "string"
              },
              {
                "name": "AgentId",
                "type": "string"
              },
              {
                "name": "AlertSeverity",
                "type": "string"
              },
              {
                "name": "AlertSeverityText",
                "type": "string"
              },
              {
                "name": "AlertValue",
                "type": "string"
              },
              {
                "name": "AuditClassId",
                "type": "string"
              },
              {
                "name": "ClientId",
                "type": "string"
              },
              {
                "name": "Computer",
                "type": "string"
              },
              {
                "name": "Email",
                "type": "string"
              },
              {
                "name": "Host",
                "type": "string"
              },
              {
                "name": "Instance",
                "type": "string"
              },
              {
                "name": "MessageClass",
                "type": "string"
              },
              {
                "name": "MessageContainerId",
                "type": "string"
              },
              {
                "name": "MessageId",
                "type": "string"
              },
              {
                "name": "MessageText",
                "type": "string"
              },
              {
                "name": "MonitoringObjectName",
                "type": "string"
              },
              {
                "name": "MonitorShortName",
                "type": "string"
              },
              {
                "name": "RemoteIpCountry",
                "type": "string"
              },
              {
                "name": "RemoteIpLatitude",
                "type": "string"
              },
              {
                "name": "RemoteIpLongitude",
                "type": "string"
              },
              {
                "name": "SalDateChar8",
                "type": "string"
              },
              {
                "name": "SalIpAddress",
                "type": "string"
              },
              {
                "name": "SalTimeChar6",
                "type": "string"
              },
              {
                "name": "SapProcessType",
                "type": "string"
              },
              {
                "name": "SapWorkProcessName",
                "type": "string"
              },
              {
                "name": "SourceSystem",
                "type": "string"
              },
              {
                "name": "SystemId",
                "type": "string"
              },
              {
                "name": "SystemNumber",
                "type": "string"
              },
              {
                "name": "SystemRole",
                "type": "string"
              },
              {
                "name": "SystemUniqueId",
                "type": "string"
              },
              {
                "name": "TenantId",
                "type": "string"
              },
              {
                "name": "TerminalIpv6",
                "type": "string"
              },
              {
                "name": "TimeGenerated",
                "type": "string"
              },
              {
                "name": "TransactionCode",
                "type": "string"
              },
              {
                "name": "UpdateOn",
                "type": "real"
              },
              {
                "name": "User",
                "type": "string"
              },
              {
                "name": "Variable1",
                "type": "string"
              },
              {
                "name": "Variable2",
                "type": "string"
              },
              {
                "name": "Variable3",
                "type": "string"
              },
              {
                "name": "Variable4",
                "type": "string"
              }
            ]
          }
        },
        "destinations": {
          "logAnalytics": [
            {
              "name": "laDest",
              "workspaceResourceId": "[parameters('workspaceResourceId')]"
            }
          ]
        },
        "dataFlows": [
          {
            "streams": [
              "Custom-Pathlock_TDnR_CL"
            ],
            "destinations": [
              "laDest"
            ],
            "transformKql": "source\n| extend TimeGenerated = todatetime(TimeGenerated)\n| extend TenantIdPayload = tostring(TenantId), SourceSystemPayload = tostring(SourceSystem)\n| project-away TenantId, SourceSystem\n"
          }
        ]
      }
    }
  ]
}