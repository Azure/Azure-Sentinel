{
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "apiVersion": "2025-06-01",
    "name": "Pathlock_TDnR",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": {
        "connectorUiConfig": {
            "id": "Pathlock_TDnR",
            "title": "Pathlock Inc.: Threat Detection and Response for SAP",
            "publisher": "Pathlock Inc.",
            "logo": "pathlock_logo.svg",
            "descriptionMarkdown": "The [Pathlock Threat Detection and Response (TD&R)](https://pathlock.com/products/cybersecurity-application-controls/) integration with **Microsoft Sentinel Solution for SAP** delivers unified, real-time visibility into SAP security events, enabling organizations to detect and act on threats across all SAP landscapes. This out-of-the-box integration allows Security Operations Centers (SOCs) to correlate SAP-specific alerts with enterprise-wide telemetry, creating actionable intelligence that connects IT security with business processes.\n\nPathlock’s connector is purpose-built for SAP and forwards only **security-relevant events by default**, minimizing data volume and noise while maintaining the flexibility to forward all log sources when needed. Each event is enriched with **business process context**, allowing Microsoft Sentinel Solution for SAP analytics to distinguish operational patterns from real threats and to prioritize what truly matters.\n\nThis precision-driven approach helps security teams drastically reduce false positives, focus investigations, and accelerate **mean time to detect (MTTD)** and **mean time to respond (MTTR)**. Pathlock’s library consists of more than 1,500 SAP-specific detection signatures across 70+ log sources, the solution uncovers complex attack behaviors, configuration weaknesses, and access anomalies.\n\nBy combining business-context intelligence with advanced analytics, Pathlock enables enterprises to strengthen detection accuracy, streamline response actions, and maintain continuous control across their SAP environments—without adding complexity or redundant monitoring layers.",
            "graphQueriesTableName": "ABAPAuditLog",
            "graphQueries": [
                {
                    "metricName": "Total events received",
                    "legend": "SAP SID's",
                    "baseQuery": "{{graphQueriesTableName}} | project TimeGenerated, SAP_SID= SystemUniqueId"
                },
                {
                    "metricName": "Alerts received last 24 hrs.",
                    "legend":"Total Alerts",
                    "baseQuery": "{{graphQueriesTableName}} | summarize count() by bin(TimeGenerated, 1d)"

                }
            ],
            "sampleQueries": [
                {
                    "description": "Get Sample Events",
                    "query": "{{graphQueriesTableName}}\n | take 10"
                }
            ],
            "dataTypes": [
                {
                    "name": "{{graphQueriesTableName}}",
                    "lastDataReceivedQuery": "{{graphQueriesTableName}}\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                }
            ],
            "connectivityCriteria": [
                {
                    "type": "HasDataConnectors"
                }
            ],
            "availability": {
                "isPreview": true
            },
            "permissions": {
                "resourceProvider": [
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "write": true,
                            "read": true,
                            "delete": true
                        }
                    },
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "action": true
                        }
                    }
                ],
                "customs": [
                    {
                        "name": "Microsoft Entra",
                        "description": "Permission to create an app registration in Microsoft Entra ID. Typically requires Entra ID Application Developer role or higher."
                    },
                    {
                        "name": "Microsoft Azure",
                        "description": "Permission to assign Monitoring Metrics Publisher role on data collection rules. Typically requires Azure RBAC Owner or User Access Administrator role."
                    }
                ]
            },
            "instructionSteps": [
                                {
                                    "title": "1. Create ARM Resources and Provide the Required Permissions",
                                    "description": "We will create data collection rule (DCR) and data collection endpoint (DCE) resources. We will also create a Microsoft Entra app registration and assign the required permissions to it.",
                                    "instructions": [
                                        {
                                            "type": "Markdown",
                                            "parameters": {
                                                "content": "#### Automated deployment of Azure resources\nClicking on \"Deploy push connector resources\" will trigger the creation of DCR and DCE resources.\nIt will then create a Microsoft Entra app registration with client secret and grant permissions on the DCR. This setup enables data to be sent securely to the DCR using a OAuth v2 client credentials."
                                            }
                                        },
                                        {
                                            "parameters": {
                                                "label": "Deploy push connector resources",
                                                "applicationDisplayName": "Pathlock Inc. Threat Detection and Response for SAP"
                                            },
                                            "type": "DeployPushConnectorButton_test"
                                        }
                                    ]
                                },
                                {
                                    "title": "2. Maintain the data collection endpoint details and authentication info in your central instance of Pathlock's Cybersecurity Application Controls: Threat Detection and Response",
                                    "description": "Share the data collection endpoint URL and authentication info with the Pathlock administrator to configure the plug and play forwarding in Threat Detection and Response to send data to the data collection endpoint.\nPlease do not hesitate to contact Pathlock if support is needed.\n\n",
                                    "instructions": [
                                        {
                                            "parameters": {
                                                "label": "Use this value to configure as Tenant ID in the LogIngestionAPI credential.",
                                                "fillWith": [
                                                    "TenantId"
                                                ]
                                            },
                                            "type": "CopyableLabel"
                                        },
                                        {
                                            "parameters": {
                                                "label": "Entra Application ID",
                                                "fillWith": [
                                                    "ApplicationId"
                                                ],
                                                "placeholder": "Deploy push connector to get the Application ID"
                                            },
                                            "type": "CopyableLabel"
                                        },
                                        {
                                            "parameters": {
                                                "label": "Entra Application Secret",
                                                "fillWith": [
                                                    "ApplicationSecret"
                                                ],
                                                "placeholder": "Deploy push connector to get the Application Secret"
                                            },
                                            "type": "CopyableLabel"
                                        },
                                        {
                                            "parameters": {
                                                "label": "Use this value to configure the LogsIngestionURL parameter when deploying the IFlow.",
                                                "fillWith": [
                                                    "DataCollectionEndpoint"
                                                ],
                                                "placeholder": "Deploy push connector to get the DCE URI"
                                            },
                                            "type": "CopyableLabel"
                                        },
                                        {
                                            "parameters": {
                                                "label": "DCR Immutable ID",
                                                "fillWith": [
                                                    "DataCollectionRuleId"
                                                ],
                                                "placeholder": "Deploy push connector to get the DCR ID"
                                            },
                                            "type": "CopyableLabel"
                                        }
                                    ]
                                }
                            ]
        }
    }
}
