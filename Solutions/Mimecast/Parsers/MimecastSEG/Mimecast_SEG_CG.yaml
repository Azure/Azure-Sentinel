id: 91267889-770d-451b-9ed8-d3ed260c48e3
Function:
  Title: Parser for Mimecast SEG Cloud Gateway
  Version: "1.0.1"
  LastUpdated: "2025-10-29"
Category: Microsoft Sentinel Parser
FunctionName: MimecastCG
FunctionAlias: MimecastCG
FunctionQuery: |
  let dummy_table = datatable(TimeGenerated: datetime) [];
  let MimecastCG_view = view() {
  union isfuzzy=true dummy_table,
  Seg_Cg_CL
  | extend  
      ["Time Generated"] = column_ifexists("TimeGenerated", ""),
      ["Url Category"] = column_ifexists("urlCategory", ""),
      ["Scan Results"] = column_ifexists("scanResults", ""),
      ["File Name"] = column_ifexists("fileName", ""),
      ["Sha256"] = column_ifexists("sha256", ""),
      ["File Extension"] = column_ifexists("fileExtension", ""),
      ["Virus Found"] = column_ifexists("virusFound", ""),
      ["Sha1"] = column_ifexists("sha1", ""),
      ["Sender Domain"] = column_ifexists("senderDomain", ""),
      ["Md5"] = column_ifexists("md5", ""),
      ["Custom Threat Dictionary"] = column_ifexists("customThreatDictionary", ""),
      ["Items Detected"] = column_ifexists("itemsDetected", ""),
      ["Similar Custom External Domain"] = column_ifexists("similarCustomExternalDomain", ""),
      ["Tagged External"] = column_ifexists("taggedExternal", ""),
      ["Similar Internal Domain"] = column_ifexists("similarInternalDomain", ""),
      ["New Domain"] = column_ifexists("newDomain", ""),
      ["Internal User Name"] = column_ifexists("internalUserName", ""),
      ["Mimecast Threat Dictionary"] = column_ifexists("mimecastThreatDictionary", ""),
      ["Similar Mimecast External Domain"] = column_ifexists("similarMimecastExternalDomain", ""),
      ["Custom Name Match"] = column_ifexists("customNameMatch", ""),
      ["Tagged Malicious"] = column_ifexists("taggedMalicious", ""),
      ["Reply Mismatch"] = column_ifexists("replyMismatch", ""),
      ["Aggregate ID S"] = column_ifexists("aggregateId", ""),
      ["Aggregate ID G"] = column_ifexists("aggregateId", ""),
      ["Rejection Type"] = column_ifexists("rejectionType", ""),
      ["Rejection Code"] = column_ifexists("rejectionCode", ""),
      ["Rejection Info"] = column_ifexists("rejectionInfo", ""),
      ["Delivered"] = column_ifexists("delivered", ""),
      ["Destination IP"] = column_ifexists("destinationIp", ""),
      ["Host Name"] = column_ifexists("Hostname", ""),
      ["Delivery Attempts"] = column_ifexists("deliveryAttempts", ""),
      ["TLS Used"] = column_ifexists("tlsUsed", ""),
      ["Delivery Errors"] = column_ifexists("deliveryErrors", ""),
      ["Attachments"] = column_ifexists("attachments", ""),
      ["Route"] = column_ifexists("route", ""),
      ["Processing ID"] = column_ifexists("processingId", ""),
      ["Account ID"] = column_ifexists("accountId", ""),
      ["Action"] = column_ifexists("action", ""),
      ["Event Time"] = column_ifexists("timestamp", ""),
      ["Sender Envelope"] = column_ifexists("senderEnvelope", ""),
      ["Message ID"] = column_ifexists("messageId", ""),
      ["Subject"] = column_ifexists("subject", ""),
      ["Total of Size Attachments"] = column_ifexists("totalSizeAttachments", ""),
      ["Number of Attachments"] = column_ifexists("numberAttachments", ""),
      ["Email Size"] = column_ifexists("emailSize", ""),
      ["Type"] = column_ifexists("Logtype", ""),
      ["Sub Type"] = column_ifexists("subtype", ""),
      ["Monitored Domain Source"] = column_ifexists("monitoredDomainSource", ""),
      ["Similar Domain"] = column_ifexists("similarDomain", ""),
      ["Offset"] = column_ifexists("offset", ""),
      ["Partition"] = column_ifexists("partition", ""),
      ["Hold Reason"] = column_ifexists("holdReason", ""),
      ["Recipients"] = column_ifexists("recipients", ""),
      ["Sender IP"] = column_ifexists("senderIp", ""),
      ["Direction"] = column_ifexists("direction", ""),
      ["Sender Header"] = column_ifexists("senderHeader", ""),
      ["TLS Version"] = column_ifexists("tlsVersion", ""),
      ["TLS Cipher"] = column_ifexists("tlsCipher", ""),
      ["Spam Info"] = column_ifexists("spamInfo", ""),
      ["Spam Processing Detail"] = column_ifexists("spamProcessingDetail", "")
  | summarize arg_max(["Time Generated"], *) by 
        ["Url Category"],
        ["Scan Results"],
        ["File Name"],
        ["Sha256"],
        ["File Extension"],
        ["Virus Found"],
        ["Sha1"],
        ["Sender Domain"],
        ["Md5"],
        ["Custom Threat Dictionary"],
        ["Items Detected"],
        ["Similar Custom External Domain"],
        ["Tagged External"],
        ["Similar Internal Domain"],
        ["New Domain"],
        ["Internal User Name"],
        ["Mimecast Threat Dictionary"],
        ["Similar Mimecast External Domain"],
        ["Custom Name Match"],
        ["Tagged Malicious"],
        ["Reply Mismatch"],
        ["Aggregate ID"] = coalesce(["Aggregate ID S"], ["Aggregate ID G"]),
        ["Rejection Type"],
        ["Rejection Code"],
        ["Rejection Info"],
        ["Delivered"],
        ["Destination IP"],
        ["Host Name"],
        ["Delivery Attempts"],
        ["TLS Used"],
        ["Delivery Errors"],
        ["Attachments"],
        ["Route"],
        ["Processing ID"],
        ["Account ID"],
        ["Action"],
        ["Event Time"],
        ["Sender Envelope"],
        ["Message ID"],
        ["Subject"],
        ["Total of Size Attachments"],
        ["Number of Attachments"],
        ["Email Size"],
        ["Type"],
        ["Sub Type"],
        ["Monitored Domain Source"],
        ["Similar Domain"],
        ["Hold Reason"],
        ["Recipients"],
        ["Sender IP"],
        ["Direction"],
        ["Sender Header"],
        ["TLS Version"],
        ["TLS Cipher"],
        ["Spam Info"],
        ["Spam Processing Detail"]
  | extend ['Event Time'] = iff( isempty( ['Event Time']) ,now() , todatetime(unixtime_milliseconds_todatetime( tolong(["Event Time"]) ))  )
  | extend  ['Message ID'] = trim(@"[\<\>]", ['Message ID'] )
  | project 
        ["Time Generated"],
        ["Url Category"],
        ["Scan Results"],
        ["File Name"],
        ["Sha256"],
        ["File Extension"],
        ["Virus Found"],
        ["Sha1"],
        ["Sender Domain"],
        ["Md5"],
        ["Custom Threat Dictionary"],
        ["Items Detected"],
        ["Similar Custom External Domain"],
        ["Tagged External"],
        ["Similar Internal Domain"],
        ["New Domain"],
        ["Internal User Name"],
        ["Mimecast Threat Dictionary"],
        ["Similar Mimecast External Domain"],
        ["Custom Name Match"],
        ["Tagged Malicious"],
        ["Reply Mismatch"],
        ["Aggregate ID"] = coalesce(["Aggregate ID S"], ["Aggregate ID G"]),
        ["Rejection Type"],
        ["Rejection Code"],
        ["Rejection Info"],
        ["Delivered"],
        ["Destination IP"],
        ["Host Name"],
        ["Delivery Attempts"],
        ["TLS Used"],
        ["Delivery Errors"],
        ["Attachments"],
        ["Route"],
        ["Processing ID"],
        ["Account ID"],
        ["Action"],
        ["Event Time"] ,
        ["Sender Envelope"],
        ["Message ID"],
        ["Subject"],
        ["Total of Size Attachments"],
        ["Number of Attachments"],
        ["Email Size"],
        ["Type"],
        ["Sub Type"],
        ["Monitored Domain Source"],
        ["Similar Domain"],
        ["Offset"],
        ["Partition"],
        ["Hold Reason"],
        ["Recipients"],
        ["Sender IP"],
        ["Direction"],
        ["Sender Header"],
        ["TLS Version"],
        ["TLS Cipher"],
        ["Spam Info"],
        ["Spam Processing Detail"]
  };
  MimecastCG_view
