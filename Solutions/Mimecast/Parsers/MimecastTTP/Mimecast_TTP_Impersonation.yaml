id: 50371940-df79-4db6-8bd9-267379ae0e31
Function:
  Title: Parser for Mimecast TTP Impersonation
  Version: "1.0.1"
  LastUpdated: "2025-10-17"
Category: Microsoft Sentinel Parser
FunctionName: MimecastTTPImpersonation
FunctionAlias: MimecastTTPImpersonation
FunctionQuery: |
  let dummy_table = datatable(TimeGenerated: datetime, id: string) [];
  let MimecastTTPImpersonation = view() {
      union isfuzzy=true
          dummy_table,
          Ttp_Impersonation_CL
      | summarize arg_max(TimeGenerated, *) by id
      | extend 
          ["Time Generated"]  = column_ifexists('TimeGenerated', ''),
          ["Type"] = column_ifexists('Type', ''),
          ["Mimecast Event ID"] = 'ttp_impersonation',
          ["Mimecast Event Category"] = 'ttp_impersonation',
          ["Action"] = column_ifexists('action', ''),
          ["Definition"] = column_ifexists('definition', ''),
          ["Event Time"] = column_ifexists('eventTime', ''),
          ["Hits"] = column_ifexists('hits', ''),
          ["ID"] = column_ifexists('id', ''),
          ["Identifiers"] = column_ifexists('identifiers', ''),
          ["Impersonation Results"] = column_ifexists('impersonationResults', ''),
          ["Message ID"] = column_ifexists('messageId', ''),
          ["Recipient Address"] = column_ifexists('recipientAddress', ''),
          ["Sender Address"] = column_ifexists('senderAddress', ''),
          ["Sender IP Address"] = column_ifexists('senderIpAddress', ''),
          ["Subject"] = column_ifexists('subject', ''),
          ["Tagged External"] = column_ifexists('taggedExternal', ''),
          ["Tagged Malicious"] = column_ifexists('taggedMalicious', '')
      | extend ['Event Time'] = iff(isempty(['Event Time']), now(), todatetime((["Event Time"])))
      | project
          ["Time Generated"],
          ["ID"],
          ["Mimecast Event ID"],
          ["Mimecast Event Category"],
          ["Action"],
          ["Definition"],
          ["Event Time"],
          ["Hits"],
          ["Identifiers"],
          ["Impersonation Results"],
          ["Message ID"],
          ["Recipient Address"],
          ["Sender Address"],
          ["Sender IP Address"],
          ["Subject"],
          ["Tagged External"],
          ["Tagged Malicious"],
          ["Type"] 
  };
  MimecastTTPImpersonation