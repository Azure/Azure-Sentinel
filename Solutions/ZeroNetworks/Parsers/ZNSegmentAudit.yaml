id: 4677df99-9bff-4b87-a7b9-575091361d82
Function:
  Title: Parser for ZNSegmentAudit
  Version: '1.0.2'
  LastUpdated: '2025-12-15'
Category: Microsoft Sentinel Parser
FunctionName: ZNSegmentAudit
FunctionAlias: ZNSegmentAudit
FunctionQuery: |
    let AuditTypesTable = datatable(auditType_d: double, AuditType: string) [
        0, "Unspecified",
        1, "Asset is being segmented (network)",
        2, "Asset segmented (network)",
        3, "Asset failed being segmented (network)",
        4, "Asset is being unsegmented (network)",
        5, "Asset unsegmented (network)",
        6, "Asset failed being unsegmented (network)",
        7, "Asset added to learning (network)",
        8, "Asset removed from learning (network)",
        9, "Inbound allow rule created",
        10, "Inbound allow rule deleted",
        11, "Inbound allow rule expired",
        12, "Inbound allow rule edited",
        17, "Inbound MFA policy created",
        18, "Inbound MFA policy edited",
        19, "Inbound MFA policy deleted",
        20, "Inbound JIT rule created",
        21, "Inbound JIT rule deleted",
        22, "Inbound JIT rule expired",
        23, "Inbound JIT rule revived",
        24, "Inbound JIT rule edited",
        25, "API Token created",
        26, "API Token deleted",
        27, "API Token regenerated",
        28, "Asset segmentation date postponed (network)",
        29, "Outbound block rule created",
        30, "Outbound block rule deleted",
        31, "Outbound block rule expired",
        32, "Outbound block rule edited",
        33, "Inbound block rule created",
        34, "Inbound block rule deleted",
        35, "Inbound block rule expired",
        36, "Inbound block rule edited",
        39, "Asset unsegmented (network) (overriding policy)",
        40, "Asset is being unsegmented (network) (overriding policy)",
        41, "Asset removed from learning (network) (overriding policy)",
        42, "Asset is being segmented (network) (policy)",
        43, "Asset segmented (network) (policy)",
        44, "Asset added to learning (network) (policy)",
        45, "Segmentation policy created",
        46, "Segmentation policy deleted",
        47, "Segmentation policy edited",
        48, "Inbound JIT access rejected",
        49, "Inbound JIT fallback rule created",
        50, "Inbound JIT fallback rule deleted",
        51, "Inbound JIT fallback rule expired",
        53, "Outbound allow rule created",
        54, "Outbound allow rule deleted",
        55, "Outbound allow rule expired",
        56, "Outbound allow rule edited",
        58, "Admin portal role changed to admin",
        59, "Admin portal role changed to viewer",
        60, "Admin portal role revoked",
        61, "Outbound JIT rule created",
        62, "Outbound JIT rule deleted",
        63, "Outbound JIT rule expired",
        64, "Outbound MFA policy created",
        65, "Outbound MFA policy deleted",
        66, "Outbound MFA policy edited",
        67, "Outbound JIT access rejected",
        68, "Asset learning is done (network)",
        69, "Asset learning (policy) is done (network)",
        70, "Manual Linux asset created",
        71, "Manual OT/IoT asset created",
        72, "Asset learning extended (network)",
        73, "Admin portal logon",
        74, "Asset manager added",
        75, "Asset manager removed",
        76, "Asset is monitored by Cloud connector",
        77, "Asset is no longer monitored by Cloud connector",
        78, "Asset is monitored by Segment server",
        79, "Asset is back to learning (network)",
        80, "Manual OT/IoT asset edited",
        81, "Admin portal role changed to operator",
        82, "Segment server deployed",
        83, "AI inbound allow rule rejected",
        84, "AI inbound block rule rejected",
        85, "AI outbound allow rule rejected",
        86, "AI outbound block rule rejected",
        87, "AI inbound allow rule approved",
        88, "AI inbound block rule approved",
        89, "AI outbound allow rule approved",
        90, "AI outbound block rule approved",
        91, "AI inbound allow rule approved with changes",
        92, "AI inbound block rule approved with changes",
        93, "AI outbound allow rule approved with changes",
        94, "AI outbound block rule approved with changes",
        95, "Connect region created",
        96, "Connect session created",
        97, "Connect session expired",
        98, "Connect session revoked",
        99, "Connect session logged out",
        100, "User access configuration created",
        101, "User access configuration edited",
        102, "User access configuration deleted",
        103, "Connect server deployed",
        104, "Connect asset created",
        105, "Asset segmentation postponed (network) (pending review rules)",
        106, "Connect region edited",
        107, "Connect server edited",
        108, "Asset is being segmented (identity)",
        109, "Asset segmented (identity)",
        110, "Asset is being unsegmented (identity)",
        111, "Asset unsegmented (identity)",
        112, "Identity rule created",
        113, "Identity rule deleted",
        114, "Identity rule expired",
        115, "Identity rule edited",
        116, "User segmented (identity)",
        117, "User unsegmented (identity)",
        118, "User added to learning (identity)",
        119, "User removed from learning (identity)",
        120, "Asset added to RPC monitoring",
        121, "Asset removed from RPC monitoring",
        122, "User classification changed",
        123, "Connect session extended",
        124, "Asset marked as inactive by repository (deleted)",
        125, "Asset marked as active by repository",
        126, "Asset marked as inactive by user",
        127, "Asset marked as active by user",
        128, "Break glass configuration activated",
        129, "Break glass configuration deactivated",
        130, "Asset marked as inactive by repository (disable)",
        131, "Asset marked as active by repository (enable)",
        132, "Break glass configuration activated (asset)",
        133, "Break glass configuration deactivated (asset)",
        134, "Asset is being segmented (RPC)",
        135, "Asset segmented (RPC)",
        136, "Asset is being unsegmented (RPC)",
        137, "Asset unsegmented (RPC)",
        138, "Rules RPC rule created",
        139, "Rules RPC rule deleted",
        140, "Rules RPC rule expired",
        141, "Rules RPC rule edited",
        142, "Asset was revived but still marked as inactive",
        143, "User learning is done (identity)",
        144, "User is back to learning (identity)",
        145, "Members added to tag group",
        146, "Members removed from tag group",
        147, "Identity MFA policy created",
        148, "Identity MFA policy edited",
        149, "Identity MFA policy deleted",
        150, "Identity JIT rule created",
        151, "Identity JIT rule deleted",
        152, "Identity JIT rule expired",
        153, "Identity JIT rule edited",
        155, "Asset type changed",
        156, "Asset added to learning (RPC)",
        157, "Asset removed from learning (RPC)",
        158, "Asset learning extended (RPC)",
        159, "Asset segmentation date postponed (RPC)",
        160, "Asset learning is done (RPC)",
        161, "Asset is back to learning (RPC)",
        162, "Asset added to environment",
        163, "Asset removed from environment",
        164, "Asset environment updated",
        165, "Asset added to learning (identity)",
        166, "Asset removed from learning (identity)",
        167, "Asset learning extended (identity)",
        168, "Asset segmentation date postponed (identity)",
        169, "Asset learning is done (identity)",
        170, "Asset is back to learning (identity)",
        171, "Enforcing block rules",
        172, "Enforcing block rules due to policy",
        173, "Block rules enforced",
        174, "Removing block rules",
        175, "Group marked as inactive by entity repository",
        176, "Group marked as active by entity repository",
        177, "Cache MFA config created",
        178, "Cache MFA config updated",
        179, "Cache MFA config removed",
        180, "Identity onboarding policy created",
        181, "Identity onboarding policy deleted",
        182, "Identity onboarding policy edited",
        183, "Asset unsegmented (identity) (overriding policy)",
        184, "Asset removed from learning (identity) (overriding policy)",
        185, "Asset is being unsegmented (identity) (overriding policy)",
        186, "Access portal logon",
        187, "Asset OS type changed",
        188, "User marked as inactive by entity repository",
        189, "User marked as active by entity repository",
        190, "Connect server deleted",
        191, "Region deleted",
        192, "External MFA policy created",
        193, "External MFA policy removed",
        194, "External MFA policy edited",
        195, "Switch added",
        196, "Switch edited",
        197, "Switch deleted",
        198, "Asset is being segmented (network)",
        199, "Asset segmented (network)",
        200, "Asset is being unsegmented (network)",
        201, "Asset unsegmented (network)",
        206, "Download portal logon",
        207, "External access portal logon",
        208, "Maintenance window added",
        209, "Maintenance window deleted",
        210, "Maintenance window edited",
        211, "Maintenance window set as default",
        212, "Tag group created",
        213, "Custom user created",
        214, "Custom user deleted",
        215, "User learning extended (identity)",
        216, "Asset restricted outbound enabled",
        217, "Asset restricted outbound disabled",
        218, "Asset restricted outbound changed",
        219, "Asset mirrored",
        220, "Asset quarantined",
        221, "Asset unquarantined",
        222, "Custom user invited",
        223, "Custom user role changed to admin",
        224, "Custom user role changed to viewer",
        225, "Custom user role changed to operator",
        226, "Custom user re-invited",
        227, "Custom user approved invite",
        228, "Custom user rejected invite",
        229, "Inbound AE exclusion deleted",
        230, "Outbound AE exclusion deleted",
        231, "Asset manager permission changed",
        232, "Added switch interfaces to monitor",
        233, "Removed switch interfaces to monitor",
        234, "Attempted to exceed network license limit",
        235, "Network licenses available",
        236, "Attempted to exceed identity license limit",
        237, "Identity licenses available",
        238, "Attempted to exceed RPC license limit",
        239, "RPC licenses available",
        240, "Network anti-tampering detected and handled",
        241, "Identity anti-tampering detected and handled",
        242, "RPC anti-tampering detected and handled",
        243, "User manually marked as inactive",
        244, "User manually marked as active",
        245, "User was revived but still marked as inactive",
        246, "Asset segmentation blocked (identity)",
        247, "Asset segmentation blocked (rpc)",
        248, "Outbound AE exclusion created",
        249, "Inbound AE exclusion created",
        250, "Outbound AE exclusion edited",
        251, "Inbound AE exclusion edited",
        252, "Cluster added",
        253, "Cluster edited",
        254, "Cluster deleted",
        255, "User marked as disabled by entity repository",
        256, "User marked as enabled by entity repository",
        257, "User marked as disabled by entity repository (previously inactive)",
        258, "User marked as inactive by entity repository (previously disabled)",
        259, "User manually marked as inactive (previously disabled)",
        260, "Attempted to exceed connect license limit",
        261, "Connect licenses available",
        262, "Inbound allow OT/IoT rule created",
        263, "Inbound block OT/IoT rule created",
        264, "Outbound allow OT/IoT rule created",
        265, "Outbound block OT/IoT rule created",
        266, "Inbound allow OT/IoT rule deleted",
        267, "Inbound block OT/IoT rule deleted",
        268, "Outbound allow OT/IoT rule deleted",
        269, "Outbound block OT/IoT rule deleted",
        270, "Inbound allow OT/IoT rule edited",
        271, "Inbound block OT/IoT rule edited",
        272, "Outbound allow OT/IoT rule edited",
        273, "Outbound block OT/IoT rule edited",
        274, "Inbound allow OT/IoT rule expired",
        275, "Inbound block OT/IoT rule expired",
        276, "Outbound allow OT/IoT rule expired",
        277, "Outbound block OT/IoT rule expired",
        278, "Group added to Network overriding onboarding policy ",
        279, "Group added to Identity overriding onboarding policy",
        280, "Group removed from Network overriding onboarding policy",
        281, "Group removed from Identity overriding onboarding policy",
        282, "Block rules removed",
        283, "Attempted to exceed external access license limit",
        284, "External access licenses available",
        285, "Asset is monitored by Segment connector",
        286, "Asset is no longer monitored by Segment connector",
        287, "Manual Linux asset edited",
        288, "External OT/IoT asset edited",
        289, "Internal subnets settings updated",
        290, "User quarantined",
        291, "User unquarantined",
        292, "Application group created",
        294, "Members added to application group",
        296, "Members removed from application group",
        297, "Inv switches break glass config edited",
        298, "Switch network break glass activated",
        299, "Switch network break glass deactivated",
        300, "Switch monitoring break glass activated",
        301, "Switch monitoring break glass deactivated",
        302, "IP to name alias added",
        303, "IP to name alias edited",
        304, "IP to name alias removed",
        305, "Network trial started",
        306, "Identity trial started",
        307, "RPC trial started",
        308, "Connect trial started",
        309, "External Access trial started",
        310, "Network rule review - rule optimization updated",
        311, "Deployments cluster created",
        312, "Deployments cluster edited",
        313, "Deployments cluster deleted",
        314, "Assigned deployment server to a cluster",
        315, "Environment group created",
        316, "Environment group deleted",
        317, "Members added to environment group",
        318, "Members removed from environment group",
        319, "Custom group created",
        320, "Custom group deleted",
        321, "Custom group updated",
        322, "Members added to custom group",
        323, "Members removed from custom group"
    ];
    let EnforcementSourceTypeTable = datatable (enforcementSource_d: double, EnforcementSource: string) [
        1, "Reactive Policy",
        2, "Automated",
        3, "Access Portal",
        4, "Admin Portal",
        5, "AI",
        6, "API",
        7, "Setup"
    ];
    let UserRoleTypeTable = datatable (userRole_d: double, UserRole: string) [
        1, "Admin",
        2, "Viewer",
        3, "Regular",
        4, "API - Full Access",
        5, "API - Read Only",
        6, "Self Service",
        7, "CloudConnectorProvisioning",
        8, "JAMF Asset",
        9, "Asset Manager",
        10, "Operator",
        11, "Service Now Token"
    ];
    union isfuzzy=true ZNSegmentAuditNativePoller_CL, ZNSegmentAudit_CL
    | project-away TimeGenerated
    | lookup kind=leftouter AuditTypesTable on auditType_d
    | lookup kind=leftouter EnforcementSourceTypeTable on enforcementSource_d
    | lookup kind=leftouter UserRoleTypeTable on userRole_d
    | extend entity=parse_json(destinationEntitiesList_s)
    | extend EventVendor="Zero Networks",
        EventProduct="Segment Audit",
        AuditTypeId=column_ifexists('auditType_d', ''),
        TimeGenerated=unixtime_milliseconds_todatetime(timestamp_d),
        EnforcementSourceId=column_ifexists('enforcementSource_d', ''),
        UserRoleId=column_ifexists('userRole_d', ''),
        DestinationEntityName = ['entity'][0].name,
        DestinationEntityId = ['entity'][0].id,
        Details=column_ifexists('details_s', ''),
        PerformedById=column_ifexists('performedBy_id_s', ''),
        PerformedByName=column_ifexists('performedBy_name_s', ''),
        PerformedByGuid=column_ifexists('performedBy_id_g', ''),
        ReportedObjectGuid=column_ifexists('reportedObjectId_g', ''),
        ReportedObjectId=column_ifexists('reportedObjectId_s', '')
    | extend Rule=parse_json(Details).rule,
        ReactivePolicy=parse_json(Details).rp
    | project
        TimeGenerated,
        EventVendor,
        EventProduct,
        AuditTypeId,
        AuditType,
        DestinationEntityId,
        DestinationEntityName,
        EnforcementSourceId,
        EnforcementSource,
        PerformedByGuid,
        PerformedById,
        PerformedByName,
        ReportedObjectGuid,
        ReportedObjectId,
        UserRoleId,
        UserRole,
        Rule,
        ReactivePolicy