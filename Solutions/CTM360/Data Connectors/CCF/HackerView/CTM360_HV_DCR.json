{
  "name": "CTM360HackerViewDCR",
  "type": "Microsoft.Insights/dataCollectionRules",
  "apiVersion": "2025-07-01",
  "location": "{{location}}",
  "properties": {
    "description": "Data collection rule for CTM360 HackerView connector with Data Collector API type-suffixed schema",
    "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
    "streamDeclarations": {
      "Custom-HackerViewLog_Azure_1_CL": {
        "columns": [
          {
            "name": "id",
            "type": "string"
          },
          {
            "name": "title",
            "type": "string"
          },
          {
            "name": "severity",
            "type": "string"
          },
          {
            "name": "status",
            "type": "string"
          },
          {
            "name": "first_seen",
            "type": "string"
          },
          {
            "name": "last_seen",
            "type": "string"
          },
          {
            "name": "category",
            "type": "string"
          },
          {
            "name": "description",
            "type": "string"
          },
          {
            "name": "asset_name",
            "type": "string"
          },
          {
            "name": "asset_type",
            "type": "string"
          },
          {
            "name": "port",
            "type": "int"
          },
          {
            "name": "protocol",
            "type": "string"
          },
          {
            "name": "ip_address",
            "type": "string"
          },
          {
            "name": "technology",
            "type": "string"
          },
          {
            "name": "cve",
            "type": "string"
          },
          {
            "name": "cvss_score",
            "type": "real"
          },
          {
            "name": "remediation",
            "type": "string"
          },
          {
            "name": "references",
            "type": "string"
          },
          {
            "name": "tags",
            "type": "string"
          },
          {
            "name": "priority",
            "type": "string"
          },
          {
            "name": "assigned_to",
            "type": "string"
          },
          {
            "name": "notes",
            "type": "string"
          },
          {
            "name": "external_link",
            "type": "string"
          },
          {
            "name": "created_at",
            "type": "string"
          },
          {
            "name": "updated_at",
            "type": "string"
          },
          {
            "name": "raw_payload",
            "type": "dynamic"
          }
        ]
      }
    },
    "destinations": {
      "logAnalytics": [
        {
          "workspaceResourceId": "{{workspaceResourceId}}",
          "name": "CTM360HVWorkspace"
        }
      ]
    },
    "dataFlows": [
      {
        "streams": [
          "Custom-HackerViewLog_Azure_1_CL"
        ],
        "destinations": [
          "CTM360HVWorkspace"
        ],
        "outputStream": "Custom-HackerViewLog_AzureV2_CL",
        "transformKql": "source | extend TimeGenerated = now(), IssueId = columnifexists('id', ''), Title = columnifexists('title', ''), Severity = columnifexists('severity', ''), Status = columnifexists('status', ''), FirstSeen = columnifexists('first_seen', ''), LastSeen = columnifexists('last_seen', ''), Category = columnifexists('category', ''), Description = columnifexists('description', ''), AssetName = columnifexists('asset_name', ''), AssetType = columnifexists('asset_type', ''), Port = toint(columnifexists('port', 0)), Protocol = columnifexists('protocol', ''), IpAddress = columnifexists('ip_address', ''), Technology = columnifexists('technology', ''), Cve = columnifexists('cve', ''), CvssScore = toreal(columnifexists('cvss_score', 0.0)), Remediation = columnifexists('remediation', ''), References = columnifexists('references', ''), Tags = columnifexists('tags', ''), Priority = columnifexists('priority', ''), AssignedTo = columnifexists('assigned_to', ''), Notes = columnifexists('notes', ''), ExternalLink = columnifexists('external_link', ''), CreatedAt = columnifexists('created_at', ''), UpdatedAt = columnifexists('updated_at', ''), RawPayload = todynamic(columnifexists('raw_payload', '{}')) | project TimeGenerated, IssueId, Title, Severity, Status, FirstSeen, LastSeen, Category, Description, AssetName, AssetType, Port, Protocol, IpAddress, Technology, Cve, CvssScore, Remediation, References, Tags, Priority, AssignedTo, Notes, ExternalLink, CreatedAt, UpdatedAt, RawPayload"
      }
    ]
  }
}