{
  "version": "Notebook/1.0",
  "dependsOn": "[resourceId('Microsoft.Web/connections', parameters('ConnectionName'))]",
  "items": [
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Comply",
            "subTarget": "Comply",
            "preText": "Comply",
            "style": "link"
          },
          {
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Patch",
            "subTarget": "Patch",
            "style": "link"
          },
          {
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Discover",
            "subTarget": "Discover",
            "style": "link"
          }
        ]
      },
      "name": "links - 8"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Top mission critical computers with CVSS hits >= 9.0"
            },
            "name": "text - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumComplyVulnerabilities_CL \n| join TaniumMainAsset_CL on Computer_Name_s| where CVSS_Score_s startswith \"9\"\n| extend Host_0_HostName = Computer_Name_s\n| extend Malware_0_Name = CVE_s\n| extend IP_0_Address = IP_Address_s\n| summarize count() by Computer_Name_s | limit 4\n| sort by count_\n",
              "size": 4,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "tiles",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "Computer_Name_s",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "Computer_Name_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "mapSettings": {
                "locInfo": "LatLong",
                "sizeSettings": "count_",
                "sizeAggregation": "Sum",
                "legendMetric": "count_",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "type": "heatmap",
                  "colorAggregation": "Sum",
                  "nodeColorField": "count_",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "name": "query - 2"
          },
          {
            "type": 1,
            "content": {
              "json": "## Top operating systems with CVSS hits >= 9.0"
            },
            "name": "text - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumComplyVulnerabilities_CL \n| join TaniumMainAsset_CL on Computer_Name_s| where CVSS_Score_s startswith \"9\"\n| extend Host_0_HostName = Computer_Name_s\n| extend Malware_0_Name = CVE_s\n| extend IP_0_Address = IP_Address_s\n| summarize count() by Operating_System_Generation_s\n| sort by count_",
              "size": 4,
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "piechart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Operating_System_Generation_s",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "showBorder": false
              }
            },
            "name": "query - 3"
          },
          {
            "type": 1,
            "content": {
              "json": "## Vulnerability distribution by year"
            },
            "name": "text - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumComplyVulnerabilities_CL\n|distinct CVE_Year_s,Computer_Name_s, CVE_s\n|summarize count() by CVE_Year_s\n|render barchart  \n|sort by CVE_Year_s asc",
              "size": 0,
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "query - 3"
          },
          {
            "type": 1,
            "content": {
              "json": "## Vulnerability Distribution by OS"
            },
            "name": "text - 5"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumComplyVulnerabilities_CL\n|distinct CVE_s, Computer_Name_s, Operating_System_Generation_s\n|summarize count() by Operating_System_Generation_s\n|render barchart",
              "size": 0,
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "query - 4"
          },
          {
            "type": 1,
            "content": {
              "json": "## Vulnerability Distribution by Severity"
            },
            "name": "text - 6"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumComplyVulnerabilities_CL\n|distinct CVE_s,Severity_s\n|summarize count() by Severity_s",
              "size": 0,
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "graph",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "Severity_s",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "graphSettings": {
                "type": 2,
                "topContent": {
                  "columnMatch": "Severity_s",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "nodeIdField": "Severity_s",
                "graphOrientation": 3,
                "showOrientationToggles": false,
                "nodeSize": null,
                "staticNodeSize": 100,
                "colorSettings": null,
                "hivesMargin": 5
              },
              "textSettings": {
                "style": "bignumber"
              }
            },
            "name": "query - 7"
          },
          {
            "type": 1,
            "content": {
              "json": "## Compliance Benchmark - Pass Rate"
            },
            "name": "text - 10"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumComplyCompliance_CL | where  Rule_ID_s <> \"\"\n|summarize  Total=count(), Pass=countif(Status_Category_s has \"Pass\"), Fail=countif(Status_Category_s has \"Fail\")\n|extend PassRate=(Pass*1.0/Total)*100\n|project PassRate",
              "size": 1,
              "timeContext": {
                "durationMs": 604800000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "PassRate",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "redBright"
                  }
                },
                "showBorder": false
              }
            },
            "name": "query - 11"
          },
          {
            "type": 1,
            "content": {
              "json": "## Top 10 Benchmark Failures"
            },
            "name": "text - 12"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumComplyCompliance_CL \n|where  Rule_ID_s <> \"\" and Status_Category_s has \"fail\"\n|summarize Count=count() by RuleID=Rule_ID_s\n|top 10 by Count",
              "size": 0,
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "query - 13"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Comply"
      },
      "customWidth": "100",
      "name": "cvss_group",
      "styleSettings": {
        "maxWidth": "100"
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Top mission critical computers with _critical_ patches ready to apply\n"
            },
            "name": "text - 3"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumSentinelApplicablePatches_CL\n| join TaniumSentinelMainAsset_CL on Computer_ID_s\n| join TaniumReporting_CL on Computer_Name_s\n| where Hygiene_Applicable_Patches_by_Year_1_1_0_0_0_0__s contains '\"Severity\": \"Critical\"'\n| where Asset_Criticality_s == \"Critical\"\n| summarize count() by Computer_Name_s\n| sort by count_ | limit 4\n",
              "size": 4,
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "tiles",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "Computer_Name_s",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "name": "query - 3"
          },
          {
            "type": 1,
            "content": {
              "json": "## Top operating systems with _critical_ patches ready to apply"
            },
            "name": "text - 1"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumSentinelApplicablePatches_CL\n| join TaniumSentinelOperatingSystem_CL on Computer_ID_s\n| where Hygiene_Applicable_Patches_by_Year_1_1_0_0_0_0__s contains '\"Severity\": \"Critical\"'\n| summarize count() by Operating_System_Generation_s\n| sort by count_\n",
              "size": 4,
              "timeContext": {
                "durationMs": 604800000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "piechart"
            },
            "name": "query - 0"
          },
          {
            "type": 1,
            "content": {
              "json": "## High Uptimes (Top 10)"
            },
            "name": "text - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumSentinelHighUptime_CL \n|distinct Computer_Name_s,High_Uptime_s \n|extend Uptime=extract(\"[0-9]?[0-9]\",0, High_Uptime_s, typeof(int)) \n|where High_Uptime_s !contains \"N/A\" and High_Uptime_s !contains \"less than\" and Uptime > 30 \n|top 10 by Uptime \n|render barchart",
              "size": 0,
              "timeContext": {
                "durationMs": 604800000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "query - 5"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Patch"
      },
      "customWidth": "50",
      "name": "patch_group",
      "styleSettings": {
        "maxWidth": "50%"
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Unmanaged OS Platform\n"
            },
            "name": "text - 0"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumDiscoverUnmanagedAssets_CL\n|where Os_s <> \"\" \n|distinct MacAddress_s,Os_s\n|summarize count() by Os_s\n",
              "size": 0,
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "piechart"
            },
            "name": "query - 1"
          },
          {
            "type": 1,
            "content": {
              "json": "## Unmanaged Device Type"
            },
            "name": "text - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumDiscoverUnmanagedAssets_CL\n|where MacOrganization_s <> \"\" \n|distinct MacAddress_s,MacOrganization_s\n|summarize count() by MacOrganization_s",
              "size": 0,
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "piechart"
            },
            "name": "query - 3"
          },
          {
            "type": 1,
            "content": {
              "json": "## Unmanaged Open Ports"
            },
            "name": "text - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "TaniumDiscoverUnmanagedAssets_CL\n|where Ports_s <> \"\" \n|distinct MacAddress_s,Ports_s\n|summarize count() by Ports_s\n\n",
              "size": 0,
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "piechart"
            },
            "name": "query - 5"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Discover"
      },
      "name": "discover_group"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/8cacf840-893d-4966-8f82-768f12f19076/resourcegroups/rg_1/providers/microsoft.operationalinsights/workspaces/log-sentinel-test"
  ],
  "fromTemplateId": "sentinel-UserWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}

