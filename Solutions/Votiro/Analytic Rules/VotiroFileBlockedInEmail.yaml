id: 0b8b91de-c63e-4bc2-b5f4-b15d3b379ec9
name: Votiro - File Blocked in Email
description: |
 'If the syslog message includes-Blocked under  -Sanitization result-field  and false under -password protected- field and not null under -from- field  create an alert with the following message:attachment [file name] with the hash [file hash] was blocked in an email that was sent from user [from] to the following recipients [Recipients]  by Votiro due to Policy [policy name], see more detail in the following link [incident url].'
severity: Low
requiredDataConnectors:
  - connectorId: Votiro
    dataTypes:
     - CommonSecurityLog 
queryFrequency: 10m
queryPeriod: 10m
triggerOperator: gt
triggerThreshold: 0
query: let Votiro_view  = view () {
  Votiro_CL
   | where SanitizationResult == "Blocked" and PasswordProtected == "false" and From != "null"
   | extend FileWithEmailDetails = strcat_delim(' ', SrcFileName, 'with the hash', SrcFileSHA256, 'was blocked in an email that was sent from user', From, 'to the following recipients', Recipients)};Votiro_view
incidentConfiguration:
  createIncident: true
eventGroupingSettings:
  aggregationKind: AlertPerResult
alertDetailsOverride: 
   alertDisplayNameFormat: File {{SrcFileName}} with hash {{SrcFileSHA256}} was blocked
   alertDescriptionFormat: Attachment {{FileWithEmailDetails}} by Votiro due to Policy {{PolicyName}}, see more detail in the following link {{IncidentURL}}
   alertTacticsColumnName: SanitizationResult
   alertSeverityColumnName: LogSeverity
version: 1.0.0
kind: Scheduled
