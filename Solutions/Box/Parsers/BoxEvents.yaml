---
  id: 231a04da-9a8d-4cd6-8a20-2da7ded173ba
  Function:
    Title: Parser for BoxEvents
    Version: 2.0.0
    LastUpdated: 2024-09-24
  Category: Microsoft Sentinel Parser
  FunctionName: BoxEvents
  FunctionAlias: BoxEvents
  FunctionQuery: >
    let BoxEventsv1_empty = datatable(
           additional_details_annotation_id_d:double,
             additional_details_group_id_s:string,
             additional_details_group_name_s:string,
             source_user_email_s:string,
             additional_details_comment_id_d:double,
             additional_details_message_s:string,
             additional_details_task_id_d:double,
             additional_details_task_message_s:string,
             additional_details_task_created_by_id_d:double,
             additional_details_task_created_by_login_s:string,
             additional_details_task_assignment_assigned_to_id_d:double,
             additional_details_task_assignment_assigned_to_login_s:string,
             additional_details_task_assignment_status_s:string,
             additional_details_task_assignment_message_s:string,
             source_file_id_s:string,
             source_file_name_s:string,
             source_parent_name_g:guid,
             source_item_type_s:string,
             source_item_id_s:string,
             source_item_name_s:string,
             source_parent_type_s:string,
             source_parent_name_s:string,
             source_parent_id_s:string,
             source_owned_by_type_s:string,
             source_owned_by_id_s:string,
             source_owned_by_name_s:string,
             source_owned_by_login_s:string,
             created_by_type_s:string,
             created_by_id_s:string,
             created_by_name_s:string,
             created_by_login_s:string,
             created_at_t:datetime,
             event_id_g:guid,
             event_type_s:string,
             ip_address_s:string,
             type_s:string,
             additional_details_size_d:double,
             additional_details_ekm_id_g:guid,
             additional_details_version_id_s:string,
             additional_details_service_id_s:string,
             additional_details_service_name_s:string,
             source_type_s:string,
             source_id_s:string,
             source_name_s:string,
             source_login_s:string,
             additional_details_access_token_identifier_s:string,
             additional_details_shared_link_id_s:string,
             source_folder_id_s:string,
             source_folder_name_s:string,
             source_user_id_s:string,
             source_user_name_s:string,
             accessible_by_type_s:string,
             accessible_by_id_s:string,
             accessible_by_name_s:string,
             accessible_by_login_s:string,
             additional_details_type_s:string,
             additional_details_collab_id_s:string,
             additional_details_role_s:string,
             additional_details_is_performed_by_admin_b:bool,
             session_id_s:string
    )[];
    let BoxEventsv1 = union isfuzzy=true BoxEvents_CL, BoxEventsv1_empty
           | extend
           additional_details_annotation_id_s=column_ifexists('additional_details_annotation_id_s', ''),
           additional_details_group_id_s=column_ifexists('additional_details_group_id_s', ''),
           additional_details_group_name_s=column_ifexists('additional_details_group_name_s', ''),
           source_user_email_s=column_ifexists('source_user_email_s', ''),
           additional_details_comment_id_d=column_ifexists('additional_details_comment_id_d', ''),
           additional_details_message_s=column_ifexists('additional_details_message_s', ''),
           additional_details_task_id_d=column_ifexists('additional_details_task_id_d', ''),
           additional_details_task_message_s=column_ifexists('additional_details_task_message_s', ''),
           additional_details_task_created_by_id_d=column_ifexists('additional_details_task_created_by_id_d', ''),
           additional_details_task_created_by_login_s=column_ifexists('additional_details_task_created_by_login_s', ''),
           additional_details_task_assignment_assigned_to_id_d=column_ifexists('additional_details_task_assignment_assigned_to_id_d', ''),
           additional_details_task_assignment_assigned_to_login_s=column_ifexists('additional_details_task_assignment_assigned_to_login_s', ''),
           additional_details_task_assignment_status_s=column_ifexists('additional_details_task_assignment_status_s', ''),
           additional_details_task_assignment_message_s=column_ifexists('additional_details_task_assignment_message_s', ''),
           source_file_id_s=column_ifexists('source_file_id_s', ''),
           source_file_name_s=column_ifexists('source_file_name_s', ''),
           source_parent_name_g=column_ifexists('source_parent_name_g', ''),
           source_item_type_s=column_ifexists('source_item_type_s', ''),
           source_item_id_s=column_ifexists('source_item_id_s', ''),
           source_item_name_s=column_ifexists('source_item_name_s', ''),
           source_parent_type_s=column_ifexists('source_parent_type_s', ''),
           source_parent_name_s=column_ifexists('source_parent_name_s', ''),
           source_parent_id_s=column_ifexists('source_parent_id_s', ''),
           source_owned_by_type_s=column_ifexists('source_owned_by_type_s', ''),
           source_owned_by_id_s=column_ifexists('source_owned_by_id_s', ''),
           source_owned_by_name_s=column_ifexists('source_owned_by_name_s', ''),
           source_owned_by_login_s=column_ifexists('source_owned_by_login_s', ''),
           created_by_type_s=column_ifexists('created_by_type_s', ''),
           created_by_id_s=column_ifexists('created_by_id_s', ''),
           created_by_name_s=column_ifexists('created_by_name_s', ''),
           created_by_login_s=column_ifexists('created_by_login_s', ''),
           created_at_t=column_ifexists('created_at_t', ''),
           event_id_g=column_ifexists('event_id_g', ''),
           event_type_s=column_ifexists('event_type_s', ''),
           ip_address_s=column_ifexists('ip_address_s', ''),
           type_s=column_ifexists('type_s', ''),
           additional_details_size_d=column_ifexists('additional_details_size_d', ''),
           additional_details_ekm_id_g=column_ifexists('additional_details_ekm_id_g', ''),
           additional_details_version_id_s=column_ifexists('additional_details_version_id_s', ''),
           additional_details_service_id_s=column_ifexists('additional_details_service_id_s', ''),
           additional_details_service_name_s=column_ifexists('additional_details_service_name_s', ''),
           source_type_s=column_ifexists('source_type_s', ''),
           source_id_s=column_ifexists('source_id_s', ''),
           source_name_s=column_ifexists('source_name_s', ''),
           source_login_s=column_ifexists('source_login_s', ''),
           additional_details_access_token_identifier_s=column_ifexists('additional_details_access_token_identifier_s', ''),
           additional_details_shared_link_id_s=column_ifexists('additional_details_shared_link_id_s', ''),
           source_folder_id_s=column_ifexists('source_folder_id_s', ''),
           source_folder_name_s=column_ifexists('source_folder_name_s', ''),
           source_user_id_s=column_ifexists('source_user_id_s', ''),
           source_user_name_s=column_ifexists('source_user_name_s', ''),
           accessible_by_type_s=column_ifexists('accessible_by_type_s', ''),
           accessible_by_id_s=column_ifexists('accessible_by_id_s', ''),
           accessible_by_name_s=column_ifexists('accessible_by_name_s', ''),
           accessible_by_login_s=column_ifexists('accessible_by_login_s', ''),
           additional_details_type_s=column_ifexists('additional_details_type_s', ''),
           additional_details_collab_id_s=column_ifexists('additional_details_collab_id_s', ''),
           additional_details_role_s=column_ifexists('additional_details_role_s', ''),
           additional_details_is_performed_by_admin_b=column_ifexists('additional_details_is_performed_by_admin_b', ''),
           session_id_s=column_ifexists('session_id_s', '')
           | project-rename
           AdditionalDetailsAnnotationId=additional_details_annotation_id_s,
           AdditionalDetailsGroupId=additional_details_group_id_s,
           AdditionalDetailsGroupName=additional_details_group_name_s,
           SourceUserEmail=source_user_email_s,
           AdditionalDetailsCommentId=additional_details_comment_id_d,
           AdditionalDetailsMessage=additional_details_message_s,
           AdditionalDetailsTaskId=additional_details_task_id_d,
           AdditionalDetailsTaskMessage=additional_details_task_message_s,
           AdditionalDetailsTaskCreatedById=additional_details_task_created_by_id_d,
           AdditionalDetailsTaskCreatedByLogin=additional_details_task_created_by_login_s,
           AdditionalDetailsTaskAssignmentAssignedToId=additional_details_task_assignment_assigned_to_id_d,
           AdditionalDetailsTaskAssignmentAssignedToLogin=additional_details_task_assignment_assigned_to_login_s,
           AdditionalDetailsTaskAssignmentStatus=additional_details_task_assignment_status_s,
           AdditionalDetailsTaskAssignmentMessage=additional_details_task_assignment_message_s,
           SourceFileId=source_file_id_s,
           SourceFileName=source_file_name_s,
           SourceParentName=source_parent_name_g,
           SourceItemType=source_item_type_s,
           SourceItemId=source_item_id_s,
           SourceItemName=source_item_name_s,
           SourceParentType=source_parent_type_s,
           FileDirectory=source_parent_name_s,
           SourceParentId=source_parent_id_s,
           SourceOwnedByType=source_owned_by_type_s,
           SourceOwnedById=source_owned_by_id_s,
           SourceOwnedByName=source_owned_by_name_s,
           SourceOwnedByLogin=source_owned_by_login_s,
           CreatedByType=created_by_type_s,
           SrcUserSid=created_by_id_s,
           SrcUserName=created_by_name_s,
           SrcUserUpn=created_by_login_s,
           EventEndTime=created_at_t,
           EventId=event_id_g,
           EventType=event_type_s,
           SrcIpAddr=ip_address_s,
           BoxType=type_s,
           FileSize=additional_details_size_d,
           AdditionalDetailsEkmId=additional_details_ekm_id_g,
           AdditionalDetailsVersionId=additional_details_version_id_s,
           AdditionalDetailsServiceId=additional_details_service_id_s,
           AdditionalDetailsServiceName=additional_details_service_name_s,
           SourceType=source_type_s,
           SourceId=source_id_s,
           SourceName=source_name_s,
           SourceLogin=source_login_s,
           AdditionalDetailsAccessTokenIdentifier=additional_details_access_token_identifier_s,
           AdditionalDetailsSharedLinkId=additional_details_shared_link_id_s,
           SourceFolderId=source_folder_id_s,
           SourceFolderName=source_folder_name_s,
           SourceUserId=source_user_id_s,
           SourceUserName=source_user_name_s,
           AccessibleByType=accessible_by_type_s,
           AccessibleById=accessible_by_id_s,
           AccessibleByName=accessible_by_name_s,
           AccessibleByLogin=accessible_by_login_s,
           AdditionalDetailsType=additional_details_type_s,
           AdditionalDetailsCollabId=additional_details_collab_id_s,
           AdditionalDetailsRole=additional_details_role_s,
           AdditionalDetailsIsPerformedByAdmin=additional_details_is_performed_by_admin_b,
           UserSessionId=session_id_s;
         let BoxEventsv2 = union isfuzzy=true BoxEventsv1_empty, BoxEventsV2_CL |
         extend additional_details_annotation_id_s=tostring(additional_details.annotation_id),
       additional_details_group_id_s=tostring(additional_details.group_id),
       additional_details_group_name_s=tostring(additional_details.group_name),
       source_user_email_s=source_user_email,
       additional_details_comment_id_d=todouble(additional_details.comment_id),
       additional_details_message_s=tostring(additional_details.message),
       additional_details_task_id_d=todouble(additional_details.task.id),
       additional_details_task_message_s=tostring(additional_details.task.message),
       additional_details_task_created_by_id_d=todouble(additional_details.task.created_by.id),
       additional_details_task_created_by_login_s=tostring(additional_details.task.created_by.login),
       additional_details_task_assignment_assigned_to_id_d=todouble(additional_details.task_assignment.assigned_to.id),
       additional_details_task_assignment_assigned_to_login_s=tostring(additional_details.task_assignment.assigned_to.login),
       additional_details_task_assignment_status_s=tostring(additional_details.task_assignment.status),
       additional_details_task_assignment_message_s=tostring(additional_details.task_assignment.message),
       source_file_id_s=source_file_id,
       source_file_name_s=source_file_name,
       source_parent_name_g=source_parent_name,
       source_item_type_s=source_item_type,
       source_item_id_s=source_item_id,
       source_item_name_s=source_item_name,
       source_parent_type_s=source_parent_type,
       source_parent_name_s=source_parent_name,
       source_parent_id_s=source_parent_id,
       source_owned_by_type_s=source_owned_by_type,
       source_owned_by_id_s=source_owned_by_id,
       source_owned_by_name_s=source_owned_by_name,
       source_owned_by_login_s=source_owned_by_login,
       created_by_type_s=created_by_type,
       created_by_id_s=created_by_id,
       created_by_name_s=created_by_name,
       created_by_login_s=created_by_login,
       created_at_t=created_at,
       event_id_g=event_id,
       event_type_s=event_type,
       ip_address_s=ip_address,
       type_s=event_type,
       additional_details_size_d=todouble(additional_details.size),
       additional_details_ekm_id_g=toguid(additional_details.ekm_id),
       additional_details_version_id_s=tostring(additional_details.version_id),
       additional_details_service_id_s=tostring(additional_details.service_id),
       additional_details_service_name_s=tostring(additional_details.service_name),
       source_type_s=source_type,
       source_id_s=source_id,
       source_name_s=source_name,
       source_login_s=source_login,
       additional_details_access_token_identifier_s=tostring(additional_details.access_token_identifier),
       additional_details_shared_link_id_s=tostring(additional_details.shared_link_id),
       source_folder_id_s=source_folder_id,
       source_folder_name_s=source_folder_name,
       source_user_id_s=source_user_id,
       source_user_name_s=source_user_name,
       accessible_by_type_s=accessible_by_type,
       accessible_by_id_s=accessible_by_id,
       accessible_by_name_s=accessible_by_name,
       accessible_by_login_s=accessible_by_login,
       additional_details_type_s=tostring(additional_details.type),
       additional_details_collab_id_s=tostring(additional_details.collab_id),
       additional_details_role_s=tostring(additional_details.role),
       additional_details_is_performed_by_admin_b=toboolean(additional_details.is_performed_by_admin),
       session_id_s=session_id
         | project-rename
             AdditionalDetailsAnnotationId=additional_details_annotation_id_s,
           AdditionalDetailsGroupId=additional_details_group_id_s,
           AdditionalDetailsGroupName=additional_details_group_name_s,
           SourceUserEmail=source_user_email_s,
           AdditionalDetailsCommentId=additional_details_comment_id_d,
           AdditionalDetailsMessage=additional_details_message_s,
           AdditionalDetailsTaskId=additional_details_task_id_d,
           AdditionalDetailsTaskMessage=additional_details_task_message_s,
           AdditionalDetailsTaskCreatedById=additional_details_task_created_by_id_d,
           AdditionalDetailsTaskCreatedByLogin=additional_details_task_created_by_login_s,
           AdditionalDetailsTaskAssignmentAssignedToId=additional_details_task_assignment_assigned_to_id_d,
           AdditionalDetailsTaskAssignmentAssignedToLogin=additional_details_task_assignment_assigned_to_login_s,
           AdditionalDetailsTaskAssignmentStatus=additional_details_task_assignment_status_s,
           AdditionalDetailsTaskAssignmentMessage=additional_details_task_assignment_message_s,
           SourceFileId=source_file_id_s,
           SourceFileName=source_file_name_s,
           SourceParentName=source_parent_name_g,
           SourceItemType=source_item_type_s,
           SourceItemId=source_item_id_s,
           SourceItemName=source_item_name_s,
           SourceParentType=source_parent_type_s,
           FileDirectory=source_parent_name_s,
           SourceParentId=source_parent_id_s,
           SourceOwnedByType=source_owned_by_type_s,
           SourceOwnedById=source_owned_by_id_s,
           SourceOwnedByName=source_owned_by_name_s,
           SourceOwnedByLogin=source_owned_by_login_s,
           CreatedByType=created_by_type_s,
           SrcUserSid=created_by_id_s,
           SrcUserName=created_by_name_s,
           SrcUserUpn=created_by_login_s,
           EventEndTime=TimeGenerated,
           EventId=event_id_g,
           EventType=event_type_s,
           SrcIpAddr=ip_address_s,
           BoxType=type_s,
           FileSize=additional_details_size_d,
           AdditionalDetailsEkmId=additional_details_ekm_id_g,
           AdditionalDetailsVersionId=additional_details_version_id_s,
           AdditionalDetailsServiceId=additional_details_service_id_s,
           AdditionalDetailsServiceName=additional_details_service_name_s,
           SourceType=source_type_s,
           SourceId=source_id_s,
           SourceName=source_name_s,
           SourceLogin=source_login_s,
           AdditionalDetailsAccessTokenIdentifier=additional_details_access_token_identifier_s,
           AdditionalDetailsSharedLinkId=additional_details_shared_link_id_s,
           SourceFolderId=source_folder_id_s,
           SourceFolderName=source_folder_name_s,
           SourceUserId=source_user_id_s,
           SourceUserName=source_user_name_s,
           AccessibleByType=accessible_by_type_s,
           AccessibleById=accessible_by_id_s,
           AccessibleByName=accessible_by_name_s,
           AccessibleByLogin=accessible_by_login_s,
           AdditionalDetailsType=additional_details_type_s,
           AdditionalDetailsCollabId=additional_details_collab_id_s,
           AdditionalDetailsRole=additional_details_role_s,
           AdditionalDetailsIsPerformedByAdmin=additional_details_is_performed_by_admin_b,
           UserSessionId=session_id_s
             | project-away created_at, event_category, additional_details*, event_id, event_type, ip_address, source*, created_by*, accessible_by*, created_at_t;
       union isfuzzy=true BoxEventsv2, BoxEventsv1
       | project-reorder EventEndTime, Source*