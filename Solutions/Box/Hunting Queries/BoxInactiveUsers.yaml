id: c0a4169e-c713-484b-95a9-d8f437b52d66
name: Box - Inactive users
description: |
  'Query shows inactive user accounts (users which last login time is more than 30 days).'
severity: Medium
requiredDataConnectors:
  - connectorId: BoxDataConnector
    dataTypes:
      - BoxEvents_CL
tactics:
  - InitialAccess
relevantTechniques:
  - T1078
query: |
  let active_admins = BoxEvents
  | where EventEndTime between (ago(7d) .. ago(1d))
  | where EventType =~ 'LOGIN'
  | summarize makeset(SourceLogin);
  let inactive_admins = BoxEvents
  | where EventEndTime between (ago(30d) .. ago(7d))
  | where EventType =~ 'LOGIN'
  | where SourceLogin !in (active_admins)
  | summarize makeset(SourceLogin);
  BoxEvents
  | where EventEndTime > ago(7d)
  | where EventType =~ 'LOGIN'
  | where SourceLogin !in (active_admins)
  | where SourceLogin in (inactive_admins)
  | summarize LastLoginTime = max(EventEndTime) by SourceLogin
  | project LastLoginTime, SourceLogin
  | extend AccountCustomEntity = SourceLogin
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: AccountCustomEntity
