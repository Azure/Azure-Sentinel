{
  "type": "Microsoft.SecurityInsights/dataConnectors",
  "apiVersion": "2022-12-01-preview",
  "name": "MailRisk-EmailsPoller",
  "location": "{{location}}",
  "kind": "RestApiPoller",
  "properties": {
    "connectorDefinitionName": "SecurePracticeMailRiskConnector",
    "dataType": "MailRiskEventEmails_CL",
    "dcrConfig": {
      "streamName": "Custom-MailRiskEmailsStream",
      "dataCollectionEndpoint": "{{dataCollectionEndpoint}}",
      "dataCollectionRuleImmutableId": "{{dataCollectionRuleImmutableId}}"
    },
    "auth": {
      "type": "Basic",
      "UserName": "[[parameters('apiKey')]]",
      "Password": "[[parameters('apiSecret')]]"
    },
    "request": {
      "apiEndpoint": "https://api.mailrisk.com/v1/events",
      "httpMethod": "GET",
      "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
      "queryWindowInMin": 5,
      "startTimeAttributeName": "from",
      "endTimeAttributeName": "to",
      "rateLimitQPS": 10,
      "retryCount": 3,
      "timeoutInSeconds": 60,
      "headers": {
        "Accept": "application/json",
        "User-Agent": "Sentinel-MailRisk-Connector"
      },
      "queryParameters": {
        "enrich": "true",
        "limit": "100",
        "direction": "asc"
      }
    },
    "response": {
      "eventsJsonPaths": [
        "$.data[*]"
      ],
      "format": "json"
    },
    "paging": {
      "pagingType": "Offset",
      "offsetParaName": "page",
      "pageSizeParamName": "limit",
      "pageSize": 100
    }
  }
}
