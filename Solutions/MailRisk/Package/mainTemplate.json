{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Secure Practice - support@securepractice.co",
    "comments": "Solution template for MailRisk"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@securepractice.co",
    "_email": "[variables('email')]",
    "_solutionName": "MailRisk",
    "_solutionVersion": "3.0.0",
    "solutionId": "securepracticeas1650887373770.microsoft-sentinel-solution-mailrisk",
    "_solutionId": "[variables('solutionId')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "SecurePracticeMailRiskConnector",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "SecurePracticeMailRiskConnectorConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "Secure Practice MailRisk",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "SecurePracticeMailRiskConnector",
                  "title": "Secure Practice MailRisk",
                  "publisher": "Secure Practice",
                  "descriptionMarkdown": "The Secure Practice MailRisk connector allows you to ingest email threat intelligence data from the MailRisk API into Microsoft Sentinel. This connector provides visibility into reported emails, risk assessments, and security events related to email threats.",
                  "graphQueriesTableName": "MailRiskEmails_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total emails received",
                      "legend": "MailRisk Emails",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All MailRisk emails",
                      "query": "{{graphQueriesTableName}}\n| take 10"
                    },
                    {
                      "description": "High risk emails",
                      "query": "{{graphQueriesTableName}}\n| where RiskLevel == 'high'\n| sort by TimeGenerated desc"
                    },
                    {
                      "description": "Emails by category",
                      "query": "{{graphQueriesTableName}}\n| summarize count() by Category"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": false,
                          "action": false
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "API credentials",
                        "description": "Your Secure Practice API key pair is also needed, which are created in the [settings in the admin portal](https://manage.securepractice.co/settings/security). Generate a new key pair with description `Microsoft Sentinel`."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "title": "1. Obtain Secure Practice API Credentials",
                      "description": "Log in to your Secure Practice account and generate an API Key and API Secret if you haven't already."
                    },
                    {
                      "title": "2. Connect to MailRisk API",
                      "description": "Enter your Secure Practice API credentials below. The credentials will be securely stored and used to authenticate API requests.",
                      "instructions": [
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "API Key",
                            "placeholder": "Enter your Secure Practice API Key",
                            "type": "text",
                            "name": "apiKey"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "API Secret",
                            "placeholder": "Enter your Secure Practice API Secret",
                            "type": "password",
                            "name": "apiSecret"
                          }
                        },
                        {
                          "type": "ConnectionToggleButton",
                          "parameters": {
                            "connectLabel": "Connect",
                            "disconnectLabel": "Disconnect"
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Secure Practice",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Secure Practice",
                  "email": "support@securepractice.co",
                  "tier": "Partner",
                  "link": "https://securepractice.co/support"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "MailRisk-Emails-DCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-MailRiskEmailsStream"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend email = todynamic(email) | extend TimeGenerated = coalesce(todatetime(email.assessed_at), todatetime(email.reported_at), todatetime(created_at), now()) | extend EventType = tostring(event) | extend Id = toint(email.id) | extend MessageId = tostring(email.message_id) | extend Subject = tostring(email.subject) | extend FromEmail = tostring(email.from_email) | extend FromName = tostring(email.from_name) | extend ReplyTo = tostring(email.reply_to) | extend OriginatingIP = tostring(email.originating_ip) | extend SizeBytes = toint(email.size_bytes) | extend SpamScore = toint(email.spam_score) | extend SPF = tostring(email.spf) | extend Risk = tostring(email.risk) | extend Category = tostring(email.category) | extend RiskSource = tostring(email.risk_source) | extend ReportedRisk = toint(email.reported_risk) | extend ReporterDomain = tostring(email.reporter_domain) | extend CompanyId = toint(email.company_id) | extend FeedbackRequested = tobool(email.feedback_requested) | extend FeedbackProvided = tobool(email.feedback_provided) | extend ContentStatus = tostring(email.content_status) | extend LinksCount = toint(email.links_count) | extend AttachmentsCount = toint(email.attachments_count) | extend SentAt = todatetime(email.sent_at) | extend ReportedAt = todatetime(email.reported_at) | extend AssessedAt = todatetime(email.assessed_at) | extend CheckedAt = todatetime(email.checked_at) | extend Links = todynamic(email.links) | extend Attachments = todynamic(email.attachments) | extend Headers = todynamic(email.headers) | extend Assessments = todynamic(email.assessments) | project TimeGenerated, EventType, Id, MessageId, Subject, FromEmail, FromName, ReplyTo, OriginatingIP, SizeBytes, SpamScore, SPF, Risk, Category, RiskSource, ReportedRisk, ReporterDomain, CompanyId, FeedbackRequested, FeedbackProvided, ContentStatus, LinksCount, AttachmentsCount, SentAt, ReportedAt, AssessedAt, CheckedAt, Links, Attachments, Headers, Assessments",
                    "outputStream": "Custom-MailRiskEmails_CL"
                  }
                ],
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]"
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "SecurePracticeMailRiskConnector",
          "title": "Secure Practice MailRisk",
          "publisher": "Secure Practice",
          "descriptionMarkdown": "The Secure Practice MailRisk connector allows you to ingest email threat intelligence data from the MailRisk API into Microsoft Sentinel. This connector provides visibility into reported emails, risk assessments, and security events related to email threats.",
          "graphQueriesTableName": "MailRiskEmails_CL",
          "graphQueries": [
            {
              "metricName": "Total emails received",
              "legend": "MailRisk Emails",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "All MailRisk emails",
              "query": "{{graphQueriesTableName}}\n| take 10"
            },
            {
              "description": "High risk emails",
              "query": "{{graphQueriesTableName}}\n| where RiskLevel == 'high'\n| sort by TimeGenerated desc"
            },
            {
              "description": "Emails by category",
              "query": "{{graphQueriesTableName}}\n| summarize count() by Category"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": false,
                  "action": false
                }
              }
            ],
            "customs": [
              {
                "name": "API credentials",
                "description": "Your Secure Practice API key pair is also needed, which are created in the [settings in the admin portal](https://manage.securepractice.co/settings/security). Generate a new key pair with description `Microsoft Sentinel`."
              }
            ]
          },
          "instructionSteps": [
            {
              "title": "1. Obtain Secure Practice API Credentials",
              "description": "Log in to your Secure Practice account and generate an API Key and API Secret if you haven't already."
            },
            {
              "title": "2. Connect to MailRisk API",
              "description": "Enter your Secure Practice API credentials below. The credentials will be securely stored and used to authenticate API requests.",
              "instructions": [
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "API Key",
                    "placeholder": "Enter your Secure Practice API Key",
                    "type": "text",
                    "name": "apiKey"
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "API Secret",
                    "placeholder": "Enter your Secure Practice API Secret",
                    "type": "password",
                    "name": "apiSecret"
                  }
                },
                {
                  "type": "ConnectionToggleButton",
                  "parameters": {
                    "connectLabel": "Connect",
                    "disconnectLabel": "Disconnect"
                  }
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Secure Practice",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Secure Practice",
          "email": "support@securepractice.co",
          "tier": "Partner",
          "link": "https://securepractice.co/support"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "Secure Practice MailRisk",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "connectorDefinitionName": {
              "defaultValue": "Secure Practice MailRisk",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "apiKey": {
              "defaultValue": "apiKey",
              "type": "securestring",
              "minLength": 1
            },
            "apiSecret": {
              "defaultValue": "apiSecret",
              "type": "securestring",
              "minLength": 1
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Secure Practice",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Secure Practice",
                  "email": "support@securepractice.co",
                  "tier": "Partner",
                  "link": "https://securepractice.co/support"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'MailRisk-EmailsPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "SecurePracticeMailRiskConnector",
                "dataType": "MailRiskEmails_CL",
                "dcrConfig": {
                  "streamName": "Custom-MailRiskEmailsStream",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                  "type": "Basic",
                  "UserName": "[[parameters('apiKey')]]",
                  "Password": "[[parameters('apiSecret')]]"
                },
                "request": {
                  "apiEndpoint": "https://api.mailrisk.com/v1/events",
                  "httpMethod": "GET",
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "queryWindowInMin": 5,
                  "startTimeAttributeName": "from",
                  "endTimeAttributeName": "to",
                  "rateLimitQPS": 10,
                  "retryCount": 3,
                  "timeoutInSeconds": 60,
                  "headers": {
                    "Accept": "application/json",
                    "User-Agent": "Sentinel-MailRisk-Connector"
                  },
                  "queryParameters": {
                    "enrich": "true",
                    "limit": "100",
                    "direction": "asc"
                  }
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.data[*]"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "Offset",
                  "offsetParaName": "page",
                  "pageSizeParamName": "limit",
                  "pageSize": 100
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "MailRisk",
        "publisherDisplayName": "Secure Practice",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/MailRisk/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://securepractice.co/\">MailRisk by Secure Practice</a> solution for Microsoft Sentinel enables you to ingest email reported with the MailRisk plugin into Microsoft Sentinel Log Analytics using the Codeless Connector Framework (CCF) with REST API Polling.</p>\n<p><strong>Data Connectors:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/securepractice_logo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "MailRisk",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Secure Practice",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Secure Practice",
          "email": "support@securepractice.co",
          "tier": "Partner",
          "link": "https://securepractice.co/support"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            }
          ]
        },
        "firstPublishDate": "2023-03-16",
        "lastPublishDate": "2025-10-27",
        "providers": [
          "SecurePractice"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
