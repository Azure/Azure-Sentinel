[
  {
    "name": "BigIDDSPMDCR",
    "apiVersion": "2021-09-01-preview",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "{{location}}",
    "properties": {
      "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
      "streamDeclarations": {
        "Custom-BigIDDSPMCatalog_CL": {
          "columns": [
            {
              "name": "dspmCase",
              "type": "dynamic"
            },
            {
              "name": "expand",
              "type": "dynamic"
            },
            {
              "name": "datasource",
              "type": "dynamic"
            }
          ]
        }
      },
      "destinations": {
        "logAnalytics": [
          {
            "workspaceResourceId": "{{workspaceResourceId}}",
            "name": "clv2ws1"
          }
        ]
      },
      "dataFlows": [
        {
          "streams": [
            "Custom-BigIDDSPMCatalog_CL"
          ],
          "destinations": [
            "clv2ws1"
          ],
          "transformKql": "source | extend TimeGenerated = now()",
          "outputStream": "Custom-BigIDDSPMCatalog_CL"
        },
        {
          "streams": [
            "Custom-BigIDDSPMCatalog_CL"
          ],
          "destinations": [
            "clv2ws1"
          ],
          "transformKql": "source | project IngestionTime=now(), TimeGenerated=todatetime(expand.created_date), AssetID=tostring(expand.fullyQualifiedName), Provider='BigID', FeedType='Snapshot', CreatedDateTime=todatetime(expand.created_date), AssetOwner=expand.owner, AssetName=tostring(expand.objectName), AssetPath=tostring(expand.fullObjectName), AssetSize=tostring(expand.sizeInBytes), AssetSource=tostring(expand.type), AssetType=tostring(expand.objectType), Workload=tostring(expand.source), Location=tostring(datasource.location), Classification=tostring(expand.attribute), ClassificationLastScanDateTime=todatetime(expand.last_scanned), LastModifiedDateTime=todatetime(expand.updated_at), Risks=tostring(dspmCase.caseLabel)",
          "outputStream": "Custom-BigIDDSPMAssetStore_CL"
        }
      ]
    }
  }
]
