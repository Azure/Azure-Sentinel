{
    "name": "CloudNSSCASBITSMLogs_ccp",
    "apiVersion": "2021-09-01-preview",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "[parameters('workspace-location')]",
    "properties": {
        "streamDeclarations": {
            "Custom-nss_casbitsm_CL": {
                "columns": [
                    {
                        "name": "sourcetype",
                        "type": "string"
                    },
                    {
                        "name": "TimeGenerated",
                        "type": "datetime"
                    },
                    {
                        "name": "vendor",
                        "type": "string"
                    },
                    {
                        "name": "product",
                        "type": "string"
                    },
                    {
                        "name": "version",
                        "type": "string"
                    },
                    {
                        "name": "Severity",
                        "type": "string"
                    },
                    {
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "name": "deviceEventClassId",
                        "type": "string"
                    },
                    {
                        "name": "act",
                        "type": "string"
                    },
                    {
                        "name": "cs1",
                        "type": "string"
                    },
                    {
                        "name": "cs1Label",
                        "type": "string"
                    },
                    {
                        "name": "start",
                        "type": "string"
                    },
                    {
                        "name": "fsize",
                        "type": "string"
                    },
                    {
                        "name": "cn1",
                        "type": "string"
                    },
                    {
                        "name": "cn1Label",
                        "type": "string"
                    },
                    {
                        "name": "cn2",
                        "type": "string"
                    },
                    {
                        "name": "cn2Label",
                        "type": "string"
                    },
                    {
                        "name": "deviceExternalId",
                        "type": "string"
                    },
                    {
                        "name": "company",
                        "type": "string"
                    },
                    {
                        "name": "component",
                        "type": "string"
                    },
                    {
                        "name": "datacenter",
                        "type": "string"
                    },
                    {
                        "name": "datacentercity",
                        "type": "string"
                    },
                    {
                        "name": "datacentercountry",
                        "type": "string"
                    },
                    {
                        "name": "department",
                        "type": "string"
                    },
                    {
                        "name": "cs2",
                        "type": "string"
                    },
                    {
                        "name": "cs2Label",
                        "type": "string"
                    },
                    {
                        "name": "cs3",
                        "type": "string"
                    },
                    {
                        "name": "cs3Label",
                        "type": "string"
                    },
                    {
                        "name": "cs4",
                        "type": "string"
                    },
                    {
                        "name": "cs4Label",
                        "type": "string"
                    },
                    {
                        "name": "external_collabnames",
                        "type": "string"
                    },
                    {
                        "name": "extownername",
                        "type": "string"
                    },
                    {
                        "name": "fileId",
                        "type": "string"
                    },
                    {
                        "name": "fileModificationTime",
                        "type": "string"
                    },
                    {
                        "name": "fileHash",
                        "type": "string"
                    },
                    {
                        "name": "fname",
                        "type": "string"
                    },
                    {
                        "name": "filePath",
                        "type": "string"
                    },
                    {
                        "name": "fileType",
                        "type": "string"
                    },
                    {
                        "name": "request",
                        "type": "string"
                    },
                    {
                        "name": "dhost",
                        "type": "string"
                    },
                    {
                        "name": "internal_collabnames",
                        "type": "string"
                    },
                    {
                        "name": "flexString1Label",
                        "type": "string"
                    },
                    {
                        "name": "flexString1",
                        "type": "string"
                    },
                    {
                        "name": "flexString2Label",
                        "type": "string"
                    },
                    {
                        "name": "flexString2",
                        "type": "string"
                    },
                    {
                        "name": "objectname",
                        "type": "string"
                    },
                    {
                        "name": "objecttype",
                        "type": "string"
                    },
                    {
                        "name": "odlpdictnames",
                        "type": "string"
                    },
                    {
                        "name": "odlpenginenames",
                        "type": "string"
                    },
                    {
                        "name": "oexternal_collabnames",
                        "type": "string"
                    },
                    {
                        "name": "oextownername",
                        "type": "string"
                    },
                    {
                        "name": "ofile_msg_id",
                        "type": "string"
                    },
                    {
                        "name": "ofullurl",
                        "type": "string"
                    },
                    {
                        "name": "ohostname",
                        "type": "string"
                    },
                    {
                        "name": "ointernal_collabnames",
                        "type": "string"
                    },
                    {
                        "name": "oowner",
                        "type": "string"
                    },
                    {
                        "name": "orulelabel",
                        "type": "string"
                    },
                    {
                        "name": "otenant",
                        "type": "string"
                    },
                    {
                        "name": "suser",
                        "type": "string"
                    },
                    {
                        "name": "cs5",
                        "type": "string"
                    },
                    {
                        "name": "cs5Label",
                        "type": "string"
                    },
                    {
                        "name": "cs6",
                        "type": "string"
                    },
                    {
                        "name": "cs6Label",
                        "type": "string"
                    },
                    {
                        "name": "agentSeverity",
                        "type": "string"
                    },
                    {
                        "name": "tenant",
                        "type": "string"
                    },
                    {
                        "name": "threatname",
                        "type": "string"
                    },
                    {
                        "name": "deviceCustomDate1Label",
                        "type": "string"
                    },
                    {
                        "name": "deviceCustomDate1",
                        "type": "string"
                    },
                    {
                        "name": "dtz",
                        "type": "string"
                    },
                    {
                        "name": "upload_doctypename",
                        "type": "string"
                    }
                ]
            }
        },
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceResourceId": "[variables('workspaceResourceId')]",
                    "name": "clv2ws1"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-nss_casbitsm_CL"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source | project TimeGenerated, DeviceVendor=tostring(vendor), DeviceProduct=tostring(product), DeviceVersion=tostring(version), LogSeverity=tostring(Severity), Activity=tostring(name), DeviceEventClassID=tostring(deviceEventClassId), DeviceAction=tostring(act), DeviceCustomString1=tostring(cs1), DeviceCustomString1Label=tostring(cs1Label), FileSize=toint(fsize), DeviceCustomNumber1=toint(cn1), DeviceCustomNumber1Label=tostring(cn1Label), DeviceCustomNumber2=toint(cn2), DeviceCustomNumber2Label=tostring(cn2Label), deviceExternalId=tostring(deviceExternalId), DeviceCustomString2=tostring(cs2), DeviceCustomString2Label=tostring(cs2Label), DeviceCustomString3=tostring(cs3), DeviceCustomString3Label=tostring(cs3Label), DeviceCustomString4=tostring(cs4), DeviceCustomString4Label=tostring(cs4Label), FileID=tostring(fileId), FileModificationTime=tostring(fileModificationTime), FileHash=tostring(fileHash), FileName=tostring(fname), FilePath=tostring(filePath), FileType=tostring(fileType), DestinationHostName=tostring(dhost), FlexString1Label=tostring(flexString1Label), FlexString1=tostring(flexString1), FlexString2Label=tostring(flexString2Label), FlexString2=tostring(flexString2), SourceUserName=tostring(suser), DeviceCustomString5=tostring(cs5), DeviceCustomString5Label=tostring(cs5Label), DeviceCustomString6=tostring(cs6), DeviceCustomString6Label=tostring(cs6Label), DeviceCustomDate1Label=tostring(deviceCustomDate1Label), DeviceCustomDate1=tostring(deviceCustomDate1), DeviceTimeZone=tostring(dtz), AdditionalExtensions = strcat(\"start=\",start,\";company=\",company,\";component=\",component,\";datacenter=\",datacenter,\";datacentercity=\",datacentercity,\";datacentercountry=\",datacentercountry,\";department=\",department,\";external_collabnames=\",external_collabnames,\";extownername=\",extownername,\";request=\",request,\";internal_collabnames=\",internal_collabnames,\";objectname=\",objectname,\";objecttype=\",objecttype,\";odlpdictnames=\",odlpdictnames,\";odlpenginenames=\",odlpenginenames,\";oexternal_collabnames=\",oexternal_collabnames,\";oextownername=\",oextownername,\";ofile_msg_id=\",ofile_msg_id,\";ofullurl=\",ofullurl,\";ohostname=\",ohostname,\";ointernal_collabnames=\",ointernal_collabnames,\";oowner=\",oowner,\";orulelabel=\",orulelabel,\";otenant=\",otenant,\";agentSeverity=\",agentSeverity,\";tenant=\",tenant,\";threatname=\",threatname,\";upload_doctypename=\",upload_doctypename)",
                "outputStream": "Microsoft-CommonSecurityLog"
            }
        ],
        "dataCollectionEndpointId": "[resourceId(parameters('subscription'), parameters('resourceGroupName'), 'Microsoft.Insights/dataCollectionEndpoints', parameters('workspace'))]"
    }
}
