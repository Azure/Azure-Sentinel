{
    "name": "CloudNSSEndpointDLPLogs_ccp",
    "apiVersion": "2021-09-01-preview",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "[parameters('workspace-location')]",
    "properties": {
        "streamDeclarations": {
            "Custom-nss_endpointdlp_CL": {
                "columns": [
                    {
                        "name": "sourcetype",
                        "type": "string"
                    },
                    {
                        "name": "TimeGenerated",
                        "type": "datetime"
                    },
                    {
                        "name": "vendor",
                        "type": "string"
                    },
                    {
                        "name": "product",
                        "type": "string"
                    },
                    {
                        "name": "version",
                        "type": "string"
                    },
                    {
                        "name": "Severity",
                        "type": "string"
                    },
                    {
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "name": "rt",
                        "type": "string"
                    },
                    {
                        "name": "deviceCustomDate1Label",
                        "type": "string"
                    },
                    {
                        "name": "deviceCustomDate1",
                        "type": "string"
                    },
                    {
                        "name": "deviceCustomDate2Label",
                        "type": "string"
                    },
                    {
                        "name": "deviceCustomDate2",
                        "type": "string"
                    },
                    {
                        "name": "dtz",
                        "type": "string"
                    },
                    {
                        "name": "deviceCustomNumber1Label",
                        "type": "string"
                    },
                    {
                        "name": "cn1",
                        "type": "string"
                    },
                    {
                        "name": "deviceCustomNumber2Label",
                        "type": "string"
                    },
                    {
                        "name": "cn2",
                        "type": "string"
                    },
                    {
                        "name": "deviceCustomNumber3Label",
                        "type": "string"
                    },
                    {
                        "name": "cn3",
                        "type": "string"
                    },
                    {
                        "name": "externalId",
                        "type": "string"
                    },
                    {
                        "name": "scanned_bytes",
                        "type": "string"
                    },
                    {
                        "name": "dlpidentifier",
                        "type": "string"
                    },
                    {
                        "name": "suser",
                        "type": "string"
                    },
                    {
                        "name": "ouser",
                        "type": "string"
                    },
                    {
                        "name": "department",
                        "type": "string"
                    },
                    {
                        "name": "odepartment",
                        "type": "string"
                    },
                    {
                        "name": "devicename",
                        "type": "string"
                    },
                    {
                        "name": "odevicename",
                        "type": "string"
                    },
                    {
                        "name": "devicetype",
                        "type": "string"
                    },
                    {
                        "name": "deviceostype",
                        "type": "string"
                    },
                    {
                        "name": "deviceplatform",
                        "type": "string"
                    },
                    {
                        "name": "deviceosversion",
                        "type": "string"
                    },
                    {
                        "name": "devicemodel",
                        "type": "string"
                    },
                    {
                        "name": "deviceappversion",
                        "type": "string"
                    },
                    {
                        "name": "deviceowner",
                        "type": "string"
                    },
                    {
                        "name": "odeviceowner",
                        "type": "string"
                    },
                    {
                        "name": "dvchost",
                        "type": "string"
                    },
                    {
                        "name": "odevicehostname",
                        "type": "string"
                    },
                    {
                        "name": "datacenter",
                        "type": "string"
                    },
                    {
                        "name": "datacentercity",
                        "type": "string"
                    },
                    {
                        "name": "datacentercountry",
                        "type": "string"
                    },
                    {
                        "name": "dsttype",
                        "type": "string"
                    },
                    {
                        "name": "filedoctype",
                        "type": "string"
                    },
                    {
                        "name": "filedstpath",
                        "type": "string"
                    },
                    {
                        "name": "fileHash",
                        "type": "string"
                    },
                    {
                        "name": "filesha",
                        "type": "string"
                    },
                    {
                        "name": "filePath",
                        "type": "string"
                    },
                    {
                        "name": "filetypecategory",
                        "type": "string"
                    },
                    {
                        "name": "fileType",
                        "type": "string"
                    },
                    {
                        "name": "itemdstname",
                        "type": "string"
                    },
                    {
                        "name": "itemname",
                        "type": "string"
                    },
                    {
                        "name": "itemsrcname",
                        "type": "string"
                    },
                    {
                        "name": "itemtype",
                        "type": "string"
                    },
                    {
                        "name": "ofiledstpath",
                        "type": "string"
                    },
                    {
                        "name": "ofilesrcpath",
                        "type": "string"
                    },
                    {
                        "name": "oitemdstname",
                        "type": "string"
                    },
                    {
                        "name": "oitemname",
                        "type": "string"
                    },
                    {
                        "name": "oitemsrcname",
                        "type": "string"
                    },
                    {
                        "name": "sourceServiceName",
                        "type": "string"
                    },
                    {
                        "name": "act",
                        "type": "string"
                    },
                    {
                        "name": "cs1Label",
                        "type": "string"
                    },
                    {
                        "name": "cs1",
                        "type": "string"
                    },
                    {
                        "name": "cs2Label",
                        "type": "string"
                    },
                    {
                        "name": "cs2",
                        "type": "string"
                    },
                    {
                        "name": "cs3Label",
                        "type": "string"
                    },
                    {
                        "name": "cs3",
                        "type": "string"
                    },
                    {
                        "name": "cs4Label",
                        "type": "string"
                    },
                    {
                        "name": "cs4",
                        "type": "string"
                    },
                    {
                        "name": "cs5Label",
                        "type": "string"
                    },
                    {
                        "name": "cs5",
                        "type": "string"
                    },
                    {
                        "name": "cs6Label",
                        "type": "string"
                    },
                    {
                        "name": "cs6",
                        "type": "string"
                    },
                    {
                        "name": "dlpdictnames",
                        "type": "string"
                    },
                    {
                        "name": "dlpengnames",
                        "type": "string"
                    },
                    {
                        "name": "expectedaction",
                        "type": "string"
                    },
                    {
                        "name": "deviceEventClassId",
                        "type": "string"
                    },
                    {
                        "name": "odlpdictnames",
                        "type": "string"
                    },
                    {
                        "name": "odlpengnames",
                        "type": "string"
                    },
                    {
                        "name": "ootherrulelabels",
                        "type": "string"
                    },
                    {
                        "name": "otherrulelabels",
                        "type": "string"
                    },
                    {
                        "name": "otriggeredrulelabel",
                        "type": "string"
                    },
                    {
                        "name": "agentSeverity",
                        "type": "string"
                    },
                    {
                        "name": "triggeredrulelabel",
                        "type": "string"
                    },
                    {
                        "name": "zdpmode",
                        "type": "string"
                    }
                ]
            }
        },
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceResourceId": "[variables('workspaceResourceId')]",
                    "name": "clv2ws1"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-nss_endpointdlp_CL"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source | project TimeGenerated, DeviceVendor=tostring(vendor), DeviceProduct=tostring(product), DeviceVersion=tostring(version), LogSeverity=tostring(Severity), Activity=tostring(name), ReceiptTime=tostring(rt), DeviceCustomDate1Label=tostring(deviceCustomDate1Label), DeviceCustomDate1=tostring(deviceCustomDate1), DeviceCustomDate2Label=tostring(deviceCustomDate2Label), DeviceCustomDate2=tostring(deviceCustomDate2), DeviceTimeZone=tostring(dtz), DeviceCustomNumber1=toint(cn1), DeviceCustomNumber2=toint(cn2), DeviceCustomNumber3=toint(cn3), ExternalID=toint(externalId), SourceUserName=tostring(suser), DeviceName=tostring(dvchost), FileHash=tostring(fileHash), FilePath=tostring(filePath), FileType=tostring(fileType), SourceServiceName=tostring(sourceServiceName), DeviceAction=tostring(act), DeviceCustomString1Label=tostring(cs1Label), DeviceCustomString1=tostring(cs1), DeviceCustomString2Label=tostring(cs2Label), DeviceCustomString2=tostring(cs2), DeviceCustomString3Label=tostring(cs3Label), DeviceCustomString3=tostring(cs3), DeviceCustomString4Label=tostring(cs4Label), DeviceCustomString4=tostring(cs4), DeviceCustomString5Label=tostring(cs5Label), DeviceCustomString5=tostring(cs5), DeviceCustomString6Label=tostring(cs6Label), DeviceCustomString6=tostring(cs6), DeviceEventClassID=tostring(deviceEventClassId), AdditionalExtensions = strcat(\"deviceCustomNumber1Label=\",deviceCustomNumber1Label,\";deviceCustomNumber2Label=\",deviceCustomNumber2Label,\";deviceCustomNumber3Label=\",deviceCustomNumber3Label,\";scanned_bytes=\",scanned_bytes,\";dlpidentifier=\",dlpidentifier,\";ouser=\",ouser,\";department=\",department,\";odepartment=\",odepartment,\";devicename=\",devicename,\";odevicename=\",odevicename,\";devicetype=\",devicetype,\";deviceostype=\",deviceostype,\";deviceplatform=\",deviceplatform,\";deviceosversion=\",deviceosversion,\";devicemodel=\",devicemodel,\";deviceappversion=\",deviceappversion,\";deviceowner=\",deviceowner,\";odeviceowner=\",odeviceowner,\";odevicehostname=\",odevicehostname,\";datacenter=\",datacenter,\";datacentercity=\",datacentercity,\";datacentercountry=\",datacentercountry,\";dsttype=\",dsttype,\";filedoctype=\",filedoctype,\";filedstpath=\",filedstpath,\";filesha=\",filesha,\";filetypecategory=\",filetypecategory,\";itemdstname=\",itemdstname,\";itemname=\",itemname,\";itemsrcname=\",itemsrcname,\";itemtype=\",itemtype,\";ofiledstpath=\",ofiledstpath,\";ofilesrcpath=\",ofilesrcpath,\";oitemdstname=\",oitemdstname,\";oitemname=\",oitemname,\";oitemsrcname=\",oitemsrcname,\";dlpdictnames=\",dlpdictnames,\";dlpengnames=\",dlpengnames,\";expectedaction=\",expectedaction,\";odlpdictnames=\",odlpdictnames,\";odlpengnames=\",odlpengnames,\";ootherrulelabels=\",ootherrulelabels,\";otherrulelabels=\",otherrulelabels,\";otriggeredrulelabel=\",otriggeredrulelabel,\";agentSeverity=\",agentSeverity,\";triggeredrulelabel=\",triggeredrulelabel,\";zdpmode=\",zdpmode)",
                "outputStream": "Microsoft-CommonSecurityLog"
            }
        ],
        "dataCollectionEndpointId": "[resourceId(parameters('subscription'), parameters('resourceGroupName'), 'Microsoft.Insights/dataCollectionEndpoints', parameters('workspace'))]"
    }
}
