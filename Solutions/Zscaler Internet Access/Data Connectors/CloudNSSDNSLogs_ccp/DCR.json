{
    "name": "CloudNSSDNSLogs_ccp",
    "apiVersion": "2021-09-01-preview",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "[parameters('workspace-location')]",
    "properties": {
        "streamDeclarations": {
            "Custom-nss_dns_CL": {
                "columns": [
                    {
                        "name": "sourcetype",
                        "type": "string"
                    },
                    {
                        "name": "TimeGenerated",
                        "type": "datetime"
                    },
                    {
                        "name": "vendor",
                        "type": "string"
                    },
                    {
                        "name": "product",
                        "type": "string"
                    },
                    {
                        "name": "version",
                        "type": "string"
                    },
                    {
                        "name": "act",
                        "type": "string"
                    },
                    {
                        "name": "Severity",
                        "type": "string"
                    },
                    {
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "name": "deviceEventClassId",
                        "type": "string"
                    },
                    {
                        "name": "suser",
                        "type": "string"
                    },
                    {
                        "name": "cs1",
                        "type": "string"
                    },
                    {
                        "name": "cs1Label",
                        "type": "string"
                    },
                    {
                        "name": "cs2",
                        "type": "string"
                    },
                    {
                        "name": "cs2Label",
                        "type": "string"
                    },
                    {
                        "name": "cs3",
                        "type": "string"
                    },
                    {
                        "name": "cs3Label",
                        "type": "string"
                    },
                    {
                        "name": "cs4",
                        "type": "string"
                    },
                    {
                        "name": "cs4Label",
                        "type": "string"
                    },
                    {
                        "name": "cs5",
                        "type": "string"
                    },
                    {
                        "name": "cs5Label",
                        "type": "string"
                    },
                    {
                        "name": "cs6",
                        "type": "string"
                    },
                    {
                        "name": "cs6Label",
                        "type": "string"
                    },
                    {
                        "name": "cn1",
                        "type": "string"
                    },
                    {
                        "name": "cn1Label",
                        "type": "string"
                    },
                    {
                        "name": "flexString1",
                        "type": "string"
                    },
                    {
                        "name": "flexString1Label",
                        "type": "string"
                    },
                    {
                        "name": "flexString2",
                        "type": "string"
                    },
                    {
                        "name": "flexString2Label",
                        "type": "string"
                    },
                    {
                        "name": "cat",
                        "type": "string"
                    },
                    {
                        "name": "src",
                        "type": "string"
                    },
                    {
                        "name": "dst",
                        "type": "string"
                    },
                    {
                        "name": "dpt",
                        "type": "string"
                    },
                    {
                        "name": "spriv",
                        "type": "string"
                    },
                    {
                        "name": "suid",
                        "type": "string"
                    },
                    {
                        "name": "dvchost",
                        "type": "string"
                    }
                ]
            }
        },
    "destinations": {
        "logAnalytics": [
            {
                "workspaceResourceId": "[variables('workspaceResourceId')]",
                "name": "clv2ws1"
            }
        ]
    },
    "dataFlows": [
        {
        "streams": [
            "Custom-nss_dns_CL"
        ],
        "destinations": [
            "clv2ws1"
        ],
            "transformKql": "source | project TimeGenerated, DeviceVendor=tostring(vendor), DeviceProduct=tostring(product), DeviceVersion=tostring(version), DeviceAction=tostring(act), LogSeverity=tostring(Severity), Activity=tostring(name), DeviceEventClassID=tostring(deviceEventClassId), SourceUserName=tostring(suser), DeviceCustomString1=tostring(cs1), DeviceCustomString1Label=tostring(cs1Label), DeviceCustomString2=tostring(cs2), DeviceCustomString2Label=tostring(cs2Label), DeviceCustomString3=tostring(cs3), DeviceCustomString3Label=tostring(cs3Label), DeviceCustomString4=tostring(cs4), DeviceCustomString4Label=tostring(cs4Label), DeviceCustomString5=tostring(cs5), DeviceCustomString5Label=tostring(cs5Label), DeviceCustomString6=tostring(cs6), DeviceCustomString6Label=tostring(cs6Label), DeviceCustomNumber1=toint(cn1), DeviceCustomNumber1Label=tostring(cn1Label), FlexString1=tostring(flexString1), FlexString1Label=tostring(flexString1Label), FlexString2=tostring(flexString2), FlexString2Label=tostring(flexString2Label), DeviceEventCategory=tostring(cat), SourceIP=tostring(src), DestinationIP=tostring(dst), DestinationPort=toint(dpt), SourceUserPrivileges=tostring(spriv), SourceUserID=tostring(suid), DeviceName=tostring(dvchost)",
            "outputStream": "Microsoft-CommonSecurityLog"
        }
        ],
        "dataCollectionEndpointId": "[resourceId(parameters('subscription'), parameters('resourceGroupName'), 'Microsoft.Insights/dataCollectionEndpoints', parameters('workspace'))]"
    }
}
