{
  "name": "CloudNSSEmailDLPLogs_ccp",
    "apiVersion": "2021-09-01-preview",
  "type": "Microsoft.Insights/dataCollectionRules",
  "location": "[parameters('workspace-location')]",
  "properties": {
    "streamDeclarations": {
      "Custom-nss_emaildlp_CL": {
        "columns": [
          {
            "name": "sourcetype",
            "type": "string"
          },
          {
            "name": "TimeGenerated",
            "type": "datetime"
          },
          {
            "name": "vendor",
            "type": "string"
          },
          {
            "name": "product",
            "type": "string"
          },
          {
            "name": "version",
            "type": "string"
          },
          {
            "name": "Severity",
            "type": "string"
          },
          {
            "name": "act",
            "type": "string"
          },
          {
            "name": "deviceEventClassId",
            "type": "string"
          },
          {
            "name": "app",
            "type": "string"
          },
          {
            "name": "cn1",
            "type": "string"
          },
          {
            "name": "cn1Label",
            "type": "string"
          },
          {
            "name": "cs1",
            "type": "string"
          },
          {
            "name": "cs1Label",
            "type": "string"
          },
          {
            "name": "cs2",
            "type": "string"
          },
          {
            "name": "cs2Label",
            "type": "string"
          },
          {
            "name": "cs3",
            "type": "string"
          },
          {
            "name": "cs3Label",
            "type": "string"
          },
          {
            "name": "cs4",
            "type": "string"
          },
          {
            "name": "cs4Label",
            "type": "string"
          },
          {
            "name": "cs5",
            "type": "string"
          },
          {
            "name": "cs5Label",
            "type": "string"
          },
          {
            "name": "cs6",
            "type": "string"
          },
          {
            "name": "cs6Label",
            "type": "string"
          },
          {
            "name": "suser",
            "type": "string"
          },
          {
            "name": "username",
            "type": "string"
          },
          {
            "name": "extusername",
            "type": "string"
          },
          {
            "name": "sender",
            "type": "string"
          },
          {
            "name": "flexString1",
            "type": "string"
          },
          {
            "name": "flexString1Label",
            "type": "string"
          },
          {
            "name": "flexString2",
            "type": "string"
          },
          {
            "name": "flexString2Label",
            "type": "string"
          },
          {
            "name": "datacenter",
            "type": "string"
          },
          {
            "name": "datacentercity",
            "type": "string"
          },
          {
            "name": "datacentercountry",
            "type": "string"
          },
          {
            "name": "company",
            "type": "string"
          },
          {
            "name": "departmentname",
            "type": "string"
          },
          {
            "name": "tenant",
            "type": "string"
          },
          {
            "name": "msgid",
            "type": "string"
          },
          {
            "name": "ac_md5s",
            "type": "string"
          },
          {
            "name": "ac_sizes",
            "type": "string"
          },
          {
            "name": "ac_filetypes",
            "type": "string"
          },
          {
            "name": "ac_doctypes",
            "type": "string"
          },
          {
            "name": "fname",
            "type": "string"
          },
          {
            "name": "trigg_rcpts",
            "type": "string"
          },
          {
            "name": "other_rcpts",
            "type": "string"
          },
          {
            "name": "deviceExternalId",
            "type": "string"
          },
          {
            "name": "Name",
            "type": "string"
          },
          {
            "name": "dlpidentifier",
            "type": "string"
          }
        ]
      }
    },
    "destinations": {
      "logAnalytics": [
        {
          "workspaceResourceId": "[variables('workspaceResourceId')]",
          "name": "clv2ws1"
        }
      ]
    },
    "dataFlows": [
      {
        "streams": [
          "Custom-nss_emaildlp_CL"
        ],
        "destinations": [
          "clv2ws1"
        ],
        "transformKql": "source | project TimeGenerated, DeviceVendor=tostring(vendor), DeviceProduct=tostring(product), DeviceVersion=tostring(version), LogSeverity=tostring(Severity), DeviceAction=tostring(act), DeviceEventClassID=tostring(deviceEventClassId), ApplicationProtocol=tostring(app), FieldDeviceCustomNumber1=tolong(cn1), DeviceCustomNumber1Label=tostring(cn1Label), DeviceCustomString1=tostring(cs1), DeviceCustomString1Label=tostring(cs1Label), DeviceCustomString2=tostring(cs2), DeviceCustomString2Label=tostring(cs2Label), DeviceCustomString3=tostring(cs3), DeviceCustomString3Label=tostring(cs3Label), DeviceCustomString4=tostring(cs4), DeviceCustomString4Label=tostring(cs4Label), DeviceCustomString5=tostring(cs5), DeviceCustomString5Label=tostring(cs5Label), DeviceCustomString6=tostring(cs6), DeviceCustomString6Label=tostring(cs6Label), SourceUserName=tostring(suser), FlexString1=tostring(flexString1), FlexString1Label=tostring(flexString1Label), FlexString2=tostring(flexString2), FlexString2Label=tostring(flexString2Label), FileName=tostring(fname), DeviceExternalID=tostring(deviceExternalId), Activity=tostring(Name), AdditionalExtensions = strcat(\"username=\",username,\";extusername=\",extusername,\";sender=\",sender,\";datacenter=\",datacenter,\";datacentercity=\",datacentercity,\";datacentercountry=\",datacentercountry,\";company=\",company,\";departmentname=\",departmentname,\";tenant=\",tenant,\";msgid=\",msgid,\";ac_md5s=\",ac_md5s,\";ac_sizes=\",ac_sizes,\";ac_filetypes=\",ac_filetypes,\";ac_doctypes=\",ac_doctypes,\";trigg_rcpts=\",trigg_rcpts,\";other_rcpts=\",other_rcpts,\";dlpidentifier=\",dlpidentifier)",
        "outputStream": "Microsoft-CommonSecurityLog"
      }
    ],
    "dataCollectionEndpointId": "[resourceId(parameters('subscription'), parameters('resourceGroupName'), 'Microsoft.Insights/dataCollectionEndpoints', parameters('workspace'))]"
  }
}
