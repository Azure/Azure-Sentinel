{
    "name": "CloudNSSFWLogs_ccp",
    "apiVersion": "2021-09-01-preview",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "[parameters('workspace-location')]",
    "properties": {
        "streamDeclarations": {
            "Custom-nss_fw_CL": {
        "columns": [
	{
	  "name": "sourcetype",
	  "type": "string"
	},
	{
	  "name": "TimeGenerated",
	  "type": "datetime"
	},
	{
	  "name": "vendor",
	  "type": "string"
	},
	{
	  "name": "product",
	  "type": "string"
	},
	{
	  "name": "version",
	  "type": "string"
	},
	{
	  "name": "Severity",
	  "type": "string"
	},
	{
	  "name": "name",
	  "type": "string"
	},
	{
	  "name": "deviceEventClassId",
	  "type": "string"
	},
	{
	  "name": "act",
	  "type": "string"
	},
	{
	  "name": "suser",
	  "type": "string"
	},
	{
	  "name": "src",
	  "type": "string"
	},
	{
	  "name": "spt",
	  "type": "string"
	},
	{
	  "name": "dst",
	  "type": "string"
	},
	{
	  "name": "dpt",
	  "type": "string"
	},
	{
	  "name": "deviceTranslatedAddress",
	  "type": "string"
	},
	{
	  "name": "deviceTranslatedPort",
	  "type": "string"
	},
	{
	  "name": "destinationTranslatedAddress",
	  "type": "string"
	},
	{
	  "name": "destinationTranslatedPort",
	  "type": "string"
	},
	{
	  "name": "sourceTranslatedAddress",
	  "type": "string"
	},
	{
	  "name": "sourceTranslatedPort",
	  "type": "string"
	},
	{
	  "name": "proto",
	  "type": "string"
	},
	{
	  "name": "tunnelType",
	  "type": "string"
	},
	{
	  "name": "dnat",
	  "type": "string"
	},
	{
	  "name": "stateful",
	  "type": "string"
	},
	{
	  "name": "spriv",
	  "type": "string"
	},
	{
	  "name": "reason",
	  "type": "string"
	},
	{
	  "name": "in_bytes",
	  "type": "string"
	},
	{
	  "name": "out_bytes",
	  "type": "string"
	},
	{
	  "name": "deviceDirection",
	  "type": "string"
	},
	{
	  "name": "cs1",
	  "type": "string"
	},
	{
	  "name": "cs1Label",
	  "type": "string"
	},
	{
	  "name": "cs2",
	  "type": "string"
	},
	{
	  "name": "cs2Label",
	  "type": "string"
	},
	{
	  "name": "cs3",
	  "type": "string"
	},
	{
	  "name": "cs3Label",
	  "type": "string"
	},
	{
	  "name": "cs4",
	  "type": "string"
	},
	{
	  "name": "cs4Label",
	  "type": "string"
	},
	{
	  "name": "cs5",
	  "type": "string"
	},
	{
	  "name": "cs5Label",
	  "type": "string"
	},
	{
	  "name": "cs6",
	  "type": "string"
	},
	{
	  "name": "cs6label",
	  "type": "string"
	},
	{
	  "name": "cn1",
	  "type": "string"
	},
	{
	  "name": "cn1Label",
	  "type": "string"
	},
	{
	  "name": "cn2",
	  "type": "string"
	},
	{
	  "name": "cn2Label",
	  "type": "string"
	},
	{
	  "name": "flexString1Label",
	  "type": "string"
	},
	{
	  "name": "flexString1",
	  "type": "string"
	},
	{
	  "name": "destCountry",
	  "type": "string"
	},
	{
	  "name": "avgduration",
	  "type": "string"
	},
	{
	  "name": "epochtime",
	  "type": "string"
	},
	{
	  "name": "cdfqdn",
	  "type": "string"
	},
	{
	  "name": "srcip_country",
	  "type": "string"
	},
	{
	  "name": "cn3Label",
	  "type": "string"
	},
	{
	  "name": "cn3",
	  "type": "string"
	},
	{
	  "name": "flexString2Label",
	  "type": "string"
	},
	{
	  "name": "flexString2",
	  "type": "string"
	},
	{
	  "name": "ipsrulelabel",
	  "type": "string"
	},
	{
	  "name": "ips_custom_signature",
	  "type": "string"
	},
	{
	  "name": "duration",
	  "type": "string"
	},
	{
	  "name": "dnatrulelabel",
	  "type": "string"
	},
	{
	  "name": "recordid",
	  "type": "string"
	},
	{
	  "name": "pcapid",
	  "type": "string"
	},
	{
	  "name": "eedone",
	  "type": "string"
	},
	{
	  "name": "shost",
	  "type": "string"
	},
	{
	  "name": "devicemodel",
	  "type": "string"
	},
	{
	  "name": "devicename",
	  "type": "string"
	},
	{
	  "name": "deviceostype",
	  "type": "string"
	},
	{
	  "name": "deviceosversion",
	  "type": "string"
	},
	{
	  "name": "deviceowner",
	  "type": "string"
	},
	{
	  "name": "deviceappversion",
	  "type": "string"
	},
	{
	  "name": "deviceExternalId",
	  "type": "string"
	},
	{
	  "name": "ztunnelversion",
	  "type": "string"
	},
	{
	  "name": "bypassed_session",
	  "type": "string"
	},
	{
	  "name": "bypass_etime",
	  "type": "string"
	},
	{
	  "name": "flow_type",
	  "type": "string"
	},
	{
	  "name": "datacenter",
	  "type": "string"
	},
	{
	  "name": "datacentercity",
	  "type": "string"
	},
	{
	  "name": "datacentercountry",
	  "type": "string"
	},
	{
	  "name": "rdr_rulename",
	  "type": "string"
	},
	{
	  "name": "zpa_app_seg_name",
	  "type": "string"
	}
      ] 
    }
  },
    "destinations": {
        "logAnalytics": [
            {
                "workspaceResourceId": "[variables('workspaceResourceId')]",
                "name": "clv2ws1"
            }
        ]
    },
    "dataFlows": [
        {
        "streams": [
            "Custom-nss_fw_CL"
        ],
        "destinations": [
            "clv2ws1"
        ],
            "transformKql": "source | project TimeGenerated, DeviceVendor=tostring(vendor), DeviceProduct=tostring(product), DeviceVersion=tostring(version), LogSeverity=tostring(Severity), Activity=tostring(name), DeviceEventClassID=tostring(deviceEventClassId), DeviceAction=tostring(act), SourceUserName=tostring(suser), SourceIP=tostring(src), SourcePort=toint(spt), DestinationIP=tostring(dst), DestinationPort=toint(dpt), DeviceTranslatedAddress=tostring(deviceTranslatedAddress), DestinationTranslatedAddress=tostring(destinationTranslatedAddress), DestinationTranslatedPort=toint(destinationTranslatedPort), SourceTranslatedAddress=tostring(sourceTranslatedAddress), SourceTranslatedPort=toint(sourceTranslatedPort), Protocol=tostring(proto), SourceUserPrivileges=tostring(spriv), Reason=tostring(reason), ReceivedBytes=tolong(in_bytes), SentBytes=tolong(out_bytes), CommunicationDirection=tostring(deviceDirection), DeviceCustomString1=tostring(cs1), DeviceCustomString1Label=tostring(cs1Label), DeviceCustomString2=tostring(cs2), DeviceCustomString2Label=tostring(cs2Label), DeviceCustomString3=tostring(cs3), DeviceCustomString3Label=tostring(cs3Label), DeviceCustomString4=tostring(cs4), DeviceCustomString4Label=tostring(cs4Label), DeviceCustomString5=tostring(cs5), DeviceCustomString5Label=tostring(cs5Label), DeviceCustomString6=tostring(cs6), DeviceCustomNumber1=toint(cn1), DeviceCustomNumber1Label=tostring(cn1Label), DeviceCustomNumber2=toint(cn2), DeviceCustomNumber2Label=tostring(cn2Label), FlexString1Label=tostring(flexString1Label), FlexString1=tostring(flexString1), DeviceCustomNumber3Label=tostring(cn3Label), DeviceCustomNumber3=toint(cn3), FlexString2Label=tostring(flexString2Label), FlexString2=tostring(flexString2), SourceHostName=tostring(shost), deviceExternalId=tostring(deviceExternalId), AdditionalExtensions = strcat(\"deviceTranslatedPort=\",deviceTranslatedPort,\";tunnelType=\",tunnelType,\";dnat=\",dnat,\";stateful=\",stateful,\";cs6label=\",cs6label,\";destCountry=\",destCountry,\";avgduration=\",avgduration,\";epochtime=\",epochtime,\";cdfqdn=\",cdfqdn,\";srcip_country=\",srcip_country,\";ipsrulelabel=\",ipsrulelabel,\";ips_custom_signature=\",ips_custom_signature,\";duration=\",duration,\";dnatrulelabel=\",dnatrulelabel,\";recordid=\",recordid,\";pcapid=\",pcapid,\";eedone=\",eedone,\";devicemodel=\",devicemodel,\";devicename=\",devicename,\";deviceostype=\",deviceostype,\";deviceosversion=\",deviceosversion,\";deviceowner=\",deviceowner,\";deviceappversion=\",deviceappversion,\";ztunnelversion=\",ztunnelversion,\";bypassed_session=\",bypassed_session,\";bypass_etime=\",bypass_etime,\";flow_type=\",flow_type,\";datacenter=\",datacenter,\";datacentercity=\",datacentercity,\";datacentercountry=\",datacentercountry,\";rdr_rulename=\",rdr_rulename,\";zpa_app_seg_name=\",zpa_app_seg_name)",
            "outputStream": "Microsoft-CommonSecurityLog"
        }  
        ],
        "dataCollectionEndpointId": "[resourceId(parameters('subscription'), parameters('resourceGroupName'), 'Microsoft.Insights/dataCollectionEndpoints', parameters('workspace'))]"
    }
}

