{
  "name": "CrowdStrikeAPIConnector",
  "apiVersion": "2024-09-01",
  "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
  "location": "[parameters('workspace-location')]",
  "kind": "Customizable",
  "properties": {
    "connectorUiConfig": {
      "id": "CrowdStrikeAPIConnector",
      "title": "CrowdStrike API Data Connector (via Codeless Connector Framework)",
      "publisher": "Microsoft",
      "descriptionMarkdown": "The [CrowdStrike Data Connector](https://www.crowdstrike.com/) allows ingesting logs from the CrowdStrike API into Microsoft Sentinel. This connector provides the capability to ingest CrowdStrike [Alerts](https://falcon.crowdstrike.com/documentation/84/detection-and-prevention-policies-apis#get-alerts), [Detections](https://falcon.crowdstrike.com/documentation/84/detection-and-prevention-policies-apis#get-detections), [Hosts](https://falcon.crowdstrike.com/documentation/84/host-and-host-group-management-apis#get-hosts), [Cases](https://falcon.crowdstrike.com/documentation/84/cases-apis#get-cases), and [Vulnerabilities](https://falcon.crowdstrike.com/documentation/84/spotlight-apis#get-vulnerabilities) into Microsoft Sentinel. This connector is built on the Microsoft Sentinel Codeless Connector Platform and uses the CrowdStrike API to fetch logs. It supports DCR-based ingestion time transformations so that queries can run more efficiently. Refer to [CrowdStrike API documentation](https://falcon.crowdstrike.com/documentation/page/a2a7fc0e/crowdstrike-oauth2-based-apis) for more information.",
      "graphQueriesTableName": "CrowdStrikeAlerts",
      "graphQueries": [
        {
          "metricName": "Total Alert logs received",
          "legend": "CrowdStrike Alert Logs",
          "baseQuery": "{{graphQueriesTableName}}"
        },
        {
          "metricName": "Total Cases logs received",
          "legend": "CrowdStrike Case Logs",
          "baseQuery": "CrowdStrikeCases"
        },
        {
          "metricName": "Total Detection logs received",
          "legend": "CrowdStrike Detection Logs",
          "baseQuery": "CrowdStrikeDetections"
        },
        {
          "metricName": "Total Host logs received",
          "legend": "CrowdStrike Host Logs",
          "baseQuery": "CrowdStrikeHosts"
        },
        {
          "metricName": "Total Vulnerability logs received",
          "legend": "CrowdStrike Vulnerability Logs",
          "baseQuery": "CrowdStrikeVulnerabilities"
        }
      ],
      "sampleQueries": [
        {
          "description": "Get sample of CrowdStrike Alert logs",
          "query": "{{graphQueriesTableName}}\n | take 10"
        },
        {
          "description": "Get sample of CrowdStrike Case logs",
          "query": "CrowdStrikeCases\n | take 10"
        },
        {
          "description": "Get sample of CrowdStrike Detection logs",
          "query": "CrowdStrikeDetections\n | take 10"
        },
        {
          "description": "Get sample of CrowdStrike Host logs",
          "query": "CrowdStrikeHosts\n | take 10"
        },
        {
          "description": "Get sample of CrowdStrike Vulnerability logs",
          "query": "CrowdStrikeVulnerabilities\n | take 10"
        }
      ],
      "dataTypes": [
        {
          "name": "CrowdStrikeAlerts",
          "lastDataReceivedQuery": "CrowdStrikeAlerts\n| where TimeGenerated > ago(12h)\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
        },
        {
          "name": "CrowdStrikeCases",
          "lastDataReceivedQuery": "CrowdStrikeCases\n| where TimeGenerated > ago(12h)\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
        },
        {
          "name": "CrowdStrikeDetections",
          "lastDataReceivedQuery": "CrowdStrikeDetections\n| where TimeGenerated > ago(12h)\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
        },
        {
          "name": "CrowdStrikeHosts",
          "lastDataReceivedQuery": "CrowdStrikeHosts\n| where TimeGenerated > ago(12h)\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
        },
        {
          "name": "CrowdStrikeVulnerabilities",
          "lastDataReceivedQuery": "CrowdStrikeVulnerabilities\n| where TimeGenerated > ago(12h)\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
        }
      ],
      "connectivityCriteria": [
        {
          "type": "HasDataConnectors"
        }
      ],
      "availability": {
        "isPreview": true,
        "status": 1
      },
      "permissions": {
        "resourceProvider": [
          {
            "provider": "Microsoft.OperationalInsights/workspaces",
            "permissionsDisplayText": "Read and Write permissions are required.",
            "providerDisplayName": "Workspace",
            "scope": "Workspace",
            "requiredPermissions": {
              "write": true,
              "read": true,
              "delete": true,
              "action": false
            }
          }
        ],
        "customs": [
          {
            "name": "Crowdstrike OAuth2 API Client and Scopes",
            "description": "**Alerts**, **API Integrations**, **App Logs**, **Cases**, **Correlation Rules**, **Detections**, **Hosts**, **Assets**, **Incidents**, **Quarantined Files**, **Vulnerabilities** are required for REST API. [See the documentation to learn more about API](https://falcon.us-2.crowdstrike.com/documentation/page/a2a7fc0e/crowdstrike-oauth2-based-apis)."
          }
        ]
      },
      "instructionSteps": [
        {
          "title": "Connect CrowdStrike to Microsoft Sentinel",
          "instructions": [
            {
              "type": "InfoMessage",
              "parameters": {
                "text": "**Important Notice:** The Incidents API is fully decommissioned. Use the new Cases data type instead.",
                "visible": true,
                "inline": true
              }
            },
            {
              "type": "Markdown",
              "parameters": {
                "content": "To gather data from CrowdStrike, you need to provide the following resources"
              }
            },
            {
              "type": "Markdown",
              "parameters": {
                "content": "**1. Base API URL** - To gather data from CrowdStrike, you'll need the Base API URL."
              }
            },
            {
              "type": "Markdown",
              "parameters": {
                "content": "**2. Client ID** - To gather data from CrowdStrike, you'll need the Client ID."
              }
            },
            {
              "type": "Markdown",
              "parameters": {
                "content": "**3. Client Secret** - To gather data from CrowdStrike, you'll need the Client Secret."
              }
            },
            {
              "type": "Markdown",
              "parameters": {
                "content": "For detailed instructions on retrieving the Base API URL, Client ID, and Client Secret, please refer to the [Connector Tutorial](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/CrowdStrike%20Falcon%20Endpoint%20Protection/Data%20Connectors/CrowdStrikeAPI_ccp/README.md)."
              }
            },
            {
              "type": "DataConnectorsGrid",
              "parameters": {
                "mapping": [
                  {
                    "columnName": "Data Type",
                    "columnValue": "properties.dataType"
                  }
                ],
                "menuItems": [
                  "DeleteConnector"
                ]
              }
            },
            {
              "type": "ContextPane",
              "parameters": {
                "isPrimary": true,
                "label": "Add Connection",
                "title": "Configure CrowdStrike API Connection",
                "subtitle": "Connect to CrowdStrike to ingest security data",
                "contextPaneType": "DataConnectorsContextPane",
                "instructionSteps": [
                  {
                    "instructions": [
                      {
                        "type": "Markdown",
                        "parameters": {
                          "content": "#### 1. Retrieve API URL\nLog in to your CrowdStrike Console and navigate to the API section to copy your Base API URL."
                        }
                      },
                      {
                        "type": "Markdown",
                        "parameters": {
                          "content": "#### 2. Retrieve Client Credentials\nObtain your Client ID and Client Secret from the API credentials section in your CrowdStrike account."
                        }
                      },
                      {
                        "type": "Textbox",
                        "parameters": {
                          "label": "Base API URL",
                          "placeholder": "https://api.us-2.crowdstrike.com",
                          "type": "text",
                          "name": "apiUrl",
                          "validations": {
                            "required": true
                          }
                        }
                      },
                      {
                        "type": "Textbox",
                        "parameters": {
                          "label": "Client ID",
                          "placeholder": "Your Client ID",
                          "type": "text",
                          "name": "clientId",
                          "validations": {
                            "required": true
                          }
                        }
                      },
                      {
                        "type": "Textbox",
                        "parameters": {
                          "label": "Client Secret",
                          "placeholder": "Your Client Secret",
                          "type": "password",
                          "name": "clientSecret",
                          "validations": {
                            "required": true
                          }
                        }
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      ],
      "isConnectivityCriteriasMatchSome": false
    }
  }
}
