{
    "name": "CortexXdrDCR",
    "apiVersion": "2021-09-01-preview",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "[parameters('workspace-location')]",
    "kind": null,
    "properties": {
        "streamDeclarations": {
            "Custom-CortexXdrStreamIncidents": {
                "columns": [
                    {
                        "name": "incident_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "incident_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "creation_time",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "modification_time",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "detection_time",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "status",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "severity",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "description",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "assigned_user_mail",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "assigned_user_pretty_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "alert_count",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "low_severity_alert_count",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "med_severity_alert_count",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "high_severity_alert_count",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "critical_severity_alert_count",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "user_count",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "host_count",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "notes",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "resolve_comment",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "resolved_timestamp",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "manual_severity",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "manual_description",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "xdr_url",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "starred",
                        "type": "boolean",
                        "description": ""
                    },
                    {
                        "name": "hosts",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "users",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "incident_sources",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "rule_based_score",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "manual_score",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "wildfire_hits",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "alerts_grouping_status",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "mitre_tactics_ids_and_names",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "mitre_techniques_ids_and_names",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "alert_categories",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "original_tags",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "tags",
                        "type": "dynamic",
                        "description": ""
                    }
                ]
            },
            "Custom-CortexXdrStreamManagement": {
                "columns": [
                    {
                        "name": "AUDIT_ID",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_OWNER_NAME",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_OWNER_EMAIL",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_ASSET_JSON",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_ASSET_NAMES",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_HOSTNAME",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_RESULT",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_REASON",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_DESCRIPTION",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_ENTITY",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_ENTITY_SUBTYPE",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_SESSION_ID",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_CASE_ID",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_INSERT_TIME",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_SEVERITY",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_SOURCE_IP",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_USER_AGENT",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "AUDIT_USER_ROLES",
                        "type": "dynamic",
                        "description": ""
                    }
                ]
            },
            "Custom-CortexXdrStreamAgent": {
                "columns": [
                    {
                        "name": "TIMESTAMP",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "RECEIVEDTIME",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "ENDPOINTID",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "ENDPOINTNAME",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "DOMAIN",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "TRAPSVERSION",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "CATEGORY",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "TYPE",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "SUBTYPE",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "RESULT",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "REASON",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "DESCRIPTION",
                        "type": "string",
                        "description": ""
                    }
                ]
            },
            "Custom-CortexXdrStreamEndpoint": {
                "columns": [
                    {
                        "name": "agent_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "agent_status",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "operational_status",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "host_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "agent_type",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "ip",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "last_seen",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "tags",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "users",
                        "type": "dynamic",
                        "description": ""
                    }
                ]
            },
            "Custom-CortexXdrStreamAlerts": {
                "columns": [
                    {
                        "name": "external_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "severity",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "matching_status",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "end_match_attempt_ts",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "local_insert_ts",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "bioc_indicator",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "matching_service_rule_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "attempt_counter",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "is_whitelisted",
                        "type": "boolean",
                        "description": ""
                    },
                    {
                        "name": "starred",
                        "type": "boolean",
                        "description": ""
                    },
                    {
                        "name": "mitre_technique_id_and_name",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "mitre_tactic_id_and_name",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "agent_version",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "agent_fqdn",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "agent_os_type",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "agent_data_collection_status",
                        "type": "boolean",
                        "description": ""
                    },
                    {
                        "name": "mac",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "alert_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "detection_timestamp",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "category",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "endpoint_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "description",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "host_ip",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "host_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "source",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_pretty",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "causality_actor_causality_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "causality_actor_process_command_line",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "causality_actor_process_image_md5",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "causality_actor_process_image_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "causality_actor_process_image_path",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "causality_actor_process_image_sha256",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "causality_actor_process_signature_status",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "identity_type",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "operation_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "cloud_provider",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "resource_type",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "cluster_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "container_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_country",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "dns_query_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "fw_email_recipient",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "fw_email_sender",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "fw_email_subject",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "event_type",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_file_macro_sha256",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_file_md5",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_file_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_file_path",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_file_sha256",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "fw_rule_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "fw_rule",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "image_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "actor_process_image_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "actor_process_command_line",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "actor_process_image_md5",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "actor_process_image_path",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "actor_process_os_pid",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "actor_process_image_sha256",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "actor_process_signature_status",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "actor_process_signature_vendor",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "actor_thread_thread_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_local_ip",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_local_port",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "module_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "os_actor_process_command_line",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "os_actor_thread_thread_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "os_actor_process_image_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "os_actor_process_os_pid",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "os_actor_process_image_sha256",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "os_actor_process_signature_status",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "os_actor_process_signature_vendor",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "os_actor_effective_username",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_process_signature_status",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_process_signature_vendor",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_registry_data",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "action_registry_full_key",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_external_hostname",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_remote_ip",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_remote_port",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "action_process_image_command_line",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_process_image_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_process_image_sha256",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "fw_url_domain",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "user_agent",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "alert_domain",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "event_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "event_timestamp",
                        "type": "long",
                        "description": ""
                    },
                    {
                        "name": "actor_process_instance_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "actor_process_causality_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "actor_causality_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_registry_key_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_registry_value_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_local_ip_v6",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_remote_ip_v6",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_process_instance_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "action_process_causality_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "os_actor_process_image_path",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "os_actor_process_causality_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "os_actor_causality_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "container_name",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "namespace",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "dst_action_external_hostname",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "dst_action_external_port",
                        "type": "int",
                        "description": ""
                    },
                    {
                        "name": "image_id",
                        "type": "string",
                        "description": ""
                    },
                    {
                        "name": "malicious_urls",
                        "type": "dynamic",
                        "description": ""
                    },
                    {
                        "name": "fw_is_phishing",
                        "type": "boolean",
                        "description": ""
                    },
                    {
                        "name": "user_name",
                        "type": "string",
                        "description": ""
                    }
                ]
            }
        },
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceResourceId": "[variables('workspaceResourceId')]",
                    "name": "clv2ws1"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-CortexXdrStreamIncidents"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source | project  TimeGenerated = now(), IncidentId=incident_id, IncidentName=incident_name, CreationTime=datetime(1970-01-01) + (creation_time * 1ms), ModificationTime=datetime(1970-01-01) + (modification_time * 1ms), DetectionTime=datetime(1970-01-01) + (detection_time * 1ms), Status=status, Severity=severity, Description=description, AssignedUserMail=assigned_user_mail, assignedUserPrettyName=assigned_user_pretty_name, AlertCount=alert_count, LowSeverityAlertCount=low_severity_alert_count, MedSeverityAlertCount=med_severity_alert_count, HighSeverityAlertCount=high_severity_alert_count, CriticalSeverityAlertCount=critical_severity_alert_count, UserCount=user_count, HostCount=host_count, Notes=notes, ResolveComment=resolve_comment, ResolvedTimestamp=datetime(1970-01-01) + (resolved_timestamp * 1ms), ManualSeverity=manual_severity, ManualDescription=manual_description, XdrUrl=xdr_url, Starred=starred, Hosts=todynamic(hosts), Users=todynamic(users), IncidentSources=todynamic(incident_sources), RuleBasedScore=rule_based_score, ManualScore=manual_score, WildfireHits=wildfire_hits, AlertsGroupingStatus=alerts_grouping_status, MitreTacticsIdsAndNames=todynamic(mitre_tactics_ids_and_names), MitreTechniquesIdsAndNames=todynamic(mitre_techniques_ids_and_names), AlertCategories=todynamic(alert_categories), OriginalTags=todynamic(original_tags), Tags=todynamic(tags)",
                "outputStream": "Custom-PaloAltoCortexXDR_Incidents_CL"
            },
            {
                "streams": [
                    "Custom-CortexXdrStreamManagement"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source | project  TimeGenerated = now(), AuditId=AUDIT_ID, AuditOwnerName=AUDIT_OWNER_NAME, AuditOwnerEmail=AUDIT_OWNER_EMAIL, AuditAssetJSON=todynamic(AUDIT_ASSET_JSON), AuditAssetNames=AUDIT_ASSET_NAMES, AuditHostName=AUDIT_HOSTNAME, AuditResult=AUDIT_RESULT, AuditReason=AUDIT_REASON, AuditDescription=AUDIT_DESCRIPTION, AuditEntity=AUDIT_ENTITY, AuditEntitySubtype=AUDIT_ENTITY_SUBTYPE, AuditSessionId=AUDIT_SESSION_ID, AuditCaseId=AUDIT_CASE_ID, AuditInsertTime=datetime(1970-01-01) + (AUDIT_INSERT_TIME * 1ms), AuditSeverity=AUDIT_SEVERITY,AuditSourceIp=AUDIT_SOURCE_IP,AuditUserAgent=AUDIT_USER_AGENT,AuditUserRoles=todynamic(AUDIT_USER_ROLES)",
                "outputStream": "Custom-PaloAltoCortexXDR_Audit_Management_CL"
            },
            {
                "streams": [
                    "Custom-CortexXdrStreamAgent"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source | project TimeGenerated = now(), Timestamp=datetime(1970-01-01) + (TIMESTAMP * 1ms), ReceivedTime=datetime(1970-01-01) + (RECEIVEDTIME * 1ms), EndpointId=ENDPOINTID, EndpointName=ENDPOINTNAME, Domain=DOMAIN, TrapsVersion=TRAPSVERSION, Category=CATEGORY, AgentType=TYPE, Subtype=SUBTYPE, Result=RESULT, Reason=REASON, Description=DESCRIPTION",
                "outputStream": "Custom-PaloAltoCortexXDR_Audit_Agent_CL"
            },
            {
                "streams": [
                    "Custom-CortexXdrStreamAlerts"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source | project TimeGenerated = now(), ExternalId = external_id, Severity = severity, MatchingStatus = matching_status, EndMatchAttempt = datetime(1970-01-01) + (end_match_attempt_ts * 1ms), LocalInsert = datetime(1970-01-01) + (local_insert_ts * 1ms), BiocIndicator = bioc_indicator, AttemptCounter = attempt_counter, Whitelisted = is_whitelisted, Starred = starred, MitreTechniqueIdAndName = todynamic(mitre_technique_id_and_name), MitreTacticIdAndName = todynamic(mitre_tactic_id_and_name), AgentVersion = agent_version, AgentFQDN = agent_fqdn, AgentOSType = agent_os_type, AgentDataCollectionStatus = agent_data_collection_status, MacAddress = mac, AlertId = alert_id, DetectionTimestamp = datetime(1970-01-01) + (detection_timestamp * 1ms), Name = name, Category = category, EndpointId = endpoint_id, Description = description, HostIp = host_ip, HostName = host_name, Source = source, Action = action, ActionPretty = action_pretty, CausalityActorCausalityId = causality_actor_causality_id, CausalityActorProcessCommandLine = causality_actor_process_command_line, CausalityActorProcessImageMd5 = causality_actor_process_image_md5, CausalityActorProcessImageName = causality_actor_process_image_name, CausalityActorProcessImagePath = causality_actor_process_image_path, CausalityActorProcessImageSha256 = causality_actor_process_image_sha256, CausalityActorProcessSignatureStatus = causality_actor_process_signature_status, IdentityType = identity_type, OperationName = operation_name, CloudProvider = cloud_provider, ResourceType = resource_type, ClusterName = cluster_name, ContainerId = container_id, ActionCountry = action_country, DnsQueryName = dns_query_name, FwEmailRecipient = fw_email_recipient, FwEmailSender = fw_email_sender, FwEmailSubject = fw_email_subject, EventType = event_type, ActionFileMacroSha256 = action_file_macro_sha256, ActionFileMd5 = action_file_md5, ActionFileName = action_file_name, ActionFilePath = action_file_path, ActionFileSha256 = action_file_sha256, FwRuleId = fw_rule_id, FwRule = fw_rule, ImageName = image_name, ActorProcessImageName = actor_process_image_name, ActorProcessCommandLine = actor_process_command_line, ActorProcessImageMd5 = actor_process_image_md5, ActorProcessImagePath = actor_process_image_path, ActorProcessOsPid = actor_process_os_pid, ActorProcessImageSha256 = actor_process_image_sha256, ActorProcessSignatureStatus = actor_process_signature_status, ActorProcessSignatureVendor = actor_process_signature_vendor, ActorThreadThreadId = actor_thread_thread_id, ActionLocalIp = action_local_ip, ActionLocalPort = action_local_port, ModuleId = module_id, OsActorProcessCommandLine = os_actor_process_command_line, OsActorThreadThreadId = os_actor_thread_thread_id, OsActorProcessImageName = os_actor_process_image_name, OsActorProcessOsPid = os_actor_process_os_pid, OsActorProcessImageSha256 = os_actor_process_image_sha256, OsActorProcessSignatureStatus = os_actor_process_signature_status, OsActorProcessSignatureVendor = os_actor_process_signature_vendor, OsActorEffectiveUsername = os_actor_effective_username, ActionProcessSignatureStatus = action_process_signature_status, ActionProcessSignatureVendor = action_process_signature_vendor, ActionRegistryData = todynamic(action_registry_data), ActionRegistryFullKey = action_registry_full_key, ActionExternalHostname = action_external_hostname, ActionRemoteIp = action_remote_ip, ActionRemotePort = action_remote_port, MatchingServiceRuleId = matching_service_rule_id, ActionProcessImageCommandLine = action_process_image_command_line, ActionProcessImageName = action_process_image_name, ActionProcessImageSha256 = action_process_image_sha256, FwUrlDomain = fw_url_domain, UserAgent = user_agent, AlertDomain = alert_domain, EventId = event_id, EventTimestamp = datetime(1970-01-01) + (event_timestamp * 1ms), ActorProcessInstanceId = actor_process_instance_id, ActorProcessCausalityId = actor_process_causality_id, ActorCausalityId = actor_causality_id, ActionRegistryKeyName = action_registry_key_name, ActionRegistryValueName = action_registry_value_name, ActionLocalIpV6 = action_local_ip_v6, ActionRemoteIpV6 = action_remote_ip_v6, ActionProcessInstanceId = action_process_instance_id, ActionProcessCausalityId = action_process_causality_id, OsActorProcessImagePath = os_actor_process_image_path, OsActorProcessCausalityId = os_actor_process_causality_id, OsActorCausalityId = os_actor_causality_id, ContainerName = container_name, Namespace = namespace, DstActionExternalHostname = dst_action_external_hostname, DstActionExternalPort = dst_action_external_port, ImageId = image_id, MaliciousUrls = todynamic(malicious_urls), FwIsPhishing = fw_is_phishing, UserName = user_name",
                "outputStream": "Custom-PaloAltoCortexXDR_Alerts_CL"
            },
            {
                "streams": [
                    "Custom-CortexXdrStreamEndpoint"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source | project TimeGenerated = now(), AgentId=agent_id, AgentStatus=agent_status, OperationalStatus=operational_status, HostName=host_name, AgentType=agent_type, IpAddress=ip, LastSeen=datetime(1970-01-01) + (last_seen * 1ms), Tags=todynamic(tags), Users=todynamic(users)",
                "outputStream": "Custom-PaloAltoCortexXDR_Endpoints_CL"
            }
            
        ],
        "dataCollectionEndpointId": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]"
    }
}