{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Feedly ml@feedly.com",
    "comments": "Solution template for Feedly"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_solutionName": "Feedly",
    "_solutionVersion": "3.0.7",
    "solutionId": "feedlyinc1693853810319.azure-sentinel-solution-feedly",
    "_solutionId": "[variables('solutionId')]",
    "dataConnectorVersionConnectorDefinition": "3.0.7",
    "dataConnectorVersionConnections": "3.0.7",
    "_dataConnectorContentIdConnectorDefinition": "FeedlyConnectorTemplateConnectorDefinitionV2",
    "dataConnectorTemplateNameConnectorDefinition": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition')))]",
    "_dataConnectorContentIdConnections": "FeedlyConnectorTemplateConnectionsV2",
    "dataConnectorTemplateNameConnections": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections')))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition'), variables('dataConnectorVersionConnectorDefinition'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition')]",
        "displayName": "[concat(variables('_solutionName'), ' ', variables('dataConnectorTemplateNameConnectorDefinition'))]",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersionConnectorDefinition')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersionConnectorDefinition')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Feedly ml@feedly.com"
                },
                "support": {
                  "name": "Feedly Inc",
                  "email": "ml@feedly.com",
                  "tier": "Partner",
                  "link": "https://feedly.com/i/support/contactUs"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorVersionConnections')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "FeedlyConnector",
                  "title": "Feedly",
                  "publisher": "Feedly",
                  "descriptionMarkdown": "The Feedly data connector enables you to ingest Indicators of Compromise (IOCs) from Feedly streams into Microsoft Sentinel. This connector uses the Codeless Connector Framework to collect IOC data extracted from threat intelligence articles in your Feedly feeds. The connector automatically handles pagination for large article sets and supports multiple stream IDs for collecting data from various Feedly feeds. Each IOC includes the indicator type, value, article title, article URL, and source publication. Configure the connector by providing your Feedly API credentials and the stream IDs you want to monitor.",
                  "graphQueriesTableName": "feedly_indicators_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total IoCs collected",
                      "legend": "All IoCs",
                      "baseQuery": "{{graphQueriesTableName}}"
                    },
                    {
                      "metricName": "Recent IoCs",
                      "legend": "Recent IoCs",
                      "baseQuery": "{{graphQueriesTableName}} | where TimeGenerated > ago(24h)"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All IoCs collected",
                      "query": "{{graphQueriesTableName}}\n| sort by TimeGenerated desc"
                    },
                    {
                      "description": "Ip addresses",
                      "query": "{{graphQueriesTableName}}\n| where indicatorType == \"ipv4-addr\"\n| sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "feedly_indicators_CL",
                      "lastDataReceivedQuery": "feedly_indicators_CL\n| where TimeGenerated > ago(6h)\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "feedly_indicators_CL | where TimeGenerated > ago(1h) | take 1"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                     "isPreview": true
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true,
                          "action": false
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "title": "1. API Configuration",
                      "description": "Configure your Feedly API connection.",
                      "instructions": [
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "## Authentication\n\nProvide your API key for authentication. Get your Feedly API token from https://feedly.com/i/team/api"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "API Key",
                            "placeholder": "Enter your API key",
                            "type": "password",
                            "name": "apiKey"
                          }
                        },
                        {
                          "type": "InfoMessage",
                          "parameters": {
                            "text": "The API key will be securely stored and used for authentication with the Feedly API.",
                            "visible": true,
                            "inline": true
                          }
                        }
                      ]
                    },
                    {
                      "title": "2. Stream Configuration",
                      "description": "Specify the Feedly streams to collect IoCs from.",
                      "instructions": [
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "## Stream IDs\n\nSpecify the Feedly Stream IDs you want to collect IoCs from. Separate multiple IDs with commas.\n\nThe stream ID of a folder will look like `enterprise/XXXXXXXX/category/a359b9f7-7330-4340-b45e-9ee80838a69c`\n\nThe stream ID of a board will look like `enterprise/XXXXXXXX/tag/0075125e-d8ba-4df0-9944-faa8592e4210` \n\nThe stream ID of a feed will look like `feed/https://feedly.com/f/7XXXXXXXXXXXXXXXXXXXXXX1`\n\nBe sure to provide the entire stream ID."
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Feedly Stream IDs",
                            "placeholder": "streamId1,streamId2,streamId3",
                            "type": "text",
                            "name": "streamIds",
                            "validations": {
                              "required": true
                            }
                          }
                        }
                      ]
                    },
                    {
                      "title": "3. Enable Connector",
                      "description": "Activate the Feedly connector",
                      "instructions": [
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "### Connector Activation\n\nReview your configuration and enable the connector to start collecting IoCs from Feedly."
                          }
                        },
                        {
                          "type": "ConnectionToggleButton",
                          "parameters": {
                            "connectLabel": "Connect Feedly",
                            "disconnectLabel": "Disconnect Connector",
                            "name": "mainToggle"
                          }
                        },
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "### Post-Connection\n\nAfter connecting, monitor the connector status in the **Data connectors** page. Data should begin appearing within 5-10 minutes."
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "name": "FeedlyDCR1",
              "apiVersion": "2021-09-01-preview",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "dataCollectionEndpointId": "{{DataCollectionEndpointId}}",
                "streamDeclarations": {
                  "Custom-feedly_indicators_CL": {
                    "columns": [
                      {
                        "name": "subtype",
                        "type": "string"
                      },
                      {
                        "name": "value",
                        "type": "string"
                      },
                      {
                        "name": "source_name",
                        "type": "string"
                      },
                      {
                        "name": "type",
                        "type": "string"
                      },
                      {
                        "name": "source_entry_id",
                        "type": "string"
                      },
                      {
                        "name": "source_entry_title",
                        "type": "string"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-feedly_indicators_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "outputStream": "Custom-feedly_indicators_CL",
                    "transformKql": "source | extend TimeGenerated = now() , value = ['value'] , indicatorType = ['type'] , indicatorSubType = ['subtype'] , source = ['source_name'] , articleUrl = strcat('https://feedly.com/i/entry/', ['source_entry_id']) , articleTitle = ['source_entry_title'] | project TimeGenerated , value , indicatorType , indicatorSubType , source , articleUrl , articleTitle"
                  }
                ]
              }
            },
            {
              "name": "feedly_indicators_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "plan": "Analytics",
                "retentionInDays": 90,
                "schema": {
                  "name": "feedly_indicators_CL",
                  "description": "Feedly IoC data collected from Feedly API",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "value",
                      "type": "string",
                      "description": "The Indicator of Compromise value, such as an IP address, domain name, URL, hash, or email"
                    },
                    {
                      "name": "indicatorType",
                      "type": "string",
                      "description": "Type of indicator (e.g., ipv4-addr, domain-name, url)"
                    },
                    {
                      "name": "indicatorSubType",
                      "type": "string",
                      "description": "Subtype classification of the indicator"
                    },
                    {
                      "name": "source",
                      "type": "string",
                      "description": "Source publication name"
                    },
                    {
                      "name": "articleUrl",
                      "type": "string",
                      "description": "URL to the source article in Feedly"
                    },
                    {
                      "name": "articleTitle",
                      "type": "string",
                      "description": "Title of the source article"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(substring(variables('_solutionId'), 0, 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition'),'-', variables('dataConnectorVersionConnectorDefinition'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('_solutionVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "FeedlyConnector",
          "title": "Feedly",
          "publisher": "Feedly",
          "descriptionMarkdown": "The Feedly data connector enables you to ingest Indicators of Compromise (IOCs) from Feedly streams into Microsoft Sentinel. This connector uses the Codeless Connector Framework to collect IOC data extracted from threat intelligence articles in your Feedly feeds. The connector automatically handles pagination for large article sets and supports multiple stream IDs for collecting data from various Feedly feeds. Each IOC includes the indicator type, value, article title, article URL, and source publication. Configure the connector by providing your Feedly API credentials and the stream IDs you want to monitor.",
          "graphQueriesTableName": "feedly_indicators_CL",
          "graphQueries": [
            {
              "metricName": "Total IoCs collected",
              "legend": "All IoCs",
              "baseQuery": "{{graphQueriesTableName}}"
            },
            {
              "metricName": "Recent IoCs",
              "legend": "Recent IoCs",
              "baseQuery": "{{graphQueriesTableName}} | where TimeGenerated > ago(24h)"
            }
          ],
          "sampleQueries": [
            {
              "description": "All IoCs collected",
              "query": "{{graphQueriesTableName}}\n| sort by TimeGenerated desc"
            },
            {
              "description": "Ip addresses",
              "query": "{{graphQueriesTableName}}\n| where indicatorType == \"ipv4-addr\"\n| sort by TimeGenerated desc"
            }
          ],
          "dataTypes": [
            {
              "name": "feedly_indicators_CL",
              "lastDataReceivedQuery": "feedly_indicators_CL\n| where TimeGenerated > ago(6h)\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "feedly_indicators_CL | where TimeGenerated > ago(1h) | take 1"
              ]
            }
          ],
          "availability": {
            "isPreview": true,
            "status": 1
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true,
                  "action": false
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "title": "1. API Configuration",
              "description": "Configure your Feedly API connection.",
              "instructions": [
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "## Authentication\n\nProvide your API key for authentication. Get your Feedly API token from https://feedly.com/i/team/api"
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "API Key",
                    "placeholder": "Enter your API key",
                    "type": "password",
                    "name": "apiKey"
                  }
                },
                {
                  "type": "InfoMessage",
                  "parameters": {
                    "text": "The API key will be securely stored and used for authentication with the Feedly API.",
                    "visible": true,
                    "inline": true
                  }
                }
              ]
            },
            {
              "title": "2. Stream Configuration",
              "description": "Specify the Feedly streams to collect IoCs from.",
              "instructions": [
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "## Stream IDs\n\nSpecify the Feedly Stream IDs you want to collect IoCs from. Separate multiple IDs with commas.\n\nThe stream ID of a folder will look like `enterprise/XXXXXXXX/category/a359b9f7-7330-4340-b45e-9ee80838a69c`\n\nThe stream ID of a board will look like `enterprise/XXXXXXXX/tag/0075125e-d8ba-4df0-9944-faa8592e4210` \n\nThe stream ID of a feed will look like `feed/https://feedly.com/f/7XXXXXXXXXXXXXXXXXXXXXX1`\n\nBe sure to provide the entire stream ID."
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "Feedly Stream IDs",
                    "placeholder": "streamId1,streamId2,streamId3",
                    "type": "text",
                    "name": "streamIds",
                    "validations": {
                      "required": true
                    }
                  }
                }
              ]
            },
            {
              "title": "3. Enable Connector",
              "description": "Activate the Feedly connector",
              "instructions": [
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "### Connector Activation\n\nReview your configuration and enable the connector to start collecting IoCs from Feedly."
                  }
                },
                {
                  "type": "ConnectionToggleButton",
                  "parameters": {
                    "connectLabel": "Connect Feedly",
                    "disconnectLabel": "Disconnect Connector",
                    "name": "mainToggle"
                  }
                },
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "### Post-Connection\n\nAfter connecting, monitor the connector status in the **Data connectors** page. Data should begin appearing within 5-10 minutes."
                  }
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersionConnectorDefinition')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Feedly ml@feedly.com"
        },
        "support": {
          "name": "Feedly Inc",
          "email": "ml@feedly.com",
          "tier": "Partner",
          "link": "https://feedly.com/i/support/contactUs"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorVersionConnections')]",
              "contentId": "[variables('_dataConnectorContentIdConnections')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections'), variables('dataConnectorVersionConnections'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections')]",
        "displayName": "[concat(variables('_solutionName'), ' ', variables('dataConnectorTemplateNameConnections'))]",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersionConnections')]",
          "parameters": {
            "connectorDefinitionName": {
              "defaultValue": "FeedlyConnectorTemplateConnectorDefinition",
              "type": "string",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "string"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "apiKey": {
              "defaultValue": "apiKey",
              "type": "securestring"
            },
            "streamIds": {
              "defaultValue": "streamIds",
              "type": "string"
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections": "[variables('_dataConnectorContentIdConnections')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorVersionConnections')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Feedly ml@feedly.com"
                },
                "support": {
                  "name": "Feedly Inc",
                  "email": "ml@feedly.com",
                  "tier": "Partner",
                  "link": "https://feedly.com/i/support/contactUs"
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/','FeedlyPoller')]",
              "apiVersion": "2022-12-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization",
                  "ApiKeyIdentifier": "Bearer"
                },
                "request": {
                  "apiEndpoint": "https://api.feedly.com/v3/enterprise/ioc",
                  "httpMethod": "GET",
                  "rateLimitQPS": 10,
                  "queryWindowInMin": 30,
                  "queryWindowDelayInMin": 60,
                  "queryTimeFormat": "UnixTimestampInMills",
                  "retryCount": 3,
                  "timeoutInSeconds": 90,
                  "headers": {
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                  },
                  "queryParameters": {
                    "streamId": "[[parameters('streamIds')]",
                    "newerThan": "{_QueryWindowStartTime}",
                    "olderThan": "{_QueryWindowEndTime}",
                    "format": "sentinel"
                  }
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.objects[*]"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "LinkHeader"
                },
                "connectorDefinitionName": "[[parameters('connectorDefinitionName')]",
                "dataType": "feedly_indicators_CL",
                "dcrConfig": {
                  "streamName": "Custom-feedly_indicators_CL",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(substring(variables('_solutionId'), 0, 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections'),'-', variables('dataConnectorVersionConnections'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('_solutionVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.7",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Feedly",
        "publisherDisplayName": "Feedly Inc",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Feedly/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://feedly.com/i/landing/threatIntelligence\">Feedly</a> Solution for Microsoft Sentinel provides a simple way to ingest Indicators of Compromise from your Feedly streams into Microsoft Sentinel.</p>\n<p><strong>Data Connectors:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Feedly.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Feedly",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Feedly ml@feedly.com"
        },
        "support": {
          "name": "Feedly Inc",
          "email": "ml@feedly.com",
          "tier": "Partner",
          "link": "https://feedly.com/i/support/contactUs"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnectorDefinition')]",
              "version": "[variables('dataConnectorVersionConnectorDefinition')]"
            }
          ]
        },
        "firstPublishDate": "2023-08-01",
        "providers": [
          "Feedly"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
