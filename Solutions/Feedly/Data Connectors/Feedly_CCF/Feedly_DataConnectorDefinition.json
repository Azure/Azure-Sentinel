{
    "name": "FeedlyCCPDefinition",
    "apiVersion": "2022-09-01-preview",
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": {
        "connectorUiConfig": {
            "id": "FeedlyCCPDefinition",
            "title": "Feedly IoC",
            "publisher": "Feedly",
            "descriptionMarkdown": "The [Feedly](https://feedly.com/) IoC data connector provides the capability to ingest Indicators of Compromise (IoCs) from Feedly API into Microsoft Sentinel.",
            "graphQueriesTableName": "feedly_indicators_CL",
            "graphQueries": [
                {
                    "metricName": "Total data received",
                    "legend": "Feedly IoCs",
                    "baseQuery": "{{graphQueriesTableName}}\n| summarize count() by bin(TimeGenerated, 1h)"
                }
            ],
            "sampleQueries": [
                {
                    "description": "All IoCs collected",
                    "query": "{{graphQueriesTableName}}\n| sort by TimeGenerated desc"
                },
                {
                    "description": "IP addresses",
                    "query": "{{graphQueriesTableName}}\n| where indicatorType == \"ipv4-addr\"\n| sort by TimeGenerated desc"
                },
                {
                    "description": "Domain names",
                    "query": "{{graphQueriesTableName}}\n| where indicatorType == \"domain-name\"\n| sort by TimeGenerated desc"
                }
            ],
            "dataTypes": [
                {
                    "name": "{{graphQueriesTableName}}",
                    "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
                }
            ],
            "availability": {
                "isPreview": false
            },
            "connectivityCriteria": [
                {
                    "type": "HasDataConnectors"
                }
            ],
            "permissions": {
                "resourceProvider": [
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "write": true,
                            "read": true,
                            "delete": true
                        }
                    }
                ],
                "customs": [
                    {
                        "name": "Feedly API access",
                        "description": "Access to the Feedly API is required. You need a Feedly API token with access to the IoC streams you want to ingest. Generate your API token at https://feedly.com/i/team/api"
                    }
                ]
            },
            "instructionSteps": [
                {
                    "description": "1) Go to https://feedly.com/i/team/api and generate a new API token for the connector.\n2) In Sentinel, in the connector page - provide your Feedly API Key and Stream IDs. Then click \"Connect\".",
                    "instructions": [
                        {
                            "type": "Textbox",
                            "parameters": {
                                "label": "Feedly API Key",
                                "placeholder": "Enter your Feedly API token",
                                "type": "password",
                                "name": "feedlyApiKey",
                                "required": true
                            }
                        },
                        {
                            "type": "Textbox",
                            "parameters": {
                                "label": "Feedly Stream IDs",
                                "placeholder": "streamId1,streamId2,streamId3",
                                "type": "text",
                                "name": "feedlyStreamIds",
                                "required": true
                            }
                        }
                    ],
                    "title": "Connect to Feedly to start collecting IoCs in Microsoft Sentinel"
                }
            ]
        }
    }
}
