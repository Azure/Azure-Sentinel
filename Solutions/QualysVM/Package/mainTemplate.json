{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for QualysVM"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Qualys Vulnerability Management",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "solutionId": "azuresentinel.azure-sentinel-qualysvm",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "uiConfigId1": "QualysVulnerabilityManagement",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "QualysVulnerabilityManagement",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
    "dataConnectorVersion1": "2.0.0",
    "blanks": "[replace('b', 'b', '')]",
    "TemplateEmptyArray": "[json('[]')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "QualysVMV2Workbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "analyticRuleVersion1": "1.0.1",
    "analyticRulecontentId1": "3edb7215-250b-40c0-8b46-79093949242d",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1')))]",
    "analyticRuleVersion2": "1.0.1",
    "analyticRulecontentId2": "6116dc19-475a-4148-84b2-efe89c073e27",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2')))]",
    "QualysCustomConnector": "QualysCustomConnector",
    "_QualysCustomConnector": "[variables('QualysCustomConnector')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "QualysCustomConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1')))]",
    "QualysVM-GetAssetDetails": "QualysVM-GetAssetDetails",
    "_QualysVM-GetAssetDetails": "[variables('QualysVM-GetAssetDetails')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "QualysVM-GetAssetDetails",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2')))]",
    "QualysVM-GetAssets-ByCVEID": "QualysVM-GetAssets-ByCVEID",
    "_QualysVM-GetAssets-ByCVEID": "[variables('QualysVM-GetAssets-ByCVEID')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "QualysVM-GetAssets-ByCVEID",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3')))]",
    "QualysVM-GetAssets-ByOpenPort": "QualysVM-GetAssets-ByOpenPort",
    "_QualysVM-GetAssets-ByOpenPort": "[variables('QualysVM-GetAssets-ByOpenPort')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "QualysVM-GetAssets-ByOpenPort",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4')))]",
    "QualysVM-LaunchVMScan-GenerateReport": "QualysVM-LaunchVMScan-GenerateReport",
    "_QualysVM-LaunchVMScan-GenerateReport": "[variables('QualysVM-LaunchVMScan-GenerateReport')]",
    "playbookVersion5": "1.0",
    "playbookContentId5": "QualysVM-LaunchVMScan-GenerateReport",
    "_playbookContentId5": "[variables('playbookContentId5')]",
    "playbookId5": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId5'))]",
    "playbookTemplateSpecName5": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId5')))]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "QualysVM data connector with template",
        "displayName": "QualysVM template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "QualysVM data connector with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Qualys Vulnerability Management (using Azure Functions)",
                  "publisher": "Qualys",
                  "descriptionMarkdown": "The [Qualys Vulnerability Management (VM)](https://www.qualys.com/apps/vulnerability-management/) data connector provides the capability to ingest vulnerability host detection data into Microsoft Sentinel through the Qualys API. The connector provides visibility into host detection data from vulerability scans. This connector provides Microsoft Sentinel the capability to view dashboards, create custom alerts, and improve investigation ",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "QualysHostDetectionV2_CL",
                      "baseQuery": "QualysHostDetectionV2_CL"
                    },
                    {
                      "metricName": "Total data received",
                      "legend": "QualysHostDetection_CL",
                      "baseQuery": "QualysHostDetection_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Top 10 Qualys V2 Vulerabilities detected",
                      "query": "QualysHostDetectionV2_CL\n | extend Vulnerability = tostring(QID_s)\n | summarize count() by Vulnerability\n | top 10 by count_"
                    },
                    {
                      "description": "Top 10 Vulerabilities detected",
                      "query": "QualysHostDetection_CL\n | mv-expand todynamic(Detections_s)\n | extend Vulnerability = tostring(Detections_s.Results)\n | summarize count() by Vulnerability\n | top 10 by count_"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "QualysHostDetectionV2_CL",
                      "lastDataReceivedQuery": "QualysHostDetectionV2_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "QualysHostDetection_CL",
                      "lastDataReceivedQuery": "QualysHostDetection_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "QualysHostDetectionV2_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                        "QualysHostDetection_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "Qualys API Key",
                        "description": "A Qualys VM API username and password is required. [See the documentation to learn more about Qualys VM API](https://www.qualys.com/docs/qualys-api-vmpc-user-guide.pdf)."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This connector uses Azure Functions to connect to Qualys VM to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                    },
                    {
                      "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                    },
                    {
                      "description": "**STEP 1 - Configuration steps for the Qualys VM API**\n\n1. Log into the Qualys Vulnerability Management console with an administrator account, select the **Users** tab and the **Users** subtab. \n2. Click on the **New** drop-down menu and select **Users..**\n3. Create a username and password for the API account. \n4. In the **User Roles** tab, ensure the account role is set to **Manager** and access is allowed to **GUI** and **API**\n4. Log out of the administrator account and log into the console with the new API credentials for validation, then log out of the API account. \n5. Log back into the console using an administrator account and modify the API accounts User Roles, removing access to **GUI**. \n6. Save all changes."
                    },
                    {
                      "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Qualys VM connector, have the Workspace ID and Workspace Primary Key (can be copied from the following), as well as the Qualys VM API Authorization Key(s), readily available.",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Primary Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "description": ">**NOTE:** This connector has been updated, if you have previously deployed an earlier version, and want to update, please delete the existing Qualys VM Azure Function before redeploying this version. Please use Qualys V2 version Workbook, detections. "
                    },
                    {
                      "description": "Use this method for automated deployment of the Qualys VM connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-QualysVM-azuredeployV2)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Workspace ID**, **Workspace Key**, **API Username**, **API Password** , update the **URI**, and any additional URI **Filter Parameters** (each filter should be separated by an \"&\" symbol, no spaces.) \n> - Enter the URI that corresponds to your region. The complete list of API Server URLs can be [found here](https://www.qualys.com/docs/qualys-api-vmpc-user-guide.pdf#G4.735348) -- There is no need to add a time suffix to the URI, the Function App will dynamically append the Time Value to the URI in the proper format. \n - The default **Time Interval** is set to pull the last five (5) minutes of data. If the time interval needs to be modified, it is recommended to change the Function App Timer Trigger accordingly (in the function.json file, post deployment) to prevent overlapping data ingestion. \n> - Note: If using Azure Key Vault secrets for any of the values above, use the`@Microsoft.KeyVault(SecretUri={Security Identifier})`schema in place of the string values. Refer to [Key Vault references documentation](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) for further details. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
                      "title": "Option 1 - Azure Resource Manager (ARM) Template"
                    },
                    {
                      "description": "Use the following step-by-step instructions to deploy the Quayls VM connector manually with Azure Functions.",
                      "title": "Option 2 - Manual Deployment of Azure Functions"
                    },
                    {
                      "description": "**1. Create a Function App**\n\n1.  From the Azure Portal, navigate to [Function App](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Web%2Fsites/kind/functionapp), and select **+ Add**.\n2. In the **Basics** tab, ensure Runtime stack is set to **Powershell Core**. \n3. In the **Hosting** tab, ensure the **Consumption (Serverless)** plan type is selected.\n4. Make other preferrable configuration changes, if needed, then click **Create**."
                    },
                    {
                      "description": "**2. Import Function App Code**\n\n1. In the newly created Function App, select **Functions** on the left pane and click **+ New Function**.\n2. Select **Timer Trigger**.\n3. Enter a unique Function **Name** and leave the default cron schedule of every 5 minutes, then click **Create**.\n5. Click on **Code + Test** on the left pane. \n6. Copy the [Function App Code](https://aka.ms/sentinel-QualysVM-functioncodeV2) and paste into the Function App `run.ps1` editor.\n7. Click **Save**."
                    },
                    {
                      "description": "**3. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select **+ New application setting**.\n3. Add each of the following eight (8) application settings individually, with their respective string values (case-sensitive): \n\t\tapiUsername\n\t\tapiPassword\n\t\tworkspaceID\n\t\tworkspaceKey\n\t\turi\n\t\tfilterParameters\n\t\ttimeInterval\n\t\tlogAnalyticsUri (optional)\n> - Enter the URI that corresponds to your region. The complete list of API Server URLs can be [found here](https://www.qualys.com/docs/qualys-api-vmpc-user-guide.pdf#G4.735348). The `uri` value must follow the following schema: `https://<API Server>/api/2.0/fo/asset/host/vm/detection/?action=list&vm_processed_after=` -- There is no need to add a time suffix to the URI, the Function App will dynamically append the Time Value to the URI in the proper format.\n> - Add any additional filter parameters, for the `filterParameters` variable, that need to be appended to the URI. Each parameter should be seperated by an \"&\" symbol and should not include any spaces.\n> - Set the `timeInterval` (in minutes) to the value of `5` to correspond to the Timer Trigger of every `5` minutes. If the time interval needs to be modified, it is recommended to change the Function App Timer Trigger accordingly to prevent overlapping data ingestion.\n> - Note: If using Azure Key Vault, use the`@Microsoft.KeyVault(SecretUri={Security Identifier})`schema in place of the string values. Refer to [Key Vault references documentation](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) for further details.\n> - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`.\n4. Once all application settings have been entered, click **Save**."
                    },
                    {
                      "description": "**4. Configure the host.json**.\n\nDue to the potentially large amount of Qualys host detection data being ingested, it can cause the execution time to surpass the default Function App timeout of five (5) minutes. Increase the default timeout duration to the maximum of ten (10) minutes, under the Consumption Plan, to allow more time for the Function App to execute.\n\n1. In the Function App, select the Function App Name and select the **App Service Editor** blade.\n2. Click **Go** to open the editor, then select the **host.json** file under the **wwwroot** directory.\n3. Add the line `\"functionTimeout\": \"00:10:00\",` above the `managedDependancy` line \n4. Ensure **SAVED** appears on the top right corner of the editor, then exit the editor.\n\n> NOTE: If a longer timeout duration is required, consider upgrading to an [App Service Plan](https://docs.microsoft.com/azure/azure-functions/functions-scale#timeout)"
                    }
                  ],
                  "metadata": {
                    "id": "9118ddc8-ca2c-48d3-8b10-9b198bd1ab3e",
                    "version": "2.0.0",
                    "kind": "dataConnector",
                    "source": {
                      "kind": "community"
                    },
                    "author": {
                      "name": "Qualys VM"
                    },
                    "support": {
                      "tier": "developer",
                      "name": "Qualys VM",
                      "email": "support@qualys.com",
                      "link": "https://www.qualys.com/support"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "QualysVM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "QualysVM",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Qualys Vulnerability Management (using Azure Functions)",
          "publisher": "Qualys",
          "descriptionMarkdown": "The [Qualys Vulnerability Management (VM)](https://www.qualys.com/apps/vulnerability-management/) data connector provides the capability to ingest vulnerability host detection data into Microsoft Sentinel through the Qualys API. The connector provides visibility into host detection data from vulerability scans. This connector provides Microsoft Sentinel the capability to view dashboards, create custom alerts, and improve investigation ",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "QualysHostDetectionV2_CL",
              "baseQuery": "QualysHostDetectionV2_CL"
            },
            {
              "metricName": "Total data received",
              "legend": "QualysHostDetection_CL",
              "baseQuery": "QualysHostDetection_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "QualysHostDetectionV2_CL",
              "lastDataReceivedQuery": "QualysHostDetectionV2_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "QualysHostDetection_CL",
              "lastDataReceivedQuery": "QualysHostDetection_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "QualysHostDetectionV2_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                "QualysHostDetection_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Top 10 Qualys V2 Vulerabilities detected",
              "query": "QualysHostDetectionV2_CL\n | extend Vulnerability = tostring(QID_s)\n | summarize count() by Vulnerability\n | top 10 by count_"
            },
            {
              "description": "Top 10 Vulerabilities detected",
              "query": "QualysHostDetection_CL\n | mv-expand todynamic(Detections_s)\n | extend Vulnerability = tostring(Detections_s.Results)\n | summarize count() by Vulnerability\n | top 10 by count_"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "Qualys API Key",
                "description": "A Qualys VM API username and password is required. [See the documentation to learn more about Qualys VM API](https://www.qualys.com/docs/qualys-api-vmpc-user-guide.pdf)."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This connector uses Azure Functions to connect to Qualys VM to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
            },
            {
              "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
            },
            {
              "description": "**STEP 1 - Configuration steps for the Qualys VM API**\n\n1. Log into the Qualys Vulnerability Management console with an administrator account, select the **Users** tab and the **Users** subtab. \n2. Click on the **New** drop-down menu and select **Users..**\n3. Create a username and password for the API account. \n4. In the **User Roles** tab, ensure the account role is set to **Manager** and access is allowed to **GUI** and **API**\n4. Log out of the administrator account and log into the console with the new API credentials for validation, then log out of the API account. \n5. Log back into the console using an administrator account and modify the API accounts User Roles, removing access to **GUI**. \n6. Save all changes."
            },
            {
              "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Qualys VM connector, have the Workspace ID and Workspace Primary Key (can be copied from the following), as well as the Qualys VM API Authorization Key(s), readily available.",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Primary Key"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "description": ">**NOTE:** This connector has been updated, if you have previously deployed an earlier version, and want to update, please delete the existing Qualys VM Azure Function before redeploying this version. Please use Qualys V2 version Workbook, detections. "
            },
            {
              "description": "Use this method for automated deployment of the Qualys VM connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-QualysVM-azuredeployV2)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Workspace ID**, **Workspace Key**, **API Username**, **API Password** , update the **URI**, and any additional URI **Filter Parameters** (each filter should be separated by an \"&\" symbol, no spaces.) \n> - Enter the URI that corresponds to your region. The complete list of API Server URLs can be [found here](https://www.qualys.com/docs/qualys-api-vmpc-user-guide.pdf#G4.735348) -- There is no need to add a time suffix to the URI, the Function App will dynamically append the Time Value to the URI in the proper format. \n - The default **Time Interval** is set to pull the last five (5) minutes of data. If the time interval needs to be modified, it is recommended to change the Function App Timer Trigger accordingly (in the function.json file, post deployment) to prevent overlapping data ingestion. \n> - Note: If using Azure Key Vault secrets for any of the values above, use the`@Microsoft.KeyVault(SecretUri={Security Identifier})`schema in place of the string values. Refer to [Key Vault references documentation](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) for further details. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
              "title": "Option 1 - Azure Resource Manager (ARM) Template"
            },
            {
              "description": "Use the following step-by-step instructions to deploy the Quayls VM connector manually with Azure Functions.",
              "title": "Option 2 - Manual Deployment of Azure Functions"
            },
            {
              "description": "**1. Create a Function App**\n\n1.  From the Azure Portal, navigate to [Function App](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Web%2Fsites/kind/functionapp), and select **+ Add**.\n2. In the **Basics** tab, ensure Runtime stack is set to **Powershell Core**. \n3. In the **Hosting** tab, ensure the **Consumption (Serverless)** plan type is selected.\n4. Make other preferrable configuration changes, if needed, then click **Create**."
            },
            {
              "description": "**2. Import Function App Code**\n\n1. In the newly created Function App, select **Functions** on the left pane and click **+ New Function**.\n2. Select **Timer Trigger**.\n3. Enter a unique Function **Name** and leave the default cron schedule of every 5 minutes, then click **Create**.\n5. Click on **Code + Test** on the left pane. \n6. Copy the [Function App Code](https://aka.ms/sentinel-QualysVM-functioncodeV2) and paste into the Function App `run.ps1` editor.\n7. Click **Save**."
            },
            {
              "description": "**3. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select **+ New application setting**.\n3. Add each of the following eight (8) application settings individually, with their respective string values (case-sensitive): \n\t\tapiUsername\n\t\tapiPassword\n\t\tworkspaceID\n\t\tworkspaceKey\n\t\turi\n\t\tfilterParameters\n\t\ttimeInterval\n\t\tlogAnalyticsUri (optional)\n> - Enter the URI that corresponds to your region. The complete list of API Server URLs can be [found here](https://www.qualys.com/docs/qualys-api-vmpc-user-guide.pdf#G4.735348). The `uri` value must follow the following schema: `https://<API Server>/api/2.0/fo/asset/host/vm/detection/?action=list&vm_processed_after=` -- There is no need to add a time suffix to the URI, the Function App will dynamically append the Time Value to the URI in the proper format.\n> - Add any additional filter parameters, for the `filterParameters` variable, that need to be appended to the URI. Each parameter should be seperated by an \"&\" symbol and should not include any spaces.\n> - Set the `timeInterval` (in minutes) to the value of `5` to correspond to the Timer Trigger of every `5` minutes. If the time interval needs to be modified, it is recommended to change the Function App Timer Trigger accordingly to prevent overlapping data ingestion.\n> - Note: If using Azure Key Vault, use the`@Microsoft.KeyVault(SecretUri={Security Identifier})`schema in place of the string values. Refer to [Key Vault references documentation](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) for further details.\n> - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`.\n4. Once all application settings have been entered, click **Save**."
            },
            {
              "description": "**4. Configure the host.json**.\n\nDue to the potentially large amount of Qualys host detection data being ingested, it can cause the execution time to surpass the default Function App timeout of five (5) minutes. Increase the default timeout duration to the maximum of ten (10) minutes, under the Consumption Plan, to allow more time for the Function App to execute.\n\n1. In the Function App, select the Function App Name and select the **App Service Editor** blade.\n2. Click **Go** to open the editor, then select the **host.json** file under the **wwwroot** directory.\n3. Add the line `\"functionTimeout\": \"00:10:00\",` above the `managedDependancy` line \n4. Ensure **SAVED** appears on the top right corner of the editor, then exit the editor.\n\n> NOTE: If a longer timeout duration is required, consider upgrading to an [App Service Plan](https://docs.microsoft.com/azure/azure-functions/functions-scale#timeout)"
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "properties": {
        "description": "QualysVM Workbook with template",
        "displayName": "QualysVM workbook template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('workbookTemplateSpecName1'),'/',variables('workbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "QualysVMv2Workbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Gain insight into Qualys Vulnerability Management by analyzing, collecting and correlating vulnerability data.\nThis workbook provides visibility into vulnerabilities detected from vulnerability scans"
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"1694c013-fbeb-43eb-89c7-1417bb59150f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"value\":{\"durationMs\":2419200000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"a9cc502e-223d-4067-834b-a34a85055664\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"severitySelector\",\"label\":\"Severity\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"QualysHostDetectionV2_CL\\r\\n| extend Sev = tostring(Severity_s)\\r\\n| distinct Sev\\r\\n| sort by Sev desc\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"364f8236-9b9d-4e41-9767-ab5f404dcd4e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"OperatingSystem\",\"label\":\"Operating System\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"QualysHostDetectionV2_CL\\r\\n| distinct OperatingSystem_s\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Scan Detection\",\"subTarget\":\"Detection\",\"preText\":\"ScanDetectio\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Vulnerability Analysis\",\"subTarget\":\"VulnerabilityAnalysis\",\"style\":\"link\"}]},\"name\":\"links - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"QualysHostDetectionV2_CL\\n|  extend Sev = tostring(Severity_s)\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\n| where isnotempty(Sev)\\n| summarize ['5 - Urgent'] = countif(Sev == \\\"5\\\"), ['4 - Critical'] = countif(Sev == \\\"4\\\"), ['3 - Serious'] = countif(Sev == \\\"3\\\"), ['2 - Medium'] = countif(Sev == \\\"2\\\"), ['1 - Minimal'] = countif(Sev == \\\"1\\\"),  count() by bin(TimeGenerated, {TimeRange:grain})\\n| project-away count_\\n\\n\",\"size\":0,\"title\":\"Detections by Severity Timeline\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"5 - Urgent\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"4 - Critical\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redDark\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"3 - Serious\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"2 - Medium\",\"formatter\":8,\"formatOptions\":{\"palette\":\"magenta\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"1 - Minimal\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"Total\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}}],\"labelSettings\":[{\"columnId\":\"5 - Urgent\"},{\"columnId\":\"4 - Critical\"},{\"columnId\":\"3 - Serious\"},{\"columnId\":\"2 - Medium\"},{\"columnId\":\"1 - Minimal\"}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"5 - Urgent\",\"color\":\"redBright\"},{\"seriesName\":\"4 - Critical\",\"color\":\"redDark\"},{\"seriesName\":\"3 - Serious\",\"color\":\"orange\"},{\"seriesName\":\"2 - Medium\",\"color\":\"magenta\"},{\"seriesName\":\"1 - Minimal\",\"color\":\"lightBlue\"}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Detection\"},\"name\":\"query - 2 \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"QualysHostDetectionV2_CL\\n| extend Sev = tostring(Severity_s)\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\n| extend Status = tostring(Status_s)\\n| summarize count() by Status\\n\\n\",\"size\":0,\"title\":\"Detection Status\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"5 - Urgent\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"4 - Critical\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redDark\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"3 - Serious\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"2 - Medium\",\"formatter\":8,\"formatOptions\":{\"palette\":\"magenta\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"1 - Minimal\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"Total\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}}],\"labelSettings\":[{\"columnId\":\"5 - Urgent\"},{\"columnId\":\"4 - Critical\"},{\"columnId\":\"3 - Serious\"},{\"columnId\":\"2 - Medium\"},{\"columnId\":\"1 - Minimal\"}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"5 - Urgent\",\"color\":\"redBright\"},{\"seriesName\":\"4 - Critical\",\"color\":\"redDark\"},{\"seriesName\":\"3 - Serious\",\"color\":\"orange\"},{\"seriesName\":\"2 - Medium\",\"color\":\"magenta\"},{\"seriesName\":\"1 - Minimal\",\"color\":\"lightBlue\"}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Detection\"},\"customWidth\":\"50\",\"name\":\"query - 2  - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = QualysHostDetectionV2_CL\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\n| extend Sev = tostring(Severity_s)\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\n| extend Vulnerability = tostring(QID_s)\\n| extend Severity = case(Sev == \\\"5\\\", \\\"5 - Urgent\\\", Sev == \\\"4\\\", \\\"4 - Critical\\\", Sev == \\\"3\\\", \\\"3 - Serious\\\", Sev == \\\"2\\\", \\\"2 - Medium\\\", Sev == \\\"1\\\", \\\"1 - Minimal\\\", \\\" \\\")\\n| extend Status = tostring(Status_s)\\n| where Status == \\\"Re-Opened\\\"\\n| summarize count() by Sev, Severity, Vulnerability ;\\nlet topUrgent = data \\n| where Sev == \\\"5\\\"\\n| top 10 by count_;\\nlet topCritical = data\\n| where Sev == \\\"4\\\"\\n| top 10 by count_;\\nlet topSerious = data\\n| where Sev == \\\"3\\\"\\n| top 10 by count_;\\nlet topMedium = data\\n| where Sev == \\\"2\\\"\\n| top 10 by count_;\\nlet topMinimal = data\\n| where Sev == \\\"1\\\"\\n| top 10 by count_;\\nunion topUrgent, topCritical, topSerious, topMedium, topMinimal\\n| project-away Sev\\n| sort by Severity, count_ desc\\n| project-rename Total = count_\\n\\n\",\"size\":0,\"title\":\"Top 10 Re-Opened Vulnerabilities by Severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"5 - Urgent\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"4 - Critical\",\"representation\":\"redDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"3 - Serious\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"2 - Medium\",\"representation\":\"magenta\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"1 - Minimal\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"[variables('blanks')]\",\"representation\":\"[variables('blanks')]\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Total\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Detection\"},\"customWidth\":\"50\",\"name\":\"query - 2 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = QualysHostDetectionV2_CL\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\n| extend Sev = tostring(Severity_s)\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\n| extend Vulnerability = tostring(QID_s)\\n| extend Severity = case(Sev == \\\"5\\\", \\\"5 - Urgent\\\", Sev == \\\"4\\\", \\\"4 - Critical\\\", Sev == \\\"3\\\", \\\"3 - Serious\\\", Sev == \\\"2\\\", \\\"2 - Medium\\\", Sev == \\\"1\\\", \\\"1 - Minimal\\\", \\\" \\\")\\n| extend Status = tostring(Status_s)\\n| where Status == \\\"New\\\" and Sev in (\\\"5\\\", \\\"4\\\")\\n| summarize count() by Sev, Severity, IPAddress, DnsName_s;\\nlet topUrgent = data \\n| where Sev == \\\"5\\\"\\n| top 10 by count_;\\nlet topCritical = data\\n| where Sev == \\\"4\\\"\\n| top 10 by count_;\\nunion topUrgent, topCritical\\n| project-away Sev\\n| sort by Severity, count_ desc\\n| project-rename Total = count_\\n\\n\",\"size\":0,\"title\":\"Top 10 Host with New Urgent/Critical Vulnerabilities\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"5 - Urgent\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"4 - Critical\",\"representation\":\"redDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"3 - Serious\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"2 - Medium\",\"representation\":\"magenta\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"1 - Minimal\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"[variables('blanks')]\",\"representation\":\"[variables('blanks')]\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Total\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Detection\"},\"customWidth\":\"50\",\"name\":\"query - 2 - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = QualysHostDetectionV2_CL\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\n| extend Sev = tostring(Severity_s)\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\n| extend Vulnerability = tostring(QID_s)\\n| extend Severity = case(Sev == \\\"5\\\", \\\"5 - Urgent\\\", Sev == \\\"4\\\", \\\"4 - Critical\\\", Sev == \\\"3\\\", \\\"3 - Serious\\\", Sev == \\\"2\\\", \\\"2 - Medium\\\", Sev == \\\"1\\\", \\\"1 - Minimal\\\", \\\" \\\")\\n| extend Status = tostring(Status_s)\\n| where Status == \\\"Re-Opened\\\" and Sev in (\\\"5\\\", \\\"4\\\")\\n| summarize count() by Sev, Severity, IPAddress, DnsName_s;\\nlet topUrgent = data \\n| where Sev == \\\"5\\\"\\n| top 10 by count_;\\nlet topCritical = data\\n| where Sev == \\\"4\\\"\\n| top 10 by count_;\\nunion topUrgent, topCritical\\n| project-away Sev\\n| sort by Severity, count_ desc\\n| project-rename Total = count_\\n\\n\",\"size\":0,\"title\":\"Top 10 Host with Re-Opened Urgent/Critical Vulnerabilities\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"5 - Urgent\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"4 - Critical\",\"representation\":\"redDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"3 - Serious\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"2 - Medium\",\"representation\":\"magenta\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"1 - Minimal\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"[variables('blanks')]\",\"representation\":\"[variables('blanks')]\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Total\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Detection\"},\"customWidth\":\"50\",\"name\":\"query - 2 - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"QualysHostDetectionV2_CL\\n| extend Sev = tostring(Severity_s)\\n| where isnotempty(Sev)\\n| summarize ['5 - Urgent'] = countif(Sev == \\\"5\\\"), ['4 - Critical'] = countif(Sev == \\\"4\\\"), ['3 - Serious'] = countif(Sev == \\\"3\\\"), ['2 - Medium'] = countif(Sev == \\\"2\\\"), ['1 - Minimal'] = countif(Sev == \\\"1\\\"),  count() by OperatingSystem_s\\n| project-rename Total = count_\\n| sort by Total desc \\n| top 10 by Total\\n\\n\",\"size\":0,\"title\":\"Top Total Detections by Operation System\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"5 - Urgent\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"4 - Critical\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redDark\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"3 - Serious\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"2 - Medium\",\"formatter\":8,\"formatOptions\":{\"palette\":\"magenta\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"1 - Minimal\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"Total\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}}],\"labelSettings\":[{\"columnId\":\"OperatingSystem_s\",\"label\":\"Operating System\"},{\"columnId\":\"5 - Urgent\"},{\"columnId\":\"4 - Critical\"},{\"columnId\":\"3 - Serious\"},{\"columnId\":\"2 - Medium\"},{\"columnId\":\"1 - Minimal\"},{\"columnId\":\"Total\"}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Detection\"},\"name\":\"query - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = QualysHostDetectionV2_CL\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\n| extend Sev = tostring(Severity_s)\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\n| extend Vulnerability = tostring(QID_s)\\n| extend Severity = case(Sev == \\\"5\\\", \\\"5 - Urgent\\\", Sev == \\\"4\\\", \\\"4 - Critical\\\", Sev == \\\"3\\\", \\\"3 - Serious\\\", Sev == \\\"2\\\", \\\"2 - Medium\\\", Sev == \\\"1\\\", \\\"1 - Minimal\\\", \\\" \\\")\\n| summarize count() by Sev, Severity, Vulnerability ;\\nlet topUrgent = data \\n| where Sev == \\\"5\\\"\\n| top 10 by count_;\\nlet topCritical = data\\n| where Sev == \\\"4\\\"\\n| top 10 by count_;\\nlet topSerious = data\\n| where Sev == \\\"3\\\"\\n| top 10 by count_;\\nlet topMedium = data\\n| where Sev == \\\"2\\\"\\n| top 10 by count_;\\nlet topMinimal = data\\n| where Sev == \\\"1\\\"\\n| top 10 by count_;\\nunion topUrgent, topCritical, topSerious, topMedium, topMinimal\\n| project-away Sev\\n| sort by Severity, count_ desc\\n| project-rename Total = count_\\n\\n\",\"size\":0,\"title\":\"Top 10 Vulnerabilities Detected per Severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"5 - Urgent\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"4 - Critical\",\"representation\":\"redDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"3 - Serious\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"2 - Medium\",\"representation\":\"magenta\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"1 - Minimal\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"[variables('blanks')]\",\"representation\":\"[variables('blanks')]\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Total\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Detection\"},\"customWidth\":\"50\",\"name\":\"query - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = QualysHostDetectionV2_CL\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\n| extend Sev = tostring(Severity_s)\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\n| extend Vulnerability = tostring(QID_s)\\n| extend Severity = case(Sev == \\\"5\\\", \\\"5 - Urgent\\\", Sev == \\\"4\\\", \\\"4 - Critical\\\", Sev == \\\"3\\\", \\\"3 - Serious\\\", Sev == \\\"2\\\", \\\"2 - Medium\\\", Sev == \\\"1\\\", \\\"1 - Minimal\\\", \\\" \\\")\\n| summarize count() by Sev, Severity, IPAddress, DnsName_s;\\nlet topUrgent = data \\n| where Sev == \\\"5\\\"\\n| top 10 by count_;\\nlet topCritical = data\\n| where Sev == \\\"4\\\"\\n| top 10 by count_;\\nlet topSerious = data\\n| where Sev == \\\"3\\\"\\n| top 10 by count_;\\nlet topMedium = data\\n| where Sev == \\\"2\\\"\\n| top 10 by count_;\\nlet topMinimal = data\\n| where Sev == \\\"1\\\"\\n| top 10 by count_;\\nunion topUrgent, topCritical, topSerious, topMedium, topMinimal\\n| project-away Sev\\n| sort by Severity, count_ desc\\n| project-rename Total = count_\\n\\n\",\"size\":0,\"title\":\"Top 10 Detections by Host per Severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"5 - Urgent\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"4 - Critical\",\"representation\":\"redDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"3 - Serious\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"2 - Medium\",\"representation\":\"magenta\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"1 - Minimal\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"[variables('blanks')]\",\"representation\":\"[variables('blanks')]\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Total\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Detection\"},\"customWidth\":\"50\",\"name\":\"query - 2 - Copy - Copy\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"d7f3f8af-5b1a-46b1-8fe6-a0440175704a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Vuln\",\"label\":\"Vulnerability Detected\",\"type\":2,\"query\":\"QualysHostDetectionV2_CL\\r\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\r\\n| extend Sev = tostring(Severity_s)\\r\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\r\\n| extend Vuln = tostring(QID_s)\\r\\n| distinct Vuln\\r\\n\",\"value\":\"[variables('blanks')]\",\"typeSettings\":{\"additionalResourceOptions\":\"[variables('TemplateEmptyArray')]\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"formVertical\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"VulnerabilityAnalysis\"},\"name\":\"parameters - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"QualysHostDetectionV2_CL\\n| extend Sev = tostring(Severity_s)\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\n| extend Vuln = tostring(QID_s)\\n| where Vuln in (\\\"{Vuln}\\\") or '*' in (\\\"{Vuln}\\\")\\n| summarize ['5 - Urgent'] = countif(Sev == \\\"5\\\"), ['4 - Critical'] = countif(Sev == \\\"4\\\"), ['3 - Serious'] = countif(Sev == \\\"3\\\"), ['2 - Medium'] = countif(Sev == \\\"2\\\"), ['1 - Minimal'] = countif(Sev == \\\"1\\\"),  count() by bin(TimeGenerated, {TimeRange:grain})\\n| project-away count_\\n\\n\",\"size\":0,\"title\":\"Detection Timeline\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"5 - Urgent\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"4 - Critical\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redDark\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"3 - Serious\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"2 - Medium\",\"formatter\":8,\"formatOptions\":{\"palette\":\"magenta\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"1 - Minimal\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"Total\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}}],\"labelSettings\":[{\"columnId\":\"5 - Urgent\"},{\"columnId\":\"4 - Critical\"},{\"columnId\":\"3 - Serious\"},{\"columnId\":\"2 - Medium\"},{\"columnId\":\"1 - Minimal\"}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"5 - Urgent\",\"color\":\"redBright\"},{\"seriesName\":\"4 - Critical\",\"color\":\"redDark\"},{\"seriesName\":\"3 - Serious\",\"color\":\"orange\"},{\"seriesName\":\"2 - Medium\",\"color\":\"magenta\"},{\"seriesName\":\"1 - Minimal\",\"color\":\"lightBlue\"}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"VulnerabilityAnalysis\"},\"name\":\"query - 2  - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"QualysHostDetectionV2_CL\\n| extend Sev = tostring(Severity_s)\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\n| extend Status = tostring(Status_s)\\n| extend Vulnerability = tostring(QID_s)\\n| where Vulnerability in (\\\"{Vuln}\\\") or '*' in (\\\"{Vuln}\\\") \\n| summarize count() by Status\\n\\n\",\"size\":0,\"title\":\"Detection Status\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"5 - Urgent\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"4 - Critical\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redDark\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"3 - Serious\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"2 - Medium\",\"formatter\":8,\"formatOptions\":{\"palette\":\"magenta\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"1 - Minimal\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"Total\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}}],\"labelSettings\":[{\"columnId\":\"5 - Urgent\"},{\"columnId\":\"4 - Critical\"},{\"columnId\":\"3 - Serious\"},{\"columnId\":\"2 - Medium\"},{\"columnId\":\"1 - Minimal\"}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"5 - Urgent\",\"color\":\"redBright\"},{\"seriesName\":\"4 - Critical\",\"color\":\"redDark\"},{\"seriesName\":\"3 - Serious\",\"color\":\"orange\"},{\"seriesName\":\"2 - Medium\",\"color\":\"magenta\"},{\"seriesName\":\"1 - Minimal\",\"color\":\"lightBlue\"}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"VulnerabilityAnalysis\"},\"customWidth\":\"50\",\"name\":\"query - 2  - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"QualysHostDetectionV2_CL\\n| where OperatingSystem_s in ({OperatingSystem}) or '*' in ({OperatingSystem})\\n| extend Sev = tostring(Severity_s)\\n| where Sev in ({severitySelector}) or '*' in ({severitySelector})\\n| extend Vulnerability = tostring(QID_s)\\n| where Vulnerability in (\\\"{Vuln}\\\") or '*' in (\\\"{Vuln}\\\")\\n| summarize Total = count() by IPAddress, DnsName_s\\n| sort by Total desc\\n\\n\\n\\n\",\"size\":0,\"title\":\"Host(s) with Vulnerability Detected\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"5 - Urgent\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"4 - Critical\",\"representation\":\"redDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"3 - Serious\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"2 - Medium\",\"representation\":\"magenta\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"1 - Minimal\",\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"[variables('blanks')]\",\"representation\":\"[variables('blanks')]\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Total\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2}}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\",\"showIcon\":true}},\"showBorder\":false,\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"VulnerabilityAnalysis\"},\"customWidth\":\"50\",\"name\":\"query - 2 -\"}],\"fromTemplateId\":\"sentinel-QualysVMV2Workbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=QualysVMV2Workbook; logoFileName=qualys_logo.svg; description=Gain insight into Qualys Vulnerability Management by analyzing, collecting and correlating vulnerability data.\nThis workbook provides visibility into vulnerabilities detected from vulnerability scans; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Qualys Vulnerability Management; templateRelativePath=QualysVMv2.json; subtitle=; provider=Qualys}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "QualysVM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "QualysHostDetectionV2_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "QualysVulnerabilityManagement",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "QualysVM Analytics Rule 1 with template",
        "displayName": "QualysVM Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName1'),'/',variables('analyticRuleVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "HighNumberofVulnDetectedV2_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This Creates an incident when a host has a high number of Urgent, severity 5, vulnerabilities detected.",
                "displayName": "High Number of Urgent Vulnerabilities Detected",
                "enabled": false,
                "query": "let threshold = 10;\nQualysHostDetectionV2_CL\n| where Severity_s == \"5\"\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), count() by NetBios_s, IPAddress\n| where count_ >= threshold\n| extend timestamp = StartTime, HostCustomEntity = NetBios_s, IPCustomEntity = IPAddress\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "QualysHostDetection_CL"
                    ],
                    "connectorId": "QualysVulnerabilityManagement"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "HostCustomEntity",
                        "identifier": "FullName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "QualysVM Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "QualysVM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "QualysVM Analytics Rule 2 with template",
        "displayName": "QualysVM Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName2'),'/',variables('analyticRuleVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "NewHighSeverityVulnDetectedAcrossMulitpleHostsV2_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This creates an incident when a new high severity vulnerability is detected across multilple hosts",
                "displayName": "New High Severity Vulnerability Detected Across Multiple Hosts",
                "enabled": false,
                "query": "let threshold = 10;\nQualysHostDetectionV2_CL\n| extend Status = tostring(Status_s), Vulnerability = tostring(QID_s), Severity = tostring(Severity_s)\n| where Status =~ \"New\" and Severity == \"5\"\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), dcount(NetBios_s) by tostring(QID_s)\n| where dcount_NetBios_s >= threshold\n| extend timestamp = StartTime\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "QualysHostDetection_CL"
                    ],
                    "connectorId": "QualysVulnerabilityManagement"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190"
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "QualysVM Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "QualysVM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "properties": {
        "description": "QualysCustomConnector",
        "displayName": "QualysCustomConnector"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('playbookTemplateSpecName1'),'/',variables('playbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "QualysCustomConnector Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "Connector Name": {
              "defaultValue": "QualysCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Name of the custom Qualys Connector."
              }
            },
            "Service Endpoint": {
              "defaultValue": "https://",
              "type": "String",
              "metadata": {
                "description": "Enter the Qualys API Endpoint, Make sure to prefix with https:// e.g. https://qualysapi.qualys.com"
              }
            }
          },
          "variables": {
            "operationId-GetPortalDetails": "GetPortalDetails",
            "_operationId-GetPortalDetails": "[[variables('operationId-GetPortalDetails')]",
            "operationId-GetDetectionsByIP": "GetDetectionsByIP",
            "_operationId-GetDetectionsByIP": "[[variables('operationId-GetDetectionsByIP')]",
            "operationId-GetAssetDetailsByIP": "GetAssetDetailsByIP",
            "_operationId-GetAssetDetailsByIP": "[[variables('operationId-GetAssetDetailsByIP')]",
            "operationId-AddIPForScanning": "AddIPForScanning",
            "_operationId-AddIPForScanning": "[[variables('operationId-AddIPForScanning')]",
            "operationId-ReportOperations": "ReportOperations",
            "_operationId-ReportOperations": "[[variables('operationId-ReportOperations')]",
            "operationId-VMScanOperations": "VMScanOperations",
            "_operationId-VMScanOperations": "[[variables('operationId-VMScanOperations')]",
            "operationId-OptionProfileOperations": "OptionProfileOperations",
            "_operationId-OptionProfileOperations": "[[variables('operationId-OptionProfileOperations')]",
            "operationId-ListScannerAppliances": "ListScannerAppliances",
            "_operationId-ListScannerAppliances": "[[variables('operationId-ListScannerAppliances')]",
            "operationId-ScanReportTemplateOperations": "ScanReportTemplateOperations",
            "_operationId-ScanReportTemplateOperations": "[[variables('operationId-ScanReportTemplateOperations')]",
            "operationId-DynamicSearchListOperations": "DynamicSearchListOperations",
            "_operationId-DynamicSearchListOperations": "[[variables('operationId-DynamicSearchListOperations')]",
            "operationId-SearchAssetByCriteria": "SearchAssetByCriteria",
            "_operationId-SearchAssetByCriteria": "[[variables('operationId-SearchAssetByCriteria')]",
            "operationId-AssetCountByCriteria": "AssetCountByCriteria",
            "_operationId-AssetCountByCriteria": "[[variables('operationId-AssetCountByCriteria')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId1": "QualysCustomConnector",
            "playbookId1": "[[resourceId('Microsoft.Web/customApis', parameters('Connector Name'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('Connector Name')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "connectionParameters": {
                  "Username": {
                    "type": "securestring"
                  },
                  "Password": {
                    "type": "securestring"
                  }
                },
                "backendService": {
                  "serviceUrl": "[[parameters('Service EndPoint')]"
                },
                "brandColor": "#FFFFFF",
                "capabilities": "[variables('TemplateEmptyArray')]",
                "description": "Qualys VM is a cloud-based service that provides users immediate global visibility into IT inventory vulnerabilities and helps continuously monitor latest Internet threats.",
                "displayName": "[[parameters('Connector Name')]",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAACWOSURBVHhe7d09ci3HkQZQYhwaiqAxnjYw5mxBplZAg74MWTK0EBq0aNCnwRXI1BbGnAVceWMwggYtDPIBJVz8XKD/uyrznAgEQYlEP+J2V36VVd19d//gX//611dL/fGPf3z6bj7Hnc5xp+v1uPGz45/57Bjtn4m/fvPLz0//60u///TjV1//5a9Pf/f490eKY7c/w+s/y7Vfv/3u6btHa36/Ta+f70ccdzrHnW7tcQWAmRx3umrHvaX9ea6L+dEFu3fXAaKFho8+i6WfsfN5OsedbtTjCgAzOe50VY4bx2vFXWHfz9SQ8NHn73yeznGnG/W4AsBMjjtdluO2n6fI960FhFvhID5H5/N0jjvdqMcVAGZy3Ol6P+7rY8S/p8jndB0Olp5brqPpHHe6M4/7H0/fQ2pxobSvEIX+tx++/+r//vu//v319Z//9KXwK/75tM81PuPrzzzOgfiCigQA0vms2Cv0NO08eC8UrJmZwQgEAFJpg7diz1LtfLnuFsQ51ZaHXgdMGJUAwLBihnZd7ONLsWcPt0JBEAgYlQDAMG7N7uEMtwJBEAgYgQBAV64HztcFv83CoEctELRQEOduLBsIAvRKAOB0rei/3qyn4DOydv628znObRsL6YkAwOGuZ/lR9BV8Kohz+9aSAZxBAOAQ783yreFTme4AZxMA2I1ZPkzzUXegXUewtbvL5XK/5gRbk1odd7oRjtuOE/9OFH2FHtaLxxj/4W9/f/q7eYxX01U8rg4Aq8RJ1E5grX3YXlxL73UGYC0BgNkUfTiHMMCWBAAmUfShL8IAawkAfEjRh/4JAywhAHBTbDBR9GEs12EgNuNed+/gmgDAC1H0r2f7wLhaGGhdAWGAawIAX2jxQ15xTce1/ToMUJsAUFhr8ceXog81XIeBoCtQlwBQkBY/EHQFahMAijDbB25pXQFBoBYBIKnW1mvP4TfbBz7z3l4B8hIAkmnJvbX5zfaBJWLsEARyEwCSuC78keAVfmALgkBeAsDgWuFvbX6FH9hDCwLxteYtdPTj7v7Bmg+zFaAlHHe6944bP8/aPnCW9qri12Ob8Xm6M4+rAzCgtr6v+ANnal2B9shhxiIADKBdWDb2AT0SBMYkAHQsLqT4UviBEbQgYMPgGASADin8wMgEgTEIAJ1R+IEsBIG+CQAdaDP+9tQ+hR/IRBDokwBwsij8cTuGwg9k14LAmlvf2I4AcJIo/CEuBrfzAZXEmCcInE8AOJjCD/AoxkDLAucRAA4UxT9OdoUf4NHr/QFtksT+BICDxMkdJ7l1foC3roOAEHAMAWBnNvgBTNeCQBAE9iUA7ChOYu1+gPnaRsEgCOxDANhBa/cDsE7bKCgEbO/ucrncr/nFrrmNI9Nx42fG/2fGD7CP3//xzw/Hb/VoujiuDsBK8UuML+1+gH21bgDbEABWiMKv3Q9wnNe3DbKcALBAa9nESWh3P8Dxru8WYBkBYKY269fuBzifbsByAsBMZv0AffHsgGUEgIms9QP0zS2D8wgAE5j1A4xBN2A6AeADZv0AY9IN+JwAcINZP8DYdAM+JgC8Ek9WMusHyCO6ATG2CwEvCQBXol3k9j6AfGJsj8mdEPBMAHii5Q+QnyWBZ+UDgI1+ALXYIPiodAAw6weoqW0QrBwC7u4fVHyForV+AMJ//s//fvnr0po0ah0sFwCi7WPWTyVf/+WvT9/N4zqhkrhO/vC3vy+qSwLAAkcfV/Eng1bQf/32uy9/XXMNrtGu329++fnLX11bjG5pCBAAFjjyuDb6MZLrIn9WgV8rrm/hgBHFksCc+iQALHDUcRV/epWh0M8V171gQO9+/8c/v1yTU+rUCHXwtThu6gCg5U9vouBXKvZTxVgQocD1Sk+mLgkIAAvseVzFnx4o+MvE2CAQ0IMpIUAAWGCv4yr+nEXB30eMFQIBZ/ksBAgAC+xxXOv9HK0NDhxHyOcMtzYHjhoAUj0JUPHnKFH0YzCIL8X/ePE7b7//+CzgCNmeHJgmACj+7E3R75MwwJEy1ZoUAUDxZy+K/liEAY7QHiU/ejdg+ACg+LOHVvgV/XG1MCAIsIcIAWvW73swdABQ/NmS2X5OugLsZfSXyg0bABR/tmK2X4euAFsbuRNwd7lc7ke7hUHxZwvtUZ/UFeOXV4OzhQiWS+rhmfU3zV0AMEXM/KLwx8Wq+BPnQJwLcU7oClCNAEAJ121+hZ/X4pywPEA1AgCpXRd+mEIQoAoBgLQUftZoQQCyGi4AjLrbkuO0NX7YQpxLcU7BR0asTToApGFzH3u53iwIWQwXAOKVoHCtrfMr/OytBQH7A3gtatNoY5AOAMOywY+z2ChIBgIAQ4pWrMLP2eIctCxA+P2nH5++G8dwAWDEXzLb0e6nN5YFGJUOAMPQ7qdnbVkARiEA0L0264cR6AYwCgGArpn1MyLdAEYgANAls34y0A2gZ3f3D9a+UnCpJcf16s78FH4y8hrz/OKOkLk18cz6qwNAN8z6yUw3gN4IAHTBff1UEOe45wbQi6ECgMcA5xQzI/f1U0V7bgD5jFajhgkACkQ+Wv5UZkmAs1kC4BQx8Gn5U11cA0IAZxnmLoA4jl20OZj1w1vGtxzmjm/uAqAMxR/e59rgaAIAh7DeD5+La8SSAEcRANid9X6Yzr4AjiIAsCvFH+YTAjiCAMBuPNwHlotrx0OD2JMAwC5iLdOzG2CduIbsnWEvwwSANbdKcCwDFmzLNTWOkWqVDgCbMlDBPlxbbO3ucrncH/Uwn9fmHDeO41XAfTNAwf48MKhvc/dtnFl/dQDYhOIPx3CtsZVhAoA3AfbLgATHcs31K2rVmln9kXQAWMVABOdw7bGWAMBiBiA4l2uQNQQAFjHwQB9ciyw1TAD4/acfn77jbAYc6Itrsh8j1SodAGYx0ECfXJvMJQAwmQFmXHG/8JwvxuQaZY5hHgTk4RfniodbjHJrSzVxDbbbZPduP7Y31P367XfOh07F+eChaeeKIDa1Np5ZfwUAPuWVvn04stAvEeeJYNCH33743r6pEwkAEwgA/VP8z9MK/qgDeesWOH/OIQScRwCYQADom+J/rNEL/mcEguMJAecQACYQAPpmQ9H+shf9jwiYxzB2Hm/OC4HOrL/uAuBdiv9+4qKNmVkMzLFZq+oMLf6743cQX/H7YB+u5eOtKepHurt/cNQs/rWpx41jSLHHMWDsQzt2Gnec7MMYepw5Y+iZ9XeIDsCaXxDztHVathHnbpvlKv7TRFdEV2B7rm1eswTAv1mT3c51i59lrpcITALWi2tbCDjGKOerAMC/Kf7rtcJvtr+t1hUQBNZxjXNNAOAL6/7rKPzHsDywnmudRgBAW3AFhf8cbXlAR2AZ1zxBACjOuv8yCn8fLA0sYz8AYYgA0J5/zvYU/3mi0Cj8/WlBgOlc+/sZpWZ1HwDcD7yfOU+r4vE+arv6+xafkf0B0xkDaus+AGjt7SPaf8LVNK3dzxjsD5guxgBLAXXpABSl/fc57f6xWRaYxlhQlw5AQW4D+lzM+rX7c7As8DljQk06AMVo933OrD+ftizAbcaGenQAitHuu81af37x+RpT3mdsqEcHoBBtvtvM+uuIpR1LAu8zRtRyd7lc7tcU2TVpeupxzcrWi/aehP8+51ddCt5bEY6E4fXi3JpSH8+sv913ANiG4v9WXDyKf22WBN4yVtQhABTgYR9v2eVPY0ngLWNGDQJAAfZRvGS9n9fifBACnhkzahAAkrPG+ZKWP7e4VfAlY0d+AkBi7ut9yeDOFM6TZ8aQ3ASAxGzmeWZQZw7nyyNjSG4CQFKS+zODOUs4bx4ZS/ISAJKS3D3Zj/WcP8aSzASAhCT2x3v87fRnC0KAMSUrASCh6ok9ir97/NlS9RCgC5CTAJCMB3g8zFYUf3ZQPQQYW+YZ4QmTAkAy1R/goV3LniqfXx4ONM8Ivy8BIJHqCV3x5wiVzzNdgOl0ADhU5YSu+HOkquebLsB0I/yu7u4frEkqa/4jpxw3fr7B/XORzKtenM4PzlLxcbk22U4z9dw4s/7qACRRtfh7gQtnqnj+VR1rMhIAEqh6j24Mvu7150xV3yLouQA5CAAJVLxHN9pXij89iPNwTRt3RJ4LkIMAMLiqSdwaJD2peD66I2B8AsDgKiZxm/7oUbXz0l6A8QkAA6s4+7fpj55VOz/tBRibADCwarN/6/70rtp+AHsBxiYAMAzr/ozAecooBIBBVduAY92fkVQ6X20GHJcAMKhKG3Cs+zOiKksBNgOOSwAYULWNN9b9GVGlpQCbAcckAAyo0sYbrX9GVuX8tRlwTAIA3ar2dDVych7TKwFgMJVabXZTk0GV89hmwPHcXS6X+zWbONak2ynHjZ+vEDyr8vpRL/ohkwjuFdrkluyeTQ1EZ9ZfHYCBVJr9K/5kUuV8thlwLALAQH799run73IziyCjCrezVhmjshAABlLhflsbpsiqwmOCK4xRmQgAg6jSWrPfg8wqnN+WAcYhAAyiQmvNE/+oIHsXwDLAOASAQVRordn4RwXZuwCWAcYhAAygQkvN2j+VZD/fLQOMQQCgC9b+qcT5Tg8EgAFkf4CItX8qytwF8G6AMQgAnM7aPxXpAnA2AaBz2dfSrP1DTtX3AXzzy89P3/Wr+wBQfUdp9laaWRCVZV7+qr4MMMJ/vw4AwEksf+U1QndTAOA0Nv+B6yCrEbrXd/cP1iSVNf+RU44bP7/qy2FiDS1zG81Lf+BR1td8R7ip2uWY+pmeWX91ADqWufib9UB+1fcB9E4A4BTWPuGZQMwZBACAkwnEnEEA6FTme2jNduCtEXaNL+G9AP0SADqV+ZWaZjvw1ggPjlnC64H7JQB0qvoDkKCarMHYWNYvAYBDaf/DbVmXAeiTANChzGtm2v9wW9ZlAPsA+iQAAHRCQOZIAkCHsm6a0f6HmmwE7JMA0KGsm2bMbuBzGYOyjYB9EgAAOiIocxQBgEPY3QzQFwGgM1l3y2bd3QxM406A/txdLpf7ta8UXGrqcSu9NjYukoxv0PLqX5gu4zgQexsqLW/E64Cn1Mcz668OQGfslgUyFspqY9sIy54CQGcy7pa1/g9kHNs+MsJ/rwDA7qz/A/RHAGB3bmuC+XTO2JsAANAhnTP2JgAAQEECQEcy3ierjQnLZFw68yyAvggA7EobE6BPAgAAFCQAdCTjgzLcAQDLZVtC86CzvggAAFCQANCRak/KAj6WbQ+NMa4vAgC7cQcAQL+GCABuHQEqsodmTKPUrLv7B2tmamtaOlOOGz+/ymsk4/WRmVR7/SfsIdu4UOHV4HNe53xm/e2+A6CNDADb6z4A2DQCANvTAWA32v8A/dIBAICCdAAAoCAdAAAoSAcAAArqPgAEL5AAYBSj1KwhAgAAsC0BAAAKEgAAoCABAAAKEgAAoCABAAAKurtcLvdrXym41JzjVniFpNd+Aq8ZF8YTn9nU2nhm/dUBAIANjfIAOwEAoFNf/+WvT98xklEeYS8AAMCGdAAAWMVj0MekAwAAV0aZGa+lA8Bs2S4O65ewzigzSV7SAQAAuiUAAHCIb375+ek7eiAAdCTbxWEDEyxnCY29CQAAHcoYoH//6cen7+iBAMBubGCC5Vw/7E0A6Ih0DMBRhgkA1sOAKox34xrps9MBAICC7u4frHkAzZp1qqnHjWP89sP3JVrk2V79WeVzgy1lGwdCjPdf//lPT3+XV3QA/vC3vz/93efOrL9DdADW/IIAOJ9nAPRniABQaTdstrDjWQAwj/V/jmIPQGeypWS3MsE8WUNzlaXAkT6/YZYAzCSBCoRmjqID0Bkb5qAu7X+OJACwO4MaTJO102kjd58EAIBOZG3/V7oDYKTPcJgAYF1sXHPuiYWqMnfKLG32SQegQ9plUI+gzNEEgA55YAYAexMAOpSxXWYjINz2+z/++fRdPjqa/RIAOITnOMBtmfc46Wj2a5gAECnSLHJcNnHC+7KPa5U2AI72WQ4TAKoVEG0zqMHmP85yd7lc7tcU1zWFau5xK71aNpJktoHBq4HhrYyv/r32f//9X0/f5Rfj9tzlzjPr71B7ACqtI2cslGY68FLmzX8hQn8lo9WooQJAtWUAILfsY5qOX9/cBcChbOSER9ln//RPAOhYxvaZZQB4lH32X3Ej82ifqQAAcLAKs3/3//dPAOhY1vUzywBUV2E/k/X//g0XABSP8VkGoDJr/zmNWJt0ADpX7TYayK7C7L/quDXavofhAoBnyuegk0NF2R/601Rs/49Ym4YLABXS87WsF5JlAKoRenMbsTZZAgA4QJXQq/0/DgFgAFkvKJuhqKLS7L/q7n8dgINUa6VlvaCqLedQlyWv3EatSToAnMq6KNlV2fgXKt+1NOISwN39g7WvFFxqzXG//vOfnr6rIQpl1llEpdeFUkvm6/Y9Va/lWM5cWgvPrL86AJxOF4CstP5rGHU5c8gAUHHtOPPGGoMkGVVq/QcPLRvPkAEgWhcVZ41rWkW90wUgk4rnc9Xd/yN/1joAA8n8di1dADKpdj5nnpxkNmwHoOIjgbMnbF0AMqjW+g/VNmVfG7kWDbsJsGoXIHPS1gVgdEIsIxk2AFSVPWkbQBlZxRBbffPfyJPRoQOAYpGPLgCjqtj6D1U3/4XRa5AOwICyb7gR7BhN1eLv1r+xx+OhA0DV2WL2ZQBdAEZSObBWnv2H0Tej6wDQJV0ARhDnadXA6ta/8TejCwCDyt560wVgBJXP08q3/mUxfACoOlOs0HqLF2xAr6qu+/MoQ+0ZPgBUTuDZuwDRXrMUQI+qF3+b/x7X/0dfBrm7XC73a9Yx1vwCtjhu/IzKr5OtMBB5XTA9qbzu37gmX469Z9fBJeK49gDQPUsB9ELxN/vPJEUAqNwmrnAxrknIsBXF/1H1W/9ClpozfACIFkjFFwM1VS5GG644m+Jv9t9kORdSdACqzxCrXJSWAjiLAPrI7D+XNHsAKi8DVLkoI+hV/pw5h+L/yMa/R5nGoBQBYM1OyCyq/A60YTmS4v/IGJtTmg5A9cJQ6alcBmWO4Dx75ql/zzLVmjQBgFobdCwFsCfF/5mNf3mlCQDRoqpeFCpt0IkULgSwB8X/JRv/nmUbc1J1ACrfDthUWquzH4CtKf4vmf2/lG3MSRUAPDCm3lqdAZutOJfeMvvPLVUAsAzwqNqOXQM3azmH3nLb30sZa0u6TYCWAWru2BX8WErxf8ttf29lXHJMFwAsAzyqdgHbFMgSiv/73PZXw939gzXFYk3B3eu4sXHF2lXNwc1nz1SK//tcQ++L8+VWzeqxDn4mjpuuAxAsAzxac2KNyp0BTKH4vy/GDMX/rXgPScbxNGUAsAzwqGobz+DOR5wft2n915IyAATrwY+q3sdrkOc9zovb3PP/vqglWSeVaQOAVvCjyu08gz1NDOLOh9u0/m+LJeWsy6lpAwDPKt/Pa9Anir8Jwce0/m/LvKScOgBYBnhWcUNgIwTUpfh/Tuv/tuw1JHUAcOE/q57whYB64jM3BnxM6/9jmdv/wRJAIdWTvhBQh896Gq3/j2W/oyx9ALAM8EzSVxiyi+vdZzyNZ/1/rELtSB8AtABfctELAVlZ75/Ouv/n4lzKvnfKEkBBlTcENkJALvGkNsV/Guv+NCUCQAwOPLPu9yhCgCWi8cXn6Omf07n+P5f10b+vlQgABoe3tAAfmTWOy3r/fJYAp6lSM8osAZjpvRQtQEsBj6KI6BKNRct/PsV/mkq14u5yudyvSTtrisjRx9X6essM6lmcU86R/jln54uOn3X/aZacXyPVwSaOW6YDUKWlM5elgGdxjigu/dLyXyaKhOLPe0rdBWAZ4C1LAW8pMv3R8l9OV2u6akuBZQJAFDkDyPsMEG9FCBAY+xCfhQ7eMtb956l2npXqAEQIMKi/z0DxVgRGmwPPE7973ZjlXNPzVKwNpQJA0AW4zX6At+wLOIdZ/zqK/3wVa0O5AKALcJuNQrdZEjiGWf96iv98Va/tcgEg6ALcZvC4zZLAvsz619PFWyZe+1tRyQDAxwwit1kS2I/zbp34/eniLVM1eJYNAGZyt8UgYjD+mCWB7cV5Fx0o5958iv9yUQuq3gpdNgBoNX7MYPK5WBLQDdheCwLx5RkVn1P816lcC0ovAZjBfcx+gGl0A/YTz6gQBG5T/NeJ67byuVU6ANgM+DkhYBrdgH21IBAFTxh4pPivV70GlN8EaC/A52KgYRrdgH1FwbsOA1Up/utVn/2H8gHAXoDPxUBj1jWdbsAx4ryMIFAtDCj+29AB/uqru/sHawb3NQW0h+PGz3FBTaOozRfnmnctHCtmdnFfd8Zwb6zaRpwjrwNAxTpYPgCE+FnWuqcRApYxcJ8nlvnWjBe9MEZt571xrGIdLL8E0Fi3ncYgtIxlgfO0PQNtqWDNgHsW1912jPXPBIAHMSBYD5rOYLRchAAbT88TXZjRAoHrbVvG+mcCwBXJcLoYOFkm2nYRBJxv5+s5EMSfQ/HflmvuJXsArsTPdMFNFxeTNL2e/QF9i/P86E2Fzol9fLQMV7EO6gC8IiFOFwOUTsB6bX+Ac69Pr7sErVOwV7dA8d+H6+stHYBX4ufqAsyTZZd1D+LcdNvguFqRWdoxMPbs57NNuBXroADwSvxcCXy+GPgsB2wnzlFBIJfrGWh7//z1OKb472fK+FSxDgoA74if7WKcTydge3GuCgKwzmez/1CxDtoD8I4vg671otkUqu3FBR6Dl1sHYRlj+W0CwA3a2cvonOxDEIBljOW3CQA36AIsJwTspwWB+HJ+wsdcIx8TAD4gOS4nBOwvzk9BAG4zhn9MAPhAdAG0XJcTAo4hCMBbxu7P3V0ul/tRdzAuNfe4Ctk6UZw4zpflKxsyKS7GnTl1omId1AGYQAFbJwLUmhOVeeLCjnNWV4CqYvZvzPmcADCRgXSdmJF6bPDx2vKAdihVxFi9ZlZdiQAwkc0k63l3wHl0BaginrJo9j+NADCDgXO9CAEuznNddwWc02Ri9j+PADCDLsA2YjnAxsrzxUDpDgIyifPZBGM6AWAma6nbsRzQjxYEhAFGZePffALAAgbIbcRygE5Af4QBRqP1v4wAsIClgG0JAf0SBhiBMXkZAWAhg+G2hID+CQP0yLm4nACwQKwzSZzb88CgcQgD9MJYvJwAsFAUKhsCt+eBQeMRBjhLnHMsJwCsZMDbns2B43odBlwf7MW5tZ4AsJL2036EgLHFtdECgYcOsTVj73oCwAYMbPuxLyCH64cO6Q6wluXXbdzdP1gzwK659zLTcc1W9xXFQuLPK/Z9xNIPTBEh8r1xXD2aLo6rA7CROCHZj30BuV13BywX8JFbxZ/5BIANGbT2Z0kgv5jVCAS8x3mwLQFgQ1rUx3CrYC0CAU2cByYA2xEANhYDFPuzJFCXQFBTfM6K/7YEgB0YjI5jSQCBIL/4PNdseON9AsAOLAUcK5YEdANoXgcCoWB8Wv/7EAB2EoMOx9IN4Jb3QkEEAqGgf1r/+xEAdmRwOZ4NgkwVgeA6FLQugeu2H/FZaP3vx4OAZpp7XK3p88SAbvBgjRgrvvnl5y/fe1DR8SKYzRmv1aPp4rg6ADuLE5hz6AawVgywrzsF190C9jO3+DOfAHCAGCw4R7td0EDClloweC8UCAbrxe/SNbs/AeAAMVgYFM7lTgH29lm3wBgwTfye1rS2mc4egJnWHFcB6kMMMDFIw9liLLLH4KUITUvHaPVoujiuADDT2uPGTJQ+xMxszecJe4mxogWDUCUcrCn+QT2aLo57d7lc7v3Splt7XK897YtuAKOJMSjjWLLFtageTRfHtQfgYIpNX9omQXcLMIpWMLJNJGJsXFPQmE8AOEG0uehLCwIGIEaQLbCubf2zjABwErcG9sndAvQuCmWm2b9b/s4jAJwk2nhuC+qXZQF6lWkjsVv+ziUAnMh+gL7ZH0BvsnWnrPufSwA4mf0A/RME6IF1f7YmAHTAfoAx2CjIWaL4W/dnawJAB+wHGEvbKGgA4whxnmUq/tb9+yEAdMJ+gPEIAhwh29NDrfv3QwDoiP0AYxIE2EucV5lY9++LANAZIWBcggBbylb8rfv3RwDokP0AYxMEWCtb8bfu3ycBoEOxRiYEjK8FAbcPMke28yXGMuv+fRIAOmVTYB5uH2SqbLf7BcW/X3f3D9Z8OGvaOo77sThWtlYgzzMiuJax+C/Z06QuTLf2uDoAHYsPyEOC8mkdAUsDNIo/ZxAAOhcJz36AnFoQsDxQ25egn6z4G7PGIAB0LgYHmwLzs2Gwpvi847PPxBLXOASAAQgBdVgeqCPjzD8o/uMQAAbiwqrD8kBuGWf+wZP+xiIADMbGmnosD+SSdeav+I9HABiQEFCTrsD4ss78PeZ3TALAoNweWNt1V8DAO4b4rDLO/GNv0pr70TmPADAotwcSoqBYIuhf5uIfe5OE0DEJAANzZwDXrpcIhIF+ZC3+QfEfmwAwOCGA97QwEMVHGDhP5pm/TX/jEwAScHsgt0Txue4MGLCPE7/vrDP/X7/9zrmUgACQhDsDmOJ6v4DOwH7id5yVsSYPASARFyZT6QzsJ3Pxd7tfLneXy+V+1FcZLpX9uBnvM+Y4bWc385n5PzI+T3fmcXUAkokP1TMCWOO6MxDLBGsGmSrid5R95k8+AkAyMRBFCHBnAFuIMGDfwMfid5K56xZjyZpZKv0SABKKEOD2QLb2et+AMJD7Hv9gOSg3ASApIYC9XYeB+Kq2VBD/zYo/IxMAEhMCOFJbKoivmBlnDQTx3xX/jdkp/vkJAMkJAZwhZsYZA0H29f4QY4VbimsQAIoQAjhThkAQf+7MLf8mxoqs3RteEgAK0dKjF6MFgvgzVhAzf8W/DgGgGK09evQ6EPQSCuLPoPiTlQBQkBDACN7rEhwZCuKYFVr+QfGvSQAoSghgNFGMjwgF8bPiZ1eh+NclABQmBDC6rUNB/Pvxs6pQ/GsTAIoTAsjmvVDQgkEUu/cKXvx/8c9UovgjACAEUEILBa+DQXzF/1eJ4k+4u3+w5kQ481WGSznuW/Hzq82AoKKpgd84Od2ox9UB4Is4GXQCIDfXONcEAP5NCIC8XNu8JgDwghAA+bimeY8AwBtCAOThWuYWAYB3CQEwPtcwHxEAuEkIgHG5dvmMAMCnDCQwlrhmI8DDRwQAJhECYAyKP1MJAEwmBEC/vv7LXxV/ZhEAmCUGmBhogL784W9/V/yZRQBgthhogD6Y+bOUAMAiOgHQBzN/lhIAWCwGHiEAzmHmz1oCAKsIAXC8uObM/Fnr7nK53HuF4nSO+1b8/N9++L7cO9XhDK34T2G8mq7icXUAWC1OwhiQfv/HP5/+F2AP0fKfWvzhMwIAm2hJVAiAfUTxhy0JAGxOCIBtKf7sQQBgFwYs2IZrib0IAOwilgQMXLCOa4g9CQDsKgYwtwnCPO7x5wgCALvzrACYzj3+HEUA4BBCAHxO8edIAgCHiYHNmia8L+6eUfw5kgDA4YQAeKndOqv4cyQBgFMIAfDItcBZBABOEwOffQFUFed+XANm/ZxFAOBUNgdSkc1+9EAA4HRCAJUo/vTi7v7BmhPRqxunc9zb4jjxz3/95z89/S+Qz5L1fuPGdI47XRxXB4AutIvAhiiycm7TGwGArkQQsDmQbBR/eiQA0J0IAfYFkEGcw4o/vRIA6FaEgPaAFBiNzX70TgCga7HJxQyK0XisLyMQABiCEMAo2rmq+NM7AYBhxMBqXwC9auv9Cj+jEAAYin0B9Mh6PyMSABiOfQH0xHo/oxIAGJYlAc5mvZ+RCQAMLWZeQgBHs95PBgIAw4sQYEmAo2j5k4UAQBpCAHvT8icTAYBUYoC2JMDWtPzJ6O5yudx7heJ0jjvdmceNf9+rhdlCtPzXnMvB9Tud40639rg6AKQUJ7clAdbS8iczAYDULAmwhJY/FQgApBc7tj09kKns8qcKAYASLAkwhZY/lQgAlGJJgPdo+VORAEA5lgS4puVPVQIAJVkSIGj5U5kAQGmWBGrS8gcBAL60f3UD6tDyh0cCADzRDcitzfqD4g8CALzw67ff2SCYkFk/vCUAwDssCeQRn+Wa561DVgIAvCNmipYExhazfkEObhMA4IYIAZ4ZMCazfvjc3f2DNetiay4yx53Ocafb67i//fD9V7//9OPT39Gj6Nh8tNbvfJ7Ocacb9bg6ADCR2wX7ZqMfzCMAwEz2BvTF7X2wjAAAC+gG9MGsH5YTAGAF3YBzmPXDegIArKQbcCyzftiGAAAb0Q3Yl1k/bEsAgI1EUYqZqecGbC8Kf/xuge0IALChNjPVDdjG9awf2JYAADvQDVjPrB/2JQDATnQDljHrh2MIALAz3YDpzPrhOAIAHOC6GyAIvBW/E7N+OJYAAAdqQSAKnmWB53b/mpeaAMsIAHCS6ssC2v1wrrvL5XLvFYrTOe50jjtdpVcNx6w/Cv/S37XzajrHna7icXUAoANVugFt1r9m4AK2IQBAB1pBzLpJ0CY/6I8AAB25DgIZNgna5Af9EgCgQxEERl8WaO1+oE8CAHRq1GUB7X4YgwAAnRtlWUC7H8YiAMAg2rJAb0GgFX7tfhiLAAADiRAQX79++10XywLxZ1D4YUwCAAzsrG6Adj+MTwCAgR29LNAKf3QggLEJAJDE3kEgfnYco21KBMYmAEAyLQhspd3W1/YfADkIAJBUFO01GwWv7+dX+CEfAQASi016UcTnLAu0df6g8ENed/cP1lzka3YBO+50jjud477Vfv5Hrx2Owj/nlj6/5+kcdzrHnW7tcXUAoIC42OMrdu+/Xhporf45xR8Y3Vdf/T+/mzSmwJqY7QAAAABJRU5ErkJggg==",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "version": "1.0.0",
                    "title": "QualysCustomConnector",
                    "description": "Qualys VM is a cloud-based service that provides users immediate global visibility into IT inventory vulnerabilities and helps continuously monitor latest Internet threats."
                  },
                  "host": "[[replace(replace(parameters('Service Endpoint'),'https://',''),'http://','')]",
                  "basePath": "/",
                  "schemes": [
                    "https"
                  ],
                  "consumes": "[variables('TemplateEmptyArray')]",
                  "produces": [
                    "application/json"
                  ],
                  "paths": {
                    "/qps/rest/portal/version": {
                      "get": {
                        "summary": "Get Portal Details",
                        "description": "It fetches the Qualys Portal Component Versions.",
                        "operationId": "[[variables('_operationId-GetPortalDetails')]",
                        "parameters": [
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "x-ms-summary": "X-Requested-With Header",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "Accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-summary": "Accept Header",
                            "description": "Header to get result in JSON Format",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "$content-type": {
                                  "type": "string",
                                  "description": "$content-type"
                                },
                                "$content": {
                                  "type": "string",
                                  "description": "$content"
                                }
                              }
                            },
                            "headers": {
                              "\"Transfer-Encoding\"": {
                                "description": "\"Transfer-Encoding\"",
                                "type": "string"
                              },
                              "\"Vary\"": {
                                "description": "\"Vary\"",
                                "type": "string"
                              },
                              "\"X-Frame-Options\"": {
                                "description": "\"X-Frame-Options\"",
                                "type": "string"
                              },
                              "\"Strict-Transport-Security\"": {
                                "description": "\"Strict-Transport-Security\"",
                                "type": "string"
                              },
                              "\"X-Xss-protection\"": {
                                "description": "\"X-Xss-protection\"",
                                "type": "string"
                              },
                              "\"X-Content-Type-Options\"": {
                                "description": "\"X-Content-Type-Options\"",
                                "type": "string"
                              },
                              "\"Date\"": {
                                "description": "\"Date\"",
                                "type": "string"
                              },
                              "\"Set-Cookie\"": {
                                "description": "\"Set-Cookie\"",
                                "type": "string"
                              },
                              "\"Content-Type\"": {
                                "description": "\"Content-Type\"",
                                "type": "string"
                              },
                              "\"Content-Length\"": {
                                "description": "\"Content-Length\"",
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    },
                    "/api/2.0/fo/asset/host/vm/detection/": {
                      "post": {
                        "summary": "Get Detections By IP",
                        "description": "Get Vulnerability Details for an IP",
                        "operationId": "[[variables('_operationId-GetDetectionsByIP')]",
                        "parameters": [
                          {
                            "name": "ips",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "IP Address to Fetch Vulnerability Details",
                            "x-ms-summary": "IP Address"
                          },
                          {
                            "name": "action",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "list",
                            "description": "To fetch the Scan Results",
                            "x-ms-summary": "Action",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "truncation_limit",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "default": 100,
                            "description": "Truncate the result to provided limit",
                            "x-ms-summary": "Truncation Limit",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "output_format",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "XML",
                            "x-ms-summary": "Output Format",
                            "description": "Scan Result Output Format",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "x-ms-summary": "X-Requested-With Header",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "$content-type": {
                                  "type": "string",
                                  "description": "$content-type"
                                },
                                "$content": {
                                  "type": "string",
                                  "description": "$content"
                                }
                              }
                            },
                            "headers": {
                              "\"Transfer-Encoding\"": {
                                "description": "\"Transfer-Encoding\"",
                                "type": "string"
                              },
                              "\"Strict-Transport-Security\"": {
                                "description": "\"Strict-Transport-Security\"",
                                "type": "string"
                              },
                              "\"X-XSS-Protection\"": {
                                "description": "\"X-XSS-Protection\"",
                                "type": "string"
                              },
                              "\"X-Content-Type-Options\"": {
                                "description": "\"X-Content-Type-Options\"",
                                "type": "string"
                              },
                              "\"X-Frame-Options\"": {
                                "description": "\"X-Frame-Options\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Limit\"": {
                                "description": "\"X-RateLimit-Limit\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Window-Sec\"": {
                                "description": "\"X-RateLimit-Window-Sec\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Limit\"": {
                                "description": "\"X-Concurrency-Limit-Limit\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Running\"": {
                                "description": "\"X-Concurrency-Limit-Running\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-ToWait-Sec\"": {
                                "description": "\"X-RateLimit-ToWait-Sec\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Remaining\"": {
                                "description": "\"X-RateLimit-Remaining\"",
                                "type": "string"
                              },
                              "\"Date\"": {
                                "description": "\"Date\"",
                                "type": "string"
                              },
                              "\"X-Powered-By\"": {
                                "description": "\"X-Powered-By\"",
                                "type": "string"
                              },
                              "\"Content-Type\"": {
                                "description": "\"Content-Type\"",
                                "type": "string"
                              },
                              "\"Content-Length\"": {
                                "description": "\"Content-Length\"",
                                "type": "string"
                              }
                            }
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    },
                    "/api/2.0/fo/asset/host/": {
                      "post": {
                        "summary": "Get Asset Details By IP",
                        "description": "Get Details of an Asset",
                        "operationId": "[[variables('_operationId-GetAssetDetailsByIP')]",
                        "parameters": [
                          {
                            "name": "ips",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "IP Address to Fetch Asset Details",
                            "x-ms-summary": "IP Address",
                            "x-ms-visibility": "important"
                          },
                          {
                            "name": "action",
                            "default": "list",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "x-ms-summary": "Action",
                            "x-ms-visibility": "internal",
                            "description": "To fetch Asset Details"
                          },
                          {
                            "name": "details",
                            "default": "All",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "x-ms-summary": "Details",
                            "x-ms-visibility": "advanced",
                            "description": "Flag to Fetch Amount of Details",
                            "enum": [
                              "All",
                              "Basic",
                              "None"
                            ]
                          },
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-summary": "X-Requested-With Header",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "$content-type": {
                                  "type": "string",
                                  "description": "$content-type"
                                },
                                "$content": {
                                  "type": "string",
                                  "description": "$content"
                                }
                              }
                            },
                            "headers": {
                              "\"Transfer-Encoding\"": {
                                "description": "\"Transfer-Encoding\"",
                                "type": "string"
                              },
                              "\"Strict-Transport-Security\"": {
                                "description": "\"Strict-Transport-Security\"",
                                "type": "string"
                              },
                              "\"X-XSS-Protection\"": {
                                "description": "\"X-XSS-Protection\"",
                                "type": "string"
                              },
                              "\"X-Content-Type-Options\"": {
                                "description": "\"X-Content-Type-Options\"",
                                "type": "string"
                              },
                              "\"X-Frame-Options\"": {
                                "description": "\"X-Frame-Options\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Limit\"": {
                                "description": "\"X-RateLimit-Limit\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Window-Sec\"": {
                                "description": "\"X-RateLimit-Window-Sec\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Limit\"": {
                                "description": "\"X-Concurrency-Limit-Limit\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Running\"": {
                                "description": "\"X-Concurrency-Limit-Running\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-ToWait-Sec\"": {
                                "description": "\"X-RateLimit-ToWait-Sec\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Remaining\"": {
                                "description": "\"X-RateLimit-Remaining\"",
                                "type": "string"
                              },
                              "\"Date\"": {
                                "description": "\"Date\"",
                                "type": "string"
                              },
                              "\"X-Powered-By\"": {
                                "description": "\"X-Powered-By\"",
                                "type": "string"
                              },
                              "\"Content-Type\"": {
                                "description": "\"Content-Type\"",
                                "type": "string"
                              },
                              "\"Content-Length\"": {
                                "description": "\"Content-Length\"",
                                "type": "string"
                              }
                            }
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    },
                    "/api/2.0/fo/asset/ip/": {
                      "post": {
                        "summary": "Add IP For Scanning",
                        "description": "Add a New IP For Continuous Scanning",
                        "operationId": "[[variables('_operationId-AddIPForScanning')]",
                        "parameters": [
                          {
                            "name": "ips",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "IP Address to Add For Vulnerability Scanning",
                            "x-ms-summary": "IP Address",
                            "x-ms-visibility": "important"
                          },
                          {
                            "name": "action",
                            "default": "add",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "x-ms-summary": "Action",
                            "description": "Default action to Add a New IP for Scanning",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "enable_vm",
                            "default": 1,
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "x-ms-visibility": "internal",
                            "description": "Flag to enable VM Scanning",
                            "x-ms-summary": "Enable VM"
                          },
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-summary": "X-Requested-With Header",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "$content-type": {
                                  "type": "string",
                                  "description": "$content-type"
                                },
                                "$content": {
                                  "type": "string",
                                  "description": "$content"
                                }
                              }
                            },
                            "headers": {
                              "\"Transfer-Encoding\"": {
                                "description": "\"Transfer-Encoding\"",
                                "type": "string"
                              },
                              "\"Strict-Transport-Security\"": {
                                "description": "\"Strict-Transport-Security\"",
                                "type": "string"
                              },
                              "\"X-XSS-Protection\"": {
                                "description": "\"X-XSS-Protection\"",
                                "type": "string"
                              },
                              "\"X-Content-Type-Options\"": {
                                "description": "\"X-Content-Type-Options\"",
                                "type": "string"
                              },
                              "\"X-Frame-Options\"": {
                                "description": "\"X-Frame-Options\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Limit\"": {
                                "description": "\"X-RateLimit-Limit\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Window-Sec\"": {
                                "description": "\"X-RateLimit-Window-Sec\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Limit\"": {
                                "description": "\"X-Concurrency-Limit-Limit\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Running\"": {
                                "description": "\"X-Concurrency-Limit-Running\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-ToWait-Sec\"": {
                                "description": "\"X-RateLimit-ToWait-Sec\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Remaining\"": {
                                "description": "\"X-RateLimit-Remaining\"",
                                "type": "string"
                              },
                              "\"Date\"": {
                                "description": "\"Date\"",
                                "type": "string"
                              },
                              "\"X-Powered-By\"": {
                                "description": "\"X-Powered-By\"",
                                "type": "string"
                              },
                              "\"Content-Type\"": {
                                "description": "\"Content-Type\"",
                                "type": "string"
                              },
                              "\"Content-Length\"": {
                                "description": "\"Content-Length\"",
                                "type": "string"
                              }
                            }
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    },
                    "/api/2.0/fo/report/": {
                      "post": {
                        "summary": "Report Operations",
                        "description": "List, Launch, Fetch and Delete Scan Reports",
                        "operationId": "[[variables('_operationId-ReportOperations')]",
                        "parameters": [
                          {
                            "name": "action",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "x-ms-visibility": "important",
                            "enum": [
                              "list",
                              "launch",
                              "fetch",
                              "delete"
                            ],
                            "default": "list",
                            "x-ms-summary": "Action",
                            "description": "Choose Action According to Operation"
                          },
                          {
                            "name": "id",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "x-ms-visibility": "advanced",
                            "description": "Mandatory for List, Delete and Fetch Actions",
                            "x-ms-summary": "Report ID"
                          },
                          {
                            "name": "template_id",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "description": "Mandatory for Launch Action",
                            "x-ms-summary": "Report Template ID",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "report_type",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "x-ms-summary": "Report Type",
                            "description": "Mandatory for Launch Action",
                            "enum": [
                              "Scan"
                            ]
                          },
                          {
                            "name": "report_title",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "Mandatory for Launch Action",
                            "x-ms-summary": "Report Title",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "output_format",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "x-ms-visibility": "advanced",
                            "description": "Mandatory for Launch Action",
                            "enum": [
                              "pdf",
                              "html",
                              "mht",
                              "xml",
                              "csv",
                              "docx"
                            ],
                            "x-ms-summary": "Output Format"
                          },
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "x-ms-summary": "X-Requested-With Header",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "body": {
                                  "type": "string",
                                  "description": "body"
                                }
                              }
                            },
                            "headers": {
                              "\"Transfer-Encoding\"": {
                                "description": "\"Transfer-Encoding\"",
                                "type": "string"
                              },
                              "\"Strict-Transport-Security\"": {
                                "description": "\"Strict-Transport-Security\"",
                                "type": "string"
                              },
                              "\"X-XSS-Protection\"": {
                                "description": "\"X-XSS-Protection\"",
                                "type": "string"
                              },
                              "\"X-Content-Type-Options\"": {
                                "description": "\"X-Content-Type-Options\"",
                                "type": "string"
                              },
                              "\"X-Frame-Options\"": {
                                "description": "\"X-Frame-Options\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Limit\"": {
                                "description": "\"X-RateLimit-Limit\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Window-Sec\"": {
                                "description": "\"X-RateLimit-Window-Sec\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Limit\"": {
                                "description": "\"X-Concurrency-Limit-Limit\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Running\"": {
                                "description": "\"X-Concurrency-Limit-Running\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-ToWait-Sec\"": {
                                "description": "\"X-RateLimit-ToWait-Sec\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Remaining\"": {
                                "description": "\"X-RateLimit-Remaining\"",
                                "type": "string"
                              },
                              "\"Date\"": {
                                "description": "\"Date\"",
                                "type": "string"
                              },
                              "\"X-Powered-By\"": {
                                "description": "\"X-Powered-By\"",
                                "type": "string"
                              },
                              "\"Content-Type\"": {
                                "description": "\"Content-Type\"",
                                "type": "string"
                              },
                              "\"Content-Length\"": {
                                "description": "\"Content-Length\"",
                                "type": "string"
                              }
                            }
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    },
                    "/api/2.0/fo/scan/": {
                      "post": {
                        "summary": "VM Scan Operations",
                        "description": "List, Launch and Fetch Scan",
                        "operationId": "[[variables('_operationId-VMScanOperations')]",
                        "parameters": [
                          {
                            "name": "action",
                            "default": "list",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "x-ms-summary": "Action",
                            "x-ms-visibility": "important",
                            "enum": [
                              "list",
                              "launch",
                              "fetch"
                            ],
                            "description": "Choose Action According to Operation"
                          },
                          {
                            "name": "ip",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Mandatory for Launch Action",
                            "x-ms-summary": "IP Addresses",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "scan_ref",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Mandatory for List and Fetch Action",
                            "x-ms-summary": "Scan Ref",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "launched_after_datetime",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Get the Scans Launched After DateTime",
                            "x-ms-summary": "Launched After DateTime",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "scan_title",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "x-ms-visibility": "advanced",
                            "description": "Mandatory For Lauch Action",
                            "x-ms-summary": "Scan Title"
                          },
                          {
                            "name": "option_id",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Mandatory for Launch Action",
                            "x-ms-summary": "Option Profile ID",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "iscanner_name",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Mandatory for Launch Action",
                            "x-ms-summary": "Scanner Name",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-summary": "X-Requested-With Header",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    },
                    "/api/2.0/fo/subscription/option_profile/vm/": {
                      "post": {
                        "summary": "Option Profile Operations",
                        "description": "List, Create and Delete Option Profile",
                        "operationId": "[[variables('_operationId-OptionProfileOperations')]",
                        "parameters": [
                          {
                            "name": "action",
                            "default": "list",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "description": "Choose Action According to Operation",
                            "x-ms-summary": "Action",
                            "enum": [
                              "list",
                              "create",
                              "delete"
                            ],
                            "x-ms-visibility": "important"
                          },
                          {
                            "name": "id",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "x-ms-visibility": "advanced",
                            "description": "Mandatory for List and Delete Actions",
                            "x-ms-summary": "Option Profile ID"
                          },
                          {
                            "name": "title",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Mandatory for Create Action",
                            "x-ms-summary": "Profile Title",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "scan_tcp_ports",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "enum": [
                              "none",
                              "full",
                              "standard",
                              "light"
                            ],
                            "description": "Mandatory for Create Action",
                            "x-ms-visibility": "advanced",
                            "x-ms-summary": "Scan TCP Ports"
                          },
                          {
                            "name": "scan_tcp_ports_additional",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Additional Ports for Scanning",
                            "x-ms-visibility": "advanced",
                            "x-ms-summary": "Additional TCP Ports"
                          },
                          {
                            "name": "scan_udp_ports",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "enum": [
                              "none",
                              "full",
                              "standard",
                              "light"
                            ],
                            "description": "Mandatory for Create Action",
                            "x-ms-summary": "Scan UDP Ports",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "scan_udp_ports_additional",
                            "default": "139,445",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Additional Ports for Scanning",
                            "x-ms-summary": "Additional UDP Ports",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "vulnerability_detection",
                            "default": "complete",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "enum": [
                              "complete",
                              "custom"
                            ],
                            "x-ms-visibility": "advanced",
                            "x-ms-summary": "Vulnerability Detection",
                            "description": "Mandatory for Create Action"
                          },
                          {
                            "name": "basic_information_gathering",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "x-ms-visibility": "advanced",
                            "enum": [
                              "all",
                              "register",
                              "netblockonly",
                              "none"
                            ],
                            "description": "Mandatory for Create Action",
                            "x-ms-summary": "Information Gathering"
                          },
                          {
                            "name": "map_tcp_ports_additional",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Mandatory for Create Action",
                            "x-ms-summary": "Map TCP Ports",
                            "x-ms-visibility": "advanced",
                            "default": 1,
                            "enum": [
                              0,
                              1
                            ]
                          },
                          {
                            "name": "map_udp_ports_additional",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Mandatory for Create Action",
                            "x-ms-summary": "Map UDP Ports",
                            "x-ms-visibility": "advanced",
                            "default": 1,
                            "enum": [
                              0,
                              1
                            ]
                          },
                          {
                            "name": "custom_search_list_ids",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "x-ms-visibility": "advanced",
                            "description": "Mandatory If Vulnerability Detection is Custom",
                            "x-ms-summary": "Search List ID"
                          },
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-summary": "X-Requested-With Header",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    },
                    "/api/2.0/fo/appliance/": {
                      "get": {
                        "summary": "List Scanner Appliances",
                        "description": "List All the Available Scanners",
                        "operationId": "[[variables('_operationId-ListScannerAppliances')]",
                        "parameters": [
                          {
                            "name": "action",
                            "default": "list",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "x-ms-visibility": "internal",
                            "description": "Appliance API Action",
                            "x-ms-summary": "Action"
                          },
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-summary": "X-Requested-With Header",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    },
                    "/api/2.0/fo/report/template/scan/": {
                      "post": {
                        "summary": "Scan Report Template Operations",
                        "description": "Create and Delete Scan Report Template",
                        "operationId": "[[variables('_operationId-ScanReportTemplateOperations')]",
                        "parameters": [
                          {
                            "name": "action",
                            "default": "create",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "enum": [
                              "create",
                              "delete"
                            ],
                            "description": "Scan Report Template Actions",
                            "x-ms-summary": "Action"
                          },
                          {
                            "name": "report_format",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Mandatory Action for Create Action",
                            "x-ms-summary": "Report Format",
                            "x-ms-visibility": "advanced",
                            "enum": [
                              "xml"
                            ]
                          },
                          {
                            "name": "template_id",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "x-ms-visibility": "advanced",
                            "description": "Mandatory for Delete Action",
                            "x-ms-summary": "Scan Report Template ID"
                          },
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-summary": "X-Requested-With Header",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "text/xml",
                            "description": "Content-Type",
                            "x-ms-visibility": "internal",
                            "x-ms-summary": "Content-Type"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "string",
                              "x-ms-visibility": "advanced",
                              "description": "Update IP and Port Details in the XML Schema",
                              "title": "Scan Report Template Schema",
                              "format": "binary",
                              "default": "<?xml version=\"1.0\" encoding=\"UTF-8\" ?> <SCANTEMPLATE> \t<TITLE> \t\t<INFO key=\"title\"> \t\t\t<![CDATA[SentinelScanReport]]> \t\t</INFO> \t</TITLE> \t<TARGET> \t\t<INFO key=\"scan_selection\"> \t\t\t<![CDATA[HostBased]]> \t\t</INFO> \t\t<INFO key=\"ips\"> \t\t\t<![CDATA[10.94.16.62]]> \t\t</INFO> \t</TARGET> \t<DISPLAY> \t\t<INFO key=\"display_text_summary\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"graph_status\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"graph_potential_status\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"graph_severity\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"graph_potential_severity\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"graph_ig_severity\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"graph_top_categories\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"graph_top_vulns\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"graph_os\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"graph_services\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"graph_top_ports\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"display_custom_footer\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"display_custom_footer_text\"> \t\t\t<![CDATA[Report Generated by Sentinel Playbook]]> \t\t</INFO> \t\t<INFO key=\"sort_by\"> \t\t\t<![CDATA[vuln]]> \t\t</INFO> \t\t<INFO key=\"cvss\"> \t\t\t<![CDATA[cvssv3]]> \t\t</INFO> \t\t<INFO key=\"host_details\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"metadata_ec2_instances\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_text_summary\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details_threat\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details_impact\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details_solution\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details_vpatch\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details_compliance\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details_exploit\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details_malware\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details_results\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details_reopened\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"include_vuln_details_appendix\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"exclude_account_id\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t</DISPLAY> \t<FILTER> \t\t<INFO key=\"selective_vulns\"> \t\t\t<![CDATA[complete]]> \t\t</INFO> \t\t<INFO key=\"included_os\"> \t\t\t<![CDATA[AIX,ASUS,WINDOWS,LINUX,UBUNTU]]> \t\t</INFO> \t\t<INFO key=\"status_new\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"status_active\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"status_reopen\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"vuln_active\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"vuln_disabled\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"vuln_ignored\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"potential_active\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"potential_disabled\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"potential_ignored\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"ig_active\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"ig_disabled\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"ig_ignored\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"display_non_running_kernels\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"exclude_non_running_services\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"exclude_qids_not_exploitable_due_to_configuration\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"exclude_superceded_patches\"> \t\t\t<![CDATA[1]]> \t\t</INFO> \t\t<INFO key=\"categories_list\"> \t\t\t<![CDATA[Cisco,Debian,Finger,Windows,Ubuntu]]> \t\t</INFO> \t</FILTER> \t<SERVICESPORTS> \t\t<INFO key=\"unauthorized_ports\"> \t\t\t<![CDATA[139,445]]> \t\t</INFO> \t</SERVICESPORTS> </SCANTEMPLATE>"
                            },
                            "required": false,
                            "x-ms-visibility": "advanced"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "body": {
                                  "type": "string",
                                  "description": "body"
                                }
                              }
                            },
                            "headers": {
                              "\"Transfer-Encoding\"": {
                                "description": "\"Transfer-Encoding\"",
                                "type": "string"
                              },
                              "\"Strict-Transport-Security\"": {
                                "description": "\"Strict-Transport-Security\"",
                                "type": "string"
                              },
                              "\"X-XSS-Protection\"": {
                                "description": "\"X-XSS-Protection\"",
                                "type": "string"
                              },
                              "\"X-Content-Type-Options\"": {
                                "description": "\"X-Content-Type-Options\"",
                                "type": "string"
                              },
                              "\"X-Frame-Options\"": {
                                "description": "\"X-Frame-Options\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Limit\"": {
                                "description": "\"X-RateLimit-Limit\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Window-Sec\"": {
                                "description": "\"X-RateLimit-Window-Sec\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Limit\"": {
                                "description": "\"X-Concurrency-Limit-Limit\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Running\"": {
                                "description": "\"X-Concurrency-Limit-Running\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-ToWait-Sec\"": {
                                "description": "\"X-RateLimit-ToWait-Sec\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Remaining\"": {
                                "description": "\"X-RateLimit-Remaining\"",
                                "type": "string"
                              },
                              "\"Date\"": {
                                "description": "\"Date\"",
                                "type": "string"
                              },
                              "\"X-Powered-By\"": {
                                "description": "\"X-Powered-By\"",
                                "type": "string"
                              },
                              "\"Content-Type\"": {
                                "description": "\"Content-Type\"",
                                "type": "string"
                              },
                              "\"Content-Length\"": {
                                "description": "\"Content-Length\"",
                                "type": "string"
                              }
                            }
                          },
                          "400": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "body": {
                                  "type": "string",
                                  "description": "body"
                                }
                              }
                            },
                            "headers": {
                              "\"Transfer-Encoding\"": {
                                "description": "\"Transfer-Encoding\"",
                                "type": "string"
                              },
                              "\"Strict-Transport-Security\"": {
                                "description": "\"Strict-Transport-Security\"",
                                "type": "string"
                              },
                              "\"X-XSS-Protection\"": {
                                "description": "\"X-XSS-Protection\"",
                                "type": "string"
                              },
                              "\"X-Content-Type-Options\"": {
                                "description": "\"X-Content-Type-Options\"",
                                "type": "string"
                              },
                              "\"X-Frame-Options\"": {
                                "description": "\"X-Frame-Options\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Limit\"": {
                                "description": "\"X-RateLimit-Limit\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Window-Sec\"": {
                                "description": "\"X-RateLimit-Window-Sec\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Limit\"": {
                                "description": "\"X-Concurrency-Limit-Limit\"",
                                "type": "string"
                              },
                              "\"X-Concurrency-Limit-Running\"": {
                                "description": "\"X-Concurrency-Limit-Running\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-ToWait-Sec\"": {
                                "description": "\"X-RateLimit-ToWait-Sec\"",
                                "type": "string"
                              },
                              "\"X-RateLimit-Remaining\"": {
                                "description": "\"X-RateLimit-Remaining\"",
                                "type": "string"
                              },
                              "\"Date\"": {
                                "description": "\"Date\"",
                                "type": "string"
                              },
                              "\"X-Powered-By\"": {
                                "description": "\"X-Powered-By\"",
                                "type": "string"
                              },
                              "\"Content-Type\"": {
                                "description": "\"Content-Type\"",
                                "type": "string"
                              },
                              "\"Content-Length\"": {
                                "description": "\"Content-Length\"",
                                "type": "string"
                              }
                            }
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    },
                    "/api/2.0/fo/qid/search_list/dynamic/": {
                      "post": {
                        "summary": "Dynamic Search List Operations",
                        "description": "List, Create and Delete Dynamic Search Lists",
                        "operationId": "[[variables('_operationId-DynamicSearchListOperations')]",
                        "parameters": [
                          {
                            "name": "action",
                            "default": "list",
                            "in": "query",
                            "type": "string",
                            "required": true,
                            "enum": [
                              "list",
                              "create",
                              "delete"
                            ],
                            "description": "Dynamic Search List Actions",
                            "x-ms-summary": "Action",
                            "x-ms-visibility": "important"
                          },
                          {
                            "name": "id",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Mandatory for Delete Action",
                            "x-ms-visibility": "advanced",
                            "x-ms-summary": "Search List ID"
                          },
                          {
                            "name": "show_qids",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "enum": [
                              0,
                              1
                            ],
                            "description": "Flag to hide/show QIDs",
                            "x-ms-summary": "Show QID Flag"
                          },
                          {
                            "name": "cve_ids",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "CVE ID List - Mandatory for Create Action",
                            "x-ms-summary": "CVE IDs",
                            "x-ms-visibility": "important"
                          },
                          {
                            "name": "title",
                            "in": "query",
                            "type": "string",
                            "required": false,
                            "description": "Mandatory for Create Action",
                            "x-ms-summary": "Search List Title",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-summary": "X-Requested-With Header",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    },
                    "/qps/rest/2.0/search/am/hostasset": {
                      "post": {
                        "summary": "Search Asset By Criteria",
                        "description": "Get All Assets for Given Criteria",
                        "operationId": "[[variables('_operationId-SearchAssetByCriteria')]",
                        "parameters": [
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-summary": "X-Requested-With Header",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "text/xml",
                            "description": "Content-Type",
                            "x-ms-summary": "Content-Type",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "Accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "Accept",
                            "x-ms-summary": "Accept",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "filter-xml",
                            "in": "body",
                            "schema": {
                              "type": "string",
                              "description": "Filter Criteria XML",
                              "title": "filter-criteria",
                              "default": "<ServiceRequest> \t<preferences> \t\t<limitResults>100</limitResults> \t</preferences>     <filters>         <Criteria field=\"<<Search field, one of the field from below list>>\" operator=\"EQUALS\">Search Value</Criteria> \t\t<!-- <Criteria field=\"installedSoftware\" operator=\"EQUALS\">Apache web server</Criteria> --> \t\t<!-- <Criteria field=\"dnsHostName\" operator=\"EQUALS\">xyz.random.corp.com</Criteria> --> \t\t<!-- <Criteria field=\"netbiosName\" operator=\"EQUALS\">XYZRAND08</Criteria> --> \t\t<!-- --> \t\t<!--Field can be among the follwing: \t\t\tsubnetId, ociTagNameSpace, resourceGroup, subnet, vmId, datacenterId, type, availabilityZone, netbiosNetworkId, trackingMethod, vmType, dnsHostName, instanceState, vnicId, networkGuid, cloudProviderType, id, state, image, imageId, shape, created, awsTagKey, compartmentName, activationKey, agentConfigurationId, lastVulnScan, publicDnsName, privateIpAddress, agentConfigurationName, accountId, launchTime, ociRegion, azureTagKey, lastComplianceScan, port, name, region, subscriptionId, updated, informationGatheredUpdated, awsTagValue, ociTagValue, hostName, vlanTag, tagId, subnetName, vcnName, ibmTagKey, ibmTagValue, instanceId, tenantName, ociTagKey, vpcId, imageOffer, ibmId, ociId, ociState, imageVersion, faultDomain, routerIP, subnetCidrBlock, lastCheckedIn, address, availabilityDomain, os, qwebHostId, publicIpAddress, instanceType, publicIp, tagName, installedSoftware, compartmentId, vcnId, azureTagValue, canonicalRegionName, netbiosName, vulnsUpdated, tenantId, agentVersion, privateDnsName, location, agentUuid, nicIndex \t\t-->     </filters> </ServiceRequest>",
                              "x-ms-visibility": "advanced"
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "$content-type": {
                                  "type": "string",
                                  "description": "$content-type"
                                },
                                "$content": {
                                  "type": "string",
                                  "description": "$content"
                                }
                              }
                            },
                            "headers": {
                              "\"Transfer-Encoding\"": {
                                "description": "\"Transfer-Encoding\"",
                                "type": "string"
                              },
                              "\"Vary\"": {
                                "description": "\"Vary\"",
                                "type": "string"
                              },
                              "\"X-Frame-Options\"": {
                                "description": "\"X-Frame-Options\"",
                                "type": "string"
                              },
                              "\"Strict-Transport-Security\"": {
                                "description": "\"Strict-Transport-Security\"",
                                "type": "string"
                              },
                              "\"X-Xss-protection\"": {
                                "description": "\"X-Xss-protection\"",
                                "type": "string"
                              },
                              "\"X-Content-Type-Options\"": {
                                "description": "\"X-Content-Type-Options\"",
                                "type": "string"
                              },
                              "\"Date\"": {
                                "description": "\"Date\"",
                                "type": "string"
                              },
                              "\"X-Powered-By\"": {
                                "description": "\"X-Powered-By\"",
                                "type": "string"
                              },
                              "\"Content-Type\"": {
                                "description": "\"Content-Type\"",
                                "type": "string"
                              },
                              "\"Content-Length\"": {
                                "description": "\"Content-Length\"",
                                "type": "string"
                              }
                            }
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    },
                    "/qps/rest/2.0/count/am/hostasset": {
                      "post": {
                        "summary": "Asset Count By Criteria",
                        "description": "Get Asset Count for Given Criteria",
                        "operationId": "[[variables('_operationId-AssetCountByCriteria')]",
                        "parameters": [
                          {
                            "name": "X-Requested-With",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "Sentinel",
                            "description": "Mandatory Header Required by Qualys API",
                            "x-ms-summary": "X-Requested-With Header",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "text/xml",
                            "description": "Content-Type",
                            "x-ms-summary": "Content-Type",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "Accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "Accept",
                            "x-ms-summary": "Accept",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "filter-xml",
                            "in": "body",
                            "schema": {
                              "type": "string",
                              "description": "Filter Criteria XML",
                              "title": "filter-criteria",
                              "default": "<ServiceRequest>     <filters>         <Criteria field=\"<<Search field, one of the field from below list>>\" operator=\"EQUALS\">Search Value</Criteria> \t\t<!-- <Criteria field=\"installedSoftware\" operator=\"EQUALS\">Apache web server</Criteria> --> \t\t<!-- <Criteria field=\"dnsHostName\" operator=\"EQUALS\">xyz.random.corp.com</Criteria> --> \t\t<!-- <Criteria field=\"netbiosName\" operator=\"EQUALS\">XYZRAND08</Criteria> --> \t\t<!-- --> \t\t<!--Field can be among the follwing: \t\t\tsubnetId, ociTagNameSpace, resourceGroup, subnet, vmId, datacenterId, type, availabilityZone, netbiosNetworkId, trackingMethod, vmType, dnsHostName, instanceState, vnicId, networkGuid, cloudProviderType, id, state, image, imageId, shape, created, awsTagKey, compartmentName, activationKey, agentConfigurationId, lastVulnScan, publicDnsName, privateIpAddress, agentConfigurationName, accountId, launchTime, ociRegion, azureTagKey, lastComplianceScan, port, name, region, subscriptionId, updated, informationGatheredUpdated, awsTagValue, ociTagValue, hostName, vlanTag, tagId, subnetName, vcnName, ibmTagKey, ibmTagValue, instanceId, tenantName, ociTagKey, vpcId, imageOffer, ibmId, ociId, ociState, imageVersion, faultDomain, routerIP, subnetCidrBlock, lastCheckedIn, address, availabilityDomain, os, qwebHostId, publicIpAddress, instanceType, publicIp, tagName, installedSoftware, compartmentId, vcnId, azureTagValue, canonicalRegionName, netbiosName, vulnsUpdated, tenantId, agentVersion, privateDnsName, location, agentUuid, nicIndex \t\t-->     </filters> </ServiceRequest>",
                              "x-ms-visibility": "advanced"
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "$content-type": {
                                  "type": "string",
                                  "description": "$content-type"
                                },
                                "$content": {
                                  "type": "string",
                                  "description": "$content"
                                }
                              }
                            },
                            "headers": {
                              "\"Transfer-Encoding\"": {
                                "description": "\"Transfer-Encoding\"",
                                "type": "string"
                              },
                              "\"Vary\"": {
                                "description": "\"Vary\"",
                                "type": "string"
                              },
                              "\"evaluation\"": {
                                "description": "\"evaluation\"",
                                "type": "string"
                              },
                              "\"X-Frame-Options\"": {
                                "description": "\"X-Frame-Options\"",
                                "type": "string"
                              },
                              "\"Strict-Transport-Security\"": {
                                "description": "\"Strict-Transport-Security\"",
                                "type": "string"
                              },
                              "\"X-Xss-protection\"": {
                                "description": "\"X-Xss-protection\"",
                                "type": "string"
                              },
                              "\"X-Content-Type-Options\"": {
                                "description": "\"X-Content-Type-Options\"",
                                "type": "string"
                              },
                              "\"Date\"": {
                                "description": "\"Date\"",
                                "type": "string"
                              },
                              "\"X-Powered-By\"": {
                                "description": "\"X-Powered-By\"",
                                "type": "string"
                              },
                              "\"Content-Type\"": {
                                "description": "\"Content-Type\"",
                                "type": "string"
                              },
                              "\"Content-Length\"": {
                                "description": "\"Content-Length\"",
                                "type": "string"
                              }
                            }
                          }
                        },
                        "x-ms-visibility": "important"
                      }
                    }
                  },
                  "securityDefinitions": {
                    "basic_auth": {
                      "type": "basic"
                    }
                  },
                  "security": [
                    {
                      "basic_auth": "[variables('TemplateEmptyArray')]"
                    }
                  ],
                  "tags": "[variables('TemplateEmptyArray')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "QualysVM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "QualysVM-GetAssetDetails playbook",
        "displayName": "QualysVM-GetAssetDetails playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('playbookTemplateSpecName2'),'/',variables('playbookVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "QualysVM-GetAssetDetails Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "QualysVM-GetAssetDetails",
              "type": "string"
            },
            "CustomConnectorName": {
              "defaultValue": "QualysCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the logic app connector which performs Qualys actions."
              }
            }
          },
          "variables": {
            "QualyscustomconnectorConnectionName": "[[concat('Qualyscustomconnector-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "runAfter": {
                        "Compose_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['object']?['id']",
                          "message": "<p>@{variables('IncidentComment')}</p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      }
                    },
                    "Compose_Incident_Comment": {
                      "runAfter": {
                        "Create_Output_HTML_table": [
                          "Succeeded"
                        ]
                      },
                      "type": "AppendToStringVariable",
                      "inputs": {
                        "name": "IncidentComment",
                        "value": "@body('Create_Output_HTML_table')"
                      }
                    },
                    "Create_Output_HTML_table": {
                      "runAfter": {
                        "For_each_IP_Address_get_asset_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "Table",
                      "inputs": {
                        "format": "HTML",
                        "from": "@variables('OutputArray')"
                      }
                    },
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      }
                    },
                    "For_each_IP_Address_get_asset_details": {
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Condition": {
                          "actions": {
                            "Append_to_Output_Array": {
                              "runAfter": {
                                "Compose_Output": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "OutputArray",
                                "value": "@outputs('Compose_Output')"
                              }
                            },
                            "Compose_Output": {
                              "type": "Compose",
                              "inputs": {
                                "DNS": "@body('Parse_Asset_Details_JSON')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['DNS']?['#cdata-section']",
                                "Domain": "@body('Parse_Asset_Details_JSON')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['DNS_DATA']?['DOMAIN']?['#cdata-section']",
                                "FQDN": "@body('Parse_Asset_Details_JSON')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['DNS_DATA']?['FQDN']?['#cdata-section']",
                                "Hostname": "@body('Parse_Asset_Details_JSON')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['DNS_DATA']?['HOSTNAME']?['#cdata-section']",
                                "IP Address": "@body('Parse_Asset_Details_JSON')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['IP']",
                                "LastScannedDateTime": "@body('Parse_Asset_Details_JSON')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['LAST_VULN_SCAN_DATETIME']",
                                "NetBIOS": "@body('Parse_Asset_Details_JSON')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['NETBIOS']?['#cdata-section']",
                                "OS": "@body('Parse_Asset_Details_JSON')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['OS']?['#cdata-section']",
                                "QualysAssetID": "@body('Parse_Asset_Details_JSON')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['ID']"
                              }
                            }
                          },
                          "runAfter": {
                            "Parse_Asset_Details_JSON": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Add_comment_if_no_details_found": {
                                "type": "AppendToStringVariable",
                                "inputs": {
                                  "name": "IncidentComment",
                                  "value": "No details found for host: <strong> @{items('For_each_IP_Address_get_asset_details')?['Address']}</strong> \n"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@body('Parse_Asset_Details_JSON')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']",
                                    null
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Get_Asset_Details_By_IP": {
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "X-Requested-With": "Sentinel"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/api/2.0/fo/asset/host/",
                            "queries": {
                              "action": "list",
                              "details": "All",
                              "ips": "@items('For_each_IP_Address_get_asset_details')?['Address']"
                            }
                          }
                        },
                        "Parse_Asset_Details_JSON": {
                          "runAfter": {
                            "Get_Asset_Details_By_IP": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@json(xml(body('Get_Asset_Details_By_IP')))",
                            "schema": {
                              "properties": {
                                "HOST_LIST_OUTPUT": {
                                  "properties": {
                                    "RESPONSE": {
                                      "properties": {
                                        "DATETIME": {
                                          "type": "string"
                                        },
                                        "HOST_LIST": {
                                          "properties": {
                                            "HOST": {
                                              "properties": {
                                                "DNS": {
                                                  "properties": {
                                                    "#cdata-section": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "DNS_DATA": {
                                                  "properties": {
                                                    "DOMAIN": {
                                                      "properties": {
                                                        "#cdata-section": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "FQDN": {
                                                      "properties": {
                                                        "#cdata-section": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "HOSTNAME": {
                                                      "properties": {
                                                        "#cdata-section": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "ID": {
                                                  "type": "string"
                                                },
                                                "IP": {
                                                  "type": "string"
                                                },
                                                "LAST_VM_AUTH_SCANNED_DATE": {
                                                  "type": "string"
                                                },
                                                "LAST_VM_AUTH_SCANNED_DURATION": {
                                                  "type": "string"
                                                },
                                                "LAST_VM_SCANNED_DATE": {
                                                  "type": "string"
                                                },
                                                "LAST_VM_SCANNED_DURATION": {
                                                  "type": "string"
                                                },
                                                "LAST_VULN_SCAN_DATETIME": {
                                                  "type": "string"
                                                },
                                                "NETBIOS": {
                                                  "properties": {
                                                    "#cdata-section": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "OS": {
                                                  "properties": {
                                                    "#cdata-section": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "TRACKING_METHOD": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_-_OutputArray": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Initialize_variable_-_IncidentComment": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "IncidentComment",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_OutputArray": {
                      "runAfter": {
                        "Initialize_variable_-_IncidentComment": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "OutputArray",
                            "type": "array"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "QualysCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('QualyscustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('QualyscustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "tags": {
                "hidden-SentinelTemplateName": "QualysVM-GetAssetDetails",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('QualyscustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('QualyscustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('QualyscustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "QualysVM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_QualysCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "QualysVM-GetAssetDetails",
            "description": "When a new sentinel incident is created, this playbook gets triggered and performs the following actions: \n 1. Get IP Addresses from incident. \n 2. Get Asset Details for all IP Addresses. \n 3. Add asset details as a comment to the incident.",
            "prerequisites": [
              "1. Prior to the deployment of this playbook, Qualys Logic App Custom Connector needs to be deployed under the same subscription.",
              "2. Refer to [Qualys Logic App Custom Connector](../QualysCustomConnector/readme.md) documentation for deployment instructions."
            ],
            "postDeployment": [
              "None"
            ],
            "lastUpdateTime": "2022-09-15T22:25:52Z",
            "entities": [
              "IP"
            ],
            "tags": [
              "Qualys",
              "Enrichment",
              "VM Report"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "QualysVM-GetAssets-ByCVEID playbook",
        "displayName": "QualysVM-GetAssets-ByCVEID playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('playbookTemplateSpecName3'),'/',variables('playbookVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "QualysVM-GetAssets-ByCVEID Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "QualysVM-GetAssets-ByCVEID",
              "type": "string",
              "metadata": {
                "description": "Name of the logic app resource to be created."
              }
            },
            "CustomConnectorName": {
              "defaultValue": "QualysCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the logic app connector which performs Qualys actions."
              }
            },
            "StorageAccountName": {
              "defaultValue": "",
              "type": "string",
              "metadata": {
                "description": "Name of the storage account to store Qualys reports."
              }
            }
          },
          "variables": {
            "QualyscustomconnectorConnectionName": "[[concat('Qualyscustomconnector-', parameters('PlaybookName'))]",
            "AzureBlobStorageName": "[[parameters('StorageAccountName')]",
            "AzureblobConnectionName": "[[concat('Azureblob-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "StorageAccountId": "[[resourceId('Microsoft.Storage/storageAccounts', variables('AzureBlobStorageName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azureblob')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-4": "[[variables('connection-4')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "runAfter": {
                        "Create_SAS_URI_by_path_(V2)": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['object']?['id']",
                          "message": "<p><strong>Following Qualys VM Scan Report Generated: </strong><strong>@{body('Create_SAS_URI_by_path_(V2)')?['WebUrl']}</strong><strong></strong></p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      }
                    },
                    "Create_Dynamic_Search_List_of_CVEs": {
                      "runAfter": {
                        "For_each_Alert_in_Incident_get_all_CVEIDs": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/qid/search_list/dynamic/",
                        "queries": {
                          "action": "create",
                          "cve_ids": "@{join(variables('CVEID'), ',')}",
                          "title": "@{concat('SentinelSearchList_', utcNow())}"
                        }
                      }
                    },
                    "Create_SAS_URI_by_path_(V2)": {
                      "runAfter": {
                        "Create_blob_(V2)": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "Permissions": "Read"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azureblob']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/v2/datasets/@{encodeURIComponent('AccountNameFromSettings')}/CreateSharedLinkByPath",
                        "queries": {
                          "path": "@body('Create_blob_(V2)')?['Path']"
                        }
                      }
                    },
                    "Create_Scan_Report_Template": {
                      "runAfter": {
                        "Parse_Create_Dynamic_Search_List_Output_JSON": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<SCANTEMPLATE>\n    <TITLE>\n        <INFO key=\"title\">\n            <![CDATA[@{concat('SentinelScanReportTemplate_', utcNow())}]]>\n        </INFO>\n    </TITLE>\n    <TARGET>\n        <INFO key=\"scan_selection\">\n            <![CDATA[HostBased]]>\n        </INFO>\n        <INFO key=\"asset_groups\">\n            <![CDATA[All]]>\n        </INFO>\n    </TARGET>\n    <DISPLAY>\n        <INFO key=\"display_text_summary\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"graph_status\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"graph_potential_status\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"graph_severity\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"graph_potential_severity\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"graph_ig_severity\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"graph_top_categories\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"graph_top_vulns\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"graph_os\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"graph_services\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"graph_top_ports\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"display_custom_footer\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"display_custom_footer_text\">\n            <![CDATA[Report Generated by Sentinel Playbook]]>\n        </INFO>\n        <INFO key=\"sort_by\">\n            <![CDATA[vuln]]>\n        </INFO>\n        <INFO key=\"cvss\">\n            <![CDATA[cvssv3]]>\n        </INFO>\n        <INFO key=\"host_details\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"metadata_ec2_instances\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_text_summary\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details_threat\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details_impact\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details_solution\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details_vpatch\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details_compliance\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details_exploit\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details_malware\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details_results\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details_reopened\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"include_vuln_details_appendix\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"exclude_account_id\">\n            <![CDATA[1]]>\n        </INFO>\n    </DISPLAY>\n    <FILTER>\n        <INFO key=\"selective_vulns\">\n            <![CDATA[custom]]>\n        </INFO>\n\t\t<INFO key=\"search_list_ids\">\n            <![CDATA[@{body('Parse_Create_Dynamic_Search_List_Output_JSON')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE']}]]>\n        </INFO>\n\t\t<INFO key=\"included_os\">\n            <![CDATA[AIX,ASUS,WINDOWS,LINUX,UBUNTU]]>\n        </INFO>\n\t\t<INFO key=\"status_new\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"status_active\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"status_reopen\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"vuln_active\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"vuln_disabled\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"vuln_ignored\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"potential_active\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"potential_disabled\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"potential_ignored\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"ig_active\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"ig_disabled\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"ig_ignored\">\n            <![CDATA[1]]>\n        </INFO>\n\t\t<INFO key=\"display_non_running_kernels\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"exclude_non_running_services\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"exclude_qids_not_exploitable_due_to_configuration\">\n            <![CDATA[1]]>\n        </INFO>\n        <INFO key=\"exclude_superceded_patches\">\n            <![CDATA[1]]>\n        </INFO>\n\t\t<INFO key=\"categories_list\">\n            <![CDATA[Cisco,Debian,Finger,Windows,Ubuntu]]>\n        </INFO>\n    </FILTER>\n</SCANTEMPLATE>",
                        "headers": {
                          "Content-Type": "text/xml",
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/report/template/scan/",
                        "queries": {
                          "action": "create",
                          "report_format": "xml"
                        }
                      }
                    },
                    "Create_blob_(V2)": {
                      "runAfter": {
                        "Download_Report": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@body('Download_Report')",
                        "headers": {
                          "ReadFileMetadataFromServer": true
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azureblob']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/v2/datasets/@{encodeURIComponent(encodeURIComponent('AccountNameFromSettings'))}/files",
                        "queries": {
                          "folderPath": "/report-blob",
                          "name": "@{concat('ScanReport_', utcNow())}",
                          "queryParametersSingleEncoded": true
                        }
                      },
                      "runtimeConfiguration": {
                        "contentTransfer": {
                          "transferMode": "Chunked"
                        }
                      }
                    },
                    "Delay_1_Minute_": {
                      "runAfter": {
                        "Set_variable_-_ReportID": [
                          "Succeeded"
                        ]
                      },
                      "type": "Wait",
                      "inputs": {
                        "interval": {
                          "count": 1,
                          "unit": "Minute"
                        }
                      }
                    },
                    "Delete_Dynamic_Search_List": {
                      "runAfter": {
                        "Add_comment_to_incident_(V3)": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/qid/search_list/dynamic/",
                        "queries": {
                          "action": "delete",
                          "id": "@body('Parse_Create_Dynamic_Search_List_Output_JSON')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE']"
                        }
                      }
                    },
                    "Delete_Scan_Report_Template": {
                      "runAfter": {
                        "Delete_Dynamic_Search_List": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "Content-Type": "text/xml",
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/report/template/scan/",
                        "queries": {
                          "action": "delete",
                          "template_id": "@body('Parse_Create_Report_Template_Output_JSON')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE']"
                        }
                      }
                    },
                    "Download_Report": {
                      "runAfter": {
                        "Wait_Until_Report_Generation_is_Finished": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/report/",
                        "queries": {
                          "action": "fetch",
                          "id": "@variables('ReportID')"
                        }
                      }
                    },
                    "For_each_Alert_in_Incident_get_all_CVEIDs": {
                      "foreach": "@triggerBody()?['object']?['properties']?['Alerts']",
                      "actions": {
                        "For_each_CVEID": {
                          "foreach": "@body('Parse_Cutom_Details_Section')?['CVEID']",
                          "actions": {
                            "Append_to_array_CVEID": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "CVEID",
                                "value": "@items('For_each_CVEID')"
                              }
                            }
                          },
                          "runAfter": {
                            "Parse_Cutom_Details_Section": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Parse_Additional_Data_Section": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each_Alert_in_Incident_get_all_CVEIDs')?['properties']?['additionalData']",
                            "schema": {
                              "properties": {
                                "Alert generation status": {
                                  "type": "string"
                                },
                                "AlertMessageEnqueueTime": {
                                  "type": "string"
                                },
                                "Analytic Rule Ids": {
                                  "type": "string"
                                },
                                "Analytic Rule Name": {
                                  "type": "string"
                                },
                                "Correlation Id": {
                                  "type": "string"
                                },
                                "Custom Details": {
                                  "type": [
                                    "string",
                                    "null"
                                  ]
                                },
                                "Data Sources": {
                                  "type": "string"
                                },
                                "Event Grouping": {
                                  "type": "string"
                                },
                                "ProcessedBySentinel": {
                                  "type": "string"
                                },
                                "Query": {
                                  "type": "string"
                                },
                                "Query End Time UTC": {
                                  "type": "string"
                                },
                                "Query Period": {
                                  "type": "string"
                                },
                                "Query Start Time UTC": {
                                  "type": "string"
                                },
                                "Search Query Results Overall Count": {
                                  "type": "string"
                                },
                                "Trigger Operator": {
                                  "type": "string"
                                },
                                "Trigger Threshold": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "Parse_Cutom_Details_Section": {
                          "runAfter": {
                            "Parse_Additional_Data_Section": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Parse_Additional_Data_Section')?['Custom Details']",
                            "schema": {
                              "properties": {
                                "CVEID": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_-_ReportID": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Get_Report_Status": {
                      "runAfter": {
                        "Delay_1_Minute_": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/report/",
                        "queries": {
                          "action": "list",
                          "id": "@int(variables('ReportID'))"
                        }
                      }
                    },
                    "Initialize_variable_-_CVEID": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "CVEID",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_ReportID": {
                      "runAfter": {
                        "Initialize_variable_-_ReportStatus": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ReportID",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_ReportStatus": {
                      "runAfter": {
                        "Initialize_variable_-_CVEID": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ReportStatus",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Launch_Scan_Report": {
                      "runAfter": {
                        "Parse_Create_Report_Template_Output_JSON": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/report/",
                        "queries": {
                          "action": "launch",
                          "output_format": "pdf",
                          "report_title": "@{concat('SentinelScanReport_', utcNow())}",
                          "report_type": "Scan",
                          "template_id": "@body('Parse_Create_Report_Template_Output_JSON')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE']"
                        }
                      }
                    },
                    "Parse_Create_Dynamic_Search_List_Output_JSON": {
                      "runAfter": {
                        "Create_Dynamic_Search_List_of_CVEs": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@json(xml(body('Create_Dynamic_Search_List_of_CVEs')))",
                        "schema": {
                          "properties": {
                            "SIMPLE_RETURN": {
                              "properties": {
                                "RESPONSE": {
                                  "properties": {
                                    "DATETIME": {
                                      "type": "string"
                                    },
                                    "ITEM_LIST": {
                                      "properties": {
                                        "ITEM": {
                                          "properties": {
                                            "KEY": {
                                              "type": "string"
                                            },
                                            "VALUE": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "TEXT": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Parse_Create_Report_Template_Output_JSON": {
                      "runAfter": {
                        "Create_Scan_Report_Template": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@json(xml(body('Create_Scan_Report_Template')))",
                        "schema": {
                          "properties": {
                            "SIMPLE_RETURN": {
                              "properties": {
                                "RESPONSE": {
                                  "properties": {
                                    "DATETIME": {
                                      "type": "string"
                                    },
                                    "ITEM_LIST": {
                                      "properties": {
                                        "ITEM": {
                                          "properties": {
                                            "KEY": {
                                              "type": "string"
                                            },
                                            "VALUE": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "TEXT": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Parse_Launch_Scan_Report_Output_JSON": {
                      "runAfter": {
                        "Launch_Scan_Report": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@json(xml(body('Launch_Scan_Report')))",
                        "schema": {
                          "properties": {
                            "SIMPLE_RETURN": {
                              "properties": {
                                "RESPONSE": {
                                  "properties": {
                                    "DATETIME": {
                                      "type": "string"
                                    },
                                    "ITEM_LIST": {
                                      "properties": {
                                        "ITEM": {
                                          "properties": {
                                            "KEY": {
                                              "type": "string"
                                            },
                                            "VALUE": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "TEXT": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Parse_Report_Status_JSON": {
                      "runAfter": {
                        "Get_Report_Status": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@json(xml(body('Get_Report_Status')))",
                        "schema": {
                          "properties": {
                            "REPORT_LIST_OUTPUT": {
                              "properties": {
                                "RESPONSE": {
                                  "properties": {
                                    "DATETIME": {
                                      "type": "string"
                                    },
                                    "REPORT_LIST": {
                                      "properties": {
                                        "REPORT": {
                                          "properties": {
                                            "EXPIRATION_DATETIME": {
                                              "type": "string"
                                            },
                                            "ID": {
                                              "type": "string"
                                            },
                                            "LAUNCH_DATETIME": {
                                              "type": "string"
                                            },
                                            "OUTPUT_FORMAT": {
                                              "type": "string"
                                            },
                                            "SIZE": {
                                              "type": "string"
                                            },
                                            "STATUS": {
                                              "properties": {
                                                "MESSAGE": {
                                                  "properties": {
                                                    "#cdata-section": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "PERCENT": {
                                                  "type": "string"
                                                },
                                                "STATE": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "TITLE": {
                                              "properties": {
                                                "#cdata-section": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "TYPE": {
                                              "type": "string"
                                            },
                                            "USER_LOGIN": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Set_variable_-_ReportID": {
                      "runAfter": {
                        "Parse_Launch_Scan_Report_Output_JSON": [
                          "Succeeded"
                        ]
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "ReportID",
                        "value": "@body('Parse_Launch_Scan_Report_Output_JSON')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE']"
                      }
                    },
                    "Set_variable_-_ReportStatus": {
                      "runAfter": {
                        "Parse_Report_Status_JSON": [
                          "Succeeded"
                        ]
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "ReportStatus",
                        "value": "@body('Parse_Report_Status_JSON')?['REPORT_LIST_OUTPUT']?['RESPONSE']?['REPORT_LIST']?['REPORT']?['STATUS']?['STATE']"
                      }
                    },
                    "Terminate": {
                      "runAfter": {
                        "For_each_Alert_in_Incident_get_all_CVEIDs": [
                          "Failed"
                        ]
                      },
                      "type": "Terminate",
                      "inputs": {
                        "runError": {
                          "code": "FAIL",
                          "message": "Custom Details mapping in Analytical Rule is missing or misconfigured."
                        },
                        "runStatus": "Failed"
                      }
                    },
                    "Wait_Until_Report_Generation_is_Finished": {
                      "actions": {
                        "Delay_for_3_minutes": {
                          "type": "Wait",
                          "inputs": {
                            "interval": {
                              "count": 3,
                              "unit": "Minute"
                            }
                          }
                        },
                        "Get_Report_Status_Again": {
                          "runAfter": {
                            "Delay_for_3_minutes": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "X-Requested-With": "Sentinel"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/api/2.0/fo/report/",
                            "queries": {
                              "action": "list",
                              "id": "@int(variables('ReportID'))"
                            }
                          }
                        },
                        "Parse_Report_Status_JSON_Again": {
                          "runAfter": {
                            "Get_Report_Status_Again": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@json(xml(body('Get_Report_Status_Again')))",
                            "schema": {
                              "properties": {
                                "REPORT_LIST_OUTPUT": {
                                  "properties": {
                                    "RESPONSE": {
                                      "properties": {
                                        "DATETIME": {
                                          "type": "string"
                                        },
                                        "REPORT_LIST": {
                                          "properties": {
                                            "REPORT": {
                                              "properties": {
                                                "EXPIRATION_DATETIME": {
                                                  "type": "string"
                                                },
                                                "ID": {
                                                  "type": "string"
                                                },
                                                "LAUNCH_DATETIME": {
                                                  "type": "string"
                                                },
                                                "OUTPUT_FORMAT": {
                                                  "type": "string"
                                                },
                                                "SIZE": {
                                                  "type": "string"
                                                },
                                                "STATUS": {
                                                  "properties": {
                                                    "MESSAGE": {
                                                      "properties": {
                                                        "#cdata-section": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "PERCENT": {
                                                      "type": "string"
                                                    },
                                                    "STATE": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "TITLE": {
                                                  "properties": {
                                                    "#cdata-section": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "TYPE": {
                                                  "type": "string"
                                                },
                                                "USER_LOGIN": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "Update_variable_-_ReportStatus_": {
                          "runAfter": {
                            "Parse_Report_Status_JSON_Again": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "ReportStatus",
                            "value": "@body('Parse_Report_Status_JSON_Again')?['REPORT_LIST_OUTPUT']?['RESPONSE']?['REPORT_LIST']?['REPORT']?['STATUS']?['STATE']"
                          }
                        }
                      },
                      "runAfter": {
                        "Set_variable_-_ReportStatus": [
                          "Succeeded"
                        ]
                      },
                      "expression": "@equals(variables('ReportStatus'), 'Finished')",
                      "limit": {
                        "count": 60,
                        "timeout": "PT3H"
                      },
                      "type": "Until"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "QualysCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('QualyscustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('QualyscustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azureblob": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureblobConnectionName'))]",
                        "connectionName": "[[variables('AzureblobConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azureblob')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "QualysVM-GetAssets-ByCVEID",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('QualyscustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureblobConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('QualyscustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('QualyscustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureblobConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureblobConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                },
                "parameterValues": {
                  "accountName": "[[variables('AzureBlobStorageName')]",
                  "accessKey": "[[listKeys(variables('StorageAccountId'), '2019-04-01').keys[0].value]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-4')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "QualysVM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_QualysCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "QualysVM-GetAssets-ByCVEID",
            "description": "When a new sentinel incident is created, this playbook gets triggered and performs the following actions: \n 1. Get CVE IDs from incident. \n 2. Create a Dynamic Search List with CVE IDs as filter criteria. \n 3. Generate the Vulnerability Report based on Dynamic Search List. \n 4. Download the report and store it to a blob storage. This report has details about assets which are vulnerable to CVE. \n 5. Add the link of report as a comment to the incident.",
            "prerequisites": [
              "1. Prior to the deployment of this playbook, Qualys Logic App Custom Connector needs to be deployed under the same subscription.",
              "2. Refer to [Qualys Logic App Custom Connector](../QualysCustomConnector/readme.md) documentation for deployment instructions."
            ],
            "postDeployment": [
              "None"
            ],
            "lastUpdateTime": "2022-09-13T22:25:52Z",
            "tags": [
              "Qualys",
              "Enrichment",
              "VM Report"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "QualysVM-GetAssets-ByOpenPort playbook",
        "displayName": "QualysVM-GetAssets-ByOpenPort playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('playbookTemplateSpecName4'),'/',variables('playbookVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "QualysVM-GetAssets-ByOpenPort Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "QualysVM-GetAssets-ByOpenPort",
              "type": "string"
            },
            "CustomConnectorName": {
              "defaultValue": "QualysCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the logic app connector which performs Qualys actions."
              }
            }
          },
          "variables": {
            "QualyscustomconnectorConnectionName": "[[concat('Qualyscustomconnector-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "runAfter": {
                        "Check_for_Successful_Response": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ],
                        "Check_if_Successful_Response": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ],
                        "Terminate": [
                          "Skipped"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['object']?['id']",
                          "message": "<p>@{variables('IncidentCommet')}</p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      }
                    },
                    "Asset_Count_for_Port": {
                      "runAfter": {
                        "For_each_Alert_in_Incident_get_all_Ports": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "<ServiceRequest>\n    <filters>\n        <Criteria field=\"port\" operator=\"EQUALS\">@{first(variables('Ports'))}</Criteria>\n    </filters>\n</ServiceRequest>",
                        "headers": {
                          "Accept": "application/json",
                          "Content-Type": "text/xml",
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/qps/rest/2.0/count/am/hostasset"
                      }
                    },
                    "Check_for_Successful_Response": {
                      "actions": {
                        "Append_to_IncidentComment": {
                          "runAfter": {
                            "Compose_Incident_Comment_with_Count_Details": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "IncidentCommet",
                            "value": "@{outputs('Compose_Incident_Comment_with_Count_Details')}\n"
                          }
                        },
                        "Compose_Incident_Comment_with_Count_Details": {
                          "type": "Compose",
                          "inputs": "<strong>Total Hosts Count with Open Port @{join(variables('Ports'), ',')}: @{body('Parse_Asset_Count_JSON')?['ServiceResponse']?['count']}</strong>\n"
                        }
                      },
                      "runAfter": {
                        "Parse_Asset_Count_JSON": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Append_Asset_Count_Failure_msg_to_Incident_Comment": {
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "IncidentCommet",
                              "value": "Asset Count Qualys API call failed.\n @{slice(string(body('Parse_Asset_Count_JSON')), 0, 1000)}\n"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@body('Parse_Asset_Count_JSON')?['ServiceResponse']?['responseCode']",
                              "SUCCESS"
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Check_if_Successful_Response": {
                      "actions": {
                        "Append_to_Incident_Comment": {
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "IncidentCommet",
                            "value": "<b>Result is limited to @{variables('ResultLimit')} devices (Incident comment has limitation of 30000 characters): </b>\n@{body('Create_HTML_table')}"
                          }
                        },
                        "Create_HTML_table": {
                          "runAfter": {
                            "For_each_Host_in_result": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('OutputArray')"
                          }
                        },
                        "For_each_Host_in_result": {
                          "foreach": "@body('Parse_Search_Result_JSON')?['ServiceResponse']?['data']",
                          "actions": {
                            "Append_to_Output_Array": {
                              "runAfter": {
                                "Compose_Result": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "OutputArray",
                                "value": "@outputs('Compose_Result')"
                              }
                            },
                            "Compose_Result": {
                              "runAfter": {
                                "For_each_Open_Port": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Compose",
                              "inputs": {
                                "FQDN": "@items('For_each_Host_in_result')?['HostAsset']?['fqdn']",
                                "Hostname": "@items('For_each_Host_in_result')?['HostAsset']?['netbiosName']",
                                "IPAddress": "@items('For_each_Host_in_result')?['HostAsset']?['address']",
                                "OS": "@items('For_each_Host_in_result')?['HostAsset']?['os']",
                                "OpenPorts": "@join(variables('OpenPorts'), ',')"
                              }
                            },
                            "For_each_Open_Port": {
                              "foreach": "@items('For_each_Host_in_result')?['HostAsset']?['openPort']?['list']",
                              "actions": {
                                "Append_to_array_variable": {
                                  "runAfter": {
                                    "Parse_Open_Port_List_JSON": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "OpenPorts",
                                    "value": "@body('Parse_Open_Port_List_JSON')?['port']"
                                  }
                                },
                                "Parse_Open_Port_List_JSON": {
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@items('For_each_Open_Port')?['HostAssetOpenPort']",
                                    "schema": {
                                      "properties": {
                                        "port": {
                                          "type": "integer"
                                        },
                                        "protocol": {
                                          "type": "string"
                                        },
                                        "serviceId": {
                                          "type": "integer"
                                        },
                                        "serviceName": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                }
                              },
                              "type": "Foreach"
                            },
                            "Reset_Variable_OpenPorts": {
                              "runAfter": {
                                "Append_to_Output_Array": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "OpenPorts",
                                "value": "[variables('TemplateEmptyArray')]"
                              }
                            }
                          },
                          "type": "Foreach",
                          "runtimeConfiguration": {
                            "concurrency": {
                              "repetitions": 1
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Parse_Search_Result_JSON": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Append_Asset_Search_Failure_msg_to_Incident_Comment": {
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "IncidentCommet",
                              "value": "Asset Search Qualys API call failed.\n@{slice(string(body('Parse_Search_Result_JSON')), 0, 1000)}\n"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@body('Parse_Search_Result_JSON')?['ServiceResponse']?['responseCode']",
                              "SUCCESS"
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "For_each_Alert_in_Incident_get_all_Ports": {
                      "foreach": "@triggerBody()?['object']?['properties']?['Alerts']",
                      "actions": {
                        "For_each_Port": {
                          "foreach": "@body('Parse_Cutom_Details_Section')?['NetworkPort']",
                          "actions": {
                            "Append_to_array_Ports": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "Ports",
                                "value": "@items('For_each_Port')"
                              }
                            }
                          },
                          "runAfter": {
                            "Parse_Cutom_Details_Section": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Parse_Additional_Data_Section": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each_Alert_in_Incident_get_all_Ports')?['properties']?['additionalData']",
                            "schema": {
                              "properties": {
                                "Alert generation status": {
                                  "type": "string"
                                },
                                "AlertMessageEnqueueTime": {
                                  "type": "string"
                                },
                                "Analytic Rule Ids": {
                                  "type": "string"
                                },
                                "Analytic Rule Name": {
                                  "type": "string"
                                },
                                "Correlation Id": {
                                  "type": "string"
                                },
                                "Custom Details": {
                                  "type": [
                                    "string",
                                    "null"
                                  ]
                                },
                                "Data Sources": {
                                  "type": "string"
                                },
                                "Event Grouping": {
                                  "type": "string"
                                },
                                "ProcessedBySentinel": {
                                  "type": "string"
                                },
                                "Query": {
                                  "type": "string"
                                },
                                "Query End Time UTC": {
                                  "type": "string"
                                },
                                "Query Period": {
                                  "type": "string"
                                },
                                "Query Start Time UTC": {
                                  "type": "string"
                                },
                                "Search Query Results Overall Count": {
                                  "type": "string"
                                },
                                "Trigger Operator": {
                                  "type": "string"
                                },
                                "Trigger Threshold": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "Parse_Cutom_Details_Section": {
                          "runAfter": {
                            "Parse_Additional_Data_Section": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Parse_Additional_Data_Section')?['Custom Details']",
                            "schema": {
                              "properties": {
                                "NetworkPort": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_-_ResultLimit": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Initialize_variable_-_IncidentComment": {
                      "runAfter": {
                        "Initialize_variable_-_Ports": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "IncidentCommet",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_OpenPorts": {
                      "runAfter": {
                        "Initialize_variable_-_OutputArray": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "OpenPorts",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_OutputArray": {
                      "runAfter": {
                        "Initialize_variable_-_IncidentComment": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "OutputArray",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_Ports": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Ports",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_ResultLimit": {
                      "runAfter": {
                        "Initialize_variable_-_OpenPorts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ResultLimit",
                            "type": "string",
                            "value": "50"
                          }
                        ]
                      }
                    },
                    "Parse_Asset_Count_JSON": {
                      "runAfter": {
                        "Asset_Count_for_Port": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('Asset_Count_for_Port')",
                        "schema": {
                          "properties": {
                            "ServiceResponse": {
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "responseCode": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Parse_Search_Result_JSON": {
                      "runAfter": {
                        "Search_Asset_By_Port": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('Search_Asset_By_Port')",
                        "schema": {
                          "properties": {
                            "ServiceResponse": {
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "data": {
                                  "items": {
                                    "properties": {
                                      "HostAsset": {
                                        "properties": {
                                          "address": {
                                            "type": "string"
                                          },
                                          "biosDescription": {
                                            "type": "string"
                                          },
                                          "created": {
                                            "type": "string"
                                          },
                                          "dnsHostName": {
                                            "type": "string"
                                          },
                                          "fqdn": {
                                            "type": "string"
                                          },
                                          "id": {
                                            "type": "integer"
                                          },
                                          "isDockerHost": {
                                            "type": "string"
                                          },
                                          "lastSystemBoot": {
                                            "type": "string"
                                          },
                                          "lastVulnScan": {
                                            "type": "string"
                                          },
                                          "manufacturer": {
                                            "type": "string"
                                          },
                                          "model": {
                                            "type": "string"
                                          },
                                          "modified": {
                                            "type": "string"
                                          },
                                          "name": {
                                            "type": "string"
                                          },
                                          "netbiosName": {
                                            "type": "string"
                                          },
                                          "networkGuid": {
                                            "type": "string"
                                          },
                                          "networkInterface": {
                                            "properties": {
                                              "list": {
                                                "items": {
                                                  "properties": {
                                                    "HostAssetInterface": {
                                                      "properties": {
                                                        "address": {
                                                          "type": "string"
                                                        },
                                                        "hostname": {
                                                          "type": "string"
                                                        },
                                                        "macAddress": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "required": [
                                                    "HostAssetInterface"
                                                  ],
                                                  "type": "object"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "openPort": {
                                            "properties": {
                                              "list": {
                                                "items": {
                                                  "properties": {
                                                    "HostAssetOpenPort": {
                                                      "properties": {
                                                        "port": {
                                                          "type": "integer"
                                                        },
                                                        "protocol": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "required": [
                                                    "HostAssetOpenPort"
                                                  ],
                                                  "type": "object"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "os": {
                                            "type": "string"
                                          },
                                          "processor": {
                                            "properties": {
                                              "list": {
                                                "items": {
                                                  "properties": {
                                                    "HostAssetProcessor": {
                                                      "properties": {
                                                        "name": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "required": [
                                                    "HostAssetProcessor"
                                                  ],
                                                  "type": "object"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "qwebHostId": {
                                            "type": "integer"
                                          },
                                          "software": {
                                            "properties": {
                                              "list": {
                                                "items": {
                                                  "properties": {
                                                    "HostAssetSoftware": {
                                                      "properties": {
                                                        "name": {
                                                          "type": "string"
                                                        },
                                                        "version": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "required": [
                                                    "HostAssetSoftware"
                                                  ],
                                                  "type": "object"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "trackingMethod": {
                                            "type": "string"
                                          },
                                          "type": {
                                            "type": "string"
                                          },
                                          "vuln": {
                                            "properties": {
                                              "list": {
                                                "items": {
                                                  "properties": {
                                                    "HostAssetVuln": {
                                                      "properties": {
                                                        "firstFound": {
                                                          "type": "string"
                                                        },
                                                        "hostInstanceVulnId": {
                                                          "type": "integer"
                                                        },
                                                        "lastFound": {
                                                          "type": "string"
                                                        },
                                                        "qid": {
                                                          "type": "integer"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "required": [
                                                    "HostAssetVuln"
                                                  ],
                                                  "type": "object"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          }
                                        },
                                        "type": "object"
                                      }
                                    },
                                    "required": [
                                      "HostAsset"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "hasMoreRecords": {
                                  "type": "string"
                                },
                                "lastId": {
                                  "type": "integer"
                                },
                                "responseCode": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Search_Asset_By_Port": {
                      "runAfter": {
                        "For_each_Alert_in_Incident_get_all_Ports": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "<ServiceRequest>\n\t<preferences>\n\t\t<limitResults>@{variables('ResultLimit')}</limitResults>\n\t</preferences>\n    <filters>\n        <Criteria field=\"port\" operator=\"EQUALS\"> @{first(variables('Ports'))}</Criteria>\n    </filters>\n</ServiceRequest>",
                        "headers": {
                          "Accept": "application/json",
                          "Content-Type": "text/xml",
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/qps/rest/2.0/search/am/hostasset"
                      }
                    },
                    "Terminate": {
                      "runAfter": {
                        "For_each_Alert_in_Incident_get_all_Ports": [
                          "Failed"
                        ]
                      },
                      "type": "Terminate",
                      "inputs": {
                        "runError": {
                          "code": "FAIL",
                          "message": "Custom Details mapping in Analytical Rule is missing or misconfigured."
                        },
                        "runStatus": "Failed"
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "QualysCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('QualyscustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('QualyscustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "QualysVM-GetAssets-ByOpenPort",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('QualyscustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('QualyscustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('QualyscustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "QualysVM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_QualysCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "QualysVM-GetAssets-ByOpenPort",
            "description": "When a new sentinel incident is created, this playbook gets triggered and performs the following actions: \n 1. Gets Port from incident. (Only one port) \n 2. Search the Qualys platform and get the asset count with open port. \n 3. Search the Qualys platform and get the asset details as well. (Asset details limited to 50 assets, since incident comment has limitaion of 30000 characters.) \n 4. Combine both the results. \n 5. Add the info as comment to the incident.",
            "prerequisites": [
              "1. Prior to the deployment of this playbook, Qualys Logic App Custom Connector needs to be deployed under the same subscription.",
              "2. Refer to [Qualys Logic App Custom Connector](../QualysCustomConnector/readme.md) documentation for deployment instructions."
            ],
            "postDeployment": [
              "None"
            ],
            "lastUpdateTime": "2022-09-13T22:25:52Z",
            "tags": [
              "Qualys",
              "Enrichment",
              "VM Report"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('playbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "QualysVM-LaunchVMScan-GenerateReport playbook",
        "displayName": "QualysVM-LaunchVMScan-GenerateReport playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('playbookTemplateSpecName5'),'/',variables('playbookVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "QualysVM-LaunchVMScan-GenerateReport Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion5')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "QualysVM-LaunchVMScan-GenerateReport",
              "type": "string",
              "metadata": {
                "description": "Name of the logic app resource to be created."
              }
            },
            "CustomConnectorName": {
              "defaultValue": "QualysCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the logic app connector which performs Qualys actions."
              }
            },
            "StorageAccountName": {
              "defaultValue": "",
              "type": "string",
              "metadata": {
                "description": "Name of the storage account to store Qualys reports."
              }
            }
          },
          "variables": {
            "QualyscustomconnectorConnectionName": "[[concat('Qualyscustomconnector-', parameters('PlaybookName'))]",
            "AzureBlobStorageName": "[[parameters('StorageAccountName')]",
            "AzureblobConnectionName": "[[concat('Azureblob-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "StorageAccountId": "[[resourceId('Microsoft.Storage/storageAccounts', variables('AzureBlobStorageName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azureblob')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-4": "[[variables('connection-4')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "staticResults": {
                    "Download_Scan_Report0": {
                      "status": "Succeeded",
                      "outputs": {
                        "statusCode": "OK"
                      }
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "runAfter": {
                        "Append_Report_Url_to_Incident_Comment_": [
                          "Succeeded",
                          "Skipped"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['object']?['id']",
                          "message": "<p>@{variables('IncidentComment')}</p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      }
                    },
                    "Append_Report_Url_to_Incident_Comment_": {
                      "runAfter": {
                        "Compose_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "AppendToStringVariable",
                      "inputs": {
                        "name": "IncidentComment",
                        "value": "@outputs('Compose_Comment')"
                      }
                    },
                    "Check_if_there_is_any_IP_Address_to_Scan": {
                      "actions": {
                        "Check_if_Scanner_is_available_then_Run_Scan": {
                          "actions": {
                            "Check_Scan_Status": {
                              "runAfter": {
                                "Get_Scan_Reference": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "headers": {
                                  "X-Requested-With": "Sentinel"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/api/2.0/fo/scan/",
                                "queries": {
                                  "action": "list",
                                  "scan_ref": "@variables('ScanRef')"
                                }
                              }
                            },
                            "Get_Scan_Reference": {
                              "foreach": "@body('Parse_Launch_Scan_Output')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']",
                              "actions": {
                                "Check_for_Scan_Reference": {
                                  "actions": {
                                    "Set_variable_-_ScanRef": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "ScanRef",
                                        "value": "@items('Get_Scan_Reference')?['VALUE']"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "equals": [
                                          "@items('Get_Scan_Reference')?['KEY']",
                                          "REFERENCE"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "runAfter": {
                                "Parse_Launch_Scan_Output": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "Launch_Scan": {
                              "type": "ApiConnection",
                              "inputs": {
                                "headers": {
                                  "X-Requested-With": "Sentinel"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/api/2.0/fo/scan/",
                                "queries": {
                                  "action": "launch",
                                  "ip": "@{join(variables('IPAddrToScan'), ',')}",
                                  "iscanner_name": "@variables('Scanner')",
                                  "option_id": "@body('Parse_Create_Option_Profile_Output')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE']",
                                  "scan_title": "@{concat('SentinelAdHoc_', utcNow())}"
                                }
                              }
                            },
                            "Parse_Check_Scan_Status_Output": {
                              "runAfter": {
                                "Check_Scan_Status": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@json(xml(body('Check_Scan_Status')))",
                                "schema": {
                                  "properties": {
                                    "SCAN_LIST_OUTPUT": {
                                      "properties": {
                                        "RESPONSE": {
                                          "properties": {
                                            "DATETIME": {
                                              "type": "string"
                                            },
                                            "SCAN_LIST": {
                                              "properties": {
                                                "SCAN": {
                                                  "properties": {
                                                    "DURATION": {
                                                      "type": "string"
                                                    },
                                                    "LAUNCH_DATETIME": {
                                                      "type": "string"
                                                    },
                                                    "PROCESSED": {
                                                      "type": "string"
                                                    },
                                                    "PROCESSING_PRIORITY": {
                                                      "type": "string"
                                                    },
                                                    "REF": {
                                                      "type": "string"
                                                    },
                                                    "STATUS": {
                                                      "properties": {
                                                        "STATE": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "TARGET": {
                                                      "properties": {
                                                        "__cdata": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "TITLE": {
                                                      "properties": {
                                                        "__cdata": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "TYPE": {
                                                      "type": "string"
                                                    },
                                                    "USER_LOGIN": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              }
                            },
                            "Parse_Launch_Scan_Output": {
                              "runAfter": {
                                "Launch_Scan": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@json(xml(body('Launch_Scan')))",
                                "schema": {
                                  "properties": {
                                    "SIMPLE_RETURN": {
                                      "properties": {
                                        "RESPONSE": {
                                          "properties": {
                                            "DATETIME": {
                                              "type": "string"
                                            },
                                            "ITEM_LIST": {
                                              "properties": {
                                                "ITEM": {
                                                  "items": {
                                                    "properties": {
                                                      "KEY": {
                                                        "type": "string"
                                                      },
                                                      "VALUE": {
                                                        "type": "string"
                                                      }
                                                    },
                                                    "required": [
                                                      "KEY",
                                                      "VALUE"
                                                    ],
                                                    "type": "object"
                                                  },
                                                  "type": "array"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "TEXT": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              }
                            },
                            "Set_variable_-_ScanStatus": {
                              "runAfter": {
                                "Parse_Check_Scan_Status_Output": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "ScanStatus",
                                "value": "@body('Parse_Check_Scan_Status_Output')?['SCAN_LIST_OUTPUT']?['RESPONSE']?['SCAN_LIST']?['SCAN']?['STATUS']?['STATE']"
                              }
                            },
                            "Wait_Until_Scan_is_finished": {
                              "actions": {
                                "Check_Scan_Status_Again": {
                                  "runAfter": {
                                    "Sleep_for_5_minutes": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "headers": {
                                      "X-Requested-With": "Sentinel"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/api/2.0/fo/scan/",
                                    "queries": {
                                      "action": "list",
                                      "scan_ref": "@variables('ScanRef')"
                                    }
                                  }
                                },
                                "Parse_Check_Scan_Status_Output_Again": {
                                  "runAfter": {
                                    "Check_Scan_Status_Again": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@json(xml(body('Check_Scan_Status_Again')))",
                                    "schema": {
                                      "properties": {
                                        "SCAN_LIST_OUTPUT": {
                                          "properties": {
                                            "RESPONSE": {
                                              "properties": {
                                                "DATETIME": {
                                                  "type": "string"
                                                },
                                                "SCAN_LIST": {
                                                  "properties": {
                                                    "SCAN": {
                                                      "properties": {
                                                        "DURATION": {
                                                          "type": "string"
                                                        },
                                                        "LAUNCH_DATETIME": {
                                                          "type": "string"
                                                        },
                                                        "PROCESSED": {
                                                          "type": "string"
                                                        },
                                                        "PROCESSING_PRIORITY": {
                                                          "type": "string"
                                                        },
                                                        "REF": {
                                                          "type": "string"
                                                        },
                                                        "STATUS": {
                                                          "properties": {
                                                            "STATE": {
                                                              "type": "string"
                                                            }
                                                          },
                                                          "type": "object"
                                                        },
                                                        "TARGET": {
                                                          "properties": {
                                                            "__cdata": {
                                                              "type": "string"
                                                            }
                                                          },
                                                          "type": "object"
                                                        },
                                                        "TITLE": {
                                                          "properties": {
                                                            "__cdata": {
                                                              "type": "string"
                                                            }
                                                          },
                                                          "type": "object"
                                                        },
                                                        "TYPE": {
                                                          "type": "string"
                                                        },
                                                        "USER_LOGIN": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "Set_variable": {
                                  "runAfter": {
                                    "Parse_Check_Scan_Status_Output_Again": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ScanStatus",
                                    "value": "@body('Parse_Check_Scan_Status_Output_Again')?['SCAN_LIST_OUTPUT']?['RESPONSE']?['SCAN_LIST']?['SCAN']?['STATUS']?['STATE']"
                                  }
                                },
                                "Sleep_for_5_minutes": {
                                  "type": "Wait",
                                  "inputs": {
                                    "interval": {
                                      "count": 2,
                                      "unit": "Minute"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Set_variable_-_ScanStatus": [
                                  "Succeeded"
                                ]
                              },
                              "expression": "@equals(variables('ScanStatus'), 'Finished')",
                              "limit": {
                                "count": 60,
                                "timeout": "PT1H"
                              },
                              "type": "Until"
                            }
                          },
                          "runAfter": {
                            "Find_Available_Scanner_": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_to_Incident_Comment_if_no_Scanner_is_online": {
                                "type": "AppendToStringVariable",
                                "inputs": {
                                  "name": "IncidentComment",
                                  "value": "No Online Scanner available to launch scan.\n"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@variables('Scanner')",
                                    null
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Create_Option_Profile_for_Scan": {
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "X-Requested-With": "Sentinel"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/api/2.0/fo/subscription/option_profile/vm/",
                            "queries": {
                              "action": "create",
                              "basic_information_gathering": "all",
                              "map_tcp_ports_additional": "1",
                              "map_udp_ports_additional": "1",
                              "scan_tcp_ports": "full",
                              "scan_udp_ports": "full",
                              "title": "@{concat('ScanOptionProfile_', utcNow())}",
                              "vulnerability_detection": "complete"
                            }
                          }
                        },
                        "Find_Available_Scanner_": {
                          "foreach": "@body('Parse_List_Scanner_Appliance_Output')?['APPLIANCE_LIST_OUTPUT']?['RESPONSE']?['APPLIANCE_LIST']?['APPLIANCE']",
                          "actions": {
                            "Check_Scanner_Status": {
                              "actions": {
                                "Set_variable_-_Scanner": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "Scanner",
                                    "value": "@items('Find_Available_Scanner_')?['NAME']"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@items('Find_Available_Scanner_')?['STATUS']",
                                      "Online"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "runAfter": {
                            "Parse_List_Scanner_Appliance_Output": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "List_Scanner_Appliances": {
                          "runAfter": {
                            "Parse_Create_Option_Profile_Output": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "X-Requested-With": "Sentinel"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/api/2.0/fo/appliance/",
                            "queries": {
                              "action": "list"
                            }
                          }
                        },
                        "Parse_Create_Option_Profile_Output": {
                          "runAfter": {
                            "Create_Option_Profile_for_Scan": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@json(xml(body('Create_Option_Profile_for_Scan')))",
                            "schema": {
                              "properties": {
                                "!DOCTYPE": {
                                  "properties": {
                                    "@@name": {
                                      "type": "string"
                                    },
                                    "@@system": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "?xml": {
                                  "properties": {
                                    "@@encoding": {
                                      "type": "string"
                                    },
                                    "@@version": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "SIMPLE_RETURN": {
                                  "properties": {
                                    "RESPONSE": {
                                      "properties": {
                                        "DATETIME": {
                                          "type": "string"
                                        },
                                        "ITEM_LIST": {
                                          "properties": {
                                            "ITEM": {
                                              "properties": {
                                                "KEY": {
                                                  "type": "string"
                                                },
                                                "VALUE": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "TEXT": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "Parse_List_Scanner_Appliance_Output": {
                          "runAfter": {
                            "List_Scanner_Appliances": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@json(xml(body('List_Scanner_Appliances')))",
                            "schema": {
                              "properties": {
                                "APPLIANCE_LIST_OUTPUT": {
                                  "properties": {
                                    "RESPONSE": {
                                      "properties": {
                                        "APPLIANCE_LIST": {
                                          "properties": {
                                            "APPLIANCE": {
                                              "items": {
                                                "properties": {
                                                  "ID": {
                                                    "type": "string"
                                                  },
                                                  "NAME": {
                                                    "type": "string"
                                                  },
                                                  "RUNNING_SCAN_COUNT": {
                                                    "type": "string"
                                                  },
                                                  "RUNNING_SLICES_COUNT": {
                                                    "type": "string"
                                                  },
                                                  "SOFTWARE_VERSION": {
                                                    "type": "string"
                                                  },
                                                  "STATUS": {
                                                    "type": "string"
                                                  },
                                                  "UUID": {
                                                    "type": "string"
                                                  }
                                                },
                                                "required": [
                                                  "ID",
                                                  "UUID",
                                                  "NAME",
                                                  "SOFTWARE_VERSION",
                                                  "RUNNING_SLICES_COUNT",
                                                  "RUNNING_SCAN_COUNT",
                                                  "STATUS"
                                                ],
                                                "type": "object"
                                              },
                                              "type": "array"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "DATETIME": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "For_each_IP_Address": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Append_to_Incident_Comment_If_no_IP_for_a_new_scan": {
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "IncidentComment",
                              "value": "No IP to launch a new scan.\n"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "not": {
                              "equals": [
                                "@length(variables('IPAddrToScan'))",
                                0
                              ]
                            }
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Compose_Comment": {
                      "runAfter": {
                        "Create_SAS_URI_by_path_(V2)": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose",
                      "inputs": "<strong>Following Qualys VM Scan Report Generated: </strong>@{body('Create_SAS_URI_by_path_(V2)')?['WebUrl']}\n"
                    },
                    "Create_SAS_URI_by_path_(V2)": {
                      "runAfter": {
                        "Create_blob_(V2)": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "Permissions": "Read"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azureblob']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/v2/datasets/@{encodeURIComponent('AccountNameFromSettings')}/CreateSharedLinkByPath",
                        "queries": {
                          "path": "@body('Create_blob_(V2)')?['Path']"
                        }
                      }
                    },
                    "Create_Scan_Report_Template": {
                      "runAfter": {
                        "Check_if_there_is_any_IP_Address_to_Scan": [
                          "Succeeded",
                          "TimedOut"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<SCANTEMPLATE>\n\t<TITLE>\n\t\t<INFO key=\"title\">\n\t\t\t<![CDATA[@{concat('SentinelScanReportTemplate_', utcNow())}]]>\n\t\t</INFO>\n\t</TITLE>\n\t<TARGET>\n\t\t<INFO key=\"scan_selection\">\n\t\t\t<![CDATA[HostBased]]>\n\t\t</INFO>\n\t\t<INFO key=\"ips\">\n\t\t\t<![CDATA[@{join(variables('IPAddresses'), ',')}]]>\n\t\t</INFO>\n\t</TARGET>\n\t<DISPLAY>\n\t\t<INFO key=\"display_text_summary\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"graph_status\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"graph_potential_status\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"graph_severity\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"graph_potential_severity\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"graph_ig_severity\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"graph_top_categories\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"graph_top_vulns\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"graph_os\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"graph_services\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"graph_top_ports\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"display_custom_footer\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"display_custom_footer_text\">\n\t\t\t<![CDATA[Report Generated by Sentinel Playbook]]>\n\t\t</INFO>\n\t\t<INFO key=\"sort_by\">\n\t\t\t<![CDATA[vuln]]>\n\t\t</INFO>\n\t\t<INFO key=\"cvss\">\n\t\t\t<![CDATA[cvssv3]]>\n\t\t</INFO>\n\t\t<INFO key=\"host_details\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"metadata_ec2_instances\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_text_summary\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details_threat\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details_impact\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details_solution\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details_vpatch\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details_compliance\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details_exploit\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details_malware\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details_results\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details_reopened\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"include_vuln_details_appendix\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"exclude_account_id\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t</DISPLAY>\n\t<FILTER>\n\t\t<INFO key=\"selective_vulns\">\n\t\t\t<![CDATA[complete]]>\n\t\t</INFO>\n\t\t<INFO key=\"included_os\">\n\t\t\t<![CDATA[AIX,ASUS,WINDOWS,LINUX,UBUNTU]]>\n\t\t</INFO>\n\t\t<INFO key=\"status_new\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"status_active\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"status_reopen\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"vuln_active\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"vuln_disabled\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"vuln_ignored\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"potential_active\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"potential_disabled\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"potential_ignored\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"ig_active\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"ig_disabled\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"ig_ignored\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"display_non_running_kernels\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"exclude_non_running_services\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"exclude_qids_not_exploitable_due_to_configuration\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"exclude_superceded_patches\">\n\t\t\t<![CDATA[1]]>\n\t\t</INFO>\n\t\t<INFO key=\"categories_list\">\n\t\t\t<![CDATA[Cisco,Debian,Finger,Windows,Ubuntu]]>\n\t\t</INFO>\n\t</FILTER>\n\t<SERVICESPORTS>\n\t\t<INFO key=\"unauthorized_ports\">\n\t\t\t<![CDATA[21,22,23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080]]>\n\t\t</INFO>\n\t</SERVICESPORTS>\n</SCANTEMPLATE>",
                        "headers": {
                          "Content-Type": "text/xml",
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/report/template/scan/",
                        "queries": {
                          "action": "create",
                          "report_format": "xml"
                        }
                      }
                    },
                    "Create_blob_(V2)": {
                      "runAfter": {
                        "Download_Scan_Report": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@body('Download_Scan_Report')",
                        "headers": {
                          "ReadFileMetadataFromServer": true
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azureblob']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/v2/datasets/@{encodeURIComponent(encodeURIComponent('AccountNameFromSettings'))}/files",
                        "queries": {
                          "folderPath": "/report-blob",
                          "name": "@{concat('ScanReport_', utcNow())}",
                          "queryParametersSingleEncoded": true
                        }
                      },
                      "runtimeConfiguration": {
                        "contentTransfer": {
                          "transferMode": "Chunked"
                        }
                      }
                    },
                    "Delay_1_Minute": {
                      "runAfter": {
                        "Parse_Launch_Scan_Report_Output": [
                          "Succeeded"
                        ]
                      },
                      "type": "Wait",
                      "inputs": {
                        "interval": {
                          "count": 1,
                          "unit": "Minute"
                        }
                      }
                    },
                    "Delete_Option_Profile": {
                      "runAfter": {
                        "Add_comment_to_incident_(V3)": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/subscription/option_profile/vm/",
                        "queries": {
                          "action": "delete",
                          "id": "@body('Parse_Launch_Scan_Report_Output')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE']"
                        }
                      }
                    },
                    "Delete_Scan_Report_Template": {
                      "runAfter": {
                        "Delete_Option_Profile": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "Content-Type": "text/xml",
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/report/template/scan/",
                        "queries": {
                          "action": "delete",
                          "template_id": "@body('Parse_Scan_Report_Template_Output')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE']"
                        }
                      }
                    },
                    "Download_Scan_Report": {
                      "runAfter": {
                        "Wait_Until_Report_Generation_is_Finished": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/report/",
                        "queries": {
                          "action": "fetch",
                          "id": "@body('Parse_Launch_Scan_Report_Output')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE']"
                        }
                      },
                      "runtimeConfiguration": {
                        "staticResult": {
                          "staticResultOptions": "Disabled",
                          "name": "Download_Scan_Report0"
                        }
                      }
                    },
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      }
                    },
                    "For_each_IP_Address": {
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Append_to_IP_Address_List": {
                          "runAfter": {
                            "Get_Asset_Details_By_IP": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "IPAddresses",
                            "value": "@items('For_each_IP_Address')?['Address']"
                          }
                        },
                        "Check_if_Asset_Scanned_in_last_24_Hours": {
                          "actions": {
                            "List_of_IP_Addresses_to_Scan": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "IPAddrToScan",
                                "value": "@items('For_each_IP_Address')?['Address']"
                              }
                            }
                          },
                          "runAfter": {
                            "Parse_Asset_Details": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Check_if_IP_is_configured_for_scanning": {
                                "actions": {
                                  "Append_to_Incident_Comment": {
                                    "type": "AppendToStringVariable",
                                    "inputs": {
                                      "name": "IncidentComment",
                                      "value": "@{items('For_each_IP_Address')?['Address']} IP Address is not configured for scanning.\n"
                                    }
                                  }
                                },
                                "expression": {
                                  "and": [
                                    {
                                      "equals": [
                                        "@body('Parse_Asset_Details')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['LAST_VM_SCANNED_DATE']",
                                        null
                                      ]
                                    }
                                  ]
                                },
                                "type": "If"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@body('Parse_Asset_Details')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['LAST_VM_SCANNED_DATE']",
                                    null
                                  ]
                                }
                              },
                              {
                                "less": [
                                  "@body('Parse_Asset_Details')?['HOST_LIST_OUTPUT']?['RESPONSE']?['HOST_LIST']?['HOST']?['LAST_VM_SCANNED_DATE']",
                                  "@subtractFromTime(utcNow(), 24, 'Hour')"
                                ]
                              }
                            ]
                          },
                          "type": "If",
                          "description": "rtrert"
                        },
                        "Get_Asset_Details_By_IP": {
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "X-Requested-With": "Sentinel"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/api/2.0/fo/asset/host/",
                            "queries": {
                              "action": "list",
                              "details": "All",
                              "ips": "@items('For_each_IP_Address')?['Address']"
                            }
                          }
                        },
                        "Parse_Asset_Details": {
                          "runAfter": {
                            "Append_to_IP_Address_List": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@json(xml(base64ToString(body('Get_Asset_Details_By_IP')?['$content'])))",
                            "schema": {
                              "properties": {
                                "HOST_LIST_OUTPUT": {
                                  "properties": {
                                    "REQUEST": {
                                      "properties": {
                                        "DATETIME": {
                                          "type": [
                                            "object",
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "PARAM_LIST": {
                                          "properties": {
                                            "PARAM": {
                                              "properties": {
                                                "KEY": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "VALUE": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "POST_DATA": {
                                          "type": [
                                            "object",
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "RESOURCE": {
                                          "type": [
                                            "object",
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "USER_LOGIN": {
                                          "type": [
                                            "object",
                                            "string",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "RESPONSE": {
                                      "properties": {
                                        "DATETIME": {
                                          "type": [
                                            "object",
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "GLOSSARY": {
                                          "properties": {
                                            "ASSET_GROUP_LIST": {
                                              "properties": {
                                                "ASSET_GROUP": {
                                                  "properties": {
                                                    "ID": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "TITLE": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "USER_DEF": {
                                              "properties": {
                                                "LABEL_1": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "LABEL_2": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "LABEL_3": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "VALUE_1": {
                                                  "properties": {
                                                    "__text": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "_ud_attr": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "VALUE_2": {
                                                  "properties": {
                                                    "__text": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "_ud_attr": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "VALUE_3": {
                                                  "properties": {
                                                    "__text": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "_ud_attr": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "USER_LIST": {
                                              "properties": {
                                                "USER": {
                                                  "properties": {
                                                    "FIRST_NAME": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "LAST_NAME": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "USER_LOGIN": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "HOST_LIST": {
                                          "properties": {
                                            "HOST": {
                                              "properties": {
                                                "ARS_FACTORS": {
                                                  "properties": {
                                                    "ARS_FORMULA": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "VULN_COUNT": {
                                                      "properties": {
                                                        "__text": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "_qds_severity": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "ASSET_CRITICALITY_SCORE": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "ASSET_GROUP_IDS": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "ASSET_ID": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "ASSET_RISK_SCORE": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "CLOUD_PROVIDER": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "CLOUD_PROVIDER_TAGS": {
                                                  "properties": {
                                                    "CLOUD_TAG": {
                                                      "properties": {
                                                        "LAST_SUCCESS_DATE": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "NAME": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "VALUE": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "CLOUD_RESOURCE_ID": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "CLOUD_SERVICE": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "COMMENTS": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "DNS": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "DNS_DATA": {
                                                  "properties": {
                                                    "DOMAIN": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "FQDN": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "HOSTNAME": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "EC2_INSTANCE_ID": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "ID": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "IP": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "IPV6": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "LAST_COMPLIANCE_SCAN_DATETIME": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "LAST_SCAP_SCAN_DATETIME": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "LAST_VM_AUTH_SCANNED_DATE": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "LAST_VM_AUTH_SCANNED_DURATION": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "LAST_VM_SCANNED_DATE": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "LAST_VM_SCANNED_DURATION": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "LAST_VULN_SCAN_DATETIME": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "METADATA": {
                                                  "properties": {
                                                    "AZURE": {
                                                      "properties": {
                                                        "ATTRIBUTE": {
                                                          "properties": {
                                                            "LAST_ERROR": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "LAST_ERROR_DATE": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "LAST_STATUS": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "LAST_SUCCESS_DATE": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "NAME": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "VALUE": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            }
                                                          },
                                                          "type": "object"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "EC2": {
                                                      "properties": {
                                                        "ATTRIBUTE": {
                                                          "properties": {
                                                            "LAST_ERROR": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "LAST_ERROR_DATE": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "LAST_STATUS": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "LAST_SUCCESS_DATE": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "NAME": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "VALUE": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            }
                                                          },
                                                          "type": "object"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "GOOGLE": {
                                                      "properties": {
                                                        "ATTRIBUTE": {
                                                          "properties": {
                                                            "LAST_ERROR": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "LAST_ERROR_DATE": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "LAST_STATUS": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "LAST_SUCCESS_DATE": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "NAME": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            },
                                                            "VALUE": {
                                                              "type": [
                                                                "object",
                                                                "string",
                                                                "null"
                                                              ]
                                                            }
                                                          },
                                                          "type": "object"
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "NETBIOS": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "NETWORK_ID": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "OS": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "OWNER": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "QG_HOSTID": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "TAGS": {
                                                  "properties": {
                                                    "TAG": {
                                                      "properties": {
                                                        "NAME": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "TAG_ID": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "TRACKING_METHOD": {
                                                  "type": [
                                                    "object",
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "USER_DEF": {
                                                  "properties": {
                                                    "LABEL_1": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "LABEL_2": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "LABEL_3": {
                                                      "type": [
                                                        "object",
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "VALUE_1": {
                                                      "properties": {
                                                        "__text": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "_ud_attr": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "VALUE_2": {
                                                      "properties": {
                                                        "__text": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "_ud_attr": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "VALUE_3": {
                                                      "properties": {
                                                        "__text": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "_ud_attr": {
                                                          "type": [
                                                            "object",
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "ID_SET": {
                                          "properties": {
                                            "ID": {
                                              "type": [
                                                "object",
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "ID_RANGE": {
                                              "type": [
                                                "object",
                                                "string",
                                                "null"
                                              ]
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "WARNING": {
                                          "properties": {
                                            "CODE": {
                                              "type": [
                                                "object",
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "TEXT": {
                                              "type": [
                                                "object",
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "URL": {
                                              "type": [
                                                "object",
                                                "string",
                                                "null"
                                              ]
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_-_IncidentComment": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Get_Report_Status": {
                      "runAfter": {
                        "Delay_1_Minute": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/report/",
                        "queries": {
                          "action": "list",
                          "id": "@int(body('Parse_Launch_Scan_Report_Output')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE'])"
                        }
                      }
                    },
                    "Initialize_variable_-_IPAddrToScan": {
                      "runAfter": {
                        "Initialize_variable_-_IPAddresses": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "IPAddrToScan",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_IPAddresses": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "IPAddresses",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_IncidentComment": {
                      "runAfter": {
                        "Initialize_variable_-_ReportStatus": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "IncidentComment",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_ReportStatus": {
                      "runAfter": {
                        "Initialize_variable_-_ScanStatus": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ReportStatus",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_ScanRef": {
                      "runAfter": {
                        "Initialize_variable_-_Scanner": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ScanRef",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_ScanStatus": {
                      "runAfter": {
                        "Initialize_variable_-_ScanRef": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ScanStatus",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_Scanner": {
                      "runAfter": {
                        "Initialize_variable_-_IPAddrToScan": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Scanner",
                            "type": "string",
                            "value": "null"
                          }
                        ]
                      }
                    },
                    "Launch_VM_Scan_Report": {
                      "runAfter": {
                        "Parse_Scan_Report_Template_Output": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "headers": {
                          "X-Requested-With": "Sentinel"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/2.0/fo/report/",
                        "queries": {
                          "action": "launch",
                          "output_format": "pdf",
                          "report_title": "@{concat('ScanReport_', utcNow())}",
                          "report_type": "Scan",
                          "template_id": "@body('Parse_Scan_Report_Template_Output')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE']"
                        }
                      }
                    },
                    "Parse_Launch_Scan_Report_Output": {
                      "runAfter": {
                        "Launch_VM_Scan_Report": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@json(xml(body('Launch_VM_Scan_Report')))",
                        "schema": {
                          "properties": {
                            "SIMPLE_RETURN": {
                              "properties": {
                                "REQUEST": {
                                  "properties": {
                                    "DATETIME": {
                                      "type": "string"
                                    },
                                    "PARAM_LIST": {
                                      "properties": {
                                        "PARAM": {
                                          "properties": {
                                            "KEY": {
                                              "type": "string"
                                            },
                                            "VALUE": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "POST_DATA": {
                                      "type": "string"
                                    },
                                    "RESOURCE": {
                                      "type": "string"
                                    },
                                    "USER_LOGIN": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "RESPONSE": {
                                  "properties": {
                                    "CODE": {
                                      "type": "string"
                                    },
                                    "DATETIME": {
                                      "type": "string"
                                    },
                                    "ITEM_LIST": {
                                      "properties": {
                                        "ITEM": {
                                          "properties": {
                                            "KEY": {
                                              "type": "string"
                                            },
                                            "VALUE": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "TEXT": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Parse_Report_Status": {
                      "runAfter": {
                        "Get_Report_Status": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@json(xml(body('Get_Report_Status')))",
                        "schema": {
                          "properties": {
                            "REPORT_LIST_OUTPUT": {
                              "properties": {
                                "RESPONSE": {
                                  "properties": {
                                    "DATETIME": {
                                      "type": "string"
                                    },
                                    "REPORT_LIST": {
                                      "properties": {
                                        "REPORT": {
                                          "properties": {
                                            "EXPIRATION_DATETIME": {
                                              "type": "string"
                                            },
                                            "ID": {
                                              "type": "string"
                                            },
                                            "LAUNCH_DATETIME": {
                                              "type": "string"
                                            },
                                            "OUTPUT_FORMAT": {
                                              "type": "string"
                                            },
                                            "SIZE": {
                                              "type": "string"
                                            },
                                            "STATUS": {
                                              "properties": {
                                                "MESSAGE": {
                                                  "properties": {
                                                    "#cdata-section": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "PERCENT": {
                                                  "type": "string"
                                                },
                                                "STATE": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "TITLE": {
                                              "properties": {
                                                "#cdata-section": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "TYPE": {
                                              "type": "string"
                                            },
                                            "USER_LOGIN": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Parse_Scan_Report_Template_Output": {
                      "runAfter": {
                        "Create_Scan_Report_Template": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@json(xml(body('Create_Scan_Report_Template')))",
                        "schema": {
                          "properties": {
                            "!DOCTYPE": {
                              "properties": {
                                "@@name": {
                                  "type": "string"
                                },
                                "@@system": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            },
                            "?xml": {
                              "properties": {
                                "@@encoding": {
                                  "type": "string"
                                },
                                "@@version": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            },
                            "SIMPLE_RETURN": {
                              "properties": {
                                "RESPONSE": {
                                  "properties": {
                                    "DATETIME": {
                                      "type": "string"
                                    },
                                    "ITEM_LIST": {
                                      "properties": {
                                        "ITEM": {
                                          "properties": {
                                            "KEY": {
                                              "type": "string"
                                            },
                                            "VALUE": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "TEXT": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Set_variable_-_ReportStatus": {
                      "runAfter": {
                        "Parse_Report_Status": [
                          "Succeeded"
                        ]
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "ReportStatus",
                        "value": "@body('Parse_Report_Status')?['REPORT_LIST_OUTPUT']?['RESPONSE']?['REPORT_LIST']?['REPORT']?['STATUS']?['STATE']"
                      }
                    },
                    "Wait_Until_Report_Generation_is_Finished": {
                      "actions": {
                        "Delay_for_3_minutes": {
                          "type": "Wait",
                          "inputs": {
                            "interval": {
                              "count": 3,
                              "unit": "Minute"
                            }
                          }
                        },
                        "Get_Report_Status_Again": {
                          "runAfter": {
                            "Delay_for_3_minutes": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "X-Requested-With": "Sentinel"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['QualysCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/api/2.0/fo/report/",
                            "queries": {
                              "action": "list",
                              "id": "@int(body('Parse_Launch_Scan_Report_Output')?['SIMPLE_RETURN']?['RESPONSE']?['ITEM_LIST']?['ITEM']?['VALUE'])"
                            }
                          }
                        },
                        "Parse_Report_Status_Again": {
                          "runAfter": {
                            "Get_Report_Status_Again": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@json(xml(body('Get_Report_Status_Again')))",
                            "schema": {
                              "properties": {
                                "REPORT_LIST_OUTPUT": {
                                  "properties": {
                                    "RESPONSE": {
                                      "properties": {
                                        "DATETIME": {
                                          "type": "string"
                                        },
                                        "REPORT_LIST": {
                                          "properties": {
                                            "REPORT": {
                                              "properties": {
                                                "EXPIRATION_DATETIME": {
                                                  "type": "string"
                                                },
                                                "ID": {
                                                  "type": "string"
                                                },
                                                "LAUNCH_DATETIME": {
                                                  "type": "string"
                                                },
                                                "OUTPUT_FORMAT": {
                                                  "type": "string"
                                                },
                                                "SIZE": {
                                                  "type": "string"
                                                },
                                                "STATUS": {
                                                  "properties": {
                                                    "MESSAGE": {
                                                      "properties": {
                                                        "#cdata-section": {
                                                          "type": "string"
                                                        }
                                                      },
                                                      "type": "object"
                                                    },
                                                    "PERCENT": {
                                                      "type": "string"
                                                    },
                                                    "STATE": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "TITLE": {
                                                  "properties": {
                                                    "#cdata-section": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "TYPE": {
                                                  "type": "string"
                                                },
                                                "USER_LOGIN": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "Update_variable_-_ReportStatus": {
                          "runAfter": {
                            "Parse_Report_Status_Again": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "ReportStatus",
                            "value": "@body('Parse_Report_Status_Again')?['REPORT_LIST_OUTPUT']?['RESPONSE']?['REPORT_LIST']?['REPORT']?['STATUS']?['STATE']"
                          }
                        }
                      },
                      "runAfter": {
                        "Set_variable_-_ReportStatus": [
                          "Succeeded"
                        ]
                      },
                      "expression": "@equals(variables('ReportStatus'), 'Finished')",
                      "limit": {
                        "count": 60,
                        "timeout": "PT3H"
                      },
                      "type": "Until"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "QualysCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('QualyscustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('QualyscustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azureblob": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureblobConnectionName'))]",
                        "connectionName": "[[variables('AzureblobConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azureblob')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "QualysVM-LaunchVMScan-GenerateReport",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('QualyscustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureblobConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('QualyscustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('QualyscustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureblobConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureblobConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                },
                "parameterValues": {
                  "accountName": "[[variables('AzureBlobStorageName')]",
                  "accessKey": "[[listKeys(variables('StorageAccountId'), '2019-04-01').keys[0].value]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-4')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId5'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId5')]",
                "contentId": "[variables('_playbookContentId5')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "QualysVM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_QualysCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "QualysVM-LaunchVMScan-GenerateReport",
            "description": "When a new sentinel incident is created, this playbook gets triggered and performs the following actions: \n 1. Get IP Addresses from incident. \n 2. Scan IP Addresses with Qualys Scanner. \n 3. Generate the Scan Report. \n 4. Download the report and store it to a blob storage. \n 5. Add the link of report as a comment to the incident.",
            "prerequisites": [
              "1. Prior to the deployment of this playbook, Qualys Logic App Custom Connector needs to be deployed under the same subscription.",
              "2. Refer to [Qualys Logic App Custom Connector](../QualysCustomConnector/readme.md) documentation for deployment instructions."
            ],
            "postDeployment": [
              "None"
            ],
            "lastUpdateTime": "2022-09-13T22:25:52Z",
            "entities": [
              "IP"
            ],
            "tags": [
              "Qualys",
              "Enrichment",
              "VM Scan"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.2",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "QualysVM",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_QualysCustomConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_QualysVM-GetAssetDetails')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_QualysVM-GetAssets-ByCVEID')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_QualysVM-GetAssets-ByOpenPort')]",
              "version": "[variables('playbookVersion4')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_QualysVM-LaunchVMScan-GenerateReport')]",
              "version": "[variables('playbookVersion5')]"
            }
          ]
        },
        "firstPublishDate": "2020-12-14",
        "lastPublishDate": "2022-09-30",
        "providers": [
          "Qualys"
        ],
        "categories": {
          "domains": [
            "Security - Vulnerability Management",
            "Security - Automation (SOAR)"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
