{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Thijs Xhaflaire - thijs.xhaflaire@jamf.com",
    "comments": "Solution template for Jamf Protect"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Jamf Protect Workbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "email": "thijs.xhaflaire@jamf.com",
    "_email": "[variables('email')]",
    "solutionId": "jamfsoftwareaustraliaptyltd1620360395539.jamf_protect",
    "_solutionId": "[variables('solutionId')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "uiConfigId1": "JamfProtect",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "JamfProtect",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
    "dataConnectorVersion1": "2.2.0",
    "parserName1": "JamfProtect",
    "_parserName1": "[concat(parameters('workspace'),'/',variables('parserName1'))]",
    "parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
    "_parserId1": "[variables('parserId1')]",
    "parserTemplateSpecName1": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId1')))]",
    "parserVersion1": "1.0.0",
    "parserContentId1": "JamfProtect-Parser",
    "_parserContentId1": "[variables('parserContentId1')]",
    "workbookVersion1": "2.0.0",
    "workbookContentId1": "JamfProtectWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "analyticRuleVersion1": "1.0.5",
    "analyticRulecontentId1": "6098daa0-f05e-44d5-b5a0-913e63ba3179",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1')))]",
    "analyticRuleVersion2": "1.0.3",
    "analyticRulecontentId2": "44da53c3-f3b0-4b70-afff-f79275cb9442",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2')))]",
    "analyticRuleVersion3": "1.0.2",
    "analyticRulecontentId3": "9eb2f758-003b-4303-83c6-97aed4c03e41",
    "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
    "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
    "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3')))]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "Jamf Protect data connector with template",
        "displayName": "Jamf Protect template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "Jamf Protect data connector with template version 2.2.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Jamf Protect",
                  "publisher": "Jamf",
                  "descriptionMarkdown": "The [Jamf Protect](https://www.jamf.com/products/jamf-protect/) connector provides the capability to read raw event data from Jamf Protect in Microsoft Sentinel.",
                  "graphQueries": [
                    {
                      "metricName": "Total Activities data received",
                      "legend": "jamfprotect_CL",
                      "baseQuery": "jamfprotect_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Jamf Protect - All events.",
                      "query": "jamfprotect_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "Jamf Protect - All active endpoints.",
                      "query": "jamfprotect_CL\n | where notempty(input_host_hostname_s) | summarize Event = count() by input_host_hostname_s\n | project-rename HostName = input_host_hostname_s\n | sort by Event desc"
                    },
                    {
                      "description": "Jamf Protect - Top 10 endpoints with Alerts",
                      "query": "jamfprotect_CL\n | where topicType_s == 'alert' and notempty(input_eventType_s) and notempty(input_host_hostname_s)\n | summarize Event = count() by input_host_hostname_s\n | project-rename HostName = input_host_hostname_s\n | top 10 by Event"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "jamfprotect_CL",
                      "lastDataReceivedQuery": "jamfprotect_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "jamfprotect_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "This connector reads data from the jamfprotect_CL table created by Jamf Protect in a Microsoft Analytics Workspace, if the [data forwarding](https://docs.jamf.com/jamf-protect/documentation/Data_Forwarding_to_a_Third_Party_Storage_Solution.html?hl=sentinel#task-4227) option is enabled in Jamf Protect then raw event data is sent to the Microsoft Sentinel Ingestion API."
                    }
                  ],
                  "metadata": {
                    "id": "AF74EDD7-5534-46CD-B75D-7119BE1D161D",
                    "version": "2.2.0",
                    "kind": "dataConnector",
                    "source": {
                      "kind": "solution",
                      "name": "Jamf Protect for Microsoft Sentinel"
                    },
                    "author": {
                      "name": "Thijs Xhaflaire"
                    },
                    "support": {
                      "tier": "developer",
                      "name": "Jamf Software, LLC",
                      "email": "support@jamf.com",
                      "link": "https://jamf.com/support/"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Jamf Protect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Thijs Xhaflaire",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Jamf Software, LLC",
          "email": "support@jamf.com",
          "tier": "Partner",
          "link": "https://www.jamf.com/support/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Jamf Protect",
          "publisher": "Jamf",
          "descriptionMarkdown": "The [Jamf Protect](https://www.jamf.com/products/jamf-protect/) connector provides the capability to read raw event data from Jamf Protect in Microsoft Sentinel.",
          "graphQueries": [
            {
              "metricName": "Total Activities data received",
              "legend": "jamfprotect_CL",
              "baseQuery": "jamfprotect_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "jamfprotect_CL",
              "lastDataReceivedQuery": "jamfprotect_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "jamfprotect_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Jamf Protect - All events.",
              "query": "jamfprotect_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "Jamf Protect - All active endpoints.",
              "query": "jamfprotect_CL\n | where notempty(input_host_hostname_s) | summarize Event = count() by input_host_hostname_s\n | project-rename HostName = input_host_hostname_s\n | sort by Event desc"
            },
            {
              "description": "Jamf Protect - Top 10 endpoints with Alerts",
              "query": "jamfprotect_CL\n | where topicType_s == 'alert' and notempty(input_eventType_s) and notempty(input_host_hostname_s)\n | summarize Event = count() by input_host_hostname_s\n | project-rename HostName = input_host_hostname_s\n | top 10 by Event"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "This connector reads data from the jamfprotect_CL table created by Jamf Protect in a Microsoft Analytics Workspace, if the [data forwarding](https://docs.jamf.com/jamf-protect/documentation/Data_Forwarding_to_a_Third_Party_Storage_Solution.html?hl=sentinel#task-4227) option is enabled in Jamf Protect then raw event data is sent to the Microsoft Sentinel Ingestion API."
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "JamfProtect Data Parser with template",
        "displayName": "JamfProtect Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName1'),'/',variables('parserVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "JamfProtect Data Parser with template version 2.2.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName1')]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "JamfProtect",
                "category": "Samples",
                "functionAlias": "JamfProtect",
                "query": "\nlet JamfProtectAlerts_view  = view () {\njamfprotect_CL\n| where topicType_s == \"alert\"\n    and input_eventType_s <> \"GPUnifiedLogEvent\"\n    and isnotempty(input_match_severity_d)\n| extend \n    Related_users = parse_json(input_related_users_s),\n    Related_files = parse_json(input_related_files_s),\n    Related_binaries = parse_json(input_related_binaries_s),\n    Related_groups = parse_json(input_related_groups_s),\n    Related_processes = parse_json(input_related_processes_s),\n    Match_facts = parse_json(input_match_facts_s),\n    Match_tags = parse_json(input_match_tags_s),\n    Match_actions = parse_json(input_match_actions_s),\n    Match_context = parse_json(input_match_context_s),\n    Match_event_process_signing = parse_json(input_match_event_process_signingInfo_s)\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Alerts'\n| project-rename\n    EventOriginalUid = input_match_uuid_g\n| extend\n    // Jamf Protect - Common Fields\n    EventType = case(\n                input_eventType_s == \"GPClickEvent\",\n                \"Click\",\n                input_eventType_s == \"GPDownloadEvent\",\n                \"Download\",\n                input_eventType_s == \"GPFSEvent\",\n                \"FileSystem\",\n                input_eventType_s == \"GPProcessEvent\",\n                \"Process\",\n                input_eventType_s == \"GPKeylogRegisterEvent\",\n                \"Keylog\",\n                input_eventType_s == \"GPGatekeeperEvent\",\n                \"Gatekeeper\",\n                input_eventType_s == \"GPMRTEvent\",\n                \"MRT\",\n                input_eventType_s == \"GPPreventedExecutionEvent\",\n                \"ProcessDenied\",\n                input_eventType_s == \"GPThreatMatchExecEvent\",\n                \"ProcessPrevented\",\n                input_eventType_s == \"GPUnifiedLogEvent\",\n                \"UnifiedLog\",\n                input_eventType_s == \"GPUSBEvent\",\n                \"USB\",\n                input_eventType_s == \"auth-mount\",\n                \"UsbBlock\",\n                \"Unknown\"\n            ),\n    EventDescription = coalesce(Match_facts[1].human, Match_facts[0].human),\n    EventMessage = coalesce(Match_facts[1].name, Match_facts[0].name),\n    EventStartTime = unixtime_milliseconds_todatetime(tolong(timestamp_d)),\n    EventResult = case(Match_actions has \"Prevented\", \"Prevented\", \"Allowed\"),\n    //\n    // Jamf Protect - Alert details\n    //\n    EventSeverity = case(input_match_severity_d == 0, \"Informational\", input_match_severity_d == 1, \"Low\", input_match_severity_d == 2, \"Medium\", input_match_severity_d == 3, \"High\", \"Informational\"),\n    EventMatch = column_ifexists(\"input_match_event_matchValue_s\", \"\"),\n    EventMatchType = column_ifexists(\"input_match_event_matchType_s\", \"\"),\n    EventReportUrl = strcat(\"https://\", context_identity_claims_hd_s, \".jamfcloud.com/Alerts/\", EventOriginalUid),\n    //\n    // Jamf Protect - Source User\n    SrcUsername = tostring(coalesce(Related_users[1].name, Related_users[0].name)),\n    //\n    // Jamf Protect - Source Device Hostnames\n    //\n    TargetHostname = column_ifexists(\"input_host_hostname_s\", \"\"),\n    DvcHostname = column_ifexists(\"input_host_hostname_s\", \"\"),\n    DvcIpAddr = column_ifexists(\"input_host_ips_s\", \"\"),\n    DvcId = column_ifexists(\"input_host_provisioningUDID_g\", \"\"),\n    DvcOs=\"macOS\",\n    SrcDeviceType=\"Computer\",\n    //\n    // Jamf Protect Alerts - Process\n    //\n    //ParentProcessName = coalesce(input_match_event_process_ppid_d, parse_json('input_related_processes_s')[0].ppid), //column_ifexists(\"exec_chain_child_parent_path_s\", \"\"), coalesce('input.match.event.process.ppid', mvindex('input.related.processes{}.ppid', 0))\n    ProcessEventType = case(input_match_event_type_d == 0, \"None\", input_match_event_type_d == 1, \"Create\", input_match_event_type_d == 2, \"Exit\", \"\"),\n    ProcessEventSubType = case(input_match_event_subType_d == 7, \"Exec\", input_match_event_subType_d == 1, \"Fork\", input_match_event_subType_d == 23, \"Execve\", input_match_event_subType_d == 43190, \"Posix Spawn\", \"\"),\n    ParentProcessId = coalesce(input_match_event_process_ppid_d, toreal(Related_processes[0].ppid)),\n    ParentProcessGuid = tostring(coalesce(input_match_event_process_pgid_d, toreal(Related_processes[0].pgid))),\n    TargetProcessName = coalesce(input_match_event_process_name_s, Related_processes[0].name),\n    TargetProcessId = coalesce(toreal(input_match_event_process_pid_d), toreal(Related_processes[0].pid)),\n    TargetProcessGuid = coalesce(input_match_event_process_uid_d, toreal(Related_processes[0].uid)),\n    TargetProcessSHA1 = Related_binaries[0].sha1hex,\n    TargetProcessCreationTime = unixtime_milliseconds_todatetime(tolong(input_match_event_process_startTimestamp_d)),\n    TargetProcessCommandLine = column_ifexists(\"input_match_event_process_args_s\", \"\"),\n    TargetProcessCurrentDirectory = column_ifexists(\"input_match_event_process_path_s\", \"\"),\n    TargetUserId = toreal(coalesce(Related_users[1].uid, Related_users[0].uid)),\n    TargetUsername = tostring(coalesce(Related_users[1].name, Related_users[0].uid)),\n    //\n    // Jamf Protect Alerts - Files\n    //\n    TargetFilePath = tostring(coalesce(input_match_event_path_s, Related_files[0].path)),\n    TargetFileSHA1 = Related_files[0].sha1hex,\n    TargetFileSHA256 = Related_files[0].sha256hex,\n    TargetFileSize = Related_files[0].size,\n    TargetFileSigningInfoMessage = Related_files[0].signingInfo.statusMessage,\n    TargetFileSignerType = case(Related_files[0].signingInfo.signerType == 0, \"Apple\", Related_files[0].signingInfo.signerType == 1, \"App Store\", Related_files[0].signingInfo.signerType == 2, \"Developer\", Related_files[0].signingInfo.signerType == 3, \"Ad Hoc\", Related_files[0].signingInfo.signerType == 4, \"Unsigned\", \"\"),\n    TargetFileSigningTeamID = Related_files[0].signingInfo.teamid,\n    TargetFileIsDownload = case(Related_files[0].isDownload == \"true\", \"true\", Related_files[0].isDownload == \"false\", \"false\", \"\"),\n    TargetFileIsAppBundle = case(Related_files[0].isAppBundle == \"true\", \"true\", Related_files[0].isAppBundle == \"false\", \"false\", \"\"),\n    TargetFileIsDirectory = case(Related_files[0].isDirectory == \"true\", \"true\", Related_files[0].isDirectory == \"false\", \"false\", \"\"),\n    TargetFileIsScreenshot = case(Related_files[0].isScreenShot == \"true\", \"true\", Related_files[0].isScreenShot == \"false\", \"false\", \"\"),\n    //\n    // Jamf Protect Alerts - Binaries\n    TargetBinaryFilePath = Related_binaries[0].path,\n    TargetBinarySHA1 = tostring(Related_binaries[0].sha1hex),\n    TargetBinarySHA256 = tostring(Related_binaries[0].sha256hex),\n    TargetBinarySigningInfoMessage = Related_binaries[0].signingInfo.statusMessage,\n    TargetbinarySignerType = case(Related_binaries[0].signingInfo.signerType == 0, \"Apple\", Related_binaries[0].signingInfo.signerType == 1, \"App Store\", Related_binaries[0].signingInfo.signerType == 2, \"Developer\", Related_binaries[0].signingInfo.signerType == 3, \"Ad Hoc\", Related_binaries[0].signingInfo.signerType == 4, \"Unsigned\", \"\"),\n    TargetBinarySigningTeamID = tostring(Related_binaries[0].signingInfo.teamid),\n    TargetBinarySigningAppID = tostring(Related_binaries[0].signingInfo.appid)\n| project-reorder\n    TimeGenerated,\n    EventStartTime,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventDescription,\n    EventMessage,\n    EventSeverity,\n    EventMatch,\n    EventMatchType,\n    EventResult,\n    EventReportUrl,\n    TargetHostname,\n    DvcHostname,\n    DvcId,\n    DvcOs,\n    DvcIpAddr,\n    SrcDeviceType,\n    SrcUsername,\n    ProcessEventType,\n    ProcessEventSubType,\n    ParentProcessId,\n    ParentProcessGuid,\n    TargetProcessName,\n    TargetProcessId,\n    TargetProcessGuid,\n    TargetProcessSHA1,\n    TargetProcessCreationTime,\n    TargetProcessCommandLine,\n    TargetProcessCurrentDirectory,\n    TargetUsername,\n    TargetUserId,\n    TargetFilePath,\n    TargetFileSHA1,\n    TargetFileSHA256,\n    TargetFileSize,\n    TargetFileSigningInfoMessage,\n    TargetFileSignerType,\n    TargetFileSigningTeamID,\n    TargetFileIsAppBundle,\n    TargetFileIsDirectory,\n    TargetFileIsDownload,\n    TargetFileIsScreenshot,\n    TargetBinaryFilePath,\n    TargetBinarySHA1,\n    TargetBinarySHA256,\n    TargetBinarySigningInfoMessage,\n    TargetbinarySignerType,\n    TargetBinarySigningTeamID,\n    TargetBinarySigningAppID,\n    Related_users,\n    Related_files,\n    Related_binaries,\n    Related_groups,\n    Related_processes,\n    Match_event_process_signing,\n    Match_facts,\n    Match_actions,\n    Match_tags,\n    *input_match_event_*\n    | project-keep\n    TimeGenerated,\n    EventStartTime,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventDescription,\n    EventMessage,\n    EventSeverity,\n    EventMatch,\n    EventMatchType,\n    EventResult,\n    EventReportUrl,\n    TargetHostname,\n    DvcHostname,\n    DvcId,\n    DvcOs,\n    DvcIpAddr,\n    SrcDeviceType,\n    SrcUsername,\n    ProcessEventType,\n    ProcessEventSubType,\n    ParentProcessId,\n    ParentProcessGuid,\n    TargetProcessName,\n    TargetProcessId,\n    TargetProcessGuid,\n    TargetProcessSHA1,\n    TargetProcessCreationTime,\n    TargetProcessCommandLine,\n    TargetProcessCurrentDirectory,\n    TargetUsername,\n    TargetUserId,\n    TargetFilePath,\n    TargetFileSHA1,\n    TargetFileSHA256,\n    TargetFileSize,\n    TargetFileSigningInfoMessage,\n    TargetFileSignerType,\n    TargetFileSigningTeamID,\n    TargetFileIsAppBundle,\n    TargetFileIsDirectory,\n    TargetFileIsDownload,\n    TargetFileIsScreenshot,\n    TargetBinaryFilePath,\n    TargetBinarySHA1,\n    TargetBinarySHA256,\n    TargetBinarySigningInfoMessage,\n    TargetbinarySignerType,\n    TargetBinarySigningTeamID,\n    TargetBinarySigningAppID,\n    Related_users,\n    Related_files,\n    Related_binaries,\n    Related_groups,\n    Related_processes,\n    Match_event_process_signing,\n    Match_facts,\n    Match_actions,\n    Match_tags,\n    *input_match_event_*\n};\nlet JamfProtectUnifiedLog_view  = view () {\njamfprotect_CL\n| where input_eventType_s == \"GPUnifiedLogEvent\"\n    and isnotempty(input_match_severity_d)\n| extend \n    Related_users = parse_json(input_related_users_s),\n    Related_files = parse_json(input_related_files_s),\n    Related_binaries = parse_json(input_related_binaries_s),\n    Related_groups = parse_json(input_related_groups_s),\n    Related_processes = parse_json(input_related_processes_s),\n    Match_facts = parse_json(input_match_facts_s),\n    Match_tags = parse_json(input_match_tags_s),\n    Match_actions = parse_json(input_match_actions_s),\n    Match_context = parse_json(input_match_context_s),\n    Match_event_process_signing = parse_json(input_match_event_process_signingInfo_s)\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Unified Log'\n| project-rename\n    EventOriginalUid = input_match_uuid_g\n| extend\n    // Jamf Protect - Common Fields\n    EventType = case(\n                input_eventType_s == \"GPClickEvent\",\n                \"Click\",\n                input_eventType_s == \"GPDownloadEvent\",\n                \"Download\",\n                input_eventType_s == \"GPFSEvent\",\n                \"FileSystem\",\n                input_eventType_s == \"GPProcessEvent\",\n                \"Process\",\n                input_eventType_s == \"GPKeylogRegisterEvent\",\n                \"Keylog\",\n                input_eventType_s == \"GPGatekeeperEvent\",\n                \"Gatekeeper\",\n                input_eventType_s == \"GPMRTEvent\",\n                \"MRT\",\n                input_eventType_s == \"GPPreventedExecutionEvent\",\n                \"ProcessDenied\",\n                input_eventType_s == \"GPThreatMatchExecEvent\",\n                \"ProcessPrevented\",\n                input_eventType_s == \"GPUnifiedLogEvent\",\n                \"UnifiedLog\",\n                input_eventType_s == \"GPUSBEvent\",\n                \"USB\",\n                input_eventType_s == \"Auth-mount\",\n                \"UsbBlock\",\n                \"Unknown\"\n            ),\n    EventDescription = coalesce(Match_facts[1].human, Match_facts[0].human),\n    EventStartTime = unixtime_milliseconds_todatetime(tolong(timestamp_d)),\n    EventResult = case(Match_actions has \"Prevented\", \"Prevented\", \"Allowed\"),\n    //\n    // Jamf Protect - Unified Logs details\n    //\n    EventSeverity = case(input_match_severity_d == 0, \"Informational\", input_match_severity_d == 1, \"Low\", input_match_severity_d == 2, \"Medium\", input_match_severity_d == 3, \"High\", \"Informational\"),\n    EventMatch = column_ifexists(\"input_match_event_matchValue_s\", \"\"),\n    EventMatchType = column_ifexists(\"input_match_event_matchType_s\", \"\"),\n    EventReportUrl = strcat(\"https://\", context_identity_claims_hd_s, \".jamfcloud.com/Alerts/\", EventOriginalUid),\n    //\n    // Jamf Protect - Source User\n    SrcUsername = tostring(coalesce(Related_users[1].name, Related_users[0].name)),\n    //\n    // Jamf Protect - Source Device Hostnames\n    //\n    TargetHostname = column_ifexists(\"input_host_hostname_s\", \"\"),\n    DvcHostname = column_ifexists(\"input_host_hostname_s\", \"\"),\n    DvcIpAddr = column_ifexists(\"input_host_ips_s\", \"\"),\n    DvcId = column_ifexists(\"input_host_provisioningUDID_g\", \"\"),\n    DvcOs=\"macOS\",\n    SrcDeviceType=\"Computer\",\n    //\n    // Jamf Protect Unified Logs - Process\n    //\n    //ParentProcessName = coalesce(input_match_event_process_ppid_d, parse_json('input_related_processes_s')[0].ppid), //column_ifexists(\"exec_chain_child_parent_path_s\", \"\"), coalesce('input.match.event.process.ppid', mvindex('input.related.processes{}.ppid', 0))\n    ProcessEventType = case(input_match_event_type_d == 0, \"None\", input_match_event_type_d == 1, \"Create\", input_match_event_type_d == 2, \"Exit\", \"\"),\n    ProcessEventSubType = case(input_match_event_subType_d == 7, \"Exec\", input_match_event_subType_d == 1, \"Fork\", input_match_event_subType_d == 23, \"Execve\", input_match_event_subType_d == 43190, \"Posix Spawn\", \"\"),\n    ParentProcessId = coalesce(input_match_event_process_ppid_d, toreal(Related_processes[0].ppid)),\n    ParentProcessGuid = tostring(coalesce(input_match_event_process_pgid_d, toreal(Related_processes[0].pgid))),\n    TargetProcessName = coalesce(input_match_event_process_name_s, Related_processes[0].name),\n    TargetProcessId = coalesce(toreal(input_match_event_process_pid_d), toreal(Related_processes[0].pid)),\n    TargetProcessGuid = coalesce(input_match_event_process_uid_d, toreal(Related_processes[0].uid)),\n    TargetProcessSHA1 = Related_binaries[0].sha1hex,\n    TargetProcessCreationTime = unixtime_milliseconds_todatetime(tolong(input_match_event_process_startTimestamp_d)),\n    TargetProcessCommandLine = column_ifexists(\"input_match_event_process_args_s\", \"\"),\n    TargetProcessCurrentDirectory = column_ifexists(\"input_match_event_process_path_s\", \"\"),\n    TargetUserId = toreal(coalesce(Related_users[1].uid, Related_users[0].uid)),\n    TargetUsername = tostring(coalesce(Related_users[1].name, Related_users[0].name)),\n    //\n    // Jamf Protect Unified Logs - Files\n    //\n    TargetFilePath = tostring(coalesce(input_match_event_path_s, Related_files[0].path)),\n    TargetFileSHA1 = Related_files[0].sha1hex,\n    TargetFileSHA256 = Related_files[0].sha256hex,\n    TargetFileSize = Related_files[0].size,\n    TargetFileSigningInfoMessage = Related_files[0].signingInfo.statusMessage,\n    TargetFileSignerType = case(Related_files[0].signingInfo.signerType == 0, \"Apple\", Related_files[0].signingInfo.signerType == 1, \"App Store\", Related_files[0].signingInfo.signerType == 2, \"Developer\", Related_files[0].signingInfo.signerType == 3, \"Ad Hoc\", Related_files[0].signingInfo.signerType == 4, \"Unsigned\", \"\"),\n    TargetFileSigningTeamID = Related_files[0].signingInfo.teamid,\n    TargetFileIsDownload = case(Related_files[0].isDownload == \"true\", \"true\", Related_files[0].isDownload == \"false\", \"false\", \"\"),\n    TargetFileIsAppBundle = case(Related_files[0].isAppBundle == \"true\", \"true\", Related_files[0].isAppBundle == \"false\", \"false\", \"\"),\n    TargetFileIsDirectory = case(Related_files[0].isDirectory == \"true\", \"true\", Related_files[0].isDirectory == \"false\", \"false\", \"\"),\n    TargetFileIsScreenshot = case(Related_files[0].isScreenShot == \"true\", \"true\", Related_files[0].isScreenShot == \"false\", \"false\", \"\")\n| project-reorder\n    TimeGenerated,\n    EventStartTime,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventDescription,\n    EventSeverity,\n    EventMatch,\n    EventMatchType,\n    EventResult,\n    EventReportUrl,\n    TargetHostname,\n    DvcHostname,\n    DvcId,\n    DvcOs,\n    DvcIpAddr,\n    SrcDeviceType,\n    SrcUsername,\n    ProcessEventType,\n    ProcessEventSubType,\n    ParentProcessId,\n    ParentProcessGuid,\n    TargetProcessName,\n    TargetProcessId,\n    TargetProcessGuid,\n    TargetProcessSHA1,\n    TargetProcessCreationTime,\n    TargetProcessCommandLine,\n    TargetProcessCurrentDirectory,\n    TargetUsername,\n    TargetUserId,\n    TargetFilePath,\n    TargetFileSHA1,\n    TargetFileSHA256,\n    TargetFileSize,\n    TargetFileSigningInfoMessage,\n    TargetFileSignerType,\n    TargetFileSigningTeamID,\n    TargetFileIsAppBundle,\n    TargetFileIsDirectory,\n    TargetFileIsDownload,\n    TargetFileIsScreenshot,\n    Related_users,\n    Related_files,\n    Related_binaries,\n    Related_groups,\n    Related_processes,\n    Match_event_process_signing,\n    Match_facts,\n    Match_actions,\n    Match_tags\n    | project-keep\n    TimeGenerated,\n    EventStartTime,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventDescription,\n    EventSeverity,\n    EventMatch,\n    EventMatchType,\n    EventResult,\n    EventReportUrl,\n    TargetHostname,\n    DvcHostname,\n    DvcId,\n    DvcOs,\n    DvcIpAddr,\n    SrcDeviceType,\n    SrcUsername,\n    ProcessEventType,\n    ProcessEventSubType,\n    ParentProcessId,\n    ParentProcessGuid,\n    TargetProcessName,\n    TargetProcessId,\n    TargetProcessGuid,\n    TargetProcessSHA1,\n    TargetProcessCreationTime,\n    TargetProcessCommandLine,\n    TargetProcessCurrentDirectory,\n    TargetUsername,\n    TargetUserId,\n    TargetFilePath,\n    TargetFileSHA1,\n    TargetFileSHA256,\n    TargetFileSize,\n    TargetFileSigningInfoMessage,\n    TargetFileSignerType,\n    TargetFileSigningTeamID,\n    TargetFileIsAppBundle,\n    TargetFileIsDirectory,\n    TargetFileIsDownload,\n    TargetFileIsScreenshot,\n    Related_users,\n    Related_files,\n    Related_binaries,\n    Related_groups,\n    Related_processes,\n    Match_event_process_signing,\n    Match_facts,\n    Match_actions,\n    Match_tags,\n    *input_match_event*\n};\nlet JamfProtectNetworkTraffic_view  = view () {\njamfprotect_CL\n| where event_metadata_product_s == \"Network Traffic Stream\"\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Network Traffic Stream'\n| project-rename\n| extend\n    // Jamf Protect - Common Fields\n    EventType = \"query\",\n    EventSubType = \"request\",\n    EventStartTime = unixtime_milliseconds_todatetime(tolong(event_receiptTime_d)),\n    EventResult = case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Prevented\", ''),\n    // Jamf Protect - Source User\n    SrcUsermail=column_ifexists('event_user_email_s', ''),\n    SrcUsername =  column_ifexists('event_user_name_s', ''),\n    // Jamf Protect - Source Device Hostnames\n    DvcHostname = case(isnotempty(input_host_hostname_s), input_host_hostname_s, isnotempty(host_info_host_name_s), host_info_host_name_s, event_device_userDeviceName_s),\n    DvcIpAddr = column_ifexists(\"event_source_ip_s\", \"\"),\n    DvcId = column_ifexists(\"event_device_externalId_g\", \"\"),\n    DvcOs = case(event_device_osType_s == \"MAC_OS\", \"macOS\", event_device_osType_s == \"IOS\", \"iOS\", event_device_osType_s == \"ANDROID\", \"Android\", \"Other\"),\n    SrcDeviceType = case(event_device_osType_s == \"MAC_OS\", \"Computer\", event_device_osType_s == \"IOS\", \"Mobile Device\", event_device_osType_s == \"ANDROID\", \"Mobile Device\", \"Other\"),\n    // Jamf Protect - DNS Specific\n    DnsQuery = column_ifexists('event_hostName_s', ''),\n    DvcAction = case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Blocked\", ''),\n    DnsQueryName = column_ifexists('event_domain_s', ''),\n    DstIpAddr = column_ifexists('event_destination_ips_s', ''),\n    ThreatCategory = column_ifexists('event_eventType_description_s', ''),\n    DnsQueryTypeName = column_ifexists('event_dns_recordType_s', ''),\n    DnsResponseName = column_ifexists('event_dns_responseStatus_s', ''),\n    ThreatOriginalRiskLevel = column_ifexists('event_threat_result_s', '')\n| project-keep\n    TimeGenerated,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventSubType,\n    EventStartTime,\n    EventResult,\n    DvcHostname,\n    DvcIpAddr,\n    DvcId,\n    DvcOs,\n    SrcDeviceType,\n    SrcUsermail,\n    SrcUsername,\n    DnsQuery,\n    DnsQueryName,\n    DstIpAddr,\n    DnsQueryTypeName,\n    DvcAction,\n    DnsResponseName,\n    ThreatOriginalRiskLevel\n};\nlet JamfProtectTelemetry_view  = view () {\n    jamfprotect_CL\n    | where header_event_name_s startswith \"AUE_\" \n        or header_event_name_s == \"PLAINTEXT_LOG_COLLECTION_EVENT\"\n        or header_event_name_s == \"SYSTEM_PERFORMANCE_METRICS\"\n    // ASIM - Common Fields\n    | extend EventVendor = 'Jamf'\n    | extend EventProduct = 'Jamf Protect - Telemetry'\n    // Data Field Normalization\n    //| project-rename \n    //    DvcIpAddr = input_host_ips_s,\n    //    DvcId = context_identity_claims_clientid_g\n    | extend\n        // Jamf Protect Alerts - Generic Information\n        EventSeverity = case(\n                    input_match_severity_d == 0,\n                    \"Informational\",\n                    input_match_severity_d == 1,\n                    \"Low\",\n                    input_match_severity_d == 2,\n                    \"Medium\",\n                    input_match_severity_d == 3,\n                    \"High\",\n                    \"Informational\"\n                ),\n        EventStartTime = unixtime_milliseconds_todatetime(tolong(timestamp_d)),\n        EventResult = coalesce(return_description_s, texts_s),\n        // Jamf Protect Telemetry - Endpoint Information\n        TargetModel = column_ifexists(\"metrics_hw_model_s\", \"\"),\n        DvcOsVersion = column_ifexists(\"host_info_osversion_s\", \"\"),\n        TargetHostname = case(isnotempty(input_host_hostname_s), input_host_hostname_s, isnotempty(host_info_host_name_s), host_info_host_name_s, event_device_userDeviceName_s),\n        DvcHostname = case(isnotempty(input_host_hostname_s), input_host_hostname_s, isnotempty(host_info_host_name_s), host_info_host_name_s, event_device_userDeviceName_s),\n        DvcIpAddr = column_ifexists(\"input_host_ips_s\", \"\"),\n        DvcId = column_ifexists(\"context_identity_claims_clientid_g\", \"\"),\n        // Jamf Protect - Event Types\n        EventType = case(\n                header_event_name_s == \"AUE_add_to_group\",\n                \"UserAddedToGroup\",\n                header_event_name_s == \"AUE_AUDITCTL\",\n                \"AuditEvent\",\n                header_event_name_s == \"AUE_AUDITON_SPOLICY\",\n                \"AuditEvent\",\n                header_event_name_s == \"AUE_auth_user\",\n                \"Elevate\",\n                header_event_name_s == \"AUE_BIND\",\n                \"EndpointNetworkSession\",\n                header_event_name_s == \"AUE_BIOS_FIRMWARE_VERSIONS\",\n                \"SystemInformation\",\n                header_event_name_s == \"AUE_CHDIR\",\n                \"FolderMoved\",\n                header_event_name_s == \"AUE_CHROOT\",\n                \"FolderModified\",\n                header_event_name_s == \"AUE_CONNECT\",\n                \"EndpointNetworkSession\",\n                header_event_name_s == \"AUE_create_group\",\n                \"GroupCreated\",\n                header_event_name_s == \"AUE_create_user\",\n                \"UserCreated\",\n                header_event_name_s == \"AUE_delete_group\",\n                \"GroupDeleted\",\n                header_event_name_s == \"AUE_delete_user\",\n                \"UserDeleted\",\n                header_event_name_s == \"AUE_EXECVE\",\n                \"ProcessCreated\",\n                header_event_name_s == \"AUE_EXIT\",\n                \"ProcessTerminated\",\n                header_event_name_s == \"AUE_FORK\",\n                \"ProcessCreated\",\n                header_event_name_s == \"AUE_GETAUID\",\n                \"\",\n                header_event_name_s == \"AUE_KILL\",\n                \"ProcessTerminated\",\n                header_event_name_s == \"AUE_LISTEN\",\n                \"EndpointNetworkSession\",\n                header_event_name_s == \"AUE_logout\",\n                \"Logoff\",\n                header_event_name_s == \"AUE_lw_login\",\n                \"Logon\",\n                header_event_name_s == \"AUE_MAC_SET_PROC\",\n                \"AuditEvent\",\n                header_event_name_s == \"AUE_modify_group\",\n                \"GroupModified\",\n                header_event_name_s == \"AUE_modify_password\",\n                \"PasswordChanged\",\n                header_event_name_s == \"AUE_modify_user\",\n                \"UserModified\",\n                header_event_name_s == \"AUE_MOUNT\",\n                \"VolumeMount\",\n                header_event_name_s == \"AUE_openssh\",\n                \"SshInitiated\",\n                header_event_name_s == \"AUE_PIDFORTASK\",\n                \"ProcessCreated\",\n                header_event_name_s == \"AUE_POSIX_SPAWN\",\n                \"ProcessCreated\",\n                header_event_name_s == \"AUE_remove_from_group\",\n                \"UserRemovedFromGroup\",\n                header_event_name_s == \"AUE_SESSION_CLOSE\",\n                \"Logoff\",\n                header_event_name_s == \"AUE_SESSION_END\",\n                \"Logoff\",\n                header_event_name_s == \"AUE_SESSION_START\",\n                \"Logon\",\n                header_event_name_s == \"AUE_SESSION_UPDATE\",\n                \"\",\n                header_event_name_s == \"AUE_SETPRIORITY\",\n                \"\",\n                header_event_name_s == \"AUE_SETSOCKOPT\",\n                \"\",\n                header_event_name_s == \"AUE_SETTIMEOFDAY\",\n                \"SystemChange\",\n                header_event_name_s == \"AUE_shutdown\",\n                \"ShutdownInitiated\",\n                header_event_name_s == \"AUE_SOCKETPAIR\",\n                \"\",\n                header_event_name_s == \"AUE_ssauthint\",\n                \"Elevate\",\n                header_event_name_s == \"AUE_ssauthmech\",\n                \"Elevate\",\n                header_event_name_s == \"AUE_ssauthorize\",\n                \"Elevate\",\n                header_event_name_s == \"AUE_TASKFORPID\",\n                \"\",\n                header_event_name_s == \"AUE_TASKNAMEFORPID\",\n                \"\",\n                header_event_name_s == \"AUE_UNMOUNT\",\n                \"VolumeUnmount\",\n                header_event_name_s == \"AUE_WAIT4\",\n                \"ProcessTerminated\",\n                header_event_name_s == \"PLAINTEXT_LOG_COLLECTION_EVENT\",\n                \"LogFileCollected\",\n                header_event_name_s == \"SYSTEM_PERFORMANCE_METRICS\",\n                \"SystemPerformanceMetrics\",\n                \"Unknown\"\n            ),\n        // Jamf Protect Telemetry - Process\n        ParentProcessName = column_ifexists(\"exec_chain_child_parent_path_s\", \"\"),\n        ParentProcessId = column_ifexists(\"exec_chain_child_parent_pid_d\", \"\"),\n        ParentProcessGuid = column_ifexists(\"exec_chain_child_parent_uuid_g\", \"\"),\n        TargetProcessName = column_ifexists(\"subject_process_name_s\", \"\"),\n        TargetProcessId = column_ifexists(\"subject_responsible_process_id_d\", \"\"),\n        TargetProcessGuid = column_ifexists(\"subject_process_id_d\", \"\"),\n        TargetProcessSHA1 = todynamic(column_ifexists(\"subject_process_hash_s\", \"\")),\n        TargetUserId = toreal(column_ifexists(\"subject_user_id_d\", \"\")),\n        TargetUsername = tostring(column_ifexists(\"subject_user_name_s\", \"\")),\n        TargetProcessCommandLine = column_ifexists(\"exec_args_args_compiled_s\", \"\"),\n        ActorUsername = tostring(column_ifexists(\"subject_effective_user_name_s\", \"\")),\n        ActorUserId = column_ifexists(\"subject_audit_user_name_s\", \"\"),\n        //column_ifexists(\"application_name_s\", \"\"),\n        //\n        // Jamf Protect Telemetry - Audit/Group\n        //\n        GroupName = todynamic(column_ifexists(\"subject_group_name_s\", \"\")),\n        // Jamf Protect Telemetry - Network\n        DstIpAddr = column_ifexists(\"socket_inet_ip_address_s\", \"\"),\n        DstPortNumber = column_ifexists(\"socket_inet_port_d\", \"\"),\n        NetworkProtocolVersion = case(socket_inet_id_d == 128, \"IPV4\", socket_inet_id_d == 129, \"IPV6\", \"\"),\n        SrcIpAddr = column_ifexists(\"subject_terminal_id_ip_address_s\", \"\"),\n        //\n        // Jamf Protect Telemetry - Binaries\n        //\n        // TargetBinaryFilePath = todynamic(Related_binaries[0].path),\n        TargetBinarySHA256 = tostring(identity_cd_hash_s),\n        // TargetBinarySigningInfoMessage = Related_binaries[0].signingInfo.statusMessage,\n        TargetbinarySignerType = case(identity_signer_type_d == 0, \"Apple\", identity_signer_type_d == 1, \"App Store\", identity_signer_type_d == 2, \"Developer\", identity_signer_type_d == 3, \"Ad Hoc\", identity_signer_type_d == 4, \"Unsigned\", \"\"),\n        TargetBinarySigningTeamID = tostring(identity_team_id_s),\n        //\n        // Jamf Protect Telemetry - Log File Collection\n        //\n        TargetFilePath = tostring(parse_json(path_s))\n    | project-reorder\n        EventStartTime,\n        EventVendor,\n        EventProduct,\n        EventType,\n        EventSeverity,\n        EventResult,\n        TargetHostname,\n        DvcHostname,\n        DvcId,\n        DvcOsVersion,\n        DvcIpAddr,\n        TargetModel,\n        TargetUserId,\n        TargetUsername,\n        ParentProcessName,\n        ParentProcessId,\n        ParentProcessGuid,\n        TargetProcessName,\n        TargetProcessId,\n        TargetProcessGuid,\n        TargetProcessSHA1,\n        TargetProcessCommandLine,\n        ActorUsername,\n        ActorUserId,\n        TargetBinarySHA256,\n        TargetbinarySignerType,\n        TargetBinarySigningTeamID,\n        GroupName,\n        SrcIpAddr,\n        DstIpAddr,\n        DstPortNumber,\n        NetworkProtocolVersion,\n        TargetFilePath\n    | project-away\n        arguments_sflags_d,\n        arguments_am_failure_d,\n        arguments_am_success_d\n};\nlet JamfProtectThreatEvents_view  = view () {\njamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\"\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Threat Events Stream'\n| project-rename\n| extend\n    // Jamf Protect - Common Fields\n    EventStartTime = column_ifexists(\"event_timestamp_t\", \"\"),\n    EventResult=case(event_action_s == \"Blocked\", \"Blocked\", event_action_s == \"Detected\", \"Detected\", ''),\n    EventReportUrl = column_ifexists(\"event_eventUrl_s\", \"\"),\n    // Jamf Protect - Alert Details\n    EventSeverity = case(event_severity_d == 2, \"Informational\", event_severity_d == 4, \"Low\", event_severity_d == 6, \"Medium\", event_severity_d == 8, \"High\", event_severity_d == 10, \"High\", \"Informational\"),\n    // Jamf Protect - Source User\n    SrcUsermail=column_ifexists('event_user_email_s', ''),\n    SrcUsername=column_ifexists('event_user_name_s', ''),\n    // Jamf Protect - Source Device Hostnames\n    DvcHostname = column_ifexists(\"event_device_userDeviceName_s\", \"\"),\n    DvcIpAddr = column_ifexists(\"event_source_ip_s\", \"\"),\n    DvcId = column_ifexists(\"event_device_externalId_g\", \"\"),\n    DvcOs=case(event_device_os_s has \"MAC_OS\", \"macOS\", event_device_os_s has \"IOS\", \"iOS\", event_device_os_s has \"ANDROID\", \"Android\", \"Other\"),\n    SrcDeviceType=case(event_device_os_s has \"MAC_OS\", \"Computer\", event_device_os_s has \"IOS\", \"Mobile Device\", event_device_os_s has \"ANDROID\", \"Mobile Device\", \"Other\"),\n    // Jamf Protect - DNS Specific\n    DnsQuery=column_ifexists('event_hostName_s', ''),\n    DvcAction=case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Blocked\", ''),\n    DnsQueryName=column_ifexists('event_destination_name_s', ''),\n    DstIpAddr=column_ifexists('event_destination_ip_s', ''),\n    ThreatCategory=column_ifexists('event_eventType_description_s', ''),\n    ThreatOriginalRiskLevel=column_ifexists('event_threat_result_s', ''),\n    // Jamf Protect - App Specific\n    TargetFileName = column_ifexists(\"event_app_name_s\", \"\"),\n    TargetFileSHA1 = column_ifexists(\"event_app_sha1_s\", \"\"),\n    TargetFileSHA256 = column_ifexists(\"event_app_sha256_s\", \"\")\n| project-keep\n    TimeGenerated,\n    EventVendor,\n    EventProduct,\n    EventStartTime,\n    EventResult,\n    EventReportUrl,\n    EventSeverity,\n    DvcHostname,\n    DvcIpAddr,\n    DvcId,\n    SrcDeviceType,\n    SrcUsermail,\n    SrcUsername,\n    DnsQuery,\n    DnsQueryName,\n    DstIpAddr,\n    ThreatCategory,\n    DvcAction,\n    ThreatOriginalRiskLevel,\n    TargetFileName,\n    TargetFileSHA1,\n    TargetFileSHA256\n};\nunion isfuzzy=true JamfProtectAlerts_view, JamfProtectUnifiedLog_view, JamfProtectNetworkTraffic_view, JamfProtectTelemetry_view, JamfProtectThreatEvents_view",
                "functionParameters": "",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "JamfProtect"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName1')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
                "contentId": "[variables('_parserContentId1')]",
                "kind": "Parser",
                "version": "[variables('parserVersion1')]",
                "source": {
                  "name": "Jamf Protect",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName1')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "JamfProtect",
        "category": "Samples",
        "functionAlias": "JamfProtect",
        "query": "\nlet JamfProtectAlerts_view  = view () {\njamfprotect_CL\n| where topicType_s == \"alert\"\n    and input_eventType_s <> \"GPUnifiedLogEvent\"\n    and isnotempty(input_match_severity_d)\n| extend \n    Related_users = parse_json(input_related_users_s),\n    Related_files = parse_json(input_related_files_s),\n    Related_binaries = parse_json(input_related_binaries_s),\n    Related_groups = parse_json(input_related_groups_s),\n    Related_processes = parse_json(input_related_processes_s),\n    Match_facts = parse_json(input_match_facts_s),\n    Match_tags = parse_json(input_match_tags_s),\n    Match_actions = parse_json(input_match_actions_s),\n    Match_context = parse_json(input_match_context_s),\n    Match_event_process_signing = parse_json(input_match_event_process_signingInfo_s)\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Alerts'\n| project-rename\n    EventOriginalUid = input_match_uuid_g\n| extend\n    // Jamf Protect - Common Fields\n    EventType = case(\n                input_eventType_s == \"GPClickEvent\",\n                \"Click\",\n                input_eventType_s == \"GPDownloadEvent\",\n                \"Download\",\n                input_eventType_s == \"GPFSEvent\",\n                \"FileSystem\",\n                input_eventType_s == \"GPProcessEvent\",\n                \"Process\",\n                input_eventType_s == \"GPKeylogRegisterEvent\",\n                \"Keylog\",\n                input_eventType_s == \"GPGatekeeperEvent\",\n                \"Gatekeeper\",\n                input_eventType_s == \"GPMRTEvent\",\n                \"MRT\",\n                input_eventType_s == \"GPPreventedExecutionEvent\",\n                \"ProcessDenied\",\n                input_eventType_s == \"GPThreatMatchExecEvent\",\n                \"ProcessPrevented\",\n                input_eventType_s == \"GPUnifiedLogEvent\",\n                \"UnifiedLog\",\n                input_eventType_s == \"GPUSBEvent\",\n                \"USB\",\n                input_eventType_s == \"auth-mount\",\n                \"UsbBlock\",\n                \"Unknown\"\n            ),\n    EventDescription = coalesce(Match_facts[1].human, Match_facts[0].human),\n    EventMessage = coalesce(Match_facts[1].name, Match_facts[0].name),\n    EventStartTime = unixtime_milliseconds_todatetime(tolong(timestamp_d)),\n    EventResult = case(Match_actions has \"Prevented\", \"Prevented\", \"Allowed\"),\n    //\n    // Jamf Protect - Alert details\n    //\n    EventSeverity = case(input_match_severity_d == 0, \"Informational\", input_match_severity_d == 1, \"Low\", input_match_severity_d == 2, \"Medium\", input_match_severity_d == 3, \"High\", \"Informational\"),\n    EventMatch = column_ifexists(\"input_match_event_matchValue_s\", \"\"),\n    EventMatchType = column_ifexists(\"input_match_event_matchType_s\", \"\"),\n    EventReportUrl = strcat(\"https://\", context_identity_claims_hd_s, \".jamfcloud.com/Alerts/\", EventOriginalUid),\n    //\n    // Jamf Protect - Source User\n    SrcUsername = tostring(coalesce(Related_users[1].name, Related_users[0].name)),\n    //\n    // Jamf Protect - Source Device Hostnames\n    //\n    TargetHostname = column_ifexists(\"input_host_hostname_s\", \"\"),\n    DvcHostname = column_ifexists(\"input_host_hostname_s\", \"\"),\n    DvcIpAddr = column_ifexists(\"input_host_ips_s\", \"\"),\n    DvcId = column_ifexists(\"input_host_provisioningUDID_g\", \"\"),\n    DvcOs=\"macOS\",\n    SrcDeviceType=\"Computer\",\n    //\n    // Jamf Protect Alerts - Process\n    //\n    //ParentProcessName = coalesce(input_match_event_process_ppid_d, parse_json('input_related_processes_s')[0].ppid), //column_ifexists(\"exec_chain_child_parent_path_s\", \"\"), coalesce('input.match.event.process.ppid', mvindex('input.related.processes{}.ppid', 0))\n    ProcessEventType = case(input_match_event_type_d == 0, \"None\", input_match_event_type_d == 1, \"Create\", input_match_event_type_d == 2, \"Exit\", \"\"),\n    ProcessEventSubType = case(input_match_event_subType_d == 7, \"Exec\", input_match_event_subType_d == 1, \"Fork\", input_match_event_subType_d == 23, \"Execve\", input_match_event_subType_d == 43190, \"Posix Spawn\", \"\"),\n    ParentProcessId = coalesce(input_match_event_process_ppid_d, toreal(Related_processes[0].ppid)),\n    ParentProcessGuid = tostring(coalesce(input_match_event_process_pgid_d, toreal(Related_processes[0].pgid))),\n    TargetProcessName = coalesce(input_match_event_process_name_s, Related_processes[0].name),\n    TargetProcessId = coalesce(toreal(input_match_event_process_pid_d), toreal(Related_processes[0].pid)),\n    TargetProcessGuid = coalesce(input_match_event_process_uid_d, toreal(Related_processes[0].uid)),\n    TargetProcessSHA1 = Related_binaries[0].sha1hex,\n    TargetProcessCreationTime = unixtime_milliseconds_todatetime(tolong(input_match_event_process_startTimestamp_d)),\n    TargetProcessCommandLine = column_ifexists(\"input_match_event_process_args_s\", \"\"),\n    TargetProcessCurrentDirectory = column_ifexists(\"input_match_event_process_path_s\", \"\"),\n    TargetUserId = toreal(coalesce(Related_users[1].uid, Related_users[0].uid)),\n    TargetUsername = tostring(coalesce(Related_users[1].name, Related_users[0].uid)),\n    //\n    // Jamf Protect Alerts - Files\n    //\n    TargetFilePath = tostring(coalesce(input_match_event_path_s, Related_files[0].path)),\n    TargetFileSHA1 = Related_files[0].sha1hex,\n    TargetFileSHA256 = Related_files[0].sha256hex,\n    TargetFileSize = Related_files[0].size,\n    TargetFileSigningInfoMessage = Related_files[0].signingInfo.statusMessage,\n    TargetFileSignerType = case(Related_files[0].signingInfo.signerType == 0, \"Apple\", Related_files[0].signingInfo.signerType == 1, \"App Store\", Related_files[0].signingInfo.signerType == 2, \"Developer\", Related_files[0].signingInfo.signerType == 3, \"Ad Hoc\", Related_files[0].signingInfo.signerType == 4, \"Unsigned\", \"\"),\n    TargetFileSigningTeamID = Related_files[0].signingInfo.teamid,\n    TargetFileIsDownload = case(Related_files[0].isDownload == \"true\", \"true\", Related_files[0].isDownload == \"false\", \"false\", \"\"),\n    TargetFileIsAppBundle = case(Related_files[0].isAppBundle == \"true\", \"true\", Related_files[0].isAppBundle == \"false\", \"false\", \"\"),\n    TargetFileIsDirectory = case(Related_files[0].isDirectory == \"true\", \"true\", Related_files[0].isDirectory == \"false\", \"false\", \"\"),\n    TargetFileIsScreenshot = case(Related_files[0].isScreenShot == \"true\", \"true\", Related_files[0].isScreenShot == \"false\", \"false\", \"\"),\n    //\n    // Jamf Protect Alerts - Binaries\n    TargetBinaryFilePath = Related_binaries[0].path,\n    TargetBinarySHA1 = tostring(Related_binaries[0].sha1hex),\n    TargetBinarySHA256 = tostring(Related_binaries[0].sha256hex),\n    TargetBinarySigningInfoMessage = Related_binaries[0].signingInfo.statusMessage,\n    TargetbinarySignerType = case(Related_binaries[0].signingInfo.signerType == 0, \"Apple\", Related_binaries[0].signingInfo.signerType == 1, \"App Store\", Related_binaries[0].signingInfo.signerType == 2, \"Developer\", Related_binaries[0].signingInfo.signerType == 3, \"Ad Hoc\", Related_binaries[0].signingInfo.signerType == 4, \"Unsigned\", \"\"),\n    TargetBinarySigningTeamID = tostring(Related_binaries[0].signingInfo.teamid),\n    TargetBinarySigningAppID = tostring(Related_binaries[0].signingInfo.appid)\n| project-reorder\n    TimeGenerated,\n    EventStartTime,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventDescription,\n    EventMessage,\n    EventSeverity,\n    EventMatch,\n    EventMatchType,\n    EventResult,\n    EventReportUrl,\n    TargetHostname,\n    DvcHostname,\n    DvcId,\n    DvcOs,\n    DvcIpAddr,\n    SrcDeviceType,\n    SrcUsername,\n    ProcessEventType,\n    ProcessEventSubType,\n    ParentProcessId,\n    ParentProcessGuid,\n    TargetProcessName,\n    TargetProcessId,\n    TargetProcessGuid,\n    TargetProcessSHA1,\n    TargetProcessCreationTime,\n    TargetProcessCommandLine,\n    TargetProcessCurrentDirectory,\n    TargetUsername,\n    TargetUserId,\n    TargetFilePath,\n    TargetFileSHA1,\n    TargetFileSHA256,\n    TargetFileSize,\n    TargetFileSigningInfoMessage,\n    TargetFileSignerType,\n    TargetFileSigningTeamID,\n    TargetFileIsAppBundle,\n    TargetFileIsDirectory,\n    TargetFileIsDownload,\n    TargetFileIsScreenshot,\n    TargetBinaryFilePath,\n    TargetBinarySHA1,\n    TargetBinarySHA256,\n    TargetBinarySigningInfoMessage,\n    TargetbinarySignerType,\n    TargetBinarySigningTeamID,\n    TargetBinarySigningAppID,\n    Related_users,\n    Related_files,\n    Related_binaries,\n    Related_groups,\n    Related_processes,\n    Match_event_process_signing,\n    Match_facts,\n    Match_actions,\n    Match_tags,\n    *input_match_event_*\n    | project-keep\n    TimeGenerated,\n    EventStartTime,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventDescription,\n    EventMessage,\n    EventSeverity,\n    EventMatch,\n    EventMatchType,\n    EventResult,\n    EventReportUrl,\n    TargetHostname,\n    DvcHostname,\n    DvcId,\n    DvcOs,\n    DvcIpAddr,\n    SrcDeviceType,\n    SrcUsername,\n    ProcessEventType,\n    ProcessEventSubType,\n    ParentProcessId,\n    ParentProcessGuid,\n    TargetProcessName,\n    TargetProcessId,\n    TargetProcessGuid,\n    TargetProcessSHA1,\n    TargetProcessCreationTime,\n    TargetProcessCommandLine,\n    TargetProcessCurrentDirectory,\n    TargetUsername,\n    TargetUserId,\n    TargetFilePath,\n    TargetFileSHA1,\n    TargetFileSHA256,\n    TargetFileSize,\n    TargetFileSigningInfoMessage,\n    TargetFileSignerType,\n    TargetFileSigningTeamID,\n    TargetFileIsAppBundle,\n    TargetFileIsDirectory,\n    TargetFileIsDownload,\n    TargetFileIsScreenshot,\n    TargetBinaryFilePath,\n    TargetBinarySHA1,\n    TargetBinarySHA256,\n    TargetBinarySigningInfoMessage,\n    TargetbinarySignerType,\n    TargetBinarySigningTeamID,\n    TargetBinarySigningAppID,\n    Related_users,\n    Related_files,\n    Related_binaries,\n    Related_groups,\n    Related_processes,\n    Match_event_process_signing,\n    Match_facts,\n    Match_actions,\n    Match_tags,\n    *input_match_event_*\n};\nlet JamfProtectUnifiedLog_view  = view () {\njamfprotect_CL\n| where input_eventType_s == \"GPUnifiedLogEvent\"\n    and isnotempty(input_match_severity_d)\n| extend \n    Related_users = parse_json(input_related_users_s),\n    Related_files = parse_json(input_related_files_s),\n    Related_binaries = parse_json(input_related_binaries_s),\n    Related_groups = parse_json(input_related_groups_s),\n    Related_processes = parse_json(input_related_processes_s),\n    Match_facts = parse_json(input_match_facts_s),\n    Match_tags = parse_json(input_match_tags_s),\n    Match_actions = parse_json(input_match_actions_s),\n    Match_context = parse_json(input_match_context_s),\n    Match_event_process_signing = parse_json(input_match_event_process_signingInfo_s)\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Unified Log'\n| project-rename\n    EventOriginalUid = input_match_uuid_g\n| extend\n    // Jamf Protect - Common Fields\n    EventType = case(\n                input_eventType_s == \"GPClickEvent\",\n                \"Click\",\n                input_eventType_s == \"GPDownloadEvent\",\n                \"Download\",\n                input_eventType_s == \"GPFSEvent\",\n                \"FileSystem\",\n                input_eventType_s == \"GPProcessEvent\",\n                \"Process\",\n                input_eventType_s == \"GPKeylogRegisterEvent\",\n                \"Keylog\",\n                input_eventType_s == \"GPGatekeeperEvent\",\n                \"Gatekeeper\",\n                input_eventType_s == \"GPMRTEvent\",\n                \"MRT\",\n                input_eventType_s == \"GPPreventedExecutionEvent\",\n                \"ProcessDenied\",\n                input_eventType_s == \"GPThreatMatchExecEvent\",\n                \"ProcessPrevented\",\n                input_eventType_s == \"GPUnifiedLogEvent\",\n                \"UnifiedLog\",\n                input_eventType_s == \"GPUSBEvent\",\n                \"USB\",\n                input_eventType_s == \"Auth-mount\",\n                \"UsbBlock\",\n                \"Unknown\"\n            ),\n    EventDescription = coalesce(Match_facts[1].human, Match_facts[0].human),\n    EventStartTime = unixtime_milliseconds_todatetime(tolong(timestamp_d)),\n    EventResult = case(Match_actions has \"Prevented\", \"Prevented\", \"Allowed\"),\n    //\n    // Jamf Protect - Unified Logs details\n    //\n    EventSeverity = case(input_match_severity_d == 0, \"Informational\", input_match_severity_d == 1, \"Low\", input_match_severity_d == 2, \"Medium\", input_match_severity_d == 3, \"High\", \"Informational\"),\n    EventMatch = column_ifexists(\"input_match_event_matchValue_s\", \"\"),\n    EventMatchType = column_ifexists(\"input_match_event_matchType_s\", \"\"),\n    EventReportUrl = strcat(\"https://\", context_identity_claims_hd_s, \".jamfcloud.com/Alerts/\", EventOriginalUid),\n    //\n    // Jamf Protect - Source User\n    SrcUsername = tostring(coalesce(Related_users[1].name, Related_users[0].name)),\n    //\n    // Jamf Protect - Source Device Hostnames\n    //\n    TargetHostname = column_ifexists(\"input_host_hostname_s\", \"\"),\n    DvcHostname = column_ifexists(\"input_host_hostname_s\", \"\"),\n    DvcIpAddr = column_ifexists(\"input_host_ips_s\", \"\"),\n    DvcId = column_ifexists(\"input_host_provisioningUDID_g\", \"\"),\n    DvcOs=\"macOS\",\n    SrcDeviceType=\"Computer\",\n    //\n    // Jamf Protect Unified Logs - Process\n    //\n    //ParentProcessName = coalesce(input_match_event_process_ppid_d, parse_json('input_related_processes_s')[0].ppid), //column_ifexists(\"exec_chain_child_parent_path_s\", \"\"), coalesce('input.match.event.process.ppid', mvindex('input.related.processes{}.ppid', 0))\n    ProcessEventType = case(input_match_event_type_d == 0, \"None\", input_match_event_type_d == 1, \"Create\", input_match_event_type_d == 2, \"Exit\", \"\"),\n    ProcessEventSubType = case(input_match_event_subType_d == 7, \"Exec\", input_match_event_subType_d == 1, \"Fork\", input_match_event_subType_d == 23, \"Execve\", input_match_event_subType_d == 43190, \"Posix Spawn\", \"\"),\n    ParentProcessId = coalesce(input_match_event_process_ppid_d, toreal(Related_processes[0].ppid)),\n    ParentProcessGuid = tostring(coalesce(input_match_event_process_pgid_d, toreal(Related_processes[0].pgid))),\n    TargetProcessName = coalesce(input_match_event_process_name_s, Related_processes[0].name),\n    TargetProcessId = coalesce(toreal(input_match_event_process_pid_d), toreal(Related_processes[0].pid)),\n    TargetProcessGuid = coalesce(input_match_event_process_uid_d, toreal(Related_processes[0].uid)),\n    TargetProcessSHA1 = Related_binaries[0].sha1hex,\n    TargetProcessCreationTime = unixtime_milliseconds_todatetime(tolong(input_match_event_process_startTimestamp_d)),\n    TargetProcessCommandLine = column_ifexists(\"input_match_event_process_args_s\", \"\"),\n    TargetProcessCurrentDirectory = column_ifexists(\"input_match_event_process_path_s\", \"\"),\n    TargetUserId = toreal(coalesce(Related_users[1].uid, Related_users[0].uid)),\n    TargetUsername = tostring(coalesce(Related_users[1].name, Related_users[0].name)),\n    //\n    // Jamf Protect Unified Logs - Files\n    //\n    TargetFilePath = tostring(coalesce(input_match_event_path_s, Related_files[0].path)),\n    TargetFileSHA1 = Related_files[0].sha1hex,\n    TargetFileSHA256 = Related_files[0].sha256hex,\n    TargetFileSize = Related_files[0].size,\n    TargetFileSigningInfoMessage = Related_files[0].signingInfo.statusMessage,\n    TargetFileSignerType = case(Related_files[0].signingInfo.signerType == 0, \"Apple\", Related_files[0].signingInfo.signerType == 1, \"App Store\", Related_files[0].signingInfo.signerType == 2, \"Developer\", Related_files[0].signingInfo.signerType == 3, \"Ad Hoc\", Related_files[0].signingInfo.signerType == 4, \"Unsigned\", \"\"),\n    TargetFileSigningTeamID = Related_files[0].signingInfo.teamid,\n    TargetFileIsDownload = case(Related_files[0].isDownload == \"true\", \"true\", Related_files[0].isDownload == \"false\", \"false\", \"\"),\n    TargetFileIsAppBundle = case(Related_files[0].isAppBundle == \"true\", \"true\", Related_files[0].isAppBundle == \"false\", \"false\", \"\"),\n    TargetFileIsDirectory = case(Related_files[0].isDirectory == \"true\", \"true\", Related_files[0].isDirectory == \"false\", \"false\", \"\"),\n    TargetFileIsScreenshot = case(Related_files[0].isScreenShot == \"true\", \"true\", Related_files[0].isScreenShot == \"false\", \"false\", \"\")\n| project-reorder\n    TimeGenerated,\n    EventStartTime,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventDescription,\n    EventSeverity,\n    EventMatch,\n    EventMatchType,\n    EventResult,\n    EventReportUrl,\n    TargetHostname,\n    DvcHostname,\n    DvcId,\n    DvcOs,\n    DvcIpAddr,\n    SrcDeviceType,\n    SrcUsername,\n    ProcessEventType,\n    ProcessEventSubType,\n    ParentProcessId,\n    ParentProcessGuid,\n    TargetProcessName,\n    TargetProcessId,\n    TargetProcessGuid,\n    TargetProcessSHA1,\n    TargetProcessCreationTime,\n    TargetProcessCommandLine,\n    TargetProcessCurrentDirectory,\n    TargetUsername,\n    TargetUserId,\n    TargetFilePath,\n    TargetFileSHA1,\n    TargetFileSHA256,\n    TargetFileSize,\n    TargetFileSigningInfoMessage,\n    TargetFileSignerType,\n    TargetFileSigningTeamID,\n    TargetFileIsAppBundle,\n    TargetFileIsDirectory,\n    TargetFileIsDownload,\n    TargetFileIsScreenshot,\n    Related_users,\n    Related_files,\n    Related_binaries,\n    Related_groups,\n    Related_processes,\n    Match_event_process_signing,\n    Match_facts,\n    Match_actions,\n    Match_tags\n    | project-keep\n    TimeGenerated,\n    EventStartTime,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventDescription,\n    EventSeverity,\n    EventMatch,\n    EventMatchType,\n    EventResult,\n    EventReportUrl,\n    TargetHostname,\n    DvcHostname,\n    DvcId,\n    DvcOs,\n    DvcIpAddr,\n    SrcDeviceType,\n    SrcUsername,\n    ProcessEventType,\n    ProcessEventSubType,\n    ParentProcessId,\n    ParentProcessGuid,\n    TargetProcessName,\n    TargetProcessId,\n    TargetProcessGuid,\n    TargetProcessSHA1,\n    TargetProcessCreationTime,\n    TargetProcessCommandLine,\n    TargetProcessCurrentDirectory,\n    TargetUsername,\n    TargetUserId,\n    TargetFilePath,\n    TargetFileSHA1,\n    TargetFileSHA256,\n    TargetFileSize,\n    TargetFileSigningInfoMessage,\n    TargetFileSignerType,\n    TargetFileSigningTeamID,\n    TargetFileIsAppBundle,\n    TargetFileIsDirectory,\n    TargetFileIsDownload,\n    TargetFileIsScreenshot,\n    Related_users,\n    Related_files,\n    Related_binaries,\n    Related_groups,\n    Related_processes,\n    Match_event_process_signing,\n    Match_facts,\n    Match_actions,\n    Match_tags,\n    *input_match_event*\n};\nlet JamfProtectNetworkTraffic_view  = view () {\njamfprotect_CL\n| where event_metadata_product_s == \"Network Traffic Stream\"\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Network Traffic Stream'\n| project-rename\n| extend\n    // Jamf Protect - Common Fields\n    EventType = \"query\",\n    EventSubType = \"request\",\n    EventStartTime = unixtime_milliseconds_todatetime(tolong(event_receiptTime_d)),\n    EventResult = case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Prevented\", ''),\n    // Jamf Protect - Source User\n    SrcUsermail=column_ifexists('event_user_email_s', ''),\n    SrcUsername =  column_ifexists('event_user_name_s', ''),\n    // Jamf Protect - Source Device Hostnames\n    DvcHostname = case(isnotempty(input_host_hostname_s), input_host_hostname_s, isnotempty(host_info_host_name_s), host_info_host_name_s, event_device_userDeviceName_s),\n    DvcIpAddr = column_ifexists(\"event_source_ip_s\", \"\"),\n    DvcId = column_ifexists(\"event_device_externalId_g\", \"\"),\n    DvcOs = case(event_device_osType_s == \"MAC_OS\", \"macOS\", event_device_osType_s == \"IOS\", \"iOS\", event_device_osType_s == \"ANDROID\", \"Android\", \"Other\"),\n    SrcDeviceType = case(event_device_osType_s == \"MAC_OS\", \"Computer\", event_device_osType_s == \"IOS\", \"Mobile Device\", event_device_osType_s == \"ANDROID\", \"Mobile Device\", \"Other\"),\n    // Jamf Protect - DNS Specific\n    DnsQuery = column_ifexists('event_hostName_s', ''),\n    DvcAction = case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Blocked\", ''),\n    DnsQueryName = column_ifexists('event_domain_s', ''),\n    DstIpAddr = column_ifexists('event_destination_ips_s', ''),\n    ThreatCategory = column_ifexists('event_eventType_description_s', ''),\n    DnsQueryTypeName = column_ifexists('event_dns_recordType_s', ''),\n    DnsResponseName = column_ifexists('event_dns_responseStatus_s', ''),\n    ThreatOriginalRiskLevel = column_ifexists('event_threat_result_s', '')\n| project-keep\n    TimeGenerated,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventSubType,\n    EventStartTime,\n    EventResult,\n    DvcHostname,\n    DvcIpAddr,\n    DvcId,\n    DvcOs,\n    SrcDeviceType,\n    SrcUsermail,\n    SrcUsername,\n    DnsQuery,\n    DnsQueryName,\n    DstIpAddr,\n    DnsQueryTypeName,\n    DvcAction,\n    DnsResponseName,\n    ThreatOriginalRiskLevel\n};\nlet JamfProtectTelemetry_view  = view () {\n    jamfprotect_CL\n    | where header_event_name_s startswith \"AUE_\" \n        or header_event_name_s == \"PLAINTEXT_LOG_COLLECTION_EVENT\"\n        or header_event_name_s == \"SYSTEM_PERFORMANCE_METRICS\"\n    // ASIM - Common Fields\n    | extend EventVendor = 'Jamf'\n    | extend EventProduct = 'Jamf Protect - Telemetry'\n    // Data Field Normalization\n    //| project-rename \n    //    DvcIpAddr = input_host_ips_s,\n    //    DvcId = context_identity_claims_clientid_g\n    | extend\n        // Jamf Protect Alerts - Generic Information\n        EventSeverity = case(\n                    input_match_severity_d == 0,\n                    \"Informational\",\n                    input_match_severity_d == 1,\n                    \"Low\",\n                    input_match_severity_d == 2,\n                    \"Medium\",\n                    input_match_severity_d == 3,\n                    \"High\",\n                    \"Informational\"\n                ),\n        EventStartTime = unixtime_milliseconds_todatetime(tolong(timestamp_d)),\n        EventResult = coalesce(return_description_s, texts_s),\n        // Jamf Protect Telemetry - Endpoint Information\n        TargetModel = column_ifexists(\"metrics_hw_model_s\", \"\"),\n        DvcOsVersion = column_ifexists(\"host_info_osversion_s\", \"\"),\n        TargetHostname = case(isnotempty(input_host_hostname_s), input_host_hostname_s, isnotempty(host_info_host_name_s), host_info_host_name_s, event_device_userDeviceName_s),\n        DvcHostname = case(isnotempty(input_host_hostname_s), input_host_hostname_s, isnotempty(host_info_host_name_s), host_info_host_name_s, event_device_userDeviceName_s),\n        DvcIpAddr = column_ifexists(\"input_host_ips_s\", \"\"),\n        DvcId = column_ifexists(\"context_identity_claims_clientid_g\", \"\"),\n        // Jamf Protect - Event Types\n        EventType = case(\n                header_event_name_s == \"AUE_add_to_group\",\n                \"UserAddedToGroup\",\n                header_event_name_s == \"AUE_AUDITCTL\",\n                \"AuditEvent\",\n                header_event_name_s == \"AUE_AUDITON_SPOLICY\",\n                \"AuditEvent\",\n                header_event_name_s == \"AUE_auth_user\",\n                \"Elevate\",\n                header_event_name_s == \"AUE_BIND\",\n                \"EndpointNetworkSession\",\n                header_event_name_s == \"AUE_BIOS_FIRMWARE_VERSIONS\",\n                \"SystemInformation\",\n                header_event_name_s == \"AUE_CHDIR\",\n                \"FolderMoved\",\n                header_event_name_s == \"AUE_CHROOT\",\n                \"FolderModified\",\n                header_event_name_s == \"AUE_CONNECT\",\n                \"EndpointNetworkSession\",\n                header_event_name_s == \"AUE_create_group\",\n                \"GroupCreated\",\n                header_event_name_s == \"AUE_create_user\",\n                \"UserCreated\",\n                header_event_name_s == \"AUE_delete_group\",\n                \"GroupDeleted\",\n                header_event_name_s == \"AUE_delete_user\",\n                \"UserDeleted\",\n                header_event_name_s == \"AUE_EXECVE\",\n                \"ProcessCreated\",\n                header_event_name_s == \"AUE_EXIT\",\n                \"ProcessTerminated\",\n                header_event_name_s == \"AUE_FORK\",\n                \"ProcessCreated\",\n                header_event_name_s == \"AUE_GETAUID\",\n                \"\",\n                header_event_name_s == \"AUE_KILL\",\n                \"ProcessTerminated\",\n                header_event_name_s == \"AUE_LISTEN\",\n                \"EndpointNetworkSession\",\n                header_event_name_s == \"AUE_logout\",\n                \"Logoff\",\n                header_event_name_s == \"AUE_lw_login\",\n                \"Logon\",\n                header_event_name_s == \"AUE_MAC_SET_PROC\",\n                \"AuditEvent\",\n                header_event_name_s == \"AUE_modify_group\",\n                \"GroupModified\",\n                header_event_name_s == \"AUE_modify_password\",\n                \"PasswordChanged\",\n                header_event_name_s == \"AUE_modify_user\",\n                \"UserModified\",\n                header_event_name_s == \"AUE_MOUNT\",\n                \"VolumeMount\",\n                header_event_name_s == \"AUE_openssh\",\n                \"SshInitiated\",\n                header_event_name_s == \"AUE_PIDFORTASK\",\n                \"ProcessCreated\",\n                header_event_name_s == \"AUE_POSIX_SPAWN\",\n                \"ProcessCreated\",\n                header_event_name_s == \"AUE_remove_from_group\",\n                \"UserRemovedFromGroup\",\n                header_event_name_s == \"AUE_SESSION_CLOSE\",\n                \"Logoff\",\n                header_event_name_s == \"AUE_SESSION_END\",\n                \"Logoff\",\n                header_event_name_s == \"AUE_SESSION_START\",\n                \"Logon\",\n                header_event_name_s == \"AUE_SESSION_UPDATE\",\n                \"\",\n                header_event_name_s == \"AUE_SETPRIORITY\",\n                \"\",\n                header_event_name_s == \"AUE_SETSOCKOPT\",\n                \"\",\n                header_event_name_s == \"AUE_SETTIMEOFDAY\",\n                \"SystemChange\",\n                header_event_name_s == \"AUE_shutdown\",\n                \"ShutdownInitiated\",\n                header_event_name_s == \"AUE_SOCKETPAIR\",\n                \"\",\n                header_event_name_s == \"AUE_ssauthint\",\n                \"Elevate\",\n                header_event_name_s == \"AUE_ssauthmech\",\n                \"Elevate\",\n                header_event_name_s == \"AUE_ssauthorize\",\n                \"Elevate\",\n                header_event_name_s == \"AUE_TASKFORPID\",\n                \"\",\n                header_event_name_s == \"AUE_TASKNAMEFORPID\",\n                \"\",\n                header_event_name_s == \"AUE_UNMOUNT\",\n                \"VolumeUnmount\",\n                header_event_name_s == \"AUE_WAIT4\",\n                \"ProcessTerminated\",\n                header_event_name_s == \"PLAINTEXT_LOG_COLLECTION_EVENT\",\n                \"LogFileCollected\",\n                header_event_name_s == \"SYSTEM_PERFORMANCE_METRICS\",\n                \"SystemPerformanceMetrics\",\n                \"Unknown\"\n            ),\n        // Jamf Protect Telemetry - Process\n        ParentProcessName = column_ifexists(\"exec_chain_child_parent_path_s\", \"\"),\n        ParentProcessId = column_ifexists(\"exec_chain_child_parent_pid_d\", \"\"),\n        ParentProcessGuid = column_ifexists(\"exec_chain_child_parent_uuid_g\", \"\"),\n        TargetProcessName = column_ifexists(\"subject_process_name_s\", \"\"),\n        TargetProcessId = column_ifexists(\"subject_responsible_process_id_d\", \"\"),\n        TargetProcessGuid = column_ifexists(\"subject_process_id_d\", \"\"),\n        TargetProcessSHA1 = todynamic(column_ifexists(\"subject_process_hash_s\", \"\")),\n        TargetUserId = toreal(column_ifexists(\"subject_user_id_d\", \"\")),\n        TargetUsername = tostring(column_ifexists(\"subject_user_name_s\", \"\")),\n        TargetProcessCommandLine = column_ifexists(\"exec_args_args_compiled_s\", \"\"),\n        ActorUsername = tostring(column_ifexists(\"subject_effective_user_name_s\", \"\")),\n        ActorUserId = column_ifexists(\"subject_audit_user_name_s\", \"\"),\n        //column_ifexists(\"application_name_s\", \"\"),\n        //\n        // Jamf Protect Telemetry - Audit/Group\n        //\n        GroupName = todynamic(column_ifexists(\"subject_group_name_s\", \"\")),\n        // Jamf Protect Telemetry - Network\n        DstIpAddr = column_ifexists(\"socket_inet_ip_address_s\", \"\"),\n        DstPortNumber = column_ifexists(\"socket_inet_port_d\", \"\"),\n        NetworkProtocolVersion = case(socket_inet_id_d == 128, \"IPV4\", socket_inet_id_d == 129, \"IPV6\", \"\"),\n        SrcIpAddr = column_ifexists(\"subject_terminal_id_ip_address_s\", \"\"),\n        //\n        // Jamf Protect Telemetry - Binaries\n        //\n        // TargetBinaryFilePath = todynamic(Related_binaries[0].path),\n        TargetBinarySHA256 = tostring(identity_cd_hash_s),\n        // TargetBinarySigningInfoMessage = Related_binaries[0].signingInfo.statusMessage,\n        TargetbinarySignerType = case(identity_signer_type_d == 0, \"Apple\", identity_signer_type_d == 1, \"App Store\", identity_signer_type_d == 2, \"Developer\", identity_signer_type_d == 3, \"Ad Hoc\", identity_signer_type_d == 4, \"Unsigned\", \"\"),\n        TargetBinarySigningTeamID = tostring(identity_team_id_s),\n        //\n        // Jamf Protect Telemetry - Log File Collection\n        //\n        TargetFilePath = tostring(parse_json(path_s))\n    | project-reorder\n        EventStartTime,\n        EventVendor,\n        EventProduct,\n        EventType,\n        EventSeverity,\n        EventResult,\n        TargetHostname,\n        DvcHostname,\n        DvcId,\n        DvcOsVersion,\n        DvcIpAddr,\n        TargetModel,\n        TargetUserId,\n        TargetUsername,\n        ParentProcessName,\n        ParentProcessId,\n        ParentProcessGuid,\n        TargetProcessName,\n        TargetProcessId,\n        TargetProcessGuid,\n        TargetProcessSHA1,\n        TargetProcessCommandLine,\n        ActorUsername,\n        ActorUserId,\n        TargetBinarySHA256,\n        TargetbinarySignerType,\n        TargetBinarySigningTeamID,\n        GroupName,\n        SrcIpAddr,\n        DstIpAddr,\n        DstPortNumber,\n        NetworkProtocolVersion,\n        TargetFilePath\n    | project-away\n        arguments_sflags_d,\n        arguments_am_failure_d,\n        arguments_am_success_d\n};\nlet JamfProtectThreatEvents_view  = view () {\njamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\"\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Threat Events Stream'\n| project-rename\n| extend\n    // Jamf Protect - Common Fields\n    EventStartTime = column_ifexists(\"event_timestamp_t\", \"\"),\n    EventResult=case(event_action_s == \"Blocked\", \"Blocked\", event_action_s == \"Detected\", \"Detected\", ''),\n    EventReportUrl = column_ifexists(\"event_eventUrl_s\", \"\"),\n    // Jamf Protect - Alert Details\n    EventSeverity = case(event_severity_d == 2, \"Informational\", event_severity_d == 4, \"Low\", event_severity_d == 6, \"Medium\", event_severity_d == 8, \"High\", event_severity_d == 10, \"High\", \"Informational\"),\n    // Jamf Protect - Source User\n    SrcUsermail=column_ifexists('event_user_email_s', ''),\n    SrcUsername=column_ifexists('event_user_name_s', ''),\n    // Jamf Protect - Source Device Hostnames\n    DvcHostname = column_ifexists(\"event_device_userDeviceName_s\", \"\"),\n    DvcIpAddr = column_ifexists(\"event_source_ip_s\", \"\"),\n    DvcId = column_ifexists(\"event_device_externalId_g\", \"\"),\n    DvcOs=case(event_device_os_s has \"MAC_OS\", \"macOS\", event_device_os_s has \"IOS\", \"iOS\", event_device_os_s has \"ANDROID\", \"Android\", \"Other\"),\n    SrcDeviceType=case(event_device_os_s has \"MAC_OS\", \"Computer\", event_device_os_s has \"IOS\", \"Mobile Device\", event_device_os_s has \"ANDROID\", \"Mobile Device\", \"Other\"),\n    // Jamf Protect - DNS Specific\n    DnsQuery=column_ifexists('event_hostName_s', ''),\n    DvcAction=case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Blocked\", ''),\n    DnsQueryName=column_ifexists('event_destination_name_s', ''),\n    DstIpAddr=column_ifexists('event_destination_ip_s', ''),\n    ThreatCategory=column_ifexists('event_eventType_description_s', ''),\n    ThreatOriginalRiskLevel=column_ifexists('event_threat_result_s', ''),\n    // Jamf Protect - App Specific\n    TargetFileName = column_ifexists(\"event_app_name_s\", \"\"),\n    TargetFileSHA1 = column_ifexists(\"event_app_sha1_s\", \"\"),\n    TargetFileSHA256 = column_ifexists(\"event_app_sha256_s\", \"\")\n| project-keep\n    TimeGenerated,\n    EventVendor,\n    EventProduct,\n    EventStartTime,\n    EventResult,\n    EventReportUrl,\n    EventSeverity,\n    DvcHostname,\n    DvcIpAddr,\n    DvcId,\n    SrcDeviceType,\n    SrcUsermail,\n    SrcUsername,\n    DnsQuery,\n    DnsQueryName,\n    DstIpAddr,\n    ThreatCategory,\n    DvcAction,\n    ThreatOriginalRiskLevel,\n    TargetFileName,\n    TargetFileSHA1,\n    TargetFileSHA256\n};\nunion isfuzzy=true JamfProtectAlerts_view, JamfProtectUnifiedLog_view, JamfProtectNetworkTraffic_view, JamfProtectTelemetry_view, JamfProtectThreatEvents_view",
        "functionParameters": "",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "JamfProtect"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId1')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
        "contentId": "[variables('_parserContentId1')]",
        "kind": "Parser",
        "version": "[variables('parserVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Jamf Protect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Thijs Xhaflaire",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Jamf Software, LLC",
          "email": "support@jamf.com",
          "tier": "Partner",
          "link": "https://www.jamf.com/support/"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "properties": {
        "description": "Jamf Protect Workbook with template",
        "displayName": "Jamf Protect workbook template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('workbookTemplateSpecName1'),'/',variables('workbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "JamfProtectDashboardWorkbook Workbook with template version 2.2.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "This Jamf Protect Workbook for Microsoft Sentinel enables you to ingest Jamf Protect events forwarded into Microsoft Sentinel.\n Providing reports into all alerts, device controls and Unfied Logs."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b608e714-b3ec-4380-b666-1aa781513ab4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":\"[]\",\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"includeAll\":false},\"label\":\" Subscription\"},{\"id\":\"f408f1cf-dbcb-4f57-9409-272374bd3cd4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"query\":\"Resources | where type =~ \\\"microsoft.operationalinsights/workspaces\\\" | order by name | project id, name, selected=row_number()==1, group=resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":\"[]\"},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"label\":\" Workspace\",\"value\":\"\"},{\"id\":\"397d983f-ea80-4aa5-8c65-547d40cb312b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_timetoken\",\"label\":\" Time Range\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"value\":{\"durationMs\":172800000}},{\"id\":\"d716fb1e-0d71-4e99-9406-18ae7df6e037\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"changelog\",\"label\":\" Changelog\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true }\\r\\n]\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"Parameters Picker\"},{\"type\":1,\"content\":{\"json\":\"## Jamf Protect for Microsoft Sentinel!\\n\\nThe [Jamf Protect](https://www.jamf.com/solutions/threat-prevention-remediation/) for Microsoft Sentinel solution creates detailed event data from macOS endpoints into a Microsoft Sentinel workspace in a simple and easy workflow. The solution provides you with full visibility into Apple Endpoint Security by leveraging Workbooks containing [Alert](https://docs.jamf.com/jamf-protect/documentation/Alerts.html) and [Unified Logging](https://docs.jamf.com/jamf-protect/documentation/Unified_Logging.html) events captured by Jamf Protect and the [macOS built-in security events](https://support.apple.com/en-gb/guide/security/sec469d47bd8/web) that occurred across the protected organisational endpoints\\n\\n\\n#### Changelog\\n\\n**v2.2.0**\\n\\n***Workbook***\\n - Added System Performance Metrics\\n    - Includes Energy Impact\\n - Added Network Traffic Stream\\n - Updated Workbook to make use of the newly added parser\\n - Added and tweaked querys and graphs\\n\\n ***Parser***\\n - Added JamfProtect parser for parsing and mapping all incoming raw data.\\n\\n ***Analytic Rules***\\n - Updated Analytic Rules to make use of the newly added parser. \\n\\t\\n**v2.1**\\n\\n***Workbook***\\n - Added Endpoint Telemetry\\n    - Includes graphs and visualisations\\n\\t- Includes Endpoint Information\\n\\t- Includes Jamf Pro log parser\\n- Added Network Threat Events\\n \\t- Includes graphs and visualisations\\n- Added new Pickers\\n    - Allows selecting different Log Analytic Workspaces\\n    - Changed TimeRanger picker\\n- Added Changelog\\n\\n**Analytic Rules**\\n\\n- Added Analytic Rules\\n\\t- Jamf Protect - Alerts\\n\\t- Jamf Protect - Unified Logs\\n\\t- Jamf Protect - Network Threat Events\\n\\n\\n **v2.0**\\n \\n- Initial release of the solution containing a basic Workbook\\n\"},\"conditionalVisibility\":{\"parameterName\":\"changelog\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Text - Changelog\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Threat Hunting {_timetoken:value}\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"Set an type and provide values to search on File hash, CVE numbers or report on Alerts mapped to the MITRE framework or display latest alerts for a single endpoint.\",\"style\":\"info\"},\"name\":\"Text - Threat Hunting\",\"styleSettings\":{\"showBorder\":true}},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"5f5886d0-e83e-4ffc-a48c-bfed7370aa66\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_type\",\"label\":\"Type\",\"type\":2,\"description\":\"Please choose the type\",\"isGlobal\":true,\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"jsonData\":\"[\\n    { \\\"value\\\":\\\"filehash\\\", \\\"label\\\":\\\"File Hash\\\" },\\n    { \\\"value\\\":\\\"CVE\\\", \\\"label\\\":\\\"CVE\\\" },\\n    { \\\"value\\\":\\\"mitre\\\", \\\"label\\\":\\\"Framework: MITRE\\\" },\\n    { \\\"value\\\":\\\"endpointalerts\\\", \\\"label\\\":\\\"Latest alerts for a single endpoint\\\" }\\n]\",\"value\":\"\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"15\",\"name\":\"Picker - Threat Hunting Type\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"49255f47-8f93-4746-8260-aad07befdb06\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_hostnamealert\",\"label\":\"Hostname\",\"type\":2,\"query\":\"JamfProtect\\n| where isnotempty(DvcHostname)\\n    and EventType == \\\"SystemPerformanceMetrics\\\"\\n| project-keep DvcHostname\\n| project-rename Hostname = DvcHostname\\n| summarize by Hostname\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibilities\":[{\"parameterName\":\"_type\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"endpointalerts\"}],\"name\":\"Picker - Threat Hunting Hostname\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"bcdd945e-4dfe-47d6-9489-f76ce012c224\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_filehash\",\"label\":\"File Hash\",\"type\":1,\"description\":\"Thish value can be used for searching all alerts for a certain hash\",\"isRequired\":true,\"isGlobal\":true,\"value\":\"5e54bccbd4d93447e79cda0558b0b308a186c2be571c739e5460a3cb6ef665c0\"}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"filehash\"},\"name\":\"Search - Threat Hunting Hash\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"0344768b-16c4-44ec-a4ac-73a8bc83d0e2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_CVE\",\"label\":\"CVE Number\",\"type\":1,\"description\":\"Please search on the CVE number\",\"isRequired\":true,\"isGlobal\":true,\"value\":\"T15\"}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"CVE\"},\"name\":\"Search - Threat Hunting CVE\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"ProcessPrevented\\\" or EventType == \\\"ProcessCreated\\\"\\n| where TargetProcessSHA1 has \\\"{_filehash:value}\\\" or TargetBinarySHA256 has \\\"{_filehash:value}\\\"\\n| project-keep\\n    TimeGenerated,\\n    EventStartTime,\\n    EventMatch,\\n    EventSeverity,\\n    EventMatchType,\\n    TargetProcessCommandLine,\\n    DvcHostname,\\n    EventReportUrl\\n| project-reorder\\n    TimeGenerated,\\n    EventStartTime,\\n    EventMatch,\\n    EventSeverity,\\n    EventMatchType,\\n    TargetProcessCommandLine,\\n    DvcHostname,\\n    EventReportUrl\\n| sort by TimeGenerated\",\"size\":4,\"title\":\"Matches on FileHash\",\"noDataMessage\":\"No matches found based on the hash value\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventReportUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to navigate to original event in Jamf Protect\"}}]}},\"conditionalVisibilities\":[{\"parameterName\":\"_filehash\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"filehash\"}],\"name\":\"Query - Threat Hunting Hash\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where Match_tags contains \\\"{_CVE:value}\\\"\\n| project-keep\\n    TimeGenerated,\\n    EventStartTime,\\n    EventMatch,\\n    Match_tags,\\n    EventSeverity,\\n    EventMatchType,\\n    TargetProcessCommandLine,\\n    DvcHostname,\\n    EventReportUrl\\n| project-reorder\\n    TimeGenerated,\\n    EventStartTime,\\n    EventMatch,\\n    Match_tags,\\n    EventSeverity,\\n    EventMatchType,\\n    TargetProcessCommandLine,\\n    DvcHostname,\\n    EventReportUrl\\n| sort by TimeGenerated\",\"size\":1,\"title\":\"Matches on CVE\",\"noDataMessage\":\"No matches found based on the _CVE:value CVE number\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventReportUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to nagivate to original event in Jamf Protect\"}}]}},\"conditionalVisibilities\":[{\"parameterName\":\"_cve\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"CVE\"}],\"name\":\"Query - Threat Hunting CVE\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where Match_tags contains \\\"MITREattack\\\"\\n| extend\\n    Tactics = case(Match_tags has \\\"Execution\\\", \\\"Execution\\\", Match_tags has \\\"Visibility\\\", \\\"Visibility\\\", Match_tags has \\\"Persistence\\\", \\\"Persistence\\\", Match_tags has \\\"LateralMovement\\\", \\\"Lateral Movement\\\", Match_tags has \\\"CredentialAccess\\\", \\\"Credential Acccess\\\", Match_tags has \\\"DefenseEvasion\\\", \\\"Defense Evasion\\\", Match_tags has \\\"PrivilegeEscalation\\\", \\\"Privilege Escalation\\\", Match_tags has \\\"Impact\\\", \\\"Impact\\\", Match_tags has \\\"CommandAndControl\\\", \\\"Command and Control\\\", Match_tags has \\\"Discovery\\\", \\\"Discovery\\\", Match_tags has \\\"InitialAccess\\\", \\\"Initial Access\\\", \\\"\\\"),\\n      Techniques = extract(@\\\"[A-Za-z]\\\\d{4}\\\", 0, tostring(Match_tags))\\n| project-keep\\n    TimeGenerated,\\n    EventStartTime,\\n    EventType,\\n    EventMessage,\\n    EventDescription,\\n    Tactics,\\n    Techniques,\\n    Match_tags,\\n    EventSeverity,\\n    DvcHostname,\\n    EventReportUrl\\n| project-reorder\\n    TimeGenerated,\\n    EventStartTime,\\n    EventType,\\n    EventMessage,\\n    EventDescription,\\n    Tactics,\\n    Techniques,\\n    Match_tags,\\n    EventSeverity,\\n    DvcHostname,\\n    EventReportUrl\\n| sort by TimeGenerated\",\"size\":1,\"title\":\"Alerts mapped to MITRE\",\"noDataMessage\":\"No alerts found that are mapped to the MITRE framework\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventReportUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to navigate to original event in Jamf Protect\"}}],\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"conditionalVisibilities\":[{\"parameterName\":\"_type\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"mitre\"}],\"name\":\"Query - Threat Hunting MITRE\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where DvcHostname contains \\\"{_hostnamealert:value}\\\"\\n| where EventProduct == \\\"Jamf Protect - Alerts\\\" and isnotempty(EventType)\\n| project-keep\\n    TimeGenerated,\\n    EventStartTime,\\n    EventType,\\n    EventMessage,\\n    EventDescription,\\n    Match_tags,\\n    EventSeverity,\\n    DvcHostname,\\n    EventReportUrl\\n| project-reorder\\n    TimeGenerated,\\n    EventStartTime,\\n    EventType,\\n    EventMessage,\\n    EventDescription,\\n    Match_tags,\\n    EventSeverity,\\n    DvcHostname,\\n    EventReportUrl\\n| sort by TimeGenerated\\n| limit 10\",\"size\":1,\"title\":\"Recent 10 alerts in the past {_timetoken:value} for {_hostnamealert:value}\",\"noDataMessage\":\"No alerts found\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventReportUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to nagivage to original event in Jamf Protect\"}}],\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"conditionalVisibilities\":[{\"parameterName\":\"_type\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"endpointalerts\"},{\"parameterName\":\"_hostnamealert\",\"comparison\":\"isNotEqualTo\",\"value\":\"\"}],\"name\":\"Query - Threat Hunting 10 Recent Alerts Endpoint\"}]},\"customWidth\":\"100\",\"name\":\"Group - Threat Hunting\",\"styleSettings\":{\"margin\":\"200\",\"padding\":\"200\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Alerts\\\"\\n| where isnotempty(EventType)\\n| where EventSeverity != \\\"Informational\\\"\\n| sort by EventStartTime\\n| limit 10\",\"size\":0,\"title\":\"Recent 10 alerts in the past {_timetoken:value}\",\"noDataMessage\":\"No alerts found\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventReportUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to navigate to Alert in Jamf Protect\"}},{\"columnMatch\":\"AlertURL\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"name\":\"Query - 10 Recent Alerts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"datatable (Count: long, severity: string) [\\n    0, \\\"Informational\\\",\\n    0, \\\"Low\\\",\\n    0, \\\"Medium\\\",\\n    0, \\\"High\\\"\\n]\\n| union\\n    (\\n    JamfProtect\\n    | where EventProduct == \\\"Jamf Protect - Alerts\\\" \\n        and isnotempty(EventType)\\n        and EventSeverity != \\\"True\\\"\\n    | summarize Count = count() by EventSeverity\\n    )\\n| where isnotempty(EventSeverity)\\n| summarize Count=sum(Count) by EventSeverity\",\"size\":3,\"title\":\"All Alerts {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"EventSeverity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"green\",\"text\":\"{0}{1}\"}],\"compositeBarSettings\":{\"labelText\":\"\",\"columnSettings\":\"[]\"}}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"minimumSignificantDigits\":1,\"maximumSignificantDigits\":3},\"emptyValCustomText\":\"0\"}},\"showBorder\":true,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2}},\"name\":\"Datatable - Alerts per Severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Alerts\\\"\\n    and isnotempty(EventType)\\n| where EventSeverity != \\\"True\\\"\\n| summarize count() by EventSeverity, bin(TimeGenerated,{_timetoken:grain})\\n| render areachart \",\"size\":0,\"title\":\"Events Detected (Count By Severity) {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"chartSettings\":{\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"0\",\"label\":\"Informational\"},{\"seriesName\":\"1\",\"label\":\"Low\"},{\"seriesName\":\"2\",\"label\":\"Medium\"},{\"seriesName\":\"3\",\"label\":\"High\"}]}},\"customWidth\":\"50\",\"name\":\"Query - Events detected by Severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"UnifiedLog\\\"\\n| summarize count() by tostring(EventDescription), bin(TimeGenerated,{_timetoken:grain})\\n| render areachart \",\"size\":0,\"title\":\"Unified Logging Events {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Unified Logs\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Alerts\\\" \\n    and isnotempty(EventType)\\n    and isnotempty(DvcHostname)\\n| summarize Event = count() by DvcHostname\\n| sort by Event desc\",\"size\":3,\"title\":\"Most Active Endpoints (Total, last {_timetoken:value})\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"HostName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Event\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"HostName\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Event\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"100\",\"name\":\"Query - Most active endpoints with Alerts\",\"styleSettings\":{\"maxWidth\":\"100\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Alerts\\\"\\n    and isnotempty(EventType)\\n| summarize Events = count() by EventProduct, bin(TimeGenerated,{_timetoken:grain})\\n| render columnchart   \",\"size\":0,\"title\":\"Events detected (Total by date, {_timetoken:value})\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"jamfprotect_CL\",\"label\":\"Jamf Protect\"}]}},\"customWidth\":\"50\",\"name\":\"Query - Total events detected\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Alerts\\\"\\n| where isnotempty(EventType)\\n| summarize Events = count() by EventType, bin(EventStartTime,{_timetoken:grain})\\n| render areachart with(kind=stacked)\\n\",\"size\":0,\"title\":\"Events Detected (Count by Type, {_timetoken:value})\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"areachart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Events\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Events\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"Query - Events detected counted by Type\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Event Types\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Alerts\\\"\\n| where isnotempty(EventType)\\n| summarize Events = count() by EventType\\n| render piechart\",\"size\":3,\"showAnalytics\":true,\"title\":\"Event Types {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"33\",\"name\":\"Query - Events by Type\",\"styleSettings\":{\"maxWidth\":\"100\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"FileSystem\\\"\\n| summarize count() by tostring(EventMessage)\\n| render piechart \",\"size\":3,\"showAnalytics\":true,\"title\":\"File System Event Types {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"33\",\"name\":\"Query - File System Events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"Process\\\"\\n| summarize count() by tostring(EventMessage)\\n| render piechart \\n\",\"size\":3,\"showAnalytics\":true,\"title\":\"Process Event Types {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"33\",\"name\":\"Query - Process Event Types\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"USB\\\"\\nor EventType == \\\"UsbBlock\\\" and EventMessage == \\\"USBWrite\\\"\\n| summarize count() by tostring(EventMessage)\\n| render piechart \",\"size\":3,\"showAnalytics\":true,\"title\":\"USB Event Types {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"33\",\"name\":\"Query - USB Event Types\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"Gatekeeper\\\"\\n| summarize count() by tostring(EventMessage)\\n| render piechart \",\"size\":3,\"showAnalytics\":true,\"title\":\"Gatekeeper Event Types {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"GatekeeperBlockedSigned\",\"label\":\"Signed\"},{\"seriesName\":\"GatekeeperBlockedRevoked\",\"label\":\"Revoked\"},{\"seriesName\":\"GatekeeperBlockedUnsignedOrUnknown\",\"label\":\"UnsignedOrUnknown\"}]}},\"customWidth\":\"33\",\"name\":\"Query - GateKeeper Events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"ProcessPrevented\\\"\\n| summarize Threat = count() by EventMatch\\n| render piechart \",\"size\":3,\"showAnalytics\":true,\"title\":\"Threat Prevention Types {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"33\",\"name\":\"Query - Threat Prevention Types\"}]},\"name\":\"Group - Event Types\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Alerts\\\"\\n| where isnotempty(EventType)\\n| summarize count() by tostring(EventType), tostring(EventMessage)\\n| project-rename Count = count_\\n| sort by Count desc\\n| limit 10\\n\",\"size\":3,\"showAnalytics\":true,\"title\":\"Top 10 Event Types {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Top 10 Events\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"ProcessDenied\\\"\\n| where isnotempty(DvcHostname)\\n| summarize Count= count() by TargetProcessName, EventMatch, TargetBinarySigningAppID, TargetBinarySigningTeamID\\n| sort by Count asc nulls first\\n| limit 25\",\"size\":0,\"showAnalytics\":true,\"title\":\"Process Blocked by Custom Prevent List {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Process Blocked by Custom Prevent List\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"macOS Built-In Security Tools\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"Gatekeeper\\\"\\n| summarize count() by tostring(EventMessage), TargetFilePath\\n| project-rename BlockType = EventMessage, Count = count_\\n| sort by Count desc\\n| limit 10\",\"size\":3,\"showAnalytics\":true,\"title\":\"Top Gatekeeper Blocked Items {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"Query - Top Blocked GateKeepers events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Unified Log\\\"\\n| where input_match_event_subsystem_s == \\\"com.apple.XProtectFramework.PluginAPI\\\"\\n| where tostring(parse_json(input_match_event_composedMessage_s).status_message) <> \\\"[]\\\"\\n| extend status_message_ = tostring(parse_json(input_match_event_composedMessage_s).status_message)\\n| extend execution_duration_ = tostring(parse_json(input_match_event_composedMessage_s).execution_duration)\\n| project \\n    EventStartTime, \\n    DvcHostname, \\n    Status=status_message_, \\n    Module=input_match_event_process_s, \\n    Execution_Duration=execution_duration_\\n| sort by EventStartTime desc\\n| limit 25\",\"size\":0,\"showAnalytics\":true,\"title\":\"XProtect Remediator Scans {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - XProtect Remediator Activity\"}]},\"name\":\"macOS Built-In Security Tools Group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Device Controls\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"UsbBlock\\\"\\n| where EventMessage == \\\"EnforcedRemovableDevicePolicy\\\"\\n| extend EventMessage = replace_string(tostring(EventMessage), \\\"EnforcedRemovableDevicePolicy\\\", \\\"Blocked\\\")\\n| summarize count() by tostring(EventMessage)\\n\\n\",\"size\":2,\"title\":\"Device Controls Blocked {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"thresholdValue\":\"Alerts\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Notifications\",\"text\":\"Devices Blocked\"}]}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":true,\"sortOrderField\":2},\"graphSettings\":{\"type\":0,\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"showMetrics\":false},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"count_\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"count_\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"25\",\"name\":\"Query - Blocked USB Events\",\"styleSettings\":{\"maxWidth\":\"25\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"UsbBlock\\\"\\n| where EventMessage == \\\"EnforcedRemovableDevicePolicy\\\"\\n| extend device_ = strcat(input_match_event_device_vendorName_s, \\\" \\\",input_match_event_device_productName_s)\\n| summarize count() by DvcHostname, device_\\n| project-rename Hostname = DvcHostname, Device = device_, Count = count_\\n| sort by Count desc\\n\\n\",\"size\":0,\"title\":\"Device Controls Endpoint {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"65\",\"name\":\"Query - Blocked USB Devices\",\"styleSettings\":{\"maxWidth\":\"100\"}}]},\"name\":\"Group - Device Controls\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Endpoint Telemetry\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where identity_signer_id_s == \\\"com.apple.sudo\\\"\\n    and ParentProcessName == \\\"/usr/bin/sudo\\\"\\n    and ActorUsername == \\\"root\\\"\\n    and ActorUserId != \\\"-1\\\"\\n| extend Compiled_Arguments = replace_string(TargetProcessCommandLine, \\\",\\\", \\\" \\\")\\n| project-keep\\n    TimeGenerated,\\n    EventStartTime,\\n    DvcHostname,\\n    ActorUserId,\\n    Compiled_Arguments\\n| project-rename Hostname = DvcHostname, Elevated_User = ActorUserId\\n| limit 50\\n| sort by EventStartTime\",\"size\":0,\"title\":\"Succesful sudo events {_timetoken:value}\",\"noDataMessage\":\"No events occured\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Compiled_Arguments\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"69.5714ch\"}}],\"sortBy\":[{\"itemKey\":\"EventStartTime\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"EventStartTime\",\"sortOrder\":2}]},\"name\":\"Query - Successful sudo events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n//| where SrcIpAddr != \\\"0.0.0.0\\\" and EventType != \\\"AUE_SESSION_START\\\" and EventType != \\\"PLAINTEXT_LOG_COLLECTION_EVENT\\\" and EventType != \\\"BIOS_FIRMWARE_VERSIONS\\\" and EventType != \\\"SYSTEM_PERFORMANCE_METRICS\\\" and EventType != \\\"RATE_LIMITING_APPLIED\\\"\\n| where SrcIpAddr != \\\"0.0.0.0\\\" and EventType == \\\"ProcessCreated\\\"\\n    or SrcIpAddr != \\\"0.0.0.0\\\" and EventType == \\\"Logoff\\\"\\n    or SrcIpAddr != \\\"0.0.0.0\\\" and EventType == \\\"SshInitiated\\\"\\n| where isnotempty(DvcHostname)\\n| where isnotempty(EventType)\\n| where EventProduct != \\\"Jamf Protect - Alerts\\\"\\n//| extend binary=parse_json(path_s)[0]\\n| extend Compiled_Arguments = replace_string(TargetProcessCommandLine, \\\",\\\", \\\" \\\")\\n| project-keep\\n    TimeGenerated,\\n    EventStartTime,\\n    EventType,\\n    return_description_s,\\n    TargetProcessName,\\n    DvcHostname,\\n    SrcIpAddr,\\n    ActorUsername,\\n    ActorUserId,\\n    Compiled_Arguments\\n| project-rename\\n    EventName = EventType,\\n    Description = return_description_s,\\n    Hostname = DvcHostname,\\n    Process_Name = TargetProcessName,\\n    IP_Adress = SrcIpAddr,\\n    Elevated_User = ActorUserId\\n| limit 15\\n| sort by EventStartTime\",\"size\":0,\"title\":\"Remotely Controlled Commands (Outbound) {_timetoken:value}\",\"noDataMessage\":\"No events occured\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"sortBy\":\"[]\"},\"name\":\"Query - Remotely Controlled Commands\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where isnotempty(DvcHostname)\\n| where isnotempty(TargetProcessName)\\n| project-keep TimeGenerated, ParentProcessName, TargetProcessName\\n| summarize Rare_Process_Count = count() by TargetProcessName, ParentProcessName\\n| sort by Rare_Process_Count asc nulls first\\n| limit 200\",\"size\":0,\"title\":\"Rare Process Executions (All Executions) {_timetoken:value}\",\"noDataMessage\":\"No events occured\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Rare_Process_Count\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"Rare_Process_Count\",\"sortOrder\":1}]},\"customWidth\":\"100\",\"name\":\"Query - Rare Process Executions\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where isnotempty(DvcHostname)\\n    and isnotempty(ParentProcessName)\\n| project\\n    DvcHostname,\\n    TargetProcessName,\\n    ParentProcessName,\\n    ParentProcessGuid,\\n    exec_chain_thread_uuid_g\\n| summarize\\n    thread_uuid = make_set(exec_chain_thread_uuid_g, 128),\\n    Hostnames = make_set(DvcHostname, 128),\\n    process = make_set(TargetProcessName, 128)\\n    by ParentProcessName\\n| project \\n    Hostnames,\\n    process,\\n    parent_process=ParentProcessName,\\n    thread_uuid\",\"size\":0,\"title\":\"Parent/child process with thread uuid {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"100\",\"name\":\"Query - Parent and Child Process UUID\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Endpoint Information\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"SystemPerformanceMetrics\\\"\\n| extend metrics = parse_json(metrics_tasks_s)\\n| project-keep DvcHostname, metrics, TimeGenerated\\n| project-reorder DvcHostname, metrics\\n| mv-expand metrics\\n| extend energy_impact = metrics.energy_impact\\n| extend process_name = metrics.name\\n| project-rename\\n    Hostname = DvcHostname\\n| extend avg = toreal(energy_impact)\\n| summarize Average = avg(avg) by tostring(process_name), bin(TimeGenerated,{_timetoken:grain})\\n| render timechart\\n\\n\\n\\n\",\"size\":0,\"aggregation\":3,\"title\":\"Overall System Energy Impact on all endpoints {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"sortBy\":\"[]\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0,\"nodeIdField\":\"Hostname\",\"sourceIdField\":\"Hostname\",\"targetIdField\":\"Hostname\",\"graphOrientation\":3,\"showOrientationToggles\":false,\"nodeSize\":\"\",\"staticNodeSize\":100,\"colorSettings\":\"\",\"hivesMargin\":5},\"chartSettings\":{\"group\":\"process_name\",\"createOtherGroup\":15,\"showLegend\":true},\"mapSettings\":{\"locInfo\":\"LatLong\"}},\"customWidth\":\"100\",\"name\":\"Query - System Performance Metrics - Energy Impact\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Log Parser {_timetoken:value}\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"Please select a hostname in order to show the collected plain-text log files.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"_hostnamelogparser\",\"comparison\":\"isEqualTo\"},\"name\":\"Text - Jamf Log Parser Note\",\"styleSettings\":{\"showBorder\":true}},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"f747e125-851e-45f7-b500-5d22049da6a6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_hostnamelogparser\",\"label\":\"Hostname\",\"type\":2,\"isRequired\":true,\"query\":\"JamfProtect\\n| where isnotempty(DvcHostname)\\n    and EventType == \\\"LogFileCollected\\\"\\n| project-keep DvcHostname\\n| project-rename Hostname = DvcHostname\\n| summarize by Hostname\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"\"},{\"id\":\"7d123ad2-1768-4d22-b438-565ab483c044\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_logselectlogparser\",\"label\":\"Available Log File\",\"type\":2,\"isRequired\":true,\"query\":\"JamfProtect\\n| where EventType == \\\"LogFileCollected\\\"\\n    and DvcHostname == \\\"{_hostnamelogparser:value}\\\"\\n| project-keep TargetFilePath\\n| project-keep TargetFilePath\\n| extend TargetFilePath = replace_string(TargetFilePath, \\\"[\\\", \\\"\\\")\\n| extend TargetFilePath = replace_string(TargetFilePath, \\\"]\\\", \\\"\\\")\\n| extend TargetFilePath = replace_string(TargetFilePath, '\\\"', \\\"\\\")\\n| summarize by TargetFilePath\",\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"/var/log/jamf.log\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"40\",\"name\":\"Picker - Hostname\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"LogFileCollected\\\"\\n    and DvcHostname == \\\"{_hostnamelogparser:value}\\\"\\n| extend TargetFilePath = replace_string(TargetFilePath, \\\"[\\\", \\\"\\\")\\n| extend TargetFilePath = replace_string(TargetFilePath, \\\"]\\\", \\\"\\\")\\n| extend TargetFilePath = replace_string(TargetFilePath, '\\\"', \\\"\\\")\\n| where  TargetFilePath == \\\"{_logselectlogparser:escapejson}\\\"\\n| project EventResult, EventStartTime\\n| project-rename Logs = EventResult\\n| project-reorder EventStartTime, Logs\\n| mv-expand parse_json(Logs)\\n| sort by EventStartTime desc\\n| limit 50\",\"size\":0,\"showAnalytics\":true,\"title\":\"Log File Collection on \\\"{_hostnamelogparser:value}\\\"\",\"noDataMessage\":\"No matches found based on the hostname\",\"timeContextFromParameter\":\"_timetoken\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Logs\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"150ch\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"_hostnamelogparser\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Query - Parse Logs\"}]},\"customWidth\":\"100\",\"name\":\"Group - Log Parser\",\"styleSettings\":{\"margin\":\"200\",\"padding\":\"200\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Endpoint System Performance {_timetoken:value}\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"Please select a hostname in order to show the system performance metrics.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"_hostnamelogparser\",\"comparison\":\"isEqualTo\"},\"name\":\"Text - Jamf Log Parser Note\",\"styleSettings\":{\"showBorder\":true}},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"f747e125-851e-45f7-b500-5d22049da6a6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_hostname\",\"label\":\"Hostname\",\"type\":2,\"query\":\"JamfProtect\\n| where isnotempty(DvcHostname)\\n    and EventType == \\\"SystemPerformanceMetrics\\\"\\n| project-keep DvcHostname\\n| project-rename Hostname = DvcHostname\\n| summarize by Hostname\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"additionalResourceOptions\":\"[]\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"LMAC-ZW0GTLVDL\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"40\",\"name\":\"Picker - Hostname\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"SystemPerformanceMetrics\\\"\\n    and DvcHostname == \\\"{_hostname:value}\\\"\\n| extend metrics = parse_json(metrics_tasks_s)\\n| project-keep DvcHostname, metrics, TimeGenerated\\n| project-reorder DvcHostname, metrics\\n| mv-expand metrics\\n| extend energy_impact = metrics.energy_impact\\n| extend process_name = metrics.name\\n| project-rename\\n    Hostname = DvcHostname\\n| extend avg = toreal(energy_impact)\\n| summarize Average = avg(avg) by tostring(process_name), bin(TimeGenerated,{_timetoken:grain})\\n| render timechart\",\"size\":0,\"aggregation\":3,\"title\":\"Energy Impact on {_hostname:value}\",\"noDataMessage\":\"No metrics found based on the hostname\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":5},{\"columnMatch\":\"JamfLogs\",\"formatter\":1,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}]},\"chartSettings\":{\"group\":\"process_name\",\"createOtherGroup\":15,\"showLegend\":true}},\"conditionalVisibility\":{\"parameterName\":\"_hostname\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Query - Endpoint System Performance - Energy Impact\"}]},\"customWidth\":\"100\",\"name\":\"Group - Endpoint System Performance\",\"styleSettings\":{\"margin\":\"200\",\"padding\":\"200\",\"showBorder\":true}}]},\"name\":\"Group - Endpoint Information\"}]},\"name\":\"Group - Telemetry\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Network Threat Events\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\"\\n    and EventResult == \\\"Blocked\\\"\\n| extend blocks = case(EventResult == \\\"Blocked\\\", \\\"Blocked\\\", \\\"True\\\")\\n| summarize arg_max(EventResult, *) by EventStartTime\\n| summarize Count = count() by blocks\\n\\n\",\"size\":4,\"title\":\"Threats blocked by NTP {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Count\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"0\",\"representation\":\"green\",\"text\":\"Threats blocked by NTP\"},{\"operator\":\"<\",\"thresholdValue\":\"15\",\"representation\":\"gray\",\"text\":\"Threats blocked by NTP\"},{\"operator\":\"<\",\"thresholdValue\":\"30\",\"representation\":\"orange\",\"text\":\"Threats blocked by NTP\"},{\"operator\":\">\",\"thresholdValue\":\"50\",\"representation\":\"redBright\",\"text\":\"Threats blocked by NTP\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"gray\",\"text\":\"Threats blocked by NTP\"}],\"compositeBarSettings\":{\"labelText\":\"\",\"columnSettings\":\"[]\"}}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"minimumSignificantDigits\":1,\"maximumSignificantDigits\":3},\"emptyValCustomText\":\"0\"}},\"showBorder\":true,\"sortCriteriaField\":\"blocks\",\"sortOrderField\":1,\"size\":\"auto\"}},\"name\":\"Query - Threats blocked by NTP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\"\\n| where isnotempty(EventSeverity)\\n| summarize arg_max(EventSeverity, *) by EventStartTime\\n| summarize count() by EventSeverity, bin(TimeGenerated,{_timetoken:grain})\\n| render areachart\",\"size\":0,\"title\":\"Network Events Detected (Count By Severity) {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Network Events by Severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\"\\n    and isnotempty(DvcHostname)\\n| summarize arg_max(DvcHostname, *) by EventStartTime\\n| summarize Event = count() by DvcHostname\\n| sort by Event desc\",\"size\":0,\"title\":\"Most Active Endpoints (Total, last {_timetoken:value})\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Most Active Endoints with Alerts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\"\\n    and isnotempty(ThreatCategory)\\n| summarize arg_max(ThreatCategory, *) by EventStartTime\\n| summarize Events = count() by ThreatCategory, bin(EventStartTime, {_timetoken:grain})\\n| render areachart with(kind=stacked)\",\"size\":0,\"title\":\"Network Events Detected (Count by Type, {_timetoken:value})\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Network Events by Category\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\"\\n    and isnotempty(ThreatCategory)\\n| summarize arg_max(ThreatCategory, *) by EventStartTime\\n| summarize Events = count() by ThreatCategory\\n| render piechart\",\"size\":0,\"title\":\"Event Types {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Network Events by Description\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\" \\n    and notempty(ThreatCategory) and notempty(DnsQueryName)\\n| extend name_ = ThreatCategory\\n| summarize arg_max(DnsQueryName, *) by EventStartTime\\n| summarize count() by DnsQueryName, ThreatCategory\\n| project-rename\\n    Count = count_\\n| sort by Count desc\\n| limit 10\",\"size\":0,\"title\":\"Top 10 Blocked destinations {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Top 10 blocked destinations\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\" \\n    and notempty(ThreatCategory)\\n    and notempty(DstIpAddr)\\n| extend name_ = ThreatCategory\\n| summarize arg_max(DstIpAddr, *) by EventStartTime\\n| summarize count() by DstIpAddr\\n| project-rename\\n    Count = count_\\n| sort by Count desc\\n| limit 10\",\"size\":0,\"title\":\"Top 10 Blocked IPs {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Top 10 Blocked IPs\"}]},\"name\":\"Network Threat Events - Group\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Network Traffic\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Network Traffic Stream\\\"\\n    and isnotempty(DnsQuery)\\n| summarize arg_max(DnsQuery, *) by EventStartTime\\n| summarize count() by DnsQuery, DnsQueryTypeName\\n| project-rename\\n    Count = count_\\n| sort by Count desc\\n| limit 10\",\"size\":0,\"title\":\"Top 10 resolved destinations {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Top 10 resolved destinations\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Network Traffic Stream\\\"\\n    and isnotempty(DstIpAddr) and DstIpAddr != \\\"[]\\\"\\n| summarize arg_max(DstIpAddr, *) by EventStartTime\\n| summarize count() by DstIpAddr\\n| project-rename\\n    Count = count_\\n| sort by Count desc\\n| limit 10\",\"size\":0,\"title\":\"Top 10 Resolved IPs {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Top 10 Resolved IPs\"}]},\"name\":\"Network Traffic - Group\",\"styleSettings\":{\"showBorder\":true}}],\"fromTemplateId\":\"sentinel-JamfProtectDashboard\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=JamfProtectWorkbook; logoFileName=jamf_logo.svg; description=This Jamf Protect Workbook for Microsoft Sentinel enables you to ingest Jamf Protect events forwarded into Microsoft Sentinel.\n Providing reports into all alerts, device controls and Unfied Logs.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=2.0.0; title=Jamf Protect Workbook; templateRelativePath=JamfProtectDashboard.json; subtitle=; provider=Jamf Software, LLC}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "jamfprotect_CL",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Jamf Protect Analytics Rule 1 with template",
        "displayName": "Jamf Protect Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName1'),'/',variables('analyticRuleVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "JamfProtectAlerts_AnalyticalRules Analytics Rule with template version 2.2.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "NRT",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Creates an incident based on Jamf Protect Alert data in Microsoft Sentinel",
                "displayName": "Jamf Protect - Alerts",
                "enabled": false,
                "query": "JamfProtect\n| where EventProduct == \"Jamf Protect - Alerts\"\n    and isnotempty(EventSeverity)\n| extend\n    algorithm = \"SHA256\",\n    Host_IPs = tostring(parse_json(DvcIpAddr)[0]),\n    Tags = tostring(Match_facts[0].tags),\n    Tactics = case(Match_tags has \"Execution\", \"Execution\", Match_tags has \"Visibility\", \"Visibility\", Match_tags has \"Persistence\", \"Persistence\", Match_tags has \"LateralMovement\", \"Lateral Movement\", Match_tags has \"CredentialAccess\", \"Credential Acccess\", Match_tags has \"DefenseEvasion\", \"Defense Evasion\", Match_tags has \"PrivilegeEscalation\", \"Privilege Escalation\", Match_tags has \"Impact\", \"Impact\", Match_tags has \"CommandAndControl\", \"Command and Control\", Match_tags has \"Discovery\", \"Discovery\", Match_tags has \"InitialAccess\", \"Initial Access\", \"\"),\n    Techniques = extract(@\"[A-Za-z]\\d{4}\", 0, tostring(Match_tags)),\n    JamfPro = case(Match_actions has \"SmartGroup\", \"Workflow with Jamf Pro\", Match_actions has \"Prevented\", \"No workflow, Prevented by Protect\", \"No workflow\")\n",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "jamfprotect_CL"
                    ],
                    "connectorId": "JamfProtect"
                  }
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "DvcHostname",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DvcOs",
                        "identifier": "OSFamily"
                      },
                      {
                        "columnName": "DvcOsVersion",
                        "identifier": "OSVersion"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "Host_IPs",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "TargetUsername",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "TargetProcessCurrentDirectory",
                        "identifier": "CommandLine"
                      },
                      {
                        "columnName": "TargetProcessId",
                        "identifier": "ProcessId"
                      }
                    ],
                    "entityType": "Process"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "algorithm",
                        "identifier": "Algorithm"
                      },
                      {
                        "columnName": "TargetBinarySHA256",
                        "identifier": "Value"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "TargetBinarySignMsg": "TargetBinarySigningInfoMessage",
                  "TargetbinarySign": "TargetbinarySignerType",
                  "Protect_Event_Type": "EventType",
                  "TargetBinarySigner": "TargetBinarySigningTeamID",
                  "Related_Binaries": "TargetBinaryFilePath",
                  "Related_File_hash": "TargetBinarySHA256",
                  "Protect_Tags": "Tags",
                  "JamfPro_Status": "JamfPro",
                  "Protect_Analytic": "EventMessage"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "{{EventMessage}} detected on {{DvcHostname}}",
                  "alertDescriptionFormat": "{{EventDescription}} - Please investigate",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "AlertLink",
                      "value": "EventReportUrl"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "EventVendor"
                    },
                    {
                      "alertProperty": "ProductName",
                      "value": "EventProduct"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    }
                  ],
                  "alertSeverityColumnName": "EventSeverity"
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "lookbackDuration": "PT5H",
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "enabled": false
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "Jamf Protect Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Jamf Protect Analytics Rule 2 with template",
        "displayName": "Jamf Protect Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName2'),'/',variables('analyticRuleVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "JamfProtectNetworkThreats_AnalyticalRules Analytics Rule with template version 2.2.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "NRT",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Creates an incident based based on Jamf Protect's Network Threat Event Stream alerts.",
                "displayName": "Jamf Protect - Network Threats",
                "enabled": false,
                "query": "JamfProtect\n| where EventProduct == \"Jamf Protect - Threat Events Stream\"\n    and EventResult == \"Blocked\"\n    and isnotempty(EventSeverity)\n| extend Tactics = \"Initial Access\"\n| extend Techniques = \"T1566\"\n",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "jamfprotect_CL"
                    ],
                    "connectorId": "JamfProtect"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "Hostname",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DvcOs",
                        "identifier": "OSFamily"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "DstIpAddr",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "SrcUsermail",
                        "identifier": "AadUserId"
                      },
                      {
                        "columnName": "SrcUsername",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "DnsQueryName",
                        "identifier": "Url"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Category": "ThreatCategory"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "Network Threat detected on {{DvcHostname}}",
                  "alertDescriptionFormat": "A Network Threat has been {{EventResult}} on {{DvcHostname}}",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "AlertLink",
                      "value": "EventReportUrl"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "EventVendor"
                    },
                    {
                      "alertProperty": "ProductName",
                      "value": "EventProduct"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "EventResult"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    }
                  ],
                  "alertSeverityColumnName": "EventSeverity"
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "lookbackDuration": "PT5H",
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "enabled": false
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "Jamf Protect Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Jamf Protect Analytics Rule 3 with template",
        "displayName": "Jamf Protect Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName3'),'/',variables('analyticRuleVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "JamfProtectUnifiedLogs_AnalyticalRules Analytics Rule with template version 2.2.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId3')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "NRT",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Creates an informational incident based on Jamf Protect Unified Log data in Microsoft Sentinel",
                "displayName": "Jamf Protect - Unified Logs",
                "enabled": false,
                "query": "JamfProtect\n| where EventType == \"UnifiedLog\"\n| where isnotempty(EventSeverity)\n| extend Host_IPs = tostring(parse_json(DvcIpAddr)[0])\n",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "jamfprotect_CL"
                    ],
                    "connectorId": "JamfProtect"
                  }
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "DvcHostname",
                        "identifier": "HostName"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "Host_IPs",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Tags": "Match_tags",
                  "Protect_Event_Type": "EventType",
                  "Event_Process": "TargetProcessName",
                  "Unified_Log": "EventDescription"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "{{EventDescription}} on {{DvcHostname}}",
                  "alertDescriptionFormat": "{{EventDescription}} has been captured in the unified logs",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProviderName",
                      "value": "EventVendor"
                    },
                    {
                      "alertProperty": "ProductName",
                      "value": "EventProduct"
                    }
                  ],
                  "alertSeverityColumnName": "EventSeverity"
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "lookbackDuration": "PT5H",
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities",
                    "enabled": false
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
              "properties": {
                "description": "Jamf Protect Analytics Rule 3",
                "parentId": "[variables('analyticRuleId3')]",
                "contentId": "[variables('_analyticRulecontentId3')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.2.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Jamf Protect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Thijs Xhaflaire",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Jamf Software, LLC",
          "email": "support@jamf.com",
          "tier": "Partner",
          "link": "https://www.jamf.com/support/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId1')]",
              "version": "[variables('parserVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId3')]",
              "version": "[variables('analyticRuleVersion3')]"
            }
          ]
        },
        "firstPublishDate": "2022-10-10",
        "lastPublishDate": "2023-07-10",
        "providers": [
          "Jamf"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection",
            "Security - Automation (SOAR)"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
