{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Thijs Xhaflaire - thijs.xhaflaire@jamf.com",
    "comments": "Solution template for Jamf Protect"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Jamf Protect Workbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "email": "thijs.xhaflaire@jamf.com",
    "_email": "[variables('email')]",
    "_solutionName": "Jamf Protect",
    "_solutionVersion": "3.3.0",
    "solutionId": "jamfsoftwareaustraliaptyltd1620360395539.jamf_protect",
    "_solutionId": "[variables('solutionId')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "JamfProtectPush",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "JamfProtectPushConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "blanks": "[replace('b', 'b', '')]",
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','JamfProtectAlerts')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectAlerts')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('JamfProtectAlerts-Parser')))]",
      "parserVersion1": "3.3.0",
      "parserContentId1": "JamfProtectAlerts-Parser"
    },
    "parserObject2": {
      "_parserName2": "[concat(parameters('workspace'),'/','JamfProtectTelemetry')]",
      "_parserId2": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectTelemetry')]",
      "parserTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('JamfProtectTelemetry-Parser')))]",
      "parserVersion2": "3.3.0",
      "parserContentId2": "JamfProtectTelemetry-Parser"
    },
    "parserObject3": {
      "_parserName3": "[concat(parameters('workspace'),'/','JamfProtectUnifiedLogs')]",
      "_parserId3": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectUnifiedLogs')]",
      "parserTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('JamfProtectUnifiedLogs-Parser')))]",
      "parserVersion3": "3.3.0",
      "parserContentId3": "JamfProtectUnifiedLogs-Parser"
    },
    "parserObject4": {
      "_parserName4": "[concat(parameters('workspace'),'/','JamfProtectNetworkTraffic')]",
      "_parserId4": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectNetworkTraffic')]",
      "parserTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('JamfProtectNetworkTraffic-Parser')))]",
      "parserVersion4": "3.3.0",
      "parserContentId4": "JamfProtectNetworkTraffic-Parser"
    },
    "parserObject5": {
      "_parserName5": "[concat(parameters('workspace'),'/','JamfProtectThreatEvents')]",
      "_parserId5": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectThreatEvents')]",
      "parserTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('JamfProtectThreatEvents-Parser')))]",
      "parserVersion5": "3.3.0",
      "parserContentId5": "JamfProtectThreatEvents-Parser"
    },
    "workbookVersion1": "2.0.0",
    "workbookContentId1": "JamfProtectWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.6",
      "_analyticRulecontentId1": "6098daa0-f05e-44d5-b5a0-913e63ba3179",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6098daa0-f05e-44d5-b5a0-913e63ba3179')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6098daa0-f05e-44d5-b5a0-913e63ba3179')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6098daa0-f05e-44d5-b5a0-913e63ba3179','-', '1.0.6')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.5",
      "_analyticRulecontentId2": "44da53c3-f3b0-4b70-afff-f79275cb9442",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '44da53c3-f3b0-4b70-afff-f79275cb9442')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('44da53c3-f3b0-4b70-afff-f79275cb9442')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','44da53c3-f3b0-4b70-afff-f79275cb9442','-', '1.0.5')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.3",
      "_analyticRulecontentId3": "9eb2f758-003b-4303-83c6-97aed4c03e41",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '9eb2f758-003b-4303-83c6-97aed4c03e41')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('9eb2f758-003b-4303-83c6-97aed4c03e41')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','9eb2f758-003b-4303-83c6-97aed4c03e41','-', '1.0.3')))]"
    },
    "JamfProtect_Alert_Status_InProgress": "JamfProtect_Alert_Status_InProgress",
    "_JamfProtect_Alert_Status_InProgress": "[variables('JamfProtect_Alert_Status_InProgress')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "JamfProtect_Alert_Status_InProgress",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookId1": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId1'))]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId1'))))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "JamfProtect_Alert_Status_Resolved": "JamfProtect_Alert_Status_Resolved",
    "_JamfProtect_Alert_Status_Resolved": "[variables('JamfProtect_Alert_Status_Resolved')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "JamfProtect_Alert_Status_Resolved",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "JamfProtect_LockComputer_with_JamfPro": "JamfProtect_LockComputer_with_JamfPro",
    "_JamfProtect_LockComputer_with_JamfPro": "[variables('JamfProtect_LockComputer_with_JamfPro')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "JamfProtect_LockComputer_with_JamfPro",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "Jamf Protect Push Connector",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "JamfProtectPush",
                  "title": "Jamf Protect Push Connector",
                  "publisher": "Jamf",
                  "descriptionMarkdown": "The [Jamf Protect](https://www.jamf.com/products/jamf-protect/) connector provides the capability to read raw event data from Jamf Protect in Microsoft Sentinel.",
                  "graphQueries": [
                    {
                      "metricName": "Telemetry",
                      "legend": "jamfprotecttelemetryv2_CL",
                      "baseQuery": "jamfprotecttelemetryv2_CL"
                    },
                    {
                      "metricName": "Unified Logs",
                      "legend": "jamfprotectunifiedlogs_CL",
                      "baseQuery": "jamfprotectunifiedlogs_CL"
                    },
                    {
                      "metricName": "Alerts",
                      "legend": "jamfprotectalerts_CL",
                      "baseQuery": "jamfprotectalerts_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Jamf Protect - All Alerts",
                      "query": "jamfprotectalerts_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "Jamf Protect - All Telemetry events",
                      "query": "jamfprotecttelemetryv2_CL\n | sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "jamfprotecttelemetryv2_CL",
                      "lastDataReceivedQuery": "jamfprotecttelemetryv2_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "jamfprotectunifiedlogs_CL",
                      "lastDataReceivedQuery": "jamfprotectunifiedlogs_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "jamfprotectalerts_CL",
                      "lastDataReceivedQuery": "jamfprotectalerts_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "jamfprotecttelemetryv2_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(7d)",
                        "jamfprotectunifiedlogs_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(7d)",
                        "jamfprotectalerts_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(7d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft Entra",
                        "description": "Permission to create an app registration in Microsoft Entra ID. Typically requires Entra ID Application Developer role or higher."
                      },
                      {
                        "name": "Microsoft Azure",
                        "description": "Permission to assign Monitoring Metrics Publisher role on data collection rule (DCR). Typically requires Azure RBAC Owner or User Access Administrator role"
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "title": "1. Create ARM Resources and Provide the Required Permissions",
                      "description": "This connector reads data from the tables that Jamf Protect uses in a Microsoft Analytics Workspace, if the [data forwarding](https://docs.jamf.com/jamf-protect/documentation/Data_Forwarding_to_a_Third_Party_Storage_Solution.html?hl=sentinel#task-4227) option is enabled in Jamf Protect then raw event data is sent to the Microsoft Sentinel Ingestion API.",
                      "instructions": [
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "#### Automated Configuration and Secure Data Ingestion with Entra Application \nClicking on \"Deploy\" will trigger the creation of Log Analytics tables and a Data Collection Rule (DCR). \nIt will then create an Entra application, link the DCR to it, and set the entered secret in the application. This setup enables data to be sent securely to the DCR using an Entra token."
                          }
                        },
                        {
                          "parameters": {
                            "label": "Deploy Jamf Protect connector resources",
                            "applicationDisplayName": "Jamf Protect Connector Application"
                          },
                          "type": "DeployPushConnectorButton"
                        }
                      ]
                    },
                    {
                      "title": "2. Push your logs into the workspace",
                      "description": "Use the following parameters to configure the your machine to send the logs to the workspace.",
                      "instructions": [
                        {
                          "parameters": {
                            "label": "Tenant ID (Directory ID)",
                            "fillWith": [
                              "TenantId"
                            ]
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "Entra App Registration Application ID",
                            "fillWith": [
                              "ApplicationId"
                            ],
                            "placeholder": "Deploy push connector to get the App Registration Application ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "Entra App Registration Secret",
                            "fillWith": [
                              "ApplicationSecret"
                            ],
                            "placeholder": "Deploy push connector to get the App Registration Secret"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "Data Collection Endpoint Uri",
                            "fillWith": [
                              "DataCollectionEndpoint"
                            ],
                            "placeholder": "Deploy push connector to get the Data Collection Endpoint Uri"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "Data Collection Rule Immutable ID",
                            "fillWith": [
                              "DataCollectionRuleId"
                            ],
                            "placeholder": "Deploy push connector to get the Data Collection Rule Immutable ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "Unified Logs Stream Name",
                            "value": "Custom-jamfprotectunifiedlogs"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "Telemetry Stream Name",
                            "value": "Custom-jamfprotecttelemetryv2"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "Alerts Stream Name",
                            "value": "Custom-jamfprotectalerts"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "JamfProtectCustomDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "streamDeclarations": {
                  "Custom-jamfprotecttelemetryv2": {
                    "columns": [
                      {
                        "name": "action",
                        "type": "dynamic"
                      },
                      {
                        "name": "action_type",
                        "type": "int"
                      },
                      {
                        "name": "deadline",
                        "type": "int"
                      },
                      {
                        "name": "event",
                        "type": "dynamic"
                      },
                      {
                        "name": "event_type",
                        "type": "int"
                      },
                      {
                        "name": "glob_seq_num",
                        "type": "int"
                      },
                      {
                        "name": "host",
                        "type": "dynamic"
                      },
                      {
                        "name": "mach_time",
                        "type": "long"
                      },
                      {
                        "name": "metadata",
                        "type": "dynamic"
                      },
                      {
                        "name": "process",
                        "type": "dynamic"
                      },
                      {
                        "name": "seq_num",
                        "type": "int"
                      },
                      {
                        "name": "thread",
                        "type": "dynamic"
                      },
                      {
                        "name": "time",
                        "type": "datetime"
                      },
                      {
                        "name": "uuid",
                        "type": "string"
                      },
                      {
                        "name": "version",
                        "type": "int"
                      }
                    ]
                  },
                  "Custom-jamfprotectunifiedlogs": {
                    "columns": [
                      {
                        "name": "TimeGenerated",
                        "type": "datetime"
                      },
                      {
                        "name": "caid",
                        "type": "string"
                      },
                      {
                        "name": "certid",
                        "type": "string"
                      },
                      {
                        "name": "input",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-jamfprotectalerts": {
                    "columns": [
                      {
                        "name": "TimeGenerated",
                        "type": "datetime"
                      },
                      {
                        "name": "caid",
                        "type": "string"
                      },
                      {
                        "name": "certid",
                        "type": "string"
                      },
                      {
                        "name": "input",
                        "type": "dynamic"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-jamfprotecttelemetryv2"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source\n//ASIM - Generic Fields\n| extend\n    EventVendor = metadata.vendor,\n    EventProduct = metadata.product,\n    EventSchemaVersion = metadata.schemaVersion,\n    EventProductVersion = host.protectVersion,\n    EventSeverity = \"Informational\",\n    //\n    // Jamf Protect - Device Hostnames\n    TargetHostname = host.hostname,\n    DvcHostname = host.hostname,\n    DvcSerial = host.serial,\n    DvcIpAddr = host.ips,\n    DvcId = host.provisioningUDID,\n    DvcOs = \"macOS\",\n    DvcOsVersion = host.os,\n    SrcDeviceType = \"Computer\"\n| project-rename\n    TimeGenerated = ['time'],\n    EventOriginalUid = uuid,\n    EventOriginalType = event_type,\n    EventCount = glob_seq_num\n| project-away\n    metadata,\n    host,\n    seq_num,\n    version,\n    deadline,\n    mach_time,\n    action_type\n\n",
                    "outputStream": "Custom-jamfprotecttelemetryv2_CL"
                  },
                  {
                    "streams": [
                      "Custom-jamfprotectunifiedlogs"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source\n//ASIM - Generic Fields\n| extend\n    EventVendor = \"Jamf\",\n    EventProduct = \"Unified Log Stream\",\n    // EventSchemaVersion = metadata.schemaVersion,\n    EventProductVersion = input.host.protectVersion,\n    EventSeverity = case(input.match.severity == 0, \"Informational\", input.match.severity == 1, \"Low\", input.match.severity == 2, \"Medium\", input.match.severity == 3, \"High\", \"Informational\"),\n    EventOriginalType = input.eventType,\n    EventOriginalUid = input.match.uuid,\n    EventType = \"UnifiedLog\",\n    EventResult = case(input.match.actions has \"Prevented\", \"Prevented\", \"Allowed\"),\n    EventMessage = input.match.event.name,\n    EventResultMessage = input.match.event.composedMessage,\n    // EventReportUrl = strcat(\"https://\", context_identity_claims_hd_s, \".jamfcloud.com/Alerts/\", input.match.uuid),\n    //     //\n    //     // Jamf Protect - Device Hostnames\n    TargetHostname = input.host.hostname,\n    DvcHostname = input.host.hostname,\n    DvcSerial = input.host.serial,\n    DvcIpAddr = input.host.ips,\n    DvcId = input.host.provisioningUDID,\n    DvcOs = \"macOS\",\n    DvcOsVersion = input.host.os,\n    SrcDeviceType = \"Computer\",\n    // Jamf Protect - Event Details\n    //\n    // Jamf Protect Alerts - Process\n    //\n    ProcessEventType = \"Create\",\n    ProcessEventSubType = \"Exec\",\n    TargetProcessName = input.match.event.process,\n    TargetProcessId = input.match.event.processIdentifier,\n    TargetProcessGuid = input.match.event.uuid,\n    TargetProcessCommandLine = input.match.event.process.args,\n    TargetProcessCurrentDirectory = input.match.event.processImagePath\n| project-away\n    caid,\n    certid\n",
                    "outputStream": "Custom-jamfprotectunifiedlogs_CL"
                  },
                  {
                    "streams": [
                      "Custom-jamfprotectalerts"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source\n//ASIM - Generic Fields \n| extend\n    EventVendor = \"Jamf\",\n    EventProduct = \"Alerts Stream\",\n    EventProductVersion = input.host.protectVersion,\n    EventSeverity = case(input.match.severity == 0, \"Informational\", input.match.severity == 1, \"Low\", input.match.severity == 2, \"Medium\", input.match.severity == 3, \"High\", \"Informational\"),\n    EventOriginalType = input.eventType,\n    EventOriginalUid = input.match.uuid,\n    EventType = case(input.eventType == \"GPClickEvent\", \"Click\", input.eventType == \"GPDownloadEvent\", \"Download\", input.eventType == \"GPFSEvent\", \"FileSystem\", input.eventType == \"GPProcessEvent\", \"Process\", input.eventType == \"GPKeylogRegisterEvent\", \"Keylog\", input.eventType == \"GPGatekeeperEvent\", \"Gatekeeper\", input.eventType == \"GPMRTEvent\", \"MRT\", input.eventType == \"GPPreventedExecutionEvent\", \"ProcessDenied\", input.eventType == \"GPThreatMatchExecEvent\", \"ProcessPrevented\", input.eventType == \"GPUnifiedLogEvent\", \"UnifiedLog\", input.eventType == \"GPUSBEvent\", \"USB\", input.eventType == \"auth-mount\", \"UsbBlock\", \"Unknown\"),\n    EventResult = case(input.match.actions has \"Prevented\", \"Prevented\", \"Allowed\"),\n    EventMessage = input.match.facts[0].name,\n    EventResultMessage = input.match.facts[0].human,\n    TargetHostname = input.host.hostname,\n    DvcHostname = input.host.hostname,\n    DvcSerial = input.host.serial,\n    DvcIpAddr = input.host.ips,\n    DvcId = input.host.provisioningUDID,\n    DvcOs = \"macOS\",\n    DvcOsVersion = input.host.os,\n    SrcDeviceType = \"Computer\",\n    ProcessEventType = case(input.match.event.type == 0, \"None\", input.match.event.type == 1, \"Create\", input.match.event.type == 2, \"Exit\", \"\"),\n    ProcessEventSubType = case(input.match.event.subType == 7, \"Exec\", input.match.event.subType == 1, \"Fork\", input.match.event.subType == 23, \"Execve\", input.match.event.subType == 43190, \"Posix Spawn\", \"\"),\n    ActingProcessName = input.related.processes[array_length(input.related.processes) - 1].path,\n    ActingProcessId = toint(input.related.processes[0].responsiblePID),\n    ActingProcessGuid = input.related.processes[array_length(input.related.processes) - 1].uuid,\n    ParentProcessName = iff(array_length(input.related.processes) > 1, tostring(input.related.processes[1].path), \"\"),\n    ParentProcessId = iff(array_length(input.related.processes) > 1, toint(input.related.processes[1].pid), int(null)),\n    ParentProcessGuid = iff(array_length(input.related.processes) > 1, tostring(input.related.processes[1].uuid), \"\"),\n    TargetProcessName = input.related.processes[0].name,\n    TargetProcessId = toint(input.related.processes[0].pid),\n    TargetProcessGuid = input.related.processes[0].uuid,\n    TargetProcessSHA1 = input.related.binaries[0].sha1hex,\n    TargetProcessSHA256 = input.related.binaries[0].sha256hex,\n    TargetProcessCommandLine = input.related.processes[0].args,\n    TargetProcessCurrentDirectory = input.related.processes[0].path,\n    TargetProcessStatusCode = input.related.processes[0].exitCode,\n    TargetFilePath = input.related.files[0].path,\n    TargetFileSHA1 = input.related.files[0].sha1hex,\n    TargetFileSHA256 = input.related.files[0].sha256hex,\n    TargetFileSize = input.related.files[0].size,\n    TargetFileSigningInfoMessage = input.related.files[0].signingInfo.statusMessage,\n    TargetFileSignerType = case(input.related.files[0].signingInfo.signerType == 0, \"Apple\", input.related.files[0].signingInfo.signerType == 1, \"App Store\", input.related.files[0].signingInfo.signerType == 2, \"Developer\", input.related.files[0].signingInfo.signerType == 3, \"Ad Hoc\", input.related.files[0].signingInfo.signerType == 4, \"Unsigned\", \"\"),\n    TargetFileSigningTeamID = input.related.files[0].signingInfo.teamid,\n    TargetFileIsDownload = tobool(input.related.files[0].isDownload),\n    TargetFileIsAppBundle = tobool(input.related.files[0].isAppBundle),\n    TargetFileIsDirectory = tobool(input.related.files[0].isDirectory),\n    TargetFileIsScreenshot = tobool(input.related.files[0].isScreenShot),\n    TargetFileExtendedAttributes = input.related.files[0].xattrs,\n    TargetBinaryFilePath = input.related.binaries[0].path,\n    TargetBinarySHA1 = input.related.binaries[0].sha1hex,\n    TargetBinarySHA256 = input.related.binaries[0].sha256hex,\n    TargetBinarySigningInfoMessage = input.related.binaries[0].signingInfo.statusMessage,\n    TargetbinarySignerType = case(input.related.binaries[0].signingInfo.signerType == 0, \"Apple\", input.related.binaries[0].signingInfo.signerType == 1, \"App Store\", input.related.binaries[0].signingInfo.signerType == 2, \"Developer\", input.related.binaries[0].signingInfo.signerType == 3, \"Ad Hoc\", input.related.binaries[0].signingInfo.signerType == 4, \"Unsigned\", \"\"),\n    TargetBinarySigningTeamID = input.related.binaries[0].signingInfo.teamid,\n    TargetBinarySigningAppID = input.related.binaries[0].signingInfo.appid\n| project-away caid, certid\n\n",
                    "outputStream": "Custom-jamfprotectalerts_CL"
                  }
                ],
                "dataCollectionEndpointId": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]"
              }
            },
            {
              "name": "jamfprotecttelemetryv2_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "plan": "Analytics",
                "schema": {
                  "name": "jamfprotecttelemetryv2_CL",
                  "columns": [
                    {
                      "name": "action",
                      "type": "dynamic"
                    },
                    {
                      "name": "event",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventOriginalType",
                      "type": "int"
                    },
                    {
                      "name": "EventCount",
                      "type": "int"
                    },
                    {
                      "name": "process",
                      "type": "dynamic"
                    },
                    {
                      "name": "thread",
                      "type": "dynamic"
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "EventOriginalUid",
                      "type": "string"
                    },
                    {
                      "name": "EventVendor",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventProduct",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventSchemaVersion",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventProductVersion",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventSeverity",
                      "type": "string"
                    },
                    {
                      "name": "TargetHostname",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcHostname",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcSerial",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcIpAddr",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcId",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcOs",
                      "type": "string"
                    },
                    {
                      "name": "DvcOsVersion",
                      "type": "dynamic"
                    },
                    {
                      "name": "SrcDeviceType",
                      "type": "string"
                    }
                  ]
                }
              }
            },
            {
              "name": "jamfprotectalerts_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "plan": "Analytics",
                "schema": {
                  "name": "jamfprotectalerts_CL",
                  "columns": [
                    {
                      "name": "input",
                      "type": "dynamic"
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "EventVendor",
                      "type": "string"
                    },
                    {
                      "name": "EventProduct",
                      "type": "string"
                    },
                    {
                      "name": "EventProductVersion",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventSeverity",
                      "type": "string"
                    },
                    {
                      "name": "EventOriginalType",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventOriginalUid",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventType",
                      "type": "string"
                    },
                    {
                      "name": "EventResult",
                      "type": "string"
                    },
                    {
                      "name": "EventMessage",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventResultMessage",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetHostname",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcHostname",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcSerial",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcIpAddr",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcId",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcOs",
                      "type": "string"
                    },
                    {
                      "name": "DvcOsVersion",
                      "type": "dynamic"
                    },
                    {
                      "name": "SrcDeviceType",
                      "type": "string"
                    },
                    {
                      "name": "ProcessEventType",
                      "type": "string"
                    },
                    {
                      "name": "ProcessEventSubType",
                      "type": "string"
                    },
                    {
                      "name": "ActingProcessName",
                      "type": "dynamic"
                    },
                    {
                      "name": "ActingProcessId",
                      "type": "int"
                    },
                    {
                      "name": "ActingProcessGuid",
                      "type": "dynamic"
                    },
                    {
                      "name": "ParentProcessName",
                      "type": "dynamic"
                    },
                    {
                      "name": "ParentProcessId",
                      "type": "int"
                    },
                    {
                      "name": "ParentProcessGuid",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessName",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessId",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessGuid",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessSHA1",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessSHA256",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessCommandLine",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessCurrentDirectory",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessStatusCode",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetFilePath",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetFileSHA1",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetFileSHA256",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetFileSize",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetFileSigningInfoMessage",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetFileSignerType",
                      "type": "string"
                    },
                    {
                      "name": "TargetFileSigningTeamID",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetFileIsDownload",
                      "type": "boolean"
                    },
                    {
                      "name": "TargetFileIsAppBundle",
                      "type": "boolean"
                    },
                    {
                      "name": "TargetFileIsDirectory",
                      "type": "boolean"
                    },
                    {
                      "name": "TargetFileIsScreenshot",
                      "type": "boolean"
                    },
                    {
                      "name": "TargetFileExtendedAttributes",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetBinaryFilePath",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetBinarySHA1",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetBinarySHA256",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetBinarySigningInfoMessage",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetbinarySignerType",
                      "type": "string"
                    },
                    {
                      "name": "TargetBinarySigningTeamID",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetBinarySigningAppID",
                      "type": "dynamic"
                    }
                  ]
                }
              }
            },
            {
              "name": "jamfprotectunifiedlogs_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "plan": "Analytics",
                "schema": {
                  "name": "jamfprotectunifiedlogs_CL",
                  "columns": [
                    {
                      "name": "input",
                      "type": "dynamic"
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "EventProductVersion",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventSeverity",
                      "type": "string"
                    },
                    {
                      "name": "EventOriginalType",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventOriginalUid",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventType",
                      "type": "string"
                    },
                    {
                      "name": "EventResult",
                      "type": "string"
                    },
                    {
                      "name": "EventMessage",
                      "type": "dynamic"
                    },
                    {
                      "name": "EventResultMessage",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetHostname",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcHostname",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcSerial",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcIpAddr",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcId",
                      "type": "dynamic"
                    },
                    {
                      "name": "DvcOs",
                      "type": "string"
                    },
                    {
                      "name": "DvcOsVersion",
                      "type": "dynamic"
                    },
                    {
                      "name": "SrcDeviceType",
                      "type": "string"
                    },
                    {
                      "name": "ProcessEventType",
                      "type": "string"
                    },
                    {
                      "name": "ProcessEventSubType",
                      "type": "string"
                    },
                    {
                      "name": "TargetProcessName",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessId",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessGuid",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessCommandLine",
                      "type": "dynamic"
                    },
                    {
                      "name": "TargetProcessCurrentDirectory",
                      "type": "dynamic"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "JamfProtectPush",
          "title": "Jamf Protect Push Connector",
          "publisher": "Jamf",
          "descriptionMarkdown": "The [Jamf Protect](https://www.jamf.com/products/jamf-protect/) connector provides the capability to read raw event data from Jamf Protect in Microsoft Sentinel.",
          "graphQueries": [
            {
              "metricName": "Telemetry",
              "legend": "jamfprotecttelemetryv2_CL",
              "baseQuery": "jamfprotecttelemetryv2_CL"
            },
            {
              "metricName": "Unified Logs",
              "legend": "jamfprotectunifiedlogs_CL",
              "baseQuery": "jamfprotectunifiedlogs_CL"
            },
            {
              "metricName": "Alerts",
              "legend": "jamfprotectalerts_CL",
              "baseQuery": "jamfprotectalerts_CL"
            }
          ],
          "sampleQueries": [
            {
              "description": "Jamf Protect - All Alerts",
              "query": "jamfprotectalerts_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "Jamf Protect - All Telemetry events",
              "query": "jamfprotecttelemetryv2_CL\n | sort by TimeGenerated desc"
            }
          ],
          "dataTypes": [
            {
              "name": "jamfprotecttelemetryv2_CL",
              "lastDataReceivedQuery": "jamfprotecttelemetryv2_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "jamfprotectunifiedlogs_CL",
              "lastDataReceivedQuery": "jamfprotectunifiedlogs_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "jamfprotectalerts_CL",
              "lastDataReceivedQuery": "jamfprotectalerts_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "jamfprotecttelemetryv2_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(7d)",
                "jamfprotectunifiedlogs_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(7d)",
                "jamfprotectalerts_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(7d)"
              ]
            }
          ],
          "availability": {
            "status": 1
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft Entra",
                "description": "Permission to create an app registration in Microsoft Entra ID. Typically requires Entra ID Application Developer role or higher."
              },
              {
                "name": "Microsoft Azure",
                "description": "Permission to assign Monitoring Metrics Publisher role on data collection rule (DCR). Typically requires Azure RBAC Owner or User Access Administrator role"
              }
            ]
          },
          "instructionSteps": [
            {
              "title": "1. Create ARM Resources and Provide the Required Permissions",
              "description": "This connector reads data from the tables that Jamf Protect uses in a Microsoft Analytics Workspace, if the [data forwarding](https://docs.jamf.com/jamf-protect/documentation/Data_Forwarding_to_a_Third_Party_Storage_Solution.html?hl=sentinel#task-4227) option is enabled in Jamf Protect then raw event data is sent to the Microsoft Sentinel Ingestion API.",
              "instructions": [
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "#### Automated Configuration and Secure Data Ingestion with Entra Application \nClicking on \"Deploy\" will trigger the creation of Log Analytics tables and a Data Collection Rule (DCR). \nIt will then create an Entra application, link the DCR to it, and set the entered secret in the application. This setup enables data to be sent securely to the DCR using an Entra token."
                  }
                },
                {
                  "parameters": {
                    "label": "Deploy Jamf Protect connector resources",
                    "applicationDisplayName": "Jamf Protect Connector Application"
                  },
                  "type": "DeployPushConnectorButton"
                }
              ]
            },
            {
              "title": "2. Push your logs into the workspace",
              "description": "Use the following parameters to configure the your machine to send the logs to the workspace.",
              "instructions": [
                {
                  "parameters": {
                    "label": "Tenant ID (Directory ID)",
                    "fillWith": [
                      "TenantId"
                    ]
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "Entra App Registration Application ID",
                    "fillWith": [
                      "ApplicationId"
                    ],
                    "placeholder": "Deploy push connector to get the App Registration Application ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "Entra App Registration Secret",
                    "fillWith": [
                      "ApplicationSecret"
                    ],
                    "placeholder": "Deploy push connector to get the App Registration Secret"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "Data Collection Endpoint Uri",
                    "fillWith": [
                      "DataCollectionEndpoint"
                    ],
                    "placeholder": "Deploy push connector to get the Data Collection Endpoint Uri"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "Data Collection Rule Immutable ID",
                    "fillWith": [
                      "DataCollectionRuleId"
                    ],
                    "placeholder": "Deploy push connector to get the Data Collection Rule Immutable ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "Unified Logs Stream Name",
                    "value": "Custom-jamfprotectunifiedlogs"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "Telemetry Stream Name",
                    "value": "Custom-jamfprotecttelemetryv2"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "Alerts Stream Name",
                    "value": "Custom-jamfprotectalerts"
                  },
                  "type": "CopyableLabel"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Thijs Xhaflaire",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Jamf Software, LLC",
          "email": "support@jamf.com",
          "tier": "Partner",
          "link": "https://www.jamf.com/support/"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "Jamf Protect Push Connector",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "string"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "string"
            },
            "auth": {
              "type": "object",
              "defaultValue": {
                "appId": "[[parameters('auth').appId]]",
                "servicePrincipalId": "[[parameters('auth').servicePrincipalId]]"
              }
            },
            "connectorDefinitionName": {
              "defaultValue": "Jamf Protect Push Connector",
              "type": "string",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "string"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'JamfProtectPushConnectorPolling', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "Push",
              "properties": {
                "connectorDefinitionName": "JamfProtectPush",
                "dcrConfig": {
                  "streamName": "Custom-jamfprotecttelemetryv2",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                  "type": "Push",
                  "AppId": "[[parameters('auth').appId]",
                  "ServicePrincipalId": "[[parameters('auth').servicePrincipalId]"
                },
                "request": {
                  "RetryCount": 1
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.messages"
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtectAlerts Data Parser with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for Jamf Protect Alerts",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "JamfProtectAlerts",
                "query": "jamfprotectalerts_CL\n| extend\n    ActingProcessCreationTime = unixtime_seconds_todatetime(tolong(input.related.processes[array_length(input.related.processes) - 1].startTimestamp)),\n    ParentProcessCreationTime = iff(\n                                array_length(input.related.processes) > 1, \n                                unixtime_seconds_todatetime(tolong(input.related.processes[0].startTimestamp)), \n                                datetime(null)\n                            ),\n    TargetProcessCreationTime = unixtime_seconds_todatetime(todouble(input.related.processes[0].startTimestamp)),\n    TargetUserId = coalesce(input.related.users[1].uid, input.related.users[0].uid),\n    TargetUsername = coalesce(input.related.users[1].name, input.related.users[0].name)\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectAlerts')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "Jamf Protect",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "Parser for Jamf Protect Alerts",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '3.3.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '3.3.0')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for Jamf Protect Alerts",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "JamfProtectAlerts",
        "query": "jamfprotectalerts_CL\n| extend\n    ActingProcessCreationTime = unixtime_seconds_todatetime(tolong(input.related.processes[array_length(input.related.processes) - 1].startTimestamp)),\n    ParentProcessCreationTime = iff(\n                                array_length(input.related.processes) > 1, \n                                unixtime_seconds_todatetime(tolong(input.related.processes[0].startTimestamp)), \n                                datetime(null)\n                            ),\n    TargetProcessCreationTime = unixtime_seconds_todatetime(todouble(input.related.processes[0].startTimestamp)),\n    TargetUserId = coalesce(input.related.users[1].uid, input.related.users[0].uid),\n    TargetUsername = coalesce(input.related.users[1].name, input.related.users[0].name)\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectAlerts')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "Jamf Protect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Thijs Xhaflaire",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Jamf Software, LLC",
          "email": "support@jamf.com",
          "tier": "Partner",
          "link": "https://www.jamf.com/support/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject2').parserTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtectTelemetry Data Parser with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject2').parserVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject2')._parserName2]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for Jamf Protect Telemetry Events",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "JamfProtectTelemetry",
                "query": "jamfprotecttelemetryv2_CL\n// Generic Fields\n| extend\n    EventExpanded = tostring(parse_json(event)[strcat_array(bag_keys(event), '.')]),\n    eventTypeHuman = tostring(bag_keys(event)[0])\n| extend EventResult = iif((event[eventTypeHuman]['success'] == true), \"Success\", dynamic(null))\n| extend\n    EventMessage = case(\n                eventTypeHuman == \"authentication\",\n                \"A user authentication happened\",\n                eventTypeHuman == \"authorization_judgement\",\n                \"A process has its rights petition judged\",\n                eventTypeHuman == \"authorization_petition\",\n                \"A process has its rights petition judged\",\n                eventTypeHuman == \"bios_uefi\",\n                \"Collection of bios and firmware data\",\n                eventTypeHuman == \"btm_launch_item_add\",\n                \"Apple's Background Task Manager notified that an item has been added\",\n                eventTypeHuman == \"btm_launch_item_remove\",\n                \"Apple's Background Task Manager notified that an existing item has been removed\",\n                eventTypeHuman == \"chroot\",\n                \"Software has changed its apparent root directory in which it's actively operating out of\",\n                eventTypeHuman == \"cs_invalidated\",\n                \"The system detected that a process has had its code signature marked as invalid\",\n                eventTypeHuman == \"exec\",\n                \"A new process has been executed\",\n                eventTypeHuman == \"kextload\",\n                \"A kernel extension (kext) was loaded\",\n                eventTypeHuman == \"kextunload\",\n                \"A kernel extension (kext) was unloaded\",\n                eventTypeHuman == \"login_login\",\n                \"A user attempted to log in using /usr/bin/login\",\n                eventTypeHuman == \"login_logout\",\n                \"A user logged out from /usr/bin/login\",\n                eventTypeHuman == \"lw_session_lock\",\n                \"A user has locked the screen\",\n                eventTypeHuman == \"lw_session_login\",\n                \"A user has logged in via the Login Window\",\n                eventTypeHuman == \"lw_session_logout\",\n                \"A user has logged out of an active graphical session\",\n                eventTypeHuman == \"lw_session_unlock\",\n                \"A user has unlocked the screen from the Login Window\",\n                eventTypeHuman == \"mount\",\n                \"A file system has been mounted\",\n                eventTypeHuman == \"od_attribute_set\",\n                \"Attribute set on user or group using Open Directory\",\n                eventTypeHuman == \"od_attribute_value_add\",\n                \"Attribute added to a user or group using Open Directory\",\n                eventTypeHuman == \"od_attribute_value_remove\",\n                \"Attribute removed from a user or group using Open Directory\",\n                eventTypeHuman == \"od_create_group\",\n                \"A group has been created using Open Directory\",\n                eventTypeHuman == \"od_create_user\",\n                \"A user has been created using Open Directory\",\n                eventTypeHuman == \"od_delete_group\",\n                \"A group has been deleted using Open Directory\",\n                eventTypeHuman == \"od_delete_user\",\n                \"A user has been deleted using Open Directory\",\n                eventTypeHuman == \"od_disable_user\",\n                \"A user has been disabled using Open Directory\",\n                eventTypeHuman == \"od_enable_user\",\n                \"A user has been enabled using Open Directory\",\n                eventTypeHuman == \"od_group_add\",\n                \"A member has been added to a group using Open Directory\",\n                eventTypeHuman == \"od_group_remove\",\n                \"A member has been removed from a group using Open Directory\",\n                eventTypeHuman == \"od_group_set\",\n                \"A group has a member initialised or replaced using Open Directory\",\n                eventTypeHuman == \"od_modify_password\",\n                \"A user password is modified via Open Directory\",\n                eventTypeHuman == \"openssh_login\",\n                \"A user has logged into the system via OpenSSH\",\n                eventTypeHuman == \"openssh_logout\",\n                \"A user has logged out of an OpenSSH session\",\n                eventTypeHuman == \"performance\",\n                \"Collection of system performance data\",\n                eventTypeHuman == \"profile_add\",\n                \"A configuration profile is installed on the system\",\n                eventTypeHuman == \"profile_remove\",\n                \"A configuration profile is removed from the system\",\n                eventTypeHuman == \"remount\",\n                \"A file system has been mounted\",\n                eventTypeHuman == \"screensharing_attach\",\n                \"A screensharing session has attached to a graphical session\",\n                eventTypeHuman == \"screensharing_detach\",\n                \"A screensharing session has detached from a graphical session\",\n                eventTypeHuman == \"settime\",\n                \"The system time was attempted to be set\",\n                eventTypeHuman == \"su\",\n                \"A user attempts to start a new shell using a substitute user identity\",\n                eventTypeHuman == \"sudo\",\n                \"A sudo attempt occured\",\n                eventTypeHuman == \"unmount\",\n                \"A file system has been mounted\",\n                eventTypeHuman == \"xp_malware_detected\",\n                \"Apple's XProtect detected malware on the system\",\n                eventTypeHuman == \"xp_malware_remediated\",\n                \"Apple's XProtect remediated malware on the system\",\n                eventTypeHuman == \"file_collection\",\n                \"A crash or diagnostic file has been collected\",\n                eventTypeHuman == \"log_collection\",\n                \"Entries from a log file have been collected\",\n                eventTypeHuman == \"gatekeeper_user_override\",\n                \"Gatekeeper controls were overridden\",\n                eventTypeHuman == \"network_connect\",\n                \"A network connection has been established\",\n                eventTypeHuman == \"tcc_modify\",\n                \"A Transparency Consent and Control (TCC) permission is granted or revoked\",\n                eventTypeHuman == \"pty_grant\",\n                \"A pseudoterminal control device is granted\",\n                eventTypeHuman == \"pty_close\",\n                \"A pseudoterminal control device is closed\",\n                \"No reason yet defined for this event\"\n            ),\n    EventType = case(\n                eventTypeHuman == \"authentication\",\n                \"Logon\",\n                eventTypeHuman == \"authorization_judgement\",\n                \"ProcessCreated\",\n                eventTypeHuman == \"authorization_petition\",\n                \"ProcessCreated\",\n                eventTypeHuman == \"bios_uefi\",\n                \"Hardware\",\n                eventTypeHuman == \"btm_launch_item_add\",\n                \"Create\",\n                eventTypeHuman == \"btm_launch_item_remove\",\n                \"Delete\",\n                eventTypeHuman == \"chroot\",\n                \"Set\",\n                eventTypeHuman == \"cs_invalidated\",\n                \"Other\",\n                eventTypeHuman == \"exec\",\n                \"ProcessCreated\",\n                eventTypeHuman == \"kextload\",\n                \"Create\",\n                eventTypeHuman == \"kextunload\",\n                \"Delete\",\n                eventTypeHuman == \"login_login\",\n                \"Logon\",\n                eventTypeHuman == \"login_logout\",\n                \"Logoff\",\n                eventTypeHuman == \"lw_session_lock\",\n                \"Logoff\",\n                eventTypeHuman == \"lw_session_login\",\n                \"Logon\",\n                eventTypeHuman == \"lw_session_logout\",\n                \"Logoff\",\n                eventTypeHuman == \"lw_session_unlock\",\n                \"Logon\",\n                eventTypeHuman == \"mount\",\n                \"FileSystemMounted\",\n                eventTypeHuman == \"od_attribute_set\",\n                \"Set\",\n                eventTypeHuman == \"od_attribute_value_add\",\n                \"Create\",\n                eventTypeHuman == \"od_attribute_value_remove\",\n                \"Delete\",\n                eventTypeHuman == \"od_create_group\",\n                \"GroupCreated\",\n                eventTypeHuman == \"od_create_user\",\n                \"UserCreated\",\n                eventTypeHuman == \"od_delete_group\",\n                \"GroupDeleted\",\n                eventTypeHuman == \"od_delete_user\",\n                \"UserDeleted\",\n                eventTypeHuman == \"od_disable_user\",\n                \"UserDisabled\",\n                eventTypeHuman == \"od_enable_user\",\n                \"UserEnabled\",\n                eventTypeHuman == \"od_group_add\",\n                \"UserAddedToGroup\",\n                eventTypeHuman == \"od_group_remove\",\n                \"UserRemovedFromGroup\",\n                eventTypeHuman == \"od_group_set\",\n                \"GroupModified\",\n                eventTypeHuman == \"od_modify_password\",\n                \"PasswordChanged\",\n                eventTypeHuman == \"openssh_login\",\n                \"Logon\",\n                eventTypeHuman == \"openssh_logout\",\n                \"Logoff\",\n                eventTypeHuman == \"performance\",\n                \"PerformanceData\",\n                eventTypeHuman == \"profile_add\",\n                \"Create\",\n                eventTypeHuman == \"profile_remove\",\n                \"Delete\",\n                eventTypeHuman == \"remount\",\n                \"FileSystemRemounted\",\n                eventTypeHuman == \"screenscharing_attach\",\n                \"Logon\",\n                eventTypeHuman == \"screenscharing_detach\",\n                \"Logoff\",\n                eventTypeHuman == \"settime\",\n                \"Set\",\n                eventTypeHuman == \"su\",\n                \"Elevate\",\n                eventTypeHuman == \"sudo\",\n                \"Elevate\",\n                eventTypeHuman == \"unmount\",\n                \"FileSystemUnmounted\",\n                eventTypeHuman == \"xp_malware_detected\",\n                \"MalwareDetected\",\n                eventTypeHuman == \"xp_malware_remediated\",\n                \"MalwareRemediated\",\n                eventTypeHuman == \"xp_malware_remediated\",\n                \"GatekeeperOverride\",\n                eventTypeHuman == \"network_connect\",\n                \"EndpointNetworkSession\",\n                eventTypeHuman == \"tcc_modify\",\n                \"Set\",\n                eventTypeHuman == \"pty_grant\",\n                \"Other\",\n                eventTypeHuman == \"pty_close\",\n                \"Other\",\n                \"\"\n            ),\n    EventSubType = case(\n                eventTypeHuman == \"authentication\",\n                \"Interactive\",\n                eventTypeHuman == \"btm_launch_item_add\",\n                \"btm\",\n                eventTypeHuman == \"btm_launch_item_remove\",\n                \"btm\",\n                eventTypeHuman == \"chroot\",\n                \"Directory\",\n                eventTypeHuman == \"cs_invalidated\",\n                \"Other\",\n                eventTypeHuman == \"kextload\",\n                \"System Settings\",\n                eventTypeHuman == \"kextunload\",\n                \"System Settings\",\n                eventTypeHuman == \"login_login\",\n                \"Interactive\",\n                eventTypeHuman == \"login_logout\",\n                \"Interactive\",\n                eventTypeHuman == \"lw_session_lock\",\n                \"Interactive\",\n                eventTypeHuman == \"lw_session_login\",\n                \"Interactive\",\n                eventTypeHuman == \"lw_session_logout\",\n                \"Interactive\",\n                eventTypeHuman == \"lw_session_unlock\",\n                \"Interactive\",\n                eventTypeHuman == \"od_attribute_set\",\n                \"Attribute\",\n                eventTypeHuman == \"od_attribute_value_add\",\n                \"Attribute\",\n                eventTypeHuman == \"od_attribute_value_remove\",\n                \"Attribute\",\n                eventTypeHuman == \"openssh_login\",\n                \"Interactive\",\n                eventTypeHuman == \"openssh_logout\",\n                \"Interactive\",\n                eventTypeHuman == \"profile_add\",\n                \"Configuration Profile\",\n                eventTypeHuman == \"profile_remove\",\n                \"Configuration Profile\",\n                eventTypeHuman == \"screenscharing_attach\",\n                \"RemoteInteractive\",\n                eventTypeHuman == \"screenscharing_detach\",\n                \"RemoteInteractive\",\n                eventTypeHuman == \"settime\",\n                \"System Settings\",\n                eventTypeHuman == \"su\",\n                \"Interactive\",\n                eventTypeHuman == \"sudo\",\n                \"Interactive\",\n                eventTypeHuman == \"network_connect\",\n                \"Interactive\",\n                eventTypeHuman == \"tcc_modify\",\n                \"System Settings\",\n                eventTypeHuman == \"pty_grant\",\n                \"Other\",\n                eventTypeHuman == \"pty_close\",\n                \"Other\",\n                \"\"\n            )\n// Jamf Protect Telemetry - Event Process\n| extend eventContext = \n    iif(\n    isnotempty(event[eventTypeHuman]['app']['audit_token']),\n    event[eventTypeHuman]['app'],\n    iif(\n    isnotempty(event[eventTypeHuman]['target']['audit_token']),\n    event[eventTypeHuman]['target'],\n    iif(\n    isnotempty(event[eventTypeHuman]['data']['od']['audit_token']),\n    event[eventTypeHuman]['data']['od'],\n    iif(\n    isnotempty(event[eventTypeHuman]['data']['token']['audit_token']),\n    event[eventTypeHuman]['data']['token'],\n    iif(\n    isnotempty(event[eventTypeHuman]['data']['touchid']['audit_token']),\n    event[eventTypeHuman]['data']['touchid'],\n    iif(\n    isnotempty(event[eventTypeHuman]['instigator']['audit_token']),\n    event[eventTypeHuman]['instigator'],\n    ['process']\n)\n)\n)\n)\n)\n)\n| extend\n    TargetProcessName = tostring(eventContext.executable.path),\n    TargetProcessId = tostring(eventContext.audit_token.pid),\n    TargetProcessGuid = tostring(eventContext.audit_token.uuid),\n    TargetProcessCreationTime = tostring(eventContext.start_time),\n    TargetProcessSHA1 = tostring(eventContext.executable.sha1),\n    TargetProcessSHA256 = tostring(eventContext.executable.sha256),\n    TargetProcessCommandLine = event[eventTypeHuman]['args'],\n    TargetProcessTTY = tostring(eventContext.tty.path),\n    TargetBinarySigningAppID = tostring(eventContext.signing_id),\n    TargetBinarySigningTeamID = tostring(eventContext.team_id),\n    TargetBinaryCDHash = tostring(eventContext.cdhash),\n    TargetBinaryIsESClient = tobool(eventContext.is_es_client),\n    TargetBinaryIsPlatformBinary = tobool(eventContext.is_platform_binary),\n    TargetUserId = tostring(eventContext.audit_token.euid),\n    TargetProcessUsername = tostring(eventContext.audit_token.e_username),\n    ResponsibleProcessId = tostring(eventContext.responsible_audit_token.pid),\n    ResponsibleProcessGuid = tostring(eventContext.responsible_audit_token.uuid),\n    ResponsibleUserId = tostring(eventContext.responsible_audit_token.euid),\n    ResponsibleUsername = tostring(eventContext.responsible_audit_token.e_username),\n    ResponsibleProcessName = tostring(eventContext.responsible_audit_token.exec_path),\n    ParentProcessId = tostring(eventContext.parent_audit_token.pid),\n    ParentProcessGuid = tostring(eventContext.parent_audit_token.uuid),\n    ParentUsername = tostring(eventContext.parent_audit_token.e_username),\n    ParentProcessName = tostring(eventContext.parent_audit_token.exec_path)\n// Jamf Protect Telemetry - Revealing Code Signing flags\n| extend TargetProcessCodesignFlags = \n                                            iif(isnotempty(eventContext.codesigning_flags),\n                                        bag_pack(\n                                        \"CS_VALID\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000001) > 0, true, false),\n                                        \"CS_ADHOC\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000002) > 0, true, false),\n                                        \"CS_GET_TASK_ALLOW\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000004) > 0, true, false),\n                                        \"CS_INSTALLER\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000008) > 0, true, false),\n                                        \"CS_FORCED_LV\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000010) > 0, true, false),\n                                        \"CS_INVALID_ALLOWED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000020) > 0, true, false),\n                                        \"CS_HARD\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000100) > 0, true, false),\n                                        \"CS_KILL\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000200) > 0, true, false),\n                                        \"CS_CHECK_EXPIRATION\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000400) > 0, true, false),\n                                        \"CS_RESTRICT\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000800) > 0, true, false),\n                                        \"CS_ENFORCEMENT\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00001000) > 0, true, false),\n                                        \"CS_REQUIRE_LV\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00002000) > 0, true, false),\n                                        \"CS_ENTITLEMENTS_VALIDATED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00004000) > 0, true, false),\n                                        \"CS_NVRAM_UNRESTRICTED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00008000) > 0, true, false),\n                                        \"CS_RUNTIME\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00010000) > 0, true, false),\n                                        \"CS_LINKER_SIGNED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x20000) > 0, true, false),\n                                        \"CS_EXEC_SET_HARD\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00100000) > 0, true, false),\n                                        \"CS_EXEC_SET_KILL\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00200000) > 0, true, false),\n                                        \"CS_EXEC_SET_ENFORCEMENT\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00400000) > 0, true, false),\n                                        \"CS_EXEC_INHERIT_SIP\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00800000) > 0, true, false),\n                                        \"CS_KILLED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x01000000) > 0, true, false),\n                                        \"CS_DYLD_PLATFORM\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x02000000) > 0, true, false),\n                                        \"CS_PLATFORM_BINARY\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x04000000) > 0, true, false),\n                                        \"CS_PLATFORM_PATH\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x08000000) > 0, true, false),\n                                        \"CS_DEBUGGED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x10000000) > 0, true, false),\n                                        \"CS_SIGNED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x20000000) > 0, true, false),\n                                        \"CS_DEV_CODE\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x40000000) > 0, true, false),\n                                        \"CS_DATAVAULT_CONTROLLER\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x80000000) > 0, true, false)\n                                    ), \"\")\n// Event Specific - authentication\n| extend TargetUsername =\n    iif(\n    isnotempty(event[eventTypeHuman]['username']),\n    event[eventTypeHuman]['username'],\n    iif(\n    isnotempty(event[eventTypeHuman]['to_username']),\n    event[eventTypeHuman]['to_username'],\n    iif(\n    isnotempty(event[eventTypeHuman]['account_name']),\n    event[eventTypeHuman]['account_name'],\n    iif(\n    isnotempty(event[eventTypeHuman]['user_name']),\n    event[eventTypeHuman]['user_name'],\n    iif(\n    isnotempty(event[eventTypeHuman]['authentication_username']),\n    event[eventTypeHuman]['authentication_username'],\n    \"\"\n)\n)\n)\n)\n)\n// Event Specific - authentication\n| extend ActorUsername = \n    iif(\n    isnotempty(event[eventTypeHuman]['from_username']),\n    event[eventTypeHuman]['from_username'],\n    iif(\n    isnotempty(event[eventTypeHuman]['session_username']),\n    event[eventTypeHuman]['session_username'],\n    \"\"\n)\n)\n| extend Authentication = iif(\n                            eventTypeHuman == \"authentication\",\n                            bag_pack(\n    \"authentication_method\",\n    iff(isnotempty(event[eventTypeHuman].data), tostring(bag_keys(event[eventTypeHuman].data)[0]), \"\")\n),\n                            dynamic(null)\n                        )\n// Event Specific - bios_uefi\n| extend HardwareInformation = iif(\n                            eventTypeHuman == \"bios_uefi\",\n                            bag_pack(\n    \"host_architecture\",\n    iff(isnotempty(event[eventTypeHuman].architecture), event[eventTypeHuman].architecture, \"\"),\n    \"firmware_version\",\n    iff(isnotempty(event[eventTypeHuman].bios.['firmware-version']), event[eventTypeHuman].bios.['firmware-version'], \"\"),\n    \"system_firmware_version\",\n    iff(isnotempty(event[eventTypeHuman].bios.['system-firmware-version']), event[eventTypeHuman].bios.['system-firmware-version'], \"\")\n),\n                            dynamic(null)\n                        )\n// Event Specific - btm_launch_item_add & btm_launch_item_remove\n| extend BtmItem = iif(\n                    eventTypeHuman in (\"btm_launch_item_add\", \"btm_launch_item_remove\"),\n                    bag_pack(\n    \"btm_executable_path\",\n    iff(isnotempty(event[eventTypeHuman].executable_path), event[eventTypeHuman].executable_path, \"\"),\n    \"btm_item_app_url\",\n    iff(isnotempty(event[eventTypeHuman].item.app_url), event[eventTypeHuman].item.app_url, \"\"),\n    \"btm_item_url\",\n    iff(isnotempty(event[eventTypeHuman].item.item_url), event[eventTypeHuman].item.item_url, \"\"),\n    \"btm_item_managed\",\n    iff(isnotempty(event[eventTypeHuman].item.managed), event[eventTypeHuman].item.managed, \"\"),\n    \"btm_item_legacy\",\n    iff(isnotempty(event[eventTypeHuman].item.legacy), event[eventTypeHuman].item.legacy, \"\"),\n    \"btm_item_uid\",\n    iff(isnotempty(event[eventTypeHuman].item.uid), event[eventTypeHuman].item.uid, \"\"),\n    \"btm_item_type\",\n    iff(\n    isnotempty(event[eventTypeHuman].item.item_type),\n    case(\n    event[eventTypeHuman].item.item_type == 0,\n    \"UserItem\",\n    event[eventTypeHuman].item.item_type == 1,\n    \"App\",\n    event[eventTypeHuman].item.item_type == 2,\n    \"LoginItem\",\n    event[eventTypeHuman].item.item_type == 3,\n    \"LaunchAgent\",\n    event[eventTypeHuman].item.item_type == 4,\n    \"LaunchDaemon\",\n    \"Unknown\"\n),\n    \"\"\n)\n),\n                    dynamic(null)\n                )\n// Event Specific - chroot\n| extend Chroot = iif(\n                    eventTypeHuman == \"chroot\",\n                    bag_pack(\n    \"apparent_root_directory\",\n    iff(isnotempty(event[eventTypeHuman].target), event[eventTypeHuman].target.path, \"\"),\n    \"stats\",\n    iff(isnotempty(event[eventTypeHuman].target.stat), event[eventTypeHuman].target.stat, \"\")\n),\n                    dynamic(null)\n                )\n// Event Specific - cs_invalidated\n// Event Specific - exec\n// Event Specific - kextload & kextunload\n| extend KernelExtension = iif(\n                            eventTypeHuman in (\"kextload\", \"kextunload\"),\n                            bag_pack(\n    \"kext_identifier\",\n    iff(isnotempty(event[eventTypeHuman].identifier), event[eventTypeHuman].identifier, \"\")\n),\n                            dynamic(null)\n                        )\n// Event Specific - lw_session_lock & lw_session_unlock & lw_session_login & lw_session_logout\n| extend LoginWindowSession = iif(\n                                eventTypeHuman in (\"lw_session_lock\", \"lw_session_unlock\", \"lw_session_login\", \"lw_session_logout\"),\n                                bag_pack(\n    \"graphical_session_id\",\n    iff(isnotempty(event[eventTypeHuman].graphical_session_id), event[eventTypeHuman].graphical_session_id, \"\")\n),\n                                dynamic(null)\n                            )\n// Event Specific - mount & remount & unmount\n| extend FileSystem = iif(\n                        eventTypeHuman in (\"mount\", \"unmount\", \"remount\"),\n                        bag_pack(\n    \"volume_device_name\",\n    iff(isnotempty(event[eventTypeHuman].statfs.f_mntfromname), event[eventTypeHuman].statfs.f_mntfromname, \"\"),\n    \"volume_mount_name\",\n    iff(isnotempty(event[eventTypeHuman].statfs.f_mntonname), event[eventTypeHuman].statfs.f_mntonname, \"\"),\n    \"volume_file_system_type\",\n    iff(isnotempty(event[eventTypeHuman].statfs.f_fstypename), event[eventTypeHuman].statfs.f_fstypename, \"\"),\n    \"volume_size\",\n    iff(isnotempty(event[eventTypeHuman].statfs.f_bsize), event[eventTypeHuman].statfs.f_bsize, \"\"),\n    \"bus_type\",\n    iff(isnotempty(event[eventTypeHuman].device.bus_name), event[eventTypeHuman].device.bus_name, \"\"),\n    \"product_id\",\n    iff(isnotempty(event[eventTypeHuman].device.product_id), event[eventTypeHuman].device.product_id, \"\"),\n    \"product_name\",\n    iff(isnotempty(event[eventTypeHuman].device.product_name), event[eventTypeHuman].device.product_name, \"\"),\n    \"vendor_id\",\n    iff(isnotempty(event[eventTypeHuman].device.vendor_id), event[eventTypeHuman].device.vendor_id, \"\"),\n    \"vendor_name\",\n    iff(isnotempty(event[eventTypeHuman].device.vendor_name), event[eventTypeHuman].device.vendor_name, \"\"),\n    \"device_type\",\n    iff(isnotempty(event[eventTypeHuman].device.device_type), event[eventTypeHuman].device.device_type, \"\"),\n    \"is_removable\",\n    iff(isnotempty(event[eventTypeHuman].device.is_removable), event[eventTypeHuman].device.is_removable, \"\"),\n    \"is_writable\",\n    iff(isnotempty(event[eventTypeHuman].device.is_writable), event[eventTypeHuman].device.is_writable, \"\"),\n    \"is_encrypted\",\n    iff(isnotempty(event[eventTypeHuman].device.is_encrypted), event[eventTypeHuman].device.is_encrypted, \"\"),\n    \"is_network_volume\",\n    iff(isnotempty(event[eventTypeHuman].device.is_network_volume), event[eventTypeHuman].device.is_network_volume, \"\"),\n    \"serial_number\",\n    iff(isnotempty(event[eventTypeHuman].device.serial_number), event[eventTypeHuman].device.serial_number, \"\"),\n    \"media_name\",\n    iff(isnotempty(event[eventTypeHuman].device.media_name), event[eventTypeHuman].device.media_name, \"\"),\n    \"volume_name\",\n    iff(isnotempty(event[eventTypeHuman].device.volume_name), event[eventTypeHuman].device.volume_name, \"\")\n),\n                        dynamic(null)\n                    )\n// Event Specific - od_attribute_set & od_attribute_value_add & od_attribute_value_remove & od_create_group & od_create_user & od_delete_group & od_delete_user & od_disable_user & od_enable_user\n| extend OpenDirectory = iif(\n                            eventTypeHuman in (\"od_attribute_set\", \"od_attribute_value_add\", \"od_attribute_value_remove\", \"od_create_group\", \"od_create_user\", \"od_delete_group\", \"od_delete_user\", \"od_disable_user\", \"od_enable_user\"),\n                            bag_pack(\n    \"group_name\",\n    iff(isnotempty(event[eventTypeHuman].group_name), event[eventTypeHuman].group_name, \"\"),\n    \"member_array\",\n    iff(isnotempty(event[eventTypeHuman].members.member_array), event[eventTypeHuman].members.member_array, \"\"),\n    \"member_value\",\n    iff(isnotempty(event[eventTypeHuman].member.member_value), event[eventTypeHuman].member.member_value, \"\"),\n    \"user_name\",\n    iff(isnotempty(event[eventTypeHuman].user_name), event[eventTypeHuman].user_name, \"\"),\n    \"account_name\",\n    iff(isnotempty(event[eventTypeHuman].account_name), event[eventTypeHuman].account_name, \"\"),\n    \"db_path\",\n    iff(isnotempty(event[eventTypeHuman].db_path), event[eventTypeHuman].db_path, \"\"),\n    \"record_name\",\n    iff(isnotempty(event[eventTypeHuman].record_name), event[eventTypeHuman].record_name, \"\"),\n    \"attribute_name\",\n    iff(isnotempty(event[eventTypeHuman].attribute_name), event[eventTypeHuman].attribute_name, \"\"),\n    \"attribute_value\",\n    iff(isnotempty(event[eventTypeHuman].attribute_value), event[eventTypeHuman].attribute_value, \"\"),\n    \"node_name\",\n    iff(isnotempty(event[eventTypeHuman].node_name), event[eventTypeHuman].node_name, \"\")\n),\n                            dynamic(null)\n                        )\n// Event Specific - openssh_login & openssh_logout\n| extend SSHContext = iif(\n                        eventTypeHuman in (\"openssh_login\", \"openssh_logout\"),\n                        bag_pack(\n    \"source_address_type\", \n    iff(\n    isnotempty(event[eventTypeHuman].source_address_type),\n    case(\n    event[eventTypeHuman].source_address_type == 0,\n    \"Unknown\",\n    event[eventTypeHuman].source_address_type == 1,\n    \"IPv4\",\n    event[eventTypeHuman].source_address_type == 2,\n    \"IPv6\",\n    event[eventTypeHuman].source_address_type == 3,\n    \"UNIX Socket\",\n    \"Unknown\"\n),\n    \"\" \n),\n    \"result_type\", \n    iff(\n    isnotempty(event[eventTypeHuman].result_type),\n    case(\n    event[eventTypeHuman].result_type == 0,\n    \"Exceeded maximum attempts\",\n    event[eventTypeHuman].result_type == 1,\n    \"Denied by root\",\n    event[eventTypeHuman].result_type == 2,\n    \"Success\",\n    event[eventTypeHuman].result_type == 3,\n    \"No reason\",\n    event[eventTypeHuman].result_type == 4,\n    \"Password\",\n    event[eventTypeHuman].result_type == 5,\n    \"kbdint\",\n    event[eventTypeHuman].result_type == 6,\n    \"Public key\",\n    event[eventTypeHuman].result_type == 7,\n    \"Host based\",\n    event[eventTypeHuman].result_type == 8,\n    \"GSS API\",\n    event[eventTypeHuman].result_type == 9,\n    \"Invalid user\",\n    \"Unknown\"\n),\n    \"\" \n)\n),\n                        dynamic(null)  \n                    )\n// Event Specific - performance\n// Event Specific - profile_add & profile_remove\n| extend Profile = iif(\n                    eventTypeHuman in (\"profile_add\", \"profile_remove\"),\n                    bag_pack(\n    \"profile_scope\",\n    iff(isnotempty(event[eventTypeHuman].profile.scope), event[eventTypeHuman].profile.scope, \"\"),\n    \"profile_identifier\",\n    iff(isnotempty(event[eventTypeHuman].profile.identifier), event[eventTypeHuman].profile.identifiery, \"\"),\n    \"profile_uuid\",\n    iff(isnotempty(event[eventTypeHuman].profile.uuid), event[eventTypeHuman].profile.uuid, \"\"),\n    \"profile_display_name\",\n    iff(isnotempty(event[eventTypeHuman].profile.display_name), event[eventTypeHuman].profile.display_name, \"\"),\n    \"profile_organization\",\n    iff(isnotempty(event[eventTypeHuman].profile.organization), event[eventTypeHuman].profile.organization, \"\"),\n    \"profile_is_updated\",\n    iff(isnotempty(event[eventTypeHuman].is_update), event[eventTypeHuman].is_update, \"\"),\n    \"profile_install_source\", \n    iff(\n    isnotempty(event[eventTypeHuman].profile.install_source),\n    case(\n    event[eventTypeHuman].profile.install_source == 0,\n    \"mdm\",\n    event[eventTypeHuman].profile.install_source == 1,\n    \"manual\",\n    \"Unknown\"\n),\n    \"\" \n)\n),\n                    dynamic(null)\n                )\n// Event Specific - screenscharing_attach & screensharing_detach\n| extend Screensharing = iif(\n                            eventTypeHuman in (\"screensharing_attach\", \"screensharing_detach\"),\n                            bag_pack(\n    \"existing_session\",\n    iff(isnotempty(event[eventTypeHuman].existing_session), event[eventTypeHuman].existing_session, \"\"),\n    \"graphical_session_id\",\n    iff(isnotempty(event[eventTypeHuman].graphical_authentication_username), event[eventTypeHuman].graphical_authentication_username, \"\"),\n    \"session_username\",\n    iff(isnotempty(event[eventTypeHuman].session_username), event[eventTypeHuman].session_username, \"\"),\n    \"viewer_appleid\",\n    iff(isnotempty(event[eventTypeHuman].viewer_appleid), event[eventTypeHuman].viewer_appleid, \"\"),\n    \"authentication_type\",\n    iff(isnotempty(event[eventTypeHuman].authentication_type), event[eventTypeHuman].authentication_type, \"\"),\n    \"source_address\",\n    iff(isnotempty(event[eventTypeHuman].source_address), event[eventTypeHuman].source_address, \"\"),\n    \"source_address_type\", \n    iff(\n    isnotempty(event[eventTypeHuman].source_address_type),\n    case(\n    event[eventTypeHuman].source_address_type == 0,\n    \"Unknown\",\n    event[eventTypeHuman].source_address_type == 1,\n    \"IPv4\",\n    event[eventTypeHuman].source_address_type == 2,\n    \"IPv6\",\n    event[eventTypeHuman].source_address_type == 3,\n    \"UNIX Socket\",\n    \"Unknown\"\n),\n    \"\" \n)\n),\n                            dynamic(null)\n                        )\n// Event Specific - su\n| extend Su = iif(\n                eventTypeHuman == \"su\",\n                bag_pack(\n    \"username\",\n    iff(isnotempty(event[eventTypeHuman].username), event[eventTypeHuman].username, \"\"),\n    \"uid\",\n    iff(isnotempty(event[eventTypeHuman].uid), event[eventTypeHuman].uid, \"\"),\n    \"args\",\n    iff(isnotempty(event[eventTypeHuman].argv), event[eventTypeHuman].argv, \"\"),\n    \"env_vars\",\n    iff(isnotempty(event[eventTypeHuman].env), event[eventTypeHuman].env, \"\"),\n    \"env_count\",\n    iff(isnotempty(event[eventTypeHuman].env_count), event[eventTypeHuman].env_count, \"\"),\n    \"from_username\",\n    iff(isnotempty(event[eventTypeHuman].from_username), event[eventTypeHuman].from_username, \"\"),\n    \"to_username\",\n    iff(isnotempty(event[eventTypeHuman].to_username), event[eventTypeHuman].to_username, \"\"),\n    \"failure_message\",\n    iff(isnotempty(event[eventTypeHuman].failure_reason), event[eventTypeHuman].failure_reason, \"\")\n),\n                dynamic(null)\n            )\n// Event Specific - sudo\n| extend Sudo = iif(\n                    eventTypeHuman == \"sudo\",\n                    bag_pack(\n    \"TargetProcessCommandLine\",\n    iff(isnotempty(event[eventTypeHuman].command), event[eventTypeHuman].command, \"\"),\n    \"attribute_name\",\n    iff(isnotempty(event[eventTypeHuman].attribute_name), event[eventTypeHuman].attribute_name, \"\"),\n    \"attribute_value\",\n    iff(isnotempty(event[eventTypeHuman].attribute_value), event[eventTypeHuman].attribute_value, \"\")\n),\n                    dynamic(null)\n                )\n// Event Specific - xp_malware_detected & xp_malware_remediated\n| extend Xprotect = iif(\n                        eventTypeHuman in (\"xp_malware_detected\", \"xp_malware_remediated\"),\n                        bag_pack(\n    \"detected_path\",\n    iff(isnotempty(event[eventTypeHuman].detected_path), event[eventTypeHuman].detected_path, \"\"),\n    \"remediated_path\",\n    iff(isnotempty(event[eventTypeHuman].remediated_path), event[eventTypeHuman].remediated_path, \"\"),\n    \"malware_identifier\",\n    iff(isnotempty(event[eventTypeHuman].malware_identifier), event[eventTypeHuman].malware_identifier, \"\"),\n    \"signature_version\",\n    iff(isnotempty(event[eventTypeHuman].signature_version), event[eventTypeHuman].signature_version, \"\")\n),\n                        dynamic(null)\n                    )\n// Event Specific - gatekeeper_user_override\n| extend GatekeeperOverride = iif(\n                        eventTypeHuman == \"gatekeeper_user_override\",\n                        bag_pack(\n    \"TargetFilePath\",\n    iff(isnotempty(event[eventTypeHuman].file.path), event[eventTypeHuman].file.path, \"\"),\n    \"TargetFileSize\",\n    iff(isnotempty(event[eventTypeHuman].file.stat.st_size), event[eventTypeHuman].file.stat.st_size, \"\"),\n    \"TargetFileCreationTime\",\n    iff(isnotempty(event[eventTypeHuman].file.stat.st_birthtimespec), event[eventTypeHuman].file.stat.st_birthtimespec, \"\"),\n    \"TargetFileAccessedTime\",\n    iff(isnotempty(event[eventTypeHuman].file.stat.st_atimespec), event[eventTypeHuman].file.stat.st_atimespec, \"\"),\n    \"ActorUserId\",\n    iff(isnotempty(event[eventTypeHuman].file.stat.st_uid), event[eventTypeHuman].file.stat.st_uid, \"\"),\n    \"GroupId\",\n    iff(isnotempty(event[eventTypeHuman].file.stat.st_gid), event[eventTypeHuman].file.stat.st_gid, \"\"),\n    \"TargetFileSHA256\",\n    iff(isnotempty(event[eventTypeHuman].sha256), event[eventTypeHuman].sha256, \"\"),\n    \"TargetFileCdHash\",\n    iff(isnotempty(event[eventTypeHuman].signing_info.cdhash), event[eventTypeHuman].signing_info.cdhash, \"\"),\n    \"TargetBinarySigningTeamID\",\n    iff(isnotempty(event[eventTypeHuman].signing_info.team_id), event[eventTypeHuman].signing_info.team_id, \"\"),\n    \"TargetBinarySigningAppID\",\n    iff(isnotempty(event[eventTypeHuman].signing_info.signing_id), event[eventTypeHuman].signing_info.signing_id, \"\"),\n    \"ThreatFilePath\",\n    iff(isnotempty(event[eventTypeHuman].file.path), event[eventTypeHuman].file.path, \"\"),\n    ThreatCategory = \"Malware\",\n    ThreatName = \"User did override Gatekeeper\"\n),\n                        dynamic(null)\n                    )\n// Event Specific - TCC_MODIFY\n| extend TCC_Modify = iif(\n                        eventTypeHuman == \"tcc_modify\",\n                        bag_pack(\n    \"tcc_service\",\n    iff(isnotempty(event[eventTypeHuman].service), event[eventTypeHuman].service, \"\"),\n    \"tcc_identity\",\n    iff(isnotempty(event[eventTypeHuman].identity), event[eventTypeHuman].identity, \"\"),\n    \"tcc_identity_type\",\n    iff(isnotempty(event[eventTypeHuman].identity_type), event[eventTypeHuman].identity_type, \"\"),\n    \"tcc_right\", \n    iff(\n    isnotempty(event[eventTypeHuman].right),\n    case(\n    event[eventTypeHuman].right == 0,\n    \"denied\",\n    event[eventTypeHuman].right == 1,\n    \"unknown\",\n    event[eventTypeHuman].right == 2,\n    \"allowed\",\n    event[eventTypeHuman].right == 3,\n    \"limited\",\n    event[eventTypeHuman].right == 4,\n    \"add_modify_added\",\n    event[eventTypeHuman].right == 5,\n    \"session_pid\",\n    event[eventTypeHuman].right == 6,\n    \"learn_more\",\n    \"Unknown\"\n),\n    \"\" \n),\n    \"tcc_reason\", \n    iff(\n    isnotempty(event[eventTypeHuman].reason),\n    case(\n    event[eventTypeHuman].reason == 0,\n    \"none\",\n    event[eventTypeHuman].reason == 1,\n    \"error\",\n    event[eventTypeHuman].reason == 2,\n    \"user_consent\",\n    event[eventTypeHuman].reason == 3,\n    \"user_set\",\n    event[eventTypeHuman].reason == 4,\n    \"system_set\",\n    event[eventTypeHuman].reason == 5,\n    \"service_policy\",\n    event[eventTypeHuman].reason == 6,\n    \"mdm_policy\",\n    event[eventTypeHuman].reason == 7,\n    \"service_override_policy\",\n    event[eventTypeHuman].reason == 8,\n    \"missing_usage_string\",\n    event[eventTypeHuman].reason == 9,\n    \"prompt_timeout\",\n    event[eventTypeHuman].reason == 10,\n    \"preflight_unknown\",\n    event[eventTypeHuman].reason == 11,\n    \"entitled\",\n    event[eventTypeHuman].reason == 12,\n    \"app_type_policy\",\n    event[eventTypeHuman].reason == 13,\n    \"prompt_cancel\",\n    \"Unknown\"\n),\n    \"\" \n),\n    \"tcc_update_type\", \n    iff(\n    isnotempty(event[eventTypeHuman].update_type),\n    case(\n    event[eventTypeHuman].update_type == 0,\n    \"unknown\",\n    event[eventTypeHuman].update_type == 1,\n    \"create\",\n    event[eventTypeHuman].update_type == 2,\n    \"modify\",\n    event[eventTypeHuman].update_type == 3,\n    \"delete\",\n    \"Unknown\"\n),\n    \"\" \n)\n),\n                            dynamic(null)\n                        )\n// Event Specific - network_connect\n| extend network_connect = iif(\n                        eventTypeHuman == \"network_connect\",\n                        bag_pack(\n    \"tcc_service\",\n    iff(isnotempty(event[eventTypeHuman].service), event[eventTypeHuman].service, \"\"),\n    \"Dst\",\n    iff(isnotempty(event[eventTypeHuman].remote_hostname), event[eventTypeHuman].remote_hostname, \"\"),\n    \"DstIpAddr\",\n    iff(isnotempty(event[eventTypeHuman].remote_endpoint.host), event[eventTypeHuman].remote_endpoint.host, \"\"),\n    \"DstPortNumber\",\n    iff(isnotempty(event[eventTypeHuman].remote_endpoint.port), event[eventTypeHuman].remote_endpoint.port, \"\"),\n    \"SrcIpAddr\",\n    iff(isnotempty(event[eventTypeHuman].local_endpoint.host), event[eventTypeHuman].local_endpoint.host, \"\"),\n    \"SrcPortNumber\",\n    iff(isnotempty(event[eventTypeHuman].local_endpoint.port.host), event[eventTypeHuman].local_endpoint.port.host, \"\"),\n    \"NetworkProtocol\", \n    iff(\n    isnotempty(event[eventTypeHuman].socket_protocol),\n    case(\n    event[eventTypeHuman].socket_protocol == 0,\n    \"icmp\",\n    event[eventTypeHuman].socket_protocol == 6,\n    \"tcp\",\n    event[eventTypeHuman].socket_protocol == 17,\n    \"udp\",\n    event[eventTypeHuman].socket_protocol == 41,\n    \"ip6in4\",\n    event[eventTypeHuman].socket_protocol == 58,\n    \"icmp6\",\n    event[eventTypeHuman].socket_protocol == 255,\n    \"ipproto_raw\",\n    \"Unknown\"\n),\n    \"\" \n),\n    \"network_socket_type\", \n    iff(\n    isnotempty(event[eventTypeHuman].socket_type),\n    case(\n    event[eventTypeHuman].socket_type == 1,\n    \"sock_stream\",\n    event[eventTypeHuman].socket_type == 2,\n    \"sock_dgram\",\n    event[eventTypeHuman].socket_type == 3,\n    \"sock_raw\",\n    event[eventTypeHuman].socket_type == 4,\n    \"sock_rdm\",\n    event[eventTypeHuman].socket_type == 5,\n    \"sock_seqpacket\",\n    event[eventTypeHuman].socket_type == 6,\n    \"service_policy\",\n    \"Unknown\"\n),\n    \"\" \n),\n    \"network_socket_family\", \n    iff(\n    isnotempty(event[eventTypeHuman].socket_family),\n    case(\n    event[eventTypeHuman].socket_family == 1,\n    \"af_unix\",\n    event[eventTypeHuman].socket_family == 2,\n    \"af_inet\",\n    event[eventTypeHuman].socket_family == 30,\n    \"af_inet6\",\n    \"Unknown\"\n),\n    \"\" \n)\n),\n                            dynamic(null)\n                        )\n// Event Specific - pty_grand & pty_close\n| extend pty = iif(\n                        eventTypeHuman in (\"pty_grant\", \"pty_close\"),\n                        bag_pack(\n    \"dev\",\n    iff(isnotempty(event[eventTypeHuman].dev), event[eventTypeHuman].dev, \"\"),\n    \"dev\",\n    iff(isnotempty(event[eventTypeHuman].dev), event[eventTypeHuman].dev, \"\")\n),\n                            dynamic(null)\n                        )\n| project-away\naction,\nevent,\nprocess\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject2')._parserId2,'/'))))]",
              "dependsOn": [
                "[variables('parserObject2')._parserId2]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectTelemetry')]",
                "contentId": "[variables('parserObject2').parserContentId2]",
                "kind": "Parser",
                "version": "[variables('parserObject2').parserVersion2]",
                "source": {
                  "name": "Jamf Protect",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject2').parserContentId2]",
        "contentKind": "Parser",
        "displayName": "Parser for Jamf Protect Telemetry Events",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject2').parserContentId2,'-', '3.3.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject2').parserContentId2,'-', '3.3.0')))]",
        "version": "[variables('parserObject2').parserVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject2')._parserName2]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for Jamf Protect Telemetry Events",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "JamfProtectTelemetry",
        "query": "jamfprotecttelemetryv2_CL\n// Generic Fields\n| extend\n    EventExpanded = tostring(parse_json(event)[strcat_array(bag_keys(event), '.')]),\n    eventTypeHuman = tostring(bag_keys(event)[0])\n| extend EventResult = iif((event[eventTypeHuman]['success'] == true), \"Success\", dynamic(null))\n| extend\n    EventMessage = case(\n                eventTypeHuman == \"authentication\",\n                \"A user authentication happened\",\n                eventTypeHuman == \"authorization_judgement\",\n                \"A process has its rights petition judged\",\n                eventTypeHuman == \"authorization_petition\",\n                \"A process has its rights petition judged\",\n                eventTypeHuman == \"bios_uefi\",\n                \"Collection of bios and firmware data\",\n                eventTypeHuman == \"btm_launch_item_add\",\n                \"Apple's Background Task Manager notified that an item has been added\",\n                eventTypeHuman == \"btm_launch_item_remove\",\n                \"Apple's Background Task Manager notified that an existing item has been removed\",\n                eventTypeHuman == \"chroot\",\n                \"Software has changed its apparent root directory in which it's actively operating out of\",\n                eventTypeHuman == \"cs_invalidated\",\n                \"The system detected that a process has had its code signature marked as invalid\",\n                eventTypeHuman == \"exec\",\n                \"A new process has been executed\",\n                eventTypeHuman == \"kextload\",\n                \"A kernel extension (kext) was loaded\",\n                eventTypeHuman == \"kextunload\",\n                \"A kernel extension (kext) was unloaded\",\n                eventTypeHuman == \"login_login\",\n                \"A user attempted to log in using /usr/bin/login\",\n                eventTypeHuman == \"login_logout\",\n                \"A user logged out from /usr/bin/login\",\n                eventTypeHuman == \"lw_session_lock\",\n                \"A user has locked the screen\",\n                eventTypeHuman == \"lw_session_login\",\n                \"A user has logged in via the Login Window\",\n                eventTypeHuman == \"lw_session_logout\",\n                \"A user has logged out of an active graphical session\",\n                eventTypeHuman == \"lw_session_unlock\",\n                \"A user has unlocked the screen from the Login Window\",\n                eventTypeHuman == \"mount\",\n                \"A file system has been mounted\",\n                eventTypeHuman == \"od_attribute_set\",\n                \"Attribute set on user or group using Open Directory\",\n                eventTypeHuman == \"od_attribute_value_add\",\n                \"Attribute added to a user or group using Open Directory\",\n                eventTypeHuman == \"od_attribute_value_remove\",\n                \"Attribute removed from a user or group using Open Directory\",\n                eventTypeHuman == \"od_create_group\",\n                \"A group has been created using Open Directory\",\n                eventTypeHuman == \"od_create_user\",\n                \"A user has been created using Open Directory\",\n                eventTypeHuman == \"od_delete_group\",\n                \"A group has been deleted using Open Directory\",\n                eventTypeHuman == \"od_delete_user\",\n                \"A user has been deleted using Open Directory\",\n                eventTypeHuman == \"od_disable_user\",\n                \"A user has been disabled using Open Directory\",\n                eventTypeHuman == \"od_enable_user\",\n                \"A user has been enabled using Open Directory\",\n                eventTypeHuman == \"od_group_add\",\n                \"A member has been added to a group using Open Directory\",\n                eventTypeHuman == \"od_group_remove\",\n                \"A member has been removed from a group using Open Directory\",\n                eventTypeHuman == \"od_group_set\",\n                \"A group has a member initialised or replaced using Open Directory\",\n                eventTypeHuman == \"od_modify_password\",\n                \"A user password is modified via Open Directory\",\n                eventTypeHuman == \"openssh_login\",\n                \"A user has logged into the system via OpenSSH\",\n                eventTypeHuman == \"openssh_logout\",\n                \"A user has logged out of an OpenSSH session\",\n                eventTypeHuman == \"performance\",\n                \"Collection of system performance data\",\n                eventTypeHuman == \"profile_add\",\n                \"A configuration profile is installed on the system\",\n                eventTypeHuman == \"profile_remove\",\n                \"A configuration profile is removed from the system\",\n                eventTypeHuman == \"remount\",\n                \"A file system has been mounted\",\n                eventTypeHuman == \"screensharing_attach\",\n                \"A screensharing session has attached to a graphical session\",\n                eventTypeHuman == \"screensharing_detach\",\n                \"A screensharing session has detached from a graphical session\",\n                eventTypeHuman == \"settime\",\n                \"The system time was attempted to be set\",\n                eventTypeHuman == \"su\",\n                \"A user attempts to start a new shell using a substitute user identity\",\n                eventTypeHuman == \"sudo\",\n                \"A sudo attempt occured\",\n                eventTypeHuman == \"unmount\",\n                \"A file system has been mounted\",\n                eventTypeHuman == \"xp_malware_detected\",\n                \"Apple's XProtect detected malware on the system\",\n                eventTypeHuman == \"xp_malware_remediated\",\n                \"Apple's XProtect remediated malware on the system\",\n                eventTypeHuman == \"file_collection\",\n                \"A crash or diagnostic file has been collected\",\n                eventTypeHuman == \"log_collection\",\n                \"Entries from a log file have been collected\",\n                eventTypeHuman == \"gatekeeper_user_override\",\n                \"Gatekeeper controls were overridden\",\n                eventTypeHuman == \"network_connect\",\n                \"A network connection has been established\",\n                eventTypeHuman == \"tcc_modify\",\n                \"A Transparency Consent and Control (TCC) permission is granted or revoked\",\n                eventTypeHuman == \"pty_grant\",\n                \"A pseudoterminal control device is granted\",\n                eventTypeHuman == \"pty_close\",\n                \"A pseudoterminal control device is closed\",\n                \"No reason yet defined for this event\"\n            ),\n    EventType = case(\n                eventTypeHuman == \"authentication\",\n                \"Logon\",\n                eventTypeHuman == \"authorization_judgement\",\n                \"ProcessCreated\",\n                eventTypeHuman == \"authorization_petition\",\n                \"ProcessCreated\",\n                eventTypeHuman == \"bios_uefi\",\n                \"Hardware\",\n                eventTypeHuman == \"btm_launch_item_add\",\n                \"Create\",\n                eventTypeHuman == \"btm_launch_item_remove\",\n                \"Delete\",\n                eventTypeHuman == \"chroot\",\n                \"Set\",\n                eventTypeHuman == \"cs_invalidated\",\n                \"Other\",\n                eventTypeHuman == \"exec\",\n                \"ProcessCreated\",\n                eventTypeHuman == \"kextload\",\n                \"Create\",\n                eventTypeHuman == \"kextunload\",\n                \"Delete\",\n                eventTypeHuman == \"login_login\",\n                \"Logon\",\n                eventTypeHuman == \"login_logout\",\n                \"Logoff\",\n                eventTypeHuman == \"lw_session_lock\",\n                \"Logoff\",\n                eventTypeHuman == \"lw_session_login\",\n                \"Logon\",\n                eventTypeHuman == \"lw_session_logout\",\n                \"Logoff\",\n                eventTypeHuman == \"lw_session_unlock\",\n                \"Logon\",\n                eventTypeHuman == \"mount\",\n                \"FileSystemMounted\",\n                eventTypeHuman == \"od_attribute_set\",\n                \"Set\",\n                eventTypeHuman == \"od_attribute_value_add\",\n                \"Create\",\n                eventTypeHuman == \"od_attribute_value_remove\",\n                \"Delete\",\n                eventTypeHuman == \"od_create_group\",\n                \"GroupCreated\",\n                eventTypeHuman == \"od_create_user\",\n                \"UserCreated\",\n                eventTypeHuman == \"od_delete_group\",\n                \"GroupDeleted\",\n                eventTypeHuman == \"od_delete_user\",\n                \"UserDeleted\",\n                eventTypeHuman == \"od_disable_user\",\n                \"UserDisabled\",\n                eventTypeHuman == \"od_enable_user\",\n                \"UserEnabled\",\n                eventTypeHuman == \"od_group_add\",\n                \"UserAddedToGroup\",\n                eventTypeHuman == \"od_group_remove\",\n                \"UserRemovedFromGroup\",\n                eventTypeHuman == \"od_group_set\",\n                \"GroupModified\",\n                eventTypeHuman == \"od_modify_password\",\n                \"PasswordChanged\",\n                eventTypeHuman == \"openssh_login\",\n                \"Logon\",\n                eventTypeHuman == \"openssh_logout\",\n                \"Logoff\",\n                eventTypeHuman == \"performance\",\n                \"PerformanceData\",\n                eventTypeHuman == \"profile_add\",\n                \"Create\",\n                eventTypeHuman == \"profile_remove\",\n                \"Delete\",\n                eventTypeHuman == \"remount\",\n                \"FileSystemRemounted\",\n                eventTypeHuman == \"screenscharing_attach\",\n                \"Logon\",\n                eventTypeHuman == \"screenscharing_detach\",\n                \"Logoff\",\n                eventTypeHuman == \"settime\",\n                \"Set\",\n                eventTypeHuman == \"su\",\n                \"Elevate\",\n                eventTypeHuman == \"sudo\",\n                \"Elevate\",\n                eventTypeHuman == \"unmount\",\n                \"FileSystemUnmounted\",\n                eventTypeHuman == \"xp_malware_detected\",\n                \"MalwareDetected\",\n                eventTypeHuman == \"xp_malware_remediated\",\n                \"MalwareRemediated\",\n                eventTypeHuman == \"xp_malware_remediated\",\n                \"GatekeeperOverride\",\n                eventTypeHuman == \"network_connect\",\n                \"EndpointNetworkSession\",\n                eventTypeHuman == \"tcc_modify\",\n                \"Set\",\n                eventTypeHuman == \"pty_grant\",\n                \"Other\",\n                eventTypeHuman == \"pty_close\",\n                \"Other\",\n                \"\"\n            ),\n    EventSubType = case(\n                eventTypeHuman == \"authentication\",\n                \"Interactive\",\n                eventTypeHuman == \"btm_launch_item_add\",\n                \"btm\",\n                eventTypeHuman == \"btm_launch_item_remove\",\n                \"btm\",\n                eventTypeHuman == \"chroot\",\n                \"Directory\",\n                eventTypeHuman == \"cs_invalidated\",\n                \"Other\",\n                eventTypeHuman == \"kextload\",\n                \"System Settings\",\n                eventTypeHuman == \"kextunload\",\n                \"System Settings\",\n                eventTypeHuman == \"login_login\",\n                \"Interactive\",\n                eventTypeHuman == \"login_logout\",\n                \"Interactive\",\n                eventTypeHuman == \"lw_session_lock\",\n                \"Interactive\",\n                eventTypeHuman == \"lw_session_login\",\n                \"Interactive\",\n                eventTypeHuman == \"lw_session_logout\",\n                \"Interactive\",\n                eventTypeHuman == \"lw_session_unlock\",\n                \"Interactive\",\n                eventTypeHuman == \"od_attribute_set\",\n                \"Attribute\",\n                eventTypeHuman == \"od_attribute_value_add\",\n                \"Attribute\",\n                eventTypeHuman == \"od_attribute_value_remove\",\n                \"Attribute\",\n                eventTypeHuman == \"openssh_login\",\n                \"Interactive\",\n                eventTypeHuman == \"openssh_logout\",\n                \"Interactive\",\n                eventTypeHuman == \"profile_add\",\n                \"Configuration Profile\",\n                eventTypeHuman == \"profile_remove\",\n                \"Configuration Profile\",\n                eventTypeHuman == \"screenscharing_attach\",\n                \"RemoteInteractive\",\n                eventTypeHuman == \"screenscharing_detach\",\n                \"RemoteInteractive\",\n                eventTypeHuman == \"settime\",\n                \"System Settings\",\n                eventTypeHuman == \"su\",\n                \"Interactive\",\n                eventTypeHuman == \"sudo\",\n                \"Interactive\",\n                eventTypeHuman == \"network_connect\",\n                \"Interactive\",\n                eventTypeHuman == \"tcc_modify\",\n                \"System Settings\",\n                eventTypeHuman == \"pty_grant\",\n                \"Other\",\n                eventTypeHuman == \"pty_close\",\n                \"Other\",\n                \"\"\n            )\n// Jamf Protect Telemetry - Event Process\n| extend eventContext = \n    iif(\n    isnotempty(event[eventTypeHuman]['app']['audit_token']),\n    event[eventTypeHuman]['app'],\n    iif(\n    isnotempty(event[eventTypeHuman]['target']['audit_token']),\n    event[eventTypeHuman]['target'],\n    iif(\n    isnotempty(event[eventTypeHuman]['data']['od']['audit_token']),\n    event[eventTypeHuman]['data']['od'],\n    iif(\n    isnotempty(event[eventTypeHuman]['data']['token']['audit_token']),\n    event[eventTypeHuman]['data']['token'],\n    iif(\n    isnotempty(event[eventTypeHuman]['data']['touchid']['audit_token']),\n    event[eventTypeHuman]['data']['touchid'],\n    iif(\n    isnotempty(event[eventTypeHuman]['instigator']['audit_token']),\n    event[eventTypeHuman]['instigator'],\n    ['process']\n)\n)\n)\n)\n)\n)\n| extend\n    TargetProcessName = tostring(eventContext.executable.path),\n    TargetProcessId = tostring(eventContext.audit_token.pid),\n    TargetProcessGuid = tostring(eventContext.audit_token.uuid),\n    TargetProcessCreationTime = tostring(eventContext.start_time),\n    TargetProcessSHA1 = tostring(eventContext.executable.sha1),\n    TargetProcessSHA256 = tostring(eventContext.executable.sha256),\n    TargetProcessCommandLine = event[eventTypeHuman]['args'],\n    TargetProcessTTY = tostring(eventContext.tty.path),\n    TargetBinarySigningAppID = tostring(eventContext.signing_id),\n    TargetBinarySigningTeamID = tostring(eventContext.team_id),\n    TargetBinaryCDHash = tostring(eventContext.cdhash),\n    TargetBinaryIsESClient = tobool(eventContext.is_es_client),\n    TargetBinaryIsPlatformBinary = tobool(eventContext.is_platform_binary),\n    TargetUserId = tostring(eventContext.audit_token.euid),\n    TargetProcessUsername = tostring(eventContext.audit_token.e_username),\n    ResponsibleProcessId = tostring(eventContext.responsible_audit_token.pid),\n    ResponsibleProcessGuid = tostring(eventContext.responsible_audit_token.uuid),\n    ResponsibleUserId = tostring(eventContext.responsible_audit_token.euid),\n    ResponsibleUsername = tostring(eventContext.responsible_audit_token.e_username),\n    ResponsibleProcessName = tostring(eventContext.responsible_audit_token.exec_path),\n    ParentProcessId = tostring(eventContext.parent_audit_token.pid),\n    ParentProcessGuid = tostring(eventContext.parent_audit_token.uuid),\n    ParentUsername = tostring(eventContext.parent_audit_token.e_username),\n    ParentProcessName = tostring(eventContext.parent_audit_token.exec_path)\n// Jamf Protect Telemetry - Revealing Code Signing flags\n| extend TargetProcessCodesignFlags = \n                                            iif(isnotempty(eventContext.codesigning_flags),\n                                        bag_pack(\n                                        \"CS_VALID\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000001) > 0, true, false),\n                                        \"CS_ADHOC\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000002) > 0, true, false),\n                                        \"CS_GET_TASK_ALLOW\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000004) > 0, true, false),\n                                        \"CS_INSTALLER\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000008) > 0, true, false),\n                                        \"CS_FORCED_LV\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000010) > 0, true, false),\n                                        \"CS_INVALID_ALLOWED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000020) > 0, true, false),\n                                        \"CS_HARD\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000100) > 0, true, false),\n                                        \"CS_KILL\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000200) > 0, true, false),\n                                        \"CS_CHECK_EXPIRATION\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000400) > 0, true, false),\n                                        \"CS_RESTRICT\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00000800) > 0, true, false),\n                                        \"CS_ENFORCEMENT\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00001000) > 0, true, false),\n                                        \"CS_REQUIRE_LV\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00002000) > 0, true, false),\n                                        \"CS_ENTITLEMENTS_VALIDATED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00004000) > 0, true, false),\n                                        \"CS_NVRAM_UNRESTRICTED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00008000) > 0, true, false),\n                                        \"CS_RUNTIME\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00010000) > 0, true, false),\n                                        \"CS_LINKER_SIGNED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x20000) > 0, true, false),\n                                        \"CS_EXEC_SET_HARD\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00100000) > 0, true, false),\n                                        \"CS_EXEC_SET_KILL\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00200000) > 0, true, false),\n                                        \"CS_EXEC_SET_ENFORCEMENT\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00400000) > 0, true, false),\n                                        \"CS_EXEC_INHERIT_SIP\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x00800000) > 0, true, false),\n                                        \"CS_KILLED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x01000000) > 0, true, false),\n                                        \"CS_DYLD_PLATFORM\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x02000000) > 0, true, false),\n                                        \"CS_PLATFORM_BINARY\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x04000000) > 0, true, false),\n                                        \"CS_PLATFORM_PATH\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x08000000) > 0, true, false),\n                                        \"CS_DEBUGGED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x10000000) > 0, true, false),\n                                        \"CS_SIGNED\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x20000000) > 0, true, false),\n                                        \"CS_DEV_CODE\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x40000000) > 0, true, false),\n                                        \"CS_DATAVAULT_CONTROLLER\",\n                                        iff(binary_and(toint(eventContext.codesigning_flags), 0x80000000) > 0, true, false)\n                                    ), \"\")\n// Event Specific - authentication\n| extend TargetUsername =\n    iif(\n    isnotempty(event[eventTypeHuman]['username']),\n    event[eventTypeHuman]['username'],\n    iif(\n    isnotempty(event[eventTypeHuman]['to_username']),\n    event[eventTypeHuman]['to_username'],\n    iif(\n    isnotempty(event[eventTypeHuman]['account_name']),\n    event[eventTypeHuman]['account_name'],\n    iif(\n    isnotempty(event[eventTypeHuman]['user_name']),\n    event[eventTypeHuman]['user_name'],\n    iif(\n    isnotempty(event[eventTypeHuman]['authentication_username']),\n    event[eventTypeHuman]['authentication_username'],\n    \"\"\n)\n)\n)\n)\n)\n// Event Specific - authentication\n| extend ActorUsername = \n    iif(\n    isnotempty(event[eventTypeHuman]['from_username']),\n    event[eventTypeHuman]['from_username'],\n    iif(\n    isnotempty(event[eventTypeHuman]['session_username']),\n    event[eventTypeHuman]['session_username'],\n    \"\"\n)\n)\n| extend Authentication = iif(\n                            eventTypeHuman == \"authentication\",\n                            bag_pack(\n    \"authentication_method\",\n    iff(isnotempty(event[eventTypeHuman].data), tostring(bag_keys(event[eventTypeHuman].data)[0]), \"\")\n),\n                            dynamic(null)\n                        )\n// Event Specific - bios_uefi\n| extend HardwareInformation = iif(\n                            eventTypeHuman == \"bios_uefi\",\n                            bag_pack(\n    \"host_architecture\",\n    iff(isnotempty(event[eventTypeHuman].architecture), event[eventTypeHuman].architecture, \"\"),\n    \"firmware_version\",\n    iff(isnotempty(event[eventTypeHuman].bios.['firmware-version']), event[eventTypeHuman].bios.['firmware-version'], \"\"),\n    \"system_firmware_version\",\n    iff(isnotempty(event[eventTypeHuman].bios.['system-firmware-version']), event[eventTypeHuman].bios.['system-firmware-version'], \"\")\n),\n                            dynamic(null)\n                        )\n// Event Specific - btm_launch_item_add & btm_launch_item_remove\n| extend BtmItem = iif(\n                    eventTypeHuman in (\"btm_launch_item_add\", \"btm_launch_item_remove\"),\n                    bag_pack(\n    \"btm_executable_path\",\n    iff(isnotempty(event[eventTypeHuman].executable_path), event[eventTypeHuman].executable_path, \"\"),\n    \"btm_item_app_url\",\n    iff(isnotempty(event[eventTypeHuman].item.app_url), event[eventTypeHuman].item.app_url, \"\"),\n    \"btm_item_url\",\n    iff(isnotempty(event[eventTypeHuman].item.item_url), event[eventTypeHuman].item.item_url, \"\"),\n    \"btm_item_managed\",\n    iff(isnotempty(event[eventTypeHuman].item.managed), event[eventTypeHuman].item.managed, \"\"),\n    \"btm_item_legacy\",\n    iff(isnotempty(event[eventTypeHuman].item.legacy), event[eventTypeHuman].item.legacy, \"\"),\n    \"btm_item_uid\",\n    iff(isnotempty(event[eventTypeHuman].item.uid), event[eventTypeHuman].item.uid, \"\"),\n    \"btm_item_type\",\n    iff(\n    isnotempty(event[eventTypeHuman].item.item_type),\n    case(\n    event[eventTypeHuman].item.item_type == 0,\n    \"UserItem\",\n    event[eventTypeHuman].item.item_type == 1,\n    \"App\",\n    event[eventTypeHuman].item.item_type == 2,\n    \"LoginItem\",\n    event[eventTypeHuman].item.item_type == 3,\n    \"LaunchAgent\",\n    event[eventTypeHuman].item.item_type == 4,\n    \"LaunchDaemon\",\n    \"Unknown\"\n),\n    \"\"\n)\n),\n                    dynamic(null)\n                )\n// Event Specific - chroot\n| extend Chroot = iif(\n                    eventTypeHuman == \"chroot\",\n                    bag_pack(\n    \"apparent_root_directory\",\n    iff(isnotempty(event[eventTypeHuman].target), event[eventTypeHuman].target.path, \"\"),\n    \"stats\",\n    iff(isnotempty(event[eventTypeHuman].target.stat), event[eventTypeHuman].target.stat, \"\")\n),\n                    dynamic(null)\n                )\n// Event Specific - cs_invalidated\n// Event Specific - exec\n// Event Specific - kextload & kextunload\n| extend KernelExtension = iif(\n                            eventTypeHuman in (\"kextload\", \"kextunload\"),\n                            bag_pack(\n    \"kext_identifier\",\n    iff(isnotempty(event[eventTypeHuman].identifier), event[eventTypeHuman].identifier, \"\")\n),\n                            dynamic(null)\n                        )\n// Event Specific - lw_session_lock & lw_session_unlock & lw_session_login & lw_session_logout\n| extend LoginWindowSession = iif(\n                                eventTypeHuman in (\"lw_session_lock\", \"lw_session_unlock\", \"lw_session_login\", \"lw_session_logout\"),\n                                bag_pack(\n    \"graphical_session_id\",\n    iff(isnotempty(event[eventTypeHuman].graphical_session_id), event[eventTypeHuman].graphical_session_id, \"\")\n),\n                                dynamic(null)\n                            )\n// Event Specific - mount & remount & unmount\n| extend FileSystem = iif(\n                        eventTypeHuman in (\"mount\", \"unmount\", \"remount\"),\n                        bag_pack(\n    \"volume_device_name\",\n    iff(isnotempty(event[eventTypeHuman].statfs.f_mntfromname), event[eventTypeHuman].statfs.f_mntfromname, \"\"),\n    \"volume_mount_name\",\n    iff(isnotempty(event[eventTypeHuman].statfs.f_mntonname), event[eventTypeHuman].statfs.f_mntonname, \"\"),\n    \"volume_file_system_type\",\n    iff(isnotempty(event[eventTypeHuman].statfs.f_fstypename), event[eventTypeHuman].statfs.f_fstypename, \"\"),\n    \"volume_size\",\n    iff(isnotempty(event[eventTypeHuman].statfs.f_bsize), event[eventTypeHuman].statfs.f_bsize, \"\"),\n    \"bus_type\",\n    iff(isnotempty(event[eventTypeHuman].device.bus_name), event[eventTypeHuman].device.bus_name, \"\"),\n    \"product_id\",\n    iff(isnotempty(event[eventTypeHuman].device.product_id), event[eventTypeHuman].device.product_id, \"\"),\n    \"product_name\",\n    iff(isnotempty(event[eventTypeHuman].device.product_name), event[eventTypeHuman].device.product_name, \"\"),\n    \"vendor_id\",\n    iff(isnotempty(event[eventTypeHuman].device.vendor_id), event[eventTypeHuman].device.vendor_id, \"\"),\n    \"vendor_name\",\n    iff(isnotempty(event[eventTypeHuman].device.vendor_name), event[eventTypeHuman].device.vendor_name, \"\"),\n    \"device_type\",\n    iff(isnotempty(event[eventTypeHuman].device.device_type), event[eventTypeHuman].device.device_type, \"\"),\n    \"is_removable\",\n    iff(isnotempty(event[eventTypeHuman].device.is_removable), event[eventTypeHuman].device.is_removable, \"\"),\n    \"is_writable\",\n    iff(isnotempty(event[eventTypeHuman].device.is_writable), event[eventTypeHuman].device.is_writable, \"\"),\n    \"is_encrypted\",\n    iff(isnotempty(event[eventTypeHuman].device.is_encrypted), event[eventTypeHuman].device.is_encrypted, \"\"),\n    \"is_network_volume\",\n    iff(isnotempty(event[eventTypeHuman].device.is_network_volume), event[eventTypeHuman].device.is_network_volume, \"\"),\n    \"serial_number\",\n    iff(isnotempty(event[eventTypeHuman].device.serial_number), event[eventTypeHuman].device.serial_number, \"\"),\n    \"media_name\",\n    iff(isnotempty(event[eventTypeHuman].device.media_name), event[eventTypeHuman].device.media_name, \"\"),\n    \"volume_name\",\n    iff(isnotempty(event[eventTypeHuman].device.volume_name), event[eventTypeHuman].device.volume_name, \"\")\n),\n                        dynamic(null)\n                    )\n// Event Specific - od_attribute_set & od_attribute_value_add & od_attribute_value_remove & od_create_group & od_create_user & od_delete_group & od_delete_user & od_disable_user & od_enable_user\n| extend OpenDirectory = iif(\n                            eventTypeHuman in (\"od_attribute_set\", \"od_attribute_value_add\", \"od_attribute_value_remove\", \"od_create_group\", \"od_create_user\", \"od_delete_group\", \"od_delete_user\", \"od_disable_user\", \"od_enable_user\"),\n                            bag_pack(\n    \"group_name\",\n    iff(isnotempty(event[eventTypeHuman].group_name), event[eventTypeHuman].group_name, \"\"),\n    \"member_array\",\n    iff(isnotempty(event[eventTypeHuman].members.member_array), event[eventTypeHuman].members.member_array, \"\"),\n    \"member_value\",\n    iff(isnotempty(event[eventTypeHuman].member.member_value), event[eventTypeHuman].member.member_value, \"\"),\n    \"user_name\",\n    iff(isnotempty(event[eventTypeHuman].user_name), event[eventTypeHuman].user_name, \"\"),\n    \"account_name\",\n    iff(isnotempty(event[eventTypeHuman].account_name), event[eventTypeHuman].account_name, \"\"),\n    \"db_path\",\n    iff(isnotempty(event[eventTypeHuman].db_path), event[eventTypeHuman].db_path, \"\"),\n    \"record_name\",\n    iff(isnotempty(event[eventTypeHuman].record_name), event[eventTypeHuman].record_name, \"\"),\n    \"attribute_name\",\n    iff(isnotempty(event[eventTypeHuman].attribute_name), event[eventTypeHuman].attribute_name, \"\"),\n    \"attribute_value\",\n    iff(isnotempty(event[eventTypeHuman].attribute_value), event[eventTypeHuman].attribute_value, \"\"),\n    \"node_name\",\n    iff(isnotempty(event[eventTypeHuman].node_name), event[eventTypeHuman].node_name, \"\")\n),\n                            dynamic(null)\n                        )\n// Event Specific - openssh_login & openssh_logout\n| extend SSHContext = iif(\n                        eventTypeHuman in (\"openssh_login\", \"openssh_logout\"),\n                        bag_pack(\n    \"source_address_type\", \n    iff(\n    isnotempty(event[eventTypeHuman].source_address_type),\n    case(\n    event[eventTypeHuman].source_address_type == 0,\n    \"Unknown\",\n    event[eventTypeHuman].source_address_type == 1,\n    \"IPv4\",\n    event[eventTypeHuman].source_address_type == 2,\n    \"IPv6\",\n    event[eventTypeHuman].source_address_type == 3,\n    \"UNIX Socket\",\n    \"Unknown\"\n),\n    \"\" \n),\n    \"result_type\", \n    iff(\n    isnotempty(event[eventTypeHuman].result_type),\n    case(\n    event[eventTypeHuman].result_type == 0,\n    \"Exceeded maximum attempts\",\n    event[eventTypeHuman].result_type == 1,\n    \"Denied by root\",\n    event[eventTypeHuman].result_type == 2,\n    \"Success\",\n    event[eventTypeHuman].result_type == 3,\n    \"No reason\",\n    event[eventTypeHuman].result_type == 4,\n    \"Password\",\n    event[eventTypeHuman].result_type == 5,\n    \"kbdint\",\n    event[eventTypeHuman].result_type == 6,\n    \"Public key\",\n    event[eventTypeHuman].result_type == 7,\n    \"Host based\",\n    event[eventTypeHuman].result_type == 8,\n    \"GSS API\",\n    event[eventTypeHuman].result_type == 9,\n    \"Invalid user\",\n    \"Unknown\"\n),\n    \"\" \n)\n),\n                        dynamic(null)  \n                    )\n// Event Specific - performance\n// Event Specific - profile_add & profile_remove\n| extend Profile = iif(\n                    eventTypeHuman in (\"profile_add\", \"profile_remove\"),\n                    bag_pack(\n    \"profile_scope\",\n    iff(isnotempty(event[eventTypeHuman].profile.scope), event[eventTypeHuman].profile.scope, \"\"),\n    \"profile_identifier\",\n    iff(isnotempty(event[eventTypeHuman].profile.identifier), event[eventTypeHuman].profile.identifiery, \"\"),\n    \"profile_uuid\",\n    iff(isnotempty(event[eventTypeHuman].profile.uuid), event[eventTypeHuman].profile.uuid, \"\"),\n    \"profile_display_name\",\n    iff(isnotempty(event[eventTypeHuman].profile.display_name), event[eventTypeHuman].profile.display_name, \"\"),\n    \"profile_organization\",\n    iff(isnotempty(event[eventTypeHuman].profile.organization), event[eventTypeHuman].profile.organization, \"\"),\n    \"profile_is_updated\",\n    iff(isnotempty(event[eventTypeHuman].is_update), event[eventTypeHuman].is_update, \"\"),\n    \"profile_install_source\", \n    iff(\n    isnotempty(event[eventTypeHuman].profile.install_source),\n    case(\n    event[eventTypeHuman].profile.install_source == 0,\n    \"mdm\",\n    event[eventTypeHuman].profile.install_source == 1,\n    \"manual\",\n    \"Unknown\"\n),\n    \"\" \n)\n),\n                    dynamic(null)\n                )\n// Event Specific - screenscharing_attach & screensharing_detach\n| extend Screensharing = iif(\n                            eventTypeHuman in (\"screensharing_attach\", \"screensharing_detach\"),\n                            bag_pack(\n    \"existing_session\",\n    iff(isnotempty(event[eventTypeHuman].existing_session), event[eventTypeHuman].existing_session, \"\"),\n    \"graphical_session_id\",\n    iff(isnotempty(event[eventTypeHuman].graphical_authentication_username), event[eventTypeHuman].graphical_authentication_username, \"\"),\n    \"session_username\",\n    iff(isnotempty(event[eventTypeHuman].session_username), event[eventTypeHuman].session_username, \"\"),\n    \"viewer_appleid\",\n    iff(isnotempty(event[eventTypeHuman].viewer_appleid), event[eventTypeHuman].viewer_appleid, \"\"),\n    \"authentication_type\",\n    iff(isnotempty(event[eventTypeHuman].authentication_type), event[eventTypeHuman].authentication_type, \"\"),\n    \"source_address\",\n    iff(isnotempty(event[eventTypeHuman].source_address), event[eventTypeHuman].source_address, \"\"),\n    \"source_address_type\", \n    iff(\n    isnotempty(event[eventTypeHuman].source_address_type),\n    case(\n    event[eventTypeHuman].source_address_type == 0,\n    \"Unknown\",\n    event[eventTypeHuman].source_address_type == 1,\n    \"IPv4\",\n    event[eventTypeHuman].source_address_type == 2,\n    \"IPv6\",\n    event[eventTypeHuman].source_address_type == 3,\n    \"UNIX Socket\",\n    \"Unknown\"\n),\n    \"\" \n)\n),\n                            dynamic(null)\n                        )\n// Event Specific - su\n| extend Su = iif(\n                eventTypeHuman == \"su\",\n                bag_pack(\n    \"username\",\n    iff(isnotempty(event[eventTypeHuman].username), event[eventTypeHuman].username, \"\"),\n    \"uid\",\n    iff(isnotempty(event[eventTypeHuman].uid), event[eventTypeHuman].uid, \"\"),\n    \"args\",\n    iff(isnotempty(event[eventTypeHuman].argv), event[eventTypeHuman].argv, \"\"),\n    \"env_vars\",\n    iff(isnotempty(event[eventTypeHuman].env), event[eventTypeHuman].env, \"\"),\n    \"env_count\",\n    iff(isnotempty(event[eventTypeHuman].env_count), event[eventTypeHuman].env_count, \"\"),\n    \"from_username\",\n    iff(isnotempty(event[eventTypeHuman].from_username), event[eventTypeHuman].from_username, \"\"),\n    \"to_username\",\n    iff(isnotempty(event[eventTypeHuman].to_username), event[eventTypeHuman].to_username, \"\"),\n    \"failure_message\",\n    iff(isnotempty(event[eventTypeHuman].failure_reason), event[eventTypeHuman].failure_reason, \"\")\n),\n                dynamic(null)\n            )\n// Event Specific - sudo\n| extend Sudo = iif(\n                    eventTypeHuman == \"sudo\",\n                    bag_pack(\n    \"TargetProcessCommandLine\",\n    iff(isnotempty(event[eventTypeHuman].command), event[eventTypeHuman].command, \"\"),\n    \"attribute_name\",\n    iff(isnotempty(event[eventTypeHuman].attribute_name), event[eventTypeHuman].attribute_name, \"\"),\n    \"attribute_value\",\n    iff(isnotempty(event[eventTypeHuman].attribute_value), event[eventTypeHuman].attribute_value, \"\")\n),\n                    dynamic(null)\n                )\n// Event Specific - xp_malware_detected & xp_malware_remediated\n| extend Xprotect = iif(\n                        eventTypeHuman in (\"xp_malware_detected\", \"xp_malware_remediated\"),\n                        bag_pack(\n    \"detected_path\",\n    iff(isnotempty(event[eventTypeHuman].detected_path), event[eventTypeHuman].detected_path, \"\"),\n    \"remediated_path\",\n    iff(isnotempty(event[eventTypeHuman].remediated_path), event[eventTypeHuman].remediated_path, \"\"),\n    \"malware_identifier\",\n    iff(isnotempty(event[eventTypeHuman].malware_identifier), event[eventTypeHuman].malware_identifier, \"\"),\n    \"signature_version\",\n    iff(isnotempty(event[eventTypeHuman].signature_version), event[eventTypeHuman].signature_version, \"\")\n),\n                        dynamic(null)\n                    )\n// Event Specific - gatekeeper_user_override\n| extend GatekeeperOverride = iif(\n                        eventTypeHuman == \"gatekeeper_user_override\",\n                        bag_pack(\n    \"TargetFilePath\",\n    iff(isnotempty(event[eventTypeHuman].file.path), event[eventTypeHuman].file.path, \"\"),\n    \"TargetFileSize\",\n    iff(isnotempty(event[eventTypeHuman].file.stat.st_size), event[eventTypeHuman].file.stat.st_size, \"\"),\n    \"TargetFileCreationTime\",\n    iff(isnotempty(event[eventTypeHuman].file.stat.st_birthtimespec), event[eventTypeHuman].file.stat.st_birthtimespec, \"\"),\n    \"TargetFileAccessedTime\",\n    iff(isnotempty(event[eventTypeHuman].file.stat.st_atimespec), event[eventTypeHuman].file.stat.st_atimespec, \"\"),\n    \"ActorUserId\",\n    iff(isnotempty(event[eventTypeHuman].file.stat.st_uid), event[eventTypeHuman].file.stat.st_uid, \"\"),\n    \"GroupId\",\n    iff(isnotempty(event[eventTypeHuman].file.stat.st_gid), event[eventTypeHuman].file.stat.st_gid, \"\"),\n    \"TargetFileSHA256\",\n    iff(isnotempty(event[eventTypeHuman].sha256), event[eventTypeHuman].sha256, \"\"),\n    \"TargetFileCdHash\",\n    iff(isnotempty(event[eventTypeHuman].signing_info.cdhash), event[eventTypeHuman].signing_info.cdhash, \"\"),\n    \"TargetBinarySigningTeamID\",\n    iff(isnotempty(event[eventTypeHuman].signing_info.team_id), event[eventTypeHuman].signing_info.team_id, \"\"),\n    \"TargetBinarySigningAppID\",\n    iff(isnotempty(event[eventTypeHuman].signing_info.signing_id), event[eventTypeHuman].signing_info.signing_id, \"\"),\n    \"ThreatFilePath\",\n    iff(isnotempty(event[eventTypeHuman].file.path), event[eventTypeHuman].file.path, \"\"),\n    ThreatCategory = \"Malware\",\n    ThreatName = \"User did override Gatekeeper\"\n),\n                        dynamic(null)\n                    )\n// Event Specific - TCC_MODIFY\n| extend TCC_Modify = iif(\n                        eventTypeHuman == \"tcc_modify\",\n                        bag_pack(\n    \"tcc_service\",\n    iff(isnotempty(event[eventTypeHuman].service), event[eventTypeHuman].service, \"\"),\n    \"tcc_identity\",\n    iff(isnotempty(event[eventTypeHuman].identity), event[eventTypeHuman].identity, \"\"),\n    \"tcc_identity_type\",\n    iff(isnotempty(event[eventTypeHuman].identity_type), event[eventTypeHuman].identity_type, \"\"),\n    \"tcc_right\", \n    iff(\n    isnotempty(event[eventTypeHuman].right),\n    case(\n    event[eventTypeHuman].right == 0,\n    \"denied\",\n    event[eventTypeHuman].right == 1,\n    \"unknown\",\n    event[eventTypeHuman].right == 2,\n    \"allowed\",\n    event[eventTypeHuman].right == 3,\n    \"limited\",\n    event[eventTypeHuman].right == 4,\n    \"add_modify_added\",\n    event[eventTypeHuman].right == 5,\n    \"session_pid\",\n    event[eventTypeHuman].right == 6,\n    \"learn_more\",\n    \"Unknown\"\n),\n    \"\" \n),\n    \"tcc_reason\", \n    iff(\n    isnotempty(event[eventTypeHuman].reason),\n    case(\n    event[eventTypeHuman].reason == 0,\n    \"none\",\n    event[eventTypeHuman].reason == 1,\n    \"error\",\n    event[eventTypeHuman].reason == 2,\n    \"user_consent\",\n    event[eventTypeHuman].reason == 3,\n    \"user_set\",\n    event[eventTypeHuman].reason == 4,\n    \"system_set\",\n    event[eventTypeHuman].reason == 5,\n    \"service_policy\",\n    event[eventTypeHuman].reason == 6,\n    \"mdm_policy\",\n    event[eventTypeHuman].reason == 7,\n    \"service_override_policy\",\n    event[eventTypeHuman].reason == 8,\n    \"missing_usage_string\",\n    event[eventTypeHuman].reason == 9,\n    \"prompt_timeout\",\n    event[eventTypeHuman].reason == 10,\n    \"preflight_unknown\",\n    event[eventTypeHuman].reason == 11,\n    \"entitled\",\n    event[eventTypeHuman].reason == 12,\n    \"app_type_policy\",\n    event[eventTypeHuman].reason == 13,\n    \"prompt_cancel\",\n    \"Unknown\"\n),\n    \"\" \n),\n    \"tcc_update_type\", \n    iff(\n    isnotempty(event[eventTypeHuman].update_type),\n    case(\n    event[eventTypeHuman].update_type == 0,\n    \"unknown\",\n    event[eventTypeHuman].update_type == 1,\n    \"create\",\n    event[eventTypeHuman].update_type == 2,\n    \"modify\",\n    event[eventTypeHuman].update_type == 3,\n    \"delete\",\n    \"Unknown\"\n),\n    \"\" \n)\n),\n                            dynamic(null)\n                        )\n// Event Specific - network_connect\n| extend network_connect = iif(\n                        eventTypeHuman == \"network_connect\",\n                        bag_pack(\n    \"tcc_service\",\n    iff(isnotempty(event[eventTypeHuman].service), event[eventTypeHuman].service, \"\"),\n    \"Dst\",\n    iff(isnotempty(event[eventTypeHuman].remote_hostname), event[eventTypeHuman].remote_hostname, \"\"),\n    \"DstIpAddr\",\n    iff(isnotempty(event[eventTypeHuman].remote_endpoint.host), event[eventTypeHuman].remote_endpoint.host, \"\"),\n    \"DstPortNumber\",\n    iff(isnotempty(event[eventTypeHuman].remote_endpoint.port), event[eventTypeHuman].remote_endpoint.port, \"\"),\n    \"SrcIpAddr\",\n    iff(isnotempty(event[eventTypeHuman].local_endpoint.host), event[eventTypeHuman].local_endpoint.host, \"\"),\n    \"SrcPortNumber\",\n    iff(isnotempty(event[eventTypeHuman].local_endpoint.port.host), event[eventTypeHuman].local_endpoint.port.host, \"\"),\n    \"NetworkProtocol\", \n    iff(\n    isnotempty(event[eventTypeHuman].socket_protocol),\n    case(\n    event[eventTypeHuman].socket_protocol == 0,\n    \"icmp\",\n    event[eventTypeHuman].socket_protocol == 6,\n    \"tcp\",\n    event[eventTypeHuman].socket_protocol == 17,\n    \"udp\",\n    event[eventTypeHuman].socket_protocol == 41,\n    \"ip6in4\",\n    event[eventTypeHuman].socket_protocol == 58,\n    \"icmp6\",\n    event[eventTypeHuman].socket_protocol == 255,\n    \"ipproto_raw\",\n    \"Unknown\"\n),\n    \"\" \n),\n    \"network_socket_type\", \n    iff(\n    isnotempty(event[eventTypeHuman].socket_type),\n    case(\n    event[eventTypeHuman].socket_type == 1,\n    \"sock_stream\",\n    event[eventTypeHuman].socket_type == 2,\n    \"sock_dgram\",\n    event[eventTypeHuman].socket_type == 3,\n    \"sock_raw\",\n    event[eventTypeHuman].socket_type == 4,\n    \"sock_rdm\",\n    event[eventTypeHuman].socket_type == 5,\n    \"sock_seqpacket\",\n    event[eventTypeHuman].socket_type == 6,\n    \"service_policy\",\n    \"Unknown\"\n),\n    \"\" \n),\n    \"network_socket_family\", \n    iff(\n    isnotempty(event[eventTypeHuman].socket_family),\n    case(\n    event[eventTypeHuman].socket_family == 1,\n    \"af_unix\",\n    event[eventTypeHuman].socket_family == 2,\n    \"af_inet\",\n    event[eventTypeHuman].socket_family == 30,\n    \"af_inet6\",\n    \"Unknown\"\n),\n    \"\" \n)\n),\n                            dynamic(null)\n                        )\n// Event Specific - pty_grand & pty_close\n| extend pty = iif(\n                        eventTypeHuman in (\"pty_grant\", \"pty_close\"),\n                        bag_pack(\n    \"dev\",\n    iff(isnotempty(event[eventTypeHuman].dev), event[eventTypeHuman].dev, \"\"),\n    \"dev\",\n    iff(isnotempty(event[eventTypeHuman].dev), event[eventTypeHuman].dev, \"\")\n),\n                            dynamic(null)\n                        )\n| project-away\naction,\nevent,\nprocess\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject2')._parserId2,'/'))))]",
      "dependsOn": [
        "[variables('parserObject2')._parserId2]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectTelemetry')]",
        "contentId": "[variables('parserObject2').parserContentId2]",
        "kind": "Parser",
        "version": "[variables('parserObject2').parserVersion2]",
        "source": {
          "kind": "Solution",
          "name": "Jamf Protect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Thijs Xhaflaire",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Jamf Software, LLC",
          "email": "support@jamf.com",
          "tier": "Partner",
          "link": "https://www.jamf.com/support/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject3').parserTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtectUnifiedLogs Data Parser with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject3').parserVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject3')._parserName3]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for Jamf Protect Unified Log Events",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "JamfProtectUnifiedLogs",
                "query": "jamfprotectunifiedlogs_CL\n| extend EventStartTime = unixtime_seconds_todatetime(tolong(input.match.event.timestamp))\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject3')._parserId3,'/'))))]",
              "dependsOn": [
                "[variables('parserObject3')._parserId3]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectUnifiedLogs')]",
                "contentId": "[variables('parserObject3').parserContentId3]",
                "kind": "Parser",
                "version": "[variables('parserObject3').parserVersion3]",
                "source": {
                  "name": "Jamf Protect",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject3').parserContentId3]",
        "contentKind": "Parser",
        "displayName": "Parser for Jamf Protect Unified Log Events",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject3').parserContentId3,'-', '3.3.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject3').parserContentId3,'-', '3.3.0')))]",
        "version": "[variables('parserObject3').parserVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject3')._parserName3]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for Jamf Protect Unified Log Events",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "JamfProtectUnifiedLogs",
        "query": "jamfprotectunifiedlogs_CL\n| extend EventStartTime = unixtime_seconds_todatetime(tolong(input.match.event.timestamp))\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject3')._parserId3,'/'))))]",
      "dependsOn": [
        "[variables('parserObject3')._parserId3]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectUnifiedLogs')]",
        "contentId": "[variables('parserObject3').parserContentId3]",
        "kind": "Parser",
        "version": "[variables('parserObject3').parserVersion3]",
        "source": {
          "kind": "Solution",
          "name": "Jamf Protect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Thijs Xhaflaire",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Jamf Software, LLC",
          "email": "support@jamf.com",
          "tier": "Partner",
          "link": "https://www.jamf.com/support/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject4').parserTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtectNetworkTraffic Data Parser with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject4').parserVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject4')._parserName4]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for Jamf Protect Security Cloud Network Traffic Events",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "JamfProtectNetworkTraffic",
                "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Network Traffic Stream\"\n// ASIM - Common Fields\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Network Traffic Stream'\n| project-rename\n| extend\n    // Jamf Protect - Common Fields\n    EventType = \"query\",\n    EventSubType = \"request\",\n    EventStartTime = unixtime_milliseconds_todatetime(tolong(event_receiptTime_d)),\n    EventResult = case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Prevented\", ''),\n    // Jamf Protect - Source User\n    SrcUsermail=column_ifexists('event_user_email_s', ''),\n    SrcUsername =  column_ifexists('event_user_name_s', ''),\n    // Jamf Protect - Source Device Hostnames\n    DvcHostname = case(isnotempty(input_host_hostname_s), input_host_hostname_s, isnotempty(host_info_host_name_s), host_info_host_name_s, event_device_userDeviceName_s),\n    DvcIpAddr = column_ifexists(\"event_source_ip_s\", \"\"),\n    DvcId = column_ifexists(\"event_device_externalId_g\", \"\"),\n    DvcOs = case(event_device_osType_s == \"MAC_OS\", \"macOS\", event_device_osType_s == \"IOS\", \"iOS\", event_device_osType_s == \"ANDROID\", \"Android\", \"Other\"),\n    SrcDeviceType = case(event_device_osType_s == \"MAC_OS\", \"Computer\", event_device_osType_s == \"IOS\", \"Mobile Device\", event_device_osType_s == \"ANDROID\", \"Mobile Device\", \"Other\"),\n    // Jamf Protect - DNS Specific\n    DnsQuery = column_ifexists('event_hostName_s', ''),\n    DvcAction = case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Blocked\", ''),\n    DnsQueryName = column_ifexists('event_domain_s', ''),\n    DstIpAddr = column_ifexists('event_destination_ips_s', ''),\n    ThreatCategory = column_ifexists('event_eventType_description_s', ''),\n    DnsQueryTypeName = column_ifexists('event_dns_recordType_s', ''),\n    DnsResponseName = column_ifexists('event_dns_responseStatus_s', ''),\n    ThreatOriginalRiskLevel = column_ifexists('event_threat_result_s', '')\n| project-keep\n    TimeGenerated,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventSubType,\n    EventStartTime,\n    EventResult,\n    DvcHostname,\n    DvcIpAddr,\n    DvcId,\n    DvcOs,\n    SrcDeviceType,\n    SrcUsermail,\n    SrcUsername,\n    DnsQuery,\n    DnsQueryName,\n    DstIpAddr,\n    DnsQueryTypeName,\n    DvcAction,\n    DnsResponseName,\n    ThreatOriginalRiskLevel\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject4')._parserId4,'/'))))]",
              "dependsOn": [
                "[variables('parserObject4')._parserId4]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectNetworkTraffic')]",
                "contentId": "[variables('parserObject4').parserContentId4]",
                "kind": "Parser",
                "version": "[variables('parserObject4').parserVersion4]",
                "source": {
                  "name": "Jamf Protect",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject4').parserContentId4]",
        "contentKind": "Parser",
        "displayName": "Parser for Jamf Protect Security Cloud Network Traffic Events",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject4').parserContentId4,'-', '3.3.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject4').parserContentId4,'-', '3.3.0')))]",
        "version": "[variables('parserObject4').parserVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject4')._parserName4]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for Jamf Protect Security Cloud Network Traffic Events",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "JamfProtectNetworkTraffic",
        "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Network Traffic Stream\"\n// ASIM - Common Fields\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Network Traffic Stream'\n| project-rename\n| extend\n    // Jamf Protect - Common Fields\n    EventType = \"query\",\n    EventSubType = \"request\",\n    EventStartTime = unixtime_milliseconds_todatetime(tolong(event_receiptTime_d)),\n    EventResult = case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Prevented\", ''),\n    // Jamf Protect - Source User\n    SrcUsermail=column_ifexists('event_user_email_s', ''),\n    SrcUsername =  column_ifexists('event_user_name_s', ''),\n    // Jamf Protect - Source Device Hostnames\n    DvcHostname = case(isnotempty(input_host_hostname_s), input_host_hostname_s, isnotempty(host_info_host_name_s), host_info_host_name_s, event_device_userDeviceName_s),\n    DvcIpAddr = column_ifexists(\"event_source_ip_s\", \"\"),\n    DvcId = column_ifexists(\"event_device_externalId_g\", \"\"),\n    DvcOs = case(event_device_osType_s == \"MAC_OS\", \"macOS\", event_device_osType_s == \"IOS\", \"iOS\", event_device_osType_s == \"ANDROID\", \"Android\", \"Other\"),\n    SrcDeviceType = case(event_device_osType_s == \"MAC_OS\", \"Computer\", event_device_osType_s == \"IOS\", \"Mobile Device\", event_device_osType_s == \"ANDROID\", \"Mobile Device\", \"Other\"),\n    // Jamf Protect - DNS Specific\n    DnsQuery = column_ifexists('event_hostName_s', ''),\n    DvcAction = case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Blocked\", ''),\n    DnsQueryName = column_ifexists('event_domain_s', ''),\n    DstIpAddr = column_ifexists('event_destination_ips_s', ''),\n    ThreatCategory = column_ifexists('event_eventType_description_s', ''),\n    DnsQueryTypeName = column_ifexists('event_dns_recordType_s', ''),\n    DnsResponseName = column_ifexists('event_dns_responseStatus_s', ''),\n    ThreatOriginalRiskLevel = column_ifexists('event_threat_result_s', '')\n| project-keep\n    TimeGenerated,\n    EventVendor,\n    EventProduct,\n    EventType,\n    EventSubType,\n    EventStartTime,\n    EventResult,\n    DvcHostname,\n    DvcIpAddr,\n    DvcId,\n    DvcOs,\n    SrcDeviceType,\n    SrcUsermail,\n    SrcUsername,\n    DnsQuery,\n    DnsQueryName,\n    DstIpAddr,\n    DnsQueryTypeName,\n    DvcAction,\n    DnsResponseName,\n    ThreatOriginalRiskLevel\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject4')._parserId4,'/'))))]",
      "dependsOn": [
        "[variables('parserObject4')._parserId4]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectNetworkTraffic')]",
        "contentId": "[variables('parserObject4').parserContentId4]",
        "kind": "Parser",
        "version": "[variables('parserObject4').parserVersion4]",
        "source": {
          "kind": "Solution",
          "name": "Jamf Protect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Thijs Xhaflaire",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Jamf Software, LLC",
          "email": "support@jamf.com",
          "tier": "Partner",
          "link": "https://www.jamf.com/support/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject5').parserTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtectThreatEvents Data Parser with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject5').parserVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject5')._parserName5]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for Jamf Protect Security Cloud Threat Events",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "JamfProtectThreatEvents",
                "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\"\n// ASIM - Common Fields\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Threat Events Stream'\n| project-rename\n| extend\n    // Jamf Protect - Common Fields\n    EventStartTime = column_ifexists(\"event_timestamp_t\", \"\"),\n    EventResult=case(event_action_s == \"Blocked\", \"Blocked\", event_action_s == \"Detected\", \"Detected\", ''),\n    EventReportUrl = column_ifexists(\"event_eventUrl_s\", \"\"),\n    // Jamf Protect - Alert Details\n    EventSeverity = case(event_severity_d == 2, \"Informational\", event_severity_d == 4, \"Low\", event_severity_d == 6, \"Medium\", event_severity_d == 8, \"High\", event_severity_d == 10, \"High\", \"Informational\"),\n    // Jamf Protect - Source User\n    SrcUsermail=column_ifexists('event_user_email_s', ''),\n    SrcUsername=column_ifexists('event_user_name_s', ''),\n    // Jamf Protect - Source Device Hostnames\n    DvcHostname = column_ifexists(\"event_device_userDeviceName_s\", \"\"),\n    DvcIpAddr = column_ifexists(\"event_source_ip_s\", \"\"),\n    DvcId = column_ifexists(\"event_device_externalId_g\", \"\"),\n    DvcOs=case(event_device_os_s has \"MAC_OS\", \"macOS\", event_device_os_s has \"IOS\", \"iOS\", event_device_os_s has \"ANDROID\", \"Android\", \"Other\"),\n    SrcDeviceType=case(event_device_os_s has \"MAC_OS\", \"Computer\", event_device_os_s has \"IOS\", \"Mobile Device\", event_device_os_s has \"ANDROID\", \"Mobile Device\", \"Other\"),\n    // Jamf Protect - DNS Specific\n    DnsQuery=column_ifexists('event_hostName_s', ''),\n    DvcAction=case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Blocked\", ''),\n    DnsQueryName=column_ifexists('event_destination_name_s', ''),\n    DstIpAddr=column_ifexists('event_destination_ip_s', ''),\n    ThreatCategory=column_ifexists('event_eventType_description_s', ''),\n    ThreatOriginalRiskLevel=column_ifexists('event_threat_result_s', ''),\n    // Jamf Protect - App Specific\n    TargetFileName = column_ifexists(\"event_app_name_s\", \"\"),\n    TargetFileSHA1 = column_ifexists(\"event_app_sha1_s\", \"\"),\n    TargetFileSHA256 = column_ifexists(\"event_app_sha256_s\", \"\")\n| project-keep\n    TimeGenerated,\n    EventVendor,\n    EventProduct,\n    EventStartTime,\n    EventResult,\n    EventReportUrl,\n    EventSeverity,\n    DvcHostname,\n    DvcIpAddr,\n    DvcId,\n    SrcDeviceType,\n    SrcUsermail,\n    SrcUsername,\n    DnsQuery,\n    DnsQueryName,\n    DstIpAddr,\n    ThreatCategory,\n    DvcAction,\n    ThreatOriginalRiskLevel,\n    TargetFileName,\n    TargetFileSHA1,\n    TargetFileSHA256\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject5')._parserId5,'/'))))]",
              "dependsOn": [
                "[variables('parserObject5')._parserId5]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectThreatEvents')]",
                "contentId": "[variables('parserObject5').parserContentId5]",
                "kind": "Parser",
                "version": "[variables('parserObject5').parserVersion5]",
                "source": {
                  "name": "Jamf Protect",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject5').parserContentId5]",
        "contentKind": "Parser",
        "displayName": "Parser for Jamf Protect Security Cloud Threat Events",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject5').parserContentId5,'-', '3.3.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject5').parserContentId5,'-', '3.3.0')))]",
        "version": "[variables('parserObject5').parserVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject5')._parserName5]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for Jamf Protect Security Cloud Threat Events",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "JamfProtectThreatEvents",
        "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\"\n// ASIM - Common Fields\n| extend EventVendor = 'Jamf'\n| extend EventProduct = 'Jamf Protect - Threat Events Stream'\n| project-rename\n| extend\n    // Jamf Protect - Common Fields\n    EventStartTime = column_ifexists(\"event_timestamp_t\", \"\"),\n    EventResult=case(event_action_s == \"Blocked\", \"Blocked\", event_action_s == \"Detected\", \"Detected\", ''),\n    EventReportUrl = column_ifexists(\"event_eventUrl_s\", \"\"),\n    // Jamf Protect - Alert Details\n    EventSeverity = case(event_severity_d == 2, \"Informational\", event_severity_d == 4, \"Low\", event_severity_d == 6, \"Medium\", event_severity_d == 8, \"High\", event_severity_d == 10, \"High\", \"Informational\"),\n    // Jamf Protect - Source User\n    SrcUsermail=column_ifexists('event_user_email_s', ''),\n    SrcUsername=column_ifexists('event_user_name_s', ''),\n    // Jamf Protect - Source Device Hostnames\n    DvcHostname = column_ifexists(\"event_device_userDeviceName_s\", \"\"),\n    DvcIpAddr = column_ifexists(\"event_source_ip_s\", \"\"),\n    DvcId = column_ifexists(\"event_device_externalId_g\", \"\"),\n    DvcOs=case(event_device_os_s has \"MAC_OS\", \"macOS\", event_device_os_s has \"IOS\", \"iOS\", event_device_os_s has \"ANDROID\", \"Android\", \"Other\"),\n    SrcDeviceType=case(event_device_os_s has \"MAC_OS\", \"Computer\", event_device_os_s has \"IOS\", \"Mobile Device\", event_device_os_s has \"ANDROID\", \"Mobile Device\", \"Other\"),\n    // Jamf Protect - DNS Specific\n    DnsQuery=column_ifexists('event_hostName_s', ''),\n    DvcAction=case(event_blocked_b == \"false\", \"Allowed\", event_blocked_b == \"true\", \"Blocked\", ''),\n    DnsQueryName=column_ifexists('event_destination_name_s', ''),\n    DstIpAddr=column_ifexists('event_destination_ip_s', ''),\n    ThreatCategory=column_ifexists('event_eventType_description_s', ''),\n    ThreatOriginalRiskLevel=column_ifexists('event_threat_result_s', ''),\n    // Jamf Protect - App Specific\n    TargetFileName = column_ifexists(\"event_app_name_s\", \"\"),\n    TargetFileSHA1 = column_ifexists(\"event_app_sha1_s\", \"\"),\n    TargetFileSHA256 = column_ifexists(\"event_app_sha256_s\", \"\")\n| project-keep\n    TimeGenerated,\n    EventVendor,\n    EventProduct,\n    EventStartTime,\n    EventResult,\n    EventReportUrl,\n    EventSeverity,\n    DvcHostname,\n    DvcIpAddr,\n    DvcId,\n    SrcDeviceType,\n    SrcUsermail,\n    SrcUsername,\n    DnsQuery,\n    DnsQueryName,\n    DstIpAddr,\n    ThreatCategory,\n    DvcAction,\n    ThreatOriginalRiskLevel,\n    TargetFileName,\n    TargetFileSHA1,\n    TargetFileSHA256\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject5')._parserId5,'/'))))]",
      "dependsOn": [
        "[variables('parserObject5')._parserId5]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JamfProtectThreatEvents')]",
        "contentId": "[variables('parserObject5').parserContentId5]",
        "kind": "Parser",
        "version": "[variables('parserObject5').parserVersion5]",
        "source": {
          "kind": "Solution",
          "name": "Jamf Protect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Thijs Xhaflaire",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Jamf Software, LLC",
          "email": "support@jamf.com",
          "tier": "Partner",
          "link": "https://www.jamf.com/support/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtectDashboard Workbook with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "This Jamf Protect Workbook for Microsoft Sentinel enables you to ingest Jamf Protect events forwarded into Microsoft Sentinel.\n Providing reports into all alerts, device controls and Unfied Logs."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b608e714-b3ec-4380-b666-1aa781513ab4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"typeSettings\":{\"includeAll\":false},\"label\":\" Subscription\",\"value\":[\"/subscriptions/cc519aa2-4ddf-4e59-a0c2-a785d967e829\"]},{\"id\":\"f408f1cf-dbcb-4f57-9409-272374bd3cd4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"query\":\"Resources | where type =~ \\\"microsoft.operationalinsights/workspaces\\\" | order by name | project id, name, selected=row_number()==1, group=resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"label\":\" Workspace\",\"value\":\"/subscriptions/cc519aa2-4ddf-4e59-a0c2-a785d967e829/resourceGroups/JamfProtect/providers/Microsoft.OperationalInsights/workspaces/3-2-4-27\"},{\"id\":\"397d983f-ea80-4aa5-8c65-547d40cb312b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_timetoken\",\"label\":\" Time Range\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"value\":{\"durationMs\":172800000}},{\"id\":\"d716fb1e-0d71-4e99-9406-18ae7df6e037\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"changelog\",\"label\":\" Changelog\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true }\\r\\n]\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"Parameters Picker\"},{\"type\":1,\"content\":{\"json\":\"## Jamf Protect for Microsoft Sentinel!\\n\\nThe [Jamf Protect](https://www.jamf.com/solutions/threat-prevention-remediation/) for Microsoft Sentinel solution creates detailed event data from macOS endpoints into a Microsoft Sentinel workspace in a simple and easy workflow. The solution provides you with full visibility into Apple Endpoint Security by leveraging Workbooks containing [Alert](https://docs.jamf.com/jamf-protect/documentation/Alerts.html) and [Unified Logging](https://docs.jamf.com/jamf-protect/documentation/Unified_Logging.html) events captured by Jamf Protect and the [macOS built-in security events](https://support.apple.com/en-gb/guide/security/sec469d47bd8/web) that occurred across the protected organisational endpoints\\n\\n\\n#### Changelog\\n\\n**v2.2.0**\\n\\n***Workbook***\\n - Added System Performance Metrics\\n    - Includes Energy Impact\\n - Added Network Traffic Stream\\n - Updated Workbook to make use of the newly added parser\\n - Added and tweaked querys and graphs\\n\\n ***Parser***\\n - Added JamfProtect parser for parsing and mapping all incoming raw data.\\n\\n ***Analytic Rules***\\n - Updated Analytic Rules to make use of the newly added parser. \\n\\t\\n**v2.1**\\n\\n***Workbook***\\n - Added Endpoint Telemetry\\n    - Includes graphs and visualisations\\n\\t- Includes Endpoint Information\\n\\t- Includes Jamf Pro log parser\\n- Added Network Threat Events\\n \\t- Includes graphs and visualisations\\n- Added new Pickers\\n    - Allows selecting different Log Analytic Workspaces\\n    - Changed TimeRanger picker\\n- Added Changelog\\n\\n**Analytic Rules**\\n\\n- Added Analytic Rules\\n\\t- Jamf Protect - Alerts\\n\\t- Jamf Protect - Unified Logs\\n\\t- Jamf Protect - Network Threat Events\\n\\n\\n **v2.0**\\n \\n- Initial release of the solution containing a basic Workbook\\n\"},\"conditionalVisibility\":{\"parameterName\":\"changelog\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"Text - Changelog\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Threat Hunting {_timetoken:value}\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"Set an type and provide values to search on File hash, CVE numbers or report on Alerts mapped to the MITRE framework or display latest alerts for a single endpoint.\",\"style\":\"info\"},\"name\":\"Text - Threat Hunting\",\"styleSettings\":{\"showBorder\":true}},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"5f5886d0-e83e-4ffc-a48c-bfed7370aa66\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_type\",\"label\":\"Type\",\"type\":2,\"description\":\"Please choose the type\",\"isGlobal\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\n    { \\\"value\\\":\\\"filehash\\\", \\\"label\\\":\\\"File Hash\\\" },\\n    { \\\"value\\\":\\\"CVE\\\", \\\"label\\\":\\\"CVE\\\" },\\n    { \\\"value\\\":\\\"mitre\\\", \\\"label\\\":\\\"Framework: MITRE\\\" },\\n    { \\\"value\\\":\\\"endpointalerts\\\", \\\"label\\\":\\\"Latest alerts for a single endpoint\\\" }\\n]\",\"value\":\"endpointalerts\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"15\",\"name\":\"Picker - Threat Hunting Type\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"49255f47-8f93-4746-8260-aad07befdb06\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_hostnamealert\",\"label\":\"Hostname\",\"type\":2,\"query\":\"jamfprotectalerts_CL\\n| where isnotempty(DvcHostname)\\n   | project-keep DvcHostname\\n| project-rename Hostname = DvcHostname\\n| summarize by tostring(Hostname)\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"admins Virtual Machine\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibilities\":[{\"parameterName\":\"_type\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"endpointalerts\"}],\"name\":\"Picker - Threat Hunting Hostname\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"bcdd945e-4dfe-47d6-9489-f76ce012c224\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_filehash\",\"label\":\"File Hash\",\"type\":1,\"description\":\"Thish value can be used for searching all alerts for a certain hash\",\"isRequired\":true,\"isGlobal\":true,\"value\":\"5e54bccbd4d93447e79cda0558b0b308a186c2be571c739e5460a3cb6ef665c0\"}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"filehash\"},\"name\":\"Search - Threat Hunting Hash\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"0344768b-16c4-44ec-a4ac-73a8bc83d0e2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_CVE\",\"label\":\"CVE Number\",\"type\":1,\"description\":\"Please search on the CVE number\",\"isRequired\":true,\"isGlobal\":true,\"value\":\"T15\"}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"CVE\"},\"name\":\"Search - Threat Hunting CVE\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectAlerts\\n| where TargetProcessSHA1 has \\\"{_filehash:value}\\\" or TargetBinarySHA256 has \\\"{_filehash:value}\\\"\\n| project-reorder\\n    TimeGenerated\\n| sort by TimeGenerated\",\"size\":4,\"title\":\"Matches on FileHash\",\"noDataMessage\":\"No matches found based on the hash value\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventReportUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to navigate to original event in Jamf Protect\"}}]}},\"conditionalVisibilities\":[{\"parameterName\":\"_filehash\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"filehash\"}],\"name\":\"Query - Threat Hunting Hash\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"jamfprotectalerts_CL\\n| where input.match.tags contains \\\"{_CVE:value}\\\"\\n| project-reorder\\n    TimeGenerated\\n| sort by TimeGenerated\",\"size\":1,\"title\":\"Matches on CVE\",\"noDataMessage\":\"No matches found based on the _CVE:value CVE number\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventReportUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to nagivate to original event in Jamf Protect\"}}]}},\"conditionalVisibilities\":[{\"parameterName\":\"_cve\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"CVE\"}],\"name\":\"Query - Threat Hunting CVE\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"jamfprotectalerts_CL\\n| where input.match.tags contains \\\"MITREattack\\\"\\n| extend\\n    Tactics = case(input.match.tags has \\\"Execution\\\", \\\"Execution\\\", input.match.tags has \\\"Visibility\\\", \\\"Visibility\\\", input.match.tags has \\\"Persistence\\\", \\\"Persistence\\\", input.match.tags has \\\"LateralMovement\\\", \\\"Lateral Movement\\\", input.match.tags has \\\"CredentialAccess\\\", \\\"Credential Acccess\\\", input.match.tags has \\\"DefenseEvasion\\\", \\\"Defense Evasion\\\", input.match.tags has \\\"PrivilegeEscalation\\\", \\\"Privilege Escalation\\\", input.match.tags has \\\"Impact\\\", \\\"Impact\\\", input.match.tags has \\\"CommandAndControl\\\", \\\"Command and Control\\\", input.match.tags has \\\"Discovery\\\", \\\"Discovery\\\", input.match.tags has \\\"InitialAccess\\\", \\\"Initial Access\\\", \\\"\\\"),\\n      Techniques = extract(@\\\"[A-Za-z]\\\\d{4}\\\", 0, tostring(input.match.tags))\\n| project-reorder\\n    TimeGenerated\\n| sort by TimeGenerated\",\"size\":1,\"title\":\"Alerts mapped to MITRE\",\"noDataMessage\":\"No alerts found that are mapped to the MITRE framework\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventReportUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to navigate to original event in Jamf Protect\"}}],\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"conditionalVisibilities\":[{\"parameterName\":\"_type\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"mitre\"}],\"name\":\"Query - Threat Hunting MITRE\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectAlerts\\n| where DvcHostname contains \\\"{_hostnamealert:value}\\\"\\n| project-reorder\\n    TimeGenerated\\n| sort by TimeGenerated\\n| limit 10\",\"size\":1,\"title\":\"Recent 10 alerts in the past {_timetoken:value} for {_hostnamealert:value}\",\"noDataMessage\":\"No alerts found\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventReportUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to nagivage to original event in Jamf Protect\"}}],\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"conditionalVisibilities\":[{\"parameterName\":\"_type\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},{\"parameterName\":\"_type\",\"comparison\":\"isEqualTo\",\"value\":\"endpointalerts\"},{\"parameterName\":\"_hostnamealert\",\"comparison\":\"isNotEqualTo\",\"value\":\"\"}],\"name\":\"Query - Threat Hunting 10 Recent Alerts Endpoint\"}]},\"customWidth\":\"100\",\"name\":\"Group - Threat Hunting\",\"styleSettings\":{\"margin\":\"200\",\"padding\":\"200\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectAlerts\\n| where EventSeverity != \\\"Informational\\\"\\n| sort by TimeGenerated\\n| limit 10\",\"size\":0,\"title\":\"Recent 10 alerts in the past {_timetoken:value}\",\"noDataMessage\":\"No alerts found\",\"timeContextFromParameter\":\"_timetoken\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventReportUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to navigate to Alert in Jamf Protect\"}},{\"columnMatch\":\"AlertURL\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"name\":\"Query - 10 Recent Alerts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"datatable (Count: long, severity: string) [\\n    0, \\\"Informational\\\",\\n    0, \\\"Low\\\",\\n    0, \\\"Medium\\\",\\n    0, \\\"High\\\"\\n]\\n| union\\n    (\\n    JamfProtectAlerts\\n    | summarize Count = count() by EventSeverity\\n    )\\n| where isnotempty(EventSeverity)\\n| summarize Count=sum(Count) by EventSeverity\",\"size\":3,\"title\":\"All Alerts {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"EventSeverity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"green\",\"text\":\"{0}{1}\"}],\"compositeBarSettings\":{\"labelText\":\"\"}}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"minimumSignificantDigits\":1,\"maximumSignificantDigits\":3},\"emptyValCustomText\":\"0\"}},\"showBorder\":true,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2}},\"name\":\"Datatable - Alerts per Severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectAlerts\\n| where isnotempty(EventSeverity)\\n| summarize count() by EventSeverity, bin(TimeGenerated,{_timetoken:grain})\\n| render areachart \",\"size\":0,\"title\":\"Events Detected (Count By Severity) {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"chartSettings\":{\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"0\",\"label\":\"Informational\"},{\"seriesName\":\"1\",\"label\":\"Low\"},{\"seriesName\":\"2\",\"label\":\"Medium\"},{\"seriesName\":\"3\",\"label\":\"High\"}]}},\"customWidth\":\"50\",\"name\":\"Query - Events detected by Severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectUnifiedLogs\\n| summarize count() by tostring(EventMessage), bin(TimeGenerated,{_timetoken:grain})\\n| render areachart \",\"size\":0,\"title\":\"Unified Logging Events {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Unified Logs\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectAlerts\\n| where isnotempty(DvcHostname)\\n| summarize Event = count() by tostring(DvcHostname)\\n| sort by Event desc\",\"size\":3,\"title\":\"Most Active Endpoints (Total, last {_timetoken:value})\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"HostName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Event\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"HostName\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Event\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"100\",\"name\":\"Query - Most active endpoints with Alerts\",\"styleSettings\":{\"maxWidth\":\"100\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectAlerts\\n| summarize Events = count() by EventProduct, bin(TimeGenerated,{_timetoken:grain})\\n| render columnchart   \",\"size\":0,\"title\":\"Events detected (Total by date, {_timetoken:value})\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"jamfprotect_CL\",\"label\":\"Jamf Protect\"}]}},\"customWidth\":\"50\",\"name\":\"Query - Total events detected\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectAlerts\\n| summarize Events = count() by EventType, bin(TimeGenerated,{_timetoken:grain})\\n| render areachart with(kind=stacked)\\n\",\"size\":0,\"title\":\"Events Detected (Count by Type, {_timetoken:value})\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"areachart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Events\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Events\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"Query - Events detected counted by Type\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectAlerts\\n| where isnotempty(EventType)\\n| summarize count() by tostring(EventType), tostring(EventMessage)\\n| project-rename Count = count_\\n| sort by Count desc\\n| limit 10\\n\",\"size\":3,\"showAnalytics\":true,\"title\":\"Top 10 Event Types {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Top 10 Events\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Device Controls\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectAlerts\\n| where EventType == \\\"UsbBlock\\\"\\n| where EventMessage == \\\"EnforcedRemovableDevicePolicy\\\"\\n| extend EventMessage = replace_string(tostring(EventMessage), \\\"EnforcedRemovableDevicePolicy\\\", \\\"Blocked\\\")\\n| summarize count() by tostring(EventMessage)\\n\\n\",\"size\":2,\"title\":\"Device Controls Blocked {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"thresholdValue\":\"Alerts\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"Notifications\",\"text\":\"Devices Blocked\"}]}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":true,\"sortOrderField\":2},\"graphSettings\":{\"type\":0,\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"showMetrics\":false},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"count_\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"count_\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"25\",\"name\":\"Query - Blocked USB Events\",\"styleSettings\":{\"maxWidth\":\"25\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectAlerts\\n| where EventType == \\\"UsbBlock\\\"\\n| where EventMessage == \\\"EnforcedRemovableDevicePolicy\\\"\\n| extend device_ = strcat(input.match.event.device.vendorName, \\\" \\\",input.match.event.device.productName)\\n| summarize count() by tostring(DvcHostname), device_\\n| project-rename Hostname = DvcHostname, Device = device_, Count = count_\\n| sort by Count desc\\n\\n\",\"size\":0,\"title\":\"Device Controls Endpoint {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"65\",\"name\":\"Query - Blocked USB Devices\",\"styleSettings\":{\"maxWidth\":\"100\"}}]},\"name\":\"Group - Device Controls\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Endpoint Telemetry\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectTelemetry\\n| where eventTypeHuman == \\\"exec\\\"\\n| limit 50\\n| sort by TimeGenerated\",\"size\":0,\"title\":\"Succesful sudo events {_timetoken:value}\",\"noDataMessage\":\"No events occured\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Compiled_Arguments\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"69.5714ch\"}}]}},\"name\":\"Query - Successful sudo events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtectTelemetry\\n| where eventTypeHuman contains \\\"screensharing\\\"\\n| limit 15\\n| sort by TimeGenerated\",\"size\":0,\"title\":\"Remotely Controlled Commands (Outbound) {_timetoken:value}\",\"noDataMessage\":\"No events occured\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"Query - Remotely Controlled Commands\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Endpoint Information\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Log Parser {_timetoken:value}\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"Please select a hostname in order to show the collected plain-text log files.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"_hostnamelogparser\",\"comparison\":\"isEqualTo\"},\"name\":\"Text - Jamf Log Parser Note\",\"styleSettings\":{\"showBorder\":true}},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f747e125-851e-45f7-b500-5d22049da6a6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_hostnamelogparser\",\"label\":\"Hostname\",\"type\":2,\"isRequired\":true,\"query\":\"JamfProtectTelemetry\\n| where isnotempty(DvcHostname)\\n    and eventTypeHuman == \\\"log_collection\\\"\\n| project-keep DvcHostname\\n| project-rename Hostname = DvcHostname\\n| summarize by tostring(Hostname)\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"7d123ad2-1768-4d22-b438-565ab483c044\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_logselectlogparser\",\"label\":\"Available Log File\",\"type\":2,\"isRequired\":true,\"query\":\"JamfProtectTelemetry\\n| where eventTypeHuman == \\\"log_collection\\\"\\n    and DvcHostname == \\\"{_hostnamelogparser:value}\\\"\\n| project-keep TargetFilePath\\n| project-keep TargetFilePath\\n| extend TargetFilePath = replace_string(TargetFilePath, \\\"[\\\", \\\"\\\")\\n| extend TargetFilePath = replace_string(TargetFilePath, \\\"]\\\", \\\"\\\")\\n| extend TargetFilePath = replace_string(TargetFilePath, '\\\"', \\\"\\\")\\n| summarize by TargetFilePath\",\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"40\",\"name\":\"Picker - Hostname\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventType == \\\"LogFileCollected\\\"\\n    and DvcHostname == \\\"{_hostnamelogparser:value}\\\"\\n| extend TargetFilePath = replace_string(TargetFilePath, \\\"[\\\", \\\"\\\")\\n| extend TargetFilePath = replace_string(TargetFilePath, \\\"]\\\", \\\"\\\")\\n| extend TargetFilePath = replace_string(TargetFilePath, '\\\"', \\\"\\\")\\n| where  TargetFilePath == \\\"{_logselectlogparser:escapejson}\\\"\\n| project EventResult, EventStartTime\\n| project-rename Logs = EventResult\\n| project-reorder EventStartTime, Logs\\n| mv-expand parse_json(Logs)\\n| sort by EventStartTime desc\\n| limit 50\",\"size\":0,\"showAnalytics\":true,\"title\":\"Log File Collection on \\\"{_hostnamelogparser:value}\\\"\",\"noDataMessage\":\"No matches found based on the hostname\",\"timeContextFromParameter\":\"_timetoken\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Logs\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"150ch\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"_hostnamelogparser\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Query - Parse Logs\"}]},\"customWidth\":\"100\",\"name\":\"Group - Log Parser\",\"styleSettings\":{\"margin\":\"200\",\"padding\":\"200\",\"showBorder\":true}}]},\"name\":\"Group - Endpoint Information\"}]},\"name\":\"Group - Telemetry\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Network Threat Events\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\"\\n    and EventResult == \\\"Blocked\\\"\\n| extend blocks = case(EventResult == \\\"Blocked\\\", \\\"Blocked\\\", \\\"True\\\")\\n| summarize arg_max(EventResult, *) by EventStartTime\\n| summarize Count = count() by blocks\\n\\n\",\"size\":4,\"title\":\"Threats blocked by NTP {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Count\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"0\",\"representation\":\"green\",\"text\":\"Threats blocked by NTP\"},{\"operator\":\"<\",\"thresholdValue\":\"15\",\"representation\":\"gray\",\"text\":\"Threats blocked by NTP\"},{\"operator\":\"<\",\"thresholdValue\":\"30\",\"representation\":\"orange\",\"text\":\"Threats blocked by NTP\"},{\"operator\":\">\",\"thresholdValue\":\"50\",\"representation\":\"redBright\",\"text\":\"Threats blocked by NTP\"},{\"operator\":\"Default\",\"representation\":\"gray\",\"text\":\"Threats blocked by NTP\"}],\"compositeBarSettings\":{\"labelText\":\"\"}}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"minimumSignificantDigits\":1,\"maximumSignificantDigits\":3},\"emptyValCustomText\":\"0\"}},\"showBorder\":true,\"sortCriteriaField\":\"blocks\",\"sortOrderField\":1,\"size\":\"auto\"}},\"name\":\"Query - Threats blocked by NTP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\"\\n| where isnotempty(EventSeverity)\\n| summarize arg_max(EventSeverity, *) by EventStartTime\\n| summarize count() by EventSeverity, bin(TimeGenerated,{_timetoken:grain})\\n| render areachart\",\"size\":0,\"title\":\"Network Events Detected (Count By Severity) {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Network Events by Severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\"\\n    and isnotempty(DvcHostname)\\n| summarize arg_max(DvcHostname, *) by EventStartTime\\n| summarize Event = count() by DvcHostname\\n| sort by Event desc\",\"size\":0,\"title\":\"Most Active Endpoints (Total, last {_timetoken:value})\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Most Active Endoints with Alerts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\"\\n    and isnotempty(ThreatCategory)\\n| summarize arg_max(ThreatCategory, *) by EventStartTime\\n| summarize Events = count() by ThreatCategory, bin(EventStartTime, {_timetoken:grain})\\n| render areachart with(kind=stacked)\",\"size\":0,\"title\":\"Network Events Detected (Count by Type, {_timetoken:value})\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Network Events by Category\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\"\\n    and isnotempty(ThreatCategory)\\n| summarize arg_max(ThreatCategory, *) by EventStartTime\\n| summarize Events = count() by ThreatCategory\\n| render piechart\",\"size\":0,\"title\":\"Event Types {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Network Events by Description\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\" \\n    and notempty(ThreatCategory) and notempty(DnsQueryName)\\n| extend name_ = ThreatCategory\\n| summarize arg_max(DnsQueryName, *) by EventStartTime\\n| summarize count() by DnsQueryName, ThreatCategory\\n| project-rename\\n    Count = count_\\n| sort by Count desc\\n| limit 10\",\"size\":0,\"title\":\"Top 10 Blocked destinations {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Top 10 blocked destinations\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Threat Events Stream\\\" \\n    and notempty(ThreatCategory)\\n    and notempty(DstIpAddr)\\n| extend name_ = ThreatCategory\\n| summarize arg_max(DstIpAddr, *) by EventStartTime\\n| summarize count() by DstIpAddr\\n| project-rename\\n    Count = count_\\n| sort by Count desc\\n| limit 10\",\"size\":0,\"title\":\"Top 10 Blocked IPs {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Top 10 Blocked IPs\"}]},\"name\":\"Network Threat Events - Group\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Network Traffic\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Network Traffic Stream\\\"\\n    and isnotempty(DnsQuery)\\n| summarize arg_max(DnsQuery, *) by EventStartTime\\n| summarize count() by DnsQuery, DnsQueryTypeName\\n| project-rename\\n    Count = count_\\n| sort by Count desc\\n| limit 10\",\"size\":0,\"title\":\"Top 10 resolved destinations {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Top 10 resolved destinations\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JamfProtect\\n| where EventProduct == \\\"Jamf Protect - Network Traffic Stream\\\"\\n    and isnotempty(DstIpAddr) and DstIpAddr != \\\"[]\\\"\\n| summarize arg_max(DstIpAddr, *) by EventStartTime\\n| summarize count() by DstIpAddr\\n| project-rename\\n    Count = count_\\n| sort by Count desc\\n| limit 10\",\"size\":0,\"title\":\"Top 10 Resolved IPs {_timetoken:value}\",\"timeContextFromParameter\":\"_timetoken\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"Query - Top 10 Resolved IPs\"}]},\"name\":\"Network Traffic - Group\",\"styleSettings\":{\"showBorder\":true}}],\"fromTemplateId\":\"sentinel-JamfProtectDashboard\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=JamfProtectWorkbook; logoFileName=jamf_logo.svg; description=This Jamf Protect Workbook for Microsoft Sentinel enables you to ingest Jamf Protect events forwarded into Microsoft Sentinel.\n Providing reports into all alerts, device controls and Unfied Logs.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=2.0.0; title=Jamf Protect Workbook; templateRelativePath=JamfProtectDashboard.json; subtitle=; provider=Jamf Software, LLC}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "jamfprotect_CL",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtectAlerts_AnalyticalRules Analytics Rule with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "NRT",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Creates an incident based on Jamf Protect Alert data in Microsoft Sentinel",
                "displayName": "Jamf Protect - Alerts",
                "enabled": false,
                "query": "jamfprotectalerts_CL\n| extend\n    algorithm = \"SHA256\",\n    Host_IPs = tostring(parse_json(DvcIpAddr)[0]),\n    Tags = parse_json(tostring(parse_json(tostring(input.match)).tags)),\n    Tactics = case(input.match.tags has \"Execution\", \"Execution\", input.match.tags has \"Visibility\", \"Visibility\", input.match.tags has \"Persistence\", \"Persistence\", input.match.tags has \"LateralMovement\", \"LateralMovement\", input.match.tags has \"CredentialAccess\", \"CredentialAcccess\", input.match.tags has \"DefenseEvasion\", \"DefenseEvasion\", input.match.tags has \"PrivilegeEscalation\", \"PrivilegeEscalation\", input.match.tags has \"Impact\", \"Impact\", input.match.tags has \"CommandAndControl\", \"CommandandControl\", input.match.tags has \"Discovery\", \"Discovery\", input.match.tags has \"InitialAccess\", \"InitialAccess\", \"\"),\n    Techniques = pack_array(extract(@\"[A-Za-z]\\d{4}\", 0, tostring(input.match.tags))),\n    JamfPro = case(input.match.actions has \"SmartGroup\", \"Workflow with Jamf Pro\", input.match.actions has \"Prevented\", \"No workflow, Prevented by Protect\", \"No workflow\")\n",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "jamfprotectalerts_CL"
                    ],
                    "connectorId": "JamfProtect"
                  }
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "DvcHostname"
                      },
                      {
                        "identifier": "OSFamily",
                        "columnName": "DvcOs"
                      },
                      {
                        "identifier": "OSVersion",
                        "columnName": "DvcOsVersion"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "Host_IPs"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "CommandLine",
                        "columnName": "TargetProcessCurrentDirectory"
                      },
                      {
                        "identifier": "ProcessId",
                        "columnName": "TargetProcessId"
                      }
                    ],
                    "entityType": "Process"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "algorithm"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "TargetBinarySHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Related_Binaries": "TargetBinaryFilePath",
                  "Protect_Analytic": "EventMessage",
                  "Protect_Tags": "Tags",
                  "TargetbinarySign": "TargetbinarySignerType",
                  "Related_File_hash": "TargetBinarySHA256",
                  "JamfPro_Status": "JamfPro",
                  "TargetBinarySigner": "TargetBinarySigningTeamID",
                  "TargetBinarySignMsg": "TargetBinarySigningInfoMessage",
                  "Protect_Event_Type": "EventType"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "{{EventMessage}} detected on {{DvcHostname}}",
                  "alertDynamicProperties": [
                    {
                      "value": "EventVendor",
                      "alertProperty": "ProviderName"
                    },
                    {
                      "value": "EventProduct",
                      "alertProperty": "ProductName"
                    },
                    {
                      "value": "Techniques",
                      "alertProperty": "Techniques"
                    }
                  ],
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "{{EventResultMessage}} - Please investigate",
                  "alertTacticsColumnName": "Tactics"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "lookbackDuration": "PT5H",
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "Jamf Protect Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jamf Protect - Alerts",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtectNetworkThreats_AnalyticalRules Analytics Rule with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "NRT",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Creates an incident based based on Jamf Protect's Network Threat Event Stream alerts.",
                "displayName": "Jamf Protect - Network Threats",
                "enabled": false,
                "query": "JamfProtectThreatEvents\n| where EventResult == \"Blocked\"\n    and isnotempty(EventSeverity)\n| extend Tactics = \"Initial Access\"\n| extend Techniques = \"T1566\"\n",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "jamfprotect_CL"
                    ],
                    "connectorId": "JamfProtect"
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "Hostname"
                      },
                      {
                        "identifier": "OSFamily",
                        "columnName": "DvcOs"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "DstIpAddr"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "AadUserId",
                        "columnName": "SrcUsermail"
                      },
                      {
                        "identifier": "FullName",
                        "columnName": "SrcUsername"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "DnsQueryName"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Category": "ThreatCategory"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "Network Threat detected on {{DvcHostname}}",
                  "alertDynamicProperties": [
                    {
                      "value": "EventReportUrl",
                      "alertProperty": "AlertLink"
                    },
                    {
                      "value": "EventVendor",
                      "alertProperty": "ProviderName"
                    },
                    {
                      "value": "EventProduct",
                      "alertProperty": "ProductName"
                    },
                    {
                      "value": "EventResult",
                      "alertProperty": "RemediationSteps"
                    },
                    {
                      "value": "Techniques",
                      "alertProperty": "Techniques"
                    }
                  ],
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "A Network Threat has been {{EventResult}} on {{DvcHostname}}",
                  "alertTacticsColumnName": "Tactics"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "lookbackDuration": "PT5H",
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "Jamf Protect Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jamf Protect - Network Threats",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtectUnifiedLogs_AnalyticalRules Analytics Rule with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "NRT",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Creates an informational incident based on Jamf Protect Unified Log data in Microsoft Sentinel",
                "displayName": "Jamf Protect - Unified Logs",
                "enabled": false,
                "query": "JamfProtectUnifiedLogs\n| where isnotempty(EventSeverity)\n| extend Host_IPs = tostring(parse_json(DvcIpAddr)[0])\n",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "jamfprotect_CL"
                    ],
                    "connectorId": "JamfProtect"
                  }
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "DvcHostname"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "Host_IPs"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protect_Event_Type": "EventType",
                  "Tags": "Match_tags",
                  "Unified_Log": "EventDescription",
                  "Event_Process": "TargetProcessName"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "{{EventDescription}} on {{DvcHostname}}",
                  "alertDynamicProperties": [
                    {
                      "value": "EventVendor",
                      "alertProperty": "ProviderName"
                    },
                    {
                      "value": "EventProduct",
                      "alertProperty": "ProductName"
                    }
                  ],
                  "alertSeverityColumnName": "EventSeverity",
                  "alertDescriptionFormat": "{{EventDescription}} has been captured in the unified logs"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "lookbackDuration": "PT5H",
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "Jamf Protect Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jamf Protect - Unified Logs",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtect_Alert_Status_InProgress Playbook with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "clientIdentifier": {
              "type": "String",
              "metadata": {
                "description": "The Client ID for the Jamf Protect API Key"
              }
            },
            "clientSecret": {
              "type": "SecureString",
              "metadata": {
                "description": "The Client Secret for the Jamf Protect API Key"
              }
            },
            "jamfProtect_URL": {
              "defaultValue": "https://*.protect.jamfcloud.com",
              "type": "String",
              "metadata": {
                "description": "Enter the Jamf Protect instance URL ex: {https://fakevalue.protect.jamfcloud.com}"
              }
            },
            "PlaybookName": {
              "type": "String",
              "minLength": 1,
              "defaultValue": "JamfProtect_Alert_Status_InProgress",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('playbookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "client_ID": {
                      "defaultValue": "[[parameters('clientIdentifier')]",
                      "type": "String"
                    },
                    "jamfProtectURL": {
                      "defaultValue": "[[parameters('jamfProtect_URL')]",
                      "type": "String"
                    },
                    "password": {
                      "defaultValue": "[[parameters('clientSecret')]",
                      "type": "SecureString"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@triggerBody()?['object']?['properties']?['Alerts']",
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "HTTP_POST_-_Change_Alert_Status_using_Jamf_Protect's_GraphQL_API_Endpoint": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>Jamf Protect Alert with URL @{outputs('Composing_Jamf_Protect_Alert_URL')} has been set to status <strong>In Progress</strong></p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Composing_Jamf_Protect_Alert_URL": {
                          "type": "Compose",
                          "inputs": "@items('For_each')?['properties']?['alertLink']"
                        },
                        "HTTP_POST_-_Change_Alert_Status_using_Jamf_Protect's_GraphQL_API_Endpoint": {
                          "runAfter": {
                            "Removing_pre-fix_of_URL_and_keeping_Alert_UDID": [
                              "Succeeded"
                            ]
                          },
                          "type": "Http",
                          "inputs": {
                            "authentication": {
                              "type": "Raw",
                              "value": "@variables('accessToken')"
                            },
                            "body": {
                              "operationName": "updateAlert",
                              "query": "mutation updateAlert {\n  updateAlerts(input: { uuids: [\"@{outputs('Removing_pre-fix_of_URL_and_keeping_Alert_UDID')}\"], status: InProgress })\n   {\n    items {\n      uuid\n      status\n    }\n  }\n}\n"
                            },
                            "method": "POST",
                            "uri": "@{parameters('jamfProtectURL')}/graphql"
                          }
                        },
                        "Removing_pre-fix_of_URL_and_keeping_Alert_UDID": {
                          "runAfter": {
                            "Composing_Jamf_Protect_Alert_URL": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "@replace(outputs('Composing_Jamf_Protect_Alert_URL'), variables('jamfProtectAlertURL'), '')"
                        }
                      },
                      "runAfter": {
                        "Set_accessToken_as_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Generate_Access_Token": {
                      "runAfter": {
                        "set_jamfProtectAlertURL_as_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "Http",
                      "inputs": {
                        "body": {
                          "client_id": "@{parameters('client_ID')}",
                          "password": "@{parameters('password')}"
                        },
                        "headers": {
                          "Content-Type": "application/json"
                        },
                        "method": "POST",
                        "uri": "@{parameters('jamfProtectURL')}/token"
                      },
                      "runtimeConfiguration": {
                        "secureData": {
                          "properties": [
                            "inputs"
                          ]
                        }
                      }
                    },
                    "Parse_JSON_Response_from_Access_Token": {
                      "runAfter": {
                        "Generate_Access_Token": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('Generate_Access_Token')",
                        "schema": {
                          "properties": {
                            "access_token": {
                              "type": "string"
                            },
                            "expires_in": {
                              "type": "integer"
                            },
                            "token_type": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Set_accessToken_as_variable": {
                      "runAfter": {
                        "Parse_JSON_Response_from_Access_Token": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "accessToken",
                            "type": "string",
                            "value": "@body('Parse_JSON_Response_from_Access_Token')?['access_token']"
                          }
                        ]
                      }
                    },
                    "set_jamfProtectAlertURL_as_variable": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "jamfProtectAlertURL",
                            "type": "string",
                            "value": "@{parameters('jamfProtectURL')}/Alerts/"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Jamf Protect - Set Alert to In Progress",
            "description": "This Jamf Protect Playbook can be used manually or in a Automation Rule to change the state of the Alert in Jamf Protect itself, in an automated way you can mirror the state from a Microsoft Sentinel incident back to Jamf Protect.",
            "mainSteps": [
              "1. Fetches the AlertUDID from the Alert of Jamf Protect",
              "2. Generates a Access Token to authenticate against the Jamf Protect GraphQL API",
              "3. Changes the Alert status in Jamf Protect to In Progress"
            ],
            "prerequisites": [
              "1. Generate API Client in Jamf Protect and take note of the CLientID and Password. [learn how](https://learn.jamf.com/bundle/jamf-protect-documentation/page/Jamf_Protect_API.html#ariaid-title3)",
              "2. Use the ClientID and Password during the deployment of this Playbook"
            ],
            "lastUpdateTime": "2023-07-20T00:00:00Z",
            "tags": [
              "Utilities"
            ],
            "source": {
              "type": "solution",
              "name": "Jamf Protect"
            },
            "postDeployment": [
              "** b. Configurations in Sentinel **",
              "1. In Microsoft Sentinel Analytic Rules for Jamf Protect - Alerts should be configured to create an incident",
              "2. Configure the Automation Rules to trigger this playbook once a incident is status is changed to Active"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Jamf Protect - Set Alert to In Progress",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "Playbook",
        "displayName": "JamfProtect_Alert_Status_InProgress",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtect_Alert_Status_Resolved Playbook with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "clientIdentifier": {
              "type": "String",
              "metadata": {
                "description": "The Client ID for the Jamf Protect API Key"
              }
            },
            "clientSecret": {
              "type": "SecureString",
              "metadata": {
                "description": "The Client Secret for the Jamf Protect API Key"
              }
            },
            "jamfProtect_URL": {
              "defaultValue": "https://*.protect.jamfcloud.com",
              "type": "String",
              "metadata": {
                "description": "Enter the Jamf Protect instance URL ex: {https://fakevalue.protect.jamfcloud.com}"
              }
            },
            "PlaybookName": {
              "type": "String",
              "minLength": 1,
              "defaultValue": "JamfProtect_Alert_Status_Resolved",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('playbookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "client_ID": {
                      "defaultValue": "[[parameters('clientIdentifier')]",
                      "type": "String"
                    },
                    "jamfProtectURL": {
                      "defaultValue": "[[parameters('jamfProtect_URL')]",
                      "type": "String"
                    },
                    "password": {
                      "defaultValue": "[[parameters('clientSecret')]",
                      "type": "SecureString"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@triggerBody()?['object']?['properties']?['Alerts']",
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "HTTP_POST_-_Change_Alert_Status_using_Jamf_Protect's_GraphQL_API_Endpoint": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>Jamf Protect Alert with URL @{outputs('Composing_Jamf_Protect_Alert_URL')} has been set to status <strong>Resolved</strong></p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Composing_Jamf_Protect_Alert_URL": {
                          "type": "Compose",
                          "inputs": "@items('For_each')?['properties']?['alertLink']"
                        },
                        "HTTP_POST_-_Change_Alert_Status_using_Jamf_Protect's_GraphQL_API_Endpoint": {
                          "runAfter": {
                            "Removing_pre-fix_of_URL_and_keeping_Alert_UDID": [
                              "Succeeded"
                            ]
                          },
                          "type": "Http",
                          "inputs": {
                            "authentication": {
                              "type": "Raw",
                              "value": "@variables('accessToken')"
                            },
                            "body": {
                              "operationName": "updateAlert",
                              "query": "mutation updateAlert {\n  updateAlerts(input: { uuids: [\"@{outputs('Removing_pre-fix_of_URL_and_keeping_Alert_UDID')}\"], status: Resolved })\n   {\n    items {\n      uuid\n      status\n    }\n  }\n}\n"
                            },
                            "method": "POST",
                            "uri": "@{parameters('jamfProtectURL')}/graphql"
                          }
                        },
                        "Removing_pre-fix_of_URL_and_keeping_Alert_UDID": {
                          "runAfter": {
                            "Composing_Jamf_Protect_Alert_URL": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "@replace(outputs('Composing_Jamf_Protect_Alert_URL'), variables('jamfProtectAlertURL'), '')"
                        }
                      },
                      "runAfter": {
                        "Set_accessToken_as_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Generate_Access_Token": {
                      "runAfter": {
                        "set_jamfProtectAlertURL_as_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "Http",
                      "inputs": {
                        "body": {
                          "client_id": "@{parameters('client_ID')}",
                          "password": "@{parameters('password')}"
                        },
                        "headers": {
                          "Content-Type": "application/json"
                        },
                        "method": "POST",
                        "uri": "@{parameters('jamfProtectURL')}/token"
                      },
                      "runtimeConfiguration": {
                        "secureData": {
                          "properties": [
                            "inputs"
                          ]
                        }
                      }
                    },
                    "Parse_JSON_Response_from_Access_Token": {
                      "runAfter": {
                        "Generate_Access_Token": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('Generate_Access_Token')",
                        "schema": {
                          "properties": {
                            "access_token": {
                              "type": "string"
                            },
                            "expires_in": {
                              "type": "integer"
                            },
                            "token_type": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Set_accessToken_as_variable": {
                      "runAfter": {
                        "Parse_JSON_Response_from_Access_Token": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "accessToken",
                            "type": "string",
                            "value": "@body('Parse_JSON_Response_from_Access_Token')?['access_token']"
                          }
                        ]
                      }
                    },
                    "set_jamfProtectAlertURL_as_variable": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "jamfProtectAlertURL",
                            "type": "string",
                            "value": "@{parameters('jamfProtectURL')}/Alerts/"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Jamf Protect - Set Alert to Resolved",
            "description": "This Jamf Protect Playbook can be used manually or in a Automation Rule to change the state of the Alert in Jamf Protect itself, in an automated way you can mirror the state from a Microsoft Sentinel incident back to Jamf Protect.",
            "mainSteps": [
              "1. Fetches the AlertUDID from the Alert of Jamf Protect",
              "2. Generates a Access Token to authenticate against the Jamf Protect GraphQL API",
              "3. Changes the Alert status in Jamf Protect to Resolved"
            ],
            "prerequisites": [
              "1. Generate API Client in Jamf Protect and take note of the CLientID and Password. [learn how](https://learn.jamf.com/bundle/jamf-protect-documentation/page/Jamf_Protect_API.html#ariaid-title3)",
              "2. Use the ClientID and Password during the deployment of this Playbook"
            ],
            "lastUpdateTime": "2023-07-20T00:00:00Z",
            "tags": [
              "Utilities"
            ],
            "source": {
              "type": "solution",
              "name": "Jamf Protect"
            },
            "postDeployment": [
              "** b. Configurations in Sentinel **",
              "1. In Microsoft Sentinel Analytic Rules for Jamf Protect - Alerts should be configured to create an incident",
              "2. Configure the Automation Rules to trigger this playbook once a incident is status is changed to Active"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Jamf Protect - Set Alert to Resolved",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "JamfProtect_Alert_Status_Resolved",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JamfProtect_LockComputer_with_JamfPro Playbook with template version 3.3.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "jamfProClientID": {
              "type": "String",
              "metadata": {
                "description": "The ClientID for the Jamf Pro"
              }
            },
            "jamfProSecret": {
              "type": "SecureString",
              "metadata": {
                "description": "The secret for the ClientID of Jamf Pro"
              }
            },
            "jamfProURL": {
              "defaultValue": "https://*.jamfcloud.com",
              "type": "String",
              "metadata": {
                "description": "Enter the Jamf Pro instance URL ex: {https://fakevalue.jamfcloud.com}"
              }
            },
            "PlaybookName": {
              "type": "String",
              "minLength": 1,
              "defaultValue": "JamfProtect_LockComputer_with_JamfPro",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('playbookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "jamfProSecret": {
                      "defaultValue": "[[parameters('jamfProSecret')]",
                      "type": "SecureString"
                    },
                    "jamfProURL": {
                      "defaultValue": "[[parameters('jamfProURL')]",
                      "type": "String"
                    },
                    "jamfProClientID": {
                      "defaultValue": "[[parameters('jamfProClientID')]",
                      "type": "String"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Filter_array_for_the_entity_kind_Host": {
                      "runAfter": {
                        "Parse_JSON_Entities_from_the_Incident": [
                          "Succeeded"
                        ]
                      },
                      "type": "Query",
                      "inputs": {
                        "from": "@body('Parse_JSON_Entities_from_the_Incident')",
                        "where": "@equals(item()['kind'], 'Host')"
                      }
                    },
                    "For_each_host_send_DeviceLock_command": {
                      "foreach": "@body('Filter_array_for_the_entity_kind_Host')",
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "Send_DeviceLock_command_to_given_computers_JSSID": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p><strong>Device Lock</strong> command has been send to&nbsp;@{body('Parse_JSON_for_given_computer_based_on_managementID')?['general']?['name']} with <strong>passcode</strong>:&nbsp;@{outputs('Generate_a_randomised_6_digit_value')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Generate_a_randomised_6_digit_value": {
                          "runAfter": {
                            "Parse_JSON_for_given_computer_based_on_managementID": [
                              "Succeeded",
                              "Failed"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "@{rand(0, 9)}@{rand(0, 9)}@{rand(0, 9)}@{rand(0, 9)}@{rand(0, 9)}@{rand(0, 9)}"
                        },
                        "Get_JSSID_for_given_computer_in_Jamf_Pro": {
                          "type": "Http",
                          "inputs": {
                            "headers": {
                              "Authorization": "Bearer @{variables('accessToken')}",
                              "accept": "application/json"
                            },
                            "method": "GET",
                            "uri": "@{parameters('jamfProURL')}/JSSResource/computers/name/@{items('For_each_host_send_DeviceLock_command')?['properties']?['friendlyName']}"
                          }
                        },
                        "Get_managementID_for_given_computer_in_Jamf_Pro": {
                          "runAfter": {
                            "Parse_JSON_response_for_given_computer": [
                              "Succeeded"
                            ]
                          },
                          "type": "Http",
                          "inputs": {
                            "headers": {
                              "Authorization": "Bearer @{variables('accessToken')}",
                              "accept": "application/json"
                            },
                            "method": "GET",
                            "uri": "@{parameters('jamfProURL')}/api/v1/computers-inventory/@{body('Parse_JSON_response_for_given_computer')?['computer']?['general']?['id']}?section=GENERAL"
                          }
                        },
                        "Parse_JSON_for_given_computer_based_on_managementID": {
                          "runAfter": {
                            "Get_managementID_for_given_computer_in_Jamf_Pro": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_managementID_for_given_computer_in_Jamf_Pro')",
                            "schema": {
                              "properties": {
                                "general": {
                                  "properties": {
                                    "declarativeDeviceManagementEnabled": {
                                      "type": "boolean"
                                    },
                                    "enrolledViaAutomatedDeviceEnrollment": {
                                      "type": "boolean"
                                    },
                                    "initialEntryDate": {
                                      "type": "string"
                                    },
                                    "itunesStoreAccountActive": {
                                      "type": "boolean"
                                    },
                                    "jamfBinaryVersion": {
                                      "type": "string"
                                    },
                                    "lastContactTime": {
                                      "type": "string"
                                    },
                                    "lastEnrolledDate": {
                                      "type": "string"
                                    },
                                    "lastIpAddress": {
                                      "type": "string"
                                    },
                                    "lastReportedIp": {
                                      "type": "string"
                                    },
                                    "managementId": {
                                      "type": "string"
                                    },
                                    "mdmCapable": {
                                      "properties": {
                                        "capable": {
                                          "type": "boolean"
                                        },
                                        "capableUsers": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "mdmProfileExpiration": {
                                      "type": "string"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "platform": {
                                      "type": "string"
                                    },
                                    "remoteManagement": {
                                      "properties": {
                                        "managed": {
                                          "type": "boolean"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "reportDate": {
                                      "type": "string"
                                    },
                                    "site": {
                                      "properties": {
                                        "id": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "supervised": {
                                      "type": "boolean"
                                    },
                                    "userApprovedMdm": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "id": {
                                  "type": "string"
                                },
                                "udid": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "Parse_JSON_response_for_given_computer": {
                          "runAfter": {
                            "Get_JSSID_for_given_computer_in_Jamf_Pro": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_JSSID_for_given_computer_in_Jamf_Pro')",
                            "schema": {
                              "properties": {
                                "computer": {
                                  "properties": {
                                    "certificates": {
                                      "items": {
                                        "properties": {
                                          "common_name": {
                                            "type": "string"
                                          },
                                          "expires_epoch": {
                                            "type": "integer"
                                          },
                                          "expires_utc": {
                                            "type": "string"
                                          },
                                          "identity": {
                                            "type": "boolean"
                                          },
                                          "name": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "common_name",
                                          "identity",
                                          "expires_utc",
                                          "expires_epoch",
                                          "name"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "configuration_profiles": {
                                      "items": {
                                        "properties": {
                                          "id": {
                                            "type": "integer"
                                          },
                                          "is_removable": {
                                            "type": "boolean"
                                          },
                                          "name": {
                                            "type": "string"
                                          },
                                          "uuid": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "id",
                                          "name",
                                          "uuid",
                                          "is_removable"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "extension_attributes": {
                                      "items": {
                                        "properties": {
                                          "id": {
                                            "type": "integer"
                                          },
                                          "multi_value": {
                                            "type": "boolean"
                                          },
                                          "name": {
                                            "type": "string"
                                          },
                                          "type": {
                                            "type": "string"
                                          },
                                          "value": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "id",
                                          "name",
                                          "type",
                                          "multi_value",
                                          "value"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "general": {
                                      "properties": {
                                        "alt_mac_address": {
                                          "type": "string"
                                        },
                                        "alt_network_adapter_type": {
                                          "type": "string"
                                        },
                                        "asset_tag": {
                                          "type": "string"
                                        },
                                        "barcode_1": {
                                          "type": "string"
                                        },
                                        "barcode_2": {
                                          "type": "string"
                                        },
                                        "distribution_point": {
                                          "type": "string"
                                        },
                                        "id": {
                                          "type": "integer"
                                        },
                                        "initial_entry_date": {
                                          "type": "string"
                                        },
                                        "initial_entry_date_epoch": {
                                          "type": "integer"
                                        },
                                        "initial_entry_date_utc": {
                                          "type": "string"
                                        },
                                        "ip_address": {
                                          "type": "string"
                                        },
                                        "itunes_store_account_is_active": {
                                          "type": "boolean"
                                        },
                                        "jamf_version": {
                                          "type": "string"
                                        },
                                        "last_cloud_backup_date_epoch": {
                                          "type": "integer"
                                        },
                                        "last_cloud_backup_date_utc": {
                                          "type": "string"
                                        },
                                        "last_contact_time": {
                                          "type": "string"
                                        },
                                        "last_contact_time_epoch": {
                                          "type": "integer"
                                        },
                                        "last_contact_time_utc": {
                                          "type": "string"
                                        },
                                        "last_enrolled_date_epoch": {
                                          "type": "integer"
                                        },
                                        "last_enrolled_date_utc": {
                                          "type": "string"
                                        },
                                        "last_reported_ip": {
                                          "type": "string"
                                        },
                                        "mac_address": {
                                          "type": "string"
                                        },
                                        "management_status": {
                                          "properties": {
                                            "enrolled_via_dep": {
                                              "type": "boolean"
                                            },
                                            "user_approved_enrollment": {
                                              "type": "boolean"
                                            },
                                            "user_approved_mdm": {
                                              "type": "boolean"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "mdm_capable": {
                                          "type": "boolean"
                                        },
                                        "mdm_capable_users": {
                                          "properties": {
                                            "mdm_capable_user": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "mdm_profile_expiration_epoch": {
                                          "type": "integer"
                                        },
                                        "mdm_profile_expiration_utc": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        },
                                        "network_adapter_type": {
                                          "type": "string"
                                        },
                                        "platform": {
                                          "type": "string"
                                        },
                                        "remote_management": {
                                          "properties": {
                                            "managed": {
                                              "type": "boolean"
                                            },
                                            "management_password_sha256": {
                                              "type": "string"
                                            },
                                            "management_username": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "report_date": {
                                          "type": "string"
                                        },
                                        "report_date_epoch": {
                                          "type": "integer"
                                        },
                                        "report_date_utc": {
                                          "type": "string"
                                        },
                                        "serial_number": {
                                          "type": "string"
                                        },
                                        "site": {
                                          "properties": {
                                            "id": {
                                              "type": "integer"
                                            },
                                            "name": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "supervised": {
                                          "type": "boolean"
                                        },
                                        "sus": {
                                          "type": "string"
                                        },
                                        "udid": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "groups_accounts": {
                                      "properties": {
                                        "computer_group_memberships": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "local_accounts": {
                                          "items": {
                                            "properties": {
                                              "administrator": {
                                                "type": "boolean"
                                              },
                                              "filevault_enabled": {
                                                "type": "boolean"
                                              },
                                              "home": {
                                                "type": "string"
                                              },
                                              "home_size": {
                                                "type": "string"
                                              },
                                              "home_size_mb": {
                                                "type": "integer"
                                              },
                                              "name": {
                                                "type": "string"
                                              },
                                              "realname": {
                                                "type": "string"
                                              },
                                              "uid": {
                                                "type": "string"
                                              }
                                            },
                                            "required": [
                                              "name",
                                              "realname",
                                              "uid",
                                              "home",
                                              "home_size",
                                              "home_size_mb",
                                              "administrator",
                                              "filevault_enabled"
                                            ],
                                            "type": "object"
                                          },
                                          "type": "array"
                                        },
                                        "user_inventories": {
                                          "properties": {
                                            "disable_automatic_login": {
                                              "type": "boolean"
                                            },
                                            "user": {
                                              "properties": {
                                                "password_history_depth": {
                                                  "type": "string"
                                                },
                                                "password_max_age": {
                                                  "type": "string"
                                                },
                                                "password_min_complex_characters": {
                                                  "type": "string"
                                                },
                                                "password_min_length": {
                                                  "type": "string"
                                                },
                                                "password_require_alphanumeric": {
                                                  "type": "string"
                                                },
                                                "username": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "hardware": {
                                      "properties": {
                                        "active_directory_status": {
                                          "type": "string"
                                        },
                                        "available_ram_slots": {
                                          "type": "integer"
                                        },
                                        "battery_capacity": {
                                          "type": "integer"
                                        },
                                        "ble_capable": {
                                          "type": "boolean"
                                        },
                                        "boot_rom": {
                                          "type": "string"
                                        },
                                        "bus_speed": {
                                          "type": "integer"
                                        },
                                        "bus_speed_mhz": {
                                          "type": "integer"
                                        },
                                        "cache_size": {
                                          "type": "integer"
                                        },
                                        "cache_size_kb": {
                                          "type": "integer"
                                        },
                                        "disk_encryption_configuration": {
                                          "type": "string"
                                        },
                                        "filevault2_users": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "gatekeeper_status": {
                                          "type": "string"
                                        },
                                        "institutional_recovery_key": {
                                          "type": "string"
                                        },
                                        "is_apple_silicon": {
                                          "type": "boolean"
                                        },
                                        "make": {
                                          "type": "string"
                                        },
                                        "mapped_printers": {
                                          "type": "array"
                                        },
                                        "model": {
                                          "type": "string"
                                        },
                                        "model_identifier": {
                                          "type": "string"
                                        },
                                        "nic_speed": {
                                          "type": "string"
                                        },
                                        "number_cores": {
                                          "type": "integer"
                                        },
                                        "number_processors": {
                                          "type": "integer"
                                        },
                                        "optical_drive": {
                                          "type": "string"
                                        },
                                        "os_build": {
                                          "type": "string"
                                        },
                                        "os_name": {
                                          "type": "string"
                                        },
                                        "os_version": {
                                          "type": "string"
                                        },
                                        "processor_architecture": {
                                          "type": "string"
                                        },
                                        "processor_speed": {
                                          "type": "integer"
                                        },
                                        "processor_speed_mhz": {
                                          "type": "integer"
                                        },
                                        "processor_type": {
                                          "type": "string"
                                        },
                                        "service_pack": {
                                          "type": "string"
                                        },
                                        "sip_status": {
                                          "type": "string"
                                        },
                                        "smc_version": {
                                          "type": "string"
                                        },
                                        "software_update_device_id": {
                                          "type": "string"
                                        },
                                        "storage": {
                                          "type": "array"
                                        },
                                        "supports_ios_app_installs": {
                                          "type": "boolean"
                                        },
                                        "total_ram": {
                                          "type": "integer"
                                        },
                                        "total_ram_mb": {
                                          "type": "integer"
                                        },
                                        "xprotect_version": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "iphones": {
                                      "type": "array"
                                    },
                                    "location": {
                                      "properties": {
                                        "building": {
                                          "type": "string"
                                        },
                                        "department": {
                                          "type": "string"
                                        },
                                        "email_address": {
                                          "type": "string"
                                        },
                                        "phone": {
                                          "type": "string"
                                        },
                                        "phone_number": {
                                          "type": "string"
                                        },
                                        "position": {
                                          "type": "string"
                                        },
                                        "real_name": {
                                          "type": "string"
                                        },
                                        "realname": {
                                          "type": "string"
                                        },
                                        "room": {
                                          "type": "string"
                                        },
                                        "username": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "peripherals": {
                                      "type": "array"
                                    },
                                    "purchasing": {
                                      "properties": {
                                        "applecare_id": {
                                          "type": "string"
                                        },
                                        "attachments": {
                                          "type": "array"
                                        },
                                        "is_leased": {
                                          "type": "boolean"
                                        },
                                        "is_purchased": {
                                          "type": "boolean"
                                        },
                                        "lease_expires": {
                                          "type": "string"
                                        },
                                        "lease_expires_epoch": {
                                          "type": "integer"
                                        },
                                        "lease_expires_utc": {
                                          "type": "string"
                                        },
                                        "life_expectancy": {
                                          "type": "integer"
                                        },
                                        "os_applecare_id": {
                                          "type": "string"
                                        },
                                        "os_maintenance_expires": {
                                          "type": "string"
                                        },
                                        "po_date": {
                                          "type": "string"
                                        },
                                        "po_date_epoch": {
                                          "type": "integer"
                                        },
                                        "po_date_utc": {
                                          "type": "string"
                                        },
                                        "po_number": {
                                          "type": "string"
                                        },
                                        "purchase_price": {
                                          "type": "string"
                                        },
                                        "purchasing_account": {
                                          "type": "string"
                                        },
                                        "purchasing_contact": {
                                          "type": "string"
                                        },
                                        "vendor": {
                                          "type": "string"
                                        },
                                        "warranty_expires": {
                                          "type": "string"
                                        },
                                        "warranty_expires_epoch": {
                                          "type": "integer"
                                        },
                                        "warranty_expires_utc": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "security": {
                                      "properties": {
                                        "activation_lock": {
                                          "type": "boolean"
                                        },
                                        "external_boot_level": {
                                          "type": "string"
                                        },
                                        "firewall_enabled": {
                                          "type": "boolean"
                                        },
                                        "recovery_lock_enabled": {
                                          "type": "boolean"
                                        },
                                        "secure_boot_level": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "software": {
                                      "properties": {
                                        "applications": {
                                          "items": {
                                            "properties": {
                                              "bundle_id": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              },
                                              "path": {
                                                "type": "string"
                                              },
                                              "version": {
                                                "type": "string"
                                              }
                                            },
                                            "required": [
                                              "name",
                                              "path",
                                              "version",
                                              "bundle_id"
                                            ],
                                            "type": "object"
                                          },
                                          "type": "array"
                                        },
                                        "available_software_updates": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "available_updates": {
                                          "properties": {
                                            "update": {
                                              "properties": {
                                                "name": {
                                                  "type": "string"
                                                },
                                                "package_name": {
                                                  "type": "string"
                                                },
                                                "version": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "cached_by_casper": {
                                          "type": "array"
                                        },
                                        "fonts": {
                                          "type": "array"
                                        },
                                        "installed_by_casper": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "installed_by_installer_swu": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "licensed_software": {
                                          "type": "array"
                                        },
                                        "plugins": {
                                          "type": "array"
                                        },
                                        "running_services": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "unix_executables": {
                                          "type": "array"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "Send_DeviceLock_command_to_given_computers_JSSID": {
                          "runAfter": {
                            "Generate_a_randomised_6_digit_value": [
                              "Succeeded"
                            ]
                          },
                          "type": "Http",
                          "inputs": {
                            "headers": {
                              "Authorization": "Bearer @{variables('accessToken')}",
                              "accept": "application/json"
                            },
                            "method": "POST",
                            "uri": "@{parameters('jamfProURL')}/JSSResource/computercommands/command/DeviceLock/passcode/@{outputs('Generate_a_randomised_6_digit_value')}/id/@{body('Parse_JSON_for_given_computer_based_on_managementID')?['general']?['site']?['id']}"
                          }
                        }
                      },
                      "runAfter": {
                        "Filter_array_for_the_entity_kind_Host": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Generate_Access_Token_using_API_Client": {
                      "type": "Http",
                      "inputs": {
                        "body": "client_id=@{parameters('jamfProClientID')}&client_secret=@{parameters('jamfProSecret')}&grant_type=client_credentials",
                        "headers": {
                          "Content-Type": "application/x-www-form-urlencoded"
                        },
                        "method": "POST",
                        "uri": "@{parameters('jamfProURL')}/api/oauth/token"
                      },
                      "runtimeConfiguration": {
                        "secureData": {
                          "properties": [
                            "inputs"
                          ]
                        }
                      }
                    },
                    "Parse_JSON_Entities_from_the_Incident": {
                      "runAfter": {
                        "Set_accessToken_as_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "schema": {
                          "items": {
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "kind": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "properties": {
                                "properties": {
                                  "address": {
                                    "type": "string"
                                  },
                                  "friendlyName": {
                                    "type": "string"
                                  }
                                },
                                "type": "object"
                              },
                              "type": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "type",
                              "kind",
                              "properties"
                            ],
                            "type": "object"
                          },
                          "type": "array"
                        }
                      }
                    },
                    "Parse_JSON_Response_from_Access_Token": {
                      "runAfter": {
                        "Generate_Access_Token_using_API_Client": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('Generate_Access_Token_using_API_Client')",
                        "schema": {
                          "properties": {
                            "access_token": {
                              "type": "string"
                            },
                            "expires_in": {
                              "type": "integer"
                            },
                            "scope": {
                              "type": "string"
                            },
                            "token_type": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Set_accessToken_as_variable": {
                      "runAfter": {
                        "Parse_JSON_Response_from_Access_Token": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "accessToken",
                            "type": "string",
                            "value": "@body('Parse_JSON_Response_from_Access_Token')?['access_token']"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Jamf Protect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Thijs Xhaflaire",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Jamf Software, LLC",
                  "email": "support@jamf.com",
                  "tier": "Partner",
                  "link": "https://www.jamf.com/support/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Jamf Protect - Remote lock computer with Jamf Pro",
            "description": "This Playbook can be used manually or in a Automation Rule to send an remote MDM command with Jamf Pro to lock the computer with an randomised 6 digit passcode.",
            "mainSteps": [
              "1. Fetches the Host entity from the Incident created based on event data from Jamf Protect",
              "2. Generates a Access Token using a API Client to authenticate against the Jamf Pro API",
              "3. Retrieves the JSSID and ManagementUUID from Jamf Pro for given computer",
              "4. Sends a remote lock MDM command with a randomised 6 digit passcode",
              "5. Randomised passcode will be stored in the Comments section of the incident itself."
            ],
            "prerequisites": [
              "1. Create an API Client in Jamf Pro that is capable of reading computers and sending remote commands. [learn how](https://learn.jamf.com/bundle/jamf-pro-documentation-current)",
              "2. Use the Client ID and Secret during the deployment of this Playbook"
            ],
            "lastUpdateTime": "2023-07-20T00:00:00Z",
            "tags": [
              "Utilities"
            ],
            "source": {
              "type": "solution",
              "name": "Jamf Protect"
            },
            "postDeployment": [
              "** b. Configurations in Sentinel **",
              "1. This Playbook can be best used as Action while investigating an Incident."
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Jamf Protect - Remote lock computer with Jamf Pro",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "JamfProtect_LockComputer_with_JamfPro",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.3.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Jamf Protect",
        "publisherDisplayName": "Jamf Software, LLC",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Jamf%20Protect/ReleaseNotes.md\">Release Notes</a></p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.jamf.com/solutions/threat-prevention-remediation/\">Jamf Protect</a> solution for Microsoft Sentinel enables you to ingest <a href=\"https://docs.jamf.com/jamf-protect/documentation/Data_Forwarding_to_a_Third_Party_Storage_Solution.html#task-4227\">Jamf Protect events</a> forwarded into Microsoft Sentinel using the Microsoft Sentinel Analytics Workspace.</p>\n<p><strong>Data Connectors:</strong> 1, <strong>Parsers:</strong> 5, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 3, <strong>Playbooks:</strong> 3</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/jamf_logo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Jamf Protect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Thijs Xhaflaire",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Jamf Software, LLC",
          "email": "support@jamf.com",
          "tier": "Partner",
          "link": "https://www.jamf.com/support/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject2').parserContentId2]",
              "version": "[variables('parserObject2').parserVersion2]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject3').parserContentId3]",
              "version": "[variables('parserObject3').parserVersion3]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject4').parserContentId4]",
              "version": "[variables('parserObject4').parserVersion4]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject5').parserContentId5]",
              "version": "[variables('parserObject5').parserVersion5]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_JamfProtect_Alert_Status_InProgress')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_JamfProtect_Alert_Status_Resolved')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_JamfProtect_LockComputer_with_JamfPro')]",
              "version": "[variables('playbookVersion3')]"
            }
          ]
        },
        "firstPublishDate": "2022-10-10",
        "lastPublishDate": "2025-09-02",
        "providers": [
          "Jamf"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection",
            "Security - Automation (SOAR)"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
