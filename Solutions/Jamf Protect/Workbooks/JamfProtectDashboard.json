{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "b608e714-b3ec-4380-b666-1aa781513ab4",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "value": [
              "/subscriptions/cc519aa2-4ddf-4e59-a0c2-a785d967e829"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "includeAll": false
            },
            "label": "‚òÅÔ∏è Subscription"
          },
          {
            "id": "f408f1cf-dbcb-4f57-9409-272374bd3cd4",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "isRequired": true,
            "query": "Resources | where type =~ \"microsoft.operationalinsights/workspaces\" | order by name | project id, name, selected=row_number()==1, group=resourceGroup",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "label": "üóÇÔ∏è Workspace",
            "value": "/subscriptions/cc519aa2-4ddf-4e59-a0c2-a785d967e829/resourceGroups/JamfProtect/providers/Microsoft.OperationalInsights/workspaces/JamfProtect"
          },
          {
            "id": "397d983f-ea80-4aa5-8c65-547d40cb312b",
            "version": "KqlParameterItem/1.0",
            "name": "_timetoken",
            "label": "‚è±Ô∏è Time Range",
            "type": 4,
            "isRequired": true,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "value": {
              "durationMs": 7776000000
            }
          },
          {
            "id": "d716fb1e-0d71-4e99-9406-18ae7df6e037",
            "version": "KqlParameterItem/1.0",
            "name": "changelog",
            "label": "üìñ Changelog",
            "type": 10,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n { \"value\": \"Yes\", \"label\": \"Yes\"},\r\n {\"value\": \"No\", \"label\": \"No\", \"selected\":true }\r\n]"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "Parameters Picker"
    },
    {
      "type": 1,
      "content": {
        "json": "## Jamf Protect for Microsoft Sentinel!\n\nThe [Jamf Protect](https://www.jamf.com/solutions/threat-prevention-remediation/) for Microsoft Sentinel solution creates detailed event data from macOS endpoints into a Microsoft Sentinel workspace in a simple and easy workflow. The solution provides you with full visibility into Apple Endpoint Security by leveraging Workbooks containing [Alert](https://docs.jamf.com/jamf-protect/documentation/Alerts.html) and [Unified Logging](https://docs.jamf.com/jamf-protect/documentation/Unified_Logging.html) events captured by Jamf Protect and the [macOS built-in security events](https://support.apple.com/en-gb/guide/security/sec469d47bd8/web) that occurred across the protected organisational endpoints\n\n\n#### Changelog\n\n**v2.1**\n\n***Workbook***\n - Added Endpoint Telemetry\n    - Includes graphs and visualisations\n\t- Includes Endpoint Information\n\t- Includes Jamf Pro log parser\n- Added Network Threat Events\n \t- Includes graphs and visualisations\n- Added new Pickers\n    - Allows selecting different Log Analytic Workspaces\n    - Changed TimeRanger picker\n- Added Changelog\n\n**Analytic Rules**\n\n- Added Analytic Rules\n\t- Jamf Protect - Alerts\n\t- Jamf Protect - Unified Logs\n\t- Jamf Protect - Network Threat Events\n\n\n **v2.0**\n \n- Initial release of the solution containing a basic Workbook\n"
      },
      "conditionalVisibility": {
        "parameterName": "changelog",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "Text - Changelog"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Threat Hunting {_timetoken:value}",
        "expandable": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "Set an type and provide values to search on File hash, CVE numbers or report on Alerts mapped to the MITRE framework or display latest alerts for a single endpoint.",
              "style": "info"
            },
            "name": "Text - Threat Hunting",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "5f5886d0-e83e-4ffc-a48c-bfed7370aa66",
                  "version": "KqlParameterItem/1.0",
                  "name": "_type",
                  "label": "Type",
                  "type": 2,
                  "description": "Please choose the type",
                  "isGlobal": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\n    { \"value\":\"filehash\", \"label\":\"File Hash\" },\n    { \"value\":\"CVE\", \"label\":\"CVE\" },\n    { \"value\":\"mitre\", \"label\":\"Framework: MITRE\" },\n    { \"value\":\"endpointalerts\", \"label\":\"Latest alerts for a single endpoint\" }\n]",
                  "value": null
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "50",
            "name": "Picker - Threat Hunting Type"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "49255f47-8f93-4746-8260-aad07befdb06",
                  "version": "KqlParameterItem/1.0",
                  "name": "_hostnamealert",
                  "label": "Hostname",
                  "type": 2,
                  "query": "jamfprotect_CL\n| where input_host_hostname_s != \"\"\n| project-keep input_host_hostname_s\n| project-rename Hostname = input_host_hostname_s\n| summarize by Hostname",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "_timetoken",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "value": null
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "_type",
                "comparison": "isNotEqualTo",
                "value": "null"
              },
              {
                "parameterName": "_type",
                "comparison": "isEqualTo",
                "value": "endpointalerts"
              }
            ],
            "name": "Picker - Threat Hunting Hostname"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "bcdd945e-4dfe-47d6-9489-f76ce012c224",
                  "version": "KqlParameterItem/1.0",
                  "name": "_filehash",
                  "label": "File Hash",
                  "type": 1,
                  "description": "Thish value can be used for searching all alerts for a certain hash",
                  "isRequired": true,
                  "isGlobal": true,
                  "value": "5e54bccbd4d93447e79cda0558b0b308a186c2be571c739e5460a3cb6ef665c0"
                }
              ],
              "style": "formHorizontal",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "_type",
              "comparison": "isEqualTo",
              "value": "filehash"
            },
            "name": "Search - Threat Hunting Hash"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "0344768b-16c4-44ec-a4ac-73a8bc83d0e2",
                  "version": "KqlParameterItem/1.0",
                  "name": "_CVE",
                  "label": "CVE Number",
                  "type": 1,
                  "description": "Please search on the CVE number",
                  "isRequired": true,
                  "isGlobal": true,
                  "value": ""
                }
              ],
              "style": "formHorizontal",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "_type",
              "comparison": "isEqualTo",
              "value": "CVE"
            },
            "name": "Search - Threat Hunting CVE"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s == \"GPThreatMatchExecEvent\"\n| where input_related_binaries_s contains \"{_filehash:value}\"\n| extend Severity = case(input_match_severity_d == 0, \"Informational\", input_match_severity_d == 1, \"Low\", input_match_severity_d == 2, \"Medium\", input_match_severity_d == 3, \"High\", \"True\")\n| extend AlertURL = strcat(\"https://\", org_hd_s, \".jamfcloud.com/Alerts/\", input_match_uuid_g)\n| project-keep\n    TimeGenerated,\n    input_match_event_matchValue_s,\n    Severity,\n    input_match_event_matchType_s,\n    input_match_event_process_args_s,\n    input_host_hostname_s,\n    AlertURL\n| project-rename\n    Related_To = input_match_event_matchValue_s,\n    EventType = input_match_event_matchType_s,\n    Alert_Severity = Severity,\n    Process_Arguments = input_match_event_process_args_s,\n    Hostname = input_host_hostname_s\n| project-reorder\n    TimeGenerated,\n    Alert_Severity,\n    EventType,\n    Related_To,\n    Process_Arguments,\n    Alert_Severity,\n    Hostname,\n    AlertURL\n| sort by TimeGenerated\n",
              "size": 4,
              "title": "Matches on FileHash",
              "noDataMessage": "No matches found based on the hash value",
              "timeContextFromParameter": "_timetoken",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AlertURL",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url"
                    }
                  }
                ]
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "_filehash",
                "comparison": "isNotEqualTo",
                "value": "null"
              },
              {
                "parameterName": "_type",
                "comparison": "isEqualTo",
                "value": "filehash"
              }
            ],
            "name": "Query - Threat Hunting Hash"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where parse_json(input_match_tags_s) contains \"{_CVE:value}\"\n| extend Severity = case(input_match_severity_d == 0, \"Informational\", input_match_severity_d == 1, \"Low\", input_match_severity_d == 2, \"Medium\", input_match_severity_d == 3, \"High\", \"True\")\n| project-keep\n    TimeGenerated,\n    input_match_event_matchValue_s,\n    input_match_tags_s,\n    Severity,\n    input_match_event_matchType_s,\n    input_match_event_process_args_s,\n    input_host_hostname_s\n| project-rename\n    Related_To = input_match_event_matchValue_s,\n    CVE = input_match_tags_s,\n    EventType = input_match_event_matchType_s,\n    Alert_Severity = Severity,\n    Process_Arguments = input_match_event_process_args_s,\n    Hostname = input_host_hostname_s\n| sort by TimeGenerated",
              "size": 4,
              "title": "Matches on CVE",
              "noDataMessage": "No matches found based on the _CVE:value CVE number",
              "timeContextFromParameter": "_timetoken",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "_cve",
                "comparison": "isNotEqualTo",
                "value": "null"
              },
              {
                "parameterName": "_type",
                "comparison": "isEqualTo",
                "value": "CVE"
              }
            ],
            "name": "Query - Threat Hunting CVE"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where parse_json(input_match_tags_s) contains \"MITREattack\"\n| extend Severity = case(input_match_severity_d == 0, \"Informational\", input_match_severity_d == 1, \"Low\", input_match_severity_d == 2, \"Medium\", input_match_severity_d == 3, \"High\", \"True\")\n| extend AlertURL = strcat(\"https://\", org_hd_s, \".jamfcloud.com/Alerts/\", input_match_uuid_g)\n| extend Analytic = parse_json(input_match_facts_s)[0].name\n| extend Description = parse_json(input_match_facts_s)[0].human\n| project-keep\n    TimeGenerated,\n    input_eventType_s,\n    Analytic,\n    Description,\n    input_match_tags_s,\n    Severity,\n    input_host_hostname_s,\n    AlertURL\n| project-rename\n    EventType = input_eventType_s,\n    TAGS = input_match_tags_s,\n    Alert_Severity = Severity,\n    Hostname = input_host_hostname_s\n| project-reorder\n    TimeGenerated,\n    EventType,\n    Analytic,\n    Description,\n    TAGS,\n    Alert_Severity,\n    Hostname,\n    AlertURL\n| sort by TimeGenerated",
              "size": 4,
              "title": "Alerts mapped to MITRE",
              "noDataMessage": "No alerts found that are mapped to the MITRE framework",
              "timeContextFromParameter": "_timetoken",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AlertURL",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url"
                    }
                  }
                ],
                "sortBy": [
                  {
                    "itemKey": "TimeGenerated",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "TimeGenerated",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "_type",
                "comparison": "isNotEqualTo",
                "value": "null"
              },
              {
                "parameterName": "_type",
                "comparison": "isEqualTo",
                "value": "mitre"
              }
            ],
            "name": "Query - Threat Hunting MITRE"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_host_hostname_s contains \"{_hostnamealert:value}\"\n| where topicType_s == \"alert\" and input_eventType_s <> \"\"\n| extend Severity = case(input_match_severity_d == 0, \"Informational\", input_match_severity_d == 1, \"Low\", input_match_severity_d == 2, \"Medium\", input_match_severity_d == 3, \"High\", \"True\")\n| extend AlertURL = strcat(\"https://\", org_hd_s, \".jamfcloud.com/Alerts/\", input_match_uuid_g)\n| extend Analytic = parse_json(input_match_facts_s)[0].name\n| extend Description = parse_json(input_match_facts_s)[0].human\n| project-keep\n    TimeGenerated,\n    input_eventType_s,\n    Analytic,\n    Description,\n    input_match_tags_s,\n    Severity,\n    input_host_hostname_s,\n    AlertURL\n| project-rename\n    EventType = input_eventType_s,\n    TAGS = input_match_tags_s,\n    Alert_Severity = Severity,\n    Hostname = input_host_hostname_s\n| project-reorder\n    TimeGenerated,\n    EventType,\n    Analytic,\n    Description,\n    TAGS,\n    Alert_Severity,\n    Hostname,\n    AlertURL\n| sort by TimeGenerated\n| limit 10",
              "size": 4,
              "title": "Recent 10 alerts in the past {_timetoken:value} for {_hostnamealert:value}",
              "noDataMessage": "No alerts found",
              "timeContextFromParameter": "_timetoken",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AlertURL",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url"
                    }
                  }
                ],
                "sortBy": [
                  {
                    "itemKey": "TimeGenerated",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "TimeGenerated",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "_type",
                "comparison": "isNotEqualTo",
                "value": "null"
              },
              {
                "parameterName": "_type",
                "comparison": "isEqualTo",
                "value": "endpointalerts"
              },
              {
                "parameterName": "_hostnamealert",
                "comparison": "isNotEqualTo",
                "value": ""
              }
            ],
            "name": "Query - Threat Hunting 10 Recent Alerts Endpoint"
          }
        ]
      },
      "customWidth": "100",
      "name": "Group - Threat Hunting",
      "styleSettings": {
        "margin": "200",
        "padding": "200",
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "datatable (Count: long, severity: string) [\n    0, \"Informational\",\n    0, \"Low\",\n    0, \"Medium\",\n    0, \"High\"\n]\n| union\n    (\n    jamfprotect_CL\n    | where topicType_s == \"alert\" and input_eventType_s <> \"\"\n    | extend severity = case(input_match_severity_d == 0, \"Informational\", input_match_severity_d == 1, \"Low\", input_match_severity_d == 2, \"Medium\", input_match_severity_d == 3, \"High\", \"True\")\n    | where severity != \"True\"\n    | summarize Count = count() by severity\n    )\n| where isnotempty(severity)\n| summarize Count=sum(Count) by severity",
        "size": 3,
        "title": "All Alerts {_timetoken:value}",
        "timeContextFromParameter": "_timetoken",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "severity",
            "formatter": 18,
            "formatOptions": {
              "thresholdsOptions": "colors",
              "thresholdsGrid": [
                {
                  "operator": "==",
                  "thresholdValue": "Informational",
                  "representation": "green",
                  "text": "{0}{1}"
                },
                {
                  "operator": "==",
                  "thresholdValue": "Low",
                  "representation": "yellow",
                  "text": "{0}{1}"
                },
                {
                  "operator": "==",
                  "thresholdValue": "Medium",
                  "representation": "orange",
                  "text": "{0}{1}"
                },
                {
                  "operator": "==",
                  "thresholdValue": "High",
                  "representation": "redBright",
                  "text": "{0}{1}"
                },
                {
                  "operator": "Default",
                  "thresholdValue": null,
                  "representation": "green",
                  "text": "{0}{1}"
                }
              ],
              "compositeBarSettings": {
                "labelText": "",
                "columnSettings": []
              }
            }
          },
          "leftContent": {
            "columnMatch": "Count",
            "formatter": 1,
            "numberFormat": {
              "unit": 0,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "minimumSignificantDigits": 1,
                "maximumSignificantDigits": 3
              },
              "emptyValCustomText": "0"
            }
          },
          "showBorder": true,
          "sortOrderField": 1
        }
      },
      "name": "Datatable - Alerts per Severity"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "jamfprotect_CL\n| where topicType_s == \"alert\"\n    and input_eventType_s <> \"\"\n| extend severity = case(input_match_severity_d == 0, \"Informational\", input_match_severity_d == 1, \"Low\", input_match_severity_d == 2, \"Medium\", input_match_severity_d == 3, \"High\", \"True\")\n| where severity != \"True\"\n| summarize count() by severity, bin(TimeGenerated,{_timetoken:grain})\n| render areachart ",
        "size": 0,
        "title": "Events Detected (Count By Severity) {_timetoken:value}",
        "timeContextFromParameter": "_timetoken",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "chartSettings": {
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "0",
              "label": "Informational"
            },
            {
              "seriesName": "1",
              "label": "Low"
            },
            {
              "seriesName": "2",
              "label": "Medium"
            },
            {
              "seriesName": "3",
              "label": "High"
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "Query - Events detected by Severity"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "jamfprotect_CL\n\n| where input_eventType_s == \"GPUnifiedLogEvent\"\n| extend name_ = tostring(parse_json(input_match_facts_s)[0].name)\n| where isnotempty(name_)\n| summarize count() by name_, bin(TimeGenerated,{_timetoken:grain})\n| render areachart ",
        "size": 0,
        "title": "Unified Logging Events {_timetoken:value}",
        "timeContextFromParameter": "_timetoken",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ]
      },
      "customWidth": "50",
      "name": "Query - Unified Logs",
      "styleSettings": {
        "maxWidth": "50"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "jamfprotect_CL\n| where topicType_s == \"alert\" and input_eventType_s <> \"\" and input_host_hostname_s <> \"\"\n| summarize Event = count() by input_host_hostname_s\n| project-rename HostName = input_host_hostname_s\n| sort by Event desc",
        "size": 3,
        "title": "Most Active Endpoints (Total, last {_timetoken:value})",
        "timeContextFromParameter": "_timetoken",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "tileSettings": {
          "showBorder": false,
          "titleContent": {
            "columnMatch": "HostName",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "Event",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "graphSettings": {
          "type": 0,
          "topContent": {
            "columnMatch": "HostName",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "Event",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        }
      },
      "customWidth": "100",
      "name": "Query - Most active endpoints with Alerts",
      "styleSettings": {
        "maxWidth": "100"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "jamfprotect_CL\n| where topicType_s == \"alert\" and input_eventType_s <> \"\"\n| summarize Events = count() by Type, bin(TimeGenerated,{_timetoken:grain})\n| render columnchart   ",
        "size": 0,
        "title": "Events detected (Total by date, {_timetoken:value})",
        "timeContextFromParameter": "_timetoken",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "jamfprotect_CL",
              "label": "Jamf Protect"
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "Query - Total events detected",
      "styleSettings": {
        "maxWidth": "50"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "jamfprotect_CL\n| where input_eventType_s <> \"\"\n| summarize Events = count() by input_eventType_s, bin(TimeGenerated,{_timetoken:grain})\n| render areachart with(kind=stacked)\n",
        "size": 0,
        "title": "Events Detected (Count by Type, {_timetoken:value})",
        "timeContextFromParameter": "_timetoken",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "areachart",
        "gridSettings": {
          "sortBy": [
            {
              "itemKey": "Events",
              "sortOrder": 2
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "Events",
            "sortOrder": 2
          }
        ]
      },
      "customWidth": "50",
      "name": "Query - Events detected counted by Type",
      "styleSettings": {
        "maxWidth": "50"
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Event Types",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s <> \"\"\n| summarize Events = count() by input_eventType_s\n| render piechart",
              "size": 3,
              "title": "Event Types {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "33",
            "name": "Query - Events by Type",
            "styleSettings": {
              "maxWidth": "100"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s == \"GPFSEvent\"\n| extend name_ = tostring(parse_json(input_match_facts_s)[0].name)\n| summarize count() by name_\n| render piechart ",
              "size": 3,
              "title": "File System Event Types {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "33",
            "name": "Query - File System Events"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s == \"GPProcessEvent\"\n| extend name_ = tostring(parse_json(input_match_facts_s)[0].name)\n| summarize count() by name_\n| render piechart \n",
              "size": 3,
              "title": "Process Event Types {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "33",
            "name": "Query - Process Event Types"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s == \"GPUSBEvent\"\nor input_eventType_s == \"GPFSEvent\" and tostring(parse_json(input_match_facts_s)[0].name) == \"USBWrite\"\n| extend name_ = tostring(parse_json(input_match_facts_s)[0].name)\n| summarize count() by name_\n| render piechart ",
              "size": 3,
              "title": "USB Event Types {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "33",
            "name": "Query - USB Event Types"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s == \"GPGatekeeperEvent\"\n| extend name_ = tostring(parse_json(input_match_facts_s)[0].name)\n| summarize count() by name_\n| render piechart ",
              "size": 3,
              "title": "Gatekeeper Event Types {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "GatekeeperBlockedSigned",
                    "label": "Signed"
                  },
                  {
                    "seriesName": "GatekeeperBlockedRevoked",
                    "label": "Revoked"
                  },
                  {
                    "seriesName": "GatekeeperBlockedUnsignedOrUnknown",
                    "label": "UnsignedOrUnknown"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "Query - GateKeeper Events"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s == \"GPThreatMatchExecEvent\"\n| summarize Threat = count() by input_match_event_matchValue_s\n| render piechart ",
              "size": 3,
              "title": "Threat Prevention Types {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "33",
            "name": "Query - Threat Prevention Types"
          }
        ]
      },
      "name": "Group - Event Types"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "jamfprotect_CL\n| where input_eventType_s <> \"\"\n| extend name_ = tostring(parse_json(input_match_facts_s)[0].name)\n| summarize count() by input_eventType_s, name_\n| project-rename EventType = input_eventType_s, Event = name_, Count = count_\n| sort by Count desc\n| limit 10",
        "size": 3,
        "title": "Top 10 Event Types {_timetoken:value}",
        "timeContextFromParameter": "_timetoken",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ]
      },
      "customWidth": "50",
      "name": "Query - Top 10 Events",
      "styleSettings": {
        "maxWidth": "50"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "jamfprotect_CL\n| where input_eventType_s == \"GPPreventedExecutionEvent\"\n| where input_host_hostname_s <> \"\"\n| extend SigningID = parse_json(input_match_event_process_signingInfo_s).teamid\n| extend BundleID = parse_json(input_match_event_process_signingInfo_s).appid\n| project-keep input_match_event_process_name_s, SigningID, BundleID\n| project-rename Process = input_match_event_process_name_s\n| summarize Count= count() by Process, tostring(BundleID), tostring(SigningID)\n| sort by Count asc nulls first\n| limit 25",
        "size": 0,
        "title": "Process Blocked by Custom Prevent List {_timetoken:value}",
        "timeContextFromParameter": "_timetoken",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ]
      },
      "customWidth": "50",
      "name": "Query - Process Blocked by Custom Prevent List"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "macOS Built-In Security Tools",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s == \"GPGatekeeperEvent\"\n| extend name_ = tostring(parse_json(input_match_facts_s)[0].name)\n| summarize count() by name_, input_match_event_path_s\n| project-rename BlockType = name_, Executable = input_match_event_path_s, Count = count_\n| sort by Count desc\n| limit 10",
              "size": 3,
              "title": "Top Gatekeeper Blocked Items {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "Count",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Count",
                  "sortOrder": 2
                }
              ]
            },
            "customWidth": "50",
            "name": "Query - Top Blocked GateKeepers events"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s == \"GPUnifiedLogEvent\"\n| where input_match_event_subsystem_s == \"com.apple.XProtectFramework.PluginAPI\"\n| where tostring(parse_json(input_match_event_composedMessage_s).status_message) <> \"[]\"\n| extend status_message_ = tostring(parse_json(input_match_event_composedMessage_s).status_message)\n| extend execution_duration_ = tostring(parse_json(input_match_event_composedMessage_s).execution_duration)\n| project \n    Time=TimeGenerated, \n    Hostname=input_host_hostname_s, \n    Status=status_message_, \n    Module=input_match_event_process_s, \n    Execution_Duration=execution_duration_\n| sort by Time desc\n| limit 25",
              "size": 0,
              "title": "XProtect Remediator Scans {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "50",
            "name": "Query - XProtect Remediator Activity"
          }
        ]
      },
      "name": "macOS Built-In Security Tools Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Device Controls",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s == \"auth-mount\"\n| extend name_ = tostring(parse_json(input_match_facts_s)[1].name)\n| where name_ == \"EnforcedRemovableDevicePolicy\"\n| extend name_ = replace(\"EnforcedRemovableDevicePolicy\", \"Blocked\", name_)\n| summarize count() by name_\n\n",
              "size": 2,
              "title": "Device Controls Blocked {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "titleContent": {
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "thresholdValue": "Alerts",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Notifications",
                        "text": "Devices Blocked"
                      }
                    ]
                  }
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": true,
                "sortOrderField": 2
              },
              "graphSettings": {
                "type": 0,
                "topContent": {},
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "showMetrics": false
              },
              "mapSettings": {
                "locInfo": "LatLong",
                "sizeSettings": "count_",
                "sizeAggregation": "Sum",
                "legendMetric": "count_",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "type": "heatmap",
                  "colorAggregation": "Sum",
                  "nodeColorField": "count_",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "25",
            "name": "Query - Blocked USB Events",
            "styleSettings": {
              "maxWidth": "25"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where input_eventType_s == \"auth-mount\"\n| extend name_ = tostring(parse_json(input_match_facts_s)[1].name)\n| where name_ == \"EnforcedRemovableDevicePolicy\"\n| extend device_ = strcat(input_match_event_device_vendorName_s, \" \",input_match_event_device_productName_s)\n| summarize count() by input_host_hostname_s, device_\n| project-rename Hostname = input_host_hostname_s, Device = device_, Count = count_\n| sort by Count desc\n\n",
              "size": 1,
              "title": "Device Controls Endpoint {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "65",
            "name": "Query - Blocked USB Devices",
            "styleSettings": {
              "maxWidth": "100"
            }
          }
        ]
      },
      "name": "Group - Device Controls",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Endpoint Telemetry",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where identity_signer_id_s == \"com.apple.sudo\"\n    and exec_chain_child_parent_path_s == \"/usr/bin/sudo\"\n    and subject_effective_user_name_s == \"root\"\n    and subject_audit_user_name_s != \"-1\"\n| extend binary=parse_json(path_s)[0]\n| extend Compiled_Arguments = strcat(binary, \" \", exec_args_args_2_s, \" \", exec_args_args_3_s)\n| project-keep\n    TimeGenerated,\n    host_info_host_name_s,\n    subject_audit_user_name_s,\n    Compiled_Arguments\n| project-rename Hostname = host_info_host_name_s, Elevated_User = subject_audit_user_name_s\n| limit 10\n| sort by TimeGenerated",
              "size": 0,
              "title": "Succesful sudo events {_timetoken:value}",
              "noDataMessage": "No events occured",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Query - Successful sudo events"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n//| where subject_terminal_id_ip_address_s != \"0.0.0.0\" and header_event_name_s != \"AUE_SESSION_START\" and header_event_name_s != \"PLAINTEXT_LOG_COLLECTION_EVENT\" and header_event_name_s != \"BIOS_FIRMWARE_VERSIONS\" and header_event_name_s != \"SYSTEM_PERFORMANCE_METRICS\" and header_event_name_s != \"RATE_LIMITING_APPLIED\"\n| where subject_terminal_id_ip_address_s != \"0.0.0.0\" and header_event_name_s == \"AUE_EXECVE\"\n    or subject_terminal_id_ip_address_s != \"0.0.0.0\" and header_event_name_s == \"AUE_logout\"\n    or subject_terminal_id_ip_address_s != \"0.0.0.0\" and header_event_name_s == \"AUE_SESSION_CLOSE\"\n    or subject_terminal_id_ip_address_s != \"0.0.0.0\" and header_event_name_s == \"AUE_openssh\"\n| where isnotempty(host_info_host_name_s)\n| where isnotempty(header_event_name_s)\n| where topicType_s != \"alert\"\n| extend binary=parse_json(path_s)[0]\n| extend Compiled_Arguments = strcat(binary, \" \", exec_args_args_2_s, \" \", exec_args_args_3_s, \" \", exec_args_args_4_s)\n| project-keep\n    TimeGenerated,\n    header_event_name_s,\n    return_description_s,\n    host_info_host_name_s,\n    subject_terminal_id_ip_address_s,\n    subject_audit_user_name_s,\n    subject_process_name_s,\n    Compiled_Arguments\n| project-rename\n    EventName = header_event_name_s,\n    Description = return_description_s,\n    Hostname = host_info_host_name_s,\n    Process_Name = subject_process_name_s,\n    IP_Adress = subject_terminal_id_ip_address_s,\n    Elevated_User = subject_audit_user_name_s\n| limit 15\n| sort by TimeGenerated",
              "size": 0,
              "title": "Remotely Controlled Commands (Outbound) {_timetoken:value}",
              "noDataMessage": "No events occured",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "sortBy": []
            },
            "name": "Query - Remotely Controlled Commands"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL \n| where isnotnull(host_info_host_name_s)\n| where isnotnull(subject_process_name_s)\n| project-keep TimeGenerated, exec_chain_child_parent_path_s, subject_process_name_s\n| project-rename\n    Process = exec_chain_child_parent_path_s,\n    Parent_Process = subject_process_name_s\n| summarize Rare_Process_Count = count() by Parent_Process, Process\n| sort by Rare_Process_Count asc nulls first\n| limit 100",
              "size": 0,
              "title": "Rare Process Executions (All Executions) {_timetoken:value}",
              "noDataMessage": "No events occured",
              "timeContextFromParameter": "_timetoken",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "100",
            "name": "Query - Rare Process Executions"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where host_info_host_name_s != \"\" and exec_chain_child_parent_path_s != \"\"\n| project\n    host_info_host_name_s,\n    subject_process_name_s,\n    exec_chain_child_parent_path_s,\n    exec_chain_thread_uuid_g\n| summarize\n    thread_uuid = make_set(exec_chain_thread_uuid_g, 128),\n    host = make_set(host_info_host_name_s, 128),\n    process= make_set(subject_process_name_s, 128)\n    by exec_chain_child_parent_path_s\n| project \n    host, \n    process, \n    parent_process=exec_chain_child_parent_path_s, \n    thread_uuid",
              "size": 0,
              "title": "Parent/child process with thread uuid {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "100",
            "name": "Query - Parent and Child Process UUID"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Endpoint Information",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "jamfprotect_CL\n| where header_event_name_s == \"BIOS_FIRMWARE_VERSIONS\" and isnotempty(bios_firmware_versions_release_date_s)\n| project bios_firmware_versions_release_date_s, host_info_host_name_s\n| project-rename Firmware_release_date = bios_firmware_versions_release_date_s, Hostname = host_info_host_name_s\n| summarize arg_max(Firmware_release_date, *) by Hostname\n| summarize Count=count() by Firmware_release_date\n| render piechart by Count\n\n",
                    "size": 0,
                    "title": "Intel clients on firmware releases by date {_timetoken:value}",
                    "timeContextFromParameter": "_timetoken",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "sortBy": [],
                    "tileSettings": {
                      "showBorder": false
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {},
                      "nodeIdField": "Hostname",
                      "sourceIdField": "Hostname",
                      "targetIdField": "Hostname",
                      "graphOrientation": 3,
                      "showOrientationToggles": false,
                      "nodeSize": null,
                      "staticNodeSize": 100,
                      "colorSettings": null,
                      "hivesMargin": 5
                    },
                    "mapSettings": {
                      "locInfo": "LatLong"
                    }
                  },
                  "customWidth": "25",
                  "name": "Query - Intel Clients Firmware Release"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "jamfprotect_CL\n| where header_event_name_s == \"BIOS_FIRMWARE_VERSIONS\" and isnotempty(bios_firmware_versions_version_s)\n| project bios_firmware_versions_version_s, host_info_host_name_s\n| project-rename Firmware_Version = bios_firmware_versions_version_s, Hostname = host_info_host_name_s\n| summarize arg_max(Firmware_Version, *) by Hostname\n| summarize Count=count() by Firmware_Version\n| render piechart by Count",
                    "size": 0,
                    "title": "Intel clients firmware versions {_timetoken:value}",
                    "timeContextFromParameter": "_timetoken",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "sortBy": []
                  },
                  "customWidth": "25",
                  "name": "Query - Intel Firmware Versions"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "jamfprotect_CL\n| where header_event_name_s == \"BIOS_FIRMWARE_VERSIONS\" and isnotempty(bios_firmware_versions_system_firmware_version_s)\n| project bios_firmware_versions_system_firmware_version_s, host_info_host_name_s\n| project-rename Firmware_Version = bios_firmware_versions_system_firmware_version_s, Hostname = host_info_host_name_s\n| summarize arg_max(Firmware_Version, *) by Hostname\n| summarize Count=count() by Firmware_Version\n| render piechart by Count",
                    "size": 0,
                    "title": "Silicon clients firmware versions {_timetoken:value}",
                    "timeContextFromParameter": "_timetoken",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "sortBy": []
                  },
                  "customWidth": "25",
                  "name": "Query - Silicon Firmware Releases"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "jamfprotect_CL\n| where header_event_name_s == \"BIOS_FIRMWARE_VERSIONS\"\n| project architecture_s, host_info_host_name_s\n| project-rename Architectures = architecture_s, Hostname = host_info_host_name_s\n| summarize arg_max(Architectures, *) by Hostname\n| summarize Count=count() by Architectures\n| render piechart by Count\n",
                    "size": 0,
                    "title": "Architectures {_timetoken:value}",
                    "timeContextFromParameter": "_timetoken",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "architecture_s",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "architecture_s",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "25",
                  "name": "Query - Architecture Split"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "jamfprotect_CL\n| where isnotempty(host_info_osversion_s)\n| project host_info_osversion_s, host_info_host_name_s\n| project-rename Host_OS_Version = host_info_osversion_s, Hostname = host_info_host_name_s\n| summarize arg_max(Host_OS_Version, *) by Hostname\n| summarize Count=count() by Host_OS_Version\n| render piechart by Count\n\n",
                    "size": 0,
                    "title": "OS Versions {_timetoken:value}",
                    "timeContextFromParameter": "_timetoken",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "sortBy": [],
                    "tileSettings": {
                      "showBorder": false
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {},
                      "nodeIdField": "Hostname",
                      "sourceIdField": "Hostname",
                      "targetIdField": "Hostname",
                      "graphOrientation": 3,
                      "showOrientationToggles": false,
                      "nodeSize": null,
                      "staticNodeSize": 100,
                      "colorSettings": null,
                      "hivesMargin": 5
                    },
                    "mapSettings": {
                      "locInfo": "LatLong"
                    }
                  },
                  "customWidth": "30",
                  "name": "Query - OS Versions"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Jamf Log Parser {_timetoken:value}",
                    "expandable": true,
                    "expanded": true,
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "Please select a hostname in order to show the latest jamf.log files.",
                          "style": "info"
                        },
                        "conditionalVisibility": {
                          "parameterName": "_hostnamelogparser",
                          "comparison": "isEqualTo"
                        },
                        "name": "Text - Jamf Log Parser Note",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "parameters": [
                            {
                              "id": "f747e125-851e-45f7-b500-5d22049da6a6",
                              "version": "KqlParameterItem/1.0",
                              "name": "_hostnamelogparser",
                              "label": "Hostname",
                              "type": 2,
                              "query": "jamfprotect_CL\n| where input_host_hostname_s != \"\"\n| project-keep input_host_hostname_s\n| project-rename Hostname = input_host_hostname_s\n| summarize by Hostname",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "_timetoken",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "value": "LMAC-ZW0GTLVDL"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "customWidth": "40",
                        "name": "Picker - Hostname"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "jamfprotect_CL\n| where header_event_name_s contains \"PLAINTEXT_LOG_COLLECTION_EVENT\"\n    and host_info_host_name_s == \"{_hostnamelogparser:value}\"\n    and parse_json(path_s)[0] == \"/var/log/jamf.log\"\n| project texts_s, TimeGenerated\n| project-rename JamfLogs = texts_s\n| project-reorder TimeGenerated, JamfLogs\n| mv-expand parse_json(JamfLogs)\n| sort by TimeGenerated desc\n| limit 250",
                          "size": 0,
                          "title": "Jamf Pro Local Logs",
                          "noDataMessage": "No matches found based on the hostname",
                          "timeContextFromParameter": "_timetoken",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "TimeGenerated",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "JamfLogs",
                                "formatter": 1,
                                "formatOptions": {
                                  "customColumnWidthSetting": "100ch"
                                }
                              }
                            ]
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "_hostnamelogparser",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Query - Parse Jamf Pro Logs"
                      }
                    ]
                  },
                  "customWidth": "70",
                  "name": "Group - Jamf Log Parser",
                  "styleSettings": {
                    "margin": "200",
                    "padding": "200",
                    "showBorder": true
                  }
                }
              ]
            },
            "name": "Group - Endpoint Information"
          }
        ]
      },
      "name": "Group - Telemetry",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Network Threat Events",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\"\n    and event_action_s == \"Blocked\"\n| extend blocks = case(event_action_s == \"Blocked\", \"Blocked\", \"True\")\n| summarize arg_max(event_action_s, *) by event_timestamp_t\n| summarize Count = count() by blocks\n\n",
              "size": 4,
              "title": "Threats blocked by NTP {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Count",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "colors",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "0",
                        "representation": "green",
                        "text": "Threats blocked by NTP"
                      },
                      {
                        "operator": "<",
                        "thresholdValue": "15",
                        "representation": "gray",
                        "text": "Threats blocked by NTP"
                      },
                      {
                        "operator": "<",
                        "thresholdValue": "30",
                        "representation": "orange",
                        "text": "Threats blocked by NTP"
                      },
                      {
                        "operator": ">",
                        "thresholdValue": "50",
                        "representation": "redBright",
                        "text": "Threats blocked by NTP"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "gray",
                        "text": "Threats blocked by NTP"
                      }
                    ],
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": []
                    }
                  }
                },
                "leftContent": {
                  "columnMatch": "Count",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true,
                      "minimumSignificantDigits": 1,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "0"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "blocks",
                "sortOrderField": 1,
                "size": "auto"
              }
            },
            "name": "Query - Threats blocked by NTP"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\"\n| extend severity_ = tostring(event_severity_d)\n| extend severity_ = case(event_severity_d == 2, \"Very low\", event_severity_d == 4, \"Low\", event_severity_d == 6, \"Medium\", event_severity_d == 8, \"High\", event_severity_d == 10, \"Very High\", \"True\")\n| where isnotempty(severity_)\n| summarize arg_max(severity_, *) by event_timestamp_t\n| summarize count() by severity_, bin(TimeGenerated,{_timetoken:grain})\n| render areachart ",
              "size": 0,
              "title": "Network Events Detected (Count By Severity) {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "50",
            "name": "Query - Network Events by Severity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\"\n    and event_device_userDeviceName_s <> \"\"\n    and event_eventType_name_s <> \"\"\n| summarize arg_max(event_device_userDeviceName_s, *) by event_timestamp_t\n| summarize Event = count() by event_device_userDeviceName_s\n| project-rename HostName = event_device_userDeviceName_s\n| sort by Event desc",
              "size": 0,
              "title": "Most Active Endpoints (Total, last {_timetoken:value})",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "50",
            "name": "Query - Most Active Endoints with Alerts"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\"\n    and event_eventType_name_s <> \"\"\n| summarize arg_max(event_eventType_description_s, *) by event_timestamp_t\n| summarize Events = count() by event_eventType_description_s, bin(TimeGenerated, {_timetoken:grain})\n| render areachart with(kind=stacked)",
              "size": 0,
              "title": "Network Events Detected (Count by Type, {_timetoken:value})",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "50",
            "name": "Query - Network Events by Category"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\"\n    and event_eventType_name_s <> \"\"\n| summarize arg_max(event_eventType_description_s, *) by event_timestamp_t\n| summarize Events = count() by event_eventType_description_s\n| render piechart",
              "size": 0,
              "title": "Event Types {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "50",
            "name": "Query - Network Events by Description"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\" \n    and event_eventType_name_s <> \"\"\n| extend name_ = event_eventType_description_s\n| summarize arg_max(event_destination_name_s, *) by event_timestamp_t\n| summarize count() by event_destination_name_s, event_eventType_description_s\n| project-rename\n    Destination = event_destination_name_s,\n    EventType = event_eventType_description_s,\n    Count = count_\n| sort by Count desc\n| limit 10",
              "size": 0,
              "title": "Top 10 Blocked destinations {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "50",
            "name": "Query - Top 10 blocked destinations"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "jamfprotect_CL\n| where event_metadata_product_s == \"Threat Events Stream\" \n    and event_destination_ip_s <> \"\"\n| extend name_ = event_eventType_description_s\n| summarize arg_max(event_destination_ip_s, *) by event_timestamp_t\n| summarize count() by event_destination_ip_s\n| project-rename\n    IP_Address = event_destination_ip_s,\n    Count = count_\n| sort by Count desc\n| limit 10",
              "size": 0,
              "title": "Top 10 Blocked IPs {_timetoken:value}",
              "timeContextFromParameter": "_timetoken",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "50",
            "name": "Query - Top 10 Blocked IPs"
          }
        ]
      },
      "name": "Network Threat Events - Group",
      "styleSettings": {
        "showBorder": true
      }
    }
  ],
  "fromTemplateId": "sentinel-JamfProtectDashboard",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}