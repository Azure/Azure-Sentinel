{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "functionName": {
            "defaultValue": "TenableVM",
            "minLength": 1,
            "maxLength": 11,
            "type": "string"
        },
        "WorkspaceName": {
            "type": "string",
            "minLength": 1,
            "metadata": {
                "description": "Log analytics workspace name. Can be found under Log analytics \"Settings\"."
            }
        },
        "TenableAccessKey": {
            "type": "securestring",
            "metadata": {
                "description": "Enter Access key for using the Tenable API."
            }
        },
        "TenableSecretKey": {
            "type": "securestring",
            "metadata": {
                "description": "Enter Tenable Secret Key for Authentication."
            }
        },
        "Location": {
            "defaultValue": "[resourceGroup().location]",
            "type": "string",
            "metadata": {
                "description": "The location in which the data collection rules and data collection endpoints should be deployed."
            }
        },
        "AzureClientID": {
            "type": "string",
            "minLength": 1,
            "metadata": {
                "description": "Enter Azure Client Id that you have created during app registration"
            }
        },
        "AzureClientSecret": {
            "type": "securestring",
            "minLength": 1,
            "metadata": {
                "description": "Enter Azure Client Secret that you have created during creating the client secret"
            }
        },
        "TenantID": {
            "type": "string",
            "minLength": 1,
            "metadata": {
                "description": "Enter Tenant Id of your Microsoft Entra ID"
            }
        },
        "AzureEntraObjectID": {
            "type": "string",
            "minLength": 1,
            "metadata": {
                "description": "Enter Object id of your Microsoft Entra App"
            }
        },
        "Lowest Severity to Store": {
            "defaultValue": "Info",
            "allowedValues": [
                "Critical",
                "High",
                "Medium",
                "Low",
                "Info"
            ],
            "metadata": {
                "description": "The Lowest Vulnerability severity to store."
            },
            "type": "string"
        },
        "ComplianceDataIngestion": {
            "type": "bool",
            "defaultValue": false,
            "metadata": {
                "description": "Select true if you want to enable Compliance data ingestion from Tenable VM. Default is false."
            },
            "allowedValues": [
                true,
                false
            ]
        },
        "WASAssetDataIngestion": {
            "type": "bool",
            "defaultValue": false,
            "metadata": {
                "description": "Select true if you want to enable WAS Asset data ingestion from Tenable VM. Default is false."
            },
            "allowedValues": [
                true,
                false
            ]
        },
        "WASVulnerabilityDataIngestion": {
            "type": "bool",
            "defaultValue": false,
            "metadata": {
                "description": "Select true if you want to enable WAS Vulnerability data ingestion from Tenable VM. Default is false."
            },
            "allowedValues": [
                true,
                false
            ]
        },
        "Lowest Severity to Store for WAS": {
            "defaultValue": "Info",
            "allowedValues": [
                "Critical",
                "High",
                "Medium",
                "Low",
                "Info"
            ],
            "metadata": {
                "description": "The Lowest Vulnerability severity to store for WAS Vuln."
            },
            "type": "string"
        },
        "TenableExportScheduleInMinutes": {
            "type": "int",
            "defaultValue": 1440,
            "metadata": {
                "description": "Schedule in minutes to create new export job from Tenable VM."
            }
        },
        "AssetTableName": {
            "type": "string",
            "defaultValue": "Tenable_VM_Asset",
            "minLength": 1,
            "metadata": {
                "description": "Enter name of the table used to store Asset Data logs. Please do not keep this field as empty else you will get validation error."
            }
        },
        "VulnTableName": {
            "type": "string",
            "defaultValue": "Tenable_VM_Vuln",
            "minLength": 1,
            "metadata": {
                "description": "Enter name of the table used to store Vulnerability Data logs. Please do not keep this field as empty else you will get validation error."
            }
        },
        "ComplianceTableName": {
            "type": "string",
            "defaultValue": "Tenable_VM_Compliance",
            "minLength": 1,
            "metadata": {
                "description": "Enter name of the table used to store Compliance Data logs. Please do not keep this field as empty else you will get validation error."
            }
        },
        "WASAssetTableName": {
            "type": "string",
            "defaultValue": "Tenable_WAS_Asset",
            "minLength": 1,
            "metadata": {
                "description": "Enter name of the table used to store WAS Asset Data logs. Please do not keep this field as empty else you will get validation error."
            }
        },
        "WASVulnTableName": {
            "type": "string",
            "defaultValue": "Tenable_WAS_Vuln",
            "minLength": 1,
            "metadata": {
                "description": "Enter name of the table used to store WAS Vulnerability Data logs. Please do not keep this field as empty else you will get validation error."
            }
        },
        "AppInsightsWorkspaceResourceID": {
            "type": "string",
            "metadata": {
                "description": "Migrate Classic Application Insights to Log Analytic Workspace which is retiring by 29 Febraury 2024. Use 'Log Analytic Workspace-->Properties' blade having 'Resource ID' property value. This is a fully qualified resourceId which is in format '/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName}'"
            }
        }
    },
    "variables": {
        "FunctionName": "[concat(toLower(parameters('functionName')), uniqueString(resourceGroup().id))]",
        "StorageSuffix": "[environment().suffixes.storage]",
        "suffix": "[concat('A', uniqueString(resourceGroup().id))]",
        "endpointName": "[concat(toLower(parameters('FunctionName')),'LogsEndpoint', variables('suffix'))]",
        "mainRuleName": "[concat(toLower(parameters('FunctionName')),'MainCollectionRule', variables('suffix'))]",
        "logWsResId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('WorkspaceName'))]",
        "dcrRoleName": "[concat(toLower(parameters('FunctionName')),'EntraRole', variables('suffix'))]",
        "dcrRoleId": "[guid(subscription().id, string(variables('dcrRoleName')))]",
        "scope": "[concat(replace(environment().portal, 'portal', 'monitor'), '/.default')]"
    },
    "resources": [
        {
            "type": "Microsoft.Insights/dataCollectionEndpoints",
            "apiVersion": "2022-06-01",
            "name": "[variables('endpointName')]",
            "location": "[parameters('Location')]",
            "kind": "Linux",
            "properties": {
                "description": "Data collection endpoint for ingestion api",
                "networkAcls": {
                    "publicNetworkAccess": "Enabled"
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2022-10-01",
            "name": "[concat(parameters('WorkspaceName'), '/', parameters('AssetTableName'), '_CL')]",
            "properties": {
                "plan": "Analytics",
                "schema": {
                    "name": "[concat(parameters('AssetTableName'), '_CL')]",
                    "columns": [
                                {
                                    "name": "id",
                                    "type": "string"
                                },
                                {
                                    "name": "has_agent",
                                    "type": "boolean"
                                },
                                {
                                    "name": "has_plugin_results",
                                    "type": "boolean"
                                },
                                {
                                    "name": "created_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "terminated_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "terminated_by",
                                    "type": "string"
                                },
                                {
                                    "name": "updated_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "deleted_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "deleted_by",
                                    "type": "string"
                                },
                                {
                                    "name": "first_seen",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_seen",
                                    "type": "datetime"
                                },
                                {
                                    "name": "first_scan_time",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_scan_time",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_authenticated_scan_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_licensed_scan_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_scan_id",
                                    "type": "string"
                                },
                                {
                                    "name": "last_schedule_id",
                                    "type": "string"
                                },
                                {
                                    "name": "azure_vm_id",
                                    "type": "string"
                                },
                                {
                                    "name": "azure_resource_id",
                                    "type": "string"
                                },
                                {
                                    "name": "gcp_project_id",
                                    "type": "string"
                                },
                                {
                                    "name": "gcp_zone",
                                    "type": "string"
                                },
                                {
                                    "name": "gcp_instance_id",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_instance_ami_id",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_instance_id",
                                    "type": "string"
                                },
                                {
                                    "name": "agent_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "bios_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_owner_id",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_availability_zone",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_region",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_vpc_id",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_instance_group_name",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_instance_state_name",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_instance_type",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_subnet_id",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_product_code",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_name",
                                    "type": "string"
                                },
                                {
                                    "name": "mcafee_epo_guid",
                                    "type": "string"
                                },
                                {
                                    "name": "mcafee_epo_agent_guid",
                                    "type": "string"
                                },
                                {
                                    "name": "servicenow_sysid",
                                    "type": "string"
                                },
                                {
                                    "name": "bigfix_asset_id",
                                    "type": "string"
                                },
                                {
                                    "name": "agent_names",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "installed_software",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ipv4s",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ipv6s",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "fqdns",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "mac_addresses",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "netbios_names",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "operating_systems",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "system_types",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "hostnames",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ssh_fingerprints",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "qualys_asset_ids",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "qualys_host_ids",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "manufacturer_tpm_ids",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "symantec_ep_hardware_keys",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "sources",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "tags",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "network_interfaces",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "open_ports",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "serial_number",
                                    "type": "string"
                                },
                                {
                                    "name": "last_authentication_attempt_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_authentication_success_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_authentication_scan_status",
                                    "type": "string"
                                },
                                {
                                    "name": "last_scan_target",
                                    "type": "string"
                                },
                                {
                                    "name": "acr_score",
                                    "type": "string"
                                },
                                {
                                    "name": "exposure_score",
                                    "type": "string"
                                },
                                {
                                    "name": "ratings",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ratings_acr",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ratings_acr_score",
                                    "type": "real"
                                },
                                {
                                    "name": "ratings_aes",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ratings_aes_score",
                                    "type": "real"
                                },
                                {
                                    "name": "tenable_agent_days_since_active",
                                    "type": "real"
                                },
                                {
                                    "name": "network_id",
                                    "type": "string"
                                },
                                {
                                    "name": "network_name",
                                    "type": "string"
                                },
                                {
                                    "name": "resource_tags",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "TimeGenerated",
                                    "type": "datetime"
                                }
                            ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2022-10-01",
            "name": "[concat(parameters('WorkspaceName'), '/', parameters('VulnTableName'), '_CL')]",
            "properties": {
                "plan": "Analytics",
                "schema": {
                    "name": "[concat(parameters('VulnTableName'), '_CL')]",
                    "columns": [
                                {
                                    "name": "asset",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_bios_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_device_type",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_fqdn",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_hostname",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_ipv4",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_ipv6",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_last_authenticated_results",
                                    "type": "datetime"
                                },
                                {
                                    "name": "asset_mac_address",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_netbios_name",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_operating_system",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_serial_number",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_network_id",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_tracked",
                                    "type": "boolean"
                                },
                                {
                                    "name": "asset_agent_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_last_scan_target",
                                    "type": "string"
                                },
                                {
                                    "name": "output",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_bid",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_checks_for_default_account",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_checks_for_malware",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_cpe",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_cvss3_base_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_vector",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_vector_exploitability",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_vector_remediation_level",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_vector_report_confidence",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_vector_raw",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_cvss3_vector_access_complexity",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector_access_vector",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector_availability_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector_confidentiality_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector_integrity_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector_raw",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_base_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_cvss_temporal_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_cvss_temporal_vector",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_cvss_temporal_vector_exploitability",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_temporal_vector_remediation_level",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_temporal_vector_report_confidence",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_temporal_vector_raw",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_cvss_vector_access_complexity",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_access_vector",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_authentication",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_availability_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_confidentiality_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_integrity_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_raw",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_description",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_exploit_available",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploit_framework_canvas",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploit_framework_core",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploit_framework_d2_elliot",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploit_framework_exploithub",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploit_framework_metasploit",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploitability_ease",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_exploited_by_malware",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploited_by_nessus",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_family",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_family_id",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_has_patch",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_id",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_in_the_news",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_ms_bulletin",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_name",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_patch_publication_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_modification_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_publication_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_risk_factor",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_see_also",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_solution",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_stig_severity",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_synopsis",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_unsupported_by_vendor",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_version",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_vuln_publication_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_xrefs",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_vpr",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_vpr_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_vpr_drivers",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_vpr_drivers_age_of_vuln",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_vpr_drivers_age_of_vuln_lower_bound",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_vpr_drivers_exploit_code_maturity",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_vpr_drivers_cvss_impact_score_predicted",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_vpr_drivers_cvss3_impact_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_vpr_drivers_threat_intensity_last28",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_vpr_drivers_threat_sources_last28",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_vpr_drivers_product_coverage",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_vpr_updated",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_workaround",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_workaround_type",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_workaround_published",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_vendor_unpatched",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_has_workaround",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_vendor_severity",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cve",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_type",
                                    "type": "string"
                                },
                                {
                                    "name": "port",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "port_port",
                                    "type": "real"
                                },
                                {
                                    "name": "port_protocol",
                                    "type": "string"
                                },
                                {
                                    "name": "port_service",
                                    "type": "string"
                                },
                                {
                                    "name": "scan",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "scan_schedule_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "scan_started_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "scan_last_scan_target",
                                    "type": "string"
                                },
                                {
                                    "name": "scan_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "scan_target",
                                    "type": "string"
                                },
                                {
                                    "name": "severity",
                                    "type": "string"
                                },
                                {
                                    "name": "severity_id",
                                    "type": "real"
                                },
                                {
                                    "name": "severity_default_id",
                                    "type": "real"
                                },
                                {
                                    "name": "severity_modification_type",
                                    "type": "string"
                                },
                                {
                                    "name": "first_found",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_found",
                                    "type": "datetime"
                                },
                                {
                                    "name": "state",
                                    "type": "string"
                                },
                                {
                                    "name": "indexed",
                                    "type": "datetime"
                                },
                                {
                                    "name": "source",
                                    "type": "string"
                                },
                                {
                                    "name": "finding_id",
                                    "type": "string"
                                },
                                {
                                    "name": "resurfaced_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "time_taken_to_fix",
                                    "type": "string"
                                },
                                {
                                    "name": "recast_rule_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "recast_reason",
                                    "type": "string"
                                },
                                {
                                    "name": "last_fixed",
                                    "type": "datetime"
                                },
                                {
                                    "name": "TimeGenerated",
                                    "type": "datetime"
                                }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2022-10-01",
            "name": "[concat(parameters('WorkspaceName'), '/', parameters('WASVulnTableName'), '_CL')]",
            "properties": {
                "plan": "Analytics",
                "schema": {
                    "name": "[concat(parameters('WASVulnTableName'), '_CL')]",
                    "columns": [
                            {
                                "name": "finding_id",
                                "type": "string"
                            },
                            {
                                "name": "url",
                                "type": "string"
                            },
                            {
                                "name": "output",
                                "type": "string"
                            },
                            {
                                "name": "state",
                                "type": "string"
                            },
                            {
                                "name": "severity",
                                "type": "string"
                            },
                            {
                                "name": "severity_id",
                                "type": "real"
                            },
                            {
                                "name": "severity_default_id",
                                "type": "real"
                            },
                            {
                                "name": "severity_modification_type",
                                "type": "string"
                            },
                            {
                                "name": "first_found",
                                "type": "datetime"
                            },
                            {
                                "name": "last_found",
                                "type": "datetime"
                            },
                            {
                                "name": "indexed_at",
                                "type": "datetime"
                            },
                            {
                                "name": "plugin",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_bid",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_id",
                                "type": "real"
                            },
                            {
                                "name": "plugin_risk_factor",
                                "type": "string"
                            },
                            {
                                "name": "plugin_original_risk_factor_num",
                                "type": "real"
                            },
                            {
                                "name": "plugin_locale",
                                "type": "string"
                            },
                            {
                                "name": "plugin_type",
                                "type": "string"
                            },
                            {
                                "name": "plugin_intel_type",
                                "type": "string"
                            },
                            {
                                "name": "plugin_name",
                                "type": "string"
                            },
                            {
                                "name": "plugin_publication_date",
                                "type": "datetime"
                            },
                            {
                                "name": "plugin_modification_date",
                                "type": "datetime"
                            },
                            {
                                "name": "plugin_see_also",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_solution",
                                "type": "string"
                            },
                            {
                                "name": "plugin_synopsis",
                                "type": "string"
                            },
                            {
                                "name": "plugin_description",
                                "type": "string"
                            },
                            {
                                "name": "plugin_patch_publication_date",
                                "type": "datetime"
                            },
                            {
                                "name": "plugin_exploitability_ease",
                                "type": "string"
                            },
                            {
                                "name": "plugin_public_display",
                                "type": "real"
                            },
                            {
                                "name": "plugin_policy",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_xrefs",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cpe",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cve",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cwe",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_wasc",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_in_the_news",
                                "type": "boolean"
                            },
                            {
                                "name": "plugin_exploited_by_malware",
                                "type": "boolean"
                            },
                            {
                                "name": "plugin_exploit_frameworks",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_vpr",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_vpr_score",
                                "type": "real"
                            },
                            {
                                "name": "plugin_vpr_drivers",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_vpr_drivers_age_of_vuln",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_vpr_drivers_age_of_vuln_lower_bound",
                                "type": "real"
                            },
                            {
                                "name": "plugin_vpr_drivers_exploit_code_maturity",
                                "type": "string"
                            },
                            {
                                "name": "plugin_vpr_drivers_cvss_impact_score_predicted",
                                "type": "boolean"
                            },
                            {
                                "name": "plugin_vpr_drivers_cvss3_impact_score",
                                "type": "real"
                            },
                            {
                                "name": "plugin_vpr_drivers_threat_intensity_last28",
                                "type": "string"
                            },
                            {
                                "name": "plugin_vpr_drivers_threat_sources_last28",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_vpr_drivers_product_coverage",
                                "type": "string"
                            },
                            {
                                "name": "plugin_vpr_updated",
                                "type": "datetime"
                            },
                            {
                                "name": "plugin_cvss2_base_score",
                                "type": "real"
                            },
                            {
                                "name": "plugin_cvss2_temporal_vector",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cvss2_vector",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cvss2_vector_access_complexity",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_access_vector",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_authentication",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_availability_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_confidentiality_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_integrity_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_raw",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_base_score",
                                "type": "real"
                            },
                            {
                                "name": "plugin_cvss3_temporal_vector",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cvss3_vector",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cvss3_vector_access_complexity",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_vector_access_vector",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_vector_availability_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_vector_confidentiality_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_vector_integrity_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_vector_raw",
                                "type": "string"
                            },
                            {
                                "name": "plugin_owasp_2010",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_owasp_2013",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_owasp_2017",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_owasp_2021",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_owasp_api_2019",
                                "type": "dynamic"
                            },
                            {
                                "name": "asset",
                                "type": "dynamic"
                            },
                            {
                                "name": "asset_uuid",
                                "type": "string"
                            },
                            {
                                "name": "asset_fqdn",
                                "type": "string"
                            },
                            {
                                "name": "asset_ipv4s",
                                "type": "dynamic"
                            },
                            {
                                "name": "asset_ipv4",
                                "type": "string"
                            },
                            {
                                "name": "scan",
                                "type": "dynamic"
                            },
                            {
                                "name": "scan_completed_at",
                                "type": "datetime"
                            },
                            {
                                "name": "scan_uuid",
                                "type": "string"
                            },
                            {
                                "name": "last_observed",
                                "type": "datetime"
                            },
                            {
                                "name": "input_type",
                                "type": "string"
                            },
                            {
                                "name": "input_name",
                                "type": "string"
                            },
                            {
                                "name": "http_method",
                                "type": "string"
                            },
                            {
                                "name": "proof",
                                "type": "string"
                            },
                            {
                                "name": "payload",
                                "type": "string"
                            },
                            {
                                "name": "recast_reason",
                                "type": "string"
                            },
                            {
                                "name": "recast_rule_uuid",
                                "type": "string"
                            },
                            {
                                "name": "last_fixed",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2022-10-01",
            "name": "[concat(parameters('WorkspaceName'), '/', parameters('ComplianceTableName'), '_CL')]",
            "properties": {
                "plan": "Analytics",
                "schema": {
                    "name": "[concat(parameters('ComplianceTableName'), '_CL')]",
                    "columns":[
                                {
                                    "name": "asset_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "first_seen",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_seen",
                                    "type": "datetime"
                                },
                                {
                                    "name": "audit_file",
                                    "type": "string"
                                },
                                {
                                    "name": "audit_description",
                                    "type": "string"
                                },
                                {
                                    "name": "check_id",
                                    "type": "string"
                                },
                                {
                                    "name": "check_name",
                                    "type": "string"
                                },
                                {
                                    "name": "check_info",
                                    "type": "string"
                                },
                                {
                                    "name": "expected_value",
                                    "type": "string"
                                },
                                {
                                    "name": "actual_value",
                                    "type": "string"
                                },
                                {
                                    "name": "status",
                                    "type": "string"
                                },
                                {
                                    "name": "reference",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "see_also",
                                    "type": "string"
                                },
                                {
                                    "name": "solution",
                                    "type": "string"
                                },
                                {
                                    "name": "db_type",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_id",
                                    "type": "real"
                                },
                                {
                                    "name": "state",
                                    "type": "string"
                                },
                                {
                                    "name": "description",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_benchmark_name",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_benchmark_version",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_control_id",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_full_id",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_functional_id",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_informational_id",
                                    "type": "string"
                                },
                                {
                                    "name": "synopsis",
                                    "type": "string"
                                },
                                {
                                    "name": "last_fixed",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_observed",
                                    "type": "datetime"
                                },
                                {
                                    "name": "metadata_id",
                                    "type": "string"
                                },
                                {
                                    "name": "uname_output",
                                    "type": "string"
                                },
                                {
                                    "name": "indexed_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_name",
                                    "type": "string"
                                },
                                {
                                    "name": "asset",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_id",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_ipv4_addresses",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_ipv6_addresses",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_fqdns",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_name",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_agent_name",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_agent_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_netbios_name",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_mac_addresses",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_operating_systems",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_system_type",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_network_id",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_tags",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "check_error",
                                    "type": "string"
                                },
                                {
                                    "name": "profile_name",
                                    "type": "string"
                                },
                                {
                                    "name": "TimeGenerated",
                                    "type": "datetime"
                                }
                            ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2022-10-01",
            "name": "[concat(parameters('WorkspaceName'), '/', parameters('WASAssetTableName'), '_CL')]",
            "properties": {
                "plan": "Analytics",
                "schema": {
                    "name": "[concat(parameters('WASAssetTableName'), '_CL')]",
                    "columns": [
                                    {
                                        "name": "id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "has_agent",
                                        "type": "boolean"
                                    },
                                    {
                                        "name": "has_plugin_results",
                                        "type": "boolean"
                                    },
                                    {
                                        "name": "agent_uuid",
                                        "type": "string"
                                    },
                                    {
                                        "name": "is_licensed",
                                        "type": "boolean"
                                    },
                                    {
                                        "name": "terminated_by",
                                        "type": "string"
                                    },
                                    {
                                        "name": "deleted_by",
                                        "type": "string"
                                    },
                                    {
                                        "name": "types",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "agent_names",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "operating_systems",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "system_types",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "manufacturer_tpm_ids",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "installed_software",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "is_public",
                                        "type": "boolean"
                                    },
                                    {
                                        "name": "network_device_serial_identifier",
                                        "type": "string"
                                    },
                                    {
                                        "name": "custom_attributes",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "sources",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "tags",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "scan",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "scan_first_scan_time",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "scan_last_scan_time",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "scan_last_authenticated_scan_date",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "scan_last_licensed_scan_date",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "scan_last_scan_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "scan_last_schedule_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "scan_last_authentication_attempt_date",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "scan_last_authentication_success_date",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "scan_last_authentication_scan_status",
                                        "type": "string"
                                    },
                                    {
                                        "name": "scan_last_scan_target",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "cloud_azure",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "cloud_azure_vm_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_azure_resource_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_gcp",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "cloud_gcp_project_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_gcp_zone",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_gcp_instance_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "cloud_aws_ec2_instance_ami_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_ec2_instance_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_owner_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_availability_zone",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_region",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_vpc_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_ec2_instance_group_name",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_ec2_instance_state_name",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_ec2_instance_type",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_subnet_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_ec2_product_code",
                                        "type": "string"
                                    },
                                    {
                                        "name": "cloud_aws_ec2_name",
                                        "type": "string"
                                    },
                                    {
                                        "name": "third_party_ids",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "third_party_ids_mcafee_epo_guid",
                                        "type": "string"
                                    },
                                    {
                                        "name": "third_party_ids_mcafee_epo_agent_guid",
                                        "type": "string"
                                    },
                                    {
                                        "name": "third_party_ids_servicenow_sysid",
                                        "type": "string"
                                    },
                                    {
                                        "name": "third_party_ids_bigfix_asset_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "third_party_ids_qualys_asset_ids",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "third_party_ids_qualys_host_ids",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "third_party_ids_symantec_ep_hardware_keys",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "network",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "network_network_id",
                                        "type": "string"
                                    },
                                    {
                                        "name": "network_network_name",
                                        "type": "string"
                                    },
                                    {
                                        "name": "network_bios_uuid",
                                        "type": "string"
                                    },
                                    {
                                        "name": "network_ipv4s",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "network_ipv6s",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "network_fqdns",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "network_mac_addresses",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "network_netbios_names",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "network_hostnames",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "network_ssh_fingerprints",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "network_network_interfaces",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "network_open_ports",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "timestamps",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "timestamps_created_at",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "timestamps_updated_at",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "timestamps_deleted_at",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "timestamps_terminated_at",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "timestamps_first_seen",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "timestamps_last_seen",
                                        "type": "datetime"
                                    },
                                    {
                                        "name": "tenable_agent_days_since_active",
                                        "type": "real"
                                    },
                                    {
                                        "name": "acr_score",
                                        "type": "string"
                                    },
                                    {
                                        "name": "exposure_score",
                                        "type": "string"
                                    },
                                    {
                                        "name": "ratings",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "ratings_acr",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "ratings_acr_score",
                                        "type": "real"
                                    },
                                    {
                                        "name": "ratings_aes",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "ratings_aes_score",
                                        "type": "real"
                                    },
                                    {
                                        "name": "resource_tags",
                                        "type": "dynamic"
                                    },
                                    {
                                        "name": "serial_number",
                                        "type": "string"
                                    },
                                    {
                                        "name": "TimeGenerated",
                                        "type": "datetime"
                                    }
                                ]
                }
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2022-06-01",
            "name": "[variables('mainRuleName')]",
            "location": "[parameters('Location')]",
            "dependsOn": [
                "[concat(variables('logWsResId'), '/tables/', parameters('AssetTableName'), '_CL')]",
                "[concat(variables('logWsResId'), '/tables/', parameters('VulnTableName'), '_CL')]",
                "[concat(variables('logWsResId'), '/tables/', parameters('WASVulnTableName'), '_CL')]",
                "[concat(variables('logWsResId'), '/tables/', parameters('ComplianceTableName'), '_CL')]",
                "[concat(variables('logWsResId'), '/tables/', parameters('WASAssetTableName'), '_CL')]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('endpointName'))]",
                "streamDeclarations": {
                    "[concat('Custom-', parameters('AssetTableName'))]": {
                        "columns":                             [
                                {
                                    "name": "id",
                                    "type": "string"
                                },
                                {
                                    "name": "has_agent",
                                    "type": "boolean"
                                },
                                {
                                    "name": "has_plugin_results",
                                    "type": "boolean"
                                },
                                {
                                    "name": "created_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "terminated_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "terminated_by",
                                    "type": "string"
                                },
                                {
                                    "name": "updated_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "deleted_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "deleted_by",
                                    "type": "string"
                                },
                                {
                                    "name": "first_seen",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_seen",
                                    "type": "datetime"
                                },
                                {
                                    "name": "first_scan_time",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_scan_time",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_authenticated_scan_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_licensed_scan_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_scan_id",
                                    "type": "string"
                                },
                                {
                                    "name": "last_schedule_id",
                                    "type": "string"
                                },
                                {
                                    "name": "azure_vm_id",
                                    "type": "string"
                                },
                                {
                                    "name": "azure_resource_id",
                                    "type": "string"
                                },
                                {
                                    "name": "gcp_project_id",
                                    "type": "string"
                                },
                                {
                                    "name": "gcp_zone",
                                    "type": "string"
                                },
                                {
                                    "name": "gcp_instance_id",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_instance_ami_id",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_instance_id",
                                    "type": "string"
                                },
                                {
                                    "name": "agent_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "bios_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_owner_id",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_availability_zone",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_region",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_vpc_id",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_instance_group_name",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_instance_state_name",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_instance_type",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_subnet_id",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_product_code",
                                    "type": "string"
                                },
                                {
                                    "name": "aws_ec2_name",
                                    "type": "string"
                                },
                                {
                                    "name": "mcafee_epo_guid",
                                    "type": "string"
                                },
                                {
                                    "name": "mcafee_epo_agent_guid",
                                    "type": "string"
                                },
                                {
                                    "name": "servicenow_sysid",
                                    "type": "string"
                                },
                                {
                                    "name": "bigfix_asset_id",
                                    "type": "string"
                                },
                                {
                                    "name": "agent_names",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "installed_software",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ipv4s",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ipv6s",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "fqdns",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "mac_addresses",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "netbios_names",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "operating_systems",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "system_types",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "hostnames",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ssh_fingerprints",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "qualys_asset_ids",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "qualys_host_ids",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "manufacturer_tpm_ids",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "symantec_ep_hardware_keys",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "sources",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "tags",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "network_interfaces",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "open_ports",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "serial_number",
                                    "type": "string"
                                },
                                {
                                    "name": "last_authentication_attempt_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_authentication_success_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_authentication_scan_status",
                                    "type": "string"
                                },
                                {
                                    "name": "last_scan_target",
                                    "type": "string"
                                },
                                {
                                    "name": "acr_score",
                                    "type": "string"
                                },
                                {
                                    "name": "exposure_score",
                                    "type": "string"
                                },
                                {
                                    "name": "ratings",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ratings_acr",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ratings_acr_score",
                                    "type": "real"
                                },
                                {
                                    "name": "ratings_aes",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "ratings_aes_score",
                                    "type": "real"
                                },
                                {
                                    "name": "tenable_agent_days_since_active",
                                    "type": "real"
                                },
                                {
                                    "name": "network_id",
                                    "type": "string"
                                },
                                {
                                    "name": "network_name",
                                    "type": "string"
                                },
                                {
                                    "name": "resource_tags",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "TimeGenerated",
                                    "type": "datetime"
                                }
                            ]
                    },
                    "[concat('Custom-', parameters('VulnTableName'))]": {
                        "columns": [
                                {
                                    "name": "asset",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_bios_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_device_type",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_fqdn",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_hostname",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_ipv4",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_ipv6",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_last_authenticated_results",
                                    "type": "datetime"
                                },
                                {
                                    "name": "asset_mac_address",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_netbios_name",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_operating_system",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_serial_number",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_network_id",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_tracked",
                                    "type": "boolean"
                                },
                                {
                                    "name": "asset_agent_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_last_scan_target",
                                    "type": "string"
                                },
                                {
                                    "name": "output",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_bid",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_checks_for_default_account",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_checks_for_malware",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_cpe",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_cvss3_base_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_vector",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_vector_exploitability",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_vector_remediation_level",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_vector_report_confidence",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_temporal_vector_raw",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_cvss3_vector_access_complexity",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector_access_vector",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector_availability_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector_confidentiality_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector_integrity_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss3_vector_raw",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_base_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_cvss_temporal_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_cvss_temporal_vector",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_cvss_temporal_vector_exploitability",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_temporal_vector_remediation_level",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_temporal_vector_report_confidence",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_temporal_vector_raw",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_cvss_vector_access_complexity",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_access_vector",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_authentication",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_availability_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_confidentiality_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_integrity_impact",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cvss_vector_raw",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_description",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_exploit_available",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploit_framework_canvas",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploit_framework_core",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploit_framework_d2_elliot",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploit_framework_exploithub",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploit_framework_metasploit",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploitability_ease",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_exploited_by_malware",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_exploited_by_nessus",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_family",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_family_id",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_has_patch",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_id",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_in_the_news",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_ms_bulletin",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_name",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_patch_publication_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_modification_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_publication_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_risk_factor",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_see_also",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_solution",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_stig_severity",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_synopsis",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_unsupported_by_vendor",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_version",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_vuln_publication_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_xrefs",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_vpr",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_vpr_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_vpr_drivers",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_vpr_drivers_age_of_vuln",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_vpr_drivers_age_of_vuln_lower_bound",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_vpr_drivers_exploit_code_maturity",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_vpr_drivers_cvss_impact_score_predicted",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_vpr_drivers_cvss3_impact_score",
                                    "type": "real"
                                },
                                {
                                    "name": "plugin_vpr_drivers_threat_intensity_last28",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_vpr_drivers_threat_sources_last28",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_vpr_drivers_product_coverage",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_vpr_updated",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_workaround",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_workaround_type",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_workaround_published",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_vendor_unpatched",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_has_workaround",
                                    "type": "boolean"
                                },
                                {
                                    "name": "plugin_vendor_severity",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_cve",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "plugin_type",
                                    "type": "string"
                                },
                                {
                                    "name": "port",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "port_port",
                                    "type": "real"
                                },
                                {
                                    "name": "port_protocol",
                                    "type": "string"
                                },
                                {
                                    "name": "port_service",
                                    "type": "string"
                                },
                                {
                                    "name": "scan",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "scan_schedule_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "scan_started_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "scan_last_scan_target",
                                    "type": "string"
                                },
                                {
                                    "name": "scan_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "scan_target",
                                    "type": "string"
                                },
                                {
                                    "name": "severity",
                                    "type": "string"
                                },
                                {
                                    "name": "severity_id",
                                    "type": "real"
                                },
                                {
                                    "name": "severity_default_id",
                                    "type": "real"
                                },
                                {
                                    "name": "severity_modification_type",
                                    "type": "string"
                                },
                                {
                                    "name": "first_found",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_found",
                                    "type": "datetime"
                                },
                                {
                                    "name": "state",
                                    "type": "string"
                                },
                                {
                                    "name": "indexed",
                                    "type": "datetime"
                                },
                                {
                                    "name": "source",
                                    "type": "string"
                                },
                                {
                                    "name": "finding_id",
                                    "type": "string"
                                },
                                {
                                    "name": "resurfaced_date",
                                    "type": "datetime"
                                },
                                {
                                    "name": "time_taken_to_fix",
                                    "type": "string"
                                },
                                {
                                    "name": "recast_rule_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "recast_reason",
                                    "type": "string"
                                },
                                {
                                    "name": "last_fixed",
                                    "type": "datetime"
                                },
                                {
                                    "name": "TimeGenerated",
                                    "type": "datetime"
                                }
                            ]
                    },
                    "[concat('Custom-', parameters('WASVulnTableName'))]": {
                        "columns": [
                            {
                                "name": "finding_id",
                                "type": "string"
                            },
                            {
                                "name": "url",
                                "type": "string"
                            },
                            {
                                "name": "output",
                                "type": "string"
                            },
                            {
                                "name": "state",
                                "type": "string"
                            },
                            {
                                "name": "severity",
                                "type": "string"
                            },
                            {
                                "name": "severity_id",
                                "type": "real"
                            },
                            {
                                "name": "severity_default_id",
                                "type": "real"
                            },
                            {
                                "name": "severity_modification_type",
                                "type": "string"
                            },
                            {
                                "name": "first_found",
                                "type": "datetime"
                            },
                            {
                                "name": "last_found",
                                "type": "datetime"
                            },
                            {
                                "name": "indexed_at",
                                "type": "datetime"
                            },
                            {
                                "name": "plugin",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_bid",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_id",
                                "type": "real"
                            },
                            {
                                "name": "plugin_risk_factor",
                                "type": "string"
                            },
                            {
                                "name": "plugin_original_risk_factor_num",
                                "type": "real"
                            },
                            {
                                "name": "plugin_locale",
                                "type": "string"
                            },
                            {
                                "name": "plugin_type",
                                "type": "string"
                            },
                            {
                                "name": "plugin_intel_type",
                                "type": "string"
                            },
                            {
                                "name": "plugin_name",
                                "type": "string"
                            },
                            {
                                "name": "plugin_publication_date",
                                "type": "datetime"
                            },
                            {
                                "name": "plugin_modification_date",
                                "type": "datetime"
                            },
                            {
                                "name": "plugin_see_also",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_solution",
                                "type": "string"
                            },
                            {
                                "name": "plugin_synopsis",
                                "type": "string"
                            },
                            {
                                "name": "plugin_description",
                                "type": "string"
                            },
                            {
                                "name": "plugin_patch_publication_date",
                                "type": "datetime"
                            },
                            {
                                "name": "plugin_exploitability_ease",
                                "type": "string"
                            },
                            {
                                "name": "plugin_public_display",
                                "type": "real"
                            },
                            {
                                "name": "plugin_policy",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_xrefs",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cpe",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cve",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cwe",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_wasc",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_in_the_news",
                                "type": "boolean"
                            },
                            {
                                "name": "plugin_exploited_by_malware",
                                "type": "boolean"
                            },
                            {
                                "name": "plugin_exploit_frameworks",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_vpr",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_vpr_score",
                                "type": "real"
                            },
                            {
                                "name": "plugin_vpr_drivers",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_vpr_drivers_age_of_vuln",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_vpr_drivers_age_of_vuln_lower_bound",
                                "type": "real"
                            },
                            {
                                "name": "plugin_vpr_drivers_exploit_code_maturity",
                                "type": "string"
                            },
                            {
                                "name": "plugin_vpr_drivers_cvss_impact_score_predicted",
                                "type": "boolean"
                            },
                            {
                                "name": "plugin_vpr_drivers_cvss3_impact_score",
                                "type": "real"
                            },
                            {
                                "name": "plugin_vpr_drivers_threat_intensity_last28",
                                "type": "string"
                            },
                            {
                                "name": "plugin_vpr_drivers_threat_sources_last28",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_vpr_drivers_product_coverage",
                                "type": "string"
                            },
                            {
                                "name": "plugin_vpr_updated",
                                "type": "datetime"
                            },
                            {
                                "name": "plugin_cvss2_base_score",
                                "type": "real"
                            },
                            {
                                "name": "plugin_cvss2_temporal_vector",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cvss2_vector",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cvss2_vector_access_complexity",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_access_vector",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_authentication",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_availability_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_confidentiality_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_integrity_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss2_vector_raw",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_base_score",
                                "type": "real"
                            },
                            {
                                "name": "plugin_cvss3_temporal_vector",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cvss3_vector",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_cvss3_vector_access_complexity",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_vector_access_vector",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_vector_availability_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_vector_confidentiality_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_vector_integrity_impact",
                                "type": "string"
                            },
                            {
                                "name": "plugin_cvss3_vector_raw",
                                "type": "string"
                            },
                            {
                                "name": "plugin_owasp_2010",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_owasp_2013",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_owasp_2017",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_owasp_2021",
                                "type": "dynamic"
                            },
                            {
                                "name": "plugin_owasp_api_2019",
                                "type": "dynamic"
                            },
                            {
                                "name": "asset",
                                "type": "dynamic"
                            },
                            {
                                "name": "asset_uuid",
                                "type": "string"
                            },
                            {
                                "name": "asset_fqdn",
                                "type": "string"
                            },
                            {
                                "name": "asset_ipv4s",
                                "type": "dynamic"
                            },
                            {
                                "name": "asset_ipv4",
                                "type": "string"
                            },
                            {
                                "name": "scan",
                                "type": "dynamic"
                            },
                            {
                                "name": "scan_completed_at",
                                "type": "datetime"
                            },
                            {
                                "name": "scan_uuid",
                                "type": "string"
                            },
                            {
                                "name": "last_observed",
                                "type": "datetime"
                            },
                            {
                                "name": "input_type",
                                "type": "string"
                            },
                            {
                                "name": "input_name",
                                "type": "string"
                            },
                            {
                                "name": "http_method",
                                "type": "string"
                            },
                            {
                                "name": "proof",
                                "type": "string"
                            },
                            {
                                "name": "payload",
                                "type": "string"
                            },
                            {
                                "name": "recast_reason",
                                "type": "string"
                            },
                            {
                                "name": "recast_rule_uuid",
                                "type": "string"
                            },
                            {
                                "name": "last_fixed",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    },
                    "[concat('Custom-', parameters('ComplianceTableName'))]": {
                        "columns": [
                                {
                                    "name": "asset_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "first_seen",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_seen",
                                    "type": "datetime"
                                },
                                {
                                    "name": "audit_file",
                                    "type": "string"
                                },
                                {
                                    "name": "audit_description",
                                    "type": "string"
                                },
                                {
                                    "name": "check_id",
                                    "type": "string"
                                },
                                {
                                    "name": "check_name",
                                    "type": "string"
                                },
                                {
                                    "name": "check_info",
                                    "type": "string"
                                },
                                {
                                    "name": "expected_value",
                                    "type": "string"
                                },
                                {
                                    "name": "actual_value",
                                    "type": "string"
                                },
                                {
                                    "name": "status",
                                    "type": "string"
                                },
                                {
                                    "name": "reference",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "see_also",
                                    "type": "string"
                                },
                                {
                                    "name": "solution",
                                    "type": "string"
                                },
                                {
                                    "name": "db_type",
                                    "type": "string"
                                },
                                {
                                    "name": "plugin_id",
                                    "type": "real"
                                },
                                {
                                    "name": "state",
                                    "type": "string"
                                },
                                {
                                    "name": "description",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_benchmark_name",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_benchmark_version",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_control_id",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_full_id",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_functional_id",
                                    "type": "string"
                                },
                                {
                                    "name": "compliance_informational_id",
                                    "type": "string"
                                },
                                {
                                    "name": "synopsis",
                                    "type": "string"
                                },
                                {
                                    "name": "last_fixed",
                                    "type": "datetime"
                                },
                                {
                                    "name": "last_observed",
                                    "type": "datetime"
                                },
                                {
                                    "name": "metadata_id",
                                    "type": "string"
                                },
                                {
                                    "name": "uname_output",
                                    "type": "string"
                                },
                                {
                                    "name": "indexed_at",
                                    "type": "datetime"
                                },
                                {
                                    "name": "plugin_name",
                                    "type": "string"
                                },
                                {
                                    "name": "asset",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_id",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_ipv4_addresses",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_ipv6_addresses",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_fqdns",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_name",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_agent_name",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_agent_uuid",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_netbios_name",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_mac_addresses",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_operating_systems",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "asset_system_type",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_network_id",
                                    "type": "string"
                                },
                                {
                                    "name": "asset_tags",
                                    "type": "dynamic"
                                },
                                {
                                    "name": "check_error",
                                    "type": "string"
                                },
                                {
                                    "name": "profile_name",
                                    "type": "string"
                                },
                                {
                                    "name": "TimeGenerated",
                                    "type": "datetime"
                                }
                            ]
                    },
                    "[concat('Custom-', parameters('WASAssetTableName'))]": {
                        "columns":  [
                                        {
                                            "name": "id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "has_agent",
                                            "type": "boolean"
                                        },
                                        {
                                            "name": "has_plugin_results",
                                            "type": "boolean"
                                        },
                                        {
                                            "name": "agent_uuid",
                                            "type": "string"
                                        },
                                        {
                                            "name": "is_licensed",
                                            "type": "boolean"
                                        },
                                        {
                                            "name": "terminated_by",
                                            "type": "string"
                                        },
                                        {
                                            "name": "deleted_by",
                                            "type": "string"
                                        },
                                        {
                                            "name": "types",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "agent_names",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "operating_systems",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "system_types",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "manufacturer_tpm_ids",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "installed_software",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "is_public",
                                            "type": "boolean"
                                        },
                                        {
                                            "name": "network_device_serial_identifier",
                                            "type": "string"
                                        },
                                        {
                                            "name": "custom_attributes",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "sources",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "tags",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "scan",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "scan_first_scan_time",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "scan_last_scan_time",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "scan_last_authenticated_scan_date",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "scan_last_licensed_scan_date",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "scan_last_scan_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "scan_last_schedule_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "scan_last_authentication_attempt_date",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "scan_last_authentication_success_date",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "scan_last_authentication_scan_status",
                                            "type": "string"
                                        },
                                        {
                                            "name": "scan_last_scan_target",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "cloud_azure",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "cloud_azure_vm_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_azure_resource_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_gcp",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "cloud_gcp_project_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_gcp_zone",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_gcp_instance_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "cloud_aws_ec2_instance_ami_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_ec2_instance_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_owner_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_availability_zone",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_region",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_vpc_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_ec2_instance_group_name",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_ec2_instance_state_name",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_ec2_instance_type",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_subnet_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_ec2_product_code",
                                            "type": "string"
                                        },
                                        {
                                            "name": "cloud_aws_ec2_name",
                                            "type": "string"
                                        },
                                        {
                                            "name": "third_party_ids",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "third_party_ids_mcafee_epo_guid",
                                            "type": "string"
                                        },
                                        {
                                            "name": "third_party_ids_mcafee_epo_agent_guid",
                                            "type": "string"
                                        },
                                        {
                                            "name": "third_party_ids_servicenow_sysid",
                                            "type": "string"
                                        },
                                        {
                                            "name": "third_party_ids_bigfix_asset_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "third_party_ids_qualys_asset_ids",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "third_party_ids_qualys_host_ids",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "third_party_ids_symantec_ep_hardware_keys",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "network",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "network_network_id",
                                            "type": "string"
                                        },
                                        {
                                            "name": "network_network_name",
                                            "type": "string"
                                        },
                                        {
                                            "name": "network_bios_uuid",
                                            "type": "string"
                                        },
                                        {
                                            "name": "network_ipv4s",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "network_ipv6s",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "network_fqdns",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "network_mac_addresses",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "network_netbios_names",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "network_hostnames",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "network_ssh_fingerprints",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "network_network_interfaces",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "network_open_ports",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "timestamps",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "timestamps_created_at",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "timestamps_updated_at",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "timestamps_deleted_at",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "timestamps_terminated_at",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "timestamps_first_seen",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "timestamps_last_seen",
                                            "type": "datetime"
                                        },
                                        {
                                            "name": "tenable_agent_days_since_active",
                                            "type": "real"
                                        },
                                        {
                                            "name": "acr_score",
                                            "type": "string"
                                        },
                                        {
                                            "name": "exposure_score",
                                            "type": "string"
                                        },
                                        {
                                            "name": "ratings",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "ratings_acr",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "ratings_acr_score",
                                            "type": "real"
                                        },
                                        {
                                            "name": "ratings_aes",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "ratings_aes_score",
                                            "type": "real"
                                        },
                                        {
                                            "name": "resource_tags",
                                            "type": "dynamic"
                                        },
                                        {
                                            "name": "serial_number",
                                            "type": "string"
                                        },
                                        {
                                            "name": "TimeGenerated",
                                            "type": "datetime"
                                        }
                                    ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[parameters('AppInsightsWorkspaceResourceID')]",
                            "name": "[concat('RuleDest', variables('suffix'))]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "[concat('Custom-', parameters('AssetTableName'))]"
                        ],
                        "destinations": [
                            "[concat('RuleDest', variables('suffix'))]"
                        ],
                        "transformKql": "source\n| extend TimeGenerated = todatetime(now()), json_ratings = parse_json(ratings)\n| extend json_ratings_acr = parse_json(json_ratings.acr), json_ratings_aes = parse_json(json_ratings.aes)\n| extend ratings_acr_score = toreal(json_ratings_acr.score), ratings_aes_score = toreal(json_ratings_aes.score)\n| project-away json_ratings, ratings, json_ratings_acr, json_ratings_aes",
                        "outputStream": "[concat('Custom-', parameters('AssetTableName'), '_CL')]"
                    },
                    {
                        "streams": [
                            "[concat('Custom-', parameters('VulnTableName'))]"
                        ],
                        "destinations": [
                            "[concat('RuleDest', variables('suffix'))]"
                        ],
                        "transformKql": "source\n| extend TimeGenerated = todatetime(now()), json_asset = parse_json(asset), json_plugin = parse_json(plugin), json_port = parse_json(port), json_scan = parse_json(scan)\n| extend json_plugin_cvss3_temporal_vector = parse_json(json_plugin.cvss3_temporal_vector), json_plugin_cvss3_vector = parse_json(json_plugin.cvss3_vector), json_plugin_cvss_temporal_vector = parse_json(json_plugin.cvss_temporal_vector), json_plugin_cvss_vector = parse_json(json_plugin.cvss_vector), json_plugin_vpr = parse_json(json_plugin.vpr)\n| extend json_plugin_vpr_drivers = parse_json(json_plugin_vpr.drivers)\n| extend json_plugin_vpr_drivers_age_of_vuln = parse_json(json_plugin_vpr_drivers.age_of_vuln)\n| extend asset_agent_uuid = tostring(json_asset.agent_uuid), asset_bios_uuid = tostring(json_asset.bios_uuid), asset_device_type = tostring(json_asset.device_type), asset_hostname = tostring(json_asset.hostname), asset_uuid = tostring(json_asset.uuid), asset_last_authenticated_results = todatetime(json_asset.last_authenticated_results), asset_last_scan_target = tostring(json_asset.last_scan_target), asset_mac_address = tostring(json_asset.mac_address), asset_netbios_name = tostring(json_asset.netbios_name), asset_operating_system = todynamic(json_asset.operating_system), asset_network_id = tostring(json_asset.network_id), asset_tracked = tobool(json_asset.tracked), asset_fqdn = tostring(json_asset.fqdn), asset_ipv4 = tostring(json_asset.ipv4), asset_ipv6 = tostring(json_asset.ipv6), asset_serial_number = tostring(json_asset.serial_number), plugin_bid = todynamic(json_plugin.bid), plugin_checks_for_default_account = tobool(json_plugin.checks_for_default_account), plugin_checks_for_malware = tobool(json_plugin.checks_for_malware), plugin_cpe = todynamic(json_plugin.cpe), plugin_description = tostring(json_plugin.description), plugin_exploit_available = tobool(json_plugin.exploit_available), plugin_exploit_framework_canvas = tobool(json_plugin.exploit_framework_canvas), plugin_exploit_framework_core = tobool(json_plugin.exploit_framework_core), plugin_exploit_framework_d2_elliot = tobool(json_plugin.exploit_framework_d2_elliot), plugin_exploit_framework_exploithub = tobool(json_plugin.exploit_framework_exploithub), plugin_exploit_framework_metasploit = tobool(json_plugin.exploit_framework_metasploit), plugin_exploited_by_malware = tobool(json_plugin.exploited_by_malware), plugin_exploited_by_nessus = tobool(json_plugin.exploited_by_nessus), plugin_family = tostring(json_plugin.family), plugin_family_id = toreal(json_plugin.family_id), plugin_has_patch = tobool(json_plugin.has_patch), plugin_id = toreal(json_plugin.id), plugin_in_the_news = tobool(json_plugin.in_the_news), plugin_name = tostring(json_plugin.name), plugin_modification_date = todatetime(json_plugin.modification_date), plugin_publication_date = todatetime(json_plugin.publication_date), plugin_risk_factor = tostring(json_plugin.risk_factor), plugin_synopsis = tostring(json_plugin.synopsis), plugin_unsupported_by_vendor = tobool(json_plugin.unsupported_by_vendor), plugin_version = tostring(json_plugin.version), plugin_xrefs = todynamic(json_plugin.xrefs), plugin_has_workaround = tobool(json_plugin.has_workaround), plugin_type = tostring(json_plugin.type), plugin_cvss3_base_score = toreal(json_plugin.cvss3_base_score), plugin_cvss3_temporal_score = toreal(json_plugin.cvss3_temporal_score), plugin_cvss3_temporal_vector_exploitability = tostring(json_plugin_cvss3_temporal_vector.exploitability), plugin_cvss3_temporal_vector_remediation_level = tostring(json_plugin_cvss3_temporal_vector.remediation_level), plugin_cvss3_temporal_vector_report_confidence = tostring(json_plugin_cvss3_temporal_vector.report_confidence), plugin_cvss3_temporal_vector_raw = tostring(json_plugin_cvss3_temporal_vector.raw), plugin_cvss3_vector_access_complexity = tostring(json_plugin_cvss3_vector.access_complexity), plugin_cvss3_vector_access_vector = tostring(json_plugin_cvss3_vector.access_vector), plugin_cvss3_vector_availability_impact = tostring(json_plugin_cvss3_vector.availability_impact), plugin_cvss3_vector_confidentiality_impact = tostring(json_plugin_cvss3_vector.confidentiality_impact), plugin_cvss3_vector_integrity_impact = tostring(json_plugin_cvss3_vector.integrity_impact), plugin_cvss3_vector_raw = tostring(json_plugin_cvss3_vector.raw), plugin_cvss_base_score = toreal(json_plugin.cvss_base_score), plugin_cvss_temporal_score = toreal(json_plugin.cvss_temporal_score), plugin_cvss_temporal_vector_exploitability = tostring(json_plugin_cvss_temporal_vector.exploitability), plugin_cvss_temporal_vector_remediation_level = tostring(json_plugin_cvss_temporal_vector.remediation_level), plugin_cvss_temporal_vector_report_confidence = tostring(json_plugin_cvss_temporal_vector.report_confidence), plugin_cvss_temporal_vector_raw = tostring(json_plugin_cvss_temporal_vector.raw), plugin_cvss_vector_access_complexity = tostring(json_plugin_cvss_vector.access_complexity), plugin_cvss_vector_access_vector = tostring(json_plugin_cvss_vector.access_vector), plugin_cvss_vector_authentication = tostring(json_plugin_cvss_vector.authentication), plugin_cvss_vector_availability_impact = tostring(json_plugin_cvss_vector.availability_impact), plugin_cvss_vector_confidentiality_impact = tostring(json_plugin_cvss_vector.confidentiality_impact), plugin_cvss_vector_integrity_impact = tostring(json_plugin_cvss_vector.integrity_impact), plugin_cvss_vector_raw = tostring(json_plugin_cvss_vector.raw), plugin_exploitability_ease = tostring(json_plugin.exploitability_ease), plugin_ms_bulletin = todynamic(json_plugin.ms_bulletin), plugin_patch_publication_date = todatetime(json_plugin.patch_publication_date), plugin_see_also = todynamic(json_plugin.see_also), plugin_solution = tostring(json_plugin.solution), plugin_stig_severity = tostring(json_plugin.stig_severity), plugin_vuln_publication_date = todatetime(json_plugin.vuln_publication_date), plugin_vpr_score = toreal(json_plugin_vpr.score), plugin_vpr_drivers_age_of_vuln_lower_bound = toreal(json_plugin_vpr_drivers_age_of_vuln.lower_bound), plugin_vpr_drivers_exploit_code_maturity = tostring(json_plugin_vpr_drivers.exploit_code_maturity), plugin_vpr_drivers_cvss_impact_score_predicted = tobool(json_plugin_vpr_drivers.cvss_impact_score_predicted), plugin_vpr_drivers_cvss3_impact_score = toreal(json_plugin_vpr_drivers.cvss3_impact_score), plugin_vpr_drivers_threat_intensity_last28 = tostring(json_plugin_vpr_drivers.threat_intensity_last28), plugin_vpr_drivers_threat_sources_last28 = todynamic(json_plugin_vpr_drivers.threat_sources_last28), plugin_vpr_drivers_product_coverage = tostring(json_plugin_vpr_drivers.product_coverage), plugin_vpr_updated = todatetime(json_plugin_vpr.updated), plugin_workaround = tostring(json_plugin.workaround), plugin_workaround_type = tostring(json_plugin.workaround_type), plugin_workaround_published = todatetime(json_plugin.workaround_published), plugin_vendor_unpatched = tobool(json_plugin.vendor_unpatched), plugin_vendor_severity = tostring(json_plugin.vendor_severity), plugin_cve = todynamic(json_plugin.cve), port_port = toreal(json_port.port), port_protocol = tostring(json_port.protocol), port_service = tostring(json_port.service), scan_schedule_uuid = tostring(json_scan.schedule_uuid), scan_started_at = todatetime(json_scan.started_at), scan_uuid = tostring(json_scan.uuid), scan_target = tostring(json_scan.target), scan_last_scan_target = tostring(json_scan.last_scan_target)\n| project-away json_asset, asset, json_plugin, plugin, json_plugin_cvss3_temporal_vector, json_plugin_cvss3_vector, json_plugin_cvss_temporal_vector, json_plugin_cvss_vector, json_plugin_vpr, json_plugin_vpr_drivers, json_plugin_vpr_drivers_age_of_vuln, json_port, port, json_scan, scan",
                        "outputStream": "[concat('Custom-', parameters('VulnTableName'), '_CL')]"
                    },
                    {
                        "streams": [
                            "[concat('Custom-', parameters('WASVulnTableName'))]"
                        ],
                        "destinations": [
                            "[concat('RuleDest', variables('suffix'))]"
                        ],
                        "transformKql": "source\n| extend TimeGenerated = todatetime(now()), json_plugin = parse_json(plugin), json_asset = parse_json(asset), json_scan = parse_json(scan)\n| extend json_plugin_vpr = parse_json(json_plugin.vpr), json_plugin_cvss2_vector = parse_json(json_plugin.cvss2_vector), json_plugin_cvss3_vector = parse_json(json_plugin.cvss3_vector)\n| extend json_plugin_vpr_drivers = parse_json(json_plugin_vpr.drivers)\n| extend json_plugin_vpr_drivers_age_of_vuln = parse_json(json_plugin_vpr_drivers.age_of_vuln)\n| extend plugin_bid = todynamic(json_plugin.bid), plugin_id = toreal(json_plugin.id), plugin_risk_factor = tostring(json_plugin.risk_factor), plugin_original_risk_factor_num = toreal(json_plugin.original_risk_factor_num), plugin_locale = tostring(json_plugin.locale), plugin_type = tostring(json_plugin.type), plugin_intel_type = tostring(json_plugin.intel_type), plugin_name = tostring(json_plugin.name), plugin_publication_date = todatetime(json_plugin.publication_date), plugin_modification_date = todatetime(json_plugin.modification_date), plugin_see_also = todynamic(json_plugin.see_also), plugin_solution = tostring(json_plugin.solution), plugin_synopsis = tostring(json_plugin.synopsis), plugin_description = tostring(json_plugin.description), plugin_patch_publication_date = todatetime(json_plugin.patch_publication_date), plugin_exploitability_ease = tostring(json_plugin.exploitability_ease), plugin_public_display = toreal(json_plugin.public_display), plugin_policy = todynamic(json_plugin.policy), plugin_xrefs = todynamic(json_plugin.xrefs), plugin_cpe = todynamic(json_plugin.cpe), plugin_cve = todynamic(json_plugin.cve), plugin_cwe = todynamic(json_plugin.cwe), plugin_wasc = todynamic(json_plugin.wasc), plugin_in_the_news = tobool(json_plugin.in_the_news), plugin_exploited_by_malware = tobool(json_plugin.exploited_by_malware), plugin_exploit_frameworks = todynamic(json_plugin.exploit_frameworks), plugin_vpr_score = toreal(json_plugin_vpr.score), plugin_vpr_drivers_age_of_vuln_lower_bound = toreal(json_plugin_vpr_drivers_age_of_vuln.lower_bound), plugin_vpr_drivers_exploit_code_maturity = tostring(json_plugin_vpr_drivers.exploit_code_maturity), plugin_vpr_drivers_cvss_impact_score_predicted = tobool(json_plugin_vpr_drivers.cvss_impact_score_predicted), plugin_vpr_drivers_cvss3_impact_score = toreal(json_plugin_vpr_drivers.cvss3_impact_score), plugin_vpr_drivers_threat_intensity_last28 = tostring(json_plugin_vpr_drivers.threat_intensity_last28), plugin_vpr_drivers_threat_sources_last28 = todynamic(json_plugin_vpr_drivers.threat_sources_last28), plugin_vpr_drivers_product_coverage = tostring(json_plugin_vpr_drivers.product_coverage), plugin_vpr_updated = todatetime(json_plugin_vpr.updated), plugin_cvss2_base_score = toreal(json_plugin.cvss2_base_score), plugin_cvss2_vector_access_complexity = tostring(json_plugin_cvss2_vector.access_complexity), plugin_cvss2_vector_access_vector = tostring(json_plugin_cvss2_vector.access_vector), plugin_cvss2_vector_authentication = tostring(json_plugin_cvss2_vector.authentication), plugin_cvss2_vector_availability_impact = tostring(json_plugin_cvss2_vector.availability_impact), plugin_cvss2_vector_confidentiality_impact = tostring(json_plugin_cvss2_vector.confidentiality_impact), plugin_cvss2_vector_integrity_impact = tostring(json_plugin_cvss2_vector.integrity_impact), plugin_cvss2_vector_raw = tostring(json_plugin_cvss2_vector.raw), plugin_cvss3_base_score = toreal(json_plugin.cvss3_base_score), plugin_cvss3_vector_access_complexity = tostring(json_plugin_cvss3_vector.access_complexity), plugin_cvss3_vector_access_vector = tostring(json_plugin_cvss3_vector.access_vector), plugin_cvss3_vector_availability_impact = tostring(json_plugin_cvss3_vector.availability_impact), plugin_cvss3_vector_confidentiality_impact = tostring(json_plugin_cvss3_vector.confidentiality_impact), plugin_cvss3_vector_integrity_impact = tostring(json_plugin_cvss3_vector.integrity_impact), plugin_cvss3_vector_raw = tostring(json_plugin_cvss3_vector.raw), plugin_owasp_2010 = todynamic(json_plugin.owasp_2010), plugin_owasp_2013 = todynamic(json_plugin.owasp_2013), plugin_owasp_2017 = todynamic(json_plugin.owasp_2017), plugin_owasp_2021 = todynamic(json_plugin.owasp_2021), plugin_owasp_api_2019 = todynamic(json_plugin.owasp_api_2019), asset_uuid = tostring(json_asset.uuid), asset_fqdn = tostring(json_asset.fqdn), asset_ipv4s = todynamic(json_asset.ipv4s), asset_ipv4 = tostring(json_asset.ipv4), scan_completed_at = todatetime(json_scan.completed_at), scan_uuid = tostring(json_scan.uuid)\n| project-away json_plugin, plugin, json_plugin_vpr, plugin_vpr, json_plugin_vpr_drivers, plugin_vpr_drivers, json_plugin_vpr_drivers_age_of_vuln, plugin_vpr_drivers_age_of_vuln, json_plugin_cvss2_vector, plugin_cvss2_vector, json_plugin_cvss3_vector, plugin_cvss3_vector, json_asset, asset, json_scan, scan",
                        "outputStream": "[concat('Custom-', parameters('WASVulnTableName'), '_CL')]"
                    },
                    {
                        "streams": [
                            "[concat('Custom-', parameters('ComplianceTableName'))]"
                        ],
                        "destinations": [
                            "[concat('RuleDest', variables('suffix'))]"
                        ],
                        "transformKql": "source\n| extend TimeGenerated = todatetime(now()), json_asset = parse_json(asset)\n| extend asset_id = tostring(json_asset.id), asset_ipv4_addresses = todynamic(json_asset.ipv4_addresses), asset_ipv6_addresses = todynamic(json_asset.ipv6_addresses), asset_fqdns = todynamic(json_asset.fqdns), asset_name = tostring(json_asset.name), asset_agent_name = tostring(json_asset.agent_name), asset_agent_uuid = tostring(json_asset.agent_uuid), asset_netbios_name = tostring(json_asset.netbios_name), asset_mac_addresses = todynamic(json_asset.mac_addresses), asset_operating_systems = todynamic(json_asset.operating_systems), asset_system_type = tostring(json_asset.system_type), asset_network_id = tostring(json_asset.network_id), asset_tags = todynamic(json_asset.tags)\n| project-away json_asset, asset",
                        "outputStream": "[concat('Custom-', parameters('ComplianceTableName'), '_CL')]"
                    },
                    {
                        "streams": [
                            "[concat('Custom-', parameters('WASAssetTableName'))]"
                        ],
                        "destinations": [
                            "[concat('RuleDest', variables('suffix'))]"
                        ],
                        "transformKql": "source\n| extend TimeGenerated = todatetime(now()), json_scan = parse_json(scan), json_cloud = parse_json(cloud), json_third_party_ids = parse_json(third_party_ids), json_network = parse_json(network), json_timestamps = parse_json(timestamps), json_ratings = parse_json(ratings)\n| extend json_cloud_azure = parse_json(json_cloud.azure), json_cloud_gcp = parse_json(json_cloud.gcp), json_cloud_aws = parse_json(json_cloud.aws), json_ratings_acr = parse_json(json_ratings.acr), json_ratings_aes = parse_json(json_ratings.aes)\n| extend scan_first_scan_time = todatetime(json_scan.first_scan_time), scan_last_scan_time = todatetime(json_scan.last_scan_time), scan_last_authenticated_scan_date = todatetime(json_scan.last_authenticated_scan_date), scan_last_licensed_scan_date = todatetime(json_scan.last_licensed_scan_date), scan_last_scan_id = tostring(json_scan.last_scan_id), scan_last_schedule_id = tostring(json_scan.last_schedule_id), scan_last_authentication_attempt_date = todatetime(json_scan.last_authentication_attempt_date), scan_last_authentication_success_date = todatetime(json_scan.last_authentication_success_date), scan_last_authentication_scan_status = tostring(json_scan.last_authentication_scan_status), scan_last_scan_target = tostring(json_scan.last_scan_target), cloud_azure_vm_id = tostring(json_cloud_azure.vm_id), cloud_azure_resource_id = tostring(json_cloud_azure.resource_id), cloud_gcp_project_id = tostring(json_cloud_gcp.project_id), cloud_gcp_zone = tostring(json_cloud_gcp.zone), cloud_gcp_instance_id = tostring(json_cloud_gcp.instance_id), cloud_aws_ec2_instance_ami_id = tostring(json_cloud_aws.ec2_instance_ami_id), cloud_aws_ec2_instance_id = tostring(json_cloud_aws.ec2_instance_id), cloud_aws_owner_id = tostring(json_cloud_aws.owner_id), cloud_aws_availability_zone = tostring(json_cloud_aws.availability_zone), cloud_aws_region = tostring(json_cloud_aws.region), cloud_aws_vpc_id = tostring(json_cloud_aws.vpc_id), cloud_aws_ec2_instance_group_name = tostring(json_cloud_aws.ec2_instance_group_name), cloud_aws_ec2_instance_state_name = tostring(json_cloud_aws.ec2_instance_state_name), cloud_aws_ec2_instance_type = tostring(json_cloud_aws.ec2_instance_type), cloud_aws_subnet_id = tostring(json_cloud_aws.subnet_id), cloud_aws_ec2_product_code = tostring(json_cloud_aws.ec2_product_code), cloud_aws_ec2_name = tostring(json_cloud_aws.ec2_name), third_party_ids_mcafee_epo_guid = tostring(json_third_party_ids.mcafee_epo_guid), third_party_ids_mcafee_epo_agent_guid = tostring(json_third_party_ids.mcafee_epo_agent_guid), third_party_ids_servicenow_sysid = tostring(json_third_party_ids.servicenow_sysid), third_party_ids_bigfix_asset_id = tostring(json_third_party_ids.bigfix_asset_id), third_party_ids_qualys_asset_ids = todynamic(json_third_party_ids.qualys_asset_ids), third_party_ids_qualys_host_ids = todynamic(json_third_party_ids.qualys_host_ids), third_party_ids_symantec_ep_hardware_keys = todynamic(json_third_party_ids.symantec_ep_hardware_keys), network_network_id = tostring(json_network.network_id), network_network_name = tostring(json_network.network_name), network_bios_uuid = tostring(json_network.bios_uuid), network_ipv4s = todynamic(json_network.ipv4s), network_ipv6s = todynamic(json_network.ipv6s), network_fqdns = todynamic(json_network.fqdns), network_mac_addresses = todynamic(json_network.mac_addresses), network_netbios_names = todynamic(json_network.netbios_names), network_hostnames = todynamic(json_network.hostnames), network_ssh_fingerprints = todynamic(json_network.ssh_fingerprints), network_network_interfaces = todynamic(json_network.network_interfaces), network_open_ports = todynamic(json_network.open_ports), timestamps_created_at = todatetime(json_timestamps.created_at), timestamps_updated_at = todatetime(json_timestamps.updated_at), timestamps_deleted_at = todatetime(json_timestamps.deleted_at), timestamps_terminated_at = todatetime(json_timestamps.terminated_at), timestamps_first_seen = todatetime(json_timestamps.first_seen), timestamps_last_seen = todatetime(json_timestamps.last_seen), ratings_acr_score = toreal(json_ratings_acr.score), ratings_aes_score = toreal(json_ratings_aes.score)\n| project-away json_scan, scan, json_cloud, cloud, json_cloud_azure, cloud_azure, json_cloud_gcp, cloud_gcp, json_cloud_aws, cloud_aws, json_third_party_ids, third_party_ids, json_network, network, json_timestamps, timestamps, json_ratings, ratings, json_ratings_acr, ratings_acr, json_ratings_aes, ratings_aes",
                        "outputStream": "[concat('Custom-', parameters('WASAssetTableName'), '_CL')]"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/components",
            "apiVersion": "2020-02-02",
            "name": "[variables('FunctionName')]",
            "location": "[resourceGroup().location]",
            "kind": "web",
            "properties": {
                "Application_Type": "web",
                "ApplicationId": "[variables('FunctionName')]",
                "WorkspaceResourceId": "[parameters('AppInsightsWorkspaceResourceID')]"
            }
        },
        {
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2019-06-01",
            "name": "[tolower(variables('FunctionName'))]",
            "location": "[resourceGroup().location]",
            "sku": {
                "name": "Standard_LRS",
                "tier": "Standard"
            },
            "kind": "StorageV2",
            "properties": {
                "networkAcls": {
                    "bypass": "AzureServices",
                    "virtualNetworkRules": [],
                    "ipRules": [],
                    "defaultAction": "Allow"
                },
                "supportsHttpsTrafficOnly": true,
                "encryption": {
                    "services": {
                        "file": {
                            "keyType": "Account",
                            "enabled": true
                        },
                        "blob": {
                            "keyType": "Account",
                            "enabled": true
                        }
                    },
                    "keySource": "Microsoft.Storage"
                },
                "minimumTlsVersion": "TLS1_2"
            }
        },
        {
            "type": "Microsoft.Storage/storageAccounts/blobServices",
            "apiVersion": "2019-06-01",
            "name": "[concat(variables('FunctionName'), '/default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', tolower(variables('FunctionName')))]"
            ],
            "sku": {
                "name": "Standard_LRS",
                "tier": "Standard"
            },
            "properties": {
                "cors": {
                    "corsRules": []
                },
                "deleteRetentionPolicy": {
                    "enabled": false
                }
            }
        },
        {
            "type": "Microsoft.Storage/storageAccounts/fileServices",
            "apiVersion": "2019-06-01",
            "name": "[concat(variables('FunctionName'), '/default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', tolower(variables('FunctionName')))]"
            ],
            "sku": {
                "name": "Standard_LRS",
                "tier": "Standard"
            },
            "properties": {
                "cors": {
                    "corsRules": []
                }
            }
        },
        {
            "type": "Microsoft.Web/sites",
            "apiVersion": "2018-11-01",
            "name": "[variables('FunctionName')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', tolower(variables('FunctionName')))]",
                "[resourceId('Microsoft.Insights/components', variables('FunctionName'))]"
            ],
            "kind": "functionapp,linux",
            "identity": {
                "type": "SystemAssigned"
            },
            "tags": {
                "Tenable": "AzureSentinel"
            },
            "properties": {
                "name": "[variables('FunctionName')]",
                "httpsOnly": true,
                "clientAffinityEnabled": true,
                "alwaysOn": true,
                "reserved": true,
                "siteConfig": {
                    "linuxFxVersion": "python|3.12"
                }
            },
            "resources": [
                {
                    "apiVersion": "2018-11-01",
                    "type": "config",
                    "name": "appsettings",
                    "dependsOn": [
                        "[concat('Microsoft.Web/sites/', variables('FunctionName'))]"
                    ],
                    "properties": {
                        "FUNCTIONS_EXTENSION_VERSION": "~4",
                        "FUNCTIONS_WORKER_RUNTIME": "python",
                        "APPINSIGHTS_INSTRUMENTATIONKEY": "[reference(resourceId('Microsoft.insights/components', variables('FunctionName')), '2015-05-01').InstrumentationKey]",
                        "APPLICATIONINSIGHTS_CONNECTION_STRING": "[reference(resourceId('microsoft.insights/components', variables('FunctionName')), '2015-05-01').ConnectionString]",
                        "AzureWebJobsStorage": "[concat('DefaultEndpointsProtocol=https;AccountName=', toLower(variables('FunctionName')),';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts', toLower(variables('functionName'))), '2019-06-01').keys[0].value, ';EndpointSuffix=',toLower(variables('StorageSuffix')))]",
                        "TIO_SECRET_KEY": "[parameters('TenableSecretKey')]",
                        "TIO_ACCESS_KEY": "[parameters('TenableAccessKey')]",
                        "AZURE_CLIENT_ID": "[trim(parameters('AzureClientID'))]",
                        "AZURE_CLIENT_SECRET": "[trim(parameters('AzureClientSecret'))]",
                        "AZURE_TENANT_ID": "[trim(parameters('TenantID'))]",
                        "LowestSeveritytoStore": "[parameters('Lowest Severity to Store')]",
                        "ComplianceDataIngestion": "[parameters('ComplianceDataIngestion')]",
                        "WASAssetDataIngestion": "[parameters('WASAssetDataIngestion')]",
                        "WASVulnerabilityDataIngestion": "[parameters('WASVulnerabilityDataIngestion')]",
                        "TenableExportScheduleInMinutes": "[parameters('TenableExportScheduleInMinutes')]",
                        "LowestSeveritytoStoreWAS": "[parameters('Lowest Severity to Store for WAS')]",
                        "AssetTableName": "[parameters('AssetTableName')]",
                        "VulnTableName": "[parameters('VulnTableName')]",
                        "ComplianceTableName": "[parameters('ComplianceTableName')]",
                        "WASAssetTableName": "[parameters('WASAssetTableName')]",
                        "WASVulnTableName": "[parameters('WASVulnTableName')]",
                        "SCOPE": "[variables('scope')]",
                        "PyTenableUAVendor": "Microsoft",
                        "PyTenableUAProduct": "Azure Sentinel",
                        "PyTenableUABuild": "3.1.0",
                        "WEBSITE_RUN_FROM_PACKAGE": "https://aka.ms/sentinel-TenableVMAzureSentinelConnector310Updated-functionapp",
                        "AZURE_DATA_COLLECTION_ENDPOINT": "[reference(resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('endpointName'))).logsIngestion.endpoint]",
                        "AZURE_DATA_COLLECTION_RULE_ID_MAIN_TABLES": "[reference(resourceId('Microsoft.Insights/dataCollectionRules', variables('mainRuleName'))).immutableId]"
                    }
                }
            ]
        },
        {
            "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
            "apiVersion": "2019-06-01",
            "name": "[concat(variables('FunctionName'), '/default/azure-webjobs-hosts')]",
            "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts/blobServices', variables('FunctionName'), 'default')]",
                "[resourceId('Microsoft.Storage/storageAccounts', variables('FunctionName'))]"
            ],
            "properties": {
                "publicAccess": "None"
            }
        },
        {
            "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
            "apiVersion": "2019-06-01",
            "name": "[concat(variables('FunctionName'), '/default/azure-webjobs-secrets')]",
            "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts/blobServices', variables('FunctionName'), 'default')]",
                "[resourceId('Microsoft.Storage/storageAccounts', variables('FunctionName'))]"
            ],
            "properties": {
                "publicAccess": "None"
            }
        },
        {
            "type": "Microsoft.Storage/storageAccounts/fileServices/shares",
            "apiVersion": "2019-06-01",
            "name": "[concat(variables('FunctionName'), '/default/', tolower(variables('FunctionName')))]",
            "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts/fileServices', variables('FunctionName'), 'default')]",
                "[resourceId('Microsoft.Storage/storageAccounts', variables('FunctionName'))]"
            ],
            "properties": {
                "shareQuota": 5120
            }
        },
        {
            "type": "Microsoft.Authorization/roleDefinitions",
            "apiVersion": "2022-04-01",
            "name": "[variables('dcrRoleId')]",
            "properties": {
                "assignableScopes": [
                    "[resourceGroup().id]",
                    "[resourceId('Microsoft.Insights/dataCollectionRules', variables('mainRuleName'))]"
                ],
                "description": "Entra ID application access role",
                "permissions": [
                    {
                        "actions": [
                            "Microsoft.Insights/Register/Action",
                            "Microsoft.Support/*",
                            "Microsoft.Resources/subscriptions/resourceGroups/read"
                        ],
                        "dataActions": [
                            "Microsoft.Insights/Metrics/Write",
                            "Microsoft.Insights/Telemetry/Write"
                        ]
                    }
                ],
                "roleName": "[variables('dcrRoleName')]",
                "type": "customRole"
            }
        },
        {
            "type": "Microsoft.Authorization/roleAssignments",
            "apiVersion": "2022-04-01",
            "name": "[guid(resourceGroup().id, concat('Main DCR Role assignment', variables('FunctionName')))]",
            "dependsOn": [
                "[variables('dcrRoleId')]",
                "[variables('mainRuleName')]"
            ],
            "scope": "[resourceId('Microsoft.Insights/dataCollectionRules', variables('mainRuleName'))]",
            "properties": {
                "roleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', variables('dcrRoleId'))]",
                "principalId": "[parameters('AzureEntraObjectID')]"
            }
        }
    ]
}