{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Vectra AI",
    "comments": "Solution template for Vectra AI Detect"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Vectra AI Detect",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "Vectra AI Detect",
    "_solutionVersion": "3.0.0",
    "solutionId": "vectraaiinc.ai_vectra_detect_mss",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "AIVectraDetect",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "AIVectraDetect",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))),variables('dataConnectorVersion1')))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "workbookVersion1": "1.1.1",
    "workbookContentId1": "AIVectraDetectWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))),variables('workbookVersion1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "analyticRuleVersion1": "1.0.5",
    "analyticRulecontentId1": "321f9dbd-64b7-4541-81dc-08cf7732ccb0",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1'))),variables('analyticRuleVersion1')))]",
    "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId1'),'-', variables('analyticRuleVersion1'))))]",
    "analyticRuleVersion2": "1.0.1",
    "analyticRulecontentId2": "ce54b5d3-4c31-4eaf-a73e-31412270b6ab",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2'))),variables('analyticRuleVersion2')))]",
    "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId2'),'-', variables('analyticRuleVersion2'))))]",
    "analyticRuleVersion3": "1.0.6",
    "analyticRulecontentId3": "39e48890-2c02-487e-aa9e-3ba494061798",
    "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
    "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
    "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3'))),variables('analyticRuleVersion3')))]",
    "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId3'),'-', variables('analyticRuleVersion3'))))]",
    "analyticRuleVersion4": "1.0.5",
    "analyticRulecontentId4": "60eb6cf0-3fa1-44c1-b1fe-220fbee23d63",
    "_analyticRulecontentId4": "[variables('analyticRulecontentId4')]",
    "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId4'))]",
    "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId4'))),variables('analyticRuleVersion4')))]",
    "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId4'),'-', variables('analyticRuleVersion4'))))]",
    "analyticRuleVersion5": "1.0.1",
    "analyticRulecontentId5": "33e3b6da-2660-4cd7-9032-11be76db88d2",
    "_analyticRulecontentId5": "[variables('analyticRulecontentId5')]",
    "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId5'))]",
    "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId5'))),variables('analyticRuleVersion5')))]",
    "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId5'),'-', variables('analyticRuleVersion5'))))]",
    "analyticRuleVersion6": "1.1.6",
    "analyticRulecontentId6": "a34d0338-eda0-42b5-8b93-32aae0d7a501",
    "_analyticRulecontentId6": "[variables('analyticRulecontentId6')]",
    "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId6'))]",
    "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId6'))),variables('analyticRuleVersion6')))]",
    "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId6'),'-', variables('analyticRuleVersion6'))))]",
    "analyticRuleVersion7": "1.0.7",
    "analyticRulecontentId7": "6cb75f65-231f-46c4-a0b3-50ff21ee6ed3",
    "_analyticRulecontentId7": "[variables('analyticRulecontentId7')]",
    "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId7'))]",
    "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId7'))),variables('analyticRuleVersion7')))]",
    "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId7'),'-', variables('analyticRuleVersion7'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Vectra AI Detect data connector with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Vectra AI Detect",
                  "publisher": "Vectra AI",
                  "descriptionMarkdown": "The AI Vectra Detect connector allows users to connect Vectra Detect logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives users more insight into their organization's network and improves their security operation capabilities.",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "AIVectraDetect",
                      "baseQuery": "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct  == \"X Series\"\n| sort by TimeGenerated \n"
                    },
                    {
                      "description": "Host Count by Severity",
                      "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\" and DeviceEventClassID == \"hsc\"\n| extend src = coalesce(SourceHostName, SourceIP)\n| summarize arg_max(TimeGenerated, *) by src\n| extend status = case(FlexNumber1>=50 and FlexNumber2<50, \"High\",  FlexNumber1>=50 and FlexNumber2>=50, \"Critical\",  FlexNumber1<50 and FlexNumber2>=50, \"Medium\",  FlexNumber1>0 and FlexNumber1<50 and FlexNumber2>0 and FlexNumber2<50,\"Low\",  \"Other\")\n| where status != \"Other\"\n| summarize Count = count() by status"
                    },
                    {
                      "description": "List of worst offenders",
                      "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\" and DeviceEventClassID == \"hsc\"\n| extend src = coalesce(SourceHostName, SourceIP)\n| summarize arg_max(TimeGenerated, *) by src\n| sort by FlexNumber1 desc, FlexNumber2 desc\n| limit 10\n| project row_number(), src, SourceIP, FlexNumber1 , FlexNumber2, TimeGenerated\n| project-rename Sr_No = Column1, Source = src, Source_IP = SourceIP, Threat = FlexNumber1, Certainty = FlexNumber2, Latest_Detection = TimeGenerated"
                    },
                    {
                      "description": "Top 10 Detection Types",
                      "query": "CommonSecurityLog\r\n| extend ExternalID = coalesce(column_ifexists(\"ExtID\", \"\"), tostring(ExternalID), \"\")\r\n| where DeviceVendor == \"Vectra Networks\" and DeviceEventClassID !in (\"health\", \"audit\", \"campaigns\", \"hsc\", \"asc\") and isnotnull(ExternalID)\r\n| summarize Count = count() by DeviceEventClassID\r\n| top 10 by Count desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "CommonSecurityLog (AIVectraDetect)",
                      "lastDataReceivedQuery": "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
                      "innerSteps": [
                        {
                          "title": "1.1 Select or create a Linux machine",
                          "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds."
                        },
                        {
                          "title": "1.2 Install the CEF collector on the Linux machine",
                          "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 over TCP, UDP or TLS.\n\n> 1. Make sure that you have Python on your machine using the following command: python --version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                          "instructions": [
                            {
                              "parameters": {
                                "fillWith": [
                                  "WorkspaceId",
                                  "PrimaryKey"
                                ],
                                "label": "Run the following command to install and apply the CEF collector:",
                                "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                              },
                              "type": "CopyableLabel"
                            }
                          ]
                        }
                      ],
                      "title": "1. Linux Syslog agent configuration"
                    },
                    {
                      "description": "Configure Vectra (X Series) Agent to forward Syslog messages in CEF format to your Microsoft Sentinel workspace via the Syslog agent.\n\nFrom the Vectra UI, navigate to Settings > Notifications and Edit Syslog configuration. Follow below instructions to set up the connection:\n\n- Add a new Destination (which is the host where the Microsoft Sentinel Syslog Agent is running)\n\n- Set the Port as **514**\n\n- Set the Protocol as **UDP**\n\n- Set the format to **CEF**\n\n- Set Log types (Select all log types available)\n\n- Click on **Save**\n\nUser can click the **Test** button to force send some test events.\n\n For more information, refer to Cognito Detect Syslog Guide which can be downloaded from the ressource page in Detect UI.",
                      "title": "2. Forward AI Vectra Detect logs to Syslog agent in CEF format"
                    },
                    {
                      "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python --version\n\n>2. You must have elevated permissions (sudo) on your machine",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Run the following command to validate your connectivity:",
                            "value": "sudo wget  -O cef_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py  {0}"
                          },
                          "type": "CopyableLabel"
                        }
                      ],
                      "title": "3. Validate connection"
                    },
                    {
                      "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
                      "title": "4. Secure your machine "
                    }
                  ],
                  "metadata": {
                    "id": "2de7b355-5f0b-4eb1-a264-629314ef86e5",
                    "version": "1.0.0",
                    "kind": "dataConnector",
                    "source": {
                      "kind": "community"
                    },
                    "author": {
                      "name": "Vectra AI"
                    },
                    "support": {
                      "name": "Vectra AI",
                      "link": "https://www.vectra.ai/support",
                      "tier": "developer"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Vectra AI Detect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Vectra AI"
                },
                "support": {
                  "name": "Vectra AI",
                  "tier": "Partner",
                  "email": "support@vectra.ai",
                  "link": "https://www.vectra.ai/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "Vectra AI Detect",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Vectra AI Detect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Vectra AI"
        },
        "support": {
          "name": "Vectra AI",
          "tier": "Partner",
          "email": "support@vectra.ai",
          "link": "https://www.vectra.ai/support"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Vectra AI Detect",
          "publisher": "Vectra AI",
          "descriptionMarkdown": "The AI Vectra Detect connector allows users to connect Vectra Detect logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives users more insight into their organization's network and improves their security operation capabilities.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "AIVectraDetect",
              "baseQuery": "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n"
            }
          ],
          "dataTypes": [
            {
              "name": "CommonSecurityLog (AIVectraDetect)",
              "lastDataReceivedQuery": "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "All logs",
              "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct  == \"X Series\"\n| sort by TimeGenerated \n"
            },
            {
              "description": "Host Count by Severity",
              "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\" and DeviceEventClassID == \"hsc\"\n| extend src = coalesce(SourceHostName, SourceIP)\n| summarize arg_max(TimeGenerated, *) by src\n| extend status = case(FlexNumber1>=50 and FlexNumber2<50, \"High\",  FlexNumber1>=50 and FlexNumber2>=50, \"Critical\",  FlexNumber1<50 and FlexNumber2>=50, \"Medium\",  FlexNumber1>0 and FlexNumber1<50 and FlexNumber2>0 and FlexNumber2<50,\"Low\",  \"Other\")\n| where status != \"Other\"\n| summarize Count = count() by status"
            },
            {
              "description": "List of worst offenders",
              "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\" and DeviceEventClassID == \"hsc\"\n| extend src = coalesce(SourceHostName, SourceIP)\n| summarize arg_max(TimeGenerated, *) by src\n| sort by FlexNumber1 desc, FlexNumber2 desc\n| limit 10\n| project row_number(), src, SourceIP, FlexNumber1 , FlexNumber2, TimeGenerated\n| project-rename Sr_No = Column1, Source = src, Source_IP = SourceIP, Threat = FlexNumber1, Certainty = FlexNumber2, Latest_Detection = TimeGenerated"
            },
            {
              "description": "Top 10 Detection Types",
              "query": "CommonSecurityLog\r\n| extend ExternalID = coalesce(column_ifexists(\"ExtID\", \"\"), tostring(ExternalID), \"\")\r\n| where DeviceVendor == \"Vectra Networks\" and DeviceEventClassID !in (\"health\", \"audit\", \"campaigns\", \"hsc\", \"asc\") and isnotnull(ExternalID)\r\n| summarize Count = count() by DeviceEventClassID\r\n| top 10 by Count desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
              "innerSteps": [
                {
                  "title": "1.1 Select or create a Linux machine",
                  "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds."
                },
                {
                  "title": "1.2 Install the CEF collector on the Linux machine",
                  "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 over TCP, UDP or TLS.\n\n> 1. Make sure that you have Python on your machine using the following command: python --version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                  "instructions": [
                    {
                      "parameters": {
                        "fillWith": [
                          "WorkspaceId",
                          "PrimaryKey"
                        ],
                        "label": "Run the following command to install and apply the CEF collector:",
                        "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                      },
                      "type": "CopyableLabel"
                    }
                  ]
                }
              ],
              "title": "1. Linux Syslog agent configuration"
            },
            {
              "description": "Configure Vectra (X Series) Agent to forward Syslog messages in CEF format to your Microsoft Sentinel workspace via the Syslog agent.\n\nFrom the Vectra UI, navigate to Settings > Notifications and Edit Syslog configuration. Follow below instructions to set up the connection:\n\n- Add a new Destination (which is the host where the Microsoft Sentinel Syslog Agent is running)\n\n- Set the Port as **514**\n\n- Set the Protocol as **UDP**\n\n- Set the format to **CEF**\n\n- Set Log types (Select all log types available)\n\n- Click on **Save**\n\nUser can click the **Test** button to force send some test events.\n\n For more information, refer to Cognito Detect Syslog Guide which can be downloaded from the ressource page in Detect UI.",
              "title": "2. Forward AI Vectra Detect logs to Syslog agent in CEF format"
            },
            {
              "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python --version\n\n>2. You must have elevated permissions (sudo) on your machine",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Run the following command to validate your connectivity:",
                    "value": "sudo wget  -O cef_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py  {0}"
                  },
                  "type": "CopyableLabel"
                }
              ],
              "title": "3. Validate connection"
            },
            {
              "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
              "title": "4. Secure your machine "
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AIVectraDetectWorkbookWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Start investigating network attacks surfaced by Vectra Detect directly from Sentinel. View critical hosts, accounts, campaigns and detections. Also monitor Vectra system health and audit logs."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"cellValue\":\"workbook-group\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Cognito Detect\",\"subTarget\":\"detect\",\"style\":\"link\"},{\"cellValue\":\"workbook-group\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Health\",\"subTarget\":\"health\",\"style\":\"link\"},{\"cellValue\":\"workbook-group\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Audit\",\"subTarget\":\"audit\",\"style\":\"link\"}]},\"name\":\"Links\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"cellValue\":\"workbook\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Overview\",\"subTarget\":\"Overview\",\"style\":\"link\"},{\"cellValue\":\"workbook\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Hosts\",\"subTarget\":\"Hosts\",\"style\":\"link\"},{\"cellValue\":\"workbook\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Accounts\",\"subTarget\":\"Accounts\",\"style\":\"link\"},{\"cellValue\":\"workbook\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Detections\",\"subTarget\":\"Detections\",\"style\":\"link\"},{\"cellValue\":\"workbook\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Campaigns\",\"subTarget\":\"Campaigns\",\"style\":\"link\"}]},\"conditionalVisibility\":{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"detect\"},\"name\":\"Detect Links\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"521734b3-6af4-48dc-b622-3f3dd3e1bdeb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"time_token\",\"label\":\"Timerange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"Overview - Parameters\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"datatable (Count:long, status:string, status_count:long) [0,\\\"Low\\\",1, 0,\\\"Medium\\\",2, 0,\\\"High\\\",3, 0,\\\"Critical\\\",4]\\r\\n|union\\r\\n(\\r\\nCommonSecurityLog\\r\\n| where DeviceVendor==\\\"Vectra Networks\\\" and DeviceEventClassID==\\\"hsc\\\"\\r\\n| extend src = coalesce(SourceHostName, SourceIP)\\r\\n| summarize arg_max(TimeGenerated, *) by src\\r\\n| extend status = case(FlexNumber1>=50 and FlexNumber2<50, \\\"High\\\",\\r\\n                        FlexNumber1>=50 and FlexNumber2>=50, \\\"Critical\\\",\\r\\n                        FlexNumber1<50 and FlexNumber2>=50, \\\"Medium\\\",\\r\\n                        FlexNumber1>0 and FlexNumber1<50 and FlexNumber2>0 and FlexNumber2<50,\\\"Low\\\",\\r\\n                        \\\"True\\\"\\r\\n                         )\\r\\n| where status != \\\"True\\\"\\r\\n| extend status_count = case(status==\\\"Critical\\\", 4, status==\\\"High\\\", 3, status==\\\"Medium\\\", 2, 1)\\r\\n| summarize Count = count() by status, status_count\\r\\n)\\r\\n| summarize Count=sum(Count) by status, status_count\\r\\n| sort by status_count asc\",\"size\":4,\"showAnalytics\":true,\"title\":\"Hosts Count By Severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"exportFieldName\":\"status\",\"exportParameterName\":\"status\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"status\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3},\"emptyValCustomText\":\"0\"}},\"showBorder\":true,\"sortCriteriaField\":\"status_count\",\"sortOrderField\":1},\"graphSettings\":{\"type\":2,\"topContent\":{\"columnMatch\":\"status\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"centerContent\":{\"columnMatch\":\"status_count\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"status\",\"nodeSize\":\"\",\"staticNodeSize\":100,\"colorSettings\":{\"nodeColorField\":\"status\",\"type\":1,\"colorPalette\":\"default\"},\"hivesMargin\":5}},\"customWidth\":\"100\",\"name\":\"Overview - Hosts Count By Severity\",\"styleSettings\":{\"progressStyle\":\"squares\"}},{\"type\":1,\"content\":{\"json\":\"ðŸ’¡ _Click on the above tile to view more details_\"},\"name\":\"Drill Down Info\"},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"status\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor==\\\"Vectra Networks\\\" and DeviceEventClassID==\\\"hsc\\\"\\r\\n| extend src = coalesce(SourceHostName, SourceIP)\\r\\n| summarize arg_max(TimeGenerated, *) by src\\r\\n| extend status = case(FlexNumber1>=50 and FlexNumber2<50, \\\"High\\\",\\r\\n                        FlexNumber1>=50 and FlexNumber2>=50, \\\"Critical\\\",\\r\\n                        FlexNumber1<50 and FlexNumber2>=50, \\\"Medium\\\",\\r\\n                        FlexNumber1>0 and FlexNumber1<50 and FlexNumber2>0 and FlexNumber2<50,\\\"Low\\\",\\r\\n                        \\\"True\\\"\\r\\n                         )\\r\\n| where status != \\\"True\\\" and '{status}'==status\\r\\n| sort by FlexNumber1 desc, FlexNumber2 desc\\r\\n| project row_number() , status ,src,SourceIP ,DeviceCustomString1 , DeviceCustomString2 , FlexNumber1 , FlexNumber2 , DeviceCustomString4 , TimeGenerated \\r\\n| project-rename Sr_No = Column1, Severity=status , Hostname=src, IP_Address=SourceIP , Src_Key_Asset=DeviceCustomString1 , Dest_Key_Asset=DeviceCustomString2 , Threat=FlexNumber1 , Certainty=FlexNumber2 , Host_Details=DeviceCustomString4, Latest_Update = TimeGenerated\\r\\n\\r\\n\",\"size\":0,\"title\":\"Hosts With {status} Severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"exportFieldName\":\"Hostname\",\"exportParameterName\":\"hostname\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Sr_No\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Hostname\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IP_Address\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Src_Key_Asset\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Dest_Key_Asset\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Host_Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"\",\"showIcon\":true}},{\"columnMatch\":\"Latest_Update\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Column1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"src\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Row number\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true,\"aggregation\":\"Count\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"Severity\"},{\"columnId\":\"Hostname\"},{\"columnId\":\"IP_Address\"},{\"columnId\":\"Src_Key_Asset\"},{\"columnId\":\"Dest_Key_Asset\"},{\"columnId\":\"Threat\"},{\"columnId\":\"Certainty\"},{\"columnId\":\"Host_Details\"},{\"columnId\":\"Latest_Update\"}]}},\"conditionalVisibility\":{\"parameterName\":\"status\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Overview - Hosts With selected Severity\",\"styleSettings\":{\"progressStyle\":\"squares\"}},{\"type\":1,\"content\":{\"json\":\"ðŸ’¡ _Click on a row in the above grid to view more details_\"},\"conditionalVisibility\":{\"parameterName\":\"status\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Info\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n    and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID))\\r\\n| where isnotempty(ExternalID)\\r\\n| search kind=case_sensitive '{hostname}'\\r\\n| summarize arg_max(TimeGenerated, *) by ExternalID\\r\\n| parse AdditionalExtensions with * \\\"cat=\\\" Category \\\";\\\"*\\r\\n| extend src = coalesce(SourceHostName, SourceIP), dst = coalesce(DestinationHostName, DestinationIP), Category = coalesce(column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),Category,\\\"\\\")\\r\\n| sort by TimeGenerated desc, FlexNumber1 desc, FlexNumber2 desc\\r\\n| project row_number(), TimeGenerated, DeviceCustomString5, Category, DeviceEventClassID, src, SourceIP, dst, DestinationIP, FlexNumber1, FlexNumber2, DeviceCustomString4\\r\\n| project-rename Sr_No = Column1, Detection_Time = TimeGenerated, Triaged = DeviceCustomString5, Type = DeviceEventClassID , Source = src , Source_IP = SourceIP ,Destination = dst , Destination_IP = DestinationIP  , Threat = FlexNumber1 , Certainty = FlexNumber2, Detection_Details = DeviceCustomString4\\r\\n| take 10\",\"size\":0,\"title\":\"Latest 10 Detections For Host: {hostname}\",\"noDataMessage\":\"No detections found for the selected host in the specified time duration.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Detection_Time\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Triaged\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"success\",\"text\":\"{0}{1}\"}]},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Detection_Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"showIcon\":true}}],\"rowLimit\":10}},\"conditionalVisibility\":{\"parameterName\":\"hostname\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Overview - Top 10 Detections For selected Host\"},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"status\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor==\\\"Vectra Networks\\\" and DeviceEventClassID == \\\"hsc\\\"\\r\\n| extend src = coalesce(SourceHostName, SourceIP)\\r\\n| summarize arg_max(TimeGenerated, *) by src \\r\\n| sort by FlexNumber1 desc, FlexNumber2 desc\\r\\n| limit 10\\r\\n| project row_number(), src, SourceIP, FlexNumber1 , FlexNumber2, TimeGenerated\\r\\n| project-rename Sr_No = Column1, Source=src, Source_IP=SourceIP, Threat=FlexNumber1, Certainty=FlexNumber2, Latest_Detection = TimeGenerated\",\"size\":0,\"showAnalytics\":true,\"title\":\"Worst Offenders\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Source\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Latest_Detection\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":10}},\"customWidth\":\"50\",\"name\":\"Overview - Worst Offenders\",\"styleSettings\":{\"progressStyle\":\"squares\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor==\\\"Vectra Networks\\\" and DeviceEventClassID == \\\"hsc\\\" and (DeviceCustomString1 == \\\"True\\\" or DeviceCustomString2 == \\\"True\\\")\\r\\n| extend src = coalesce(SourceHostName, SourceIP)\\r\\n| summarize arg_max(TimeGenerated, *) by src \\r\\n| sort by FlexNumber1 desc, FlexNumber2 desc\\r\\n| limit 10\\r\\n| project row_number(), src, SourceIP, DeviceCustomString1 , DeviceCustomString2, FlexNumber1 , FlexNumber2, TimeGenerated\\r\\n| project-rename Sr_No = Column1, Source=src, Source_IP=SourceIP,Src_Key_Asset=DeviceCustomString1,Des_Key_Asset=DeviceCustomString2, Threat=FlexNumber1, Certainty=FlexNumber2, Latest_Detection = TimeGenerated\",\"size\":0,\"showAnalytics\":true,\"title\":\"Key Assets\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Source\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Src_Key_Asset\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Des_Key_Asset\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Latest_Detection\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":10}},\"customWidth\":\"50\",\"name\":\"Overview - Key Assets\",\"styleSettings\":{\"progressStyle\":\"squares\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor==\\\"Vectra Networks\\\" and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| summarize Count=count() by DeviceEventClassID \\r\\n| top 10 by Count desc\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 10 Detection Types\",\"color\":\"turquoise\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"exportFieldName\":\"x\",\"exportParameterName\":\"type_token\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"Overview - Top 10 Detection Types\",\"styleSettings\":{\"progressStyle\":\"squares\",\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"ðŸ’¡ _Click on a bar in the above chart to view more details_\"},\"name\":\"Drill Down Info\"},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"type_token\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n    and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| parse AdditionalExtensions with * \\\"cat=\\\" Category \\\";\\\"*\\r\\n| where DeviceEventClassID == '{type_token}'\\r\\n| extend src = coalesce(SourceHostName, SourceIP), dst = coalesce(DestinationHostName, DestinationIP), Category = coalesce(column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),Category,\\\"\\\")\\r\\n| sort by TimeGenerated desc, FlexNumber1 desc, FlexNumber2 desc\\r\\n| project row_number(), DeviceCustomString5, Category, src, SourceIP, dst, DestinationIP, FlexNumber1, FlexNumber2, DeviceCustomString4, TimeGenerated\\r\\n| project-rename Sr_No = Column1, Triaged = DeviceCustomString5, Source = src , Source_IP = SourceIP ,Destination = dst , Destination_IP = DestinationIP  , Threat = FlexNumber1 , Certainty = FlexNumber2, Detection_Details = DeviceCustomString4, Latest_Detection = TimeGenerated\",\"size\":0,\"title\":\"Details For Detection Type: {type_token}\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Triaged\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Detection_Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"showIcon\":true}},{\"columnMatch\":\"Latest_Detection\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"type_token\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Overview - Details For selected Detection Type\",\"styleSettings\":{\"progressStyle\":\"squares\"}},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"type_token\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor==\\\"Vectra Networks\\\" and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| parse AdditionalExtensions with * \\\"cat=\\\" cat \\\";\\\"*\\r\\n| extend cat = coalesce(\\r\\n                column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                cat,\\r\\n                \\\"\\\"\\r\\n            )\\r\\n| summarize Count = count() by cat\\r\\n| top 10 by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 10 Detection Categories\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"exportFieldName\":\"x\",\"exportParameterName\":\"category_token\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"cat\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"Overview - Top 10 Detection Categories\",\"styleSettings\":{\"progressStyle\":\"squares\",\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"ðŸ’¡ _Click on a bar in the above chart to view more details_\"},\"name\":\"Drill Down Info\"},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"category_token\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n    and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| parse AdditionalExtensions with * \\\"cat=\\\" Category \\\";\\\"*\\r\\n| extend Category = coalesce(column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),Category,\\\"\\\")\\r\\n| where Category == \\\"{category_token}\\\"\\r\\n| extend src = coalesce(SourceHostName, SourceIP), dst = coalesce(DestinationHostName, DestinationIP)\\r\\n| sort by TimeGenerated desc, FlexNumber1 desc, FlexNumber2 desc\\r\\n| project row_number(), DeviceCustomString5, DeviceEventClassID, src, SourceIP, dst, DestinationIP, FlexNumber1, FlexNumber2, DeviceCustomString4, TimeGenerated\\r\\n| project-rename Sr_No = Column1, Triaged = DeviceCustomString5, Type = DeviceEventClassID , Source = src , Source_IP = SourceIP ,Destination = dst , Destination_IP = DestinationIP  , Threat = FlexNumber1 , Certainty = FlexNumber2, Detection_Details = DeviceCustomString4, Latest_Detection = TimeGenerated\",\"size\":0,\"title\":\"Details For Detection Category: {category_token}\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Triaged\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Detection_Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"showIcon\":true}},{\"columnMatch\":\"Latest_Detection\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"category_token\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Overview - Details For selected Detection Category\",\"styleSettings\":{\"progressStyle\":\"squares\"}},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"category_token\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"detect\"},{\"parameterName\":\"workbook\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"}],\"conditionalVisibility\":{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"detect\"},\"name\":\"Cognito Detect - Overview\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"e2a6498e-1f10-4c1a-90cf-b0d97004f545\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Timerange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"1840c704-6f4b-40fd-8a54-6984bdc1d7e3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"severity_token\",\"label\":\"Severity\",\"type\":2,\"isRequired\":true,\"query\":\"datatable (status:string) [\\\"All\\\"]\\r\\n|union\\r\\n(\\r\\nCommonSecurityLog\\r\\n| where DeviceEventClassID == \\\"hsc\\\" and DeviceVendor == \\\"Vectra Networks\\\"\\r\\n| extend src = coalesce(SourceHostName, SourceIP)\\r\\n| summarize arg_max(TimeGenerated, *) by src\\r\\n| extend status = case(FlexNumber1>=50 and FlexNumber2<50, \\\"High\\\",\\r\\n                       FlexNumber1>=50 and FlexNumber2>=50, \\\"Critical\\\",\\r\\n                       FlexNumber1<50 and FlexNumber2>=50, \\\"Medium\\\",\\r\\n                       FlexNumber1>0 and FlexNumber1<50 and FlexNumber2>0 and FlexNumber2<50,\\\"Low\\\",\\r\\n                       \\\"pass\\\"\\r\\n                         )\\r\\n| where status != \\\"pass\\\"\\r\\n| distinct status\\r\\n)\",\"value\":\"All\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Timerange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"Hosts - Parameters\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let token = \\\"{severity_token}\\\";\\r\\nCommonSecurityLog\\r\\n| where DeviceEventClassID == \\\"hsc\\\" and DeviceVendor == \\\"Vectra Networks\\\"\\r\\n| extend src = coalesce(SourceHostName, SourceIP)\\r\\n| summarize arg_max(TimeGenerated, *) by src\\r\\n| extend status = case(FlexNumber1>=50 and FlexNumber2<50, \\\"High\\\",\\r\\n                      FlexNumber1>=50 and FlexNumber2>=50, \\\"Critical\\\",\\r\\n                      FlexNumber1<50 and FlexNumber2>=50, \\\"Medium\\\",\\r\\n                      FlexNumber1>0 and FlexNumber1<50 and FlexNumber2>0 and FlexNumber2<50,\\\"Low\\\",\\r\\n                      \\\"pass\\\"\\r\\n                        )\\r\\n| where status != \\\"pass\\\"\\r\\n| where case(token == \\\"All\\\", status!=\\\"All\\\", status==token)\\r\\n| sort by FlexNumber1 desc, FlexNumber2 desc,TimeGenerated desc\\r\\n| project row_number(), status , SourceHostName , SourceIP , DeviceCustomString1 , DeviceCustomString2 , FlexNumber1 , FlexNumber2 , DeviceCustomString4 , TimeGenerated\\r\\n| project-rename Sr_No = Column1, Severity = status ,Hostname= SourceHostName , Source_IP = SourceIP , Src_Key_Asset = DeviceCustomString1 ,Dest_Key_Asset = DeviceCustomString2 , Threat = FlexNumber1 , Certainty = FlexNumber2 , Host_Details = DeviceCustomString4, Latest_Update = TimeGenerated\\r\\n\",\"size\":1,\"showAnalytics\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Timerange\",\"exportFieldName\":\"Hostname\",\"exportParameterName\":\"hostname\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"All\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Hostname\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Src_Key_Asset\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Dest_Key_Asset\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Host_Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"showIcon\":true}},{\"columnMatch\":\"Latest_Update\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true}},\"name\":\"Hosts - Details\"},{\"type\":1,\"content\":{\"json\":\"ðŸ’¡ _Click on a row in the above grid to view more details_\"},\"name\":\"Drill Down Info\"},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"hostname\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceEventClassID == \\\"hsc\\\" and DeviceVendor == \\\"Vectra Networks\\\"\\r\\n| extend src = coalesce(SourceHostName, SourceIP)\\r\\n| where src=='{hostname}'\\r\\n| summarize arg_max(TimeGenerated, FlexNumber1, FlexNumber2) by TimeGenerated=bin(TimeGenerated,10m)\\r\\n| project-rename Threat=FlexNumber1, Certainty=FlexNumber2\\r\\n\",\"size\":0,\"aggregation\":5,\"title\":\"Threat And Certainty Over Time For Host: {hostname}\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Timerange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Threat\",\"label\":\"Threat\",\"color\":\"redBright\"},{\"seriesName\":\"Certainty\",\"label\":\"Certainty\",\"color\":\"blue\"}]}},\"conditionalVisibility\":{\"parameterName\":\"hostname\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Hosts - Threat And Certainty Over Time For selected Host\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n    and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n    and (isnotnull(ExternalID) or isnotnull(ExtID))\\r\\n| parse-where AdditionalExtensions with * \\\"cat=\\\" Category \\\";\\\"*\\r\\n| extend src = coalesce(SourceHostName, SourceIP), dst = coalesce(DestinationHostName, DestinationIP), Category = coalesce(Category, DeviceEventCategory), ExternalID = coalesce(ExternalID,toint(ExtID))\\r\\n| search kind=case_sensitive '{hostname}'\\r\\n| summarize arg_max(TimeGenerated, *) by ExternalID\\r\\n| sort by FlexNumber1 desc, FlexNumber2 desc\\r\\n| project row_number(), TimeGenerated, DeviceCustomString5, Category, DeviceEventClassID, src, SourceIP, dst, DestinationIP, FlexNumber1, FlexNumber2, DeviceCustomString4\\r\\n| project-rename Sr_No = Column1, Detection_Time = TimeGenerated, Triaged = DeviceCustomString5, Type = DeviceEventClassID , Source = src , Source_IP = SourceIP ,Destination = dst , Destination_IP = DestinationIP  , Threat = FlexNumber1 , Certainty = FlexNumber2, Detection_Details = DeviceCustomString4\",\"size\":0,\"title\":\"Detection Details For Host: {hostname}\",\"noDataMessage\":\"No detections found for the selected host in the specified time duration.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Timerange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Detection_Time\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Triaged\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"success\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Detection_Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"showIcon\":true}}],\"rowLimit\":10000}},\"conditionalVisibility\":{\"parameterName\":\"hostname\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Hosts - Detection Details For selected Host\"},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"hostname\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"detect\"},{\"parameterName\":\"workbook\",\"comparison\":\"isEqualTo\",\"value\":\"Hosts\"}],\"conditionalVisibility\":{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"detect\"},\"name\":\"Cognito Detect - Hosts\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"8641c210-ae59-4759-be51-6c92fa8e4d4e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"time_token\",\"label\":\"Timerange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"f27ef7a3-1638-4b26-8027-7bc5ca4948b4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"severity_token\",\"label\":\"Severity\",\"type\":2,\"isRequired\":true,\"query\":\"datatable (status:string) [\\\"All\\\"]\\r\\n|union\\r\\n(\\r\\nCommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\" and DeviceEventClassID == \\\"asc\\\" and isnotnull(FlexNumber1) and isnotnull(FlexNumber2)\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| summarize arg_max(TimeGenerated, *) by ExternalID\\r\\n| extend status = case(FlexNumber1>=50 and FlexNumber2<50, \\\"High\\\",\\r\\n                       FlexNumber1>=50 and FlexNumber2>=50, \\\"Critical\\\",\\r\\n                       FlexNumber1<50 and FlexNumber2>=50, \\\"Medium\\\",\\r\\n                       FlexNumber1>0 and FlexNumber1<50 and FlexNumber2>0 and FlexNumber2<50,\\\"Low\\\",\\r\\n                       \\\"pass\\\"\\r\\n                         )\\r\\n| where status != \\\"pass\\\"\\r\\n| distinct status\\r\\n)\",\"value\":\"All\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"Accounts - Parameters\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor==\\\"Vectra Networks\\\" and DeviceEventClassID==\\\"asc\\\" and isnotnull(FlexNumber1) and isnotnull(FlexNumber2)\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| summarize arg_max(TimeGenerated, *) by ExternalID\\r\\n| extend status = case(FlexNumber1>=50 and FlexNumber2<50, \\\"High\\\",FlexNumber1>=50 and FlexNumber2>=50, \\\"Critical\\\",FlexNumber1<50 and FlexNumber2>=50, \\\"Medium\\\",FlexNumber1>0 and FlexNumber1<50 and FlexNumber2>0 and FlexNumber2<50,\\\"Low\\\",\\\"True\\\")\\r\\n| extend saccount = extract(\\\"saccount=(.+?);\\\", 1, AdditionalExtensions)\\r\\n | where status != \\\"True\\\"\\r\\n| where case(\\\"{severity_token}\\\" == \\\"All\\\", status!=\\\"All\\\", status==\\\"{severity_token}\\\")\\r\\n| sort by FlexNumber1 desc, FlexNumber2 desc\\r\\n| project row_number(), status, saccount, FlexNumber1, FlexNumber2, DeviceCustomString4, TimeGenerated\\r\\n| project-rename Sr_No = Column1, Severity=status, Account_Name=saccount, Threat=FlexNumber1, Certainty=FlexNumber2, Account_Details=DeviceCustomString4, Latest_Update = TimeGenerated\",\"size\":0,\"showAnalytics\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"exportFieldName\":\"Account_Name\",\"exportParameterName\":\"account_name\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Account_Name\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Account_Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"showIcon\":true}},{\"columnMatch\":\"Latest_Update\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true}},\"name\":\"Accounts - Details\"},{\"type\":1,\"content\":{\"json\":\"ðŸ’¡ _Click on a row in the above grid to view more details_\"},\"name\":\"Drill Down Info\"},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"account_name\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\" and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| parse AdditionalExtensions with * \\\"cat=\\\" Category \\\";\\\"*\\r\\n| parse-where AdditionalExtensions with * \\\"account=\\\" account \\\";\\\"*\\r\\n| extend Category = coalesce(\\r\\n                        column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                        Category,\\r\\n                        \\\"\\\"\\r\\n                    )\\r\\n| where account == '{account_name}'\\r\\n| summarize count() by Category, TimeGenerated\",\"size\":0,\"showAnnotations\":true,\"title\":\"Detection Categories Over Time For Account: {account_name}\",\"noDataMessage\":\"No detections found for the selected Account in the specified time duration.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\"},\"conditionalVisibility\":{\"parameterName\":\"account_name\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Accounts - Detection Categories over Time for selected Account\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\" and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\") \\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| parse AdditionalExtensions with * \\\"cat=\\\" Category \\\";\\\"*\\r\\n| parse-where AdditionalExtensions with * \\\"account=\\\" account \\\";\\\"*\\r\\n| extend Category = coalesce(column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),Category,\\\"\\\")\\r\\n| where account == '{account_name}'\\r\\n| sort by TimeGenerated desc, FlexNumber1 desc, FlexNumber2 desc\\r\\n| project row_number(), TimeGenerated, DeviceCustomString5, Category, DeviceEventClassID, account, FlexNumber1, FlexNumber2, DeviceCustomString4\\r\\n| project-rename Sr_No = Column1, Detection_Time = TimeGenerated, Triaged = DeviceCustomString5, Type = DeviceEventClassID , Account = account , Threat = FlexNumber1 , Certainty = FlexNumber2, Detection_Details = DeviceCustomString4\",\"size\":0,\"title\":\"Detections Details For Account: {account_name}\",\"noDataMessage\":\"No detections found for the selected Account in the specified time duration.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_token\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Triaged\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Detection_Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"showIcon\":true}},{\"columnMatch\":\"Latest_Detection\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":10000}},\"conditionalVisibility\":{\"parameterName\":\"account_name\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Accounts - Detection Details for selected Account\"},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"account_name\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"workbook\",\"comparison\":\"isEqualTo\",\"value\":\"Accounts\"},{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"detect\"}],\"conditionalVisibility\":{\"parameterName\":\"workbook\",\"comparison\":\"isEqualTo\",\"value\":\"Accounts\"},\"name\":\"Cognito Detect - Accounts\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"4464cdd2-3612-4e5c-ba5e-791de3647382\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Time_Range\",\"label\":\"Timerange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"06436e5d-7593-4db7-9b38-cd148e7ef014\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"category_token\",\"label\":\"Detection Categories\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n| where DeviceEventClassID !in~ (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| parse AdditionalExtensions with * \\\"cat=\\\" Category \\\";\\\"*\\r\\n| extend Category = coalesce(column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),Category,\\\"\\\")\\r\\n| distinct Category\\r\\n\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Time_Range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"dd678237-f94c-4041-acca-99d5213042db\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"type_token\",\"label\":\"Type\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n| where DeviceEventClassID !in~ (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| extend Category = column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\")\\r\\n| where Category in ({category_token})\\r\\n| distinct DeviceEventClassID\\r\\n\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Time_Range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"Detections - Parameters\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n    and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| parse AdditionalExtensions with * \\\"cat=\\\" Category \\\";\\\"*\\r\\n| extend Category = coalesce(\\r\\n                        column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                        Category,\\r\\n                        \\\"\\\"\\r\\n                    )\\r\\n| where Category in ({category_token}) \\r\\n    and DeviceEventClassID in ({type_token})\\r\\n| summarize count() by Category, TimeGenerated\",\"size\":0,\"showAnnotations\":true,\"showAnalytics\":true,\"title\":\"Detection Categories Over Time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Time_Range\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\",\"chartSettings\":{\"xAxis\":\"TimeGenerated\",\"ySettings\":{\"unit\":17,\"min\":\"\",\"max\":\"\"}}},\"name\":\"Detections - Detection Categories over Time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| extend Category = column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\")\\r\\n| where Category in ({category_token}) \\r\\n and DeviceEventClassID in ({type_token})\\r\\n| extend src = coalesce(SourceHostName, SourceIP), dst = coalesce(DestinationHostName, DestinationIP)\\r\\n| sort by TimeGenerated desc, FlexNumber1 desc, FlexNumber2 desc\\r\\n| project row_number(), TimeGenerated, ExternalID, DeviceCustomString5, Category, DeviceEventClassID, src, SourceIP, dst, DestinationIP, FlexNumber1, FlexNumber2, DeviceCustomString4\\r\\n| project-rename Sr_No = Column1,Detection_Time = TimeGenerated, External_ID = ExternalID, Triaged = DeviceCustomString5, Type = DeviceEventClassID , Source = src , Source_IP = SourceIP ,Destination = dst , Destination_IP = DestinationIP , Threat = FlexNumber1 , Certainty = FlexNumber2, Detection_Details = DeviceCustomString4\",\"size\":0,\"aggregation\":3,\"showAnalytics\":true,\"title\":\"Detection Details\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Time_Range\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Triaged\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Detection_Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"showIcon\":true}},{\"columnMatch\":\"Latest_Detection\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Triaged\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Threat\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"Detections - Detection Details\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"detect\"},{\"parameterName\":\"workbook\",\"comparison\":\"isEqualTo\",\"value\":\"Detections\"}],\"conditionalVisibility\":{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"detect\"},\"name\":\"Cognito Detect - Detections\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"02b1f3a8-4aa8-4a98-9725-0d960b4fecbf\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"timerange\",\"label\":\"Timerange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"799a853f-1f98-477e-b3bf-66cba445dcf5\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"campaign_token\",\"label\":\"Campaign ID\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\" and DeviceEventClassID == \\\"campaigns\\\"\\r\\n| distinct Activity\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"timerange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"3dc8536b-3619-4418-862b-023d05ae58bd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"type_token\",\"label\":\"Type\",\"type\":2,\"isRequired\":true,\"query\":\"datatable (reason:string) [\\\"All\\\"]\\r\\n| union\\r\\n(\\r\\nCommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\" and DeviceEventClassID == \\\"campaigns\\\"\\r\\n| parse AdditionalExtensions with * \\\"reason=\\\"reason\\r\\n| extend reason = coalesce(column_ifexists(\\\"Reason\\\", \\\"\\\"),reason,\\\"\\\")\\r\\n| where Activity in ({campaign_token})\\r\\n| distinct reason\\r\\n)\",\"value\":\"All\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"timerange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"Campaigns - Parameters\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\" and DeviceEventClassID == \\\"campaigns\\\"\\r\\n| parse AdditionalExtensions with * \\\"reason=\\\"reason\\r\\n| extend reason = coalesce(\\r\\n                        column_ifexists(\\\"Reason\\\", \\\"\\\"),\\r\\n                        reason,\\r\\n                        \\\"\\\"\\r\\n                    )\\r\\n| where Activity in ({campaign_token})\\r\\n| where case(\\\"{type_token}\\\" == \\\"All\\\", reason != \\\"All\\\", reason == \\\"{type_token}\\\")\\r\\n| extend src = coalesce(SourceHostName, SourceIP) , dest = coalesce(DestinationHostName, DestinationIP)\\r\\n| summarize Count = count() by Activity\\r\\n| top 10 by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 10 Campaigns\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"timerange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"chartSettings\":{\"xAxis\":\"Activity\",\"ySettings\":{\"unit\":17,\"min\":\"\",\"max\":\"\"}}},\"name\":\"Campaigns - Top 10 Campaigns\",\"styleSettings\":{\"progressStyle\":\"squares\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\" and DeviceEventClassID == \\\"campaigns\\\"\\r\\n| parse AdditionalExtensions with * \\\"reason=\\\"reason\\r\\n| extend reason = coalesce(\\r\\n                        column_ifexists(\\\"Reason\\\", \\\"\\\"),\\r\\n                        reason,\\r\\n                        \\\"\\\"\\r\\n                    )\\r\\n| where Activity in ({campaign_token})\\r\\n| where case(\\\"{type_token}\\\" == \\\"All\\\", reason != \\\"All\\\", reason == \\\"{type_token}\\\")\\r\\n| extend src = coalesce(SourceHostName, SourceIP) , dest = coalesce(DestinationHostName, DestinationIP)\\r\\n| sort by TimeGenerated desc\\r\\n| project row_number(), TimeGenerated , Activity , DeviceCustomString4 , DeviceAction , src , SourceIP , dest , DestinationIP , reason, DeviceCustomString6\\r\\n| project-rename Sr_No = Column1, Time_Generated = TimeGenerated, Campaign_ID = Activity, Campaign_URL = DeviceCustomString4, Action = DeviceAction, Hostname = src, Source_IP = SourceIP, Destination = dest, Destination_IP = DestinationIP, Type = reason, Detection_ID = DeviceCustomString6\",\"size\":0,\"showAnalytics\":true,\"title\":\"Campaign Details\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"timerange\",\"exportFieldName\":\"Hostname\",\"exportParameterName\":\"search_detections\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Time_Generated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Campaign_ID\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Campaign_URL\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"showIcon\":true}},{\"columnMatch\":\"Action\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Hostname\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Detection_ID\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true}},\"name\":\"Campaigns - Campaign Details\",\"styleSettings\":{\"progressStyle\":\"squares\"}},{\"type\":1,\"content\":{\"json\":\"ðŸ’¡ _Click on a row in the above grid to view more details_\"},\"name\":\"Drill Down Info\"},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"search_detections\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n    and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| parse AdditionalExtensions with * \\\"cat=\\\" Category \\\";\\\"*\\r\\n| extend Category = coalesce(\\r\\n                        column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                        Category,\\r\\n                        \\\"\\\"\\r\\n                    )\\r\\n| search kind=case_sensitive \\\"{search_detections}\\\"\\r\\n| summarize count() by Category, TimeGenerated\",\"size\":0,\"title\":\"Detection Categories Over Time for Host: {search_detections}\",\"noDataMessage\":\"No detections found for the selected host in the specified time duration.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"timerange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\",\"chartSettings\":{\"xAxis\":\"TimeGenerated\"}},\"conditionalVisibility\":{\"parameterName\":\"search_detections\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Campaigns - Detection Categories over Time for selected Host\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n    and DeviceEventClassID !in (\\\"health\\\", \\\"audit\\\", \\\"campaigns\\\", \\\"hsc\\\", \\\"asc\\\")\\r\\n| extend ExternalID = coalesce(column_ifexists(\\\"ExtID\\\", \\\"\\\"),tostring(ExternalID),\\\"\\\")\\r\\n| where isnotempty(ExternalID)\\r\\n| parse AdditionalExtensions with * \\\"cat=\\\" Category \\\";\\\"*\\r\\n| extend Category = coalesce(\\r\\n                        column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                        Category,\\r\\n                        \\\"\\\"\\r\\n                    )\\r\\n| search kind=case_sensitive \\\"{search_detections}\\\"\\r\\n| extend src = coalesce(SourceHostName, SourceIP), dst = coalesce(DestinationHostName, DestinationIP)\\r\\n| sort by TimeGenerated desc, FlexNumber1 desc, FlexNumber2 desc\\r\\n| project row_number(), TimeGenerated, DeviceCustomString5, Category, DeviceEventClassID, src, SourceIP, dst, DestinationIP, FlexNumber1, FlexNumber2, DeviceCustomString4\\r\\n| project-rename Sr_No = Column1,Detection_Time = TimeGenerated, Triaged = DeviceCustomString5, Type = DeviceEventClassID , Source = src , Source_IP = SourceIP ,Destination = dst , Destination_IP = DestinationIP  , Threat = FlexNumber1 , Certainty = FlexNumber2, Detection_Details = DeviceCustomString4\",\"size\":0,\"title\":\"Detection Details For Host: {search_detections}\",\"noDataMessage\":\"No detections found for the selected host in the specified time duration.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"timerange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Detection_Time\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Triaged\",\"formatter\":18,\"formatOptions\":{\"showIcon\":true,\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"True\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"False\",\"representation\":\"failed\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":\"\",\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Source_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Destination_IP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Threat\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redBright\",\"showIcon\":true}},{\"columnMatch\":\"Certainty\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"showIcon\":true}},{\"columnMatch\":\"Detection_Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"showIcon\":true}}],\"rowLimit\":10000}},\"conditionalVisibility\":{\"parameterName\":\"search_detections\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Campaigns - Detection details for selected Host\",\"styleSettings\":{\"progressStyle\":\"squares\"}},{\"type\":1,\"content\":{\"json\":\"<hr style=\\\"border-top: 1.25px dotted red;background-color:#fff;\\\">\"},\"conditionalVisibility\":{\"parameterName\":\"search_detections\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Drill Down Line\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"detect\"},{\"parameterName\":\"workbook\",\"comparison\":\"isEqualTo\",\"value\":\"Campaigns\"}],\"conditionalVisibility\":{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"detect\"},\"name\":\"Cognito Detect - Campaigns\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"01f96cf3-5a76-4528-a6e4-0dd997b074f0\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Timerange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"b015e943-3b18-4fc2-b048-408104856b8a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"result_token\",\"label\":\"Result\",\"type\":2,\"isRequired\":true,\"query\":\"datatable (Result:string) [\\\"All\\\"]\\r\\n| union\\r\\n(\\r\\nCommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n| where DeviceEventClassID == \\\"health\\\"\\r\\n| parse AdditionalExtensions with * \\\"outcome=\\\"Result\\r\\n| extend Result = coalesce(column_ifexists(\\\"EventOutcome\\\", \\\"\\\"),Result,\\\"\\\")\\r\\n| summarize by Result\\r\\n) \\r\\n\",\"value\":\"All\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Timerange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"Health - Parameters\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\"\\r\\n| where DeviceEventClassID == \\\"health\\\"\\r\\n| parse AdditionalExtensions with * \\\"outcome=\\\"outcome\\r\\n| extend outcome = coalesce(column_ifexists(\\\"EventOutcome\\\", \\\"\\\"),outcome,\\\"\\\")\\r\\n| where case(\\\"{result_token:value}\\\" == \\\"All\\\", outcome != \\\"All\\\", outcome==\\\"{result_token:value}\\\")\\r\\n| sort by TimeGenerated desc\\r\\n| project row_number(), TimeGenerated ,outcome,Message\\r\\n| project-rename Sr_No = Column1,Time_Generated = TimeGenerated, Activity = Message,Result = outcome\\r\\n\",\"size\":0,\"showAnalytics\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Timerange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Sr_No\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Time_Generated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Result\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Activity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"activity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"Sr_No\"},{\"columnId\":\"Time_Generated\"},{\"columnId\":\"Result\"},{\"columnId\":\"Activity\"}]}},\"customWidth\":\"100\",\"name\":\"Health - Details\"}]},\"conditionalVisibility\":{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"health\"},\"name\":\"Cognito Health\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b0cf3947-fa7b-438f-a994-40fc131f7350\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Timerange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"d1edf9eb-ef80-4bc2-84c6-d7a34487aafb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"user_token\",\"label\":\"User\",\"type\":2,\"isRequired\":true,\"query\":\"datatable (SourceUserName:string) [\\\"All\\\"]\\r\\n| union\\r\\n(\\r\\nCommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\" and DeviceEventClassID == \\\"audit\\\"\\r\\n| extend SourceUserName = coalesce(SourceUserName, \\\"Unknown\\\")\\r\\n| distinct SourceUserName\\r\\n)\",\"value\":\"All\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Timerange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"7ffa2e20-6a43-4afb-b38f-7db9816057ad\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"result_token\",\"label\":\"Result\",\"type\":2,\"isRequired\":true,\"query\":\"datatable (Result:string) [\\\"All\\\"]\\r\\n| union\\r\\n(\\r\\nCommonSecurityLog\\r\\n| where DeviceVendor == \\\"Vectra Networks\\\" and DeviceEventClassID == \\\"audit\\\"\\r\\n| parse AdditionalExtensions with * \\\"outcome=\\\"Result\\r\\n| extend Result = coalesce(column_ifexists(\\\"EventOutcome\\\", \\\"\\\"),Result,\\\"\\\")\\r\\n| where case(\\\"{user_token}\\\" == \\\"All\\\", SourceUserName != \\\"All\\\", \\\"{user_token}\\\" == \\\"Unknown\\\", SourceUserName == \\\"\\\", SourceUserName == \\\"{user_token}\\\")\\r\\n| distinct Result\\r\\n)\",\"value\":\"All\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Timerange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"Audit - Parameters\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceEventClassID == \\\"audit\\\" and DeviceVendor == \\\"Vectra Networks\\\"\\r\\n| parse AdditionalExtensions with * \\\"outcome=\\\"outcome\\r\\n| extend outcome = coalesce(column_ifexists(\\\"EventOutcome\\\", \\\"\\\"),outcome,\\\"\\\")\\r\\n| where case(\\\"{user_token}\\\" == \\\"All\\\", SourceUserName != \\\"All\\\", \\\"{user_token}\\\" == \\\"Unknown\\\", SourceUserName == \\\"\\\", SourceUserName == \\\"{user_token}\\\") \\r\\n    and case(\\\"{result_token}\\\" == \\\"All\\\", outcome != \\\"All\\\", outcome == \\\"{result_token}\\\")\\r\\n| sort by TimeGenerated desc\\r\\n| project row_number(), TimeGenerated,SourceUserName,SourceUserPrivileges,Message,outcome\\r\\n| project-rename Sr_No= Column1,Time_Generated = TimeGenerated, User=SourceUserName, Role=SourceUserPrivileges, Activity=Message, Result=outcome\",\"size\":0,\"showAnalytics\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"Timerange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"name\":\"Audit - Details\"}]},\"conditionalVisibility\":{\"parameterName\":\"workbook-group\",\"comparison\":\"isEqualTo\",\"value\":\"audit\"},\"name\":\"Cognito Audit\"},{\"type\":1,\"content\":{\"json\":\"ðŸ“ ***Refresh the web page to fetch details of recently collected events***\"},\"name\":\"Info Message\"}],\"fromTemplateId\":\"sentinel-AIVectraDetect\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=AIVectraDetectWorkbook; logoFileName=AIVectraDetect.svg; description=Start investigating network attacks surfaced by Vectra Detect directly from Sentinel. View critical hosts, accounts, campaigns and detections. Also monitor Vectra system health and audit logs.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.1.1; title=Vectra AI Detect; templateRelativePath=AIVectraDetectWorkbook.json; subtitle=; provider=Vectra AI}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Vectra AI Detect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Vectra AI"
                },
                "support": {
                  "name": "Vectra AI",
                  "tier": "Partner",
                  "email": "support@vectra.ai",
                  "link": "https://www.vectra.ai/support"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "CommonSecurityLog",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "AIVectraDetect",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "VectraDetect-Account-by-Severity_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Create an incident when an Account is suspected to be compromised. \nThe higher the severity level is, the more immediate attention it requires as Vectra AI engine is more confident that this is a real threat. \nLevel of severity are: Low, Medium, High, Critical). Recommended configuration is to trigger an alert for at least High and Critical.",
                "displayName": "Vectra AI Detect - Suspected Compromised Account",
                "enabled": false,
                "query": "// Edit this variable to only keep the Severity level where an incident needs to be created.\n//Level of severity are: Low, Medium, High, Critical). Recommended configuration is to trigger an alert for at least High and Critical.'\nlet configured_level = dynamic([\"High\", \"Critical\"]);\nlet upn_has_prefix = \":\";\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n| where DeviceEventClassID == \"asc\"\n| extend saccount = extract(\"saccount=(.+?);\", 1, AdditionalExtensions)\n| extend type = iff(saccount matches regex upn_has_prefix, tostring(split(saccount,\":\")[0]) ,\"network\" ) \n| extend upn = iff(saccount matches regex upn_has_prefix, tostring(split(saccount,\":\")[1]) , saccount )\n| extend name = tostring(split(upn,\"@\")[0])\n| extend upn_suffix = tostring(split(upn,\"@\")[1])\n| project-rename threat_score = FlexNumber1\n| project-rename certainty_score = FlexNumber2\n| project-rename vectra_URL = DeviceCustomString4\n| project-rename detection_name = DeviceEventClassID\n| project-rename score_decreases = DeviceCustomString3\n| extend level = case( threat_score <  50 and certainty_score < 50, \"Low\",\n                      threat_score < 50 and certainty_score >= 50 , \"Medium\", \n                      threat_score >= 50 and certainty_score <= 50, \"High\", \n                      threat_score >= 50 and certainty_score >= 50, \"Critical\",\n                      \"UNKNOWN\")\n| extend Severity = case(level == \"Info\", \"Informational\",level == \"Critical\", \"High\", level)\n| where level in (configured_level) \n//keep only the event with the highest threat score per Host\n| summarize arg_max(threat_score, *) by saccount\n| sort by TimeGenerated\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CommonSecurityLog"
                    ],
                    "connectorId": "AIVectraDetect"
                  }
                ],
                "tactics": [
                  "CredentialAccess",
                  "Discovery",
                  "LateralMovement",
                  "Collection",
                  "CommandAndControl",
                  "Exfiltration",
                  "Impact"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "name",
                        "identifier": "Name"
                      },
                      {
                        "columnName": "upn_suffix",
                        "identifier": "UPNSuffix"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "ScoreDecrease": "score_decreases"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [
                    {
                      "value": "vectra_URL",
                      "alertProperty": "AlertLink"
                    },
                    {
                      "value": "DeviceProduct",
                      "alertProperty": "ProductName"
                    },
                    {
                      "value": "DeviceVendor",
                      "alertProperty": "ProviderName"
                    },
                    {
                      "value": "certainty_score",
                      "alertProperty": "ConfidenceScore"
                    }
                  ],
                  "alertSeverityColumnName": "Severity",
                  "alertDescriptionFormat": "The account {{saccount}} has a threat score of {{threat_score}} and a\ncertainty of {{certainty_score}}\n",
                  "alertDisplayNameFormat": "Vectra AI Detect - Account {{saccount}} reaches {{level}} severity"
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "7d",
                    "reopenClosedIncident": true,
                    "enabled": true
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "Vectra AI Detect Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Vectra AI Detect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Vectra AI"
                },
                "support": {
                  "name": "Vectra AI",
                  "tier": "Partner",
                  "email": "support@vectra.ai",
                  "link": "https://www.vectra.ai/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId1')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Vectra AI Detect - Suspected Compromised Account",
        "contentProductId": "[variables('_analyticRulecontentProductId1')]",
        "id": "[variables('_analyticRulecontentProductId1')]",
        "version": "[variables('analyticRuleVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "VectraDetect-Account-Detections_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytic rule is looking for new attacker behaviors observed by the Vectra Platform. This rule is focused on account's detections.",
                "displayName": "Vectra Account's Behaviors",
                "enabled": false,
                "query": "CommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n| where DeviceEventClassID != \"campaigns\"\n    and DeviceEventClassID != \"hsc\"\n    and DeviceEventClassID != \"audit\"\n    and DeviceEventClassID != \"health\"\n    and DeviceEventClassID != \"asc\"\n| extend Category = coalesce(\n    column_ifexists(\"DeviceEventCategory\", \"\"), \n    extract(\"cat=(.+?)(;|$)\", 1, AdditionalExtensions), \n    \"\"\n    )\n| project-rename threat_score = FlexNumber1\n| project-rename certainty_score = FlexNumber2\n| project-rename vectra_URL = DeviceCustomString4\n| project-rename detection_name = DeviceEventClassID\n| project-rename triaged = DeviceCustomString5\n| where triaged != \"True\" and AdditionalExtensions contains \"account\"\n| extend account = extract(\"account=(.+?);\", 1, AdditionalExtensions)\n| extend upn = iff(account matches regex \":\", tostring(split(account, \":\")[1]), tostring(split(account, \":\")[0]))\n| extend name = tostring(split(upn, \"@\")[0])\n| extend upn_suffix = tostring(split(upn, \"@\")[1])\n| extend source_entity = case(isnotempty(upn), upn,\n    isnotempty(SourceHostName), SourceHostName,\n    \"UNKNWON\")\n| extend level = case(threat_score == 0 and certainty_score == 0, \"Info\",\n    threat_score < 50 and certainty_score < 50, \"Low\",\n    threat_score < 50 and certainty_score >= 50, \"Medium\", \n    threat_score >= 50 and certainty_score <= 50, \"High\", \n    threat_score >= 50 and certainty_score >= 50, \"Critical\",\n    \"UNKNOWN\")\n| extend Severity = case(level == \"Info\", \"Informational\",level == \"Critical\", \"High\", level)\n| summarize arg_max(threat_score, *) by source_entity, Activity\n| sort by TimeGenerated\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CommonSecurityLog"
                    ],
                    "connectorId": "AIVectraDetect"
                  }
                ],
                "tactics": [
                  "CredentialAccess",
                  "Discovery",
                  "LateralMovement",
                  "Collection",
                  "CommandAndControl",
                  "Exfiltration",
                  "Impact"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "name",
                        "identifier": "Name"
                      },
                      {
                        "columnName": "upn_suffix",
                        "identifier": "UPNSuffix"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "AttackCategory": "Category",
                  "AttackType": "Activity"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [
                    {
                      "value": "vectra_URL",
                      "alertProperty": "AlertLink"
                    },
                    {
                      "value": "DeviceProduct",
                      "alertProperty": "ProductName"
                    },
                    {
                      "value": "DeviceVendor",
                      "alertProperty": "ProviderName"
                    },
                    {
                      "value": "certainty_score",
                      "alertProperty": "ConfidenceScore"
                    }
                  ],
                  "alertSeverityColumnName": "Severity",
                  "alertDescriptionFormat": "Entity is an account. Category is {{Category}}. Threat score is {{threat_score}} and certainty score is {{certainty_score}}.\n",
                  "alertDisplayNameFormat": "Vectra AI - {{Activity}} Detected"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "Vectra AI Detect Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Vectra AI Detect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Vectra AI"
                },
                "support": {
                  "name": "Vectra AI",
                  "tier": "Partner",
                  "email": "support@vectra.ai",
                  "link": "https://www.vectra.ai/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId2')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Vectra Account's Behaviors",
        "contentProductId": "[variables('_analyticRulecontentProductId2')]",
        "id": "[variables('_analyticRulecontentProductId2')]",
        "version": "[variables('analyticRuleVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "VectraDetect-HighSeverityDetection-by-Tactics_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId3')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Create an incident for high severity malicious behavior detected by Vectra AI (Threat score superior to 7.0). \nThe Severity is a mapping with the Threat score assigned to a detection. It ranges between 0 and 10. \nThe severity_threshold variable can be adjusted as desired.",
                "displayName": "Vectra AI Detect - Detections with High Severity",
                "enabled": false,
                "query": "// Edit this variable to only keep the tactics where an incident needs to be created (Defaults are: \"COMMAND & CONTROL\", \"BOTNET ACTIVITY\", \"EXFILTRATION\", \"LATERAL MOVEMENT\", \"RECONNAISSANCE\")   \nlet configured_tactics = dynamic([\"COMMAND & CONTROL\", \"BOTNET ACTIVITY\", \"EXFILTRATION\", \"LATERAL MOVEMENT\", \"RECONNAISSANCE\"]);\n//default threshold is 7 (meaning a threat score of 70)\nlet severity_threshold = 7.0;\n//Map by default to High Severity in Sentinel\nlet Severity = \"High\";\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n| where DeviceEventClassID != \"campaigns\" and DeviceEventClassID != \"hsc\" and DeviceEventClassID != \"audit\" and DeviceEventClassID != \"health\" and DeviceEventClassID != \"asc\"\n| extend Category = coalesce(\n                          column_ifexists(\"DeviceEventCategory\", \"\"), \n                          extract(\"cat=(.+?)(;|$)\", 1, AdditionalExtensions), \n                          \"\"\n                      )\n| project-rename threat_score = FlexNumber1\n| project-rename certainty_score = FlexNumber2\n| project-rename vectra_URL = DeviceCustomString4\n| project-rename detection_name = DeviceEventClassID\n| where todecimal(LogSeverity) >= severity_threshold\n| extend Tactic = case( Category == \"COMMAND & CONTROL\", \"CommandAndControl\",\n                        Category == \"BOTNET ACTIVITY\" , \"Impact\",\n                        Category == \"EXFILTRATION\", \"Exfiltration\",\n                        Category == \"LATERAL MOVEMENT\", \"LateralMovement\",\n                        Category == \"RECONNAISSANCE\", \"Discovery\",\n                        \"UNKNOWN\")\n| extend level = case(threat_score == 0 and certainty_score == 0, \"Info\",\n    threat_score < 50 and certainty_score < 50, \"Low\",\n    threat_score < 50 and certainty_score >= 50, \"Medium\", \n    threat_score >= 50 and certainty_score <= 50, \"High\", \n    threat_score >= 50 and certainty_score >= 50, \"Critical\",\n    \"UNKNOWN\")\n| extend Severity = case(level == \"Info\", \"Informational\",level == \"Critical\", \"High\", level)\n| extend account = extract(\"account=(.+?);\", 1, AdditionalExtensions)\n| extend upn = iff(account matches regex \":\", tostring(split(account,\":\")[1]) ,tostring(split(account,\":\")[0]))\n| extend name = tostring(split(upn, \"@\")[0])\n| extend upn_suffix = tostring(split(upn, \"@\")[1])\n| extend source_entity = case( isnotempty(upn), upn,\n                               isnotempty(SourceHostName), SourceHostName,\n                               \"UNKNWON\") \n| where Category in (configured_tactics) \n| summarize arg_max(threat_score, *) by source_entity, Activity\n| sort by TimeGenerated\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CommonSecurityLog"
                    ],
                    "connectorId": "AIVectraDetect"
                  }
                ],
                "tactics": [
                  "CredentialAccess",
                  "Discovery",
                  "LateralMovement",
                  "Collection",
                  "CommandAndControl",
                  "Exfiltration",
                  "Impact"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      }
                    ]
                  },
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "name",
                        "identifier": "Name"
                      },
                      {
                        "columnName": "upn_suffix",
                        "identifier": "UPNSuffix"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "AttackCategory": "Category",
                  "AttackType": "Activity"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [
                    {
                      "value": "vectra_URL",
                      "alertProperty": "AlertLink"
                    },
                    {
                      "value": "DeviceProduct",
                      "alertProperty": "ProductName"
                    },
                    {
                      "value": "DeviceVendor",
                      "alertProperty": "ProviderName"
                    },
                    {
                      "value": "certainty_score",
                      "alertProperty": "ConfidenceScore"
                    }
                  ],
                  "alertSeverityColumnName": "Severity",
                  "alertDescriptionFormat": "Source entity is {{source_entity}} and category is {{Category}}. Threat score is {{threat_score}}.",
                  "alertDisplayNameFormat": "Vectra AI Detect - {{Activity}} detected"
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "7d",
                    "reopenClosedIncident": true,
                    "enabled": true
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
              "properties": {
                "description": "Vectra AI Detect Analytics Rule 3",
                "parentId": "[variables('analyticRuleId3')]",
                "contentId": "[variables('_analyticRulecontentId3')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Vectra AI Detect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Vectra AI"
                },
                "support": {
                  "name": "Vectra AI",
                  "tier": "Partner",
                  "email": "support@vectra.ai",
                  "link": "https://www.vectra.ai/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId3')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Vectra AI Detect - Detections with High Severity",
        "contentProductId": "[variables('_analyticRulecontentProductId3')]",
        "id": "[variables('_analyticRulecontentProductId3')]",
        "version": "[variables('analyticRuleVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "VectraDetect-Host-by-Severity_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId4')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Create an incident when a Host is suspected to be compromised. \nThe higher the severity level is, the more immediate attention it requires as Vectra AI engine is more confident that this is a real threat. \nLevel of severity are: Low, Medium, High, Critical). Recommended configuration is to trigger an alert for at least High and Critical.",
                "displayName": "Vectra AI Detect - Suspected Compromised Host",
                "enabled": false,
                "query": "// Edit this variable to only keep the Severity level where an incident needs to be created (Defaults are: \"High\", \"Critical\" ). Possible values are: \"Low\", \"Medium\", \"High\", \"Critical\"\nlet configured_level = dynamic([\"High\", \"Critical\"]);\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n| where DeviceEventClassID == \"hsc\"\n| project-rename threat_score = FlexNumber1\n| project-rename certainty_score = FlexNumber2\n| project-rename vectra_URL = DeviceCustomString4\n| project-rename detection_name = DeviceEventClassID\n| project-rename score_decreases = DeviceCustomString3\n| extend level = case( threat_score <  50 and certainty_score < 50, \"Low\",\n                      threat_score < 50 and certainty_score >= 50 , \"Medium\", \n                      threat_score >= 50 and certainty_score <= 50, \"High\", \n                      threat_score >= 50 and certainty_score >= 50, \"Critical\",\n                      \"UNKNOWN\")\n| extend Severity = case(level == \"Info\", \"Informational\",level == \"Critical\", \"High\", level)\n| where level in (configured_level) \n//keep only the event with the highest threat score per Host\n| summarize arg_max(TimeGenerated, *) by SourceHostName\n| sort by TimeGenerated\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CommonSecurityLog"
                    ],
                    "connectorId": "AIVectraDetect"
                  }
                ],
                "tactics": [
                  "CredentialAccess",
                  "Discovery",
                  "LateralMovement",
                  "Collection",
                  "CommandAndControl",
                  "Exfiltration",
                  "Impact"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "ScoreDecrease": "score_decreases"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [
                    {
                      "value": "vectra_URL",
                      "alertProperty": "AlertLink"
                    },
                    {
                      "value": "DeviceProduct",
                      "alertProperty": "ProductName"
                    },
                    {
                      "value": "DeviceVendor",
                      "alertProperty": "ProviderName"
                    },
                    {
                      "value": "certainty_score",
                      "alertProperty": "ConfidenceScore"
                    }
                  ],
                  "alertSeverityColumnName": "Severity",
                  "alertDescriptionFormat": "The host {{SourceHostName}} has a Threat score of {{threat_score}} and a\ncertainty of {{certainty_score}}\n",
                  "alertDisplayNameFormat": "Vectra AI Detect - Host {{SourceHostName}} reaches {{level}} severity"
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "7d",
                    "reopenClosedIncident": true,
                    "enabled": true
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId4'),'/'))))]",
              "properties": {
                "description": "Vectra AI Detect Analytics Rule 4",
                "parentId": "[variables('analyticRuleId4')]",
                "contentId": "[variables('_analyticRulecontentId4')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Vectra AI Detect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Vectra AI"
                },
                "support": {
                  "name": "Vectra AI",
                  "tier": "Partner",
                  "email": "support@vectra.ai",
                  "link": "https://www.vectra.ai/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId4')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Vectra AI Detect - Suspected Compromised Host",
        "contentProductId": "[variables('_analyticRulecontentProductId4')]",
        "id": "[variables('_analyticRulecontentProductId4')]",
        "version": "[variables('analyticRuleVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "VectraDetect-Host-Detections_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId5')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytic rule is looking for new attacker behaviors observed by the Vectra Platform. This rule is focused on host's detections.",
                "displayName": "Vectra Host's Behaviors",
                "enabled": false,
                "query": "CommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n| where DeviceEventClassID != \"campaigns\"\n    and DeviceEventClassID != \"hsc\"\n    and DeviceEventClassID != \"audit\"\n    and DeviceEventClassID != \"health\"\n    and DeviceEventClassID != \"asc\"\n| extend Category = coalesce(\n    column_ifexists(\"DeviceEventCategory\", \"\"), \n    extract(\"cat=(.+?)(;|$)\", 1, AdditionalExtensions), \n    \"\"\n    )\n| project-rename threat_score = FlexNumber1\n| project-rename certainty_score = FlexNumber2\n| project-rename vectra_URL = DeviceCustomString4\n| project-rename detection_name = DeviceEventClassID\n| project-rename triaged = DeviceCustomString5\n| where triaged != \"True\" and AdditionalExtensions !has \"account\"\n| extend source_entity = case(isnotempty(SourceHostName), SourceHostName,\n    \"UNKNWON\")\n| extend level = case(threat_score == 0 and certainty_score == 0, \"Info\",\n    threat_score < 50 and certainty_score < 50, \"Low\",\n    threat_score < 50 and certainty_score >= 50, \"Medium\", \n    threat_score >= 50 and certainty_score <= 50, \"High\", \n    threat_score >= 50 and certainty_score >= 50, \"Critical\",\n    \"UNKNOWN\")\n| extend Severity = case(level == \"Info\", \"Informational\",level == \"Critical\", \"High\", level)\n| summarize arg_max(threat_score, *) by source_entity, Activity\n| sort by TimeGenerated\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CommonSecurityLog"
                    ],
                    "connectorId": "AIVectraDetect"
                  }
                ],
                "tactics": [
                  "CredentialAccess",
                  "Discovery",
                  "LateralMovement",
                  "Collection",
                  "CommandAndControl",
                  "Exfiltration",
                  "Impact"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "AttackCategory": "Category",
                  "AttackType": "Activity"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [
                    {
                      "value": "vectra_URL",
                      "alertProperty": "AlertLink"
                    },
                    {
                      "value": "DeviceProduct",
                      "alertProperty": "ProductName"
                    },
                    {
                      "value": "DeviceVendor",
                      "alertProperty": "ProviderName"
                    },
                    {
                      "value": "certainty_score",
                      "alertProperty": "ConfidenceScore"
                    }
                  ],
                  "alertSeverityColumnName": "Severity",
                  "alertDescriptionFormat": "Entity is a host. Category is {{Category}}. Threat score is {{threat_score}} and certainty score is {{certainty_score}}.\n",
                  "alertDisplayNameFormat": "Vectra AI - {{Activity}} Detected"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId5'),'/'))))]",
              "properties": {
                "description": "Vectra AI Detect Analytics Rule 5",
                "parentId": "[variables('analyticRuleId5')]",
                "contentId": "[variables('_analyticRulecontentId5')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Vectra AI Detect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Vectra AI"
                },
                "support": {
                  "name": "Vectra AI",
                  "tier": "Partner",
                  "email": "support@vectra.ai",
                  "link": "https://www.vectra.ai/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId5')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Vectra Host's Behaviors",
        "contentProductId": "[variables('_analyticRulecontentProductId5')]",
        "id": "[variables('_analyticRulecontentProductId5')]",
        "version": "[variables('analyticRuleVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "VectraDetect-NewCampaign_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId6')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies when a new Campaign has been detected.  This occurs when multiple Detections accross different Hosts are suspected to be part of the same Attack Campaign.",
                "displayName": "Vectra AI Detect - New Campaign Detected",
                "enabled": false,
                "query": "CommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n| where DeviceEventClassID contains \"campaign\"\n| where DeviceAction == \"START\"\n| extend reason = coalesce(\n                          column_ifexists(\"Reason\", \"\"), \n                          extract(\"reason=(.+?)($|;)\", 1, AdditionalExtensions),\n                          \"\"\n                      )\n| project-rename vectra_URL = DeviceCustomString4\n| sort by TimeGenerated\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CommonSecurityLog"
                    ],
                    "connectorId": "AIVectraDetect"
                  }
                ],
                "tactics": [
                  "LateralMovement",
                  "CommandAndControl"
                ],
                "entityMappings": [
                  {
                    "entityType": "DNS",
                    "fieldMappings": [
                      {
                        "columnName": "Activity",
                        "identifier": "DomainName"
                      }
                    ]
                  }
                ],
                "customDetails": {
                  "CampaignName": "Activity",
                  "CampaignSourceHost": "SourceHostName",
                  "CampaignReason": "reason"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [
                    {
                      "value": "vectra_URL",
                      "alertProperty": "AlertLink"
                    },
                    {
                      "value": "DeviceProduct",
                      "alertProperty": "ProductName"
                    },
                    {
                      "value": "DeviceVendor",
                      "alertProperty": "ProviderName"
                    }
                  ],
                  "alertDescriptionFormat": "A new campaign named {{Activity}} has been detected (reason is {{reason}})\n",
                  "alertDisplayNameFormat": "Vectra AI - New Campaign Detected"
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "7d",
                    "reopenClosedIncident": true,
                    "enabled": true
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId6'),'/'))))]",
              "properties": {
                "description": "Vectra AI Detect Analytics Rule 6",
                "parentId": "[variables('analyticRuleId6')]",
                "contentId": "[variables('_analyticRulecontentId6')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "Vectra AI Detect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Vectra AI"
                },
                "support": {
                  "name": "Vectra AI",
                  "tier": "Partner",
                  "email": "support@vectra.ai",
                  "link": "https://www.vectra.ai/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId6')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Vectra AI Detect - New Campaign Detected",
        "contentProductId": "[variables('_analyticRulecontentProductId6')]",
        "id": "[variables('_analyticRulecontentProductId6')]",
        "version": "[variables('analyticRuleVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "VectraDetect-Suspected-Behavior-by-Tactics_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId7')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Create an incident for each new malicious behavior detected by Vectra Detect for a specific Category. \nBy default, it looks through all tactics. This can be modified to create incident only for a subset of tactics.",
                "displayName": "Vectra AI Detect - Suspicious Behaviors by Category",
                "enabled": false,
                "query": "// Edit this variable to only keep the tactics where an incident needs to be created (Defaults are: \"COMMAND & CONTROL\", \"BOTNET ACTIVITY\", \"EXFILTRATION\", \"LATERAL MOVEMENT\", \"RECONNAISSANCE\")   \nlet configured_tactics = dynamic([\"COMMAND & CONTROL\", \"BOTNET ACTIVITY\", \"EXFILTRATION\", \"LATERAL MOVEMENT\", \"RECONNAISSANCE\"]);\nCommonSecurityLog\n| where DeviceVendor == \"Vectra Networks\"\n| where DeviceProduct == \"X Series\"\n| where DeviceEventClassID != \"campaigns\" and DeviceEventClassID != \"hsc\" and DeviceEventClassID != \"audit\" and DeviceEventClassID != \"health\" and DeviceEventClassID != \"asc\" \n| extend Category = coalesce(\n                          column_ifexists(\"DeviceEventCategory\", \"\"), \n                          extract(\"cat=(.+?)(;|$)\", 1, AdditionalExtensions), \n                          \"\"\n                      )\n| project-rename threat_score = FlexNumber1\n| project-rename certainty_score = FlexNumber2\n| project-rename triaged = DeviceCustomString5\n| where triaged != \"True\"\n| project-rename vectra_URL = DeviceCustomString4\n| project-rename detection_name = DeviceEventClassID\n| extend Tactic = case( Category == \"COMMAND & CONTROL\", \"CommandAndControl\",\n                        Category == \"BOTNET ACTIVITY\" , \"Impact\",\n                        Category == \"EXFILTRATION\", \"Exfiltration\",\n                        Category == \"LATERAL MOVEMENT\", \"LateralMovement\",\n                        Category == \"RECONNAISSANCE\", \"Discovery\",\n                        \"UNKNOWN\")\n| extend level = case( threat_score <  50 and certainty_score < 50, \"Low\",\n                       threat_score < 50 and certainty_score >= 50 , \"Medium\", \n                       threat_score >= 50 and certainty_score <= 50, \"High\", \n                       threat_score >= 50 and certainty_score >= 50, \"Critical\",\n                       \"UNKNOWN\")\n| extend Severity = case(level == \"Info\", \"Informational\",level == \"Critical\", \"High\", level)\n| extend account = extract(\"account=(.+?);\", 1, AdditionalExtensions)\n| extend upn = iff(account matches regex \":\", tostring(split(account,\":\")[1]) ,tostring(split(account,\":\")[0]))\n| extend name = tostring(split(upn, \"@\")[0])\n| extend upn_suffix = tostring(split(upn, \"@\")[1])\n| extend source_entity = case(level == \"Info\", \"Informational\",level == \"Critical\", \"High\", level)\n| where Category in (configured_tactics) \n| summarize arg_max(threat_score, *) by source_entity , Activity\n| sort by TimeGenerated\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CommonSecurityLog"
                    ],
                    "connectorId": "AIVectraDetect"
                  }
                ],
                "tactics": [
                  "CredentialAccess",
                  "Discovery",
                  "LateralMovement",
                  "Collection",
                  "CommandAndControl",
                  "Exfiltration",
                  "Impact"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "SourceHostName",
                        "identifier": "HostName"
                      }
                    ]
                  },
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "name",
                        "identifier": "Name"
                      },
                      {
                        "columnName": "upn_suffix",
                        "identifier": "UPNSuffix"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "AttackCategory": "Category",
                  "AttackType": "Activity"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [
                    {
                      "value": "vectra_URL",
                      "alertProperty": "AlertLink"
                    },
                    {
                      "value": "DeviceProduct",
                      "alertProperty": "ProductName"
                    },
                    {
                      "value": "DeviceVendor",
                      "alertProperty": "ProviderName"
                    },
                    {
                      "value": "certainty_score",
                      "alertProperty": "ConfidenceScore"
                    }
                  ],
                  "alertSeverityColumnName": "Severity",
                  "alertDescriptionFormat": "Source entity is {{source_entity}} and category is {{Category}}. Threat score is {{threat_score}}.",
                  "alertDisplayNameFormat": "Vectra AI Detect - {{Activity}} detected"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId7'),'/'))))]",
              "properties": {
                "description": "Vectra AI Detect Analytics Rule 7",
                "parentId": "[variables('analyticRuleId7')]",
                "contentId": "[variables('_analyticRulecontentId7')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "Vectra AI Detect",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Vectra AI"
                },
                "support": {
                  "name": "Vectra AI",
                  "tier": "Partner",
                  "email": "support@vectra.ai",
                  "link": "https://www.vectra.ai/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId7')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Vectra AI Detect - Suspicious Behaviors by Category",
        "contentProductId": "[variables('_analyticRulecontentProductId7')]",
        "id": "[variables('_analyticRulecontentProductId7')]",
        "version": "[variables('analyticRuleVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Vectra AI Detect",
        "publisherDisplayName": "Vectra AI",
        "descriptionHtml": "<p><strong>Note:</strong> <em>There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</em></p>\n<p>The <a href=\"https://www.vectra.ai/products/platform%22%20/t%20%22_blank\">Vectra AI Detect</a> solution for Microsoft Sentinel enables you to ingest Vectra AI logs into Microsoft Sentinel, using the Common Event Format (CEF) for Security Monitoring.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ol type=\"a\">\n<li><a href=\"https://docs.microsoft.com/azure/sentinel/connect-common-event-format\">Agent-based log collection (CEF over Syslog)</a></li>\n</ol>\n<p><strong>Data Connectors:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 7</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/AIVectraDetect.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Vectra AI Detect",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Vectra AI"
        },
        "support": {
          "name": "Vectra AI",
          "email": "support@vectra.ai",
          "tier": "Partner",
          "link": "https://www.vectra.ai/support"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId3')]",
              "version": "[variables('analyticRuleVersion3')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId4')]",
              "version": "[variables('analyticRuleVersion4')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId5')]",
              "version": "[variables('analyticRuleVersion5')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId6')]",
              "version": "[variables('analyticRuleVersion6')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId7')]",
              "version": "[variables('analyticRuleVersion7')]"
            }
          ]
        },
        "firstPublishDate": "2022-05-24",
        "lastPublishDate": "2023-04-17",
        "providers": [
          "Vectra AI"
        ],
        "categories": {
          "domains": [
            "Security - Network",
            "Security - Cloud Security"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
