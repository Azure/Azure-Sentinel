{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for IoTOTThreatMonitoringwithDefenderforIoT"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Microsoft Defender for IoT",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "solutionId": "azuresentinel.azure-sentinel-solution-unifiedmicrosoftsocforot",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "VendorOriginalId": "VendorOriginalId",
    "_VendorOriginalId": "[variables('VendorOriginalId')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "IoTOTThreatMonitoringwithDefenderforIoTWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "analyticRuleVersion1": "1.0.1",
    "analyticRulecontentId1": "e068187a-01f5-4737-bc13-25db4027b7ea",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1')))]",
    "analyticRuleVersion2": "1.0.1",
    "analyticRulecontentId2": "f5217b4c-3f1f-4d89-b4f3-5d7581da1c1c",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2')))]",
    "analyticRuleVersion3": "1.0.1",
    "analyticRulecontentId3": "7cad4b66-5e83-4756-8de4-f21315ab1e77",
    "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
    "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
    "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3')))]",
    "analyticRuleVersion4": "1.0.1",
    "analyticRulecontentId4": "caa4665f-21fa-462d-bb31-92226e746c68",
    "_analyticRulecontentId4": "[variables('analyticRulecontentId4')]",
    "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId4'))]",
    "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId4')))]",
    "analyticRuleVersion5": "1.0.1",
    "analyticRulecontentId5": "208c3f5b-3ba2-49b5-9bca-c44e58cd5fd3",
    "_analyticRulecontentId5": "[variables('analyticRulecontentId5')]",
    "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId5'))]",
    "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId5')))]",
    "analyticRuleVersion6": "1.0.1",
    "analyticRulecontentId6": "70be4a31-9d2b-433b-bdc7-da8928988069",
    "_analyticRulecontentId6": "[variables('analyticRulecontentId6')]",
    "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId6'))]",
    "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId6')))]",
    "analyticRuleVersion7": "1.0.1",
    "analyticRulecontentId7": "f9df500a-e2a4-4104-a517-dc1d85bb654f",
    "_analyticRulecontentId7": "[variables('analyticRulecontentId7')]",
    "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId7'))]",
    "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId7')))]",
    "analyticRuleVersion8": "1.0.1",
    "analyticRulecontentId8": "9ff3b13b-287a-4ed0-8f6b-7e7b66cbbcbd",
    "_analyticRulecontentId8": "[variables('analyticRulecontentId8')]",
    "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId8'))]",
    "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId8')))]",
    "analyticRuleVersion9": "1.0.1",
    "analyticRulecontentId9": "6fb1acd5-356d-40f7-9b97-78d993c6a183",
    "_analyticRulecontentId9": "[variables('analyticRulecontentId9')]",
    "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId9'))]",
    "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId9')))]",
    "analyticRuleVersion10": "1.0.1",
    "analyticRulecontentId10": "493916d5-a094-4bfa-bdd1-d983a063ea3d",
    "_analyticRulecontentId10": "[variables('analyticRulecontentId10')]",
    "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId10'))]",
    "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId10')))]",
    "analyticRuleVersion11": "1.0.1",
    "analyticRulecontentId11": "a7d3f642-15d8-4e83-99ee-83ca3352525d",
    "_analyticRulecontentId11": "[variables('analyticRulecontentId11')]",
    "analyticRuleId11": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId11'))]",
    "analyticRuleTemplateSpecName11": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId11')))]",
    "analyticRuleVersion12": "1.0.1",
    "analyticRulecontentId12": "f4c71e55-6192-47ca-92e2-0856ae502a46",
    "_analyticRulecontentId12": "[variables('analyticRulecontentId12')]",
    "analyticRuleId12": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId12'))]",
    "analyticRuleTemplateSpecName12": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId12')))]",
    "analyticRuleVersion13": "1.0.1",
    "analyticRulecontentId13": "c52ec521-9188-4a9e-a4cd-34a3dfbc3d27",
    "_analyticRulecontentId13": "[variables('analyticRulecontentId13')]",
    "analyticRuleId13": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId13'))]",
    "analyticRuleTemplateSpecName13": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId13')))]",
    "analyticRuleVersion14": "1.0.1",
    "analyticRulecontentId14": "c2fb27c7-5f67-49c4-aaf3-d82934234a69",
    "_analyticRulecontentId14": "[variables('analyticRulecontentId14')]",
    "analyticRuleId14": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId14'))]",
    "analyticRuleTemplateSpecName14": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId14')))]",
    "analyticRuleVersion15": "1.0.1",
    "analyticRulecontentId15": "1ff4fa3d-150b-4c87-b733-26c289af0d49",
    "_analyticRulecontentId15": "[variables('analyticRulecontentId15')]",
    "analyticRuleId15": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId15'))]",
    "analyticRuleTemplateSpecName15": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId15')))]",
    "AutoCloseIncidents": "AutoCloseIncidents",
    "_AutoCloseIncidents": "[variables('AutoCloseIncidents')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "AutoCloseIncidents",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookId1": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId1'))]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId1')))]",
    "MailBySensor": "MailBySensor",
    "_MailBySensor": "[variables('MailBySensor')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "MailBySensor",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2')))]",
    "NewAssetServiceNowTicket": "NewAssetServiceNowTicket",
    "_NewAssetServiceNowTicket": "[variables('NewAssetServiceNowTicket')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "NewAssetServiceNowTicket",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3')))]",
    "AutoAlertStatusSync": "AutoAlertStatusSync",
    "_AutoAlertStatusSync": "[variables('AutoAlertStatusSync')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "AutoAlertStatusSync",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4')))]",
    "SendEmailToIoTOwner": "SendEmailToIoTOwner",
    "_SendEmailToIoTOwner": "[variables('SendEmailToIoTOwner')]",
    "playbookVersion5": "1.0",
    "playbookContentId5": "SendEmailToIoTOwner",
    "_playbookContentId5": "[variables('playbookContentId5')]",
    "playbookId5": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId5'))]",
    "playbookTemplateSpecName5": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId5')))]",
    "AutoTriageIncident": "AutoTriageIncident",
    "_AutoTriageIncident": "[variables('AutoTriageIncident')]",
    "playbookVersion6": "1.0",
    "playbookContentId6": "AutoTriageIncident",
    "_playbookContentId6": "[variables('playbookContentId6')]",
    "playbookId6": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId6'))]",
    "playbookTemplateSpecName6": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId6')))]",
    "CVEAutoWorkflow": "CVEAutoWorkflow",
    "_CVEAutoWorkflow": "[variables('CVEAutoWorkflow')]",
    "playbookVersion7": "1.0",
    "playbookContentId7": "CVEAutoWorkflow",
    "_playbookContentId7": "[variables('playbookContentId7')]",
    "playbookId7": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId7'))]",
    "playbookTemplateSpecName7": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId7')))]",
    "uiConfigId1": "IoT",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "IoT",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
    "dataConnectorVersion1": "1.0.0"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Workbook with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT workbook template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('workbookTemplateSpecName1'),'/',variables('workbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoTWorkbook Workbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "The OT Threat Monitoring with Defender for IoT Workbook features OT filtering for Security Alerts, Incidents, Vulnerabilities and Asset Inventory. The workbook features a dynamic assessment of the MITRE ATT&CK for ICS matrix across your environment to analyze and respond to OT-based threats. This workbook is designed to enable SecOps Analysts, Security Engineers, and MSSPs to gain situational awareness for IT/OT security posture."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"a4b4e975-fa7c-46a3-b669-850aacc88134\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"label\":\"üîé Getting Started\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\", \\\"selected\\\":true},\\r\\n    {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\"}\\r\\n]\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"AzureLighthouse\",\"label\":\"üî¶ Azure Lighthouse\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\", \\\"selected\\\":true},\\r\\n    {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\"}\\r\\n]\",\"value\":\"No\",\"id\":\"f298117c-71e2-4f0d-bdd0-a280ba262206\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"DefaultSubscription_Internal\",\"type\":1,\"isRequired\":true,\"query\":\"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| take 1\\r\\n| project subscriptionId\",\"crossComponentResources\":[\"value::selected\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"314d02bf-4691-43fa-af59-d67073c8b8fa\"},{\"id\":\"e6ded9a1-a83c-4762-938d-5bf8ff3d3d38\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"summarize by subscriptionId\\r\\n| project value = strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\",\"crossComponentResources\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"e3225ed0-6210-40a1-b2d0-66e42ffa71d6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| order by name asc\\r\\n| summarize Selected = makelist(id, 10), All = makelist(id, 1000)\\r\\n| mvexpand All limit 100\\r\\n| project value = tostring(All), label = tostring(All), selected = iff(Selected contains All, true, false)\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"value::all\"]},{\"id\":\"15b2c181-7397-43c1-900a-28e175ae8a6f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":1209600000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}}],\"style\":\"pills\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"Parameter Selectors\"},{\"type\":1,\"content\":{\"json\":\"<svg viewBox=\\\"0 0 19 19\\\" width=\\\"20\\\" class=\\\"fxt-escapeShadow\\\" role=\\\"presentation\\\" focusable=\\\"false\\\" xmlns:svg=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" aria-hidden=\\\"true\\\"><g><path fill=\\\"#1b93eb\\\" d=\\\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\\\"></path><path fill=\\\"url(#0024423711759027356)\\\" d=\\\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\\\"></path><path d=\\\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\\\" class=\\\"msportalfx-svg-c01\\\"></path></g></svg>&nbsp;<span style=\\\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\\\"> Please take time to answer a quick survey,\\r\\n</span>[<span style=\\\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\\\"> click here. </span>](https://forms.office.com/r/tqe4bXUEXS)\"},\"name\":\"Survey\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"managedservicesresources\\r\\n| where type == \\\"microsoft.managedservices/registrationassignments\\\"\\r\\n| where properties.provisioningState == \\\"Succeeded\\\"\\r\\n| extend ManageeTenantName = properties.registrationDefinition.properties.manageeTenantName\\r\\n| extend ManageeTenantId = properties.registrationDefinition.properties.manageeTenantId\\r\\n| extend ManagedByTenantName = properties.registrationDefinition.properties.managedByTenantName\\r\\n| extend ManagedByTenantId = properties.registrationDefinition.properties.managedByTenantId\\r\\n| extend PermanentAccess = properties.registrationDefinition.properties.authorizations\\r\\n| extend JITAccess = properties.registrationDefinition.properties.eligibleAuthorizations\\r\\n| extend AddedDate = properties.registrationDefinition.systemData.createdAt\\r\\n| extend CreatedBy = systemData.createdBy\\r\\n| project ManageeTenantName, ManageeTenantId, ManagedByTenantName, ManagedByTenantId, AddedDate, CreatedBy\",\"size\":4,\"showAnalytics\":true,\"title\":\"Azure Lighthouse Delegations\",\"noDataMessage\":\"No Azure Lighthouse Delegations/Customers Detected\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ManageeTenantName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Download\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"ManagedByTenantName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Upload\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AddedDate\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Clock\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"PermanentAccess\",\"formatter\":1},{\"columnMatch\":\"JITAccess\",\"formatter\":1}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"AzureLighthouse\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"query - 21 - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# [IoT/OT Threat Monitoring with Defender for IoT](https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/defending-critical-infrastructure-with-the-microsoft-sentinel-it/ba-p/3061184)\\n---\\n\\nWelcome to the IoT/OT Threat Monitoring with Defender for IoT Workbook. \\nThis workbook provides a guided investigation for entities based on open incidents, alerts sign-ins and activity for IT/OT assets. This workbook also provides hunting via MITRE ATT&CK¬Æ for ICS, and designed to enable SecOps Analysts, Security Engineers, and MSSPs to gain situational awareness for IT/OT security posture.\"},\"name\":\"Workbook Overview\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"nav\",\"links\":[{\"id\":\"25558b22-8903-4bd8-84a0-a13b1e78fa86\",\"cellValue\":\"https://ms.portal.azure.com/#blade/Microsoft_Azure_IoT_Defender/IoTDefenderDashboard/Getting_started\",\"linkTarget\":\"Url\",\"linkLabel\":\"Get Started with Microsoft Defender for IoT\",\"style\":\"link\"},{\"id\":\"1bad541e-219a-4277-9510-876b0e8cad51\",\"cellValue\":\"https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/defending-critical-infrastructure-with-the-microsoft-sentinel-it/ba-p/3061184\",\"linkTarget\":\"Url\",\"linkLabel\":\"Solution Blog\",\"style\":\"link\"},{\"id\":\"b9a6293e-1c7b-4ec2-ad2a-d72b5ee01722\",\"cellValue\":\"https://youtu.be/hZS2aplJoy8\",\"linkTarget\":\"Url\",\"linkLabel\":\"Video Demo\",\"style\":\"link\"},{\"id\":\"7e8ff8aa-f632-4a4d-90cf-a71da0dc6b31\",\"cellValue\":\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/IoTOTThreatMonitoringwithDefenderforIoT\",\"linkTarget\":\"Url\",\"linkLabel\":\"GitHub Repo\",\"style\":\"link\"}]},\"name\":\"links - 29\"}]},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"customWidth\":\"79\",\"name\":\"group - 10\"},{\"type\":1,\"content\":{\"json\":\"![Image Name](https://azure.microsoft.com/svghandler/azure-sentinel?width=600&height=300) \"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"customWidth\":\"20\",\"name\":\"Azure Defender for IoT Logo\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"1f801685-c900-4cf3-8d1b-7e5cfff7672d\",\"cellValue\":\"TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Overview\",\"subTarget\":\"overview\",\"style\":\"link\"},{\"id\":\"b837a8d0-17c3-4da1-a6f2-7662b00ffd06\",\"cellValue\":\"TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Device Inventory\",\"subTarget\":\"inventory\",\"style\":\"link\"},{\"id\":\"94d4ab9a-4ec7-4e4b-a69d-b6acb5cccd62\",\"cellValue\":\"TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Incidents\",\"subTarget\":\"incidents\",\"style\":\"link\"},{\"id\":\"18c690d7-7cbd-46c1-b677-1f72692d40cd\",\"cellValue\":\"TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Alerts\",\"subTarget\":\"alerts\",\"preText\":\"Alert rules\",\"style\":\"link\"},{\"id\":\"a514cac2-c3b0-43d9-8491-a89a0e9157d3\",\"cellValue\":\"TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"MITRE ATT&CK¬Æ for ICS\",\"subTarget\":\"mitre\",\"style\":\"link\"},{\"id\":\"3d0357c5-671a-49af-95a1-096c0e988e6e\",\"cellValue\":\"TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Vulnerabilities\",\"subTarget\":\"vulnerabilities\",\"style\":\"link\"}]},\"name\":\"Tabs link\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# [Alerts](https://docs.microsoft.com/azure/defender-for-iot/organizations/alert-engine-messages)\"},\"name\":\"text - 0\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"üü¶ Alerts Summary\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | where TimeFirstSeen {TimeRange}\\n    | where properties.status != \\\"Closed\\\"\\n    | where properties.severity == \\\"High\\\"\\n    | summarize AlertCount2=count() \",\"size\":4,\"title\":\"HIGH\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AlertCount2\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | where TimeFirstSeen {TimeRange}\\n    | where properties.status != \\\"Closed\\\"\\n    | where properties.severity == \\\"Medium\\\"\\n    | summarize AlertCount2=count() \",\"size\":4,\"title\":\"MEDIUM\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AlertCount2\",\"formatter\":12,\"formatOptions\":{\"max\":0,\"palette\":\"orange\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | where TimeFirstSeen {TimeRange}\\n    | where properties.status != \\\"Closed\\\"\\n    | where properties.severity == \\\"Low\\\"\\n    | summarize AlertCount2=count() \",\"size\":4,\"title\":\"LOW\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AlertCount2\",\"formatter\":12,\"formatOptions\":{\"max\":0,\"palette\":\"yellow\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | where TimeFirstSeen >= ago(1d)\\n    | where properties.status != \\\"Closed\\\"\\n    | summarize AlertCount2=count() \",\"size\":4,\"title\":\"NEW TODAY\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AlertCount2\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | where TimeFirstSeen {TimeRange}\\n    | where properties.status != \\\"Closed\\\"\\n    | where properties.severity == \\\"High\\\"\\n    | summarize AlertCount2=count() by tostring(properties.displayName)\\n    | sort by AlertCount2\\n    | take 250\",\"size\":0,\"showAnalytics\":true,\"title\":\"TOP HIGH SEVERITY ALERTS\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"properties_displayName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Fired\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Count\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"AlertName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Fired\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"AlertLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Alert >\"}},{\"columnMatch\":\"RecommendationName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"warning\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Recommendation\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Recommendation >\"}},{\"columnMatch\":\"RecommendationClick\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to Recommendation\"}},{\"columnMatch\":\"RecommendationLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Recommendation >\"}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"properties_displayName\",\"label\":\"Alert Name\",\"comment\":\"\"},{\"columnId\":\"AlertCount2\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Security Alerts over Time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | where TimeFirstSeen {TimeRange}\\n    | summarize AlertCount=count() by bin(todatetime(TimeFirstSeen), 1d), tostring(properties.severity)\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"TRENDING\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"timechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Fired\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Count\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"AlertLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Alert >\"}},{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"RecommendationName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"warning\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Recommendation\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Recommendation >\"}},{\"columnMatch\":\"RecommendationClick\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to Recommendation\"}},{\"columnMatch\":\"RecommendationLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Recommendation >\"}}]},\"chartSettings\":{\"xAxis\":\"TimeFirstSeen\",\"yAxis\":[\"AlertCount\"],\"group\":\"properties_severity\",\"createOtherGroup\":0,\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"<empty>\",\"label\":\"Alert Count\"}]}},\"name\":\"query - 6\"}]},\"name\":\"üü¶ Alerts Summary\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"üü¶ Location\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | where TimeFirstSeen {TimeRange}\\n    | mv-expand deviceEntities=properties.entities\\n    | extend AlertDeviceName = tostring(deviceEntities.DeviceName)\\n    | extend AlertID=tostring(properties.systemAlertId)\\n    | join kind=leftouter (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/devices' \\n         | where isnotnull(properties.sensor.site)\\n         | extend Site=tostring(properties.sensor.site)\\n         | extend DeviceName = tostring(properties.deviceName)\\n         | project Site, DeviceName) on $left.AlertDeviceName == $right.DeviceName\\n    | where DeviceName != \\\"\\\"\\n    | summarize AlertCount=dcount(AlertID) by Site\\n    | take 20\\n\\n\",\"size\":3,\"title\":\"Alerts by Site\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | where TimeFirstSeen {TimeRange}\\n    | mv-expand deviceEntities=properties.entities\\n    | extend AlertDeviceName = tostring(deviceEntities.DeviceName)\\n    | extend AlertID=tostring(properties.systemAlertId)\\n    | join kind=leftouter (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/devices' \\n         | where isnotnull(properties.sensor.zone)\\n         | extend Zone=tostring(properties.sensor.zone)\\n         | extend DeviceName = tostring(properties.deviceName)\\n         | project Zone, DeviceName) on $left.AlertDeviceName == $right.DeviceName\\n    | where DeviceName != \\\"\\\"\\n    | summarize AlertCount=dcount(AlertID) by Zone\\n    | take 20\\n\\n\",\"size\":3,\"title\":\"Alerts by Zone\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"query - 0 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n| where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n| extend TimeFirstSeen=properties.startTimeUtc\\n| where TimeFirstSeen {TimeRange}\\n| extend SensorId_ = tostring(properties.extendedProperties.SensorId)\\n| where isnotempty(SensorId_)\\n| summarize count() by SensorId_\\n| sort by count_ desc\",\"size\":3,\"showAnalytics\":true,\"title\":\"Alerts by Sensor\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"SensorId_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"ShowItems\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"Address_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Vendor_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"PowerUp\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"DeviceType_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"2\",\"text\":\"{0}{1}\"}]}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"SensorId_\",\"label\":\"Sensor\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"33\",\"name\":\"query - 7 - Copy - Copy - Copy\"}]},\"name\":\"üü¶ Alerts Summary - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"üü¶ Alert Count\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | where TimeFirstSeen {TimeRange}\\n    | summarize kwSum=count() by tostring(properties.productComponentName)\\n    | sort by kwSum\\n\",\"size\":1,\"showAnalytics\":true,\"title\":\"‚¨áÔ∏è SELECTOR\",\"exportMultipleValues\":true,\"exportedParameters\":[{\"parameterName\":\"_sensorengine\",\"parameterType\":1},{\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"kwSum\",\"formatter\":3,\"formatOptions\":{\"palette\":\"coldHot\",\"compositeBarSettings\":{\"labelText\":\"\",\"columnSettings\":[{\"columnName\":\"kwSum\",\"color\":\"blue\"}]}}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15%\"}},{\"columnMatch\":\"s_engine\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}}],\"labelSettings\":[{\"columnId\":\"properties_productComponentName\",\"label\":\"Alert Engine\"},{\"columnId\":\"kwSum\",\"label\":\"Total Alerts\"}]},\"tileSettings\":{\"subtitleContent\":{\"columnMatch\":\"ProductComponentName\"},\"secondaryContent\":{\"columnMatch\":\"kwSum\"},\"showBorder\":false},\"graphSettings\":{\"type\":2,\"topContent\":{\"columnMatch\":\"ProductComponentName\"},\"centerContent\":{\"columnMatch\":\"kwSum\"},\"nodeIdField\":\"kwSum\",\"graphOrientation\":3,\"showOrientationToggles\":false,\"staticNodeSize\":100,\"colorSettings\":{\"nodeColorField\":\"kwSum\",\"type\":4,\"heatmapPalette\":\"greenRed\",\"emptyValueColor\":\"gray\"},\"hivesMargin\":5},\"chartSettings\":{\"yAxis\":[\"kwSum\"],\"showMetrics\":false,\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"Critical\",\"color\":\"red\"},{\"seriesName\":\"Major\",\"color\":\"orange\"},{\"seriesName\":\"Warning\",\"color\":\"green\"}]}},\"customWidth\":\"30\",\"name\":\"setEngine\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | extend AlertSeverity=tostring(properties.severity)\\n    | extend Status=tostring(properties.status)\\n    | extend Engine=tostring(properties.productComponentName)\\n    | where TimeFirstSeen {TimeRange}\\n    | where tostring('{_sensorengine}') has Engine or isempty(dynamic('{_sensorengine}'))\\n    | summarize kwSum=count() by AlertSeverity\\n    | sort by AlertSeverity asc\\n\",\"size\":1,\"showAnalytics\":true,\"title\":\"SEVERITY\",\"exportMultipleValues\":true,\"exportedParameters\":[{\"parameterName\":\"p_engine\",\"parameterType\":1},{\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15%\"}},{\"columnMatch\":\"s_engine\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}}],\"filter\":true},\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"chartSettings\":{\"yAxis\":[\"kwSum\"],\"showMetrics\":false,\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"High\",\"color\":\"red\"},{\"seriesName\":\"Low\",\"color\":\"green\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"}]}},\"customWidth\":\"20\",\"name\":\"Severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n    | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n    | extend TimeFirstSeen=properties.startTimeUtc\\n    | extend AlertSeverity=tostring(properties.severity)\\n    | extend Engine=tostring(properties.productComponentName)\\n    | where TimeFirstSeen {TimeRange}\\n    | where tostring('{_sensorengine}') has Engine or isempty(dynamic('{_sensorengine}'))\\n    | where tostring('{p_engine}') has AlertSeverity or isempty('{p_engine}')\\n    | summarize event_count=count() by bin(todatetime(TimeFirstSeen), 1d)\\n\",\"size\":1,\"showAnalytics\":true,\"title\":\"TRENDING\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"timechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"kwSum\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blue\",\"compositeBarSettings\":{\"labelText\":\"\"}}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15%\"}},{\"columnMatch\":\"s_engine\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}}]},\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"chartSettings\":{\"xAxis\":\"TimeFirstSeen\",\"yAxis\":[\"event_count\"],\"group\":\"event_count\",\"seriesLabelSettings\":[{\"seriesName\":\"<empty>\",\"label\":\"Alert Count\"}],\"showDataPoints\":true,\"xSettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"50\",\"name\":\"setEngine\",\"styleSettings\":{\"maxWidth\":\"40\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n| where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n| extend TimeFirstSeen=properties.startTimeUtc\\n| where TimeFirstSeen {TimeRange}\\n| mv-expand deviceEntities=properties.entities\\n| extend deviceType = tostring(deviceEntities.DeviceType)\\n| where isnotempty(deviceType)\\n| where deviceType != \\\"Unclassified\\\"\\n| summarize count() by deviceType\\n| sort by count_ desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"DEVICE_TYPE\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"deviceType\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"ResourceFlat\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"DeviceType_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"2\",\"text\":\"{0}{1}\"}]}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"deviceType\",\"label\":\"Device Type\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"33\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n| where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n| extend TimeFirstSeen=properties.startTimeUtc\\n| where TimeFirstSeen {TimeRange}\\n| mv-expand deviceEntities=properties.entities\\n| extend deviceVendor = tostring(deviceEntities.Vendor)\\n| where isnotempty(deviceVendor)\\n| summarize count() by deviceVendor\\n| sort by count_ desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"VENDOR\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"deviceVendor\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"PowerUp\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"deviceVendor\",\"label\":\"Device Vendor\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"33\",\"name\":\"query - 7 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n| where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n| extend TimeFirstSeen=properties.startTimeUtc\\n| where TimeFirstSeen {TimeRange}\\n| mv-expand deviceEntities=properties.entities\\n| extend deviceName = tostring(deviceEntities.DeviceName)\\n| extend deviceLink = tostring(deviceEntities.DevicePageLink)\\n| where isnotempty(deviceName)\\n| summarize count() by deviceName, deviceLink\\n| sort by count_ desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Affected Devices\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"deviceName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"deviceLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\">> Link\",\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"Address_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Vendor_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"PowerUp\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"DeviceType_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"2\",\"text\":\"{0}{1}\"}]}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"deviceName\",\"label\":\"Device Name\"},{\"columnId\":\"deviceLink\",\"label\":\"Deivce Page Link\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"33\",\"name\":\"query - 7\"}]},\"name\":\"üü¶ Alerts Count\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources \\n| where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n| extend TimeFirstSeen=properties.startTimeUtc\\n| where TimeFirstSeen {TimeRange}\\n| extend AlertName = tostring(properties.displayName)\\n| extend AlertSeverity = tostring(properties.severity)\\n| extend Status = tostring(properties.status)\\n| extend Tactics = tostring(properties.intent)\\n| extend data = split(id, '/')\\n| extend type = tostring(properties.alertType)\\n| extend StringforBase64function = strcat('{\\\"alertType\\\":\\\"', type, '\\\",\\\"location\\\":\\\"', data[6], '\\\",\\\"deviceGroupName\\\":\\\"', data[8], '\\\",\\\"alertId\\\":\\\"', data[10], '\\\",\\\"subscriptionId\\\":\\\"', data[2], '\\\"}')\\n| extend alertlink = base64_encode_tostring(StringforBase64function)\\n| extend SeverityRank = iff(AlertSeverity == \\\"High\\\", 3, iff(AlertSeverity == \\\"Medium\\\", 2, iff(AlertSeverity == \\\"Low\\\", 1, iff(AlertSeverity == \\\"Informational\\\", 0, 0))))\\n| sort by SeverityRank, todatetime(TimeFirstSeen) \\n| project TimeFirstSeen,  AlertName,  AlertSeverity, Tactics, Status, AlertLink=strcat(\\\"https://portal.azure.com/#view/Microsoft_Azure_IoT_Defender/IAlertBlade/data/\\\",alertlink)\\n| take 50\",\"size\":0,\"showAnalytics\":true,\"title\":\"üü¶ Recent Security Alerts\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeFirstSeen\",\"formatter\":6,\"dateFormat\":{\"formatName\":\"shortDateTimePattern\"}},{\"columnMatch\":\"AlertName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"2\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"Sev0\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"Sev1\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"Sev2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"Sev3\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"ProductName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"uninitialized\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AlertLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Alert >>\"}},{\"columnMatch\":\"UPN\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"2\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Incident >\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\"}},{\"columnMatch\":\"city_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"state_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"blueDark\",\"text\":\"{0}{1}\"}]}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeFirstSeen\",\"label\":\"Time First Seen\"},{\"columnId\":\"AlertName\",\"label\":\"Alert Name\"},{\"columnId\":\"AlertSeverity\",\"label\":\"Alert Severity\"}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SigninStatus\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"green\"}},\"showBorder\":false},\"mapSettings\":{\"locInfo\":\"CountryRegion\",\"locInfoColumn\":\"Location\",\"latitude\":\"SourceIPLocation\",\"longitude\":\"SourceIPLocation\",\"sizeSettings\":\"Location\",\"sizeAggregation\":\"Count\",\"legendMetric\":\"Location\",\"legendAggregation\":\"Count\",\"itemColorSettings\":{\"nodeColorField\":\"Location\",\"colorAggregation\":\"Count\",\"type\":\"thresholds\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"blueDark\"}]}}},\"name\":\"üü¶ Security Alerts: Go To >\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"OT Alerts\"}]},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"alerts\"},\"name\":\"Alerts\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# [Incidents](https://docs.microsoft.com/azure/sentinel/investigate-cases)\"},\"name\":\"text - 0\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"üü¶ Incidents Summary\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated {TimeRange}\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| where Severity == \\\"High\\\" and Status != \\\"Closed\\\"\\n| summarize kwSum=dcount(ProviderIncidentId)\\n\\n\\n\\n\\n\",\"size\":4,\"title\":\"HIGH\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"hotCold\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| where Status == \\\"Active\\\"\\n| summarize kwSum=dcount(ProviderIncidentId)\\n\\n\\n\\n\\n\",\"size\":4,\"title\":\"ACTIVE\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"min\":0,\"max\":1,\"palette\":\"orange\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| where Status == \\\"Closed\\\"\\n| summarize kwSum=dcount(ProviderIncidentId)\\n\\n\\n\\n\",\"size\":4,\"title\":\"CLOSED\",\"noDataMessage\":\"No unauthorized devices making config changes\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| where TimeGenerated > ago(1d)\\n| summarize kwSum=dcount(ProviderIncidentId)\\n\\n\\n\\n\",\"size\":4,\"title\":\"NEW TODAY\",\"noDataMessage\":\"No unauthorized devices making config changes\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\r\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\r\\n| where Severity == \\\"High\\\"\\r\\n| summarize count() by Title\\r\\n| sort by count_ desc\\r\\n| limit 250\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"TOP HIGH SEVERITY INCIDENTS\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"AlertName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Fired\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Count\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"AlertLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Alert >\"}},{\"columnMatch\":\"RecommendationName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"warning\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Recommendation\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Recommendation >\"}},{\"columnMatch\":\"RecommendationClick\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to Recommendation\"}},{\"columnMatch\":\"RecommendationLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Recommendation >\"}}],\"filter\":true}},\"customWidth\":\"50\",\"name\":\"Security Alerts over Time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\r\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\r\\n| where Severity == \\\"High\\\"\\r\\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Title\\r\\n| render timechart\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"HIGH SEVERITY TRENDING\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Fired\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Count\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"AlertLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Alert >\"}},{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"RecommendationName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"warning\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Recommendation\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Recommendation >\"}},{\"columnMatch\":\"RecommendationClick\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Click to Recommendation\"}},{\"columnMatch\":\"RecommendationLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Go to Recommendation >\"}}]}},\"name\":\"Security Alerts over Time - Copy\"}]},\"name\":\"group - 3 - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"üü¶ Location\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| extend SystemAlertId = tostring(AlertIds[0])\\n| join (SecurityAlert) on SystemAlertId\\n| mv-expand deviceEntities=parse_json(Entities)\\n| extend deviceSite = tostring(deviceEntities.Site)\\n| where isnotempty(deviceSite) \\n| summarize AlertCount=dcount(ProviderIncidentId) by deviceSite \\n| sort by AlertCount desc\",\"size\":3,\"showAnalytics\":true,\"title\":\"SITE\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Informational\",\"color\":\"blue\"}]}},\"customWidth\":\"33\",\"name\":\"query - 3 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| extend SystemAlertId = tostring(AlertIds[0])\\n| join (SecurityAlert) on SystemAlertId\\n| mv-expand deviceEntities=parse_json(Entities)\\n| extend deviceZone = tostring(deviceEntities.Zone)\\n| where isnotempty(deviceZone) \\n| summarize AlertCount=dcount(ProviderIncidentId) by deviceZone\\n| sort by AlertCount\\n| limit 20 \",\"size\":3,\"showAnalytics\":true,\"title\":\"ZONE\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Informational\",\"color\":\"blue\"}]}},\"customWidth\":\"33\",\"name\":\"query - 3 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| extend SystemAlertId = tostring(AlertIds[0])\\n| join (SecurityAlert) on SystemAlertId\\n| extend sensorID = tostring(parse_json(ExtendedProperties).SensorId)\\n| where isnotempty(sensorID) \\n| summarize count() by sensorID\\n| sort by count_ desc\\n| limit 20 \",\"size\":3,\"showAnalytics\":true,\"title\":\"SENSOR\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"sensorID\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"ShowItems\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"sensorID\",\"label\":\"Sensor ID\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Informational\",\"color\":\"blue\"}]}},\"customWidth\":\"33\",\"name\":\"query - 3 - Copy\"}]},\"name\":\"site/zone/sensor\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"üü¶ Efficiency\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| summarize dcount(ProviderIncidentId) by Severity\\n| render piechart\\n\\n\\n\",\"size\":3,\"showAnalytics\":true,\"title\":\"SEVERITY\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Informational\",\"color\":\"blue\"}]}},\"customWidth\":\"25\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\r\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\r\\n| where Status == 'Closed'\\r\\n| extend feedback =strcat(Classification,\\\" \\\",ClassificationReason)\\r\\n| summarize dcount(IncidentNumber) by feedback\\r\\n\",\"size\":3,\"showAnalytics\":true,\"title\":\"CLOSE CODES\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Informational\",\"color\":\"blue\"}]}},\"customWidth\":\"25\",\"name\":\"query - 6\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \\n| extend TimeToTriage =  (FirstModifiedTime - CreatedTime)/1h\\n| summarize 50th_Percentile=percentile(TimeToTriage, 50) \\n\",\"size\":1,\"showAnalytics\":true,\"title\":\"MEAN TIME TO RESPOND\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"50th_Percentile\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"50\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize arg_max(TimeGenerated,*) by IncidentNumber \\n| extend TimeToResolve =  (ClosedTime - CreatedTime)/1d\\n| summarize 50th_Percentile=percentile(TimeToResolve, 50)\",\"size\":1,\"showAnalytics\":true,\"title\":\"MEAN TIME TO RESOLVE\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Classification\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"50th_Percentile\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":26,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"50\",\"name\":\"query - 2\"}]},\"customWidth\":\"50\",\"name\":\"Mean times \"}]},\"name\":\"group - 3\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"üü¶ Incidents\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| extend SystemAlertId = tostring(AlertIds[0])\\n| join (SecurityAlert) on SystemAlertId\\n| extend IPAddress = tostring(parse_json(tostring(parse_json(Entities)[0].IpAddress)).Address)\\n| where CompromisedEntity <> \\\"\\\"\\n| summarize count() by CompromisedEntity\\n| where CompromisedEntity has \\\".\\\"\\n| sort by count_ desc\\n| limit 250 \\n\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"IP ADDRESS\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Informational\",\"color\":\"blue\"}]}},\"customWidth\":\"25\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| extend SystemAlertId = tostring(AlertIds[0])\\n| join (SecurityAlert) on SystemAlertId\\n| extend Protocol = tostring(parse_json(ExtendedProperties).Protocol)\\n| where Protocol != \\\"\\\"\\n| summarize count() by Protocol\\n| sort by count_ desc\\n| limit 250\",\"size\":0,\"showAnalytics\":true,\"title\":\"PROTOCOL\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Informational\",\"color\":\"blue\"}]}},\"customWidth\":\"25\",\"name\":\"query - 7 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| extend SystemAlertId = tostring(AlertIds[0])\\n| join (SecurityAlert) on SystemAlertId\\n| mv-expand deviceEntities=parse_json(Entities)\\n| extend deviceType = tostring(deviceEntities.DeviceType)\\n| where isnotempty(deviceType) and deviceType!=\\\"Unclassified\\\"\\n| summarize count() by deviceType\\n| sort by count_ desc\\n| limit 20 \",\"size\":0,\"showAnalytics\":true,\"title\":\"DEVICE TYPE\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Informational\",\"color\":\"blue\"}]}},\"customWidth\":\"25\",\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| extend SystemAlertId = tostring(AlertIds[0])\\n| join (SecurityAlert) on SystemAlertId\\n| mv-expand deviceEntities=parse_json(Entities)\\n| extend Vendor = tostring(deviceEntities.Vendor)\\n| where Vendor <> \\\"\\\"\\n| summarize count() by Vendor\\n| sort by count_ desc\\n| limit 250 \",\"size\":0,\"showAnalytics\":true,\"title\":\"VENDOR\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"yellowOrangeRed\"}},{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"kwSum\",\"formatter\":12,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"size\":\"auto\"},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Informational\",\"color\":\"blue\"}]}},\"customWidth\":\"25\",\"name\":\"query - 3 - Copy\"}]},\"name\":\"group - 4\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"üü¶ Security Incidents: Go To >\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\r\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\r\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\r\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\r\\n| parse IncidentUrl with * '/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\\r\\n| extend SeverityRank=iff(Severity == \\\"High\\\", 3, iff(Severity == \\\"Medium\\\", 2, iff(Severity == \\\"Low\\\", 1, iff(Severity == \\\"Informational\\\", 0, 0))))\\r\\n| sort by SeverityRank, TimeGenerated desc\\r\\n| project ['Incident Name']=Title, IncidentNumber, Severity, IncidentUrl, ProductName, FirstActivityTime, IncidentBlade\\r\\n| limit 250\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No Incidents Observed Within These Thresholds\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Incident Name\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Alert\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"Sev0\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"Sev1\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"Sev2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"Sev3\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"OpenBlade\",\"linkLabel\":\"Incident >>\",\"bladeOpenContext\":{\"bladeName\":\"CaseBlade\",\"extensionName\":\"Microsoft_Azure_Security_Insights\",\"bladeParameters\":[{\"name\":\"id\",\"source\":\"column\",\"value\":\"IncidentBlade\"}]}}},{\"columnMatch\":\"ProductName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Execution\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"IncidentBlade\",\"formatter\":5}],\"filter\":true}},\"name\":\"query - 3\"}]},\"name\":\"group - 2\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"OT Incidents\"}]},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"incidents\"},\"name\":\"Incidents\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## üí° [MITRE ATT&CK¬Æ for ICS](https://collaborate.mitre.org/attackics/index.php/Main_Page)\\r\\n----------------------------------------------------------------------------------------------------\"},\"name\":\"text - 77\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where Tactics contains \\\"Initial\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Initial_Access\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Initial Access\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 79\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where Tactics contains \\\"Execution\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Execution\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Execution\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 79\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where Tactics contains \\\"Persistence\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Persistence\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Persistence\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 79\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where Tactics contains \\\"Privilege\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Privilege_Escalation\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Privilege Escalation\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 79\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where Tactics contains \\\"Evasion\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Evasion\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Evasion\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 79\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where Tactics contains \\\"Discovery\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Discovery\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Discovery\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 79\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where Tactics contains \\\"Lateral\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Lateral_Movement\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Lateral Movement\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 79\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where Tactics contains \\\"Collection\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Collection\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Collection\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 79 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where Tactics contains \\\"Command\\\" or Tactics contains \\\"Function\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Command_and_Control\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"C2 & IRF\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 79 - Copy - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend Tactics = tostring(parse_json(tostring(AdditionalData.tactics)))\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where Tactics contains \\\"Impact\\\" or Tactics contains \\\"Process\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Impact\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"IPC & Impact\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 79 - Copy - Copy - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"## üí° [Techniques](https://collaborate.mitre.org/attackics/index.php/Main_Page)\\r\\n----------------------------------------------------------------------------------------------------\"},\"name\":\"text - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0817\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0817\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Drive-by Compromise\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0858\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0858\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Change Operating Mode\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0889\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0889\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Modify Program\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0874\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0874\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Hooking\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0858\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0858\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Change Operating Mode\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0842\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0842\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Network Sniffing\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0874T0812\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0812\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Default Credentials\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0811\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0811\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Data from Information Repositories\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0885\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0885\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Commonly Used Port\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0806\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0806\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Brute Force I/O\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0866\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0866\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Exploitation of Remote Services\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0807\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0807\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Command-Line Interface\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0839\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0839\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Module Firmware\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"10\",\"name\":\"text - 28\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0849\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0849\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Masquerading\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0846\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0846\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Remote System Discovery\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0866\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0866\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Exploitation of Remote Services\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0801\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0801\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Monitor Process State\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0884\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0884\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Connection Proxy\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0836\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0836\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Modify Parameter\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0822\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0822\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"External Remote Services\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0871\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0871\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Execution through API\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0857\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0857\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"System Firmware\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"10\",\"name\":\"text - 42\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0851\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0851\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Rootkit\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"10\",\"name\":\"text - 42 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0867\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0867\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Lateral Tool Transfer\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0861\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0861\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Point & Tag Identification\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0869\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0869\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Standard Application Layer Protocol\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0839\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0839\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Module Firmware\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0883\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0883\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Internet Accessible Device\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0874\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0874\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Hooking\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0859\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0859\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Valid Accounts\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"30\",\"name\":\"text - 93\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0843\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0843\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Program Download\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0845\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0845\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Program Upload\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0803\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0803\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Block Command Message\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0855\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0855\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Unauthorized Command Message\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0886\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0886\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Remote Services\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0821\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0821\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Modify Controller Tasking\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"40\",\"name\":\"text - 70\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0886\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0886\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Remote Services\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"10\",\"name\":\"text - 71\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0809\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0809\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Data Destruction\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0826\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0826\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Loss of Availability\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0847\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0847\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Replication Through Removable Media\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0863\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0863\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"User Execution\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"40\",\"name\":\"text - 72\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0859\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0859\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Valid Accounts\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"10\",\"name\":\"text - 74\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0814\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0814\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Denial of Service\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0828\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0828\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Loss of Productivity and Revenue\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0848\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0848\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Rogue Master\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"70\",\"name\":\"text - 75\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0816\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0816\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Device Restart/Shutdown\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0831\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0831\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Manipulation of Control\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0865\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0865\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Spearphishing Attachment\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"70\",\"name\":\"text - 76\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0838\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0838\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Modify Alarm Settings\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0882\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0882\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Theft of Operational Information\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"80\",\"name\":\"text - 78\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0881\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0881\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Service Stop\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"10\",\"name\":\"text - 79\"},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"80\",\"name\":\"text - 80\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| where AdditionalData contains \\\"T0857\\\"\\n| summarize count()\\n| extend Link = strcat(\\\"https://collaborate.mitre.org/attackics/index.php/Technique/T0857\\\")\\n\\n\\n\",\"size\":4,\"showAnalytics\":true,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"60%\"}},{\"columnMatch\":\"name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"critical\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Major\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"5\"}},{\"columnMatch\":\"message\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"70%\"}}]},\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"System Firmware\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 78\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"10\",\"name\":\"text - 81\"}]},\"name\":\"ICS Matrix Chart\"}]},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"mitre\"},\"name\":\"MITRE ATT&CK¬Æ for ICS\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Vulnerabilities\"},\"name\":\"text - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"da5915bc-62e7-4cb5-9178-66868f38367d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SiteName\",\"label\":\"Site\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n| extend Site=properties.sensor.site\\n| where Site != \\\"\\\"\\n| summarize by tostring(Site)\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"ec6ab0e8-d7b7-4398-ab08-25257aa4c968\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SeverityName\",\"label\":\"Severity\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend Severity=properties.severityScore\\n| summarize by tostring(Severity)\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"pills\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend DeviceID = tostring(properties.deviceId)\\n\\n| extend severity=properties['severityScore']\\n| extend Severity=properties.severityScore\\n| where Severity in ({SeverityName})\\n| join  kind=leftouter (iotsecurityresources\\n         | where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n         | project DeviceSiteName=tostring(properties.sensor.site), name) on $left.DeviceID == $right.name\\n| where DeviceSiteName in ({SiteName})\\n| summarize count() by tostring(severity )\\n\",\"size\":3,\"title\":\"CVE by Severity\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vendor\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"Critical\",\"color\":\"red\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"}]}},\"customWidth\":\"33\",\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n    | extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n    | project deviceId\\n    | join¬†¬†kind=leftouter (iotsecurityresources\\n    ¬†¬†¬†¬†¬†¬†¬†¬†¬†| where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n    ¬†¬†¬†¬†¬†¬†¬†¬†¬†| project Site=tostring(properties.sensor.site), name) on $left.deviceId == $right.name\\n    | where Site in ({SiteName})\\n    | summarize count() by Site\\n    | project site = iff(Site==\\\"\\\", \\\"Managed IoT Hub\\\", Site), count_\\n\",\"size\":3,\"title\":\"CVE by Site\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend DeviceID = tostring(properties.deviceId)\\n| extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n| mv-expand components=properties['affectedComponents'] \\n| extend vendor=components['vendor'],\\n    version=components['version'],\\n    type=components['type'],\\n    product=components['product']\\n| extend Severity=properties.severityScore\\n| where Severity in ({SeverityName})\\n| join  kind=leftouter (iotsecurityresources\\n         | where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n         | project DeviceSiteName=tostring(properties.sensor.site), name) on $left.DeviceID == $right.name\\n| where DeviceSiteName in ({SiteName})\\n| summarize count() by tostring(cveName), tostring(vendor) \\n| summarize count() by tostring(vendor) \\n| where vendor != '*'\",\"size\":3,\"title\":\"CVE by Vendor\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vendor\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2}},\"customWidth\":\"33\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend DeviceID = tostring(properties.deviceId)\\n| extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n| extend Severity=properties.severityScore\\n| where Severity in ({SeverityName})\\n| join  kind=leftouter (iotsecurityresources\\n         | where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n         | project DeviceSiteName=tostring(properties.sensor.site), name) on $left.DeviceID == $right.name\\n| where DeviceSiteName in ({SiteName})\\n| summarize count() by tostring(cveName), tostring(cveDes), tostring(severity), tostring(score)\\n| sort by count_\\n| project cveName, cveDes, severity, score, count_\",\"size\":0,\"showAnalytics\":true,\"title\":\"CVEs\",\"exportFieldName\":\"cveName\",\"exportParameterName\":\"pCveName\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"cveDes\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40ch\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"redDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"score\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"11ch\"}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"18ch\"}}],\"rowLimit\":10000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"cveName\",\"label\":\"CVE Name\"},{\"columnId\":\"cveDes\",\"label\":\"CVE Description\"},{\"columnId\":\"severity\",\"label\":\"Severity\"},{\"columnId\":\"score\",\"label\":\"Score\"},{\"columnId\":\"count_\",\"label\":\"Devices Count\"}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}],\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"cveName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"cveName\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"count_\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"count_\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"name\":\"query - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n| where severity in ({SeverityName})\\n| where cveName == \\\"{pCveName}\\\"\\n| join¬†¬†kind=leftouter (iotsecurityresources\\n¬†¬†¬†¬†¬†¬†¬†¬†¬†| where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n¬†¬†¬†¬†¬†¬†¬†¬†¬†| project Site=tostring(properties.sensor.site), name, criticality=properties.criticality, deviceName=properties.deviceName) on $left.deviceId == $right.name\\n| extend site = iff(Site==\\\"\\\", \\\"Managed IoT Hub\\\", Site)\\n| where site in ({SiteName})\\n| project deviceId,  tostring(deviceName), site\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Selected CVE - Affected Devices\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"redDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000,\"filter\":true},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"cveName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"cveName\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"count_\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"count_\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"name\":\"query - 11 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend DeviceID = tostring(properties.deviceId)\\n| extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n| extend Severity=properties.severityScore\\n| where Severity in ({SeverityName})\\n| join  kind=leftouter (iotsecurityresources\\n         | where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n         | extend DeviceName = tostring(properties.deviceName)\\n         | project DeviceSiteName=tostring(properties.sensor.site), name, DeviceName) on $left.DeviceID == $right.name\\n| join kind=leftouter\\n    (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n         | where properties.status != \\\"Closed\\\"\\n         | extend name3= tostring(properties.extendedProperties.SourceDeviceAddress)\\n         | summarize AlertCount=count() by name3) on $left.DeviceName == $right.name3 \\n| join kind=leftouter\\n    (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n         | where properties.status != \\\"Closed\\\"\\n         | where tostring(properties.extendedProperties.DestinationDeviceAddress)!=tostring(properties.extendedProperties.SourceDeviceAddress)\\n         | summarize AlertCount2=count() by name4=tostring(properties.extendedProperties.DestinationDeviceAddress)) on $left.DeviceName == $right.name4 \\n| where DeviceSiteName in ({SiteName})\\n| summarize Total = count(), Critical = countif(tostring(severity) == \\\"Critical\\\"), High = countif(tostring(severity) == \\\"High\\\"), Medium = countif(tostring(severity) == \\\"Medium\\\"), Low = countif(tostring(severity) == \\\"Low\\\") by deviceId, DeviceName, DeviceSiteName, AlertCountSum=coalesce(AlertCount,0)+coalesce(AlertCount2,0)\\n| sort by Total\",\"size\":0,\"showAnalytics\":true,\"title\":\"Vulnerable Devices\",\"exportFieldName\":\"deviceId\",\"exportParameterName\":\"pDeviceId\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"17ch\"}},{\"columnMatch\":\"DeviceSiteName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"10ch\"}},{\"columnMatch\":\"AlertCountSum\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"16ch\"}},{\"columnMatch\":\"Total\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"14ch\"}},{\"columnMatch\":\"Critical\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redDark\"}},{\"columnMatch\":\"High\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"Medium\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}},{\"columnMatch\":\"Low\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellow\"}}],\"rowLimit\":10000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"Total\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"deviceId\",\"label\":\"Device ID\"},{\"columnId\":\"DeviceName\",\"label\":\"Device Name\"},{\"columnId\":\"DeviceSiteName\",\"label\":\"Site\"},{\"columnId\":\"AlertCountSum\",\"label\":\"Open Alerts\"},{\"columnId\":\"Total\",\"label\":\"Total CVEs\"},{\"columnId\":\"Critical\",\"label\":\"Critical\"},{\"columnId\":\"High\",\"label\":\"High\"},{\"columnId\":\"Medium\",\"label\":\"Medium\"},{\"columnId\":\"Low\",\"label\":\"Low\"}]},\"sortBy\":[{\"itemKey\":\"Total\",\"sortOrder\":2}],\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"tenantId\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"query - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n| where severity in ({SeverityName})\\n| where deviceId == \\\"{pDeviceId}\\\"\\n| join¬†¬†kind=leftouter (iotsecurityresources\\n¬†¬†¬†¬†¬†¬†¬†¬†¬†| where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n¬†¬†¬†¬†¬†¬†¬†¬†¬†| project Site=tostring(properties.sensor.site), name, criticality=properties.criticality, deviceName=properties.deviceName) on $left.deviceId == $right.name\\n| extend site = iff(Site==\\\"\\\", \\\"Managed IoT Hub\\\", Site)\\n| where site in ({SiteName})\\n| project tostring(cveName), tostring(severity),tostring(score), tostring(cveDes)\\n| order by score\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Selected Device - Related CVEs\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"redDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"DeviceName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"17ch\"}},{\"columnMatch\":\"DeviceSiteName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"10ch\"}},{\"columnMatch\":\"AlertCountSum\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"16ch\"}},{\"columnMatch\":\"Total\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"14ch\"}},{\"columnMatch\":\"Critical\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redDark\"}},{\"columnMatch\":\"High\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"Medium\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}},{\"columnMatch\":\"Low\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellow\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"cveName\",\"label\":\"CVE Name\"},{\"columnId\":\"severity\",\"label\":\"Severity\"},{\"columnId\":\"score\",\"label\":\"Score\"},{\"columnId\":\"cveDes\",\"label\":\"CVE Description\"}]},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"tenantId\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"query - 13 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend DeviceID = tostring(properties.deviceId)\\n| extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n| mv-expand components=properties['affectedComponents'] \\n| extend vendor=components['vendor'],\\n    version=components['version'],\\n    type=components['type'],\\n    product=components['product']\\n| extend Severity=properties.severityScore\\n| where Severity in ({SeverityName})\\n| join  kind=leftouter (iotsecurityresources\\n         | where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n         | project DeviceSiteName=tostring(properties.sensor.site), name) on $left.DeviceID == $right.name\\n| where DeviceSiteName in ({SiteName})\\n| summarize by tostring(cveName), tostring(vendor), tostring(version),tostring(type), tostring(product), tostring(severity)\\n|summarize  Total = count(), Critical = countif(tostring(severity) == \\\"Critical\\\"), High = countif(tostring(severity) == \\\"High\\\"), Medium = countif(tostring(severity) == \\\"Medium\\\"), Low = countif(tostring(severity) == \\\"Low\\\") by  tostring(product), tostring(vendor), tostring(version),tostring(type)\\n| sort by Total\\n\",\"size\":0,\"title\":\"Vulnerable Components\",\"showRefreshButton\":true,\"exportedParameters\":[{\"fieldName\":\"vendor\",\"parameterName\":\"pVendor\",\"parameterType\":1},{\"fieldName\":\"version\",\"parameterName\":\"pVersion\",\"parameterType\":1},{\"fieldName\":\"product\",\"parameterName\":\"pProduct\",\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"product\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"33ch\"}},{\"columnMatch\":\"vendor\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"version\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"}},{\"columnMatch\":\"Critical\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redDark\"}},{\"columnMatch\":\"High\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"Medium\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}},{\"columnMatch\":\"Low\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellow\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"product\",\"label\":\"Component\"},{\"columnId\":\"vendor\",\"label\":\"Vendor\"},{\"columnId\":\"version\",\"label\":\"Version\"},{\"columnId\":\"type\",\"label\":\"Type\"},{\"columnId\":\"Total\",\"label\":\"Total CVEs\"}]},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"tenantId\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n| where severity in ({SeverityName})\\n| mv-expand components=properties['affectedComponents'] \\n| extend vendor=components['vendor'],\\n    version=components['version'],\\n    type=components['type'],\\n    product=components['product']\\n| where product == \\\"{pProduct}\\\" and version==\\\"{pVersion}\\\" and vendor==\\\"{pVendor}\\\"\\n| join¬†¬†kind=leftouter (iotsecurityresources\\n¬†¬†¬†¬†¬†¬†¬†¬†¬†| where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n¬†¬†¬†¬†¬†¬†¬†¬†¬†| project Site=tostring(properties.sensor.site), name, criticality=properties.criticality, deviceName=properties.deviceName) on $left.deviceId == $right.name\\n| extend site = iff(Site==\\\"\\\", \\\"Managed IoT Hub\\\", Site)\\n| where site in ({SiteName})\\n| project deviceId,  tostring(deviceName), site\\n| summarize by deviceId, deviceName, site\\n\",\"size\":0,\"title\":\"Selected Component - Affected Devices\",\"showRefreshButton\":true,\"exportedParameters\":[{\"fieldName\":\"vendor\",\"parameterName\":\"pVendor\",\"parameterType\":1},{\"fieldName\":\"version\",\"parameterName\":\"pVersion\",\"parameterType\":1},{\"fieldName\":\"product\",\"parameterName\":\"pProduct\",\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"product\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"33ch\"}},{\"columnMatch\":\"vendor\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"version\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"}},{\"columnMatch\":\"Critical\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redDark\"}},{\"columnMatch\":\"High\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"Medium\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}},{\"columnMatch\":\"Low\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellow\"}}],\"rowLimit\":10000,\"filter\":true},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"tenantId\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"query - 12 - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"vulnerabilities\"},\"customWidth\":\"100\",\"name\":\"Vulnerabilities\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# OT Device Inventory\\n\\n\"},\"name\":\"text - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"89842b77-826e-4175-a637-b02e09c8922c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SiteName\",\"label\":\"Site\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n| extend Site=properties.sensor.site\\n| where Site != \\\"\\\"\\n| summarize by tostring(Site)\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"a42d8f71-272c-4579-aa69-350d125a2752\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ZoneName\",\"label\":\"Zone\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n| extend Zone=properties.sensor.zone\\n| where Zone != \\\"\\\"\\n| summarize by tostring(Zone)\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"4abc6f47-2ff6-47be-a921-75cb2ee546b1\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SensorName\",\"label\":\"Sensor\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n| extend Sensor=properties.sensor.name\\n| where Sensor!=\\\"\\\"\\n| summarize by tostring(Sensor)\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"pills\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n| extend DeviceName=tostring(properties.deviceName)\\n| extend Sensor=tostring(properties.sensor.name)\\n| extend Site=tostring(properties.sensor.site)\\n| extend tostring(Zone=properties.sensor.zone)\\n| where Sensor in ({SensorName}, \\\"\\\")\\n| where Zone in ({ZoneName}, \\\"\\\")\\n| where Site in ({SiteName}, \\\"\\\")\\n| summarize CountDevices=count(DeviceName)\\n\",\"size\":3,\"title\":\"Total Devices\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"secondaryContent\":{\"columnMatch\":\"CountDevices\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n| extend TimeFirstSeen=properties.lastSeen\\n| where TimeFirstSeen {TimeRange}\\n| extend DeviceName=tostring(properties.deviceName)\\n| extend Sensor=tostring(properties.sensor.name)\\n| extend Site=tostring(properties.sensor.site)\\n| extend tostring(Zone=properties.sensor.zone)\\n| where Sensor in ({SensorName})\\n| where Zone in ({ZoneName})\\n| where Site in ({SiteName})\\n| summarize CountDevices=count(DeviceName)\\n\",\"size\":3,\"title\":\"Active Devices {TimeRange}\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"secondaryContent\":{\"columnMatch\":\"CountDevices\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 11 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n| extend TimeFirstSeen=properties.lastSeen\\n| where TimeFirstSeen > ago(1d)\\n| extend DeviceName=tostring(properties.deviceName)\\n| extend Zone=tostring(properties.sensor.zone)\\n| extend Site=properties.sensor.site\\n| extend Sensor=properties.sensor.name\\n| where Sensor in ({SensorName})\\n| where Site in ({SiteName})\\n| where Zone in ({ZoneName})\\n| summarize CountDevices=count(DeviceName)\\n\",\"size\":3,\"title\":\"Active Devices Today\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"secondaryContent\":{\"columnMatch\":\"CountDevices\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"12\",\"name\":\"query - 11 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n| extend TimeFirstSeen=properties.lastSeen\\n| where TimeFirstSeen > ago(1d)\\n| extend DeviceName=tostring(properties.deviceName)\\n| extend Criticiality = tostring(properties.criticality)\\n| extend Zone=tostring(properties.sensor.zone)\\n| extend Site=properties.sensor.site\\n| extend Sensor=properties.sensor.name\\n| where Sensor in ({SensorName})\\n| where Site in ({SiteName})\\n| where Zone in ({ZoneName})\\n| where Criticiality == \\\"High\\\"\\n| summarize CountDevices=count(DeviceName)\\n\",\"size\":3,\"title\":\"High Importance Devices\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"secondaryContent\":{\"columnMatch\":\"CountDevices\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"40\",\"name\":\"query - 11 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimeFirstSeen=properties.lastSeen \\n    | where TimeFirstSeen {TimeRange}\\n    | extend DeviceName=properties.deviceName\\n    | extend Zone=tostring(properties.sensor.zone)\\n    | extend Site=properties.sensor.site\\n    | extend Sensor=properties.sensor.name\\n    | where Sensor in ({SensorName})\\n    | where Site in ({SiteName})\\n    | where Zone in ({ZoneName})\\n    | where properties.deviceDataSource=='OtSensor'\\n    | summarize count() by trim( @'^\\\\[\\\"|\\\"]$|\\\"', tostring(Site))\",\"size\":3,\"title\":\"Active Devices by Site\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"33\",\"name\":\" Discovered OT devices by date - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimeFirstSeen=properties.lastSeen \\n    | where TimeFirstSeen {TimeRange}\\n    | extend DeviceName=properties.deviceName\\n    | extend Zone=tostring(properties.sensor.zone)\\n    | extend Site=properties.sensor.site\\n    | extend Sensor=properties.sensor.name\\n    | where Sensor in ({SensorName})\\n    | where Site in ({SiteName})\\n    | where Zone in ({ZoneName})\\n    | where properties.deviceDataSource=='OtSensor'\\n    | summarize count() by trim( @'^\\\\[\\\"|\\\"]$|\\\"', tostring(Zone))\",\"size\":3,\"title\":\"Active Devices by Zone\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"33\",\"name\":\" Discovered OT devices by date - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimeFirstSeen=properties.lastSeen \\n    | where TimeFirstSeen {TimeRange}\\n    | extend DeviceName=properties.deviceName\\n    | extend Zone=tostring(properties.sensor.zone)\\n    | extend Site=properties.sensor.site\\n    | extend Sensor=properties.sensor.name\\n    | where Sensor in ({SensorName})\\n    | where Site in ({SiteName})\\n    | where Zone in ({ZoneName})\\n    | where properties.deviceDataSource=='OtSensor'\\n    | summarize count() by trim( @'^\\\\[\\\"|\\\"]$|\\\"', tostring(Sensor))\",\"size\":3,\"title\":\"Active Devices by Sensor\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"33\",\"name\":\" Discovered OT devices by date - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimLastSeen=properties.lastSeen\\n    | extend DeviceName=properties.deviceName\\n    | where TimLastSeen {TimeRange}\\n    | extend Sensor=properties.sensor.name\\n    | where Sensor in ({SensorName})\\n    | extend DeviceSubType=iff(properties.deviceSubTypeDisplayName==\\\"Unclassified\\\", \\\"\\\", properties.deviceSubTypeDisplayName)\\n    | extend Site=properties.sensor.site\\n    | where Site in ({SiteName})\\n    | extend Zone=tostring(properties.sensor.zone)\\n    | where Zone in ({ZoneName})\\n    | extend IPv4=properties.nics.[0].ipv4Address\\n    | extend MACAddress=properties.nics.[0].macAddress\\n    | extend Vendor=properties.hardware.vendor\\n    | extend PurdueLevel=properties.purdueLevel\\n    | extend OperatingSystem=properties.operatingSystem.platform\\n    | extend Protocols = trim(@'^\\\\[\\\"|\\\"]$|\\\"', tostring(properties.protocols))\\n    | where properties.deviceDataSource=='OtSensor'\\n    | extend data=split(id, '/')\\n    | extend StringforBase64function = strcat('{\\\"subscriptionId\\\":\\\"', data[2], '\\\",\\\"deviceId\\\":\\\"', data[10], '\\\",\\\"location\\\":\\\"', data[6], '\\\",\\\"deviceGroupName\\\":\\\"', data[8], '\\\"}')\\n    | extend devicelink = base64_encode_tostring(StringforBase64function)\\n    | project TimLastSeen, tostring(DeviceName),DeviceLink=strcat(\\\"https://portal.azure.com/#view/Microsoft_Azure_IoT_Defender/IDeviceBlade/data/\\\",devicelink), tostring(DeviceSubType), tostring(Site), tostring(Zone), tostring(Sensor),tostring(PurdueLevel), tostring(IPv4), tostring(MACAddress), Protocols, tostring(Vendor), tostring(OperatingSystem), DeviceID=name, tostring(name)\\n    | join kind=leftouter\\n        (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/vulnerabilities' \\n         | summarize CVECount=count() by name2=tostring(properties.deviceId)) on $left.name == $right.name2 \\n    | join kind=leftouter\\n    (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n         | where properties.status != \\\"Closed\\\"\\n         | extend name3= tostring(properties.extendedProperties.SourceDeviceAddress)\\n         | summarize AlertCount=count() by name3) on $left.DeviceName == $right.name3 \\n    | join kind=leftouter\\n    (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n         | where properties.status != \\\"Closed\\\"\\n         | where tostring(properties.extendedProperties.DestinationDeviceAddress)!=tostring(properties.extendedProperties.SourceDeviceAddress)\\n         | summarize AlertCount2=count() by name4=tostring(properties.extendedProperties.DestinationDeviceAddress)) on $left.DeviceName == $right.name4 \\n    | project  TimLastSeen, tostring(DeviceName), DeviceLink, tostring(DeviceSubType), AlertCountSum=coalesce(AlertCount,0)+coalesce(AlertCount2,0), CVECount, tostring(Site), tostring(Zone), tostring(Sensor),tostring(PurdueLevel), tostring(IPv4), tostring(MACAddress), Protocols, tostring(Vendor), tostring(OperatingSystem), DeviceID=name\\n   | sort by tostring(TimLastSeen)\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"üü¶ OT Assets\",\"noDataMessage\":\"No Assets Observed, Confirm Logging\",\"exportFieldName\":\"DeviceID\",\"exportParameterName\":\"pDeviceID\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimLastSeen\",\"formatter\":6,\"formatOptions\":{\"customColumnWidthSetting\":\"23ch\"},\"dateFormat\":{\"formatName\":\"shortDateTimePattern\"}},{\"columnMatch\":\"DeviceName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"DeviceLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Device >>\",\"customColumnWidthSetting\":\"15ch\"}},{\"columnMatch\":\"DeviceSubType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"13ch\"}},{\"columnMatch\":\"CVECount\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"14ch\"}},{\"columnMatch\":\"Site\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"Zone\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"23ch\"}},{\"columnMatch\":\"Sensor\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"PurdueLevel\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"IPv4\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"21ch\"}},{\"columnMatch\":\"Protocols\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}},{\"columnMatch\":\"Vendor\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}},{\"columnMatch\":\"OperatingSystem\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"}},{\"columnMatch\":\"DeviceID\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"42ch\"}},{\"columnMatch\":\"TimeFirstSeen\",\"formatter\":6,\"formatOptions\":{\"customColumnWidthSetting\":\"25ch\"},\"dateFormat\":{\"formatName\":\"shortDateTimePattern\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimLastSeen\",\"label\":\"Time Last Seen\"},{\"columnId\":\"DeviceName\",\"label\":\"Name\"},{\"columnId\":\"DeviceLink\",\"label\":\"Device Link\"},{\"columnId\":\"DeviceSubType\",\"label\":\"Type\"},{\"columnId\":\"AlertCountSum\",\"label\":\"Open Alerts\"},{\"columnId\":\"CVECount\",\"label\":\"CVEs\"},{\"columnId\":\"PurdueLevel\",\"label\":\"Purdue Level\"},{\"columnId\":\"MACAddress\",\"label\":\"MAC Address\"},{\"columnId\":\"OperatingSystem\",\"label\":\"Operating System\"},{\"columnId\":\"DeviceID\",\"label\":\"Device ID\"}]}},\"customWidth\":\"100\",\"name\":\"üü¶ OT Asset Inventory\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"\\n    iotsecurityresources \\n        | where type==\\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n        | extend name=tostring(properties.deviceId)\\n        | where '{pDeviceID}' == name\\n        | project DeviceID=name, CVE=tostring(properties.vulnerabilityId), Severity=tostring(properties.severityScore),CVEDescription=tostring(properties.description)\",\"size\":4,\"showAnalytics\":true,\"title\":\"üü¶ CVEs - Selected OT Asset\",\"noDataMessage\":\"No CVEs Observed.\",\"exportFieldName\":\"DeviceID\",\"exportParameterName\":\"deviceId\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceID\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"37ch\"}},{\"columnMatch\":\"CVE\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"16ch\"}},{\"columnMatch\":\"Severity\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"13ch\"}},{\"columnMatch\":\"CVEDescription\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"60ch\"}}],\"rowLimit\":100,\"filter\":true,\"labelSettings\":[{\"columnId\":\"DeviceID\",\"label\":\"Device ID\"},{\"columnId\":\"CVEDescription\",\"label\":\"CVE Description\"}]}},\"customWidth\":\"50\",\"name\":\"üü¶ OT Asset Inventory - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/recommendations\\\"\\n| where properties.recommendationType contains 'IoT_OT'\\n| extend RecType=iff(properties.recommendationType == \\\"IoT_OTRecommendation_SecuredStatePLC\\\", \\\"Review PLC operating mode\\\", properties.recommendationType) \\n| extend RecType=iff(properties.recommendationType == \\\"IoT_OTRecommendation_Authorization\\\", \\\"Review unauthorized devices\\\", \\\"Review PLC operating mode\\\")\\n| extend status = properties.status\\n| extend deviceId=properties['recommendationAdditionalData']['DeviceResourceIds']\\n| extend name=tostring(split(deviceId,'/')[10])\\n| extend name=tostring(split(name,'\\\"')[0])\\n| where '{pDeviceID}' == name\\n| where status == \\\"Unhealthy\\\"\\n| project name, tostring(properties.discoveredTimeUtc), tostring(properties.severity), RecType, tostring(properties.status)\",\"size\":4,\"showAnalytics\":true,\"title\":\"üü¶ Recommendations - Selected OT Device \",\"noDataMessage\":\"No Recommendations Observed, Confirm Logging\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"properties_discoveredTimeUtc\",\"formatter\":6,\"dateFormat\":{\"formatName\":\"shortDateTimePattern\"}},{\"columnMatch\":\"TimeFirstSeen\",\"formatter\":6,\"formatOptions\":{\"customColumnWidthSetting\":\"25ch\"},\"dateFormat\":{\"formatName\":\"shortDateTimePattern\"}},{\"columnMatch\":\"DeviceName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"DeviceSubType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"13ch\"}},{\"columnMatch\":\"CVECount\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"14ch\"}},{\"columnMatch\":\"Site\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"Zone\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"23ch\"}},{\"columnMatch\":\"Sensor\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"PurdueLevel\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"IPv4\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"21ch\"}},{\"columnMatch\":\"Protocols\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}},{\"columnMatch\":\"Vendor\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}},{\"columnMatch\":\"OperatingSystem\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"}},{\"columnMatch\":\"DeviceID\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"42ch\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"name\",\"label\":\"Device ID\"},{\"columnId\":\"properties_discoveredTimeUtc\",\"label\":\"Discovered Time UTC\"},{\"columnId\":\"properties_severity\",\"label\":\"Severity\"},{\"columnId\":\"RecType\",\"label\":\"Name\"},{\"columnId\":\"properties_status\",\"label\":\"Status\"}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"RecType\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"properties_status\"},\"leftContent\":{\"columnMatch\":\"properties_severity\"},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"üü¶ Recommendations - Selected OT Device \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimeFirstSeen=properties.lastSeen \\n    | extend PurdueLevel=tostring(properties.purdueLevel)\\n    | where TimeFirstSeen {TimeRange}\\n    | extend DeviceName=properties.deviceName\\n    | extend Zone=tostring(properties.sensor.zone)\\n    | extend Site=properties.sensor.site\\n    | extend Sensor=properties.sensor.name\\n    | where Sensor in ({SensorName})\\n    | where Site in ({SiteName})\\n    | where Zone in ({ZoneName})\\n    | summarize count() by tostring(PurdueLevel)\",\"size\":3,\"title\":\"Active Devices by Purdue Level\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}],\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"33\",\"name\":\" Discovered OT devices by date - Copy - Copy - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimeFirstSeen=properties.lastSeen \\n    | extend Protocols=trim(@'^\\\\[\\\"|\\\"]$|\\\"|[|]', tostring(properties.protocols))\\n    | extend replaced=replace(@'\\\\(.+?\\\\)', ' ', tostring(Protocols))\\n    | where TimeFirstSeen {TimeRange}\\n    | where Protocols != \\\"[]\\\" \\n    | extend DeviceName=properties.deviceName\\n    | extend Zone=tostring(properties.sensor.zone)\\n    | extend Site=properties.sensor.site\\n    | extend Sensor=properties.sensor.name\\n    | where Sensor in ({SensorName})\\n    | where Site in ({SiteName})\\n    | where Zone in ({ZoneName})\\n    | extend protocolParse=split(replaced, \\\",\\\")\\n    | mv-expand protocolParse to typeof(string)\\n    | summarize count() by tostring(protocolParse)\",\"size\":3,\"title\":\"Active Devices by Protocol\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"33\",\"name\":\" Discovered OT devices by date - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimeFirstSeen=properties.lastSeen \\n    | extend Vendor=tostring(properties.hardware.vendor)\\n    | where TimeFirstSeen {TimeRange}\\n    | where Vendor != \\\"\\\" \\n    | extend DeviceName=properties.deviceName\\n    | extend Zone=tostring(properties.sensor.zone)\\n    | extend Site=properties.sensor.site\\n    | extend Sensor=properties.sensor.name\\n    | where Sensor in ({SensorName})\\n    | where Site in ({SiteName})\\n    | where Zone in ({ZoneName})\\n    | summarize count() by tostring(Vendor)\",\"size\":3,\"title\":\"Active Devices by Vendor\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}],\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"33\",\"name\":\" Discovered OT devices by date - Copy - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\" \\n| extend TimeFirstSeen=properties.lastSeen \\n| where TimeFirstSeen {TimeRange}\\n| extend Zone=tostring(properties.sensor.zone)\\n| extend Site=properties.sensor.site\\n| extend Sensor=properties.sensor.name\\n| where Sensor in ({SensorName})\\n| where Site in ({SiteName})\\n| where Zone in ({ZoneName})\\n| where tostring(properties.deviceSubTypeDisplayName) != \\\"Unclassified\\\"\\n| extend SubType=tostring(properties.deviceSubTypeDisplayName)\\n| summarize Devices=count() by SubType\\n| sort by Devices\",\"size\":0,\"title\":\"Active Devices by Type \",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"unstackedbar\"},\"customWidth\":\"50\",\"name\":\"Discovered OT Devices by Type\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimeFirstSeen=properties.firstSeen \\n    | where TimeFirstSeen {TimeRange}\\n    | extend DeviceName=properties.deviceName\\n    | extend Zone=tostring(properties.sensor.zone)\\n    | extend Site=properties.sensor.site\\n    | extend Sensor=properties.sensor.name\\n    | where Sensor in ({SensorName})\\n    | where Site in ({SiteName})\\n    | where Zone in ({ZoneName})\\n    | where properties.deviceDataSource=='OtSensor'\\n    | extend myDAY = split(TimeFirstSeen, \\\"T\\\", 0) //using split to parse \\n    | summarize count() by trim( @'^\\\\[\\\"|\\\"]$|\\\"', tostring(myDAY))\",\"size\":0,\"title\":\"Discovered Devices by Date\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"unstackedbar\"},\"customWidth\":\"50\",\"name\":\" Active devices by date - Copy\",\"styleSettings\":{\"margin\":\"50\",\"padding\":\"50\",\"maxWidth\":\"50\"}}]},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"inventory\"},\"name\":\"Inventory\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Overview\"},\"name\":\"text - 12\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Summary\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n| extend DeviceName=tostring(properties.deviceName)\\n| summarize CountDevices=count(DeviceName)\\n\",\"size\":3,\"title\":\"Total Devices\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"rightContent\":{\"columnMatch\":\"CountDevices\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false,\"sortCriteriaField\":\"CountDevices\",\"size\":\"auto\"}},\"customWidth\":\"15\",\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n| extend TimeFirstSeen=properties.lastSeen\\n| where TimeFirstSeen {TimeRange}\\n| extend DeviceName=tostring(properties.deviceName)\\n| summarize CountDevices=count(DeviceName)\\n\",\"size\":3,\"title\":\"Active Devices {TimeRange}\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"rightContent\":{\"columnMatch\":\"CountDevices\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false,\"sortCriteriaField\":\"CountDevices\",\"size\":\"auto\"}},\"customWidth\":\"15\",\"name\":\"query - 5 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated {TimeRange}\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| where Severity == \\\"High\\\" and Status != \\\"Closed\\\"\\n| summarize AlertCount=count()\\n\",\"size\":3,\"title\":\"High Severity Open Incidents\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"rightContent\":{\"columnMatch\":\"AlertCount\",\"formatter\":12,\"formatOptions\":{\"min\":0,\"max\":1,\"palette\":\"redDark\"}},\"showBorder\":false,\"sortCriteriaField\":\"CountDevices\",\"size\":\"auto\"}},\"customWidth\":\"15\",\"name\":\"query - 5 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend severity=properties['severityScore']\\n| extend Severity=properties.severityScore\\n| where Severity == \\\"Critical\\\"\\n| summarize count() by tostring(severity)\\n\",\"size\":3,\"title\":\"Critical CVEs\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"min\":0,\"max\":1,\"palette\":\"red\"}},\"showBorder\":false,\"sortCriteriaField\":\"CountDevices\",\"size\":\"auto\"}},\"customWidth\":\"10\",\"name\":\"query - 5 - Copy - Copy - Copy\"}]},\"name\":\"Summary\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Inventory Overview\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimeFirstSeen=properties.lastSeen \\n    | where TimeFirstSeen {TimeRange}\\n    | extend DeviceName=properties.deviceName\\n    | extend Zone=tostring(properties.sensor.zone)\\n    | extend Site=properties.sensor.site\\n    | extend Sensor=properties.sensor.name\\n    | where properties.deviceDataSource=='OtSensor'\\n    | summarize count() by trim( @'^\\\\[\\\"|\\\"]$|\\\"', tostring(Site))\",\"size\":1,\"title\":\"Devices by Site\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"barchart\"},\"name\":\"query - 1\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\" \\n| extend TimeFirstSeen=properties.lastSeen \\n| where TimeFirstSeen {TimeRange}\\n| where tostring(properties.deviceSubTypeDisplayName) != \\\"Unclassified\\\"\\n| extend SubType=tostring(properties.deviceSubTypeDisplayName)\\n| summarize Devices=count() by SubType\\n| sort by Devices\",\"size\":3,\"title\":\"Active Devices by Type\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"SubType\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Devices\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"Devices\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"Devices\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"Devices\",\"heatmapPalette\":\"greenRed\"}}},\"name\":\"query - 4\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimeFirstSeen=properties.lastSeen \\n    | extend Protocols=trim(@'^\\\\[\\\"|\\\"]$|\\\"|[|]', tostring(properties.protocols))\\n    | extend replaced=replace(@'\\\\(.+?\\\\)', ' ', tostring(Protocols))\\n    | where TimeFirstSeen {TimeRange}\\n    | where Protocols != \\\"[]\\\" \\n    | extend DeviceName=properties.deviceName\\n    | extend protocolParse=split(replaced, \\\",\\\")\\n    | mv-expand protocolParse to typeof(string)\\n    | summarize count() by tostring(protocolParse)\",\"size\":1,\"title\":\"Active OT Devices by Protocol\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"barchart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Column1\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Column1\",\"sortOrder\":2}],\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Column1\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"AssetCount\",\"label\":\"Discovered Assets\"}]}},\"name\":\"query - 4\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/devices\\\"\\n    | extend TimeFirstSeen=properties.firstSeen\\n    | extend DeviceName=properties.deviceName\\n    | where TimeFirstSeen {TimeRange}\\n    | extend DeviceSubType=iff(properties.deviceSubTypeDisplayName==\\\"Unclassified\\\", \\\"\\\", properties.deviceSubTypeDisplayName)\\n    | extend Site=properties.sensor.site\\n    | where properties.deviceDataSource=='OtSensor'\\n    | extend data=split(id, '/')\\n    | extend StringforBase64function = strcat('{\\\"subscriptionId\\\":\\\"', data[2], '\\\",\\\"deviceId\\\":\\\"', data[10], '\\\",\\\"location\\\":\\\"', data[6], '\\\",\\\"deviceGroupName\\\":\\\"', data[8], '\\\"}')\\n    | extend devicelink = base64_encode_tostring(StringforBase64function)\\n    | project TimeFirstSeen, tostring(DeviceName), DeviceLink=strcat(\\\"https://portal.azure.com/#view/Microsoft_Azure_IoT_Defender/IDeviceBlade/data/\\\",devicelink), tostring(DeviceSubType), tostring(Site)\\n    | join kind=leftouter\\n    (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n         | where properties.status != \\\"Closed\\\"\\n         | extend name3= tostring(properties.extendedProperties.SourceDeviceAddress)\\n         | summarize AlertCount=count() by name3) on $left.DeviceName == $right.name3 \\n    | join kind=leftouter\\n    (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n         | where properties.status != \\\"Closed\\\"\\n         | where tostring(properties.extendedProperties.DestinationDeviceAddress)!=tostring(properties.extendedProperties.SourceDeviceAddress)\\n         | summarize AlertCount2=count() by name4=tostring(properties.extendedProperties.DestinationDeviceAddress)) on $left.DeviceName == $right.name4 \\n    | project  TimeFirstSeen, tostring(DeviceName), DeviceLink, tostring(DeviceSubType), AlertCountSum=coalesce(AlertCount,0)+coalesce(AlertCount2,0), tostring(Site)\\n   | sort by tostring(TimeFirstSeen)\\n   | take 50\",\"size\":0,\"title\":\"Recent Discovered Devices\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeFirstSeen\",\"formatter\":6,\"formatOptions\":{\"customColumnWidthSetting\":\"24ch\"},\"dateFormat\":{\"formatName\":\"shortDateTimePattern\"}},{\"columnMatch\":\"DeviceName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"DeviceLink\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Device >>\",\"customColumnWidthSetting\":\"16ch\"}},{\"columnMatch\":\"DeviceSubType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"}},{\"columnMatch\":\"AlertCountSum\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"16ch\"}},{\"columnMatch\":\"Site\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}}],\"rowLimit\":50,\"labelSettings\":[{\"columnId\":\"TimeFirstSeen\",\"label\":\"Time First Seen\"},{\"columnId\":\"DeviceName\",\"label\":\"Device Name\"},{\"columnId\":\"DeviceLink\",\"label\":\"Device Link\"},{\"columnId\":\"DeviceSubType\",\"label\":\"Type\"},{\"columnId\":\"AlertCountSum\",\"label\":\"Open Alerts\"}]}},\"name\":\"query - 1 - Copy\",\"styleSettings\":{\"showBorder\":true}}]},\"customWidth\":\"33\",\"name\":\"group - 2\",\"styleSettings\":{\"margin\":\"0\",\"padding\":\"30px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Threat Detection Overview\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated {TimeRange}\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| extend SystemAlertId = tostring(AlertIds[0])\\n| join (SecurityAlert) on SystemAlertId\\n| mv-expand deviceEntities=parse_json(Entities)\\n| extend deviceSite = tostring(deviceEntities.Site)\\n| where isnotempty(deviceSite) \\n| summarize AlertCount=dcount(ProviderIncidentId) by deviceSite \\n| sort by AlertCount desc\",\"size\":1,\"title\":\"Incidents by Site\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"barchart\"},\"name\":\"query - 3\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated {TimeRange}\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize AlertCount=count() by tostring(Severity)\\n\",\"size\":3,\"title\":\"Incidents by Severity\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"xAxis\":\"TimeGenerated\",\"yAxis\":[\"AlertCount\"],\"seriesLabelSettings\":[{\"seriesName\":\"<empty>\",\"label\":\"Alert Count\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"}]}},\"name\":\"query - 1 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated {TimeRange}\\n| summarize arg_max(TimeGenerated, *) by ProviderIncidentId\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\" or Title contains \\\"(MDIoT)\\\"\\n| summarize AlertCount=count() by bin(TimeGenerated, 1d),tostring(Severity)\\n\",\"size\":1,\"title\":\"Incidents Trend Overtime\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"timechart\",\"chartSettings\":{\"xAxis\":\"TimeGenerated\",\"yAxis\":[\"AlertCount\"],\"group\":\"Severity\",\"createOtherGroup\":0,\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"<empty>\",\"label\":\"Alert Count\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"}],\"xSettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"name\":\"query - 1\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\\n| where ProductName contains \\\"iot\\\"\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\n| parse IncidentUrl with * '/#asset/Microsoft_Azure_Security_Insights/Incident' IncidentBlade\\n| extend SeverityRank=iff(Severity == \\\"High\\\", 3, iff(Severity == \\\"Medium\\\", 2, iff(Severity == \\\"Low\\\", 1, iff(Severity == \\\"Informational\\\", 0, 0))))\\n| sort by SeverityRank, TimeGenerated desc\\n| project TimeGenerated,['Incident Name']=Title, URL=IncidentUrl, IncidentNumber, Severity, Status\\n| limit 50\",\"size\":0,\"title\":\"Recent Open Incidents\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"22ch\"}},{\"columnMatch\":\"Incident Name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"24ch\"}},{\"columnMatch\":\"IncidentNumber\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"}},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"Sev1\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"Sev2\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"Sev0\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"New\",\"representation\":\"AddTile\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"InProgress\",\"representation\":\"pending\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Closed\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"success\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"URL\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Incident >>\"}},{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"OpenBlade\",\"linkLabel\":\"Incident >>\",\"bladeOpenContext\":{\"bladeName\":\"CaseBlade\",\"extensionName\":\"Microsoft_Azure_Security_Insights\"}}}],\"rowLimit\":50,\"labelSettings\":[{\"columnId\":\"Incident Name\",\"label\":\"Incident Name\"},{\"columnId\":\"URL\",\"label\":\"Link\"},{\"columnId\":\"IncidentNumber\",\"label\":\"Incident ID\"}]}},\"name\":\"query - 0 - Copy\",\"styleSettings\":{\"showBorder\":true}}]},\"customWidth\":\"33\",\"name\":\"group - 1\",\"styleSettings\":{\"padding\":\"30px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Vulnerabilities Overview\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"    iotsecurityresources\\n    | where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n    | extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n    | project deviceId\\n    | join¬†¬†kind=leftouter (iotsecurityresources\\n    ¬†¬†¬†¬†¬†¬†¬†¬†¬†| where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n    ¬†¬†¬†¬†¬†¬†¬†¬†¬†| project Site=tostring(properties.sensor.site), name) on $left.deviceId == $right.name\\n    | summarize count() by Site\\n    | project site = iff(Site==\\\"\\\", \\\"Managed IoT Hub\\\", Site), count_\\n\",\"size\":1,\"title\":\"CVEs by Site\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"barchart\",\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"site\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"sum_count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"group\":\"Severity\",\"createOtherGroup\":0}},\"name\":\"query - 2\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend severity=properties['severityScore']\\n| extend Severity=properties.severityScore\\n| summarize count() by tostring(severity )\\n\",\"size\":3,\"title\":\"CVEs by Severity\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"Critical\",\"color\":\"redDark\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"}]}},\"name\":\"query - 1\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend DeviceID = tostring(properties.deviceId)\\n| extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n| mv-expand components=properties['affectedComponents'] \\n| extend vendor=components['vendor'],\\n    version=components['version'],\\n    type=components['type'],\\n    product=components['product']\\n| extend Severity=properties.severityScore\\n| join  kind=leftouter (iotsecurityresources\\n         | where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n         | project DeviceSiteName=tostring(properties.sensor.site), name) on $left.DeviceID == $right.name\\n| summarize count() by tostring(cveName), tostring(vendor) \\n| summarize count() by tostring(vendor) \\n| where vendor != '*'\",\"size\":1,\"title\":\"CVEs by Vendor\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"barchart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"Critical\",\"color\":\"redDark\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"}]}},\"name\":\"query - 1 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"iotsecurityresources\\n| where type == \\\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\\\"\\n| extend DeviceID = tostring(properties.deviceId)\\n| extend severity=properties['severityScore'],\\n    deviceId=tostring(properties['deviceId']),\\n    score=properties['score'],\\n    cveName = properties['vulnerabilityId'],\\n    cveDes=properties['description']\\n| extend Severity=properties.severityScore\\n| join  kind=leftouter (iotsecurityresources\\n         | where type=='microsoft.iotsecurity/locations/devicegroups/devices'\\n         | extend DeviceName = tostring(properties.deviceName)\\n         | project DeviceSiteName=tostring(properties.sensor.site), name, DeviceName) on $left.DeviceID == $right.name\\n | join kind=leftouter\\n    (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n         | where properties.status != \\\"Closed\\\"\\n         | extend name3= tostring(properties.extendedProperties.SourceDeviceAddress)\\n         | summarize AlertCount=count() by name3) on $left.DeviceName == $right.name3 \\n| join kind=leftouter\\n    (iotsecurityresources \\n         | where type=='microsoft.iotsecurity/locations/devicegroups/alerts' \\n         | where properties.status != \\\"Closed\\\"\\n         | where tostring(properties.extendedProperties.DestinationDeviceAddress)!=tostring(properties.extendedProperties.SourceDeviceAddress)\\n         | summarize AlertCount2=count() by name4=tostring(properties.extendedProperties.DestinationDeviceAddress)) on $left.DeviceName == $right.name4 \\n| summarize Total = count(), Critical = countif(tostring(severity) == \\\"Critical\\\"), High = countif(tostring(severity) == \\\"High\\\"), Medium = countif(tostring(severity) == \\\"Medium\\\"), Low = countif(tostring(severity) == \\\"Low\\\") by deviceId, DeviceName, AlertCountSum=coalesce(AlertCount,0)+coalesce(AlertCount2,0)\\n| project DeviceName, AlertCountSum, Total, Critical, High, Medium, Low, deviceId\\n| sort by Total\\n| take 50\\n\",\"size\":0,\"title\":\"Top Vulnerable Devices\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"deviceId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"38ch\"}},{\"columnMatch\":\"DeviceName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"17ch\"}},{\"columnMatch\":\"AlertCountSum\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"16ch\"}},{\"columnMatch\":\"Total\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"14ch\"}},{\"columnMatch\":\"Critical\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redDark\",\"customColumnWidthSetting\":\"11ch\"}},{\"columnMatch\":\"High\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"Medium\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}},{\"columnMatch\":\"Low\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellow\"}}],\"rowLimit\":50,\"sortBy\":[{\"itemKey\":\"Total\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"DeviceName\",\"label\":\"Device Name\"},{\"columnId\":\"AlertCountSum\",\"label\":\"Open Alerts\"},{\"columnId\":\"Total\",\"label\":\"Total CVEs\"},{\"columnId\":\"deviceId\",\"label\":\"Device ID\"}]},\"sortBy\":[{\"itemKey\":\"Total\",\"sortOrder\":2}]},\"name\":\"query - 0\",\"styleSettings\":{\"showBorder\":true}}]},\"customWidth\":\"33\",\"name\":\"group - 3\",\"styleSettings\":{\"padding\":\"30px\",\"showBorder\":true}}]},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"overview\"},\"customWidth\":\"0\",\"name\":\"group - 11\",\"styleSettings\":{\"margin\":\"30\",\"padding\":\"30\",\"showBorder\":true}}],\"fromTemplateId\":\"sentinel-IoTOTThreatMonitoringwithDefenderforIoT\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=IoTOTThreatMonitoringwithDefenderforIoTWorkbook; logoFileName=; description=The OT Threat Monitoring with Defender for IoT Workbook features OT filtering for Security Alerts, Incidents, Vulnerabilities and Asset Inventory. The workbook features a dynamic assessment of the MITRE ATT&CK for ICS matrix across your environment to analyze and respond to OT-based threats. This workbook is designed to enable SecOps Analysts, Security Engineers, and MSSPs to gain situational awareness for IT/OT security posture.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Microsoft Defender for IoT; templateRelativePath=IoTOTThreatMonitoringwithDefenderforIoT.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "SecurityAlert",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SecurityIncident",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 1 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName1'),'/',variables('analyticRuleVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "IoTDenialofService_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect attacks that would prevent the use or proper operation of a DCS system including Denial of Service events.",
                "displayName": "Denial of Service (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName == \"Suspicion of Denial Of Service Attack\"\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "InhibitResponseFunction"
                ],
                "techniques": [
                  "T0814"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 2 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName2'),'/',variables('analyticRuleVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "IoTExcessiveLoginAttempts_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect excessive login attempts that may indicate improper service configuration, human error, or malicious activity on the network such as a cyber threat attempting to manipulate the SCADA network.",
                "displayName": "Excessive Login Attempts (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName in (\"Excessive Login Attempts\",\"Excessive SMB login attempts\",\"Password Guessing Attempt Detected\",\"Excessive Number of Sessions\") \n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "ImpairProcessControl"
                ],
                "techniques": [
                  "T0806"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 3 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName3'),'/',variables('analyticRuleVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "IoTFirmwareUpdates_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId3')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect unauthorized firmware updates that may indicate malicious activity on the network such as a cyber threat that attempts to manipulate PLC firmware to compromise PLC function.",
                "displayName": "Firmware Updates (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName has_any (\"Beckhoff Software Changed\", \"Firmware Version Changed\", \"Firmware Change\", \"Firmware Changed\", \"Firmware Update\")\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence"
                ],
                "techniques": [
                  "T0857"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 3",
                "parentId": "[variables('analyticRuleId3')]",
                "contentId": "[variables('_analyticRulecontentId3')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 4 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName4'),'/',variables('analyticRuleVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "IoTHighBandwidth_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId4')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect an unusually high bandwidth which may be an indication of a new service/process or malicious activity on the network. An example scenario is a cyber threat attempting to manipulate the SCADA network.",
                "displayName": "High bandwidth in the network (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName in (\"Abnormal Traffic Bandwidth\", \"Abnormal Traffic Bandwidth Between Devices\", \"ARP Spoofing\", \"ICMP Flooding\")\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT3H",
                "queryPeriod": "PT3H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "techniques": [
                  "T0842"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId4'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 4",
                "parentId": "[variables('analyticRuleId4')]",
                "contentId": "[variables('_analyticRulecontentId4')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 5 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName5'),'/',variables('analyticRuleVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "IoTINoSensorTrafficDetected_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId5')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect that a sensor can no longer detect the network traffic, which indicates that the system is potentially insecure.",
                "displayName": "No traffic on Sensor Detected (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName == \"No Traffic Detected on Sensor Interface\" \n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "InhibitResponseFunction"
                ],
                "techniques": [
                  "T0881"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId5'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 5",
                "parentId": "[variables('analyticRuleId5')]",
                "contentId": "[variables('_analyticRulecontentId5')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 6 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName6'),'/',variables('analyticRuleVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "IoTIllegalFunctionCodes_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId6')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect Illegal function codes in SCADA equipment indicating improper application configuration or malicious activity such using illegal values within a protocol to exploit a PLC vulnerability.",
                "displayName": "Illegal Function Codes for ICS traffic (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "let alertList = dynamic([\"Function Code Not Supported by Outstation\", \"Illegal BACNet message\", \"Illegal Connection Attempt on Port 0\", \"Illegal DNP3 Operation\", \"Illegal MODBUS Operation (Exception Raised by Master)\",  \"Illegal MODBUS Operation (Function Code Zero)\", \"Incorrect Parameter Sent to Outstation\", \"Initiation of an Obsolete Function Code (Initialize Data)\", \"Initiation of an Obsolete Function Code (Save Config)\", \"Modbus Exception\", \"Unknown Object Sent to Outstation\", \"Usage of a Reserved Function Code\",  \"Usage of Improper Formatting by Outstation\", \"Usage of Reserved Status Flags (IIN)\", \"Unauthorized communication was detected by a User Defined Protocol Rule\", \"Unauthorized Operation was detected by a User Defined whitelist Alert\", \"Illegal Protocol Version\", \"New Activity Detected - LonTalk Network Variable\", \"New Activity Detected - Ovation Data Request\", \"New Activity Detected - Read/Write Command (AMS Index Group)\", \"New Activity Detected - Read/Write Command (AMS Index Offset)\", \"New Activity Detected - Unauthorized DeltaV Message Type\", \"New Activity Detected - Unauthorized DeltaV ROC Operation\", \"New Activity Detected - Using AMS Protocol Command\", \"New Activity Detected - Using Siemens SICAM Command\", \"New Activity Detected - Using Suitelink Protocol command\", \"New Activity Detected - Using Suitelink Protocol sessions\", \"New Activity Detected - Using Yokogawa VNetIP Command\", \"Omron FINS Unauthorized Command\", \"Toshiba Computer Link Unauthorized Command\", \"Unauthorized ABB Totalflow File Operation\", \"Unauthorized ABB Totalflow Register Operation\", \"Unauthorized Access to Siemens S7 Plus Object\", \"Unauthorized BACNet Object Access\", \"Unauthorized BACNet Route\", \"Unauthorized Emerson ROC Operation\", \"Unauthorized GE SRTP File Access\", \"Unauthorized GE SRTP Protocol Command\", \"Unauthorized GE SRTP System Memory Operation\", \"Unauthorized Mitsubishi MELSEC Command\", \"Unauthorized MMS Service\", \"Unauthorized OPC UA Activity\", \"Unauthorized OPC UA Request/Response\", \"Unauthorized Profinet Frame Type\", \"Unauthorized SAIA S-Bus Command\", \"Unauthorized Siemens S7 Execution of Control Function\", \"Unauthorized Siemens S7 Execution of User Defined Function\", \"Unauthorized Siemens S7 Plus Block Access\", \"Unauthorized Siemens S7 Plus Operation\", \"Unauthorized SNMP Operation\", \"Unpermitted Modbus Schneider Electric Extension\", \"Unpermitted Usage of ASDU Types\", \"Unpermitted Usage of DNP3 Function Code\", \"Unpermitted Usage of Modbus Function Code\", \"Unauthorized Operation was detected by a User Defined Rule\", \"Unauthorized PLC Configuration Read\", \"Unauthorized PLC Programming\", \"Unauthorized PLC Configuration Write\", \"Unauthorized PLC Program Upload\", \"Slave Device Received Illegal\"]);\nSecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName has_any (alertList)\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "ImpairProcessControl"
                ],
                "techniques": [
                  "T0855"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId6'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 6",
                "parentId": "[variables('analyticRuleId6')]",
                "contentId": "[variables('_analyticRulecontentId6')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 7 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName7'),'/',variables('analyticRuleVersion7'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName7'))]"
      ],
      "properties": {
        "description": "IoTInsecurePLC_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId7')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect PLC operating mode changes indicating the PLC is potentially insecure. If the PLC is compromised, devices that interact with it may be impacted. This may affect overall system security and safety.",
                "displayName": "PLC unsecure key state (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName has \"PLC Operating Mode Changed\"\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT3H",
                "queryPeriod": "PT3H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "Execution"
                ],
                "techniques": [
                  "T0858"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId7'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 7",
                "parentId": "[variables('analyticRuleId7')]",
                "contentId": "[variables('_analyticRulecontentId7')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 8 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName8'),'/',variables('analyticRuleVersion8'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName8'))]"
      ],
      "properties": {
        "description": "IoTInternetAccess_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId8')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect an OT device communicating with Internet which is possibly an indication of improper configuration of an application or malicious activity on the network.",
                "displayName": "Internet Access (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName has \"Internet\"\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "LateralMovement"
                ],
                "techniques": [
                  "T0886"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId8'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 8",
                "parentId": "[variables('analyticRuleId8')]",
                "contentId": "[variables('_analyticRulecontentId8')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 9 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName9'),'/',variables('analyticRuleVersion9'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName9'))]"
      ],
      "properties": {
        "description": "IoTMalware_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId9')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect IoT/OT malware found on the network indicating possible attempts to compromise production systems.",
                "displayName": "Suspicious malware found in the network (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "let alertList = dynamic([\"Malware\", \"Suspicion of Malicious Activity\", \"Invalid SMB Message (DoublePulsar Backdoor Implant)\", \"Connection Attempt to Known Malicious IP\", \"Malicious Domain Name Request\", \"Suspicion of Remote Code Execution with PsExec\", \"Suspicion of Remote Windows Service Management\", \"Suspicious Executable File Detected on Endpoint\", \"Suspicious Traffic Detected\"]);\nSecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName has_any (alertList) \n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T0882"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId9'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 9",
                "parentId": "[variables('analyticRuleId9')]",
                "contentId": "[variables('_analyticRulecontentId9')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 10 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName10'),'/',variables('analyticRuleVersion10'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName10'))]"
      ],
      "properties": {
        "description": "IoTNetworkScanning_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId10')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect multiple scans on the network indicating new devices, functionality, application misconfiguration, or malicious reconnaissance activity on the network.",
                "displayName": "Multiple scans in the network (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName has \"Scan\"\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "techniques": [
                  "T0842"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId10'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 10",
                "parentId": "[variables('analyticRuleId10')]",
                "contentId": "[variables('_analyticRulecontentId10')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName11')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 11 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName11'),'/',variables('analyticRuleVersion11'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName11'))]"
      ],
      "properties": {
        "description": "IoTPLCStopCommand_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion11')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId11')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect PLC stop commands which could indicate improper configuration or malicious activity on the network such as a threat manipulating PLC programming to affect the function of the network.",
                "displayName": "PLC Stop Command (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "let alertList = dynamic([\"Controller Reset\", \"An S7 Stop PLC Command was Sent\", \"Controller Stop\", \"Excessive Restart Rate of an Outstation\", \"GE SRTP Stop PLC Command was Sent\", \"Outstation Restarted\", \"Outstation Restarts Frequently\", \"Profinet Device Factory Reset\", \"Slave Device Unrecoverable Failure\", \"Suspicion of Hardware Problems in Outstation\"]);\nSecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName has_any (alertList) \n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "techniques": [
                  "T0858"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId11'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 11",
                "parentId": "[variables('analyticRuleId11')]",
                "contentId": "[variables('_analyticRulecontentId11')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion11')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName12')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 12 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName12'),'/',variables('analyticRuleVersion12'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName12'))]"
      ],
      "properties": {
        "description": "IoTUnauthorizedDevice_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion12')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId12')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect a new device indicating a legitimate device recently installed on the network or an indication of malicious activity such as a cyber threat attempting to manipulate the SCADA network.",
                "displayName": "Unauthorized device in the network (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName in (\"Field Device Discovered Unexpectedly\", \"New Asset Detected\", \"Abnormal usage of MAC Addresses\", \"New LLDP Device Configuration\")\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "techniques": [
                  "T0842"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId12'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 12",
                "parentId": "[variables('analyticRuleId12')]",
                "contentId": "[variables('_analyticRulecontentId12')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion12')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName13')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 13 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName13'),'/',variables('analyticRuleVersion13'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName13'))]"
      ],
      "properties": {
        "description": "IoTUnauthorizedNetworkConfiguration_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion13')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId13')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect an unauthorized DHCP configuration indicating a possible unauthorized device configuration.",
                "displayName": "Unauthorized DHCP configuration in the network (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName == \"Device Failed to Receive a Dynamic IP Address\"\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "techniques": [
                  "T0842"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId13'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 13",
                "parentId": "[variables('analyticRuleId13')]",
                "contentId": "[variables('_analyticRulecontentId13')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion13')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName14')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 14 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName14'),'/',variables('analyticRuleVersion14'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName14'))]"
      ],
      "properties": {
        "description": "IoTUnauthorizedPLCModifications_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion14')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId14')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect unauthorized changes to PLC ladder logic code indicating new functionality in the PLC, improper configuration of an application, or malicious activity on the network.",
                "displayName": "Unauthorized PLC changes (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "let alertList = dynamic([\"Unpermitted Usage of Internal Indication (IIN)\", \"Modbus Address Range Violation\", \"Function Code Raised Unauthorized Exception\", \"Unauthorized Access to Siemens S7 Data Block\", \"Unauthorized Access to Wonderware Tag\", \"Unauthorized MMS Program Access\", \"GOOSE Message Type Settings\", \"Sampled Values Message Type Settings\", \"Foxboro I/A Unauthorized Operation\", \"New Activity Detected - CIP Class\", \"New Activity Detected - CIP Class Service\", \"New Activity Detected - CIP PCCC Command\", \"New Activity Detected - CIP Symbol\", \"New Activity Detected - EtherNet/IP I/O Connection\", \"New Activity Detected - EtherNet/IP Protocol Command\", \"New Activity Detected - GSM Message Code\", \"New Activity Detected - LonTalk Command Codes\", \"New Activity Detected - LonTalk Network Variable\", \"New Activity Detected - Ovation Data Request\", \"New Activity Detected - Read/Write Command (AMS Index Group)\", \"New Activity Detected - Read/Write Command (AMS Index Offset)\", \"New Activity Detected - Unauthorized DeltaV Message Type\", \"New Activity Detected - Unauthorized DeltaV ROC Operation\", \"New Activity Detected - Using AMS Protocol Command\", \"New Activity Detected - Using Siemens SICAM Command\", \"New Activity Detected - Using Suitelink Protocol command\", \"New Activity Detected - Using Suitelink Protocol sessions\", \"New Activity Detected - Using Yokogawa VNetIP Command\", \"Omron FINS Unauthorized Command\", \"Toshiba Computer Link Unauthorized Command\", \"Unauthorized ABB Totalflow File Operation\", \"Unauthorized ABB Totalflow Register Operation\", \"Unauthorized Access to Siemens S7 Plus Object\", \"Unauthorized BACNet Object Access\", \"Unauthorized BACNet Route\", \"Unauthorized Emerson ROC Operation\", \"Unauthorized GE SRTP File Access\", \"Unauthorized GE SRTP Protocol Command\", \"Unauthorized GE SRTP System Memory Operation\", \"Unauthorized Mitsubishi MELSEC Command\", \"Unauthorized MMS Service\", \"Unauthorized OPC UA Activity\", \"Unauthorized OPC UA Request/Response\", \"Unauthorized Profinet Frame Type\", \"Unauthorized SAIA S-Bus Command\", \"Unauthorized Siemens S7 Execution of Control Function\", \"Unauthorized Siemens S7 Execution of User Defined Function\", \"Unauthorized Siemens S7 Plus Block Access\", \"Unauthorized Siemens S7 Plus Operation\", \"Unauthorized SNMP Operation\", \"Unpermitted Modbus Schneider Electric Extension\", \"Unpermitted Usage of ASDU Types\", \"Unpermitted Usage of DNP3 Function Code\", \"Unpermitted Usage of Modbus Function Code\", \"Unauthorized Operation was detected by a User Defined Rule\", \"Unauthorized PLC Configuration Read\", \"Unauthorized PLC Programming\", \"Unauthorized PLC Configuration Write\", \"Unauthorized PLC Program Upload\"]);\nSecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName has_any (alertList) \n  or ExtendedProperties has_any (\"Illegal Beckhoff AMS Command\", \"Beckhoff AMS Command Failure\")\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence"
                ],
                "techniques": [
                  "T0839"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId14'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 14",
                "parentId": "[variables('analyticRuleId14')]",
                "contentId": "[variables('_analyticRulecontentId14')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion14')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName15')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 15 with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName15'),'/',variables('analyticRuleVersion15'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName15'))]"
      ],
      "properties": {
        "description": "IoTUnauthorizedRemoteAccess_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion15')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId15')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert leverages Defender for IoT to detect unauthorized remote access to network devices, if another device on the network is compromised, target devices can be accessed remotely, increasing the attack surface.",
                "displayName": "Unauthorized remote access to the network (Microsoft Defender for IoT)",
                "enabled": false,
                "query": "SecurityAlert\n| where ProviderName == \"IoTSecurity\"\n| where AlertName == \"Unauthorized SSH Access\"\n| extend ExtendedProperties = parse_json(ExtendedProperties)\n| where tostring(ExtendedProperties.isNew) == \"True\"\n| extend DeviceId = tostring(ExtendedProperties.DeviceId), \n         SourceDeviceAddress = tostring(ExtendedProperties.SourceDeviceAddress), \n         DestDeviceAddress = tostring(ExtendedProperties.DestinationDeviceAddress), \n         RemediationSteps = tostring(parse_json(RemediationSteps)[0]), \n         Protocol = tostring(ExtendedProperties.Protocol), \n         AlertManagementUri = tostring(ExtendedProperties.AlertManagementUri)\n| project\n  TimeGenerated,\n  DeviceId,\n  ProductName,\n  ProductComponentName,\n  AlertSeverity,\n  AlertName,\n  Description,\n  Protocol,\n  SourceDeviceAddress,\n  DestDeviceAddress,\n  RemediationSteps,\n  Tactics,\n  Entities,\n  VendorOriginalId,\n  AlertLink,\n  AlertManagementUri,\n  Techniques\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "IoT",
                    "dataTypes": [
                      "SecurityAlert (ASC for IoT)"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T0886"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Protocol": "Protocol",
                  "VendorOriginalId": "[variables('_VendorOriginalId')]",
                  "Sensor": "DeviceId",
                  "AlertManagementUri": "AlertManagementUri"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "AlertSeverity",
                  "alertTacticsColumnName": "Tactics",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "RemediationSteps",
                      "value": "RemediationSteps"
                    },
                    {
                      "alertProperty": "Techniques",
                      "value": "Techniques"
                    },
                    {
                      "alertProperty": "ProductComponentName",
                      "value": "ProductComponentName"
                    },
                    {
                      "alertProperty": "AlertLink",
                      "value": "AlertLink"
                    }
                  ],
                  "alertDescriptionFormat": "(MDIoT) {{Description}}",
                  "alertDisplayNameFormat": "(MDIoT) {{AlertName}}"
                },
                "sentinelEntitiesMappings": [
                  {
                    "columnName": "Entities"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId15'),'/'))))]",
              "properties": {
                "description": "IoTOTThreatMonitoringwithDefenderforIoT Analytics Rule 15",
                "parentId": "[variables('analyticRuleId15')]",
                "contentId": "[variables('_analyticRulecontentId15')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion15')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "AD4IoT-AutoCloseIncidents playbook",
        "displayName": "AD4IoT-AutoCloseIncidents playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName1'),'/',variables('playbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "AD4IoT-AutoCloseIncidents Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AD4IoT-AutoCloseIncidents",
              "type": "String"
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "AzureMonitorLogsConnectionName": "[[concat('azuremonitorlogs-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureMonitorLogsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureMonitorLogsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Condition_2": {
                      "actions": {
                        "Update_incident": {
                          "inputs": {
                            "body": {
                              "classification": {
                                "ClassificationAndReason": "BenignPositive - SuspiciousButExpected",
                                "ClassificationReasonText": "Known Manitenence Activity - closed by Playbook "
                              },
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "status": "Closed"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          },
                          "type": "ApiConnection"
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(body('Run_query_and_list_results')?['value'])",
                              0
                            ]
                          },
                          {
                            "greater": [
                              "@int(substring(split(triggerBody()?['object']?['properties']?['createdTimeUtc'],'T')[1],0,2))",
                              "@int(0)"
                            ]
                          },
                          {
                            "less": [
                              "@int(substring(split(triggerBody()?['object']?['properties']?['createdTimeUtc'],'T')[1],0,2))",
                              "@int(23)"
                            ]
                          }
                        ]
                      },
                      "runAfter": {
                        "Run_query_and_list_results": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    },
                    "Initialize_variable": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "WatchlistName",
                            "type": "string",
                            "value": "ipaddresses"
                          }
                        ]
                      },
                      "runAfter": {
                        "Parse_JSON": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Parse_JSON": {
                      "inputs": {
                        "content": "@first(triggerBody()?['object']?['properties']?['Alerts'])?['properties']?['additionalData']",
                        "schema": {
                          "properties": {
                            "Category": {
                              "type": "string"
                            },
                            "CompromisedEntityId": {
                              "type": "string"
                            },
                            "DestinationDevice": {
                              "type": "string"
                            },
                            "DestinationDeviceAddress": {
                              "type": "string"
                            },
                            "DeviceId": {
                              "type": "string"
                            },
                            "ProcessedBySentinel": {
                              "type": "string"
                            },
                            "Protocol": {
                              "type": "string"
                            },
                            "SensorId": {
                              "type": "string"
                            },
                            "SourceDeviceAddress": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      },
                      "type": "ParseJson"
                    },
                    "Run_query_and_list_results": {
                      "inputs": {
                        "body": "_GetWatchlist(\"@{variables('WatchlistName')}\") \n| where ip_address == \"@{body('Parse_JSON')?['SourceDeviceAddress']}\"",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/queryData",
                        "queries": {
                          "resourcegroups": "@triggerBody()?['workspaceInfo']?['ResourceGroupName']",
                          "resourcename": "@triggerBody()?['workspaceInfo']?['WorkspaceName']",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "@triggerBody()?['workspaceInfo']?['SubscriptionId']",
                          "timerange": "Last 12 hours"
                        }
                      },
                      "runAfter": {
                        "Initialize_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuremonitorlogs": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorLogsConnectionName'))]",
                        "connectionName": "[[variables('AzureMonitorLogsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "AD4IoT-AutoCloseIncidents",
            "description": "In some cases, maintenance activities generate alerts in Sentinel which distracts the SOC team from handling the real problems. This playbook allows to input the time period in which the maintenance is expected and the assets IP (Excel file can be found). The playbook requires a watchlist which includes all the IP addresses of the assets on which alerts will handled automatically. This playbook parses explicitly the IoT device entity fields. For more information, see [AD4IoT-AutoCloseIncidents](https://github.com/Azure/Azure-Sentinel/tree/master/Playbooks/AD4IoT-AutoCloseIncidents)",
            "prerequisites": [
              "None"
            ],
            "lastUpdateTime": "2022-08-05T00:00:00Z",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "AD4IoT-AutoCloseIncidents",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "AD4IoT-MailByProductionLine playbook",
        "displayName": "AD4IoT-MailByProductionLine playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName2'),'/',variables('playbookVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "AD4IoT-MailByProductionLine Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AD4IoT-MailByProductionLine",
              "type": "String"
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "AzureOffice365ConnectionName": "[[concat('office365', parameters('PlaybookName'))]",
            "AzureMonitorLogsConnectionName": "[[concat('azuremonitorlogs-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/office365')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureMonitorLogsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureMonitorLogsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureOffice365ConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureOffice365ConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureOffice365ConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Condition": {
                      "actions": {
                        "Compose_-_Owner_email_address": {
                          "inputs": "@first(body('Run_query_and_list_results')?['value'])?['mail']",
                          "type": "Compose"
                        },
                        "Send_an_email_(V2)": {
                          "inputs": {
                            "body": {
                              "Body": "<p>@{triggerBody()?['object']?['properties']?['title']} was detcted on IP address @{body('Parse_JSON')?['SourceDeviceAddress']}<br>\n<br>\n@{triggerBody()?['object']?['properties']?['description']}<br>\nView full incident in Microsoft Sentinel: @{triggerBody()?['object']?['properties']?['incidentUrl']}</p>",
                              "Subject": "@{triggerBody()?['object']?['properties']?['title']} detected",
                              "To": "@{outputs('Compose_-_Owner_email_address')}"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['office365']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/v2/Mail"
                          },
                          "runAfter": {
                            "Compose_-_Owner_email_address": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection"
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(body('Run_query_and_list_results')?['value'])",
                              0
                            ]
                          }
                        ]
                      },
                      "runAfter": {
                        "Run_query_and_list_results": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    },
                    "Initialize_variable": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "WatchlistName",
                            "type": "string",
                            "value": "MailsBySensor"
                          }
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Parse_JSON": {
                      "inputs": {
                        "content": "@first(triggerBody()?['object']?['properties']?['Alerts'])?['properties']?['additionalData']",
                        "schema": {
                          "properties": {
                            "Category": {
                              "type": "string"
                            },
                            "CompromisedEntityId": {
                              "type": "string"
                            },
                            "DestinationDevice": {
                              "type": "string"
                            },
                            "DestinationDeviceAddress": {
                              "type": "string"
                            },
                            "DeviceId": {
                              "type": "string"
                            },
                            "ProcessedBySentinel": {
                              "type": "string"
                            },
                            "Protocol": {
                              "type": "string"
                            },
                            "SensorId": {
                              "type": "string"
                            },
                            "SourceDeviceAddress": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      },
                      "runAfter": {
                        "Initialize_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson"
                    },
                    "Run_query_and_list_results": {
                      "inputs": {
                        "body": "_GetWatchlist(\"@{variables('WatchlistName')}\") \n| where Sensor == \"@{body('Parse_JSON')?['SensorId']}\"",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/queryData",
                        "queries": {
                          "resourcegroups": "@triggerBody()?['workspaceInfo']?['ResourceGroupName']",
                          "resourcename": "@triggerBody()?['workspaceInfo']?['WorkspaceName']",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "@triggerBody()?['workspaceInfo']?['SubscriptionId']",
                          "timerange": "Last 12 hours"
                        }
                      },
                      "runAfter": {
                        "Parse_JSON": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuremonitorlogs": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorLogsConnectionName'))]",
                        "connectionName": "[[variables('AzureMonitorLogsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "office365": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureOffice365ConnectionName'))]",
                        "connectionName": "[[variables('AzureOffice365ConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/office365')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "AD4IoT-MailByProductionLine",
            "description": "The following playbook will send mail to notify specific stake holders. One example can be in the case of specific security team per product line or per physical location. This playbook requires a watchlist which maps between the sensors name and the mail addresses of the alerts stockholders. For more information, see [AD4IoT-MailbyProductionLine](https://github.com/Azure/Azure-Sentinel/tree/master/Playbooks/AD4IoT-MailbyProductionLine)",
            "prerequisites": [
              "None"
            ],
            "lastUpdateTime": "2022-08-05T00:00:00Z",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "AD4IoT-MailByProductionLine",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "AD4IoT-NewAssetServiceNowTicket playbook",
        "displayName": "AD4IoT-NewAssetServiceNowTicket playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName3'),'/',variables('playbookVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "AD4IoT-NewAssetServiceNowTicket Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AD4IoT-NewAssetServiceNowTicket",
              "type": "String"
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "service-nowConnectionName": "[[concat('ServiceNow-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/service-now')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('service-nowConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('service-nowConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('service-nowConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Condition": {
                      "actions": {
                        "Create_Record": {
                          "inputs": {
                            "body": {
                              "short_description": "A new @{body('Parse_JSON')?['deviceType']} was detected with the following Ip address @{body('Parse_JSON')?['deviceName']}"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['service-now']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/api/now/v2/table/@{encodeURIComponent('incident')}",
                            "queries": {
                              "sysparm_display_value": true,
                              "sysparm_exclude_reference_link": true
                            }
                          },
                          "type": "ApiConnection"
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@body('Parse_JSON')?['deviceType']",
                              "Engineering Station"
                            ]
                          }
                        ]
                      },
                      "runAfter": {
                        "Parse_JSON": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    },
                    "Parse_JSON": {
                      "inputs": {
                        "content": "@\nfirst(triggerBody()?['object']?['properties']?['relatedEntities'])?['properties']",
                        "schema": {
                          "properties": {
                            "deviceId": {
                              "type": "string"
                            },
                            "deviceName": {
                              "type": "string"
                            },
                            "deviceType": {
                              "type": "string"
                            },
                            "friendlyName": {
                              "type": "string"
                            },
                            "iotHubEntityId": {
                              "type": "string"
                            },
                            "ipAddressEntityId": {
                              "type": "string"
                            },
                            "protocols": {
                              "items": {
                                "type": "string"
                              },
                              "type": "array"
                            }
                          },
                          "type": "object"
                        }
                      },
                      "type": "ParseJson"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "service-now": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('service-nowConnectionName'))]",
                        "connectionName": "[[variables('service-nowConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/service-now')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "AD4IoT-NewAssetServiceNowTicket",
            "description": "Normally, the authorized entity to program a PLC is the Engineering Workstation, to program a PLC attackers might create a new Engineering Workstation to create malicious programing. The following playbook will open a ticket in ServiceNow each time a new Engineering Workstation is detected. This playbook parses explicitly the IoT device entity fields. For more information, see [AD4IoT-NewAssetServiceNowTicket](https://github.com/Azure/Azure-Sentinel/blob/master/Playbooks/AD4IoT-NewAssetServiceNowTicket/readme.md)",
            "prerequisites": [
              "None"
            ],
            "lastUpdateTime": "2022-08-05T00:00:00Z",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "AD4IoT-NewAssetServiceNowTicket",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "AD4IoT-AutoAlertStatusSync playbook",
        "displayName": "AD4IoT-AutoAlertStatusSync playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName4'),'/',variables('playbookVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "AD4IoT-AutoAlertStatusSync Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AD4IoT-AutoAlertStatusSync",
              "type": "String"
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "AzureMonitorLogsConnectionName": "[[concat('azuremonitorlogs-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureMonitorLogsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureMonitorLogsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorLogsConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Extract_incident_status_and_convert_to_MD4IoT_alert_status": {
                      "actions": {
                        "Set_variable_-_InProgress": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "MD4IoTAlertStatus",
                            "value": "InProgress"
                          }
                        }
                      },
                      "runAfter": {
                        "MD4IoTAlertManagementUris": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Set_variable_-_New_or_Closed": {
                            "type": "SetVariable",
                            "inputs": {
                              "name": "MD4IoTAlertStatus",
                              "value": "@triggerBody()?['object']?['properties']?['status']"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@triggerBody()?['object']?['properties']?['status']",
                              "Active"
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Get_IncidentAlertSystemIDs": {
                      "foreach": "@triggerBody()?['object']?['properties']?['Alerts']",
                      "actions": {
                        "Append_To_IncidentAlertIds": {
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "IncidentAlertIds",
                            "value": "'@{items('Get_IncidentAlertSystemIDs')?['properties']?['systemAlertId']}'"
                          }
                        }
                      },
                      "runAfter": {
                        "Extract_incident_status_and_convert_to_MD4IoT_alert_status": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "IncidentAlertIds": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "IncidentAlertIds",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "MD4IoTAlertManagementUris": {
                      "runAfter": {
                        "MD4IoTAlertStatus": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "MD4IoTAlertManagementUris",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "MD4IoTAlertStatus": {
                      "runAfter": {
                        "IncidentAlertIds": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "MD4IoTAlertStatus",
                            "type": "string",
                            "value": "\"\""
                          }
                        ]
                      }
                    },
                    "Parse_Alerts_to_JSON": {
                      "runAfter": {
                        "Run_query_-_GetAlerts": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('Run_query_-_GetAlerts')?['value']",
                        "schema": {
                          "items": {
                            "properties": {
                              "ExtendedProperties": {
                                "type": "string"
                              },
                              "ProviderName": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "ProviderName",
                              "ExtendedProperties"
                            ],
                            "type": "object"
                          },
                          "type": "array"
                        }
                      }
                    },
                    "Run_query_-_GetAlerts": {
                      "runAfter": {
                        "Get_IncidentAlertSystemIDs": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "SecurityAlert\n| where SystemAlertId in(@{join(variables('IncidentAlertIds'), ',')}) \n| summarize arg_max(TimeGenerated, *) by SystemAlertId",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/queryData",
                        "queries": {
                          "resourcegroups": "@triggerBody()?['workspaceInfo']?['ResourceGroupName']",
                          "resourcename": "@triggerBody()?['workspaceInfo']?['WorkspaceName']",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "@triggerBody()?['workspaceInfo']?['SubscriptionId']",
                          "timerange": "Last 365 days"
                        }
                      }
                    },
                    "Send_HTTP_status_update": {
                      "foreach": "@variables('MD4IoTAlertManagementUris')",
                      "actions": {
                        "HTTP": {
                          "type": "Http",
                          "inputs": {
                            "authentication": {
                              "type": "ManagedServiceIdentity"
                            },
                            "body": {
                              "properties": {
                                "status": "@variables('MD4IoTAlertStatus')"
                              }
                            },
                            "method": "PATCH",
                            "uri": "@{items('Send_HTTP_status_update')}"
                          }
                        }
                      },
                      "runAfter": {
                        "Switch_on_first_alert_ProviderName": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Switch_on_first_alert_ProviderName": {
                      "runAfter": {
                        "Parse_Alerts_to_JSON": [
                          "Succeeded"
                        ]
                      },
                      "cases": {
                        "Case_-_ASI_Scheduled": {
                          "case": "ASI Scheduled Alerts",
                          "actions": {
                            "For_each_ASI_Scheduled_alert": {
                              "foreach": "@body('Parse_Alerts_to_JSON')",
                              "actions": {
                                "Append_to_-_MD4IoTAlertManagementUris": {
                                  "runAfter": {
                                    "Parse_JSON_-_CustomDetails": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "MD4IoTAlertManagementUris",
                                    "value": "@first(body('Parse_JSON_-_CustomDetails')?['AlertManagementUri'])"
                                  }
                                },
                                "Parse_JSON_-_CustomDetails": {
                                  "runAfter": {
                                    "Parse_JSON_-_ExtendedProperties_with_CustomDetails": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@body('Parse_JSON_-_ExtendedProperties_with_CustomDetails')?['Custom Details']",
                                    "schema": {
                                      "properties": {
                                        "AlertManagementUri": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "Parse_JSON_-_ExtendedProperties_with_CustomDetails": {
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@items('For_each_ASI_Scheduled_alert')['ExtendedProperties']",
                                    "schema": {
                                      "properties": {
                                        "Custom Details": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          }
                        },
                        "Case_-_IoTSecurity": {
                          "case": "IoTSecurity",
                          "actions": {
                            "For_each_IoTSecurity_alert": {
                              "foreach": "@body('Parse_Alerts_to_JSON')",
                              "actions": {
                                "Append_to_MD4IoTAlertManagementUris": {
                                  "runAfter": {
                                    "Parse_JSON_-_ExtendedProperties": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "MD4IoTAlertManagementUris",
                                    "value": "@body('Parse_JSON_-_ExtendedProperties')?['AlertManagementUri']"
                                  }
                                },
                                "Parse_JSON_-_ExtendedProperties": {
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@items('For_each_IoTSecurity_alert')['ExtendedProperties']",
                                    "schema": {
                                      "properties": {
                                        "AlertManagementUri": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          }
                        }
                      },
                      "expression": "@first(body('Parse_Alerts_to_JSON'))?['ProviderName']",
                      "type": "Switch"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuremonitorlogs": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorLogsConnectionName'))]",
                        "connectionName": "[[variables('AzureMonitorLogsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "AD4IoT-AutoAlertStatusSync",
            "description": "This playbook updates alert statuses in Defender for IoT whenever a related alert in Microsoft Sentinel has a Status update.",
            "prerequisites": [
              "None"
            ],
            "lastUpdateTime": "2022-08-05T00:00:00Z",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "AD4IoT-AutoAlertStatusSync",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "AD4IoT-SendEmailtoIoTOwner playbook",
        "displayName": "AD4IoT-SendEmailtoIoTOwner playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName5'),'/',variables('playbookVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "AD4IoT-SendEmailtoIoTOwner Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion5')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AD4IoT-SendEmailtoIoTOwner",
              "type": "String"
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "AzureMonitorLogsConnectionName": "[[concat('azuremonitorlogs-', parameters('PlaybookName'))]",
            "Office365V1": "[[concat('Office365Version1-', parameters('PlaybookName'))]",
            "Office365V2": "[[concat('Office365Version2-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/office365')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/office365')]",
            "_connection-4": "[[variables('connection-4')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureMonitorLogsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureMonitorLogsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('Office365V1')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('Office365V1')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('Office365V2')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('Office365V2')]",
                "api": {
                  "id": "[[variables('_connection-4')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorLogsConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('Office365V1'))]",
                "[[resourceId('Microsoft.Web/connections', variables('Office365V2'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      }
                    },
                    "For_each_IOT_Device": {
                      "foreach": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                      "actions": {
                        "Condition_if_IoT_device": {
                          "actions": {
                            "For_each_Alert": {
                              "foreach": "@triggerBody()?['object']?['properties']?['Alerts']",
                              "actions": {
                                "Condition": {
                                  "actions": {
                                    "Check_user_response_-_resolve_incident_if_this_is_expected": {
                                      "actions": {
                                        "Add_comment_to_incident_(V3)": {
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "message": "<p><strong>Incident is going to be auto resolved based by device owner response:</strong><br>\n@{body('Send_incident_validation_email')?['SelectedOption']}<br>\n<br>\n<strong>Submitted by:</strong> @{body('Send_incident_validation_email')?['UserEmailAddress']}<br>\n<br>\nAuto resolve tag is being added</p>"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/Incidents/Comment"
                                          }
                                        },
                                        "Send_false_positive_email": {
                                          "runAfter": {
                                            "Update_incident_as_false_positive": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "Body": "<p>Based on your reply, we have auto resolved your incident: @{body('Update_incident_as_false_positive')?['properties']?['incidentNumber']}<br>\n<br>\nTitle: @{body('Update_incident_as_false_positive')?['properties']?['title']}<br>\n<br>\nLink to the incident: @{triggerBody()?['object']?['properties']?['incidentUrl']}</p>",
                                              "Importance": "Normal",
                                              "Subject": "Your incident - @{triggerBody()?['object']?['properties']?['title']} - has been auto resolved",
                                              "To": "@body('Send_incident_validation_email')?['UserEmailAddress']"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['Office365Version1']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/v2/Mail"
                                          }
                                        },
                                        "Update_incident_as_false_positive": {
                                          "runAfter": {
                                            "Add_comment_to_incident_(V3)": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "classification": {
                                                "ClassificationAndReason": "FalsePositive - InaccurateData",
                                                "ClassificationReasonText": "Auto resolved by user response that this is a false positive"
                                              },
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "status": "Closed",
                                              "tagsToAdd": {
                                                "TagsToAdd": [
                                                  {
                                                    "Tag": "AutoResolved"
                                                  }
                                                ]
                                              }
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                              }
                                            },
                                            "method": "put",
                                            "path": "/Incidents"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Send_incident_validation_email": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Add_comment_to_incident_(V3)_2": {
                                            "type": "ApiConnection",
                                            "inputs": {
                                              "body": {
                                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                                "message": "<p><strong>User has auto confirmed that this is a true positive and is not expected.</strong><br>\n<br>\nUser email address: @{body('Send_incident_validation_email')?['UserEmailAddress']}<br>\nResponse if this is a true positive: @{body('Send_incident_validation_email')?['SelectedOption']}<br>\n<br>\nRaising severity of the incident to high and auto assign the incident</p>"
                                              },
                                              "host": {
                                                "connection": {
                                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                }
                                              },
                                              "method": "post",
                                              "path": "/Incidents/Comment"
                                            }
                                          },
                                          "Send_true_positive_email": {
                                            "runAfter": {
                                              "Update_incident": [
                                                "Succeeded"
                                              ]
                                            },
                                            "type": "ApiConnection",
                                            "inputs": {
                                              "body": {
                                                "Body": "<p>We have flagged incident @{triggerBody()?['object']?['properties']?['title']},<br>\nWith incident number: @{body('Update_incident')?['properties']?['incidentNumber']}<br>\n<br>\nLink to the incident: @{body('Update_incident')?['properties']?['incidentUrl']}<br>\n<br>\nAs a <strong>True Positive</strong> and we will investigation further.</p>",
                                                "Importance": "Normal",
                                                "Subject": "Thank you for confirming a true positive incident",
                                                "To": "@body('Send_incident_validation_email')?['UserEmailAddress']"
                                              },
                                              "host": {
                                                "connection": {
                                                  "name": "@parameters('$connections')['Office365Version2']['connectionId']"
                                                }
                                              },
                                              "method": "post",
                                              "path": "/v2/Mail"
                                            }
                                          },
                                          "Update_incident": {
                                            "runAfter": {
                                              "Add_comment_to_incident_(V3)_2": [
                                                "Succeeded"
                                              ]
                                            },
                                            "type": "ApiConnection",
                                            "inputs": {
                                              "body": {
                                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                                "owner": "@body('Send_incident_validation_email')?['UserEmailAddress']",
                                                "ownerAction": "Assign",
                                                "severity": "High",
                                                "status": "Active",
                                                "tagsToAdd": {
                                                  "TagsToAdd": [
                                                    {
                                                      "Tag": "True Positive  - confirmed by user"
                                                    }
                                                  ]
                                                }
                                              },
                                              "host": {
                                                "connection": {
                                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                }
                                              },
                                              "method": "put",
                                              "path": "/Incidents"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "equals": [
                                              "@body('Send_incident_validation_email')?['SelectedOption']",
                                              "Yes this is expected"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Send_incident_validation_email": {
                                      "runAfter": {
                                        "Set_continueLoop_to_false": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnectionWebhook",
                                      "inputs": {
                                        "body": {
                                          "Message": {
                                            "Body": "We have the following incident where you have been identified as the device owner with the following specifics:\n\nIncident title:  @{triggerBody()?['object']?['properties']?['title']}\n\nIncident description:  @{triggerBody()?['object']?['properties']?['description']}\n\nDeviceName: @{body('Run_query_and_list_results')?['value']?[0]?['deviceName']}\n\nSensorName: @{body('Run_query_and_list_results')?['value']?[0]?['sensorName']}\n\nPlease \"Yes\" if this is expected and therefore a false positive\n\nPlease select \"No\" if this is not expected and therefore a true positive\n\nThanks,\nThe Microsoft Defender for IoT team.\n@{variables('Email')}",
                                            "HideHTMLMessage": true,
                                            "Importance": "Normal",
                                            "Options": "Yes this is expected, No this is NOT expected",
                                            "ShowHTMLConfirmationDialog": false,
                                            "Subject": "Action required: Validate an incident where you are the device owner",
                                            "To": "@{body('Run_query_and_list_results')?['value']?[0]?['IoTowner']}"
                                          },
                                          "NotificationUrl": "@{listCallbackUrl()}"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['Office365Version1']['connectionId']"
                                          }
                                        },
                                        "path": "/approvalmail/$subscriptions"
                                      }
                                    },
                                    "Set_continueLoop_to_false": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "continueLoop",
                                        "value": false
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_Email_variable": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "not": {
                                          "equals": [
                                            "@{body('Run_query_and_list_results')?['value']?[0]?['IoTowner']}",
                                            ""
                                          ]
                                        }
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Run_query_and_list_results": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": "SecurityAlert | summarize arg_max(TimeGenerated, *) by SystemAlertId | where SystemAlertId == \"@{items('For_each_Alert')?['properties']?['systemAlertId']}\" |  mv-expand Entity=parse_json(Entities) | where isnotempty(\"@{body('Parse_JSON')?['deviceName']}\") and Entity.DeviceName ==\"@{body('Parse_JSON')?['deviceName']}\" | extend IoTowner = trim(@'^\\[\"|\"]$', tostring(Entity.Owners[0])) | extend deviceName = \"@{body('Parse_JSON')?['deviceName']}\" | extend sensorName = tostring(Entity.Sensor) | extend siteName = tostring(Entity.Site) | extend zoneName = tostring(Entity.Zone)",
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/queryData",
                                    "queries": {
                                      "resourcegroups": "@triggerBody()?['workspaceInfo']?['ResourceGroupName']",
                                      "resourcename": "@triggerBody()?['workspaceInfo']?['WorkspaceName']",
                                      "resourcetype": "Log Analytics Workspace",
                                      "subscriptions": "@triggerBody()?['workspaceInfo']?['SubscriptionId']",
                                      "timerange": "Last 30 days"
                                    }
                                  }
                                },
                                "Set_Email_variable": {
                                  "runAfter": {
                                    "Run_query_and_list_results": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "email",
                                    "value": "@{body('Run_query_and_list_results')?['value']?[0]?['IoTowner']}"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@items('For_each_IOT_Device')?['kind']",
                                  "IoTDevice"
                                ]
                              },
                              {
                                "equals": [
                                  "@variables('continueLoop')",
                                  true
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Parse_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@{items('For_each_IOT_Device')['properties']}",
                            "schema": {
                              "properties": {
                                "additionalData": {
                                  "properties": {
                                    "DevicePageLink": {
                                      "type": "string"
                                    },
                                    "DeviceSubType": {
                                      "type": "string"
                                    },
                                    "Vendor": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "deviceId": {
                                  "type": "string"
                                },
                                "deviceName": {
                                  "type": "string"
                                },
                                "deviceType": {
                                  "type": "string"
                                },
                                "firmwareVersion": {
                                  "type": "string"
                                },
                                "friendlyName": {
                                  "type": "string"
                                },
                                "iotSecurityAgentId": {
                                  "type": "string"
                                },
                                "model": {
                                  "type": "string"
                                },
                                "operatingSystem": {
                                  "type": "string"
                                },
                                "protocols": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                "serialNumber": {
                                  "type": "string"
                                },
                                "source": {
                                  "type": "string"
                                },
                                "vendor": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_continueLoop_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Initialize_Email_variable": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_continueLoop_variable": {
                      "runAfter": {
                        "Initialize_Email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "continueLoop",
                            "type": "boolean",
                            "value": true
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuremonitorlogs": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorLogsConnectionName'))]",
                        "connectionName": "[[variables('AzureMonitorLogsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "Office365Version1": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('Office365V1'))]",
                        "connectionName": "[[variables('Office365V1')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/office365')]"
                      },
                      "Office365Version2": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('Office365V2'))]",
                        "connectionName": "[[variables('Office365V2')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/office365')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId5'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId5')]",
                "contentId": "[variables('_playbookContentId5')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "AD4IoT-SendEmailtoIoTOwner",
            "description": "The playbooks automate the SOC workflow by automatically emailing the incident details to the right IoT/OT device owner (based on Defender for IoT dafinition) and allowing him to respond by email. The incident is automatically updated based on the email response from the device owner",
            "prerequisites": [
              "None"
            ],
            "lastUpdateTime": "2022-08-14T00:00:00Z",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "AD4IoT-SendEmailtoIoTOwner",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "AD4IoT-AutoTriageIncident playbook",
        "displayName": "AD4IoT-AutoTriageIncident playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName6'),'/',variables('playbookVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "AD4IoT-AutoTriageIncident Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion6')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AD4IoT-AutoTriageIncident",
              "type": "String"
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "AzureMonitorLogsConnectionName": "[[concat('azuremonitorlogs-', parameters('PlaybookName'))]",
            "AzureSentinel1ConnectionName": "[[concat('azuresentinel1-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureMonitorLogsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureMonitorLogsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinel1ConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinel1ConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorLogsConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinel1ConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel_1']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      }
                    },
                    "For_each_IoT_Device": {
                      "foreach": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                      "actions": {
                        "Condition_if_IoT_Device": {
                          "actions": {
                            "For_each_Alert": {
                              "foreach": "@triggerBody()?['object']?['properties']?['Alerts']",
                              "actions": {
                                "If_High_Importance_Device_exists": {
                                  "actions": {
                                    "Add_comment_to_incident_(V3)": {
                                      "runAfter": {
                                        "Update_incident": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "body": {
                                          "incidentArmId": "@body('Update_incident')?['id']",
                                          "message": "<p>As a result of detecting a high-priority IoT device, the incident will be automatically triaged as High<br>\n<br>\nDevice Name: @{variables('HighImportanceDevice')}<br>\nSensor Name:@{body('Run_query_and_list_results')?['value']?[0]?['sensorName']}</p>"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['azuresentinel_1']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/Incidents/Comment"
                                      }
                                    },
                                    "Finalize_loop": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "continuteLoop",
                                        "value": false
                                      }
                                    },
                                    "Update_incident": {
                                      "runAfter": {
                                        "Finalize_loop": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "body": {
                                          "incidentArmId": "@triggerBody()?['object']?['id']",
                                          "owner": "@triggerBody()?['object']?['properties']?['owner']?['objectId']",
                                          "severity": "High",
                                          "status": "Active",
                                          "tagsToAdd": {
                                            "TagsToAdd": [
                                              {
                                                "Tag": "High Importance Device Auto Update"
                                              }
                                            ]
                                          }
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['azuresentinel_1']['connectionId']"
                                          }
                                        },
                                        "method": "put",
                                        "path": "/Incidents"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_HighImportanceDevice_variable": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "not": {
                                          "equals": [
                                            "@variables('HighImportanceDevice')",
                                            ""
                                          ]
                                        }
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Run_query_and_list_results": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": "SecurityAlert | summarize arg_max(TimeGenerated, *) by SystemAlertId | where SystemAlertId == \"@{items('For_each_Alert')?['properties']?['systemAlertId']}\" |  mv-expand Entity=parse_json(Entities) | where isnotempty(\"@{body('Parse_JSON')?['deviceName']}\") and Entity.DeviceName ==\"@{body('Parse_JSON')?['deviceName']}\" | extend IoTowner = trim(@'^\\[\"|\"]$', tostring(Entity.Owners[0])) | extend deviceName = \"@{body('Parse_JSON')?['deviceName']}\" | extend sensorName = tostring(Entity.Sensor) | extend siteName = tostring(Entity.Site) | extend zoneName = tostring(Entity.Zone)",
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/queryData",
                                    "queries": {
                                      "resourcegroups": "@triggerBody()?['workspaceInfo']?['ResourceGroupName']",
                                      "resourcename": "@triggerBody()?['workspaceInfo']?['WorkspaceName']",
                                      "resourcetype": "Log Analytics Workspace",
                                      "subscriptions": "@triggerBody()?['workspaceInfo']?['SubscriptionId']",
                                      "timerange": "Last 30 days"
                                    }
                                  }
                                },
                                "Set_HighImportanceDevice_variable": {
                                  "runAfter": {
                                    "Run_query_and_list_results": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "HighImportanceDevice",
                                    "value": "@{body('Run_query_and_list_results')?['value']?[0]?['deviceName']}"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@items('For_each_IOT_Device')?['kind']",
                                  "IoTDevice"
                                ]
                              },
                              {
                                "equals": [
                                  "@variables('continuteLoop')",
                                  true
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Parse_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each_IOT_Device')['properties']",
                            "schema": {
                              "properties": {
                                "additionalData": {
                                  "properties": {
                                    "DevicePageLink": {
                                      "type": "string"
                                    },
                                    "DeviceSubType": {
                                      "type": "string"
                                    },
                                    "Vendor": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "deviceId": {
                                  "type": "string"
                                },
                                "deviceName": {
                                  "type": "string"
                                },
                                "deviceType": {
                                  "type": "string"
                                },
                                "firmwareVersion": {
                                  "type": "string"
                                },
                                "friendlyName": {
                                  "type": "string"
                                },
                                "iotSecurityAgentId": {
                                  "type": "string"
                                },
                                "model": {
                                  "type": "string"
                                },
                                "operatingSystem": {
                                  "type": "string"
                                },
                                "protocols": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                "serialNumber": {
                                  "type": "string"
                                },
                                "source": {
                                  "type": "string"
                                },
                                "vendor": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_continuteLoop_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Initialize_HighImportanceDevice_variable": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "HighImportanceDevice",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_continuteLoop_variable": {
                      "runAfter": {
                        "Initialize_HighImportanceDevice_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "continuteLoop",
                            "type": "boolean",
                            "value": true
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuremonitorlogs": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorLogsConnectionName'))]",
                        "connectionName": "[[variables('AzureMonitorLogsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        },
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "azuresentinel_1": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinel1ConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinel1ConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId6'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId6')]",
                "contentId": "[variables('_playbookContentId6')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "AD4IoT-AutoTriageIncident",
            "description": "SOC and OT engineers can stream their workflows using the playbook, which automatically updates the incident severity based on the devices involved in the incident and their importance.",
            "prerequisites": [
              "None"
            ],
            "lastUpdateTime": "2022-08-14T00:00:00Z",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "AD4IoT-AutoTriageIncident",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "AD4IoT-CVEAutoWorkflow playbook",
        "displayName": "AD4IoT-CVEAutoWorkflow playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName7'),'/',variables('playbookVersion7'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName7'))]"
      ],
      "properties": {
        "description": "AD4IoT-CVEAutoWorkflow Playbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion7')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AD4IoT-CVEAutoWorkflow",
              "type": "String"
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "AzureMonitorLogsConnectionName": "[[concat('azuremonitorlogs-', parameters('PlaybookName'))]",
            "azure": "[[concat('https://management','.azure','.com')]",
            "Office365V1": "[[concat('office365_1-', parameters('PlaybookName'))]",
            "AzureSentinel1": "[[concat('azuresentinel_1-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/office365')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-4": "[[variables('connection-4')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureMonitorLogsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureMonitorLogsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('Office365V1')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('Office365V1')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinel1')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinel1')]",
                "api": {
                  "id": "[[variables('_connection-4')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorLogsConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('Office365V1'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinel1'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Entities_-_Get_IPs": {
                      "runAfter": {
                        "Initialize_ARG_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel_1']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      }
                    },
                    "For_each": {
                      "foreach": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                      "actions": {
                        "Condition": {
                          "actions": {
                            "For_each_alert": {
                              "foreach": "@triggerBody()?['object']?['properties']?['Alerts']",
                              "actions": {
                                "HTTP": {
                                  "runAfter": {
                                    "Set_email_variable": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Http",
                                  "inputs": {
                                    "authentication": {
                                      "type": "ManagedServiceIdentity"
                                    },
                                    "body": {
                                      "query": "iotsecurityresources  | where type==\"microsoft.iotsecurity/locations/devicegroups/vulnerabilities\" | extend DeviceID = tostring(properties.deviceId) | join  (iotsecurityresources | where type=='microsoft.iotsecurity/locations/devicegroups/devices' | extend DeviceName = tostring(properties.deviceName) | where DeviceName == \"@{body('Run_query_and_list_results')?['value']?[0]?['deviceName']}\"  and \"@{body('Run_query_and_list_results')?['value']?[0]?['sensorName']}\" contains tostring(properties.sensor.name) | project DeviceSiteName=tostring(properties.sensor.site), name, DeviceName) on $left.DeviceID == $right.name | project DeviceID, DeviceName, CVE=tostring(properties.vulnerabilityId), Severity=tostring(properties.severityScore),CVEDescription=tostring(properties.description)"
                                    },
                                    "method": "POST",
                                    "uri": "@variables('ARGEndPoint')"
                                  }
                                },
                                "Run_query_and_list_results": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": "SecurityAlert | summarize arg_max(TimeGenerated, *) by SystemAlertId | where SystemAlertId == \"@{items('For_each_alert')?['properties']?['systemAlertId']}\" | mv-expand Entity=parse_json(Entities) | where isnotempty(\"@{body('Parse_JSON')?['deviceName']}\") and Entity.DeviceName ==\"@{body('Parse_JSON')?['deviceName']}\" | extend IoTowner = trim(@'^\\[\"|\"]$', tostring(Entity.Owners[0])) | extend deviceName = \"@{body('Parse_JSON')?['deviceName']}\" | extend sensorName = tostring(Entity.Sensor) | extend siteName = tostring(Entity.Site) | extend zoneName = tostring(Entity.Zone)",
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/queryData",
                                    "queries": {
                                      "resourcegroups": "@triggerBody()?['workspaceInfo']?['ResourceGroupName']",
                                      "resourcename": "@triggerBody()?['workspaceInfo']?['WorkspaceName']",
                                      "resourcetype": "Log Analytics Workspace",
                                      "subscriptions": "@triggerBody()?['workspaceInfo']?['SubscriptionId']",
                                      "timerange": "Last 30 days"
                                    }
                                  }
                                },
                                "Set_email_variable": {
                                  "runAfter": {
                                    "Run_query_and_list_results": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "Email",
                                    "value": "@{body('Run_query_and_list_results')?['value']?[0]?['IoTowner']}"
                                  }
                                },
                                "Validate_ARG_response_is_not_empty": {
                                  "actions": {
                                    "Finalize_Loop": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "ContinueLoop",
                                        "value": false
                                      }
                                    },
                                    "For_each_CVE": {
                                      "foreach": "@body('HTTP')?['data']",
                                      "actions": {
                                        "Add_comment_to_incident_(V3)": {
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "message": "<p><span style=\"font-size: 16px\"><strong>There are active CVEs on the device involved in this incident<br>\n</strong></span>Affected Device: @{items('For_each_CVE')['DeviceName']}<br>\nCVE Name: @{items('For_each_CVE')['CVE']}<br>\nCVE Description:@{items('For_each_CVE')['CVEDescription']}<br>\nCVE Severity:@{items('For_each_CVE')['Severity']}</p>"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel_1']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/Incidents/Comment"
                                          }
                                        },
                                        "If_CVE_is_Critical": {
                                          "actions": {
                                            "If_IoT_Owner_Email_is_valid": {
                                              "actions": {
                                                "Send_an_email_(V2)": {
                                                  "type": "ApiConnection",
                                                  "inputs": {
                                                    "body": {
                                                      "Body": "<p><strong>In this incident, you have been identified as the device owner with the following specifics and </strong><span style=\"font-size: 18px\"><u><strong>Critical CVE</strong></u></span><span style=\"font-size: 14px\"><strong>:</strong></span><strong><br>\n</strong><br>\n<strong>Incident Details:</strong><br>\n<u>Incident Id</u>: @{body('Update_incident')?['properties']?['incidentNumber']}<br>\n<u>Incident Title:</u> &nbsp;@{triggerBody()?['object']?['properties']?['title']}<br>\n<u>Incident Description</u>: &nbsp;@{triggerBody()?['object']?['properties']?['description']}<br>\n<u>Incident Link</u>: <a href=\"@{body('Update_incident')?['properties']?['incidentUrl']}\">Click Here</a> <br>\n<br>\n<strong>Device Details:</strong><br>\n<u>Device Name:</u> &nbsp;&nbsp;@{body('Run_query_and_list_results')?['value']?[0]?['deviceName']}<br>\n<u>Location (Site | Zone)</u>: @{body('Run_query_and_list_results')?['value']?[0]?['siteName']} | @{body('Run_query_and_list_results')?['value']?[0]?['zoneName']}<br>\n<u>Sensor Name:</u> @{body('Run_query_and_list_results')?['value']?[0]?['sensorName']}<br>\n<br>\n<strong>CVE Details:</strong><br>\n<u>CVE Name:</u> @{items('For_each_CVE')['CVE']}<br>\n<u>CVE Description:</u>@{items('For_each_CVE')['CVEDescription']}<br>\n<u>CVE Severity:</u>@{items('For_each_CVE')['Severity']}<br>\n<br>\nThanks,<br>\nThe Microsoft Defender for IoT team.<br>\n@{variables('Email')}</p>",
                                                      "Importance": "Normal",
                                                      "Subject": "Action required: Validate an incident with critical CVE",
                                                      "To": "@{body('Run_query_and_list_results')?['value']?[0]?['IoTowner']}"
                                                    },
                                                    "host": {
                                                      "connection": {
                                                        "name": "@parameters('$connections')['office365_1']['connectionId']"
                                                      }
                                                    },
                                                    "method": "post",
                                                    "path": "/v2/Mail"
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "Update_incident": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "expression": {
                                                "and": [
                                                  {
                                                    "not": {
                                                      "equals": [
                                                        "@{body('Run_query_and_list_results')?['value']?[0]?['IoTowner']}",
                                                        ""
                                                      ]
                                                    }
                                                  }
                                                ]
                                              },
                                              "type": "If"
                                            },
                                            "Update_incident": {
                                              "type": "ApiConnection",
                                              "inputs": {
                                                "body": {
                                                  "incidentArmId": "@triggerBody()?['object']?['id']",
                                                  "severity": "High",
                                                  "status": "New",
                                                  "tagsToAdd": {
                                                    "TagsToAdd": [
                                                      {
                                                        "Tag": "AutoTriageCVE"
                                                      }
                                                    ]
                                                  }
                                                },
                                                "host": {
                                                  "connection": {
                                                    "name": "@parameters('$connections')['azuresentinel_1']['connectionId']"
                                                  }
                                                },
                                                "method": "put",
                                                "path": "/Incidents"
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Add_comment_to_incident_(V3)": [
                                              "Succeeded"
                                            ]
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "equals": [
                                                  "@items('For_each_CVE').Severity",
                                                  "Critical"
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "runAfter": {
                                        "Finalize_Loop": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    }
                                  },
                                  "runAfter": {
                                    "HTTP": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "not": {
                                          "equals": [
                                            "@body('HTTP')?['TotalRecords']",
                                            0
                                          ]
                                        }
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@variables('ContinueLoop')",
                                  true
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Parse_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@{items('For_each')['properties']}",
                            "schema": {
                              "properties": {
                                "additionalData": {
                                  "properties": {
                                    "DevicePageLink": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "deviceId": {
                                  "type": "string"
                                },
                                "deviceName": {
                                  "type": "string"
                                },
                                "deviceType": {
                                  "type": "string"
                                },
                                "firmwareVersion": {
                                  "type": "string"
                                },
                                "friendlyName": {
                                  "type": "string"
                                },
                                "iotSecurityAgentId": {
                                  "type": "string"
                                },
                                "model": {
                                  "type": "string"
                                },
                                "operatingSystem": {
                                  "type": "string"
                                },
                                "protocols": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                "source": {
                                  "type": "string"
                                },
                                "vendor": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Initialize_ARG_variable": {
                      "runAfter": {
                        "Initialize_Email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ARGEndPoint",
                            "type": "string",
                            "value": "[[uri(variables('azure'),'providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01')]"
                          }
                        ]
                      }
                    },
                    "Initialize_ContinueLoop": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ContinueLoop",
                            "type": "boolean",
                            "value": true
                          }
                        ]
                      }
                    },
                    "Initialize_Email_variable": {
                      "runAfter": {
                        "Initialize_ContinueLoop": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Email",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuremonitorlogs": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorLogsConnectionName'))]",
                        "connectionName": "[[variables('AzureMonitorLogsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        },
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "azuresentinel_1": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinel1'))]",
                        "connectionName": "[[variables('AzureSentinel1')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "office365_1": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('Office365V1'))]",
                        "connectionName": "[[variables('Office365V1')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/office365')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId7'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId7')]",
                "contentId": "[variables('_playbookContentId7')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "AD4IoT-CVEAutoWorkflow",
            "description": "The playbook automates the SOC workflow by automatically enriching incident comments with the CVEs of the involved devices based on Defender for IoT data. An automated triage is performed if the CVE is critical, and the asset owner is automatically notified by email.",
            "prerequisites": [
              "None"
            ],
            "lastUpdateTime": "2022-08-29T00:00:00Z",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "AD4IoT-CVEAutoWorkflow",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT data connector with template",
        "displayName": "IoTOTThreatMonitoringwithDefenderforIoT template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "IoTOTThreatMonitoringwithDefenderforIoT data connector with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "StaticUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Microsoft Defender for IoT",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": "Gain insights into your IoT security by connecting Microsoft Defender for IoT alerts to Microsoft Sentinel.\nYou can get out-of-the-box alert metrics and data, including alert trends, top alerts, and alert breakdown by severity.\nYou can also get information about the recommendations provided for your IoT hubs including top recommendations and recommendations by severity. For more information, see the [Microsoft Sentinel documentation](https://go.microsoft.com/fwlink/p/?linkid=2224002&wt.mc_id=sentinel_dataconnectordocs_content_cnl_csasci).",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "SecurityAlerts",
                      "baseQuery": "SecurityAlert | where ProductName == \"Azure Security Center for IoT\""
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "SentinelKinds",
                      "value": [
                        "IOT"
                      ]
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "SecurityAlert (ASC for IoT)",
                      "lastDataReceivedQuery": "SecurityAlert | where ProductName == \"Azure Security Center for IoT\"\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "IoTOTThreatMonitoringwithDefenderforIoT",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "IoTOTThreatMonitoringwithDefenderforIoT",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "StaticUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Microsoft Defender for IoT",
          "publisher": "Microsoft",
          "descriptionMarkdown": "Gain insights into your IoT security by connecting Microsoft Defender for IoT alerts to Microsoft Sentinel.\nYou can get out-of-the-box alert metrics and data, including alert trends, top alerts, and alert breakdown by severity.\nYou can also get information about the recommendations provided for your IoT hubs including top recommendations and recommendations by severity. For more information, see the [Microsoft Sentinel documentation](https://go.microsoft.com/fwlink/p/?linkid=2224002&wt.mc_id=sentinel_dataconnectordocs_content_cnl_csasci).",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "SecurityAlerts",
              "baseQuery": "SecurityAlert | where ProductName == \"Azure Security Center for IoT\""
            }
          ],
          "dataTypes": [
            {
              "name": "SecurityAlert (ASC for IoT)",
              "lastDataReceivedQuery": "SecurityAlert | where ProductName == \"Azure Security Center for IoT\"\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "SentinelKinds",
              "value": [
                "IOT"
              ]
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.2",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "IoTOTThreatMonitoringwithDefenderforIoT",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId3')]",
              "version": "[variables('analyticRuleVersion3')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId4')]",
              "version": "[variables('analyticRuleVersion4')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId5')]",
              "version": "[variables('analyticRuleVersion5')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId6')]",
              "version": "[variables('analyticRuleVersion6')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId7')]",
              "version": "[variables('analyticRuleVersion7')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId8')]",
              "version": "[variables('analyticRuleVersion8')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId9')]",
              "version": "[variables('analyticRuleVersion9')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId10')]",
              "version": "[variables('analyticRuleVersion10')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId11')]",
              "version": "[variables('analyticRuleVersion11')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId12')]",
              "version": "[variables('analyticRuleVersion12')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId13')]",
              "version": "[variables('analyticRuleVersion13')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId14')]",
              "version": "[variables('analyticRuleVersion14')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId15')]",
              "version": "[variables('analyticRuleVersion15')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_AutoCloseIncidents')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_MailBySensor')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_NewAssetServiceNowTicket')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_AutoAlertStatusSync')]",
              "version": "[variables('playbookVersion4')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_SendEmailToIoTOwner')]",
              "version": "[variables('playbookVersion5')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_AutoTriageIncident')]",
              "version": "[variables('playbookVersion6')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_CVEAutoWorkflow')]",
              "version": "[variables('playbookVersion7')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            }
          ]
        },
        "firstPublishDate": "2021-10-26",
        "providers": [
          "Microsoft"
        ],
        "categories": {
          "domains": [
            "Internet of Things (IoT)",
            "Security - Threat Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
