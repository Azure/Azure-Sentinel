{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for AtlassianJiraAudit"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "AtlassianJiraAudit",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "AtlassianJiraAudit",
    "_solutionVersion": "3.0.4",
    "solutionId": "azuresentinel.azure-sentinel-solution-atlassianjiraaudit",
    "_solutionId": "[variables('solutionId')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "AtlassianJiraAuditWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "5b0cec45-4a91-4f08-bb1b-392427e8f440",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '5b0cec45-4a91-4f08-bb1b-392427e8f440')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('5b0cec45-4a91-4f08-bb1b-392427e8f440')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','5b0cec45-4a91-4f08-bb1b-392427e8f440','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.1",
      "_analyticRulecontentId2": "b894593a-2b4c-4573-bc47-78715224a6f5",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'b894593a-2b4c-4573-bc47-78715224a6f5')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('b894593a-2b4c-4573-bc47-78715224a6f5')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','b894593a-2b4c-4573-bc47-78715224a6f5','-', '1.0.1')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "8c90f30f-c612-407c-91a0-c6a6b41ac199",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '8c90f30f-c612-407c-91a0-c6a6b41ac199')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('8c90f30f-c612-407c-91a0-c6a6b41ac199')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','8c90f30f-c612-407c-91a0-c6a6b41ac199','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "72592618-fa57-45e1-9f01-ca8706a5e3f5",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '72592618-fa57-45e1-9f01-ca8706a5e3f5')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('72592618-fa57-45e1-9f01-ca8706a5e3f5')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','72592618-fa57-45e1-9f01-ca8706a5e3f5','-', '1.0.0')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.1",
      "_analyticRulecontentId5": "6bf42891-b54d-4b4e-8533-babc5b3ea4c5",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6bf42891-b54d-4b4e-8533-babc5b3ea4c5')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6bf42891-b54d-4b4e-8533-babc5b3ea4c5')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6bf42891-b54d-4b4e-8533-babc5b3ea4c5','-', '1.0.1')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.0",
      "_analyticRulecontentId6": "fb6a8001-fe87-4177-a8f3-df2302215c4f",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'fb6a8001-fe87-4177-a8f3-df2302215c4f')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('fb6a8001-fe87-4177-a8f3-df2302215c4f')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','fb6a8001-fe87-4177-a8f3-df2302215c4f','-', '1.0.0')))]"
    },
    "analyticRuleObject7": {
      "analyticRuleVersion7": "1.0.1",
      "_analyticRulecontentId7": "943176e8-b979-45c0-8ad3-58ba6cfd41f0",
      "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '943176e8-b979-45c0-8ad3-58ba6cfd41f0')]",
      "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('943176e8-b979-45c0-8ad3-58ba6cfd41f0')))]",
      "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','943176e8-b979-45c0-8ad3-58ba6cfd41f0','-', '1.0.1')))]"
    },
    "analyticRuleObject8": {
      "analyticRuleVersion8": "1.0.0",
      "_analyticRulecontentId8": "c13ecb19-4317-4d87-9a1c-52660dd44a7d",
      "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'c13ecb19-4317-4d87-9a1c-52660dd44a7d')]",
      "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('c13ecb19-4317-4d87-9a1c-52660dd44a7d')))]",
      "_analyticRulecontentProductId8": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','c13ecb19-4317-4d87-9a1c-52660dd44a7d','-', '1.0.0')))]"
    },
    "analyticRuleObject9": {
      "analyticRuleVersion9": "1.0.0",
      "_analyticRulecontentId9": "5d3af0aa-833e-48ed-a29a-8cfd2705c953",
      "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '5d3af0aa-833e-48ed-a29a-8cfd2705c953')]",
      "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('5d3af0aa-833e-48ed-a29a-8cfd2705c953')))]",
      "_analyticRulecontentProductId9": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','5d3af0aa-833e-48ed-a29a-8cfd2705c953','-', '1.0.0')))]"
    },
    "analyticRuleObject10": {
      "analyticRuleVersion10": "1.0.0",
      "_analyticRulecontentId10": "398aa0ca-45a2-4f79-bc21-ee583bbb63bc",
      "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '398aa0ca-45a2-4f79-bc21-ee583bbb63bc')]",
      "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('398aa0ca-45a2-4f79-bc21-ee583bbb63bc')))]",
      "_analyticRulecontentProductId10": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','398aa0ca-45a2-4f79-bc21-ee583bbb63bc','-', '1.0.0')))]"
    },
    "huntingQueryObject1": {
      "huntingQueryVersion1": "1.0.0",
      "_huntingQuerycontentId1": "3fdc31f0-a166-4a4d-b861-f3cd262fd4a1",
      "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('3fdc31f0-a166-4a4d-b861-f3cd262fd4a1')))]"
    },
    "huntingQueryObject2": {
      "huntingQueryVersion2": "1.0.0",
      "_huntingQuerycontentId2": "aadc0945-a399-47ba-b285-c0c09ee06375",
      "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('aadc0945-a399-47ba-b285-c0c09ee06375')))]"
    },
    "huntingQueryObject3": {
      "huntingQueryVersion3": "1.0.0",
      "_huntingQuerycontentId3": "103ccb8d-f910-4978-aba7-1ad598db822b",
      "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('103ccb8d-f910-4978-aba7-1ad598db822b')))]"
    },
    "huntingQueryObject4": {
      "huntingQueryVersion4": "1.0.0",
      "_huntingQuerycontentId4": "e78cb74b-576b-4e35-a46c-8d328b2d4040",
      "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('e78cb74b-576b-4e35-a46c-8d328b2d4040')))]"
    },
    "huntingQueryObject5": {
      "huntingQueryVersion5": "1.0.0",
      "_huntingQuerycontentId5": "eb409b8b-0267-4e95-b3a9-ee1a72c32409",
      "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('eb409b8b-0267-4e95-b3a9-ee1a72c32409')))]"
    },
    "huntingQueryObject6": {
      "huntingQueryVersion6": "1.0.0",
      "_huntingQuerycontentId6": "d208b406-1509-455c-8c7d-7ffe2f893f24",
      "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('d208b406-1509-455c-8c7d-7ffe2f893f24')))]"
    },
    "huntingQueryObject7": {
      "huntingQueryVersion7": "1.0.0",
      "_huntingQuerycontentId7": "3e6ff26d-05dc-4921-9a60-444a0e28cd45",
      "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('3e6ff26d-05dc-4921-9a60-444a0e28cd45')))]"
    },
    "huntingQueryObject8": {
      "huntingQueryVersion8": "1.0.0",
      "_huntingQuerycontentId8": "d4dd32bb-84a4-4fdc-9118-3039cbabb4f8",
      "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('d4dd32bb-84a4-4fdc-9118-3039cbabb4f8')))]"
    },
    "huntingQueryObject9": {
      "huntingQueryVersion9": "1.0.0",
      "_huntingQuerycontentId9": "2265bbd2-7e97-4d69-bdfc-eeb646730d8f",
      "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('2265bbd2-7e97-4d69-bdfc-eeb646730d8f')))]"
    },
    "huntingQueryObject10": {
      "huntingQueryVersion10": "1.0.0",
      "_huntingQuerycontentId10": "2f875fa8-ced3-4059-b453-616dbc6eb276",
      "huntingQueryTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('2f875fa8-ced3-4059-b453-616dbc6eb276')))]"
    },
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "JiraAuditCCPDefinition",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "JiraAuditCCPDefinitionConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "uiConfigId2": "JiraAuditAPI",
    "_uiConfigId2": "[variables('uiConfigId2')]",
    "dataConnectorContentId2": "JiraAuditAPI",
    "_dataConnectorContentId2": "[variables('dataConnectorContentId2')]",
    "dataConnectorId2": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
    "_dataConnectorId2": "[variables('dataConnectorId2')]",
    "dataConnectorTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId2'))))]",
    "dataConnectorVersion2": "1.0.0",
    "_dataConnectorcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId2'),'-', variables('dataConnectorVersion2'))))]",
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','JiraAudit')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JiraAudit')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('JiraAudit-Parser')))]",
      "parserVersion1": "3.0.0",
      "parserContentId1": "JiraAudit-Parser"
    },
    "Create-Jira-Issue-alert-trigger": "Create-Jira-Issue-alert-trigger",
    "_Create-Jira-Issue-alert-trigger": "[variables('Create-Jira-Issue-alert-trigger')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "Create-Jira-Issue-alert-trigger",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookId1": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId1'))]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId1'))))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "Create-Jira-Issue-incident-trigger": "Create-Jira-Issue-incident-trigger",
    "_Create-Jira-Issue-incident-trigger": "[variables('Create-Jira-Issue-incident-trigger')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "Create-Jira-Issue-incident-trigger",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "Jira-CreateAndUpdateIssue": "Jira-CreateAndUpdateIssue",
    "_Jira-CreateAndUpdateIssue": "[variables('Jira-CreateAndUpdateIssue')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "Jira-CreateAndUpdateIssue",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "Sync-AssignedUser": "Sync-AssignedUser",
    "_Sync-AssignedUser": "[variables('Sync-AssignedUser')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "Sync-AssignedUser",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4'))))]",
    "_playbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId4'),'-', variables('playbookVersion4'))))]",
    "Add-JiraLinkComment": "Add-JiraLinkComment",
    "_Add-JiraLinkComment": "[variables('Add-JiraLinkComment')]",
    "playbookVersion5": "1.0",
    "playbookContentId5": "Add-JiraLinkComment",
    "_playbookContentId5": "[variables('playbookContentId5')]",
    "playbookId5": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId5'))]",
    "playbookTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId5'))))]",
    "_playbookcontentProductId5": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId5'),'-', variables('playbookVersion5'))))]",
    "Sync-CommentsFunctionApp": "Sync-CommentsFunctionApp",
    "_Sync-CommentsFunctionApp": "[variables('Sync-CommentsFunctionApp')]",
    "playbookVersion6": "1.0",
    "playbookContentId6": "Sync-CommentsFunctionApp",
    "_playbookContentId6": "[variables('playbookContentId6')]",
    "playbookTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-fa-',uniquestring(variables('_playbookContentId6'))))]",
    "_playbookcontentProductId6": "[concat(take(variables('_solutionId'),50),'-','fa','-', uniqueString(concat(variables('_solutionId'),'-','AzureFunction','-',variables('_playbookContentId6'),'-', variables('playbookVersion6'))))]",
    "Sync-Incidents": "Sync-Incidents",
    "_Sync-Incidents": "[variables('Sync-Incidents')]",
    "playbookVersion7": "1.0",
    "playbookContentId7": "Sync-Incidents",
    "_playbookContentId7": "[variables('playbookContentId7')]",
    "playbookId7": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId7'))]",
    "playbookTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId7'))))]",
    "_playbookcontentProductId7": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId7'),'-', variables('playbookVersion7'))))]",
    "Sync-Status": "Sync-Status",
    "_Sync-Status": "[variables('Sync-Status')]",
    "playbookVersion8": "1.0",
    "playbookContentId8": "Sync-Status",
    "_playbookContentId8": "[variables('playbookContentId8')]",
    "playbookId8": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId8'))]",
    "playbookTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId8'))))]",
    "_playbookcontentProductId8": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId8'),'-', variables('playbookVersion8'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AtlassianJiraAudit Workbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Sets the time name for analysis"
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"**NOTE**: This data connector depends on a parser based on Kusto Function **JiraAudit** to work as expected. [Follow steps to get this Kusto Function](https://aka.ms/sentinel-jiraauditapi-parser)\"},\"name\":\"text - 8\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"cd8447d9-b096-4673-92d8-2a1e8291a125\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"description\":\"Sets the time name for analysis\",\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\r\\n| make-series TotalEvents = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain};\",\"size\":0,\"title\":\"Events Over Time\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"graphSettings\":{\"type\":0}},\"customWidth\":\"55\",\"name\":\"query - 12\",\"styleSettings\":{\"maxWidth\":\"55\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\r\\n| where isnotempty(EventCategoryType) \\r\\n| summarize count() by EventCategoryType\\r\\n| join kind = inner (JiraAudit \\r\\n                    | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by EventCategoryType) on EventCategoryType\\r\\n| project-away EventCategoryType1, TimeGenerated\\r\\n| project count_, EventCategory = case(EventCategoryType =~ 'user management', 'User Management',\\r\\n                                EventCategoryType =~ 'projects', 'Projects Management',\\r\\n                                EventCategoryType =~ 'group management', 'Group Management',\\r\\n                                EventCategoryType =~ 'workflows', 'Workflow Management',\\r\\n                                EventCategoryType =~ 'permissions', 'Permissions Management',\\r\\n                                EventCategoryType =~ 'status', 'Task Status',\\r\\n                                'Other'), Trend\\r\\n\",\"size\":3,\"title\":\"Event Categories\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"EventCategory\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":21,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false}},\"customWidth\":\"30\",\"name\":\"query - 0\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\r\\n| where EventCategoryType =~ 'projects'\\r\\n| where ObjectItemTypeName =~ 'PROJECT'\\r\\n| summarize dcount(ObjectItemName)\",\"size\":3,\"title\":\"Projects\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"DstPortNumber\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"DstPortNumber\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"DstPortNumber\",\"heatmapPalette\":\"greenRed\"}},\"textSettings\":{\"style\":\"bignumber\"}},\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\r\\n| where EventCategoryType =~ 'workflows'\\r\\n| where ObjectItemTypeName =~ 'WORKFLOW'\\r\\n| summarize dcount(ObjectItemName)\\r\\n\",\"size\":3,\"title\":\"Workflows\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\n| where isnotempty(UserName)\\n| summarize dcount(UserName)\",\"size\":3,\"title\":\"Users\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\n| count\",\"size\":3,\"title\":\"Operations\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"name\":\"query - 3\"}]},\"customWidth\":\"15\",\"name\":\"group - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\r\\n| where isnotempty(EventMessage) \\r\\n| summarize count() by EventMessage\\r\\n\",\"size\":3,\"title\":\"Event types\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"EventMessage\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"27\",\"name\":\"query - 3\",\"styleSettings\":{\"margin\":\"10\",\"padding\":\"10\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"  JiraAudit\\r\\n  | where isnotempty(SrcIpAddr) \\r\\n  | summarize count() by SrcIpAddr\\r\\n  | top 10 by SrcIpAddr\",\"size\":3,\"title\":\"Top sources\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"27\",\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\r\\n| where isnotempty(UserName) \\r\\n| summarize count() by UserName, EventMessage\\r\\n| project User=UserName, Operation=EventMessage, EventCount=count_\\r\\n\",\"size\":0,\"title\":\"User activity\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"46\",\"name\":\"query - 15\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\r\\n| where isnotempty(UserName)\\r\\n| where isnotempty(SrcIpAddr) \\r\\n| summarize IPAddresses = makeset(SrcIpAddr) by UserName\\r\\n\",\"size\":0,\"title\":\"Document types\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"35\",\"name\":\"query - 10\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\r\\n| where EventCategoryType =~ 'projects'\\r\\n| where ObjectItemTypeName =~ 'PROJECT'\\r\\n| summarize count() by ObjectItemName\",\"size\":0,\"title\":\"Top projects\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"55\",\"name\":\"query - 13\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\r\\n| where EventCategoryType =~ 'workflows'\\r\\n| where ObjectItemTypeName =~ 'WORKFLOW'\\r\\n| summarize count() by ObjectItemName\\r\\n\",\"size\":3,\"title\":\"Workflows by activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"rowLimit\":100,\"filter\":true}},\"customWidth\":\"30\",\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\n| where isnotempty(UserName) \\n| summarize count() by UserName\",\"size\":3,\"title\":\"Users' activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"30\",\"name\":\"query - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"JiraAudit\\n| where isnotempty(UserName) \\n| summarize count() by UserName\\n| order by count_\\n| project User=UserName, EventCount=count_\",\"size\":0,\"title\":\"Events by user\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"40\",\"name\":\"query - 12\"}],\"fromTemplateId\":\"sentinel-AtlasianJiraAuditWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=AtlassianJiraAuditWorkbook; logoFileName=atlassian.svg; description=Sets the time name for analysis; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=AtlassianJiraAudit; templateRelativePath=AtlassianJiraAudit.json; subtitle=; provider=Atlassian}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "AtlassianJiraNativePoller_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "AtlassianJira",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraGlobalPermissionAdded_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when global permission added.",
                "displayName": "Jira - Global permission added",
                "enabled": false,
                "query": "JiraAudit\n| where EventMessage =~ 'Global permission added'\n| project EventCreationTime, ObjectItemName, UserName, SrcIpAddr, ChangedValues\n| extend AccountCustomEntity = UserName, IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "JiraAuditAPI",
                    "dataTypes": [
                      "JiraAudit"
                    ]
                  }
                ],
                "tactics": [
                  "PrivilegeEscalation"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jira - Global permission added",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraNewPrivilegedUser_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects new site admin user.",
                "displayName": "Jira - New site admin user",
                "enabled": false,
                "query": "JiraAudit\n| where EventMessage =~ 'User added to group'\n| where ObjectItemName =~ 'site-admins'\n| extend user = todynamic(AssociatedItems)[0]['name']\n| extend AccountCustomEntity = user\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "JiraAuditAPI",
                    "dataTypes": [
                      "JiraAudit"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence",
                  "PrivilegeEscalation"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jira - New site admin user",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraNewUser_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when new user was created.",
                "displayName": "Jira - New user created",
                "enabled": false,
                "query": "JiraAudit\n| where EventMessage =~ 'User created'\n| where ObjectItemTypeName =~ 'USER'\n| project EventCreationTime, UserName, SrcIpAddr, ObjectItemName, AssociatedItems\n| extend AccountCustomEntity = ObjectItemName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "JiraAuditAPI",
                    "dataTypes": [
                      "JiraAudit"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jira - New user created",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraPermissionSchemeUpdated_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when permission scheme was updated.",
                "displayName": "Jira - Permission scheme updated",
                "enabled": false,
                "query": "JiraAudit\n| where EventMessage =~ 'Permission scheme updated'\n| project EventCreationTime, ObjectItemName, UserName, SrcIpAddr, ChangedValues\n| extend AccountCustomEntity = UserName, IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "JiraAuditAPI",
                    "dataTypes": [
                      "JiraAudit"
                    ]
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1531"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jira - Permission scheme updated",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraPrivilegedUserPasswordChanged_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects new site admin user.",
                "displayName": "Jira - New site admin user",
                "enabled": false,
                "query": "let priv_users = JiraAudit\n| where TimeGenerated > ago(14d)\n| where EventMessage =~ 'User added to group'\n| where ObjectItemName =~ 'site-admins'\n| extend user = todynamic(AssociatedItems)[0]['name']\n| summarize makeset(user);\nJiraAudit\n| where EventMessage =~ \"User's password changed\"\n| extend user = todynamic(AssociatedItems)[0]['name']\n| where user in (priv_users)\n| extend AccountCustomEntity = user\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P14D",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "JiraAuditAPI",
                    "dataTypes": [
                      "JiraAudit"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jira - New site admin user",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraProjectRolesChanged_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when project roles were changed.",
                "displayName": "Jira - Project roles changed",
                "enabled": false,
                "query": "JiraAudit\n| where EventMessage =~ 'Project roles changed'\n| project EventCreationTime, ObjectItemName, UserName, SrcIpAddr, AssociatedItems\n| extend AccountCustomEntity = UserName, IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "JiraAuditAPI",
                    "dataTypes": [
                      "JiraAudit"
                    ]
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1531"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jira - Project roles changed",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject7').analyticRuleTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraUserPasswordChange_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject7').analyticRuleVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when user's password was changed multiple times from different IP addresses.",
                "displayName": "Jira - User's password changed multiple times",
                "enabled": false,
                "query": "JiraAudit\n| where EventMessage =~ \"User's password changed\"\n| extend user = todynamic(AssociatedItems)[0]['name']\n| summarize ip_list = makeset(SrcIpAddr) by tostring(user), bin(TimeGenerated, 30m)\n| where array_length(ip_list) > 1\n| extend AccountCustomEntity = user, IPCustomEntity = ip_list\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "JiraAuditAPI",
                    "dataTypes": [
                      "JiraAudit"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject7').analyticRuleId7,'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Analytics Rule 7",
                "parentId": "[variables('analyticRuleObject7').analyticRuleId7]",
                "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject7').analyticRuleVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jira - User's password changed multiple times",
        "contentProductId": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "id": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject8').analyticRuleTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraUserRemovedFromGroup_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject8').analyticRuleVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when a user was removed from group.",
                "displayName": "Jira - User removed from group",
                "enabled": false,
                "query": "JiraAudit\n| where EventMessage =~ 'User removed from group'\n| extend user = todynamic(AssociatedItems)[0]['name']\n| project EventCreationTime, ObjectItemName, user\n| extend AccountCustomEntity = user\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "JiraAuditAPI",
                    "dataTypes": [
                      "JiraAudit"
                    ]
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1531"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject8').analyticRuleId8,'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Analytics Rule 8",
                "parentId": "[variables('analyticRuleObject8').analyticRuleId8]",
                "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject8').analyticRuleVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jira - User removed from group",
        "contentProductId": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "id": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject9').analyticRuleTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraUserRemovedFromProject_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject9').analyticRuleVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when a user was removed from project.",
                "displayName": "Jira - User removed from project",
                "enabled": false,
                "query": "JiraAudit\n| where EventMessage =~ 'User removed from project'\n| extend user = todynamic(AssociatedItems)[0]['name']\n| project EventCreationTime, ObjectItemName, user\n| extend AccountCustomEntity = user\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "JiraAuditAPI",
                    "dataTypes": [
                      "JiraAudit"
                    ]
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1531"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject9').analyticRuleId9,'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Analytics Rule 9",
                "parentId": "[variables('analyticRuleObject9').analyticRuleId9]",
                "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject9').analyticRuleVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jira - User removed from project",
        "contentProductId": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "id": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject10').analyticRuleTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraWorkflowSchemeCopied_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject10').analyticRuleVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when workflow scheme was copied.",
                "displayName": "Jira - Workflow scheme copied",
                "enabled": false,
                "query": "JiraAudit\n| where EventMessage =~ 'Workflow scheme copied'\n| extend workflow = todynamic(AssociatedItems)[0]['name']\n| project EventCreationTime, ObjectItemName, UserName, SrcIpAddr, workflow\n| extend AccountCustomEntity = UserName, IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "JiraAuditAPI",
                    "dataTypes": [
                      "JiraAudit"
                    ]
                  }
                ],
                "tactics": [
                  "Collection"
                ],
                "techniques": [
                  "T1213"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject10').analyticRuleId10,'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Analytics Rule 10",
                "parentId": "[variables('analyticRuleObject10').analyticRuleId10]",
                "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject10').analyticRuleVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
        "contentKind": "AnalyticsRule",
        "displayName": "Jira - Workflow scheme copied",
        "contentProductId": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "id": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject1').huntingQueryTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraBlockedTasks_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject1').huntingQueryVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "AtlassianJiraAudit_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Jira - Blocked tasks",
                "category": "Hunting Queries",
                "query": "JiraAudit\n| where TimeGenerated > ago(24h)\n| where EventMessage in ('Status updated', 'Status created')\n| where ObjectItemTypeName =~ 'STATUS'\n| where ObjectItemName =~ 'Blocked'\n| extend ProcessCustomEntity = ObjectItemName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for blocked tasks."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1499"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1),'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Hunting Query 1",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1)]",
                "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject1').huntingQueryVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
        "contentKind": "HuntingQuery",
        "displayName": "Jira - Blocked tasks",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject2').huntingQueryTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraNewUsers_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject2').huntingQueryVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "AtlassianJiraAudit_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Jira - New users",
                "category": "Hunting Queries",
                "query": "JiraAudit\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'User created'\n| where ObjectItemTypeName =~ 'USER'\n| project EventCreationTime, UserName, SrcIpAddr, ObjectItemName, AssociatedItems\n| extend AccountCustomEntity = ObjectItemName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for new users created."
                  },
                  {
                    "name": "tactics",
                    "value": "Persistence"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2),'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Hunting Query 2",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2)]",
                "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject2').huntingQueryVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
        "contentKind": "HuntingQuery",
        "displayName": "Jira - New users",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject3').huntingQueryTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraProjectVersionsReleased_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject3').huntingQueryVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "AtlassianJiraAudit_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Jira - Project versions released",
                "category": "Hunting Queries",
                "query": "JiraAudit\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'Project version released'\n| project EventCreationTime, UserName, ObjectItemName, AssociatedItems\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for project versions released."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1565"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3),'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Hunting Query 3",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3)]",
                "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject3').huntingQueryVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
        "contentKind": "HuntingQuery",
        "displayName": "Jira - Project versions released",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject4').huntingQueryTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraUpdatedProjectVersions_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject4').huntingQueryVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "AtlassianJiraAudit_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Jira - Project versions",
                "category": "Hunting Queries",
                "query": "JiraAudit\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'Project version created'\n| project EventCreationTime, UserName, SrcIpAddr, ObjectItemName, ChangedValues, AssociatedItems\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for project versions."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1565"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4),'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Hunting Query 4",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4)]",
                "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject4').huntingQueryVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
        "contentKind": "HuntingQuery",
        "displayName": "Jira - Project versions",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject5').huntingQueryTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraUpdatedProjects_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject5').huntingQueryVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "AtlassianJiraAudit_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Jira - Updated projects",
                "category": "Hunting Queries",
                "query": "JiraAudit\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'Project updated'\n| project EventCreationTime, UserName, SrcIpAddr, ObjectItemName, ChangedValues, AssociatedItems\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for updated projects."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1565"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5),'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Hunting Query 5",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5)]",
                "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject5').huntingQueryVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
        "contentKind": "HuntingQuery",
        "displayName": "Jira - Updated projects",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject6').huntingQueryTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraUpdatedUsers_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject6').huntingQueryVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "AtlassianJiraAudit_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Jira - Updated users",
                "category": "Hunting Queries",
                "query": "JiraAudit\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'User updated'\n| project EventCreationTime, ObjectItemName, ChangedValues, AssociatedItems\n| extend AccountCustomEntity = ObjectItemName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for updated users."
                  },
                  {
                    "name": "tactics",
                    "value": "PrivilegeEscalation,Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1531,T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6),'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Hunting Query 6",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6)]",
                "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject6').huntingQueryVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
        "contentKind": "HuntingQuery",
        "displayName": "Jira - Updated users",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject7').huntingQueryTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraUpdatedWorkflowSchemes_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject7').huntingQueryVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "AtlassianJiraAudit_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Jira - Updated workflow schemes",
                "category": "Hunting Queries",
                "query": "JiraAudit\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'Workflow scheme updated'\n| project EventCreationTime, UserName, SrcIpAddr, ObjectItemName\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for updated workflow schemes."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1565"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7),'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Hunting Query 7",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7)]",
                "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject7').huntingQueryVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
        "contentKind": "HuntingQuery",
        "displayName": "Jira - Updated workflow schemes",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject8').huntingQueryTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraUpdatedWorkflows_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject8').huntingQueryVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "AtlassianJiraAudit_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Jira - Updated workflows",
                "category": "Hunting Queries",
                "query": "JiraAudit\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'Workflow updated'\n| project EventCreationTime, UserName, SrcIpAddr, ObjectItemName, ChangedValues\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for updated workflows."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1565"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8),'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Hunting Query 8",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8)]",
                "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject8').huntingQueryVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
        "contentKind": "HuntingQuery",
        "displayName": "Jira - Updated workflows",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject9').huntingQueryTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraUserIPs_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject9').huntingQueryVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "AtlassianJiraAudit_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Jira - Users' IP addresses",
                "category": "Hunting Queries",
                "query": "JiraAudit\n| where TimeGenerated > ago(24h)\n| where isnotempty(SrcIpAddr)\n| where isnotempty(UserName)\n| summarize ip_list = makeset(SrcIpAddr) by UserName\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for users' IP addresses."
                  },
                  {
                    "name": "tactics",
                    "value": "Persistence"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9),'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Hunting Query 9",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9)]",
                "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject9').huntingQueryVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
        "contentKind": "HuntingQuery",
        "displayName": "Jira - Users' IP addresses",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject10').huntingQueryTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraWorkflowAddedToProject_HuntingQueries Hunting Query with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject10').huntingQueryVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "AtlassianJiraAudit_Hunting_Query_10",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Jira - Workflow schemes added to projects",
                "category": "Hunting Queries",
                "query": "JiraAudit\n| where TimeGenerated > ago(24h)\n| where EventMessage =~ 'Workflow scheme added to project'\n| project EventCreationTime, UserName, ObjectItemName, AssociatedItems\n| extend AccountCustomEntity = UserName\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for workflow schemes added to projects."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1565"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject10')._huntingQuerycontentId10),'/'))))]",
              "properties": {
                "description": "AtlassianJiraAudit Hunting Query 10",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject10')._huntingQuerycontentId10)]",
                "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject10').huntingQueryVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
        "contentKind": "HuntingQuery",
        "displayName": "Jira - Workflow schemes added to projects",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject10')._huntingQuerycontentId10,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject10')._huntingQuerycontentId10,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "Atlassian Jira Audit (using REST API)",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "title": "Atlassian Jira Audit (using REST API)",
                  "id": "JiraAuditCCPDefinition",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": "The [Atlassian Jira](https://www.atlassian.com/software/jira) Audit data connector provides the capability to ingest [Jira Audit Records](https://support.atlassian.com/jira-cloud-administration/docs/audit-activities-in-jira-applications/) events into Microsoft Sentinel through the REST API. Refer to [API documentation](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-audit-records/) for more information. The connector provides ability to get events which helps to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems and more.",
                  "graphQueriesTableName": "Jira_Audit_v2_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "Jira Audit Events",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All Atlassian Jira audit logs",
                      "query": "{{graphQueriesTableName}}\n| sort by TimeGenerated desc"
                    },
                    {
                      "description": "Total Events",
                      "query": "{{graphQueriesTableName}}\n | summarize count() by OriginalEventUid"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}|summarize Time = max  (TimeGenerated)\n|where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Atlassian Jira API access",
                        "description": "Permission of [Administer Jira](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#authentication) is required to get access to the Jira Audit logs API. See [Jira API documentation](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-audit-records/#api-group-audit-records) to learn more about the audit API."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "To enable the Atlassian Jira connector for Microsoft Sentinel, click to add an organization, fill the form with the Jira environment credentials and click to Connect. \n Follow [these steps](https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account/) to create an API token.\n ",
                      "instructions": [
                        {
                          "type": "DataConnectorsGrid",
                          "parameters": {
                            "mapping": [
                              {
                                "columnName": "Atlassian Jira organization URL",
                                "columnValue": "properties.request.apiEndpoint"
                              }
                            ],
                            "menuItems": [
                              "DeleteConnector"
                            ]
                          }
                        },
                        {
                          "type": "ContextPane",
                          "parameters": {
                            "isPrimary": true,
                            "label": "Add organization",
                            "title": "Add organization",
                            "subtitle": "Add Atlassian Jira organization",
                            "contextPaneType": "DataConnectorsContextPane",
                            "instructionSteps": [
                              {
                                "instructions": [
                                  {
                                    "type": "Textbox",
                                    "parameters": {
                                      "label": "Atlassian Jira organization URL",
                                      "placeholder": "Atlassian Jira organization URL",
                                      "type": "string",
                                      "name": "jiraorganizationurl"
                                    }
                                  },
                                  {
                                    "type": "Textbox",
                                    "parameters": {
                                      "label": "User Name",
                                      "placeholder": "User Name (e.g., user@example.com)",
                                      "type": "securestring",
                                      "name": "userid"
                                    }
                                  },
                                  {
                                    "type": "Textbox",
                                    "parameters": {
                                      "label": "API Key",
                                      "placeholder": "API Key",
                                      "type": "password",
                                      "name": "apikey"
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "AtlassianJIRADCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-Jira_Audit_v2_CL": {
                    "columns": [
                      {
                        "name": "id",
                        "type": "int"
                      },
                      {
                        "name": "summary",
                        "type": "string"
                      },
                      {
                        "name": "created",
                        "type": "datetime"
                      },
                      {
                        "name": "category",
                        "type": "string"
                      },
                      {
                        "name": "eventSource",
                        "type": "string"
                      },
                      {
                        "name": "objectItem",
                        "type": "dynamic"
                      },
                      {
                        "name": "changedValues",
                        "type": "dynamic"
                      },
                      {
                        "name": "associatedItems",
                        "type": "dynamic"
                      },
                      {
                        "name": "remoteAddress",
                        "type": "string"
                      },
                      {
                        "name": "authorKey",
                        "type": "string"
                      },
                      {
                        "name": "authorAccountId",
                        "type": "string"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-Jira_Audit_v2_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source\n| extend    TimeGenerated = now(),    EventVendor=\"Atlassian\",    EventProduct=\"Jira Audit\"\n| project-rename     EventId=id,\n    EventMessage=summary,\n    SrcIpAddr=remoteAddress,\n    UserName=authorKey,\n    UserSid=authorAccountId,\n    EventCreationTime=created,\n    EventSource=eventSource,\n    ChangedValues=changedValues,\n    AssociatedItems=associatedItems,\n    EventCategoryType= category  \n|extend ObjectItemId=objectItem.id,\n    ObjectItemName=objectItem.name,\n    ObjectItemTypeName=objectItem.typeName,\n    ObjectItemParentId=objectItem.parentId,\n    ObjectItemParentName=objectItem.parentName\n | extend ObjectItemId=tostring(ObjectItemId), ObjectItemName=tostring(ObjectItemName), ObjectItemTypeName=tostring(ObjectItemTypeName), ObjectItemParentId=tostring(ObjectItemParentId), ObjectItemParentName=tostring(ObjectItemParentName) ",
                    "outputStream": "Custom-Jira_Audit_v2_CL"
                  }
                ]
              }
            },
            {
              "name": "Jira_Audit_v2_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "Jira_Audit_v2_CL",
                  "columns": [
                    {
                      "name": "AssociatedItems",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "UserSid",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "UserName",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "EventCategoryType",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ChangedValues",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "EventCreationTime",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "EventSource",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "EventId",
                      "type": "int",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "objectItem",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "SrcIpAddr",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "EventMessage",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "EventVendor",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "EventProduct",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ObjectItemId",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ObjectItemName",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ObjectItemTypeName",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ObjectItemParentId",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ObjectItemParentName",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "title": "Atlassian Jira Audit (using REST API)",
          "id": "JiraAuditCCPDefinition",
          "publisher": "Microsoft",
          "descriptionMarkdown": "The [Atlassian Jira](https://www.atlassian.com/software/jira) Audit data connector provides the capability to ingest [Jira Audit Records](https://support.atlassian.com/jira-cloud-administration/docs/audit-activities-in-jira-applications/) events into Microsoft Sentinel through the REST API. Refer to [API documentation](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-audit-records/) for more information. The connector provides ability to get events which helps to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems and more.",
          "graphQueriesTableName": "Jira_Audit_v2_CL",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "Jira Audit Events",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "All Atlassian Jira audit logs",
              "query": "{{graphQueriesTableName}}\n| sort by TimeGenerated desc"
            },
            {
              "description": "Total Events",
              "query": "{{graphQueriesTableName}}\n | summarize count() by OriginalEventUid"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}|summarize Time = max  (TimeGenerated)\n|where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "name": "Atlassian Jira API access",
                "description": "Permission of [Administer Jira](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#authentication) is required to get access to the Jira Audit logs API. See [Jira API documentation](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-audit-records/#api-group-audit-records) to learn more about the audit API."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "To enable the Atlassian Jira connector for Microsoft Sentinel, click to add an organization, fill the form with the Jira environment credentials and click to Connect. \n Follow [these steps](https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account/) to create an API token.\n ",
              "instructions": [
                {
                  "type": "DataConnectorsGrid",
                  "parameters": {
                    "mapping": [
                      {
                        "columnName": "Atlassian Jira organization URL",
                        "columnValue": "properties.request.apiEndpoint"
                      }
                    ],
                    "menuItems": [
                      "DeleteConnector"
                    ]
                  }
                },
                {
                  "type": "ContextPane",
                  "parameters": {
                    "isPrimary": true,
                    "label": "Add organization",
                    "title": "Add organization",
                    "subtitle": "Add Atlassian Jira organization",
                    "contextPaneType": "DataConnectorsContextPane",
                    "instructionSteps": [
                      {
                        "instructions": [
                          {
                            "type": "Textbox",
                            "parameters": {
                              "label": "Atlassian Jira organization URL",
                              "placeholder": "Atlassian Jira organization URL",
                              "type": "string",
                              "name": "jiraorganizationurl"
                            }
                          },
                          {
                            "type": "Textbox",
                            "parameters": {
                              "label": "User Name",
                              "placeholder": "User Name (e.g., user@example.com)",
                              "type": "securestring",
                              "name": "userid"
                            }
                          },
                          {
                            "type": "Textbox",
                            "parameters": {
                              "label": "API Key",
                              "placeholder": "API Key",
                              "type": "password",
                              "name": "apikey"
                            }
                          }
                        ]
                      }
                    ]
                  }
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "Atlassian Jira Audit (using REST API)",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "jiraorganizationurl": {
              "defaultValue": "Enter jiraorganizationurl value",
              "type": "string",
              "minLength": 1
            },
            "connectorDefinitionName": {
              "defaultValue": "Atlassian Jira Audit (using REST API)",
              "type": "string",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "string"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "userid": {
              "defaultValue": "userid",
              "type": "string",
              "minLength": 1
            },
            "apikey": {
              "defaultValue": "apikey",
              "type": "string",
              "minLength": 1
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', 'AtlassianJiraCCPPolling')]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "JiraAuditCCPDefinition",
                "dataType": "Jira_Audit_v2_CL",
                "dcrConfig": {
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]",
                  "streamName": "Custom-Jira_Audit_v2_CL"
                },
                "auth": {
                  "type": "Basic",
                  "UserName": "[[parameters('userid')]",
                  "Password": "[[parameters('apikey')]"
                },
                "request": {
                  "apiEndpoint": "[[concat('https://', parameters('jiraorganizationurl'), '/rest/api/3/auditing/record')]",
                  "httpMethod": "GET",
                  "retryCount": 3,
                  "timeoutInSeconds": 60,
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "headers": {
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "startTimeAttributeName": "from",
                  "endTimeAttributeName": "to"
                },
                "paging": {
                  "pagingType": "Offset",
                  "offsetParaName": "offset",
                  "pageSizeParaName": "limit",
                  "pageSize": 1000
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.records"
                  ],
                  "format": "json"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AtlassianJiraAudit data connector with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId2')]",
                  "title": "Atlassian Jira Audit (using Azure Functions)",
                  "publisher": "Atlassian",
                  "descriptionMarkdown": "The [Atlassian Jira](https://www.atlassian.com/software/jira) Audit data connector provides the capability to ingest [Jira Audit Records](https://support.atlassian.com/jira-cloud-administration/docs/audit-activities-in-jira-applications/) events into Microsoft Sentinel through the REST API. Refer to [API documentation](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-audit-records/) for more information. The connector provides ability to get events which helps to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems and more.",
                  "additionalRequirementBanner": "These queries and workbooks are dependent on a parser based on Kusto to work as expected. Follow the steps to use this Kusto functions alias **JiraAudit** in queries and workbooks [Follow steps to get this Kusto functions>](https://aka.ms/sentinel-jiraauditapi-parser).",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "Jira_Audit_CL",
                      "baseQuery": "Jira_Audit_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Jira Audit Events - All Activities",
                      "query": "JiraAudit\n | sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "Jira_Audit_CL",
                      "lastDataReceivedQuery": "Jira_Audit_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Jira_Audit_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "REST API Credentials/permissions",
                        "description": "**JiraAccessToken**, **JiraUsername** is required for REST API. [See the documentation to learn more about API](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-audit-records/). Check all [requirements and follow  the instructions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#authentication) for obtaining credentials."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This connector uses Azure Functions to connect to the Jira REST API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                    },
                    {
                      "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                    },
                    {
                      "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected. [Follow these steps](https://aka.ms/sentinel-jiraauditapi-parser) to create the Kusto functions alias, **JiraAudit**"
                    },
                    {
                      "description": "**STEP 1 - Configuration steps for the Jira API**\n\n [Follow the instructions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#authentication) to obtain the credentials. \n"
                    },
                    {
                      "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Workspace data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following).",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Primary Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "description": "Use this method for automated deployment of the Jira Audit data connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentineljiraauditazuredeploy) [![Deploy to Azure Gov](https://aka.ms/deploytoazuregovbutton)](https://aka.ms/sentineljiraauditazuredeploy-gov)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n> **NOTE:** Within the same resource group, you can't mix Windows and Linux apps in the same region. Select existing resource group without Windows apps in it or create new resource group.\n3. Enter the **JiraAccessToken**, **JiraUsername**, **JiraHomeSiteName** (short site name part, as example HOMESITENAME from https://community.atlassian.com) and deploy. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
                      "title": "Option 1 - Azure Resource Manager (ARM) Template"
                    },
                    {
                      "description": "Use the following step-by-step instructions to deploy the Jira Audit data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                      "title": "Option 2 - Manual Deployment of Azure Functions"
                    },
                    {
                      "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/functions-create-first-function-python#prerequisites) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-jiraauditapi-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. JiraAuditXXXXX).\n\n\te. **Select a runtime:** Choose Python 3.11.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
                    },
                    {
                      "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select ** New application setting**.\n3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tJiraUsername\n\t\tJiraAccessToken\n\t\tJiraHomeSiteName\n\t\tWorkspaceID\n\t\tWorkspaceKey\n\t\tlogAnalyticsUri (optional)\n> - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`.\n3. Once all application settings have been entered, click **Save**."
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
                "contentId": "[variables('_dataConnectorContentId2')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "contentKind": "DataConnector",
        "displayName": "Atlassian Jira Audit (using Azure Functions)",
        "contentProductId": "[variables('_dataConnectorcontentProductId2')]",
        "id": "[variables('_dataConnectorcontentProductId2')]",
        "version": "[variables('dataConnectorVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId2')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion2')]",
        "source": {
          "kind": "Solution",
          "name": "AtlassianJiraAudit",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Atlassian Jira Audit (using Azure Functions)",
          "publisher": "Atlassian",
          "descriptionMarkdown": "The [Atlassian Jira](https://www.atlassian.com/software/jira) Audit data connector provides the capability to ingest [Jira Audit Records](https://support.atlassian.com/jira-cloud-administration/docs/audit-activities-in-jira-applications/) events into Microsoft Sentinel through the REST API. Refer to [API documentation](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-audit-records/) for more information. The connector provides ability to get events which helps to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems and more.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "Jira_Audit_CL",
              "baseQuery": "Jira_Audit_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "Jira_Audit_CL",
              "lastDataReceivedQuery": "Jira_Audit_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "Jira_Audit_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Jira Audit Events - All Activities",
              "query": "JiraAudit\n | sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "REST API Credentials/permissions",
                "description": "**JiraAccessToken**, **JiraUsername** is required for REST API. [See the documentation to learn more about API](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-audit-records/). Check all [requirements and follow  the instructions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#authentication) for obtaining credentials."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This connector uses Azure Functions to connect to the Jira REST API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
            },
            {
              "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
            },
            {
              "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected. [Follow these steps](https://aka.ms/sentinel-jiraauditapi-parser) to create the Kusto functions alias, **JiraAudit**"
            },
            {
              "description": "**STEP 1 - Configuration steps for the Jira API**\n\n [Follow the instructions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#authentication) to obtain the credentials. \n"
            },
            {
              "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Workspace data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following).",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Primary Key"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "description": "Use this method for automated deployment of the Jira Audit data connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentineljiraauditazuredeploy) [![Deploy to Azure Gov](https://aka.ms/deploytoazuregovbutton)](https://aka.ms/sentineljiraauditazuredeploy-gov)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n> **NOTE:** Within the same resource group, you can't mix Windows and Linux apps in the same region. Select existing resource group without Windows apps in it or create new resource group.\n3. Enter the **JiraAccessToken**, **JiraUsername**, **JiraHomeSiteName** (short site name part, as example HOMESITENAME from https://community.atlassian.com) and deploy. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
              "title": "Option 1 - Azure Resource Manager (ARM) Template"
            },
            {
              "description": "Use the following step-by-step instructions to deploy the Jira Audit data connector manually with Azure Functions (Deployment via Visual Studio Code).",
              "title": "Option 2 - Manual Deployment of Azure Functions"
            },
            {
              "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/functions-create-first-function-python#prerequisites) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-jiraauditapi-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. JiraAuditXXXXX).\n\n\te. **Select a runtime:** Choose Python 3.11.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
            },
            {
              "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select ** New application setting**.\n3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tJiraUsername\n\t\tJiraAccessToken\n\t\tJiraHomeSiteName\n\t\tWorkspaceID\n\t\tWorkspaceKey\n\t\tlogAnalyticsUri (optional)\n> - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`.\n3. Once all application settings have been entered, click **Save**."
            }
          ],
          "id": "[variables('_uiConfigId2')]",
          "additionalRequirementBanner": "These queries and workbooks are dependent on a parser based on Kusto to work as expected. Follow the steps to use this Kusto functions alias **JiraAudit** in queries and workbooks [Follow steps to get this Kusto functions>](https://aka.ms/sentinel-jiraauditapi-parser)."
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "JiraAudit Data Parser with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for Jira Audit Logs",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "JiraAudit",
                "query": "let Jira_Audit_view = view() {\n Jira_Audit_CL\n| extend \n            EventVendor=\"Atlassian\",\n            EventProduct=\"Jira Audit\",\n            EventId=toint(column_ifexists('id_d', '')),\n            EventMessage=column_ifexists('summary_s', ''),\n            SrcIpAddr=column_ifexists('remoteAddress_s', ''),\n            UserName=column_ifexists('authorKey_s', ''),\n            UserSid=column_ifexists('authorAccountId_s', ''),\n            EventCreationTime=column_ifexists('created_t', ''),\n            EventSource=column_ifexists('eventSource_s', ''),\n            ObjectItemId=column_ifexists('objectItem_id_s', ''),\n            ObjectItemName=column_ifexists('objectItem_name_s', ''),\n            ObjectItemTypeName=column_ifexists('objectItem_typeName_s', ''),\n            ChangedValues=todynamic(column_ifexists('changedValues_s', '')),\n            AssociatedItems=todynamic(column_ifexists('associatedItems_s', '')),\n            ObjectItemParentId=column_ifexists('objectItem_parentId_s', ''),\n            ObjectItemParentName=column_ifexists('objectItem_parentName_s', ''),\n            EventCategoryType=column_ifexists('Category', '')\n    };\nlet Jira_Audit_v2_view=view() {\nJira_Audit_v2_CL\n};\nunion withsource='SourceTable' isfuzzy=true\nJira_Audit_view, Jira_Audit_v2_view\n| project \n            TimeGenerated, \n            EventVendor,\n            EventProduct,\n            EventId,\n            EventMessage,\n            SrcIpAddr,\n            UserName,\n            UserSid,\n            EventCreationTime,\n            EventSource,\n            ObjectItemId,\n            ObjectItemName,\n            ObjectItemTypeName,\n            ChangedValues,\n            AssociatedItems,\n            ObjectItemParentId,\n            ObjectItemParentName,\n            EventCategoryType,\n            SourceTable\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JiraAudit')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "AtlassianJiraAudit",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "Parser for Jira Audit Logs",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '3.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '3.0.0')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for Jira Audit Logs",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "JiraAudit",
        "query": "let Jira_Audit_view = view() {\n Jira_Audit_CL\n| extend \n            EventVendor=\"Atlassian\",\n            EventProduct=\"Jira Audit\",\n            EventId=toint(column_ifexists('id_d', '')),\n            EventMessage=column_ifexists('summary_s', ''),\n            SrcIpAddr=column_ifexists('remoteAddress_s', ''),\n            UserName=column_ifexists('authorKey_s', ''),\n            UserSid=column_ifexists('authorAccountId_s', ''),\n            EventCreationTime=column_ifexists('created_t', ''),\n            EventSource=column_ifexists('eventSource_s', ''),\n            ObjectItemId=column_ifexists('objectItem_id_s', ''),\n            ObjectItemName=column_ifexists('objectItem_name_s', ''),\n            ObjectItemTypeName=column_ifexists('objectItem_typeName_s', ''),\n            ChangedValues=todynamic(column_ifexists('changedValues_s', '')),\n            AssociatedItems=todynamic(column_ifexists('associatedItems_s', '')),\n            ObjectItemParentId=column_ifexists('objectItem_parentId_s', ''),\n            ObjectItemParentName=column_ifexists('objectItem_parentName_s', ''),\n            EventCategoryType=column_ifexists('Category', '')\n    };\nlet Jira_Audit_v2_view=view() {\nJira_Audit_v2_CL\n};\nunion withsource='SourceTable' isfuzzy=true\nJira_Audit_view, Jira_Audit_v2_view\n| project \n            TimeGenerated, \n            EventVendor,\n            EventProduct,\n            EventId,\n            EventMessage,\n            SrcIpAddr,\n            UserName,\n            UserSid,\n            EventCreationTime,\n            EventSource,\n            ObjectItemId,\n            ObjectItemName,\n            ObjectItemTypeName,\n            ChangedValues,\n            AssociatedItems,\n            ObjectItemParentId,\n            ObjectItemParentName,\n            EventCategoryType,\n            SourceTable\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'JiraAudit')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "AtlassianJiraAudit",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CreateJiraIssue Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "CreateJiraIssue",
              "type": "string",
              "metadata": {
                "description": "Alert trigger"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "JiraConnectionName": "[[concat('jira-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/jira')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('jiraConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('jiraConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "CreateJiraIssue-Alert",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('JiraConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_alert": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/subscribe"
                      }
                    }
                  },
                  "actions": {
                    "Alert_-_Get_incident": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/Incidents/subscriptions/@{encodeURIComponent(triggerBody()?['WorkspaceSubscriptionId'])}/resourceGroups/@{encodeURIComponent(triggerBody()?['WorkspaceResourceGroup'])}/workspaces/@{encodeURIComponent(triggerBody()?['WorkspaceId'])}/alerts/@{encodeURIComponent(triggerBody()?['SystemAlertId'])}"
                      }
                    },
                    "Create_a_new_issue": {
                      "runAfter": {
                        "Alert_-_Get_incident": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "fields": {
                            "description": "Incident description: @{body('Alert_-_Get_incident')?['properties']?['description']};\nSeverity: @{body('Alert_-_Get_incident')?['properties']?['severity']};\nIncident URL:  @{body('Alert_-_Get_incident')?['properties']?['incidentUrl']}",
                            "issuetype": {
                              "id": "10007"
                            },
                            "summary": "@body('Alert_-_Get_incident')?['properties']?['title']"
                          }
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['Jira']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/issue",
                        "queries": {
                          "projectKey": "SOC"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "Jira": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('jiraConnectionName'))]",
                        "connectionName": "[[variables('jiraConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/jira')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Create Jira Issue alert-trigger",
            "description": "This playbook will open a Jira Issue when a new incident is opened in Microsoft Sentinel.",
            "prerequisites": "We will need following data to make Jira connector: 1. Jira instance (ex. xyz.atlassian.net); 2. Jira API; 3. Username.; After deployment assign Microsoft Sentinel Reader role to the Playbooks Managed Identity.",
            "lastUpdateTime": "2022-07-20T00:00:00Z",
            "Post-deployment": [
              "Go to Playbook edit mode and fix Jira connection with data from Prerequisite. \n\n When connection is fixed, choose your: \n\n 1. Jira Project (where you want to sync Microsoft Sentinel incidents to) and \n\n 2. Issue Type Id (Microsoft Sentinel incident issue type in Jira - Task, Story, Bug,...)"
            ],
            "tags": [
              "Sync"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Create Jira Issue alert-trigger",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "Playbook",
        "displayName": "CreateJiraIssue",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CreateJiraIssue Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "CreateJiraIssue",
              "type": "string",
              "metadata": {
                "description": "Incident trigger"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "JiraConnectionName": "[[concat('jira-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/jira')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('jiraConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('jiraConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "CreateJiraIssue-Incident",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('JiraConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Create_a_new_issue": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "fields": {
                            "description": "Incident description: @{triggerBody()?['object']?['properties']?['description']};\nSeverity: @{triggerBody()?['object']?['properties']?['severity']};\nIncident URL:  @{triggerBody()?['object']?['properties']?['incidentUrl']}",
                            "issuetype": {
                              "id": "10007"
                            },
                            "summary": "@triggerBody()?['object']?['properties']?['title']"
                          }
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['Jira']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/issue",
                        "queries": {
                          "projectKey": "SOC"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "Jira": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('jiraConnectionName'))]",
                        "connectionName": "[[variables('jiraConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/jira')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Create Jira Issue incident-trigger",
            "description": "This playbook will open a Jira Issue when a new incident is opened in Microsoft Sentinel.",
            "prerequisites": [
              "1. Jira instance (ex. xyz.atlassian.net)",
              "2. Jira API",
              "3. Username."
            ],
            "lastUpdateTime": "2022-07-20T00:00:00Z",
            "Post-deployment": [
              "Go to Playbook edit mode and fix Jira connection with data from Prerequisite. \n\n When connection is fixed, choose your: \n\n 1. Jira Project (where you want to sync Microsoft Sentinel incidents to) and \n\n 2. Issue Type Id (Microsoft Sentinel incident issue type in Jira - Task, Story, Bug,...)"
            ],
            "tags": [
              "Sync"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Create Jira Issue incident-trigger",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "CreateJiraIssue",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Jira-CreateAndUpdateIssue Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Jira-CreateAndUpdateIssue",
              "type": "string"
            }
          },
          "variables": {
            "JiraConnectionName": "[[concat('Jira-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Jira')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['microsoftsentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Condition_-_create_or_update_incident": {
                      "actions": {
                        "Create_a_new_issue": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "fields": {
                                "description": "Incident description: @{triggerBody()?['object']?['properties']?['description']};\nSeverity: @{triggerBody()?['object']?['properties']?['severity']};\nIncident URL:  @{triggerBody()?['object']?['properties']?['incidentUrl']}",
                                "issuetype": {
                                  "id": "10001"
                                },
                                "summary": "@triggerBody()?['object']?['properties']?['title']"
                              }
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['Jira']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/issue",
                            "queries": {
                              "projectKey": "SEN"
                            }
                          }
                        },
                        "Update_incident": {
                          "runAfter": {
                            "Create_a_new_issue": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "tagsToAdd": {
                                "TagsToAdd": [
                                  {
                                    "Tag": "Jira Issue ID: @{body('Create_a_new_issue')?['id']}"
                                  }
                                ]
                              }
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['microsoftsentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_-_status": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "For_each": {
                            "foreach": "@triggerBody()?['object']?['properties']?['labels']",
                            "actions": {
                              "Condition": {
                                "actions": {
                                  "Add_comment": {
                                    "runAfter": {
                                      "Condition_-_status_update": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "ApiConnection",
                                    "inputs": {
                                      "body": {
                                        "body": "Microsoft Sentinel incident is updated:\n\nUpdate fields: @{join(triggerBody()?['incidentUpdates']?['updatedFields'], '; ')}\nUpdate by: @{triggerBody()?['incidentUpdates']?['updatedBy']?['name']}\n\nNew values:\n@{outputs('Compose_alert')}\n@{outputs('Compose_severity')}\n@{outputs('Compose_owner')}\n@{outputs('Compose_status')}\n@{outputs('Compose_tag')}\n@{outputs('Compose_comment')}\n@{outputs('Compose_tactics')}"
                                      },
                                      "host": {
                                        "connection": {
                                          "name": "@parameters('$connections')['Jira']['connectionId']"
                                        }
                                      },
                                      "method": "post",
                                      "path": "/issue/@{encodeURIComponent(variables('Jira ID'))}/comment"
                                    }
                                  },
                                  "Condition_-_alert_updated": {
                                    "actions": {
                                      "Compose_alert": {
                                        "runAfter": {
                                          "For_each_-_new_alert": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "Compose",
                                        "inputs": "Alerts: @{variables('New alert')}"
                                      },
                                      "For_each_-_new_alert": {
                                        "foreach": "@triggerBody()?['incidentUpdates']?['alerts']",
                                        "actions": {
                                          "Append_to_string_variable_-_alert": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "New alert",
                                              "value": "@concat(items('For_each_-_new_alert')?['properties']?['alertDisplayName'], '; ')"
                                            }
                                          }
                                        },
                                        "type": "Foreach"
                                      }
                                    },
                                    "runAfter": {
                                      "Condition_-_comment_updated": [
                                        "Succeeded"
                                      ]
                                    },
                                    "expression": {
                                      "and": [
                                        {
                                          "contains": [
                                            "@triggerBody()?['incidentUpdates']?['updatedFields']",
                                            "Alerts"
                                          ]
                                        }
                                      ]
                                    },
                                    "type": "If"
                                  },
                                  "Condition_-_comment_updated": {
                                    "actions": {
                                      "Compose_comment": {
                                        "runAfter": {
                                          "For_each_-_new_comment": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "Compose",
                                        "inputs": "Comment: @{variables('New comments')}"
                                      },
                                      "For_each_-_new_comment": {
                                        "foreach": "@triggerBody()?['incidentUpdates']?['comments']",
                                        "actions": {
                                          "Append_to_string_variable_-_comment": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "New comments",
                                              "value": "@concat(items('For_each_-_new_comment')?['properties']?['message'], '; ')"
                                            }
                                          }
                                        },
                                        "type": "Foreach"
                                      }
                                    },
                                    "runAfter": {
                                      "Set_variable_-_Jira_ID": [
                                        "Succeeded"
                                      ]
                                    },
                                    "expression": {
                                      "and": [
                                        {
                                          "contains": [
                                            "@triggerBody()?['incidentUpdates']?['updatedFields']",
                                            "Comments"
                                          ]
                                        }
                                      ]
                                    },
                                    "type": "If"
                                  },
                                  "Condition_-_owner_update": {
                                    "actions": {
                                      "Append_to_string_variable_-_owner": {
                                        "type": "AppendToStringVariable",
                                        "inputs": {
                                          "name": "New owner",
                                          "value": "@triggerBody()?['object']?['properties']?['owner']?['assignedTo']"
                                        }
                                      },
                                      "Compose_owner": {
                                        "runAfter": {
                                          "Append_to_string_variable_-_owner": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "Compose",
                                        "inputs": "Owner: @{variables('New owner')}"
                                      }
                                    },
                                    "runAfter": {
                                      "Condition_-_tag_updated": [
                                        "Succeeded"
                                      ]
                                    },
                                    "expression": {
                                      "and": [
                                        {
                                          "contains": [
                                            "@triggerBody()?['incidentUpdates']?['updatedFields']",
                                            "Owner"
                                          ]
                                        }
                                      ]
                                    },
                                    "type": "If"
                                  },
                                  "Condition_-_severity_update": {
                                    "actions": {
                                      "Append_to_string_variable_-_severity": {
                                        "type": "AppendToStringVariable",
                                        "inputs": {
                                          "name": "New severity",
                                          "value": "@triggerBody()?['object']?['properties']?['severity']"
                                        }
                                      },
                                      "Compose_severity": {
                                        "runAfter": {
                                          "Append_to_string_variable_-_severity": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "Compose",
                                        "inputs": "Severity: @{variables('New severity')}"
                                      }
                                    },
                                    "runAfter": {
                                      "Condition_-_owner_update": [
                                        "Succeeded"
                                      ]
                                    },
                                    "expression": {
                                      "and": [
                                        {
                                          "contains": [
                                            "@triggerBody()?['incidentUpdates']?['updatedFields']",
                                            "Severity"
                                          ]
                                        }
                                      ]
                                    },
                                    "type": "If"
                                  },
                                  "Condition_-_status_update": {
                                    "actions": {
                                      "Append_to_string_variable_-_status": {
                                        "type": "AppendToStringVariable",
                                        "inputs": {
                                          "name": "New status",
                                          "value": "@triggerBody()?['object']?['properties']?['status']"
                                        }
                                      },
                                      "Compose_status": {
                                        "runAfter": {
                                          "Append_to_string_variable_-_status": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "Compose",
                                        "inputs": "Status: @{variables('New status')}"
                                      }
                                    },
                                    "runAfter": {
                                      "Condition_-_tactics_update": [
                                        "Succeeded"
                                      ]
                                    },
                                    "expression": {
                                      "and": [
                                        {
                                          "contains": [
                                            "@triggerBody()?['incidentUpdates']?['updatedFields']",
                                            "Status"
                                          ]
                                        }
                                      ]
                                    },
                                    "type": "If"
                                  },
                                  "Condition_-_tactics_update": {
                                    "actions": {
                                      "Compose_tactics": {
                                        "type": "Compose",
                                        "inputs": "Tactics: @{join(triggerBody()?['incidentUpdates']?['tactics'], '; ')}"
                                      }
                                    },
                                    "runAfter": {
                                      "Condition_-_severity_update": [
                                        "Succeeded"
                                      ]
                                    },
                                    "expression": {
                                      "and": [
                                        {
                                          "contains": [
                                            "@triggerBody()?['incidentUpdates']?['updatedFields']",
                                            "Tactics"
                                          ]
                                        }
                                      ]
                                    },
                                    "type": "If"
                                  },
                                  "Condition_-_tag_updated": {
                                    "actions": {
                                      "Compose_tag": {
                                        "runAfter": {
                                          "For_each_-_new_tag": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "Compose",
                                        "inputs": "Tags: @{variables('New tag')}"
                                      },
                                      "For_each_-_new_tag": {
                                        "foreach": "@triggerBody()?['incidentUpdates']?['labels']",
                                        "actions": {
                                          "Append_to_string_variable_-_tag": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "New tag",
                                              "value": "@concat(items('For_each_-_new_tag')?['labelName'], '; ')"
                                            }
                                          }
                                        },
                                        "type": "Foreach"
                                      }
                                    },
                                    "runAfter": {
                                      "Condition_-_alert_updated": [
                                        "Succeeded"
                                      ]
                                    },
                                    "expression": {
                                      "and": [
                                        {
                                          "contains": [
                                            "@triggerBody()?['incidentUpdates']?['updatedFields']",
                                            "Labels"
                                          ]
                                        }
                                      ]
                                    },
                                    "type": "If"
                                  },
                                  "Set_variable_-_Jira_ID": {
                                    "type": "SetVariable",
                                    "inputs": {
                                      "name": "Jira ID",
                                      "value": "@{split(items('For_each')?['labelName'],': ')[1]}"
                                    }
                                  }
                                },
                                "expression": {
                                  "and": [
                                    {
                                      "contains": [
                                        "@items('For_each')?['labelName']",
                                        "Jira"
                                      ]
                                    }
                                  ]
                                },
                                "type": "If"
                              }
                            },
                            "type": "Foreach"
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@triggerBody()?['incidentUpdates']?['updatedFields']",
                              "@null"
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Initialize_variable_-_Jira_ID": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Jira ID",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_alert": {
                      "runAfter": {
                        "Initialize_variable_-_comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "New alert",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_comment": {
                      "runAfter": {
                        "Initialize_variable_-_Jira_ID": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "New comments",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_owner": {
                      "runAfter": {
                        "Initialize_variable_-_tag": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "New owner",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_severity": {
                      "runAfter": {
                        "Initialize_variable_-_owner": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "New severity",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_status": {
                      "runAfter": {
                        "Initialize_variable_-_severity": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "New status",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_tag": {
                      "runAfter": {
                        "Initialize_variable_-_alert": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "New tag",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "Jira": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('JiraConnectionName'))]",
                        "connectionName": "[[variables('JiraConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Jira')]"
                      },
                      "microsoftsentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "CreateAndUpdateJiraIssue",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('JiraConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('JiraConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('JiraConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Create And Update Jira Issue",
            "description": "This playbook will create or update incident in Jira. When incident is created, playbook will run and create issue in Jira. When incident is updated, playbook will run and add update to comment section.",
            "prerequisites": [
              "We will need following data to make Jira connector:",
              "1. Jira instance (ex. xyz.atlassian.net)",
              "2. Jira API (create API token on https://id.atlassian.com/manage-profile/security/api-tokens)",
              "3. User email"
            ],
            "postDeployment": [
              "1. Add Microsoft Sentinel Responder role to the playbook's managed identity.",
              "2. Authorize Jira connection with: Jira instance, API token, user name.",
              "3. Create an automation rules for when incident is created or updated and add this playbook as an action"
            ],
            "lastUpdateTime": "2022-07-20T00:00:00Z",
            "tags": [
              "Sync",
              "Incident Update"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Create And Update Jira Issue",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "Jira-CreateAndUpdateIssue",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Sync-AssignedUser Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Sync-AssignedUser",
              "type": "string"
            },
            "Tenant ID": {
              "type": "String",
              "metadata": {
                "description": "Tenant ID for used service principals"
              }
            },
            "Keyvault Name": {
              "type": "String",
              "metadata": {
                "description": "Name of the Key Vault which stores the client secrets"
              }
            },
            "SecretName AAD SP": {
              "type": "securestring",
              "metadata": {
                "description": "name of the Key Vault Secret that contains the Azure Active Directory SP Client Secret"
              }
            },
            "ClientID AAD SP": {
              "type": "String",
              "metadata": {
                "description": "Client ID for AAD Authentication"
              }
            }
          },
          "variables": {
            "AzureKeyVaultConnectionName": "[[concat('azurekeyvault-', parameters('PlaybookName'))]",
            "SentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/keyvault')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('SentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('PlaybookName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureKeyVaultConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureKeyVaultConnectionName')]",
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('Keyvault Name')]"
                },
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "tags": {
                "hidden-SentinelTemplateName": "SyncJIRAAssignedUser",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureKeyVaultConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('SentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "manual": {
                      "type": "Request",
                      "kind": "Http",
                      "inputs": {
                        "schema": {
                          "properties": {
                            "changelog": {
                              "properties": {
                                "maxResults": {
                                  "type": "integer"
                                },
                                "startAt": {
                                  "type": "integer"
                                },
                                "total": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            },
                            "fields": {
                              "properties": {
                                "aggregateprogress": {
                                  "properties": {
                                    "progress": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "assignee": {
                                  "properties": {
                                    "accountId": {
                                      "type": "string"
                                    },
                                    "accountType": {
                                      "type": "string"
                                    },
                                    "active": {
                                      "type": "boolean"
                                    },
                                    "avatarUrls": {
                                      "properties": {
                                        "16x16": {
                                          "type": "string"
                                        },
                                        "24x24": {
                                          "type": "string"
                                        },
                                        "32x32": {
                                          "type": "string"
                                        },
                                        "48x48": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "timeZone": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "attachment": {
                                  "items": {
                                    "properties": {
                                      "author": {
                                        "properties": {
                                          "accountId": {
                                            "type": "string"
                                          },
                                          "accountType": {
                                            "type": "string"
                                          },
                                          "active": {
                                            "type": "boolean"
                                          },
                                          "avatarUrls": {
                                            "properties": {
                                              "16x16": {
                                                "type": "string"
                                              },
                                              "24x24": {
                                                "type": "string"
                                              },
                                              "32x32": {
                                                "type": "string"
                                              },
                                              "48x48": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "displayName": {
                                            "type": "string"
                                          },
                                          "self": {
                                            "type": "string"
                                          },
                                          "timeZone": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "content": {
                                        "type": "string"
                                      },
                                      "created": {
                                        "type": "integer"
                                      },
                                      "filename": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "mimeType": {
                                        "type": "string"
                                      },
                                      "self": {
                                        "type": "string"
                                      },
                                      "size": {
                                        "type": "integer"
                                      }
                                    },
                                    "required": [
                                      "self",
                                      "id",
                                      "filename",
                                      "author",
                                      "created",
                                      "size",
                                      "mimeType",
                                      "content"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "comment": {
                                  "properties": {
                                    "comments": {
                                      "items": {
                                        "properties": {
                                          "author": {
                                            "properties": {
                                              "accountId": {
                                                "type": "string"
                                              },
                                              "accountType": {
                                                "type": "string"
                                              },
                                              "active": {
                                                "type": "boolean"
                                              },
                                              "avatarUrls": {
                                                "properties": {
                                                  "16x16": {
                                                    "type": "string"
                                                  },
                                                  "24x24": {
                                                    "type": "string"
                                                  },
                                                  "32x32": {
                                                    "type": "string"
                                                  },
                                                  "48x48": {
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "displayName": {
                                                "type": "string"
                                              },
                                              "self": {
                                                "type": "string"
                                              },
                                              "timeZone": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "body": {
                                            "type": "string"
                                          },
                                          "created": {
                                            "type": "integer"
                                          },
                                          "id": {
                                            "type": "integer"
                                          },
                                          "self": {
                                            "type": "string"
                                          },
                                          "updateAuthor": {
                                            "properties": {
                                              "accountId": {
                                                "type": "string"
                                              },
                                              "accountType": {
                                                "type": "string"
                                              },
                                              "active": {
                                                "type": "boolean"
                                              },
                                              "avatarUrls": {
                                                "properties": {
                                                  "16x16": {
                                                    "type": "string"
                                                  },
                                                  "24x24": {
                                                    "type": "string"
                                                  },
                                                  "32x32": {
                                                    "type": "string"
                                                  },
                                                  "48x48": {
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "displayName": {
                                                "type": "string"
                                              },
                                              "self": {
                                                "type": "string"
                                              },
                                              "timeZone": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "updated": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "self",
                                          "id",
                                          "author",
                                          "body",
                                          "renderedBody",
                                          "updateAuthor",
                                          "created",
                                          "updated",
                                          "visibility"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "last": {
                                      "type": "boolean"
                                    },
                                    "maxResults": {
                                      "type": "integer"
                                    },
                                    "startAt": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "components": {
                                  "type": "array"
                                },
                                "created": {
                                  "type": "integer"
                                },
                                "creator": {
                                  "properties": {
                                    "accountId": {
                                      "type": "string"
                                    },
                                    "accountType": {
                                      "type": "string"
                                    },
                                    "active": {
                                      "type": "boolean"
                                    },
                                    "avatarUrls": {
                                      "properties": {
                                        "16x16": {
                                          "type": "string"
                                        },
                                        "24x24": {
                                          "type": "string"
                                        },
                                        "32x32": {
                                          "type": "string"
                                        },
                                        "48x48": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "timeZone": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10000": {
                                  "type": "string"
                                },
                                "customfield_10002": {
                                  "items": {
                                    "properties": {
                                      "_links": {
                                        "properties": {
                                          "self": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "name": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "id",
                                      "name",
                                      "_links"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "customfield_10003": {
                                  "items": {
                                    "properties": {
                                      "accountId": {
                                        "type": "string"
                                      },
                                      "accountType": {
                                        "type": "string"
                                      },
                                      "active": {
                                        "type": "boolean"
                                      },
                                      "avatarUrls": {
                                        "properties": {
                                          "16x16": {
                                            "type": "string"
                                          },
                                          "24x24": {
                                            "type": "string"
                                          },
                                          "32x32": {
                                            "type": "string"
                                          },
                                          "48x48": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "displayName": {
                                        "type": "string"
                                      },
                                      "self": {
                                        "type": "string"
                                      },
                                      "timeZone": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "self",
                                      "accountId",
                                      "avatarUrls",
                                      "displayName",
                                      "active",
                                      "timeZone",
                                      "accountType"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "customfield_10010": {
                                  "properties": {
                                    "_links": {
                                      "properties": {
                                        "agent": {
                                          "type": "string"
                                        },
                                        "jiraRest": {
                                          "type": "string"
                                        },
                                        "self": {
                                          "type": "string"
                                        },
                                        "web": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "currentStatus": {
                                      "properties": {
                                        "status": {
                                          "type": "string"
                                        },
                                        "statusCategory": {
                                          "type": "string"
                                        },
                                        "statusDate": {
                                          "properties": {
                                            "epochMillis": {
                                              "type": "integer"
                                            },
                                            "friendly": {
                                              "type": "string"
                                            },
                                            "iso8601": {
                                              "type": "string"
                                            },
                                            "jira": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "requestType": {
                                      "properties": {
                                        "_expands": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "_links": {
                                          "properties": {
                                            "self": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "description": {
                                          "type": "string"
                                        },
                                        "groupIds": {
                                          "type": "array"
                                        },
                                        "helpText": {
                                          "type": "string"
                                        },
                                        "icon": {
                                          "properties": {
                                            "_links": {
                                              "properties": {
                                                "iconUrls": {
                                                  "properties": {
                                                    "16x16": {
                                                      "type": "string"
                                                    },
                                                    "24x24": {
                                                      "type": "string"
                                                    },
                                                    "32x32": {
                                                      "type": "string"
                                                    },
                                                    "48x48": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "id": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "id": {
                                          "type": "string"
                                        },
                                        "issueTypeId": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        },
                                        "serviceDeskId": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10018": {
                                  "properties": {
                                    "hasEpicLinkFieldDependency": {
                                      "type": "boolean"
                                    },
                                    "nonEditableReason": {
                                      "properties": {
                                        "message": {
                                          "type": "string"
                                        },
                                        "reason": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "showField": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10019": {
                                  "type": "string"
                                },
                                "customfield_10022": {
                                  "type": "string"
                                },
                                "customfield_10024": {
                                  "type": "array"
                                },
                                "customfield_10048": {
                                  "properties": {
                                    "_links": {
                                      "properties": {
                                        "self": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "completedCycles": {
                                      "items": {
                                        "properties": {
                                          "breached": {
                                            "type": "boolean"
                                          },
                                          "elapsedTime": {
                                            "properties": {
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "millis": {
                                                "type": "integer"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "goalDuration": {
                                            "properties": {
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "millis": {
                                                "type": "integer"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "remainingTime": {
                                            "properties": {
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "millis": {
                                                "type": "integer"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "startTime": {
                                            "properties": {
                                              "epochMillis": {
                                                "type": "integer"
                                              },
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "iso8601": {
                                                "type": "string"
                                              },
                                              "jira": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "stopTime": {
                                            "properties": {
                                              "epochMillis": {
                                                "type": "integer"
                                              },
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "iso8601": {
                                                "type": "string"
                                              },
                                              "jira": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          }
                                        },
                                        "required": [
                                          "startTime",
                                          "stopTime",
                                          "breached",
                                          "goalDuration",
                                          "elapsedTime",
                                          "remainingTime"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "id": {
                                      "type": "string"
                                    },
                                    "name": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10051": {
                                  "properties": {
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "languageCode": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10144": {
                                  "type": "string"
                                },
                                "customfield_10145": {
                                  "type": "string"
                                },
                                "customfield_10149": {
                                  "properties": {
                                    "id": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "value": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10154": {
                                  "type": "string"
                                },
                                "customfield_10155": {
                                  "items": {
                                    "properties": {
                                      "id": {
                                        "type": "string"
                                      },
                                      "self": {
                                        "type": "string"
                                      },
                                      "value": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "self",
                                      "value",
                                      "id"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "customfield_10158": {
                                  "type": "string"
                                },
                                "customfield_10162": {
                                  "type": "string"
                                },
                                "customfield_10169": {
                                  "type": "string"
                                },
                                "customfield_10170": {
                                  "type": "string"
                                },
                                "customfield_10171": {
                                  "type": "string"
                                },
                                "customfield_10172": {
                                  "type": "string"
                                },
                                "customfield_10173": {
                                  "type": "string"
                                },
                                "customfield_10175": {
                                  "type": "string"
                                },
                                "description": {
                                  "type": "string"
                                },
                                "fixVersions": {
                                  "type": "array"
                                },
                                "issuelinks": {
                                  "type": "array"
                                },
                                "issuerestriction": {
                                  "properties": {
                                    "issuerestrictions": {
                                      "type": "object"
                                    },
                                    "shouldDisplay": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "issuetype": {
                                  "properties": {
                                    "description": {
                                      "type": "string"
                                    },
                                    "iconUrl": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "namedValue": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "statuses": {
                                      "type": "array"
                                    },
                                    "subtask": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "labels": {
                                  "type": "array"
                                },
                                "priority": {
                                  "properties": {
                                    "iconUrl": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "namedValue": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "progress": {
                                  "properties": {
                                    "progress": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "project": {
                                  "properties": {
                                    "avatarUrls": {
                                      "properties": {
                                        "16x16": {
                                          "type": "string"
                                        },
                                        "24x24": {
                                          "type": "string"
                                        },
                                        "32x32": {
                                          "type": "string"
                                        },
                                        "48x48": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "key": {
                                      "type": "string"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "projectTypeKey": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "simplified": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "reporter": {
                                  "properties": {
                                    "accountId": {
                                      "type": "string"
                                    },
                                    "accountType": {
                                      "type": "string"
                                    },
                                    "active": {
                                      "type": "boolean"
                                    },
                                    "avatarUrls": {
                                      "properties": {
                                        "16x16": {
                                          "type": "string"
                                        },
                                        "24x24": {
                                          "type": "string"
                                        },
                                        "32x32": {
                                          "type": "string"
                                        },
                                        "48x48": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "timeZone": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "status": {
                                  "properties": {
                                    "description": {
                                      "type": "string"
                                    },
                                    "iconUrl": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "statusCategory": {
                                      "properties": {
                                        "colorName": {
                                          "type": "string"
                                        },
                                        "id": {
                                          "type": "integer"
                                        },
                                        "key": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        },
                                        "self": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                },
                                "statuscategorychangedate": {
                                  "type": "string"
                                },
                                "subtasks": {
                                  "type": "array"
                                },
                                "summary": {
                                  "type": "string"
                                },
                                "timetracking": {
                                  "properties": {
                                    "originalEstimateSeconds": {
                                      "type": "integer"
                                    },
                                    "remainingEstimateSeconds": {
                                      "type": "integer"
                                    },
                                    "timeSpentSeconds": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "updated": {
                                  "type": "integer"
                                },
                                "versions": {
                                  "type": "array"
                                },
                                "votes": {
                                  "properties": {
                                    "hasVoted": {
                                      "type": "boolean"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "votes": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "watches": {
                                  "properties": {
                                    "isWatching": {
                                      "type": "boolean"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "watchCount": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "worklog": {
                                  "properties": {
                                    "last": {
                                      "type": "boolean"
                                    },
                                    "maxResults": {
                                      "type": "integer"
                                    },
                                    "startAt": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    },
                                    "worklogs": {
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "workratio": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            },
                            "id": {
                              "type": "integer"
                            },
                            "key": {
                              "type": "string"
                            },
                            "self": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    }
                  },
                  "actions": {
                    "Condition": {
                      "actions": {
                        "Update_incident": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['fields']?['customfield_10175']",
                              "owner": "@{first(body('Parse_JSON')?['value'])?['id']}",
                              "ownerAction": "Assign"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          }
                        }
                      },
                      "runAfter": {
                        "Parse_JSON": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "not": {
                              "equals": [
                                "@length(body('Parse_JSON')?['value'])",
                                0
                              ]
                            }
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Get_secret": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "[[concat('/secrets/@{encodeURIComponent(''', parameters('SecretName AAD SP'), ''')}/value')]"
                      },
                      "runtimeConfiguration": {
                        "secureData": {
                          "properties": [
                            "outputs"
                          ]
                        }
                      }
                    },
                    "HTTP": {
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "type": "Http",
                      "inputs": {
                        "authentication": {
                          "audience": "https://graph.microsoft.com",
                          "clientId": "[[parameters('ClientID AAD SP')]",
                          "secret": "@body('Get_secret')?['value']",
                          "tenant": "[[parameters('Tenant ID')]",
                          "type": "ActiveDirectoryOAuth"
                        },
                        "method": "GET",
                        "uri": "https://graph.microsoft.com/v1.0/users?$filter=DisplayName eq '@{concat(triggerBody()?['fields']?['assignee']?['displayName'], ' (Operator)')}'"
                      }
                    },
                    "Parse_JSON": {
                      "runAfter": {
                        "HTTP": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('HTTP')",
                        "schema": {
                          "properties": {
                            "@@odata.context": {
                              "type": "string"
                            },
                            "value": {
                              "items": {
                                "properties": {
                                  "businessPhones": {
                                    "items": {
                                      "type": "string"
                                    },
                                    "type": "array"
                                  },
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "givenName": {
                                    "type": "string"
                                  },
                                  "id": {
                                    "type": "string"
                                  },
                                  "surname": {
                                    "type": "string"
                                  },
                                  "userPrincipalName": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "businessPhones",
                                  "displayName",
                                  "givenName",
                                  "jobTitle",
                                  "mail",
                                  "mobilePhone",
                                  "officeLocation",
                                  "preferredLanguage",
                                  "surname",
                                  "userPrincipalName",
                                  "id"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          },
                          "type": "object"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('SentinelConnectionName'))]",
                        "connectionName": "[[variables('SentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureKeyVaultConnectionName'))]",
                        "connectionName": "[[variables('AzureKeyVaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Sync Jira to Sentinel - Assigned User",
            "description": "This Playbook will sync the assigned user from JIRA to Microsoft Sentinel.",
            "prerequisites": [
              "1. Create service principal with User.Read.All application permissions to perform get users call on Microsoft Graph.",
              "2. Configure JIRA with for custom fields and automation rule.",
              "3. Deploy Azure Key Vault and add secrets for: Microsoft Entra ID service prncipal (to communicate with Microsoft Graph), Jira account (to perform calls on Jira).",
              "4. After playbook is deployed, grant the playbook permissions on the Key Vault (Secret - Get) and on Microsoft Sentinel workspace (Microsoft Sentinel responder)",
              "5. [Full documentation](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/AtlassianJiraAudit/Playbooks/readme.md)"
            ],
            "lastUpdateTime": "2022-07-20T00:00:00Z",
            "entities": [
              "Account"
            ],
            "tags": [
              "Sync"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Sync Jira to Sentinel - Assigned User",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId4')]",
        "contentKind": "Playbook",
        "displayName": "Sync-AssignedUser",
        "contentProductId": "[variables('_playbookcontentProductId4')]",
        "id": "[variables('_playbookcontentProductId4')]",
        "version": "[variables('playbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Add-JIRALinkComment Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion5')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Add-JIRALinkComment",
              "type": "string"
            }
          },
          "variables": {
            "SentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('SentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('PlaybookName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "tags": {
                "hidden-SentinelTemplateName": "SyncComments",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('SentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "manual": {
                      "type": "Request",
                      "kind": "Http",
                      "inputs": {
                        "schema": {
                          "properties": {
                            "changelog": {
                              "properties": {
                                "maxResults": {
                                  "type": "integer"
                                },
                                "startAt": {
                                  "type": "integer"
                                },
                                "total": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            },
                            "fields": {
                              "properties": {
                                "aggregateprogress": {
                                  "properties": {
                                    "progress": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "attachment": {
                                  "items": {
                                    "properties": {
                                      "author": {
                                        "properties": {
                                          "accountId": {
                                            "type": "string"
                                          },
                                          "accountType": {
                                            "type": "string"
                                          },
                                          "active": {
                                            "type": "boolean"
                                          },
                                          "avatarUrls": {
                                            "properties": {
                                              "16x16": {
                                                "type": "string"
                                              },
                                              "24x24": {
                                                "type": "string"
                                              },
                                              "32x32": {
                                                "type": "string"
                                              },
                                              "48x48": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "displayName": {
                                            "type": "string"
                                          },
                                          "self": {
                                            "type": "string"
                                          },
                                          "timeZone": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "content": {
                                        "type": "string"
                                      },
                                      "created": {
                                        "type": "integer"
                                      },
                                      "filename": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "mimeType": {
                                        "type": "string"
                                      },
                                      "self": {
                                        "type": "string"
                                      },
                                      "size": {
                                        "type": "integer"
                                      }
                                    },
                                    "required": [
                                      "self",
                                      "id",
                                      "filename",
                                      "author",
                                      "created",
                                      "size",
                                      "mimeType",
                                      "content"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "comment": {
                                  "properties": {
                                    "comments": {
                                      "items": {
                                        "properties": {
                                          "author": {
                                            "properties": {
                                              "accountId": {
                                                "type": "string"
                                              },
                                              "accountType": {
                                                "type": "string"
                                              },
                                              "active": {
                                                "type": "boolean"
                                              },
                                              "avatarUrls": {
                                                "properties": {
                                                  "16x16": {
                                                    "type": "string"
                                                  },
                                                  "24x24": {
                                                    "type": "string"
                                                  },
                                                  "32x32": {
                                                    "type": "string"
                                                  },
                                                  "48x48": {
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "displayName": {
                                                "type": "string"
                                              },
                                              "self": {
                                                "type": "string"
                                              },
                                              "timeZone": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "body": {
                                            "type": "string"
                                          },
                                          "created": {
                                            "type": "integer"
                                          },
                                          "id": {
                                            "type": "integer"
                                          },
                                          "self": {
                                            "type": "string"
                                          },
                                          "updateAuthor": {
                                            "properties": {
                                              "accountId": {
                                                "type": "string"
                                              },
                                              "accountType": {
                                                "type": "string"
                                              },
                                              "active": {
                                                "type": "boolean"
                                              },
                                              "avatarUrls": {
                                                "properties": {
                                                  "16x16": {
                                                    "type": "string"
                                                  },
                                                  "24x24": {
                                                    "type": "string"
                                                  },
                                                  "32x32": {
                                                    "type": "string"
                                                  },
                                                  "48x48": {
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "displayName": {
                                                "type": "string"
                                              },
                                              "self": {
                                                "type": "string"
                                              },
                                              "timeZone": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "updated": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "self",
                                          "id",
                                          "author",
                                          "body",
                                          "renderedBody",
                                          "updateAuthor",
                                          "created",
                                          "updated",
                                          "visibility"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "last": {
                                      "type": "boolean"
                                    },
                                    "maxResults": {
                                      "type": "integer"
                                    },
                                    "startAt": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "components": {
                                  "type": "array"
                                },
                                "created": {
                                  "type": "integer"
                                },
                                "creator": {
                                  "properties": {
                                    "accountId": {
                                      "type": "string"
                                    },
                                    "accountType": {
                                      "type": "string"
                                    },
                                    "active": {
                                      "type": "boolean"
                                    },
                                    "avatarUrls": {
                                      "properties": {
                                        "16x16": {
                                          "type": "string"
                                        },
                                        "24x24": {
                                          "type": "string"
                                        },
                                        "32x32": {
                                          "type": "string"
                                        },
                                        "48x48": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "timeZone": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10000": {
                                  "type": "string"
                                },
                                "customfield_10002": {
                                  "items": {
                                    "properties": {
                                      "_links": {
                                        "properties": {
                                          "self": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "name": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "id",
                                      "name",
                                      "_links"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "customfield_10003": {
                                  "items": {
                                    "properties": {
                                      "accountId": {
                                        "type": "string"
                                      },
                                      "accountType": {
                                        "type": "string"
                                      },
                                      "active": {
                                        "type": "boolean"
                                      },
                                      "avatarUrls": {
                                        "properties": {
                                          "16x16": {
                                            "type": "string"
                                          },
                                          "24x24": {
                                            "type": "string"
                                          },
                                          "32x32": {
                                            "type": "string"
                                          },
                                          "48x48": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "displayName": {
                                        "type": "string"
                                      },
                                      "self": {
                                        "type": "string"
                                      },
                                      "timeZone": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "self",
                                      "accountId",
                                      "avatarUrls",
                                      "displayName",
                                      "active",
                                      "timeZone",
                                      "accountType"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "customfield_10010": {
                                  "properties": {
                                    "_links": {
                                      "properties": {
                                        "agent": {
                                          "type": "string"
                                        },
                                        "jiraRest": {
                                          "type": "string"
                                        },
                                        "self": {
                                          "type": "string"
                                        },
                                        "web": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "currentStatus": {
                                      "properties": {
                                        "status": {
                                          "type": "string"
                                        },
                                        "statusCategory": {
                                          "type": "string"
                                        },
                                        "statusDate": {
                                          "properties": {
                                            "epochMillis": {
                                              "type": "integer"
                                            },
                                            "friendly": {
                                              "type": "string"
                                            },
                                            "iso8601": {
                                              "type": "string"
                                            },
                                            "jira": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "requestType": {
                                      "properties": {
                                        "_expands": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "_links": {
                                          "properties": {
                                            "self": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "description": {
                                          "type": "string"
                                        },
                                        "groupIds": {
                                          "type": "array"
                                        },
                                        "helpText": {
                                          "type": "string"
                                        },
                                        "icon": {
                                          "properties": {
                                            "_links": {
                                              "properties": {
                                                "iconUrls": {
                                                  "properties": {
                                                    "16x16": {
                                                      "type": "string"
                                                    },
                                                    "24x24": {
                                                      "type": "string"
                                                    },
                                                    "32x32": {
                                                      "type": "string"
                                                    },
                                                    "48x48": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "id": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "id": {
                                          "type": "string"
                                        },
                                        "issueTypeId": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        },
                                        "serviceDeskId": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10018": {
                                  "properties": {
                                    "hasEpicLinkFieldDependency": {
                                      "type": "boolean"
                                    },
                                    "nonEditableReason": {
                                      "properties": {
                                        "message": {
                                          "type": "string"
                                        },
                                        "reason": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "showField": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10019": {
                                  "type": "string"
                                },
                                "customfield_10022": {
                                  "type": "string"
                                },
                                "customfield_10023": {
                                  "type": "string"
                                },
                                "customfield_10024": {
                                  "type": "array"
                                },
                                "customfield_10048": {
                                  "properties": {
                                    "_links": {
                                      "properties": {
                                        "self": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "completedCycles": {
                                      "items": {
                                        "properties": {
                                          "breached": {
                                            "type": "boolean"
                                          },
                                          "elapsedTime": {
                                            "properties": {
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "millis": {
                                                "type": "integer"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "goalDuration": {
                                            "properties": {
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "millis": {
                                                "type": "integer"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "remainingTime": {
                                            "properties": {
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "millis": {
                                                "type": "integer"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "startTime": {
                                            "properties": {
                                              "epochMillis": {
                                                "type": "integer"
                                              },
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "iso8601": {
                                                "type": "string"
                                              },
                                              "jira": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "stopTime": {
                                            "properties": {
                                              "epochMillis": {
                                                "type": "integer"
                                              },
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "iso8601": {
                                                "type": "string"
                                              },
                                              "jira": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          }
                                        },
                                        "required": [
                                          "startTime",
                                          "stopTime",
                                          "breached",
                                          "goalDuration",
                                          "elapsedTime",
                                          "remainingTime"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "id": {
                                      "type": "string"
                                    },
                                    "name": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10051": {
                                  "properties": {
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "languageCode": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10144": {
                                  "type": "string"
                                },
                                "customfield_10145": {
                                  "type": "string"
                                },
                                "customfield_10146": {
                                  "type": "string"
                                },
                                "customfield_10147": {
                                  "properties": {
                                    "id": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "value": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10149": {
                                  "properties": {
                                    "id": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "value": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10154": {
                                  "type": "string"
                                },
                                "customfield_10155": {
                                  "items": {
                                    "properties": {
                                      "id": {
                                        "type": "string"
                                      },
                                      "self": {
                                        "type": "string"
                                      },
                                      "value": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "self",
                                      "value",
                                      "id"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "customfield_10158": {
                                  "type": "string"
                                },
                                "customfield_10162": {
                                  "type": "string"
                                },
                                "customfield_10169": {
                                  "type": "string"
                                },
                                "customfield_10170": {
                                  "type": "string"
                                },
                                "customfield_10172": {
                                  "type": "string"
                                },
                                "customfield_10173": {
                                  "type": "string"
                                },
                                "customfield_10175": {
                                  "type": "string"
                                },
                                "description": {
                                  "type": "string"
                                },
                                "fixVersions": {
                                  "type": "array"
                                },
                                "issuelinks": {
                                  "type": "array"
                                },
                                "issuerestriction": {
                                  "properties": {
                                    "issuerestrictions": {
                                      "type": "object"
                                    },
                                    "shouldDisplay": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "issuetype": {
                                  "properties": {
                                    "description": {
                                      "type": "string"
                                    },
                                    "iconUrl": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "namedValue": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "statuses": {
                                      "type": "array"
                                    },
                                    "subtask": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "labels": {
                                  "type": "array"
                                },
                                "priority": {
                                  "properties": {
                                    "iconUrl": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "namedValue": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "progress": {
                                  "properties": {
                                    "progress": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "project": {
                                  "properties": {
                                    "avatarUrls": {
                                      "properties": {
                                        "16x16": {
                                          "type": "string"
                                        },
                                        "24x24": {
                                          "type": "string"
                                        },
                                        "32x32": {
                                          "type": "string"
                                        },
                                        "48x48": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "key": {
                                      "type": "string"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "projectTypeKey": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "simplified": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "reporter": {
                                  "properties": {
                                    "accountId": {
                                      "type": "string"
                                    },
                                    "accountType": {
                                      "type": "string"
                                    },
                                    "active": {
                                      "type": "boolean"
                                    },
                                    "avatarUrls": {
                                      "properties": {
                                        "16x16": {
                                          "type": "string"
                                        },
                                        "24x24": {
                                          "type": "string"
                                        },
                                        "32x32": {
                                          "type": "string"
                                        },
                                        "48x48": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "timeZone": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "resolution": {
                                  "properties": {
                                    "description": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "namedValue": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "resolutiondate": {
                                  "type": "integer"
                                },
                                "status": {
                                  "properties": {
                                    "description": {
                                      "type": "string"
                                    },
                                    "iconUrl": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "statusCategory": {
                                      "properties": {
                                        "colorName": {
                                          "type": "string"
                                        },
                                        "id": {
                                          "type": "integer"
                                        },
                                        "key": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        },
                                        "self": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                },
                                "statuscategorychangedate": {
                                  "type": "string"
                                },
                                "subtasks": {
                                  "type": "array"
                                },
                                "summary": {
                                  "type": "string"
                                },
                                "timetracking": {
                                  "properties": {
                                    "originalEstimateSeconds": {
                                      "type": "integer"
                                    },
                                    "remainingEstimateSeconds": {
                                      "type": "integer"
                                    },
                                    "timeSpentSeconds": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "updated": {
                                  "type": "integer"
                                },
                                "versions": {
                                  "type": "array"
                                },
                                "votes": {
                                  "properties": {
                                    "hasVoted": {
                                      "type": "boolean"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "votes": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "watches": {
                                  "properties": {
                                    "isWatching": {
                                      "type": "boolean"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "watchCount": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "worklog": {
                                  "properties": {
                                    "last": {
                                      "type": "boolean"
                                    },
                                    "maxResults": {
                                      "type": "integer"
                                    },
                                    "startAt": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    },
                                    "worklogs": {
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "workratio": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            },
                            "id": {
                              "type": "integer"
                            },
                            "key": {
                              "type": "string"
                            },
                            "self": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    }
                  },
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "runAfter": {
                        "Create_HTML_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['fields']?['customfield_10175']",
                          "message": "<p>@{outputs('Create_HTML_Comment')}</p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      }
                    },
                    "Create_HTML_Comment": {
                      "type": "Compose",
                      "inputs": "[[[[JIRA ID: @{triggerBody()?['key']}](@{triggerBody()?['fields']?['customfield_10010']?['_links']?['web']})"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('SentinelConnectionName'))]",
                        "connectionName": "[[variables('SentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId5'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId5')]",
                "contentId": "[variables('_playbookContentId5')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Sync Jira to Sentinel - public comments",
            "description": "This Playbook will sync the public comments from JIRA to Microsoft Sentinel.",
            "prerequisites": [
              "1. Configure JIRA with for custom fields and automation rule. [Learn more](https://github.com/ThijsLecomte/Azure-Sentinel/tree/master/Playbooks/Sync-IncidentsWithJIRA#2-jira-configuration)",
              "2. After playbook is deployed, grant the playbook permissions on the Key Vault (Secret - Get) and on Microsoft Sentinel workspace (Microsoft Sentinel responder)",
              "Optional: deploy Azure Function to sync comments from Jira to Microsoft Sentinel."
            ],
            "lastUpdateTime": "2021-07-20T00:00:00Z",
            "tags": [
              "Sync"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId5')]",
        "contentKind": "Playbook",
        "displayName": "Add-JIRALinkComment",
        "contentProductId": "[variables('_playbookcontentProductId5')]",
        "id": "[variables('_playbookcontentProductId5')]",
        "version": "[variables('playbookVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Sync-CommentsFunctionApp Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion6')]",
          "parameters": {
            "FunctionAppName": {
              "defaultValue": "jira-sync",
              "type": "string"
            }
          },
          "variables": {
            "hostingPlanName": "[[concat(parameters('FunctionAppName'),'hostingPlan')]",
            "storageName": "[[concat('deploy', uniqueString(resourceGroup().id))]",
            "packageURL": "https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/AtlassianJiraAudit/Playbooks/Sync-CommentsFunctionApp/tc-function-cc-sync.zip?raw=true",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId6": "Sync-CommentsFunctionApp",
            "playbookId6": "[[resourceId('Microsoft.Logic/workflows', variables('playbookContentId6'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "apiVersion": "2021-09-01",
              "type": "Microsoft.Storage/storageAccounts",
              "name": "[[variables('storageName')]",
              "location": "[[variables('workspace-location-inline')]",
              "sku": {
                "name": "Standard_LRS",
                "tier": "Standard"
              }
            },
            {
              "apiVersion": "2015-08-01",
              "name": "[[variables('hostingPlanName')]",
              "kind": "functionapp",
              "type": "Microsoft.Web/serverfarms",
              "location": "[[variables('workspace-location-inline')]",
              "sku": {
                "name": "Y1",
                "tier": "Dynamic",
                "size": "Y1",
                "family": "Y",
                "capacity": 0
              },
              "properties": {
                "name": "[[variables('hostingPlanName')]"
              }
            },
            {
              "apiVersion": "2015-08-01",
              "name": "[[parameters('FunctionAppName')]",
              "type": "Microsoft.Web/sites",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "functionapp",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/serverfarms', variables('hostingPlanName'))]",
                "[[resourceId('Microsoft.Storage/storageAccounts', variables('storageName'))]"
              ],
              "properties": {
                "serverFarmId": "[[variables('hostingPlanName')]",
                "siteConfig": {
                  "appSettings": [
                    {
                      "name": "AzureWebJobsDashboard",
                      "value": "[[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageName'), ';EndpointSuffix=', environment().suffixes.storage, ';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageName')), '2023-04-01').keys[0].value)]"
                    },
                    {
                      "name": "AzureWebJobsStorage",
                      "value": "[[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageName'), ';EndpointSuffix=', environment().suffixes.storage, ';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageName')), '2023-04-01').keys[0].value)]"
                    },
                    {
                      "name": "FUNCTIONS_EXTENSION_VERSION",
                      "value": "~3"
                    },
                    {
                      "name": "WEBSITE_CONTENTAZUREFILECONNECTIONSTRING",
                      "value": "[[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageName'), ';EndpointSuffix=', environment().suffixes.storage, ';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageName')), '2023-04-01').keys[0].value)]"
                    },
                    {
                      "name": "WEBSITE_NODE_DEFAULT_VERSION",
                      "value": "~10"
                    },
                    {
                      "name": "WEBSITE_CONTENTSHARE",
                      "value": "[[toLower(parameters('FunctionAppName'))]"
                    }
                  ]
                }
              },
              "resources": [
                {
                  "name": "MSDeploy",
                  "type": "extensions",
                  "location": "[[variables('workspace-location-inline')]",
                  "apiVersion": "2015-08-01",
                  "dependsOn": [
                    "[[concat('Microsoft.Web/sites/', parameters('FunctionAppName'))]"
                  ],
                  "properties": {
                    "packageUri": "[[variables('packageURL')]"
                  }
                }
              ]
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('AzureFunction-', last(split(variables('playbookId6'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId6')]",
                "contentId": "[variables('_playbookContentId6')]",
                "kind": "AzureFunction",
                "version": "[variables('playbookVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId6')]",
        "contentKind": "AzureFunction",
        "displayName": "Sync-CommentsFunctionApp",
        "contentProductId": "[variables('_playbookcontentProductId6')]",
        "id": "[variables('_playbookcontentProductId6')]",
        "version": "[variables('playbookVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Sync-Incidents Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion7')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Sync-Incidents",
              "type": "string"
            },
            "SecretName Jira": {
              "type": "securestring",
              "metadata": {
                "description": "Name of the Key Vault Secret that contains the Jira Secret"
              }
            },
            "UserName Jira": {
              "type": "String",
              "metadata": {
                "description": "Username for JIRA Authentication"
              }
            },
            "JIRA API URL": {
              "type": "String",
              "metadata": {
                "description": "Organization specific URL for API (https://company.atlassian.net/rest/api/3/issue/)"
              }
            },
            "Keyvault Name": {
              "type": "String",
              "metadata": {
                "description": "Name of the Key Vault which stores the client secrets"
              }
            }
          },
          "variables": {
            "AzureKeyVaultConnectionName": "[[concat('azurekeyvault-', parameters('PlaybookName'))]",
            "SentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/keyvault')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('SentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('PlaybookName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureKeyVaultConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureKeyVaultConnectionName')]",
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('Keyvault Name')]"
                },
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "tags": {
                "hidden-SentinelTemplateName": "SyncJIRAIncidents",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureKeyVaultConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('SentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Add_To_TacticList_End": {
                      "runAfter": {
                        "Loop_Tactics": [
                          "Succeeded"
                        ]
                      },
                      "type": "AppendToStringVariable",
                      "inputs": {
                        "name": "TacticList",
                        "value": "]"
                      }
                    },
                    "Create TacticListDupVariableacticListDup": {
                      "runAfter": {
                        "Create_TacticsVariable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "TacticListDup",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Create_JIRAOrganizationID_Variable": {
                      "runAfter": {
                        "Create_TenantName_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "JIRAOrganizationID",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "Create_JIRA_Ticket": {
                      "runAfter": {
                        "Switch": [
                          "Succeeded"
                        ]
                      },
                      "type": "Http",
                      "inputs": {
                        "authentication": {
                          "password": "@body('Get_secret')?['value']",
                          "type": "Basic",
                          "username": "[[parameters('UserName Jira')]"
                        },
                        "body": {
                          "fields": {
                            "customfield_10002": [
                              "@variables('JIRAOrganizationID')"
                            ],
                            "customfield_10145": "@{triggerBody()?['object']?['name']}",
                            "customfield_10149": {
                              "value": "@{variables('TenantName')}"
                            },
                            "customfield_10154": "@triggerBody()?['object']?['properties']?['createdTimeUtc']",
                            "customfield_10155": "@json(variables('TacticList'))",
                            "customfield_10158": {
                              "content": [
                                {
                                  "content": [
                                    {
                                      "text": "@{if(greater(length(variables('User List')),0),variables('User List'),'None')}",
                                      "type": "text"
                                    }
                                  ],
                                  "type": "paragraph"
                                }
                              ],
                              "type": "doc",
                              "version": 1
                            },
                            "customfield_10162": "@{triggerBody()?['workspaceInfo']?['SubscriptionId']}",
                            "customfield_10169": "@{triggerBody()?['workspaceInfo']?['ResourceGroupName']}",
                            "customfield_10170": "@{triggerBody()?['workspaceInfo']?['WorkspaceName']}",
                            "customfield_10172": "@{triggerBody()?['workspaceId']}",
                            "customfield_10173": "@{triggerBody()?['object']?['properties']?['incidentNumber']}",
                            "customfield_10175": "@{triggerBody()?['object']?['id']}",
                            "description": {
                              "content": [
                                {
                                  "content": [
                                    {
                                      "text": "@triggerBody()?['object']?['properties']?['description']",
                                      "type": "text"
                                    }
                                  ],
                                  "type": "paragraph"
                                }
                              ],
                              "type": "doc",
                              "version": 1
                            },
                            "issuetype": {
                              "id": "10037"
                            },
                            "priority": {
                              "name": "@triggerBody()?['object']?['properties']?['severity']"
                            },
                            "project": {
                              "key": "CC"
                            },
                            "summary": "@triggerBody()?['object']?['properties']?['title']"
                          }
                        },
                        "method": "POST",
                        "uri": "[[parameters('JIRA API URL')]"
                      }
                    },
                    "Create_TacticsVariable": {
                      "runAfter": {
                        "Entities_-_Get_Accounts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "TacticList",
                            "type": "string",
                            "value": "[[[["
                          }
                        ]
                      }
                    },
                    "Create_TenantName_Variable": {
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "TenantName",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Create_UserList_Variable": {
                      "runAfter": {
                        "Add_To_TacticList_End": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "User List",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Entities_-_Get_Accounts": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/account"
                      }
                    },
                    "Get_secret": {
                      "runAfter": {
                        "Loop_Accounts": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "[[concat('/secrets/@{encodeURIComponent(''', parameters('SecretName Jira'), ''')}/value')]"
                      }
                    },
                    "Loop_Accounts": {
                      "foreach": "@body('Entities_-_Get_Accounts')?['Accounts']",
                      "actions": {
                        "Add_User_To_List": {
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "User List",
                            "value": "@{items('Loop_Accounts')?['Name']}\n"
                          }
                        }
                      },
                      "runAfter": {
                        "Create_UserList_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Loop_Tactics": {
                      "foreach": "@triggerBody()?['object']?['properties']?['additionalData']?['tactics']",
                      "actions": {
                        "Add_To_TacticList": {
                          "runAfter": {
                            "Set_Variable_TacticListDup": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "TacticList",
                            "value": "@{if(contains(variables('TacticListDup'),'value'),',','')}{\"value\":\"@{items('Loop_Tactics')}\"}"
                          }
                        },
                        "Set_Variable_TacticListDup": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "TacticListDup",
                            "value": "@variables('TacticList')"
                          }
                        }
                      },
                      "runAfter": {
                        "Create TacticListDupVariableacticListDup": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Switch": {
                      "runAfter": {
                        "Create_JIRAOrganizationID_Variable": [
                          "Succeeded"
                        ]
                      },
                      "cases": {
                        "Case": {
                          "case": "SubscriptionID Customer 1",
                          "actions": {
                            "Set_JIRAOrganizationID_Variable_1": {
                              "runAfter": {
                                "Set_TenantName_Variable_1": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "JIRAOrganizationID",
                                "value": 7
                              }
                            },
                            "Set_TenantName_Variable_1": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "TenantName",
                                "value": "Tenant Name Customer 1"
                              }
                            }
                          }
                        }
                      },
                      "expression": "@triggerBody()?['workspaceInfo']?['SubscriptionId']",
                      "type": "Switch"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('SentinelConnectionName'))]",
                        "connectionName": "[[variables('SentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureKeyVaultConnectionName'))]",
                        "connectionName": "[[variables('AzureKeyVaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId7'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId7')]",
                "contentId": "[variables('_playbookContentId7')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Sync Jira from Sentinel - Create incident",
            "description": "This Playbook will create JIRA incidents for every Microsoft Sentinel which is created. It includes additional information such as tactics, affected user etc.",
            "prerequisites": [
              "1. Deploy Azure Key Vault and add secrets for the Jira account (to perform calls on Jira).",
              "2. After playbook is deployed, grant the playbook permissions on the Key Vault (Secret - Get) and on Microsoft Sentinel workspace (Microsoft Sentinel Reader)",
              "3. [Full documentation](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/AtlassianJiraAudit/Playbooks/readme.md)"
            ],
            "lastUpdateTime": "2022-07-20T00:00:00Z",
            "entities": [
              "Account"
            ],
            "tags": [
              "Sync"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Sync Jira from Sentinel - Create incident",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId7')]",
        "contentKind": "Playbook",
        "displayName": "Sync-Incidents",
        "contentProductId": "[variables('_playbookcontentProductId7')]",
        "id": "[variables('_playbookcontentProductId7')]",
        "version": "[variables('playbookVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Sync-Status Playbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion8')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Sync-Status",
              "type": "string"
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('PlaybookName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "tags": {
                "hidden-SentinelTemplateName": "SyncJIRAStatus",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "manual": {
                      "type": "Request",
                      "kind": "Http",
                      "inputs": {
                        "schema": {
                          "properties": {
                            "changelog": {
                              "properties": {
                                "maxResults": {
                                  "type": "integer"
                                },
                                "startAt": {
                                  "type": "integer"
                                },
                                "total": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            },
                            "fields": {
                              "properties": {
                                "aggregateprogress": {
                                  "properties": {
                                    "progress": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "attachment": {
                                  "items": {
                                    "properties": {
                                      "author": {
                                        "properties": {
                                          "accountId": {
                                            "type": "string"
                                          },
                                          "accountType": {
                                            "type": "string"
                                          },
                                          "active": {
                                            "type": "boolean"
                                          },
                                          "avatarUrls": {
                                            "properties": {
                                              "16x16": {
                                                "type": "string"
                                              },
                                              "24x24": {
                                                "type": "string"
                                              },
                                              "32x32": {
                                                "type": "string"
                                              },
                                              "48x48": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "displayName": {
                                            "type": "string"
                                          },
                                          "self": {
                                            "type": "string"
                                          },
                                          "timeZone": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "content": {
                                        "type": "string"
                                      },
                                      "created": {
                                        "type": "integer"
                                      },
                                      "filename": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "mimeType": {
                                        "type": "string"
                                      },
                                      "self": {
                                        "type": "string"
                                      },
                                      "size": {
                                        "type": "integer"
                                      }
                                    },
                                    "required": [
                                      "self",
                                      "id",
                                      "filename",
                                      "author",
                                      "created",
                                      "size",
                                      "mimeType",
                                      "content"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "comment": {
                                  "properties": {
                                    "comments": {
                                      "items": {
                                        "properties": {
                                          "author": {
                                            "properties": {
                                              "accountId": {
                                                "type": "string"
                                              },
                                              "accountType": {
                                                "type": "string"
                                              },
                                              "active": {
                                                "type": "boolean"
                                              },
                                              "avatarUrls": {
                                                "properties": {
                                                  "16x16": {
                                                    "type": "string"
                                                  },
                                                  "24x24": {
                                                    "type": "string"
                                                  },
                                                  "32x32": {
                                                    "type": "string"
                                                  },
                                                  "48x48": {
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "displayName": {
                                                "type": "string"
                                              },
                                              "self": {
                                                "type": "string"
                                              },
                                              "timeZone": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "body": {
                                            "type": "string"
                                          },
                                          "created": {
                                            "type": "integer"
                                          },
                                          "id": {
                                            "type": "integer"
                                          },
                                          "self": {
                                            "type": "string"
                                          },
                                          "updateAuthor": {
                                            "properties": {
                                              "accountId": {
                                                "type": "string"
                                              },
                                              "accountType": {
                                                "type": "string"
                                              },
                                              "active": {
                                                "type": "boolean"
                                              },
                                              "avatarUrls": {
                                                "properties": {
                                                  "16x16": {
                                                    "type": "string"
                                                  },
                                                  "24x24": {
                                                    "type": "string"
                                                  },
                                                  "32x32": {
                                                    "type": "string"
                                                  },
                                                  "48x48": {
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "displayName": {
                                                "type": "string"
                                              },
                                              "self": {
                                                "type": "string"
                                              },
                                              "timeZone": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "updated": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "self",
                                          "id",
                                          "author",
                                          "body",
                                          "renderedBody",
                                          "updateAuthor",
                                          "created",
                                          "updated",
                                          "visibility"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "last": {
                                      "type": "boolean"
                                    },
                                    "maxResults": {
                                      "type": "integer"
                                    },
                                    "startAt": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "components": {
                                  "type": "array"
                                },
                                "created": {
                                  "type": "integer"
                                },
                                "creator": {
                                  "properties": {
                                    "accountId": {
                                      "type": "string"
                                    },
                                    "accountType": {
                                      "type": "string"
                                    },
                                    "active": {
                                      "type": "boolean"
                                    },
                                    "avatarUrls": {
                                      "properties": {
                                        "16x16": {
                                          "type": "string"
                                        },
                                        "24x24": {
                                          "type": "string"
                                        },
                                        "32x32": {
                                          "type": "string"
                                        },
                                        "48x48": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "timeZone": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10000": {
                                  "type": "string"
                                },
                                "customfield_10002": {
                                  "items": {
                                    "properties": {
                                      "_links": {
                                        "properties": {
                                          "self": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "name": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "id",
                                      "name",
                                      "_links"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "customfield_10003": {
                                  "items": {
                                    "properties": {
                                      "accountId": {
                                        "type": "string"
                                      },
                                      "accountType": {
                                        "type": "string"
                                      },
                                      "active": {
                                        "type": "boolean"
                                      },
                                      "avatarUrls": {
                                        "properties": {
                                          "16x16": {
                                            "type": "string"
                                          },
                                          "24x24": {
                                            "type": "string"
                                          },
                                          "32x32": {
                                            "type": "string"
                                          },
                                          "48x48": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "displayName": {
                                        "type": "string"
                                      },
                                      "self": {
                                        "type": "string"
                                      },
                                      "timeZone": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "self",
                                      "accountId",
                                      "avatarUrls",
                                      "displayName",
                                      "active",
                                      "timeZone",
                                      "accountType"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "customfield_10010": {
                                  "properties": {
                                    "_links": {
                                      "properties": {
                                        "agent": {
                                          "type": "string"
                                        },
                                        "jiraRest": {
                                          "type": "string"
                                        },
                                        "self": {
                                          "type": "string"
                                        },
                                        "web": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "currentStatus": {
                                      "properties": {
                                        "status": {
                                          "type": "string"
                                        },
                                        "statusCategory": {
                                          "type": "string"
                                        },
                                        "statusDate": {
                                          "properties": {
                                            "epochMillis": {
                                              "type": "integer"
                                            },
                                            "friendly": {
                                              "type": "string"
                                            },
                                            "iso8601": {
                                              "type": "string"
                                            },
                                            "jira": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "requestType": {
                                      "properties": {
                                        "_expands": {
                                          "items": {
                                            "type": "string"
                                          },
                                          "type": "array"
                                        },
                                        "_links": {
                                          "properties": {
                                            "self": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "description": {
                                          "type": "string"
                                        },
                                        "groupIds": {
                                          "type": "array"
                                        },
                                        "helpText": {
                                          "type": "string"
                                        },
                                        "icon": {
                                          "properties": {
                                            "_links": {
                                              "properties": {
                                                "iconUrls": {
                                                  "properties": {
                                                    "16x16": {
                                                      "type": "string"
                                                    },
                                                    "24x24": {
                                                      "type": "string"
                                                    },
                                                    "32x32": {
                                                      "type": "string"
                                                    },
                                                    "48x48": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "id": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "id": {
                                          "type": "string"
                                        },
                                        "issueTypeId": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        },
                                        "serviceDeskId": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10018": {
                                  "properties": {
                                    "hasEpicLinkFieldDependency": {
                                      "type": "boolean"
                                    },
                                    "nonEditableReason": {
                                      "properties": {
                                        "message": {
                                          "type": "string"
                                        },
                                        "reason": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "showField": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10019": {
                                  "type": "string"
                                },
                                "customfield_10022": {
                                  "type": "string"
                                },
                                "customfield_10023": {
                                  "type": "string"
                                },
                                "customfield_10024": {
                                  "type": "array"
                                },
                                "customfield_10048": {
                                  "properties": {
                                    "_links": {
                                      "properties": {
                                        "self": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "completedCycles": {
                                      "items": {
                                        "properties": {
                                          "breached": {
                                            "type": "boolean"
                                          },
                                          "elapsedTime": {
                                            "properties": {
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "millis": {
                                                "type": "integer"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "goalDuration": {
                                            "properties": {
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "millis": {
                                                "type": "integer"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "remainingTime": {
                                            "properties": {
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "millis": {
                                                "type": "integer"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "startTime": {
                                            "properties": {
                                              "epochMillis": {
                                                "type": "integer"
                                              },
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "iso8601": {
                                                "type": "string"
                                              },
                                              "jira": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "stopTime": {
                                            "properties": {
                                              "epochMillis": {
                                                "type": "integer"
                                              },
                                              "friendly": {
                                                "type": "string"
                                              },
                                              "iso8601": {
                                                "type": "string"
                                              },
                                              "jira": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          }
                                        },
                                        "required": [
                                          "startTime",
                                          "stopTime",
                                          "breached",
                                          "goalDuration",
                                          "elapsedTime",
                                          "remainingTime"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "id": {
                                      "type": "string"
                                    },
                                    "name": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10051": {
                                  "properties": {
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "languageCode": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10144": {
                                  "type": "string"
                                },
                                "customfield_10145": {
                                  "type": "string"
                                },
                                "customfield_10146": {
                                  "type": "string"
                                },
                                "customfield_10147": {
                                  "properties": {
                                    "id": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "value": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10149": {
                                  "properties": {
                                    "id": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "value": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "customfield_10154": {
                                  "type": "string"
                                },
                                "customfield_10155": {
                                  "items": {
                                    "properties": {
                                      "id": {
                                        "type": "string"
                                      },
                                      "self": {
                                        "type": "string"
                                      },
                                      "value": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "self",
                                      "value",
                                      "id"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "customfield_10158": {
                                  "type": "string"
                                },
                                "customfield_10162": {
                                  "type": "string"
                                },
                                "customfield_10169": {
                                  "type": "string"
                                },
                                "customfield_10170": {
                                  "type": "string"
                                },
                                "customfield_10172": {
                                  "type": "string"
                                },
                                "customfield_10173": {
                                  "type": "string"
                                },
                                "customfield_10175": {
                                  "type": "string"
                                },
                                "description": {
                                  "type": "string"
                                },
                                "fixVersions": {
                                  "type": "array"
                                },
                                "issuelinks": {
                                  "type": "array"
                                },
                                "issuerestriction": {
                                  "properties": {
                                    "issuerestrictions": {
                                      "type": "object"
                                    },
                                    "shouldDisplay": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "issuetype": {
                                  "properties": {
                                    "description": {
                                      "type": "string"
                                    },
                                    "iconUrl": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "namedValue": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "statuses": {
                                      "type": "array"
                                    },
                                    "subtask": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "labels": {
                                  "type": "array"
                                },
                                "priority": {
                                  "properties": {
                                    "iconUrl": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "namedValue": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "progress": {
                                  "properties": {
                                    "progress": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "project": {
                                  "properties": {
                                    "avatarUrls": {
                                      "properties": {
                                        "16x16": {
                                          "type": "string"
                                        },
                                        "24x24": {
                                          "type": "string"
                                        },
                                        "32x32": {
                                          "type": "string"
                                        },
                                        "48x48": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "key": {
                                      "type": "string"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "projectTypeKey": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "simplified": {
                                      "type": "boolean"
                                    }
                                  },
                                  "type": "object"
                                },
                                "reporter": {
                                  "properties": {
                                    "accountId": {
                                      "type": "string"
                                    },
                                    "accountType": {
                                      "type": "string"
                                    },
                                    "active": {
                                      "type": "boolean"
                                    },
                                    "avatarUrls": {
                                      "properties": {
                                        "16x16": {
                                          "type": "string"
                                        },
                                        "24x24": {
                                          "type": "string"
                                        },
                                        "32x32": {
                                          "type": "string"
                                        },
                                        "48x48": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "timeZone": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "resolution": {
                                  "properties": {
                                    "description": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "namedValue": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "resolutiondate": {
                                  "type": "integer"
                                },
                                "status": {
                                  "properties": {
                                    "description": {
                                      "type": "string"
                                    },
                                    "iconUrl": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "statusCategory": {
                                      "properties": {
                                        "colorName": {
                                          "type": "string"
                                        },
                                        "id": {
                                          "type": "integer"
                                        },
                                        "key": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        },
                                        "self": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                },
                                "statuscategorychangedate": {
                                  "type": "string"
                                },
                                "subtasks": {
                                  "type": "array"
                                },
                                "summary": {
                                  "type": "string"
                                },
                                "timetracking": {
                                  "properties": {
                                    "originalEstimateSeconds": {
                                      "type": "integer"
                                    },
                                    "remainingEstimateSeconds": {
                                      "type": "integer"
                                    },
                                    "timeSpentSeconds": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "updated": {
                                  "type": "integer"
                                },
                                "versions": {
                                  "type": "array"
                                },
                                "votes": {
                                  "properties": {
                                    "hasVoted": {
                                      "type": "boolean"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "votes": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "watches": {
                                  "properties": {
                                    "isWatching": {
                                      "type": "boolean"
                                    },
                                    "self": {
                                      "type": "string"
                                    },
                                    "watchCount": {
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                },
                                "worklog": {
                                  "properties": {
                                    "last": {
                                      "type": "boolean"
                                    },
                                    "maxResults": {
                                      "type": "integer"
                                    },
                                    "startAt": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    },
                                    "worklogs": {
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "workratio": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            },
                            "id": {
                              "type": "integer"
                            },
                            "key": {
                              "type": "string"
                            },
                            "self": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    }
                  },
                  "actions": {
                    "Switch": {
                      "cases": {
                        "Case": {
                          "case": "NEW",
                          "actions": {
                            "Update_incident_2": {
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "incidentArmId": "@triggerBody()?['fields']?['customfield_10175']",
                                  "status": "New"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "/Incidents"
                              }
                            }
                          }
                        },
                        "Case_2": {
                          "case": "INDETERMINATE",
                          "actions": {
                            "Update_incident_3": {
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "incidentArmId": "@triggerBody()?['fields']?['customfield_10175']",
                                  "status": "Active"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "/Incidents"
                              }
                            }
                          }
                        },
                        "Case_3": {
                          "case": "DONE",
                          "actions": {
                            "Update_incident": {
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "classification": {
                                    "ClassificationAndReason": "@{triggerBody()?['fields']?['customfield_10147']?['value']}",
                                    "ClassificationReasonText": "@triggerBody()?['fields']?['customfield_10146']"
                                  },
                                  "incidentArmId": "@triggerBody()?['fields']?['customfield_10175']",
                                  "status": "Closed"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "/Incidents"
                              }
                            }
                          }
                        }
                      },
                      "expression": "@triggerBody()?['fields']?['customfield_10010']?['currentStatus']?['statusCategory']",
                      "type": "Switch"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId8'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId8')]",
                "contentId": "[variables('_playbookContentId8')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "AtlassianJiraAudit",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Sync Jira to Sentinel - Status",
            "description": "This Playbook will sync the status from JIRA to Microsoft Sentinel.",
            "prerequisites": [
              "1. Configure JIRA with for custom fields and automation rule. [Learn more](https://github.com/ThijsLecomte/Azure-Sentinel/tree/master/Playbooks/Sync-IncidentsWithJIRA#2-jira-configuration)",
              "2. After playbook is deployed, grant the playbook permissions on the Key Vault (Secret - Get) and on Microsoft Sentinel workspace (Microsoft Sentinel responder)",
              "Optional: deploy Azure Function to sync comments from Jira to Microsoft Sentinel."
            ],
            "lastUpdateTime": "2022-07-20T00:00:00Z",
            "entities": [
              "Account"
            ],
            "tags": [
              "Sync"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Sync Jira to Sentinel - Status",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId8')]",
        "contentKind": "Playbook",
        "displayName": "Sync-Status",
        "contentProductId": "[variables('_playbookcontentProductId8')]",
        "id": "[variables('_playbookcontentProductId8')]",
        "version": "[variables('playbookVersion8')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.4",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "AtlassianJiraAudit",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/AtlassianJiraAudit/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.atlassian.com/software/jira\">Atlassian Jira</a> Audit solution provides the capability to ingest <a href=\"https://support.atlassian.com/jira-cloud-administration/docs/audit-activities-in-jira-applications/\">Jira Audit Records</a> events into Microsoft Sentinel through the REST API. Refer to <a href=\"https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-audit-records/\">API documentation</a> for more information.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ol type=\"a\">\n<li><a href=\"https://docs.microsoft.com/azure/azure-monitor/logs/data-collector-api\">Azure Monitor HTTP Data Collector API</a></li>\n</ol>\n<p>b.<a href=\"https://azure.microsoft.com/services/functions/#overview\">Azure Functions</a></p>\n<p>c.<a href=\"https://learn.microsoft.com/en-us/azure/sentinel/create-custom-connector#connect-with-the-codeless-connector-platform\">Codeless Connector Platform (CCP)</a></p>\n<p><strong>Data Connectors:</strong> 2, <strong>Parsers:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 10, <strong>Hunting Queries:</strong> 10, <strong>Function Apps:</strong> 1, <strong>Playbooks:</strong> 7</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/atlassian.svg\"width=\"75px\"height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "AtlassianJiraAudit",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
              "version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
              "version": "[variables('huntingQueryObject2').huntingQueryVersion2]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
              "version": "[variables('huntingQueryObject3').huntingQueryVersion3]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
              "version": "[variables('huntingQueryObject4').huntingQueryVersion4]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
              "version": "[variables('huntingQueryObject5').huntingQueryVersion5]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
              "version": "[variables('huntingQueryObject6').huntingQueryVersion6]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
              "version": "[variables('huntingQueryObject7').huntingQueryVersion7]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
              "version": "[variables('huntingQueryObject8').huntingQueryVersion8]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
              "version": "[variables('huntingQueryObject9').huntingQueryVersion9]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
              "version": "[variables('huntingQueryObject10').huntingQueryVersion10]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId2')]",
              "version": "[variables('dataConnectorVersion2')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Create-Jira-Issue-alert-trigger')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Create-Jira-Issue-incident-trigger')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Jira-CreateAndUpdateIssue')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Sync-AssignedUser')]",
              "version": "[variables('playbookVersion4')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Add-JiraLinkComment')]",
              "version": "[variables('playbookVersion5')]"
            },
            {
              "kind": "AzureFunction",
              "contentId": "[variables('_Sync-CommentsFunctionApp')]",
              "version": "[variables('playbookVersion6')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Sync-Incidents')]",
              "version": "[variables('playbookVersion7')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Sync-Status')]",
              "version": "[variables('playbookVersion8')]"
            }
          ]
        },
        "firstPublishDate": "2022-01-10",
        "providers": [
          "Atlassian"
        ],
        "categories": {
          "domains": [
            "DevOps",
            "Security - Automation (SOAR)"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}