{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "SAP",
    "comments": "Solution template for SAP LogServ"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "SAP LogServ Insights Dashboard",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "_solutionName": "SAP LogServ",
    "_solutionVersion": "3.0.4",
    "solutionId": "sap_jasondau.azure-sentinel-solution-saplogserv",
    "_solutionId": "[variables('solutionId')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "SAPLogServObserve",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "4981469b-8618-43a7-b44c-5744594fa494",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4981469b-8618-43a7-b44c-5744594fa494')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4981469b-8618-43a7-b44c-5744594fa494')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','4981469b-8618-43a7-b44c-5744594fa494','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "e8394afb-82a7-4718-8d31-cc57ad352fa8",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'e8394afb-82a7-4718-8d31-cc57ad352fa8')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('e8394afb-82a7-4718-8d31-cc57ad352fa8')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','e8394afb-82a7-4718-8d31-cc57ad352fa8','-', '1.0.0')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "8fb9fb88-693f-4906-8be2-4bb9771418fc",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '8fb9fb88-693f-4906-8be2-4bb9771418fc')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('8fb9fb88-693f-4906-8be2-4bb9771418fc')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','8fb9fb88-693f-4906-8be2-4bb9771418fc','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "a9e4b02a-5a8c-4c59-9836-a204d1028632",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'a9e4b02a-5a8c-4c59-9836-a204d1028632')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('a9e4b02a-5a8c-4c59-9836-a204d1028632')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','a9e4b02a-5a8c-4c59-9836-a204d1028632','-', '1.0.0')))]"
    },
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "SAPLogServ",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "SAPLogServConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SAPLogServObserve Workbook with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "This workbook contains visualizations and insights in the SAP BTP environment."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# SAP LogServ Insights Dashboard\\n\\nReal-time monitoring of **SAP RISE infrastructure, private cloud edition component** log ingestion and system activity. Use the [Microsoft Sentinel Solution for SAP applications](https://learn.microsoft.com/azure/sentinel/sap/solution-overview) to complete your threat monitoring.\\n\\n>**ðŸ’¡ Learn More:** Visit our [Ultimate Blog Series: SAP LogServ Integration with Microsoft Sentinel](https://community.sap.com/t5/enterprise-resource-planning-blog-posts-by-members/ultimate-blog-series-sap-logserv-integration-with-microsoft-sentinel/ba-p/14126401) to discover advanced integration capabilities and best practices.\\n\\n**Data Freshness Status**\\n| ðŸŸ¢ Fresh (<1h): Current, actively flowing | ðŸŸ¡ Recent (1-6h): Slightly delayed, acceptable | ðŸŸ  Older (6-24h): May be experiencing delays | ðŸ”´ Stale (>24h): Ingestion may have stopped |\",\"style\":\"upsell\"},\"name\":\"title-header\"},{\"type\":1,\"content\":{\"json\":\"---\",\"style\":\"divider\"},\"name\":\"section-divider\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"workspace-param\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"label\":\"ðŸ¢ Log Analytics Workspace\",\"type\":5,\"isRequired\":true,\"query\":\"Resources\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\n| project value = id, label = name, selected = false\",\"crossComponentResources\":[\"value::all\"],\"typeSettings\":{\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"param-timerange\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"ðŸ• Time Range\",\"type\":4,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":604800000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":86400000}},{\"id\":\"param-clzdir\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ClzDir\",\"label\":\"ðŸ“ Log Type\",\"type\":2,\"query\":\"SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where isnotempty(clz_dir)\\n| summarize Count = count() by clz_dir\\n| order by Count desc\\n| project Value = clz_dir, Label = strcat(clz_dir, ' (', Count, ')'), Selected = false\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"param-clzsubdir\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ClzSubDir\",\"label\":\"ðŸ“‚ Log Sub-Type\",\"type\":2,\"query\":\"SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where isnotempty(clz_subdir)\\n| summarize Count = count() by clz_subdir\\n| order by Count desc\\n| project Value = clz_subdir, Label = strcat(clz_subdir, ' (', Count, ')'), Selected = false\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"param-status\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"StatusFilter\",\"label\":\"ðŸ“Š Activity Status\",\"type\":2,\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"jsonData\":\"[{\\\"value\\\":\\\"*\\\",\\\"label\\\":\\\"All Statuses\\\",\\\"selected\\\":true},{\\\"value\\\":\\\"ðŸŸ¢ Active\\\",\\\"label\\\":\\\"ðŸŸ¢ Active (<1h)\\\",\\\"selected\\\":false},{\\\"value\\\":\\\"ðŸŸ¡ Recent\\\",\\\"label\\\":\\\"ðŸŸ¡ Recent (1-6h)\\\",\\\"selected\\\":false},{\\\"value\\\":\\\"ðŸ”´ Inactive\\\",\\\"label\\\":\\\"ðŸ”´ Inactive (>6h)\\\",\\\"selected\\\":false}]\",\"defaultValue\":\"value::all\",\"queryType\":0}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"alert-workspace-param\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AlertWorkspace\",\"type\":5,\"isRequired\":true,\"query\":\"Resources\\n| where id =~ '{Workspace}'\\n| project value = id, label = id, selected = true\\n| take 1\",\"crossComponentResources\":[\"value::all\"],\"isHiddenWhenLocked\":true,\"typeSettings\":{\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"alert-location-param\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AlertLocation\",\"type\":1,\"isRequired\":true,\"query\":\"Resources\\n| where id =~ '{AlertWorkspace}'\\n| project location\",\"crossComponentResources\":[\"value::all\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"alert-rg-param\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AlertResourceGroup\",\"type\":1,\"isRequired\":true,\"query\":\"Resources\\n| where id =~ '{AlertWorkspace}'\\n| project rg = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup)\",\"crossComponentResources\":[\"value::all\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"conditionalVisibility\":{\"parameterName\":\"ShowAlertConfig\",\"comparison\":\"isEqualTo\",\"value\":\"true\"},\"name\":\"alert-parameters\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let filteredLogs = SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}';\\nfilteredLogs\\n| summarize TotalLogs = count()\\n| project Value = TotalLogs, Label = \\\"ðŸ“Š Total Events\\\"\",\"size\":1,\"timeContextFromParameter\":\"TimeRange\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Label\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Value\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":0}}},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"kpi-total-logs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let filteredLogs = SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}';\\nfilteredLogs\\n| summarize UniqueSystems = dcount(host)\\n| project Value = UniqueSystems, Label = \\\"ðŸ–¥ï¸ Active Systems\\\"\",\"size\":1,\"timeContextFromParameter\":\"TimeRange\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Label\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Value\",\"formatter\":12,\"formatOptions\":{\"palette\":\"green\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"kpi-active-systems\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let filteredLogs = SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}';\\nfilteredLogs\\n| summarize DataVolumeGB = round(sum(strlen(coalesce(Raw, \\\"\\\"))) / (1024.0 * 1024.0 * 1024.0), 2)\\n| project Value = DataVolumeGB, Label = \\\"ðŸ’¾ Data Volume (GB)\\\"\",\"size\":1,\"timeContextFromParameter\":\"TimeRange\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Label\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Value\",\"formatter\":12,\"formatOptions\":{\"palette\":\"orange\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"kpi-data-volume\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let filteredLogs = SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}';\\nfilteredLogs\\n| summarize LatestLogTime = max(TimeGenerated)\\n| extend \\n    DataFreshness = case(\\n        LatestLogTime >= ago(1h), \\\"ðŸŸ¢ Fresh\\\",\\n        LatestLogTime >= ago(6h), \\\"ðŸŸ¡ Recent\\\",\\n        LatestLogTime >= ago(24h), \\\"ðŸŸ  Older\\\",\\n        \\\"ðŸ”´ Stale\\\"\\n    )\\n| project Value = DataFreshness, Label = \\\"ðŸ”„ Data Status\\\"\",\"size\":1,\"timeContextFromParameter\":\"TimeRange\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Label\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Value\",\"formatter\":1},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"kpi-data-status\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let filteredLogs = SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}';\\nfilteredLogs\\n| summarize LatestLogTime = max(TimeGenerated)\\n| extend FormattedTime = strcat(format_datetime(LatestLogTime, 'yyyy-MM-dd HH:mm:ss'), ' UTC')\\n| project Value = FormattedTime, Label = \\\"â° Most Recent Data\\\"\",\"size\":1,\"timeContextFromParameter\":\"TimeRange\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Label\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Value\",\"formatter\":1},\"showBorder\":false}},\"customWidth\":\"20\",\"name\":\"kpi-latest-log\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Alert Configuration\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"alert-type-selector\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AlertType\",\"label\":\"Alert Type\",\"type\":2,\"description\":\"Choose the type of alert to create\",\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[{\\\"value\\\":\\\"count\\\",\\\"label\\\":\\\"ðŸš¨ Volume Count Alert - Triggers when hourly event count exceeds threshold\\\",\\\"selected\\\":true},{\\\"value\\\":\\\"change\\\",\\\"label\\\":\\\"ðŸ“Š Volume Change Alert - Triggers when volume changes significantly\\\",\\\"selected\\\":false}]\",\"value\":\"change\"},{\"id\":\"unified-alert-name\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AlertName\",\"label\":\"Alert Name\",\"type\":1,\"description\":\"Name for the alert rule\",\"value\":\"SAP LogServ - Volume Change Alert\",\"typeSettings\":{\"paramValidationRules\":[{\"regExp\":\"^[a-zA-Z0-9-_ \\\\(\\\\)]+$\",\"match\":true,\"message\":\"Alert name can only contain alphanumeric characters, spaces, hyphens, underscores, and parentheses\"}]}},{\"id\":\"unified-threshold\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AlertThreshold\",\"label\":\"Threshold\",\"type\":1,\"description\":\"Alert threshold (events for count alert, percentage for change alert)\",\"value\":\"10\",\"typeSettings\":{\"paramValidationRules\":[{\"regExp\":\"^[0-9]+$\",\"match\":true,\"message\":\"Please enter a valid number\"}]}},{\"id\":\"unified-severity\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AlertSeverity\",\"label\":\"Severity\",\"type\":2,\"description\":\"Alert severity level\",\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[{\\\"value\\\":\\\"0\\\",\\\"label\\\":\\\"Critical\\\",\\\"selected\\\":false},{\\\"value\\\":\\\"1\\\",\\\"label\\\":\\\"Error\\\",\\\"selected\\\":false},{\\\"value\\\":\\\"2\\\",\\\"label\\\":\\\"Warning\\\",\\\"selected\\\":true},{\\\"value\\\":\\\"3\\\",\\\"label\\\":\\\"Informational\\\",\\\"selected\\\":false},{\\\"value\\\":\\\"4\\\",\\\"label\\\":\\\"Verbose\\\",\\\"selected\\\":false}]\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"unified-alert-params\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"nav\",\"links\":[{\"id\":\"create-unified-alert-link\",\"linkTarget\":\"ArmTemplate\",\"linkLabel\":\"Create Alert Rule\",\"style\":\"primary\",\"linkIsContextBlade\":true,\"templateRunContext\":{\"componentIdSource\":\"parameter\",\"componentId\":\"AlertResourceGroup\",\"templateUriSource\":\"static\",\"templateUri\":\"Community-Workbooks/Workloads/Alerts/log-metric-noag.armtemplate\",\"templateParameters\":[{\"name\":\"alertName\",\"source\":\"parameter\",\"value\":\"AlertName\",\"kind\":\"stringValue\"},{\"name\":\"alertLocation\",\"source\":\"parameter\",\"value\":\"AlertLocation\",\"kind\":\"stringValue\"},{\"name\":\"dataSourceId\",\"source\":\"parameter\",\"value\":\"AlertWorkspace\",\"kind\":\"stringValue\"},{\"name\":\"alertThreshold\",\"source\":\"parameter\",\"value\":\"AlertThreshold\",\"kind\":\"stringValue\"},{\"name\":\"alertOperator\",\"source\":\"static\",\"value\":\"GreaterThan\",\"kind\":\"stringValue\"},{\"name\":\"alertMetricThreshold\",\"source\":\"static\",\"value\":\"1\",\"kind\":\"stringValue\"},{\"name\":\"alertMetricOperator\",\"source\":\"static\",\"value\":\"GreaterThan\",\"kind\":\"stringValue\"},{\"name\":\"alertMetricType\",\"source\":\"static\",\"value\":\"Total\",\"kind\":\"stringValue\"},{\"name\":\"alertMetricColumn\",\"source\":\"static\",\"value\":\"LogCount\",\"kind\":\"stringValue\"},{\"name\":\"alertQuery\",\"source\":\"static\",\"value\":\"SAPLogServ_CL | where isnotempty(clz_dir) and isnotempty(clz_subdir) | summarize AggregatedValue = count() by bin(TimeGenerated, 1h)\",\"kind\":\"stringValue\"},{\"name\":\"alertDescription\",\"source\":\"static\",\"value\":\"Alert triggered when SAP LogServ event volume exceeds monitoring threshold\",\"kind\":\"stringValue\"},{\"name\":\"alertSeverity\",\"source\":\"parameter\",\"value\":\"AlertSeverity\",\"kind\":\"stringValue\"},{\"name\":\"profileId\",\"source\":\"static\",\"value\":\"SAP-LogServ-Profile\",\"kind\":\"stringValue\"},{\"name\":\"alertTemplateId\",\"source\":\"static\",\"value\":\"SAP-LogServ-Alert\",\"kind\":\"stringValue\"}],\"titleSource\":\"static\",\"title\":\"Create SAP LogServ Alert Rule\",\"descriptionSource\":\"static\",\"description\":\"This will create an alert rule that monitors SAP LogServ event volume based on your selected criteria.\",\"runLabelSource\":\"static\",\"runLabel\":\"Deploy Alert Rule\"}}]},\"name\":\"create-unified-alert-button\"}]},\"name\":\"unified-alert-config\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\\n| make-series LogCount = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1h\",\"size\":0,\"title\":\"ðŸ“ˆ Log Volume Timeline\",\"timeContextFromParameter\":\"TimeRange\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\"},\"customWidth\":\"100\",\"name\":\"volume-timeline\"}]},\"customWidth\":\"100\",\"name\":\"volume-timeline-with-alerts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\\n| where isnotempty(clz_subdir)\\n| summarize LogCount = count() by clz_subdir\\n| order by LogCount desc\\n| project SubType = clz_subdir, Count = LogCount\\n| take 10\",\"size\":1,\"title\":\"ðŸ“‚ Sub-Type Distribution (Top 10)\",\"timeContextFromParameter\":\"TimeRange\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"chartSettings\":{\"xAxis\":\"SubType\",\"yAxis\":[\"Count\"],\"seriesLabelSettings\":[{\"seriesName\":\"Count\",\"color\":\"#7E58FF\"}]}},\"customWidth\":\"50\",\"name\":\"subtype-bar\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\\n| where isnotempty(clz_dir)\\n| summarize LogCount = count() by clz_dir\\n| order by LogCount desc\\n| project Classification = clz_dir, Count = LogCount\",\"size\":1,\"title\":\"ðŸ—ï¸ Log Type Distribution\",\"timeContextFromParameter\":\"TimeRange\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Count\",\"color\":\"#0F828F\"}]}},\"customWidth\":\"50\",\"name\":\"classification-pie\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\\n| summarize \\n    LogCount = count(),\\n    LatestActivity = max(TimeGenerated),\\n    DataSizeGB = round(sum(strlen(coalesce(Raw, \\\"\\\"))) / (1024.0 * 1024.0 * 1024.0), 3),\\n    UniqueTypes = dcount(clz_dir),\\n    UniqueSubTypes = dcount(clz_subdir)\\n    by host\\n| order by LogCount desc\\n| extend \\n    ActivityStatus = case(\\n        LatestActivity >= ago(1h), \\\"ðŸŸ¢ Active\\\",\\n        LatestActivity >= ago(6h), \\\"ðŸŸ¡ Recent\\\",\\n        \\\"ðŸ”´ Inactive\\\"\\n    ),\\n    FormattedLatest = strcat(format_datetime(LatestActivity, 'yyyy-MM-dd HH:mm:ss'), ' UTC')\\n| where '{StatusFilter}' == '*' or ActivityStatus == '{StatusFilter}'\\n| project \\n    ['ðŸ–¥ï¸ System'] = host,\\n    ['ðŸ“ˆ Event Count'] = LogCount,\\n    ['ðŸ’¾ GB'] = DataSizeGB,\\n    ['ðŸ“ Types'] = UniqueTypes,\\n    ['ðŸ“‚ Sub-Types'] = UniqueSubTypes,\\n    ['â° Latest'] = FormattedLatest,\\n    ['ðŸ“Š Status'] = ActivityStatus\\n| take 15\",\"size\":0,\"title\":\"ðŸ–¥ï¸ System Analysis by Log Types\",\"timeContextFromParameter\":\"TimeRange\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ðŸ“ˆ Event Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"blue\"}},{\"columnMatch\":\"ðŸ’¾ GB\",\"formatter\":4,\"formatOptions\":{\"palette\":\"green\"}},{\"columnMatch\":\"ðŸ“ Types\",\"formatter\":4,\"formatOptions\":{\"palette\":\"purple\"}},{\"columnMatch\":\"ðŸ“‚ Sub-Types\",\"formatter\":4,\"formatOptions\":{\"palette\":\"orange\"}},{\"columnMatch\":\"â° Latest\",\"formatter\":1}]}},\"name\":\"systems-analysis\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SAPLogServ_CL\\n| where TimeGenerated >= {TimeRange:start}\\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\\n| where isnotempty(clz_dir) and isnotempty(clz_subdir)\\n| summarize \\n    LogCount = count(),\\n    UniqueHosts = dcount(host),\\n    LatestActivity = max(TimeGenerated),\\n    DataSizeGB = round(sum(strlen(coalesce(Raw, \\\"\\\"))) / (1024.0 * 1024.0 * 1024.0), 3)\\n    by clz_dir, clz_subdir\\n| order by LogCount desc\\n| extend \\n    ActivityStatus = case(\\n        LatestActivity >= ago(1h), \\\"ðŸŸ¢ Active\\\",\\n        LatestActivity >= ago(6h), \\\"ðŸŸ¡ Recent\\\",\\n        \\\"ðŸ”´ Inactive\\\"\\n    ),\\n    FormattedLatest = strcat(format_datetime(LatestActivity, 'yyyy-MM-dd HH:mm:ss'), ' UTC')\\n| where '{StatusFilter}' == '*' or ActivityStatus == '{StatusFilter}'\\n| project \\n    ['ðŸ“ Log Type'] = clz_dir,\\n    ['ðŸ“‚ Sub-Type'] = clz_subdir,\\n    ['ðŸ“ˆ Events'] = LogCount,\\n    ['ðŸ–¥ï¸ Hosts'] = UniqueHosts,\\n    ['ðŸ’¾ GB'] = DataSizeGB,\\n    ['â° Latest'] = FormattedLatest,\\n    ['ðŸ“Š Status'] = ActivityStatus\\n| take 20\",\"size\":0,\"title\":\"ðŸ” Detailed Type/Sub-Type Analysis\",\"timeContextFromParameter\":\"TimeRange\",\"crossComponentResources\":[\"{Workspace}\"],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ðŸ“ˆ Events\",\"formatter\":4,\"formatOptions\":{\"palette\":\"blue\"}},{\"columnMatch\":\"ðŸ–¥ï¸ Hosts\",\"formatter\":4,\"formatOptions\":{\"palette\":\"green\"}},{\"columnMatch\":\"ðŸ’¾ GB\",\"formatter\":4,\"formatOptions\":{\"palette\":\"orange\"}},{\"columnMatch\":\"â° Latest\",\"formatter\":1}],\"sortBy\":[{\"itemKey\":\"$gen_bar_ðŸ“ˆ Events_2\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"$gen_bar_ðŸ“ˆ Events_2\",\"sortOrder\":2}]},\"name\":\"detailed-analysis\"}]},\"name\":\"main-analysis\"}],\"styleSettings\":{\"spacingStyle\":\"small\"},\"fromTemplateId\":\"sentinel-SAPLogServObserve\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=SAPLogServObserve; logoFileName=SAPBTP.svg; description=This workbook contains visualizations and insights in the SAP BTP environment.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=SAP LogServ Insights Dashboard; templateRelativePath=SAPLogServObserve.json; subtitle=; provider=SAP}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "SAP LogServ",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SAP"
                },
                "support": {
                  "name": "SAP",
                  "tier": "Partner",
                  "link": "https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/announcing-limited-preview-of-sap-logserv-integration-with-microsoft/ba-p/13942180"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "SAPLogServ_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SAPLogServ",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SAPLogServ-AssignAdminAuthorizations_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies admin privileges/roles assignment.\n\nSource Action: Assign a user with any Admin role / privileges.\n\n*Data Sources: SAP LogServ - HANA DB (Syslog)*",
                "displayName": "SAP LogServ - HANA DB - Assign Admin Authorizations",
                "enabled": false,
                "query": "let AuditTimeAgo = 60m;\nSAPLogServ_CL\n| where TimeGenerated >= ago(AuditTimeAgo)\n| where clz_subdir == \"hanaaudit\"\n| extend raw_split = split(Raw, \";\")\n| extend\n  event_timestamp__col_0 = tostring(raw_split[0]), \n  service_name__col_1 = tostring(raw_split[1]), \n  hostname__col_2 = tostring(raw_split[2]), \n  sid__col_3 = tostring(raw_split[3]), \n  instance_number__col_4 = tostring(raw_split[4]), \n  port_number__col_5 = tostring(raw_split[5]), \n  database_name__col_6 = tostring(raw_split[6]), \n  client_ip_address__col_7 = tostring(raw_split[7]), \n  client_name__col_8 = tostring(raw_split[8]), \n  client_process_id__col_9 = tostring(raw_split[9]), \n  client_port_number__col_10 = tostring(raw_split[10]), \n  policy_name__col_11 = tostring(raw_split[11]), \n  audit_level__col_12 = tostring(raw_split[12]), \n  audit_action__col_13 = tostring(raw_split[13]), \n  session_user__col_14 = tostring(raw_split[14]), \n  target_schema__col_15 = tostring(raw_split[15]), \n  target_object__col_16 = tostring(raw_split[16]), \n  privilege_name__col_17 = tostring(raw_split[17]), \n  grantable__col_18 = tostring(raw_split[18]), \n  role_name__col_19 = tostring(raw_split[19]), \n  target_principal__col_20 = tostring(raw_split[20]), \n  action_status__col_21 = tostring(raw_split[21]), \n  component__col_22 = tostring(raw_split[22]), \n  section__col_23 = tostring(raw_split[23]), \n  parameter__col_24 = tostring(raw_split[24]), \n  old_value__col_25 = tostring(raw_split[25]), \n  new_value__col_26 = tostring(raw_split[26]), \n  comment__col_27 = tostring(raw_split[27]), \n  executed_statement__col_28 = tostring(raw_split[28]), \n  session_id__col_29 = tostring(raw_split[29]), \n  application_user_name__col_30 = tostring(raw_split[30]), \n  role_schema_name__col_31 = tostring(raw_split[31]), \n  grantee_schema_name__col_32 = tostring(raw_split[32]), \n  origin_database_name__col_33 = tostring(raw_split[33]), \n  origin_user_name__col_34 = tostring(raw_split[34]), \n  xs_application_user_name__col_35 = tostring(raw_split[35]), \n  application_name__col_36 = tostring(raw_split[36]), \n  statement_user_name__col_37 = tostring(raw_split[37]), \n  create_time__col_38 = tostring(raw_split[38]), \n  xsa_message_ip__col_39 = tostring(raw_split[39]), \n  xsa_tenant__col_40 = tostring(raw_split[40]), \n  xsa_uuid__col_41 = tostring(raw_split[41]), \n  xsa_channel__col_42 = tostring(raw_split[42]), \n  xsa_attachment_id__col_43 = tostring(raw_split[43]), \n  xsa_attachment_name__col_44 = tostring(raw_split[44]), \n  xsa_organization_id__col_45 = tostring(raw_split[45]), \n  xsa_space_id__col_46 = tostring(raw_split[46]), \n  xsa_instance_id__col_47 = tostring(raw_split[47]), \n  xsa_binding_id__col_48 = tostring(raw_split[48]), \n  xsa_object__col_49 = tostring(raw_split[49]), \n  xsa_data_subject__col_50 = tostring(raw_split[50])\n| where \n  audit_action__col_13 =~ \"GRANT PRIVILEGE\"\n  and privilege_name__col_17 contains \"ADMIN\"\n| extend AlertRuleUniqueName = 'hanadb-assignadminauthorizations-logserv'\n",
                "queryFrequency": "PT10M",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SAPLogServ_CL"
                    ],
                    "connectorId": "SAPLogServ"
                  }
                ],
                "tactics": [
                  "PrivilegeEscalation"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "sid__col_3",
                        "identifier": "AppId"
                      },
                      {
                        "columnName": "database_name__col_6",
                        "identifier": "InstanceName"
                      }
                    ],
                    "entityType": "CloudApplication"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "hostname__col_2",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "client_ip_address__col_7",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "customDetails": {
                  "SAP_User": "session_user__col_14"
                },
                "alertDetailsOverride": {
                  "alertDescriptionFormat": "{{comment__col_27}}\n",
                  "alertDisplayNameFormat": "SAP LogServ - HANA DB - Assign Admin Authorizations"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "SAP LogServ Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "SAP LogServ",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SAP"
                },
                "support": {
                  "name": "SAP",
                  "tier": "Partner",
                  "link": "https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/announcing-limited-preview-of-sap-logserv-integration-with-microsoft/ba-p/13942180"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "SAP LogServ - HANA DB - Assign Admin Authorizations",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SAPLogServ-AuditTrailPolicyChanges_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies changes for HANA DB audit trail policies.\n\nSource Action: Create / update existing audit policy in security definitions.\n\n*Data Sources: SAP LogServ - HANA DB (Syslog)*",
                "displayName": "SAP LogServ - HANA DB - Audit Trail Policy Changes",
                "enabled": false,
                "query": "let AuditTimeAgo = 60m;\nSAPLogServ_CL\n| where TimeGenerated >= ago(AuditTimeAgo)\n| where clz_subdir == \"hanaaudit\"\n| extend raw_split = split(Raw, \";\")\n| extend\n  event_timestamp__col_0 = tostring(raw_split[0]), \n  service_name__col_1 = tostring(raw_split[1]), \n  hostname__col_2 = tostring(raw_split[2]), \n  sid__col_3 = tostring(raw_split[3]), \n  instance_number__col_4 = tostring(raw_split[4]), \n  port_number__col_5 = tostring(raw_split[5]), \n  database_name__col_6 = tostring(raw_split[6]), \n  client_ip_address__col_7 = tostring(raw_split[7]), \n  client_name__col_8 = tostring(raw_split[8]), \n  client_process_id__col_9 = tostring(raw_split[9]), \n  client_port_number__col_10 = tostring(raw_split[10]), \n  policy_name__col_11 = tostring(raw_split[11]), \n  audit_level__col_12 = tostring(raw_split[12]), \n  audit_action__col_13 = tostring(raw_split[13]), \n  session_user__col_14 = tostring(raw_split[14]), \n  target_schema__col_15 = tostring(raw_split[15]), \n  target_object__col_16 = tostring(raw_split[16]), \n  privilege_name__col_17 = tostring(raw_split[17]), \n  grantable__col_18 = tostring(raw_split[18]), \n  role_name__col_19 = tostring(raw_split[19]), \n  target_principal__col_20 = tostring(raw_split[20]), \n  action_status__col_21 = tostring(raw_split[21]), \n  component__col_22 = tostring(raw_split[22]), \n  section__col_23 = tostring(raw_split[23]), \n  parameter__col_24 = tostring(raw_split[24]), \n  old_value__col_25 = tostring(raw_split[25]), \n  new_value__col_26 = tostring(raw_split[26]), \n  comment__col_27 = tostring(raw_split[27]), \n  executed_statement__col_28 = tostring(raw_split[28]), \n  session_id__col_29 = tostring(raw_split[29]), \n  application_user_name__col_30 = tostring(raw_split[30]), \n  role_schema_name__col_31 = tostring(raw_split[31]), \n  grantee_schema_name__col_32 = tostring(raw_split[32]), \n  origin_database_name__col_33 = tostring(raw_split[33]), \n  origin_user_name__col_34 = tostring(raw_split[34]), \n  xs_application_user_name__col_35 = tostring(raw_split[35]), \n  application_name__col_36 = tostring(raw_split[36]), \n  statement_user_name__col_37 = tostring(raw_split[37]), \n  create_time__col_38 = tostring(raw_split[38]), \n  xsa_message_ip__col_39 = tostring(raw_split[39]), \n  xsa_tenant__col_40 = tostring(raw_split[40]), \n  xsa_uuid__col_41 = tostring(raw_split[41]), \n  xsa_channel__col_42 = tostring(raw_split[42]), \n  xsa_attachment_id__col_43 = tostring(raw_split[43]), \n  xsa_attachment_name__col_44 = tostring(raw_split[44]), \n  xsa_organization_id__col_45 = tostring(raw_split[45]), \n  xsa_space_id__col_46 = tostring(raw_split[46]), \n  xsa_instance_id__col_47 = tostring(raw_split[47]), \n  xsa_binding_id__col_48 = tostring(raw_split[48]), \n  xsa_object__col_49 = tostring(raw_split[49]), \n  xsa_data_subject__col_50 = tostring(raw_split[50])\n| where audit_action__col_13 contains 'AUDIT POLICY' \n| extend AlertRuleUniqueName = 'hanadb-audittrailpolicychanges-logserv'\n",
                "queryFrequency": "PT10M",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SAPLogServ_CL"
                    ],
                    "connectorId": "SAPLogServ"
                  }
                ],
                "tactics": [
                  "Persistence",
                  "LateralMovement",
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "sid__col_3",
                        "identifier": "AppId"
                      },
                      {
                        "columnName": "database_name__col_6",
                        "identifier": "InstanceName"
                      }
                    ],
                    "entityType": "CloudApplication"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "hostname__col_2",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "client_ip_address__col_7",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "customDetails": {
                  "SAP_User": "session_user__col_14"
                },
                "alertDetailsOverride": {
                  "alertDescriptionFormat": "{{comment__col_27}}\n",
                  "alertDisplayNameFormat": "SAP LogServ - HANA DB - Audit Trail Policy Change"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "SAP LogServ Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "SAP LogServ",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SAP"
                },
                "support": {
                  "name": "SAP",
                  "tier": "Partner",
                  "link": "https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/announcing-limited-preview-of-sap-logserv-integration-with-microsoft/ba-p/13942180"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "SAP LogServ - HANA DB - Audit Trail Policy Changes",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SAPLogServ-DeactivationofAuditTrail_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies deactivation of HANA DB audit log.\n\nSource Action: Deactivate Audit Log in HANA DB security defnitions.\n\n*Data Sources: SAP LogServ - HANA DB (Syslog)*",
                "displayName": "SAP LogServ - HANA DB - Deactivation of Audit Trail",
                "enabled": false,
                "query": "let AuditTimeAgo = 60m;\nSAPLogServ_CL\n| where TimeGenerated >= ago(AuditTimeAgo)\n| where clz_subdir == \"hanaaudit\"\n| extend raw_split = split(Raw, \";\")\n| extend\n  event_timestamp__col_0 = tostring(raw_split[0]), \n  service_name__col_1 = tostring(raw_split[1]), \n  hostname__col_2 = tostring(raw_split[2]), \n  sid__col_3 = tostring(raw_split[3]), \n  instance_number__col_4 = tostring(raw_split[4]), \n  port_number__col_5 = tostring(raw_split[5]), \n  database_name__col_6 = tostring(raw_split[6]), \n  client_ip_address__col_7 = tostring(raw_split[7]), \n  client_name__col_8 = tostring(raw_split[8]), \n  client_process_id__col_9 = tostring(raw_split[9]), \n  client_port_number__col_10 = tostring(raw_split[10]), \n  policy_name__col_11 = tostring(raw_split[11]), \n  audit_level__col_12 = tostring(raw_split[12]), \n  audit_action__col_13 = tostring(raw_split[13]), \n  session_user__col_14 = tostring(raw_split[14]), \n  target_schema__col_15 = tostring(raw_split[15]), \n  target_object__col_16 = tostring(raw_split[16]), \n  privilege_name__col_17 = tostring(raw_split[17]), \n  grantable__col_18 = tostring(raw_split[18]), \n  role_name__col_19 = tostring(raw_split[19]), \n  target_principal__col_20 = tostring(raw_split[20]), \n  action_status__col_21 = tostring(raw_split[21]), \n  component__col_22 = tostring(raw_split[22]), \n  section__col_23 = tostring(raw_split[23]), \n  parameter__col_24 = tostring(raw_split[24]), \n  old_value__col_25 = tostring(raw_split[25]), \n  new_value__col_26 = tostring(raw_split[26]), \n  comment__col_27 = tostring(raw_split[27]), \n  executed_statement__col_28 = tostring(raw_split[28]), \n  session_id__col_29 = tostring(raw_split[29]), \n  application_user_name__col_30 = tostring(raw_split[30]), \n  role_schema_name__col_31 = tostring(raw_split[31]), \n  grantee_schema_name__col_32 = tostring(raw_split[32]), \n  origin_database_name__col_33 = tostring(raw_split[33]), \n  origin_user_name__col_34 = tostring(raw_split[34]), \n  xs_application_user_name__col_35 = tostring(raw_split[35]), \n  application_name__col_36 = tostring(raw_split[36]), \n  statement_user_name__col_37 = tostring(raw_split[37]), \n  create_time__col_38 = tostring(raw_split[38]), \n  xsa_message_ip__col_39 = tostring(raw_split[39]), \n  xsa_tenant__col_40 = tostring(raw_split[40]), \n  xsa_uuid__col_41 = tostring(raw_split[41]), \n  xsa_channel__col_42 = tostring(raw_split[42]), \n  xsa_attachment_id__col_43 = tostring(raw_split[43]), \n  xsa_attachment_name__col_44 = tostring(raw_split[44]), \n  xsa_organization_id__col_45 = tostring(raw_split[45]), \n  xsa_space_id__col_46 = tostring(raw_split[46]), \n  xsa_instance_id__col_47 = tostring(raw_split[47]), \n  xsa_binding_id__col_48 = tostring(raw_split[48]), \n  xsa_object__col_49 = tostring(raw_split[49]), \n  xsa_data_subject__col_50 = tostring(raw_split[50])\n| where \n  audit_action__col_13 contains \"AUDIT CONFIGURATION\" and \n  parameter__col_24 =~ \"global_auditing_state\" and\n  new_value__col_26 =~ \"false\"\n| extend AlertRuleUniqueName = 'hanadb-deactivationofaudittrail-logserv'\n",
                "queryFrequency": "PT10M",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SAPLogServ_CL"
                    ],
                    "connectorId": "SAPLogServ"
                  }
                ],
                "tactics": [
                  "Persistence",
                  "LateralMovement",
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "sid__col_3",
                        "identifier": "AppId"
                      },
                      {
                        "columnName": "database_name__col_6",
                        "identifier": "InstanceName"
                      }
                    ],
                    "entityType": "CloudApplication"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "hostname__col_2",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "client_ip_address__col_7",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "customDetails": {
                  "SAP_User": "session_user__col_14"
                },
                "alertDetailsOverride": {
                  "alertDescriptionFormat": "{{comment__col_27}}\n",
                  "alertDisplayNameFormat": "SAP LogServ - HANA DB - Deactivation of Audit Trail"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "SAP LogServ Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "SAP LogServ",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SAP"
                },
                "support": {
                  "name": "SAP",
                  "tier": "Partner",
                  "link": "https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/announcing-limited-preview-of-sap-logserv-integration-with-microsoft/ba-p/13942180"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "SAP LogServ - HANA DB - Deactivation of Audit Trail",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SAPLogServ-UserAdminActions_AnalyticalRules Analytics Rule with template version 3.0.4",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies user administration actions.\n\nSouirce Action: Create/Update/Delete a DB User.\n\n*Data Sources: SAP LogServ - HANA DB (Syslog)*",
                "displayName": "SAP LogServ - HANA DB - User Admin actions",
                "enabled": false,
                "query": "let AuditTimeAgo = 60m;\nSAPLogServ_CL\n| where TimeGenerated >= ago(AuditTimeAgo)\n| where clz_subdir == \"hanaaudit\"\n| extend raw_split = split(Raw, \";\")\n| extend\n  event_timestamp__col_0 = tostring(raw_split[0]), \n  service_name__col_1 = tostring(raw_split[1]), \n  hostname__col_2 = tostring(raw_split[2]), \n  sid__col_3 = tostring(raw_split[3]), \n  instance_number__col_4 = tostring(raw_split[4]), \n  port_number__col_5 = tostring(raw_split[5]), \n  database_name__col_6 = tostring(raw_split[6]), \n  client_ip_address__col_7 = tostring(raw_split[7]), \n  client_name__col_8 = tostring(raw_split[8]), \n  client_process_id__col_9 = tostring(raw_split[9]), \n  client_port_number__col_10 = tostring(raw_split[10]), \n  policy_name__col_11 = tostring(raw_split[11]), \n  audit_level__col_12 = tostring(raw_split[12]), \n  audit_action__col_13 = tostring(raw_split[13]), \n  session_user__col_14 = tostring(raw_split[14]), \n  target_schema__col_15 = tostring(raw_split[15]), \n  target_object__col_16 = tostring(raw_split[16]), \n  privilege_name__col_17 = tostring(raw_split[17]), \n  grantable__col_18 = tostring(raw_split[18]), \n  role_name__col_19 = tostring(raw_split[19]), \n  target_principal__col_20 = tostring(raw_split[20]), \n  action_status__col_21 = tostring(raw_split[21]), \n  component__col_22 = tostring(raw_split[22]), \n  section__col_23 = tostring(raw_split[23]), \n  parameter__col_24 = tostring(raw_split[24]), \n  old_value__col_25 = tostring(raw_split[25]), \n  new_value__col_26 = tostring(raw_split[26]), \n  comment__col_27 = tostring(raw_split[27]), \n  executed_statement__col_28 = tostring(raw_split[28]), \n  session_id__col_29 = tostring(raw_split[29]), \n  application_user_name__col_30 = tostring(raw_split[30]), \n  role_schema_name__col_31 = tostring(raw_split[31]), \n  grantee_schema_name__col_32 = tostring(raw_split[32]), \n  origin_database_name__col_33 = tostring(raw_split[33]), \n  origin_user_name__col_34 = tostring(raw_split[34]), \n  xs_application_user_name__col_35 = tostring(raw_split[35]), \n  application_name__col_36 = tostring(raw_split[36]), \n  statement_user_name__col_37 = tostring(raw_split[37]), \n  create_time__col_38 = tostring(raw_split[38]), \n  xsa_message_ip__col_39 = tostring(raw_split[39]), \n  xsa_tenant__col_40 = tostring(raw_split[40]), \n  xsa_uuid__col_41 = tostring(raw_split[41]), \n  xsa_channel__col_42 = tostring(raw_split[42]), \n  xsa_attachment_id__col_43 = tostring(raw_split[43]), \n  xsa_attachment_name__col_44 = tostring(raw_split[44]), \n  xsa_organization_id__col_45 = tostring(raw_split[45]), \n  xsa_space_id__col_46 = tostring(raw_split[46]), \n  xsa_instance_id__col_47 = tostring(raw_split[47]), \n  xsa_binding_id__col_48 = tostring(raw_split[48]), \n  xsa_object__col_49 = tostring(raw_split[49]), \n  xsa_data_subject__col_50 = tostring(raw_split[50])\n| where \n  audit_action__col_13 =~ \"CREATE USER\" or\n  audit_action__col_13 =~ 'ALTER USER' or\n  audit_action__col_13 =~ 'DROP USER' or\n  audit_action__col_13 =~ 'DROP SCHEMA'\n| extend AlertRuleUniqueName = 'hanadb-useradminactions-logserv'\n",
                "queryFrequency": "PT10M",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "SAPLogServ_CL"
                    ],
                    "connectorId": "SAPLogServ"
                  }
                ],
                "tactics": [
                  "PrivilegeEscalation"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "sid__col_3",
                        "identifier": "AppId"
                      },
                      {
                        "columnName": "database_name__col_6",
                        "identifier": "InstanceName"
                      }
                    ],
                    "entityType": "CloudApplication"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "hostname__col_2",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "client_ip_address__col_7",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "customDetails": {
                  "SAP_User": "session_user__col_14"
                },
                "alertDetailsOverride": {
                  "alertDescriptionFormat": "{{comment__col_27}}\n",
                  "alertDisplayNameFormat": "SAP LogServ - HANA DB - User Admin actions"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "SAP LogServ Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "SAP LogServ",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SAP"
                },
                "support": {
                  "name": "SAP",
                  "tier": "Partner",
                  "link": "https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/announcing-limited-preview-of-sap-logserv-integration-with-microsoft/ba-p/13942180"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "SAP LogServ - HANA DB - User Admin actions",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "SAP LogServ (RISE), S/4HANA Cloud private edition",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "SAPLogServ",
                  "title": "SAP LogServ (RISE), S/4HANA Cloud private edition",
                  "publisher": "SAP SE",
                  "logo": "SapLogo.svg",
                  "descriptionMarkdown": "SAP LogServ is an SAP Enterprise Cloud Services (ECS) service aimed at collection, storage, forwarding and access of logs. LogServ centralizes the logs from all systems, applications, and ECS services used by a registered customer. <br> Main Features include:<br>Near Realtime Log Collection: With ability to integrate into Microsoft Sentinel as SIEM solution.<br>LogServ complements the existing SAP application layer threat monitoring and detections in Microsoft Sentinel with the log types owned by SAP ECS as the system provider. This includes logs like: SAP Security Audit Log (AS ABAP), HANA database, AS JAVA, ICM, SAP Web Dispatcher, SAP Cloud Connector, OS, SAP Gateway, 3rd party Database, Network, DNS, Proxy, Firewall",
                  "graphQueriesTableName": "SAPLogServ_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total events received",
                      "legend": "Tenant",
                      "baseQuery": "{{graphQueriesTableName}} | project TimeGenerated"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Get Sample Events",
                      "query": "{{graphQueriesTableName}}\n | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "availability": {
                    "isPreview": true
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft Entra",
                        "description": "Permission to create an app registration in Microsoft Entra ID. Typically requires Entra ID Application Developer role or higher."
                      },
                      {
                        "name": "Microsoft Azure",
                        "description": "Permission to assign Monitoring Metrics Publisher role on data collection rules. Typically requires Azure RBAC Owner or User Access Administrator role."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "title": "1. Create ARM Resources and Provide the Required Permissions",
                      "description": "We will create data collection rule (DCR) and data collection endpoint (DCE) resources. We will also create a Microsoft Entra app registration and assign the required permissions to it.",
                      "instructions": [
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "#### Automated deployment of Azure resources\nClicking on \"Deploy push connector resources\" will trigger the creation of DCR and DCE resources.\nIt will then create a Microsoft Entra app registration with client secret and grant permissions on the DCR. This setup enables data to be sent securely to the DCR using a OAuth v2 client credentials."
                          }
                        },
                        {
                          "parameters": {
                            "label": "Deploy push connector resources",
                            "applicationDisplayName": "SAP LogServ push to Microsoft Sentinel"
                          },
                          "type": "DeployPushConnectorButton_test"
                        }
                      ]
                    },
                    {
                      "title": "2. Maintain the data collection endpoint details and authentication info in SAP LogServ",
                      "description": "Share the data collection endpoint URL and authentication info with the SAP LogServ administrator to configure the SAP LogServ to send data to the data collection endpoint.\n\nLearn more from [this blog series](https://community.sap.com/t5/enterprise-resource-planning-blog-posts-by-members/ultimate-blog-series-sap-logserv-integration-with-microsoft-sentinel/ba-p/14126401).",
                      "instructions": [
                        {
                          "parameters": {
                            "label": "Use this value to configure as Tenant ID in the LogIngestionAPI credential.",
                            "fillWith": [
                              "TenantId"
                            ]
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "Entra Application ID",
                            "fillWith": [
                              "ApplicationId"
                            ],
                            "placeholder": "Deploy push connector to get the Application ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "Entra Application Secret",
                            "fillWith": [
                              "ApplicationSecret"
                            ],
                            "placeholder": "Deploy push connector to get the Application Secret"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "Use this value to configure the LogsIngestionURL parameter when deploying the IFlow.",
                            "fillWith": [
                              "DataCollectionEndpoint"
                            ],
                            "placeholder": "Deploy push connector to get the DCE URI"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "label": "DCR Immutable ID",
                            "fillWith": [
                              "DataCollectionRuleId"
                            ],
                            "placeholder": "Deploy push connector to get the DCR ID"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "SAP"
                },
                "support": {
                  "name": "SAP",
                  "tier": "Partner",
                  "link": "https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/announcing-limited-preview-of-sap-logserv-integration-with-microsoft/ba-p/13942180"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "SAPLogServ-DCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-SAPLogServ_CL": {
                    "columns": [
                      {
                        "name": "TimeGenerated",
                        "type": "datetime"
                      },
                      {
                        "name": "_raw",
                        "type": "string"
                      },
                      {
                        "name": "_time",
                        "type": "real"
                      },
                      {
                        "name": "source",
                        "type": "string"
                      },
                      {
                        "name": "host",
                        "type": "string"
                      },
                      {
                        "name": "sourcetype",
                        "type": "string"
                      },
                      {
                        "name": "index",
                        "type": "string"
                      },
                      {
                        "name": "cribl_breaker",
                        "type": "string"
                      },
                      {
                        "name": "test",
                        "type": "dynamic"
                      },
                      {
                        "name": "test1",
                        "type": "dynamic"
                      },
                      {
                        "name": "region",
                        "type": "string"
                      },
                      {
                        "name": "clz_dir",
                        "type": "string"
                      },
                      {
                        "name": "clz_subdir",
                        "type": "string"
                      },
                      {
                        "name": "cribl_pipe",
                        "type": "string"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-SAPLogServ_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "let fromUnixTime = (t: real) { \n    datetime(1970-01-01) + t * 1sec \n};\nsource\n| extend TimeGenerated = fromUnixTime(_time)\n| extend Raw = _raw\n| extend UnixTimestamp =_time\n| project-away  _raw, _time\n",
                    "outputStream": "Custom-SAPLogServ_CL"
                  }
                ]
              }
            },
            {
              "name": "SAPLogServ_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "SAPLogServ_CL",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "clz_dir",
                      "type": "string"
                    },
                    {
                      "name": "clz_subdir",
                      "type": "string"
                    },
                    {
                      "name": "cribl_breaker",
                      "type": "string"
                    },
                    {
                      "name": "cribl_pipe",
                      "type": "string"
                    },
                    {
                      "name": "host",
                      "type": "string"
                    },
                    {
                      "name": "index",
                      "type": "string"
                    },
                    {
                      "name": "region",
                      "type": "string"
                    },
                    {
                      "name": "source",
                      "type": "string"
                    },
                    {
                      "name": "sourcetype",
                      "type": "string"
                    },
                    {
                      "name": "test",
                      "type": "dynamic"
                    },
                    {
                      "name": "test1",
                      "type": "dynamic"
                    },
                    {
                      "name": "Raw",
                      "type": "string"
                    },
                    {
                      "name": "UnixTimestamp",
                      "type": "real"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "SAPLogServ",
          "title": "SAP LogServ (RISE), S/4HANA Cloud private edition",
          "publisher": "SAP SE",
          "logo": "SapLogo.svg",
          "descriptionMarkdown": "SAP LogServ is an SAP Enterprise Cloud Services (ECS) service aimed at collection, storage, forwarding and access of logs. LogServ centralizes the logs from all systems, applications, and ECS services used by a registered customer. <br> Main Features include:<br>Near Realtime Log Collection: With ability to integrate into Microsoft Sentinel as SIEM solution.<br>LogServ complements the existing SAP application layer threat monitoring and detections in Microsoft Sentinel with the log types owned by SAP ECS as the system provider. This includes logs like: SAP Security Audit Log (AS ABAP), HANA database, AS JAVA, ICM, SAP Web Dispatcher, SAP Cloud Connector, OS, SAP Gateway, 3rd party Database, Network, DNS, Proxy, Firewall",
          "graphQueriesTableName": "SAPLogServ_CL",
          "graphQueries": [
            {
              "metricName": "Total events received",
              "legend": "Tenant",
              "baseQuery": "{{graphQueriesTableName}} | project TimeGenerated"
            }
          ],
          "sampleQueries": [
            {
              "description": "Get Sample Events",
              "query": "{{graphQueriesTableName}}\n | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n | where TimeGenerated > ago(12h) | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "availability": {
            "isPreview": true
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft Entra",
                "description": "Permission to create an app registration in Microsoft Entra ID. Typically requires Entra ID Application Developer role or higher."
              },
              {
                "name": "Microsoft Azure",
                "description": "Permission to assign Monitoring Metrics Publisher role on data collection rules. Typically requires Azure RBAC Owner or User Access Administrator role."
              }
            ]
          },
          "instructionSteps": [
            {
              "title": "1. Create ARM Resources and Provide the Required Permissions",
              "description": "We will create data collection rule (DCR) and data collection endpoint (DCE) resources. We will also create a Microsoft Entra app registration and assign the required permissions to it.",
              "instructions": [
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "#### Automated deployment of Azure resources\nClicking on \"Deploy push connector resources\" will trigger the creation of DCR and DCE resources.\nIt will then create a Microsoft Entra app registration with client secret and grant permissions on the DCR. This setup enables data to be sent securely to the DCR using a OAuth v2 client credentials."
                  }
                },
                {
                  "parameters": {
                    "label": "Deploy push connector resources",
                    "applicationDisplayName": "SAP LogServ push to Microsoft Sentinel"
                  },
                  "type": "DeployPushConnectorButton_test"
                }
              ]
            },
            {
              "title": "2. Maintain the data collection endpoint details and authentication info in SAP LogServ",
              "description": "Share the data collection endpoint URL and authentication info with the SAP LogServ administrator to configure the SAP LogServ to send data to the data collection endpoint.\n\nLearn more from [this blog series](https://community.sap.com/t5/enterprise-resource-planning-blog-posts-by-members/ultimate-blog-series-sap-logserv-integration-with-microsoft-sentinel/ba-p/14126401).",
              "instructions": [
                {
                  "parameters": {
                    "label": "Use this value to configure as Tenant ID in the LogIngestionAPI credential.",
                    "fillWith": [
                      "TenantId"
                    ]
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "Entra Application ID",
                    "fillWith": [
                      "ApplicationId"
                    ],
                    "placeholder": "Deploy push connector to get the Application ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "Entra Application Secret",
                    "fillWith": [
                      "ApplicationSecret"
                    ],
                    "placeholder": "Deploy push connector to get the Application Secret"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "Use this value to configure the LogsIngestionURL parameter when deploying the IFlow.",
                    "fillWith": [
                      "DataCollectionEndpoint"
                    ],
                    "placeholder": "Deploy push connector to get the DCE URI"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "label": "DCR Immutable ID",
                    "fillWith": [
                      "DataCollectionRuleId"
                    ],
                    "placeholder": "Deploy push connector to get the DCR ID"
                  },
                  "type": "CopyableLabel"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "SAP"
        },
        "support": {
          "name": "SAP",
          "tier": "Partner",
          "link": "https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/announcing-limited-preview-of-sap-logserv-integration-with-microsoft/ba-p/13942180"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "SAP LogServ (RISE), S/4HANA Cloud private edition",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "auth": {
              "type": "object",
              "defaultValue": {
                "appId": "[[parameters('auth').appId]]",
                "servicePrincipalId": "[[parameters('auth').servicePrincipalId]]"
              }
            },
            "connectorDefinitionName": {
              "defaultValue": "SAP LogServ (RISE), S/4HANA Cloud private edition",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "SAP"
                },
                "support": {
                  "name": "SAP",
                  "tier": "Partner",
                  "link": "https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/announcing-limited-preview-of-sap-logserv-integration-with-microsoft/ba-p/13942180"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SAPLogServPolling', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "Push",
              "properties": {
                "connectorDefinitionName": "SAPLogServ",
                "dcrConfig": {
                  "dataCollectionRuleId": "{{dataCollectionRuleId}}",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]",
                  "streamName": "Custom-SAPLogServ_CL"
                },
                "auth": {
                  "type": "Push",
                  "appId": "[[parameters('auth').appId]",
                  "servicePrincipalId": "[[parameters('auth').servicePrincipalId]"
                },
                "request": {
                  "RetryCount": 1
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.messages"
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.4",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "SAP LogServ",
        "publisherDisplayName": "SAP",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>â€¢ Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/SAP%20LogServ/ReleaseNotes.md\">Release Notes</a></p>\n<p>â€¢ There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>SAP LogServ provides the SAP RISE logs to Microsoft Sentinel, allowing SOC teams to ingest, monitor, and hunt across SAP data. This integration enhances security by enabling faster detection, investigation, and mitigation of risks within SAP RISE environments.</p>\n<p><strong>Data Connectors:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 4</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/SAPBTP.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "SAP LogServ",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "SAP"
        },
        "support": {
          "name": "SAP",
          "tier": "Partner",
          "link": "https://community.sap.com/t5/enterprise-resource-planning-blogs-by-sap/announcing-limited-preview-of-sap-logserv-integration-with-microsoft/ba-p/13942180"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            }
          ]
        },
        "firstPublishDate": "2025-02-17",
        "lastPublishDate": "2025-07-18",
        "providers": [
          "SAP"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection",
            "Identity",
            "Application",
            "Cloud Provider"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
