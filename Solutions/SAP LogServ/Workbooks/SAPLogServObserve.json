{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# SAP LogServ Insights Dashboard\n\nReal-time monitoring of **SAP RISE infrastructure, private cloud edition component** log ingestion and system activity. Use the [Microsoft Sentinel Solution for SAP applications](https://learn.microsoft.com/azure/sentinel/sap/solution-overview) to complete your threat monitoring.\n\n>**üí° Learn More:** Visit our [Ultimate Blog Series: SAP LogServ Integration with Microsoft Sentinel](https://community.sap.com/t5/enterprise-resource-planning-blog-posts-by-members/ultimate-blog-series-sap-logserv-integration-with-microsoft-sentinel/ba-p/14126401) to discover advanced integration capabilities and best practices.\n\n**Data Freshness Status**\n| üü¢ Fresh (<1h): Current, actively flowing | üü° Recent (1-6h): Slightly delayed, acceptable | üü† Older (6-24h): May be experiencing delays | üî¥ Stale (>24h): Ingestion may have stopped |",
        "style": "info"
      },
      "name": "title-header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "param-timerange",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "üïê Time Range",
            "type": 4,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 604800000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "value": {
              "durationMs": 86400000
            }
          },
          {
            "id": "param-clzdir",
            "version": "KqlParameterItem/1.0",
            "name": "ClzDir",
            "label": "üìÅ Log Type",
            "type": 2,
            "query": "SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where isnotempty(clz_dir)\n| summarize Count = count() by clz_dir\n| order by Count desc\n| project Value = clz_dir, Label = strcat(clz_dir, ' (', Count, ')'), Selected = false",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "param-clzsubdir",
            "version": "KqlParameterItem/1.0",
            "name": "ClzSubDir",
            "label": "üìÇ Log Sub-Type",
            "type": 2,
            "query": "SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where isnotempty(clz_subdir)\n| summarize Count = count() by clz_subdir\n| order by Count desc\n| project Value = clz_subdir, Label = strcat(clz_subdir, ' (', Count, ')'), Selected = false",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "tabs",
        "loadType": "always",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let filteredLogs = SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}';\nfilteredLogs\n| summarize TotalLogs = count()\n| project Value = TotalLogs, Label = \"üìä Total Events\"",
                    "size": 1,
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Label",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Value",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 0
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "kpi-total-logs"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let filteredLogs = SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}';\nfilteredLogs\n| summarize UniqueSystems = dcount(host)\n| project Value = UniqueSystems, Label = \"üñ•Ô∏è Active Systems\"",
                    "size": 1,
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Label",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Value",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "green"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "kpi-active-systems"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let filteredLogs = SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}';\nfilteredLogs\n| summarize DataVolumeGB = round(sum(strlen(coalesce(Raw, \"\"))) / (1024.0 * 1024.0 * 1024.0), 2)\n| project Value = DataVolumeGB, Label = \"üíæ Data Volume (GB)\"",
                    "size": 1,
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Label",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Value",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "orange"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "kpi-data-volume"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let filteredLogs = SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}';\nfilteredLogs\n| summarize LatestLogTime = max(TimeGenerated)\n| extend \n    DataFreshness = case(\n        LatestLogTime >= ago(1h), \"üü¢ Fresh\",\n        LatestLogTime >= ago(6h), \"üü° Recent\",\n        LatestLogTime >= ago(24h), \"üü† Older\",\n        \"üî¥ Stale\"\n    )\n| project Value = DataFreshness, Label = \"üîÑ Data Status\"",
                    "size": 1,
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Label",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Value",
                        "formatter": 1
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "kpi-data-status"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let filteredLogs = SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}';\nfilteredLogs\n| summarize LatestLogTime = max(TimeGenerated)\n| extend FormattedTime = strcat(format_datetime(LatestLogTime, 'yyyy-MM-dd HH:mm:ss'), ' UTC')\n| project Value = FormattedTime, Label = \"‚è∞ Most Recent Data\"",
                    "size": 1,
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Label",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Value",
                        "formatter": 1
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "kpi-latest-log"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\n| make-series LogCount = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1h",
                    "size": 0,
                    "title": "üìà Log Volume Timeline",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "areachart"
                  },
                  "customWidth": "50",
                  "name": "volume-timeline"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\n| where isnotempty(clz_dir)\n| summarize LogCount = count() by clz_dir\n| order by LogCount desc\n| project Classification = clz_dir, Count = LogCount",
                    "size": 1,
                    "title": "üèóÔ∏è Distribution of RISE Infrastructure Components",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Count",
                          "color": "#0F828F"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "classification-pie"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\n| summarize \n    LogCount = count(),\n    LatestActivity = max(TimeGenerated),\n    DataSizeGB = round(sum(strlen(coalesce(Raw, \"\"))) / (1024.0 * 1024.0 * 1024.0), 3)\n    by host\n| order by LogCount desc\n| extend \n    ActivityStatus = case(\n        LatestActivity >= ago(1h), \"üü¢ Active\",\n        LatestActivity >= ago(6h), \"üü° Recent\",\n        \"üî¥ Inactive\"\n    ),\n    FormattedLatest = strcat(format_datetime(LatestActivity, 'yyyy-MM-dd HH:mm:ss'), ' UTC')\n| project \n    ['üñ•Ô∏è System'] = host,\n    ['üìà Event Count'] = LogCount,\n    ['üíæ GB'] = DataSizeGB,\n    ['‚è∞ Latest'] = FormattedLatest,\n    ['üìä Status'] = ActivityStatus\n| take 15",
                    "size": 0,
                    "title": "üñ•Ô∏è Most Active Systems",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "üìà Event Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "üíæ GB",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "green"
                          }
                        },
                        {
                          "columnMatch": "‚è∞ Latest",
                          "formatter": 1
                        }
                      ]
                    }
                  },
                  "name": "systems-view"
                }
              ]
            },
            "name": "üìä Overview"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## üóÑÔ∏è SAP HANA Database Insights\n\nDetailed monitoring of HANA database activity and performance metrics from your SAP RISE environment",
                    "style": "info"
                  },
                  "name": "hana-section-header"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\n| where clz_dir contains \"hana\" or clz_dir contains \"db\" or host contains \"hana\" or host contains \"db\"\n| summarize \n    EventCount = count(),\n    LatestActivity = max(TimeGenerated),\n    DataSizeGB = round(sum(strlen(coalesce(Raw, \"\"))) / (1024.0 * 1024.0 * 1024.0), 3)\n    by host, clz_dir\n| order by EventCount desc\n| extend \n    ActivityStatus = case(\n        LatestActivity >= ago(1h), \"üü¢ Active\",\n        LatestActivity >= ago(6h), \"üü° Recent\",\n        \"üî¥ Inactive\"\n    ),\n    FormattedLatest = strcat(format_datetime(LatestActivity, 'yyyy-MM-dd HH:mm:ss'), ' UTC')\n| project \n    ['üóÑÔ∏è HANA Host'] = host,\n    ['üìÅ Component'] = clz_dir,\n    ['üìà Events'] = EventCount,\n    ['üíæ GB'] = DataSizeGB,\n    ['‚è∞ Latest'] = FormattedLatest,\n    ['üìä Status'] = ActivityStatus\n| take 20",
                    "size": 0,
                    "title": "üóÑÔ∏è HANA Database Log Activity",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "üìà Events",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "üíæ GB",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "green"
                          }
                        },
                        {
                          "columnMatch": "‚è∞ Latest",
                          "formatter": 1
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_üìà Events_2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_üìà Events_2",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "name": "hana-activity"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\n| where clz_dir contains \"hana\" or clz_dir contains \"db\" or host contains \"hana\" or host contains \"db\"\n| make-series EventCount = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1h by host\n| render timechart",
                    "size": 0,
                    "title": "üìä HANA DB Event Timeline by Host",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "areachart"
                  },
                  "name": "hana-timeline"
                }
              ]
            },
            "name": "üóÑÔ∏è HANA Database"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## üåê SAP WebDispatcher Insights\n\nLog monitoring for SAP's https-proxy of your SAP RISE environment",
                    "style": "info"
                  },
                  "name": "webdispatcher-section-header"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\n| where clz_dir contains \"web\" or clz_dir contains \"dispatcher\" or clz_dir contains \"http\" or host contains \"web\"\n| summarize \n    EventCount = count(),\n    LatestActivity = max(TimeGenerated),\n    DataSizeGB = round(sum(strlen(coalesce(Raw, \"\"))) / (1024.0 * 1024.0 * 1024.0), 3)\n    by host, clz_dir\n| order by EventCount desc\n| extend \n    ActivityStatus = case(\n        LatestActivity >= ago(1h), \"üü¢ Active\",\n        LatestActivity >= ago(6h), \"üü° Recent\",\n        \"üî¥ Inactive\"\n    ),\n    FormattedLatest = strcat(format_datetime(LatestActivity, 'yyyy-MM-dd HH:mm:ss'), ' UTC')\n| project \n    ['üåê WebDisp Host'] = host,\n    ['üìÅ Component'] = clz_dir,\n    ['üìà Events'] = EventCount,\n    ['üíæ GB'] = DataSizeGB,\n    ['‚è∞ Latest'] = FormattedLatest,\n    ['üìä Status'] = ActivityStatus\n| take 20",
                    "size": 0,
                    "title": "üåê SAP WebDispatcher Activity",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "üìà Events",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        },
                        {
                          "columnMatch": "üíæ GB",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "green"
                          }
                        },
                        {
                          "columnMatch": "‚è∞ Latest",
                          "formatter": 1
                        }
                      ]
                    }
                  },
                  "name": "webdispatcher-activity"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SAPLogServ_CL\n| where TimeGenerated >= {TimeRange:start}\n| where '{ClzDir}' == '*' or clz_dir == '{ClzDir}'\n| where '{ClzSubDir}' == '*' or clz_subdir == '{ClzSubDir}'\n| where clz_dir contains \"web\" or clz_dir contains \"dispatcher\" or clz_dir contains \"http\" or host contains \"web\"\n| make-series EventCount = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1h by host\n| render timechart",
                    "size": 0,
                    "title": "üìä SAP WebDispatcher Event Timeline by Host",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "areachart"
                  },
                  "name": "webdispatcher-timeline"
                }
              ]
            },
            "name": "üåê WebDispatcher"
          }
        ]
      },
      "name": "main-tabs"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/eaf4193c-36fa-42b9-b284-5ef3f7e8646c/resourcegroups/cribl2sentch-dest/providers/microsoft.operationalinsights/workspaces/cribl2sentch-dest-law"
  ],
  "styleSettings": {
    "spacingStyle": "none"
  },
  "fromTemplateId": "sentinel-UserWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}