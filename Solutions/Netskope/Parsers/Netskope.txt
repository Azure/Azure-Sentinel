// Title:           Netskope
// Author:          Microsoft
// Version:         1.0
// Last Updated:    11/12/2020
// Comment:         Inital Release
//  
// DESCRIPTION:
// This parser takes Netskope logs ingested from the Function App Data Connector and parses the data into a normalized schema
//
// REFERENCES: 
// Using functions in Azure monitor log queries: https://docs.microsoft.com/azure/azure-monitor/log-query/functions
//
// 
Netskope_CL
| project SourceSystem, TimeGenerated, Type, TenantId,
InsertionEpochTimestamp = column_ifexists("_insertion_epoch_timestamp_d", ""),
AccessMethod = column_ifexists("access_method_s", ""),
Acked = column_ifexists("acked_s", ""),
Activity = column_ifexists("activity_s", ""),
AlertName = column_ifexists("alert_name_s", ""),
Alert = column_ifexists("alert_s", ""),
AlertType = column_ifexists("alert_type_s", ""),
AppName = column_ifexists("app_s", ""),
AppCategory = column_ifexists("appcategory_s", ""),
Browser = column_ifexists("browser_s", ""),
BrowserVersion = column_ifexists("browser_version_s", ""),
BypassTraffic = column_ifexists("bypass_traffic_s", ""),
Ccl = column_ifexists("ccl_s", ""),
ClientBytes = column_ifexists("client_bytes_d", ""),
Count = column_ifexists("count_d", ""),
Device = column_ifexists("device_s", ""),
Domain = column_ifexists("domain_s", ""),
DstGeoCountry = column_ifexists("dst_country_s", ""),
DstGeoLatitude = column_ifexists("dst_latitude_d", ""),
DstGeoLocation = column_ifexists("dst_location_s", ""),
DstGeoLongitude = column_ifexists("dst_longitude_d", ""),
DstGeoRegion = column_ifexists("dst_region_s", ""),
DstGeoTimezone = column_ifexists("dst_timezone_s", ""),
DstGeoZipcode = column_ifexists("dst_zipcode_s", ""),
DstIpAddr = column_ifexists("dstip_s", ""),
DstPort = column_ifexists("dstport_d", ""),
FromUser = column_ifexists("from_user_s", ""),
Hostname = column_ifexists("hostname_s", ""),
HttpTransactionCount = column_ifexists("http_transaction_count_d", ""),
LatencyMax = column_ifexists("latency_max_d", ""),
LatencyMin = column_ifexists("latency_min_d", ""),
LatencyTotal = column_ifexists("latency_total_d", ""),
NumBytes = column_ifexists("numbytes_d", ""),
Object = column_ifexists("object_s", ""),
ObjectType = column_ifexists("object_type_s", ""),
Org = column_ifexists("org_s", ""),
OrganizationUnit = column_ifexists("organization_unit_s", ""),
Os = column_ifexists("os_s", ""),
OsVersion = column_ifexists("os_version_s", ""),
Page = column_ifexists("page_s", ""),
Policy = column_ifexists("policy_s", ""),
ReqCnt = column_ifexists("req_cnt_d", ""),
RespCnt = column_ifexists("resp_cnt_d", ""),
ServerBytes = column_ifexists("server_bytes_d", ""),
Site = column_ifexists("site_s", ""),
SrcGeoCountry = column_ifexists("src_country_s", ""),
SrcGeoLatitude = column_ifexists("src_latitude_d", ""),
SrcGeoLocation = column_ifexists("src_location_s", ""),
SrcGeoLongitude = column_ifexists("src_longitude_d", ""),
SrcGeoRegion = column_ifexists("src_region_s", ""),
SrcGeoTimezone = column_ifexists("src_timezone_s", ""),
SrcGeoZipcode = column_ifexists("src_zipcode_s", ""),
SrcIpAddr = column_ifexists("srcip_s", ""),
Timestamp = column_ifexists("timestamp_d", ""),
ToUser = column_ifexists("to_user_s", ""),
TrafficType = column_ifexists("traffic_type_s", ""),
LogType = column_ifexists("type_s", ""),
UrNormalized = column_ifexists("ur_normalized_s", ""),
Url = column_ifexists("url_s", ""),
UserGenerated = column_ifexists("user_generated_s", ""),
User = column_ifexists("user_s", ""),
UserAgent = column_ifexists("useragent_s", ""),
UserIp = column_ifexists("userip_s", ""),
UserKey = column_ifexists("userkey_s", ""),
IaasAssetTags = column_ifexists("iaas_asset_tags_s", ""),
DlpIsUniqueCount = column_ifexists("dlp_is_unique_count_s", ""),
FilePasswdProtected = column_ifexists("file_passwd_protected_s", ""),
Malicious = column_ifexists("malicious_s", ""),
ManagedApp = column_ifexists("managed_app_s", ""),
Shared = column_ifexists("shared_s", ""),
Modified = column_ifexists("modified_s", ""),
ConnEndtime = column_ifexists("conn_endtime_s", ""),
ConnStarttime = column_ifexists("conn_starttime_s", ""),
MalsiteLatitude = column_ifexists("malsite_latitude_s", ""),
MalsiteLongitude = column_ifexists("malsite_longitude_s", ""),
MalsiteReputation = column_ifexists("malsite_reputation_s", ""),
BreachDate = column_ifexists("breach_date_d", ""),
BreachScore = column_ifexists("breach_score_d", ""),
ConnDuration = column_ifexists("conn_duration_d", ""),
DlpFingerprintScore = column_ifexists("dlp_fingerprint_score_d", ""),
DlpRuleCount = column_ifexists("dlp_rule_count_d", ""),
DlpRuleScore = column_ifexists("dlp_rule_score_d", ""),
DlpUniqueCount = column_ifexists("dlp_unique_count_d", ""),
DstGeoipSrc = column_ifexists("dst_geoip_src_d", ""),
ExternalCollaboratorCount = column_ifexists("external_collaborator_count_d", ""),
FileSize = column_ifexists("file_size_d", ""),
InternalCollaboratorCount = column_ifexists("internal_collaborator_count_d", ""),
MalsiteActive = column_ifexists("malsite_active_d", ""),
MalsiteConfidence = column_ifexists("malsite_confidence_d", ""),
MalsiteConsecutive = column_ifexists("malsite_consecutive_d", ""),
MalsiteFirstSeen = column_ifexists("malsite_first_seen_d", ""),
MalsiteHostility = column_ifexists("malsite_hostility_d", ""),
MalsiteLastSeen = column_ifexists("malsite_last_seen_d", ""),
ObjectCount = column_ifexists("object_count_d", ""),
PathId = column_ifexists("path_id_d", ""),
PolicyId = column_ifexists("policy_id_d", ""),
QuarantineProfileId = column_ifexists("quarantine_profile_id_d", ""),
RequestId = column_ifexists("request_id_d", ""),
RequestIdNew = column_ifexists("requestid_s", ""),
RiskLevelId = column_ifexists("risk_level_id_d", ""),
RunId = column_ifexists("run_id_d", ""),
SaProfileId = column_ifexists("sa_profile_id_d", ""),
SaRuleId = column_ifexists("sa_rule_id_d", ""),
SessionId = column_ifexists("session_id_d", ""),
Sessionid = column_ifexists("sessionid_d", ""),
SeverityId = column_ifexists("severity_id_d", ""),
SeverityLevelId = column_ifexists("severity_level_id_d", ""),
SrcGeoIpSrc = column_ifexists("src_geoip_src_d", ""),
SuppressionEndTime = column_ifexists("suppression_end_time_d", ""),
SuppressionStartTime = column_ifexists("suppression_start_time_d", ""),
ThreatSourceId = column_ifexists("threat_source_id_d", ""),
Threshold = column_ifexists("threshold_d", ""),
TotalCollaboratorCount = column_ifexists("total_collaborator_count_d", ""),
BinTimestamp = column_ifexists("bin_timestamp_d", ""),
BrowserSessionId = column_ifexists("browser_session_id_d", ""),
BrowserSessionIdNew = column_ifexists("browser_sessionid_s", ""),
ConnectionId = column_ifexists("connection_id_d", ""),
ConnectionIdNew = column_ifexists("connectionid_s", ""),
LastTimestamp = column_ifexists("last_timestamp_d", ""),
ScanTime = column_ifexists("scan_time_d", ""),
ThresholdTime = column_ifexists("threshold_time_d", ""),
AccountId = column_ifexists("account_id_d", ""),
AccountName = column_ifexists("account_name_s", ""),
ActUser = column_ifexists("act_user_s", ""),
Action = column_ifexists("action_s", ""),
ActivityStatus = column_ifexists("activity_status_s", ""),
ActivityType = column_ifexists("activity_type_s", ""),
AppSessionId = column_ifexists("app_session_id_d", ""),
AppSessionIdNew = column_ifexists("app_sessionid_s", ""),
Attachment = column_ifexists("attachment_s", ""),
AuditCategory = column_ifexists("audit_category_s", ""),
AuditType = column_ifexists("audit_type_s", ""),
BreachId = column_ifexists("breach_id_s", ""),
BreachMediaReferences = column_ifexists("breach_media_references_s", ""),
BreachTargetReferences = column_ifexists("breach_target_references_s", ""),
Channel = column_ifexists("channel_s", ""),
DataType = column_ifexists("data_type_s", ""),
DetectionEngine = column_ifexists("detection_engine_s", ""),
DetectionType = column_ifexists("detection_type_s", ""),
DeviceClassification = column_ifexists("device_classification_s", ""),
DlpFile = column_ifexists("dlp_file_s", ""),
DlpFingerprintClassification = column_ifexists("dlp_fingerprint_classification_s", ""),
DlpFingerprintMatch = column_ifexists("dlp_fingerprint_match_s", ""),
DlpIncidentId = column_ifexists("dlp_incident_id_d", ""),
DlpIncidentIdNew = column_ifexists("dlp_incidentid_s", ""),
DlpParentId = column_ifexists("dlp_parent_id_d", ""),
DlpParentIdNew = column_ifexists("dlp_parentid_s", ""),
DlpProfile = column_ifexists("dlp_profile_s", ""),
DlpRule = column_ifexists("dlp_rule_s", ""),
DlpRuleSeverity = column_ifexists("dlp_rule_severity_s", ""),
DownloadApp = column_ifexists("download_app_s", ""),
DstHostname = column_ifexists("dsthost_s", ""),
DynamicClassification = column_ifexists("dynamic_classification_s", ""),
EncryptFailure = column_ifexists("encrypt_failure_s", ""),
Enterprise = column_ifexists("enterprise_s", ""),
EnterpriseId = column_ifexists("enterprise_id_s", ""),
EventType = column_ifexists("event_type_s", ""),
Exposure = column_ifexists("exposure_s", ""),
FileId = column_ifexists("file_id_s", ""),
FileLang = column_ifexists("file_lang_s", ""),
FilePath = column_ifexists("file_path_s", ""),
FileType = column_ifexists("file_type_s", ""),
FileName = column_ifexists("filename_s", ""),
FromObject = column_ifexists("from_object_s", ""),
FromUserCategory = column_ifexists("from_user_category_s", ""),
Fromlogs = column_ifexists("fromlogs_s", ""),
Instance = column_ifexists("instance_s", ""),
InstanceId = column_ifexists("instance_id_s", ""),
InstanceName = column_ifexists("instance_name_s", ""),
InstanceType = column_ifexists("instance_type_s", ""),
JustificationReason = column_ifexists("justification_reason_s", ""),
JustificationType = column_ifexists("justification_type_s", ""),
LastApp = column_ifexists("last_app_s", ""),
LastCountry = column_ifexists("last_country_s", ""),
LastDevice = column_ifexists("last_device_s", ""),
LastLocation = column_ifexists("last_location_s", ""),
LastRegion = column_ifexists("last_region_s", ""),
LegalHoldProfileName = column_ifexists("legal_hold_profile_name_s", ""),
LhCustodianEmail = column_ifexists("lh_custodian_email_s", ""),
LhCustodianName = column_ifexists("lh_custodian_name_s", ""),
LhDestApp = column_ifexists("lh_dest_app_s", ""),
LhDestInstance = column_ifexists("lh_dest_instance_s", ""),
LhFileid = column_ifexists("lh_fileid_s", ""),
LhFilename = column_ifexists("lh_filename_s", ""),
LhFilepath = column_ifexists("lh_filepath_s", ""),
LhOriginalFilename = column_ifexists("lh_original_filename_s", ""),
LhShared = column_ifexists("lh_shared_s", ""),
LhSharedWith = column_ifexists("lh_shared_with_s", ""),
LhVersion = column_ifexists("lh_version_s", ""),
LocalMd5 = column_ifexists("local_md5_s", ""),
LocalSha1 = column_ifexists("local_sha1_s", ""),
LocalSha256 = column_ifexists("local_sha256_s", ""),
LogFileName = column_ifexists("log_file_name_s", ""),
LoginType = column_ifexists("logintype_s", ""),
LoginUrl = column_ifexists("loginurl_s", ""),
MalsiteAsNumber = column_ifexists("malsite_as_number_s", ""),
MalsiteCategory = column_ifexists("malsite_category_s", ""),
MalsiteCity = column_ifexists("malsite_city_s", ""),
MalsiteCountry = column_ifexists("malsite_country_s", ""),
MalsiteDnsServer = column_ifexists("malsite_dns_server_s", ""),
MalsiteId = column_ifexists("malsite_id_s", ""),
MalsiteIpHost = column_ifexists("malsite_ip_host_s", ""),
MalsiteIsp = column_ifexists("malsite_isp_s", ""),
MalsiteRegion = column_ifexists("malsite_region_s", ""),
MalwareId = column_ifexists("malware_id_s", ""),
MalwareName = column_ifexists("malware_name_s", ""),
MalwareProfile = column_ifexists("malware_profile_s", ""),
MalwareSeverity = column_ifexists("malware_severity_s", ""),
MalwareType = column_ifexists("malware_type_s", ""),
Managementid = column_ifexists("managementID_s", ""),
Md5 = column_ifexists("md5_s", ""),
MimeType = column_ifexists("mime_type_s", ""),
NewValue = column_ifexists("new_value_s", ""),
NsActivity = column_ifexists("ns_activity_s", ""),
Nsdeviceuid = column_ifexists("nsdeviceuid_s", ""),
ObjectId = column_ifexists("object_id_s", ""),
OldValue = column_ifexists("old_value_s", ""),
OrigTy = column_ifexists("orig_ty_s", ""),
OriginalFilePath = column_ifexists("original_file_path_s", ""),
Owner = column_ifexists("owner_s", ""),
ProfileEmails = column_ifexists("profile_emails_s", ""),
ProfileId = column_ifexists("profile_id_s", ""),
QAdmin = column_ifexists("q_admin_s", ""),
QApp = column_ifexists("q_app_s", ""),
QInstance = column_ifexists("q_instance_s", ""),
QOriginalFilename = column_ifexists("q_original_filename_s", ""),
QOriginalFilepath = column_ifexists("q_original_filepath_s", ""),
QOriginalShared = column_ifexists("q_original_shared_s", ""),
QOriginalVersion = column_ifexists("q_original_version_s", ""),
QuarantineActionReason = column_ifexists("quarantine_action_reason_s", ""),
QuarantineFailure = column_ifexists("quarantine_failure_s", ""),
QuarantineFileId = column_ifexists("quarantine_file_id_s", ""),
QuarantineFileName = column_ifexists("quarantine_file_name_s", ""),
QuarantineProfile = column_ifexists("quarantine_profile_s", ""),
Referer = column_ifexists("referer_s", ""),
RegionId = column_ifexists("region_id_s", ""),
RegionName = column_ifexists("region_name_s", ""),
ResourceCategory = column_ifexists("resource_category_s", ""),
RetroScanName = column_ifexists("retro_scan_name_s", ""),
RiskLevel = column_ifexists("risk_level_s", ""),
Role = column_ifexists("role_s", ""),
SaProfileName = column_ifexists("sa_profile_name_s", ""),
SaRuleName = column_ifexists("sa_rule_name_s", ""),
SaRuleSeverity = column_ifexists("sa_rule_severity_s", ""),
ScanType = column_ifexists("scan_type_s", ""),
Scopes = column_ifexists("scopes_s", ""),
Severity = column_ifexists("severity_s", ""),
SeverityLevel = column_ifexists("severity_level_s", ""),
SharedCredentialUser = column_ifexists("shared_credential_user_s", ""),
SharedDomains = column_ifexists("shared_domains_s", ""),
SharedType = column_ifexists("shared_type_s", ""),
SharedWith = column_ifexists("shared_with_s", ""),
SslDecryptPolicy = column_ifexists("ssl_decrypt_policy_s", ""),
SubType = column_ifexists("sub_type_s", ""),
SuppressionKey = column_ifexists("suppression_key_s", ""),
Team = column_ifexists("team_s", ""),
TelemetryApp = column_ifexists("telemetry_app_s", ""),
ThreatMatchField = column_ifexists("threat_match_field_s", ""),
Title = column_ifexists("title_s", ""),
ToObject = column_ifexists("to_object_s", ""),
ToUserCategory = column_ifexists("to_user_category_s", ""),
TransactionId = column_ifexists("transaction_id_d", ""),
TransactionIdNew = column_ifexists("transactionid_s", ""),
TssMode = column_ifexists("tss_mode_s", ""),
TunnelId = column_ifexists("tunnel_id_s", ""),
Url2Activity = column_ifexists("Url2Activity_s", ""),
UserCategory = column_ifexists("user_category_s", ""),
UserId = column_ifexists("user_id_s", ""),
UserName = column_ifexists("user_name_s", ""),
UserNormalized = column_ifexists("user_normalized_s", ""),
UserRole = column_ifexists("user_role_s", ""),
ViolatingUser = column_ifexists("violating_user_s", ""),
ViolatingUserType = column_ifexists("violating_user_type_s", ""),
WebUrl = column_ifexists("web_url_s", ""),
Workspace = column_ifexists("workspace_s", ""),
WorkspaceId = column_ifexists("workspace_id_s", ""),
ZipPassword = column_ifexists("zip_password_s", "")


