// Usage Instruction :
// Paste below query in log analytics, click on Save button and select as Function from drop down by specifying function name and alias as Cloudflare.
// Function usually takes 10-15 minutes to activate. You can then use function alias from any other queries (e.g. Cloudflare | take 10).
// Reference : Using functions in Azure monitor log queries : https://docs.microsoft.com/azure/azure-monitor/log-query/functions
Cloudflare_CL
| extend
    BotScore_d=column_ifexists('BotScore_d', ''),
    BotScoreSrc_s=column_ifexists('BotScoreSrc_s', ''),
    CacheCacheStatus_s=column_ifexists('CacheCacheStatus_s', ''),
    CacheResponseBytes_d=column_ifexists('CacheResponseBytes_d', ''),
    CacheResponseStatus_d=column_ifexists('CacheResponseStatus_d', ''),
    CacheTieredFill_b=column_ifexists('CacheTieredFill_b', ''),
    ClientASN_d=column_ifexists('ClientASN_d', ''),
    ClientCountry_s=column_ifexists('ClientCountry_s', ''),
    ClientDeviceType_s=column_ifexists('ClientDeviceType_s', ''),
    ClientIP_s=column_ifexists('ClientIP_s', ''),
    ClientIPClass_s=column_ifexists('ClientIPClass_s', ''),
    ClientRequestHost_s=column_ifexists('ClientRequestHost_s', ''),
    ClientRequestMethod_s=column_ifexists('ClientRequestMethod_s', ''),
    ClientRequestPath_s=column_ifexists('ClientRequestPath_s', ''),
    ClientRequestProtocol_s=column_ifexists('ClientRequestProtocol_s', ''),
    ClientRequestReferer_s=column_ifexists('ClientRequestReferer_s', ''),
    ClientRequestURI_s=column_ifexists('ClientRequestURI_s', ''),
    ClientRequestUserAgent_s=column_ifexists('ClientRequestUserAgent_s', ''),
    ClientSSLCipher_s=column_ifexists('ClientSSLCipher_s', ''),
    ClientSSLProtocol_s=column_ifexists('ClientSSLProtocol_s', ''),
    ClientXRequestedWith_s=column_ifexists('ClientXRequestedWith_s', ''),
    EdgeColoCode_s=column_ifexists('EdgeColoCode_s', ''),
    EdgeColoID_d=column_ifexists('EdgeColoID_d', ''),
    EdgeEndTimestamp_t=column_ifexists('EdgeEndTimestamp_t', ''),
    EdgePathingOp_s=column_ifexists('EdgePathingOp_s', ''),
    EdgePathingSrc_s=column_ifexists('EdgePathingSrc_s', ''),
    EdgePathingStatus_s=column_ifexists('EdgePathingStatus_s', ''),
    EdgeRateLimitAction_s=column_ifexists('EdgeRateLimitAction_s', ''),
    EdgeRateLimitID_d=column_ifexists('EdgeRateLimitID_d', ''),
    EdgeRequestHost_s=column_ifexists('EdgeRequestHost_s', ''),
    EdgeResponseBytes_d=column_ifexists('EdgeResponseBytes_d', ''),
    EdgeResponseCompressionRatio_d=column_ifexists('EdgeResponseCompressionRatio_d', ''),
    EdgeResponseContentType_s=column_ifexists('EdgeResponseContentType_s', ''),
    EdgeResponseStatus_d=column_ifexists('EdgeResponseStatus_d', ''),
    EdgeServerIP_s=column_ifexists('EdgeServerIP_s', ''),
    EdgeStartTimestamp_t=column_ifexists('EdgeStartTimestamp_t', ''),
    FirewallMatchesActions_s=column_ifexists('FirewallMatchesActions_s', ''),
    FirewallMatchesRuleIDs_s=column_ifexists('FirewallMatchesRuleIDs_s', ''),
    FirewallMatchesSources_s=column_ifexists('FirewallMatchesSources_s', ''),
    OriginIP_s=column_ifexists('OriginIP_s', ''),
    OriginResponseBytes_d=column_ifexists('OriginResponseBytes_d', ''),
    OriginResponseHTTPExpires_s=column_ifexists('OriginResponseHTTPExpires_s', ''),
    OriginResponseHTTPLastModified_s=column_ifexists('OriginResponseHTTPLastModified_s', ''),
    OriginResponseStatus_d=column_ifexists('OriginResponseStatus_d', ''),
    OriginResponseTime_d=column_ifexists('OriginResponseTime_d', ''),
    OriginSSLProtocol_s=column_ifexists('OriginSSLProtocol_s', ''),
    ParentRayID_s=column_ifexists('ParentRayID_s', ''),
    RayID_s=column_ifexists('RayID_s', ''),
    SecurityLevel_s=column_ifexists('SecurityLevel_s', ''),
    WAFAction_s=column_ifexists('WAFAction_s', ''),
    WAFFlags_s=column_ifexists('WAFFlags_s', ''),
    WAFMatchedVar_s=column_ifexists('WAFMatchedVar_s', ''),
    WAFProfile_s=column_ifexists('WAFProfile_s', ''),
    WAFRuleID_s=column_ifexists('WAFRuleID_s', ''),
    WAFRuleMessage_s=column_ifexists('WAFRuleMessage_s', ''),
    WorkerCPUTime_d=column_ifexists('WorkerCPUTime_d', ''),
    WorkerStatus_s=column_ifexists('WorkerStatus_s', ''),
    WorkerSubrequest_b=column_ifexists('WorkerSubrequest_b', ''),
    WorkerSubrequestCount_d=column_ifexists('WorkerSubrequestCount_d', ''),
    ZoneID_d=column_ifexists('ZoneID_d', ''),
    Application_s=column_ifexists('Application_s', ''),
    ClientMatchedIpFirewall_s=column_ifexists('ClientMatchedIpFirewall_s', ''),
    ClientProto_s=column_ifexists('ClientProto_s', ''),
    ClientTcpRtt_d=column_ifexists('ClientTcpRtt_d', ''),
    ClientTlsCipher_s=column_ifexists('ClientTlsCipher_s', ''),
    ClientTlsClientHelloServerName_s=column_ifexists('ClientTlsClientHelloServerName_s', ''),
    ClientTlsProtocol_s=column_ifexists('ClientTlsProtocol_s', ''),
    ClientTlsStatus_s=column_ifexists('ClientTlsStatus_s', ''),
    ColoCode_s=column_ifexists('ColoCode_s', ''),
    ConnectTimestamp_t=column_ifexists('ConnectTimestamp_t', ''),
    DisconnectTimestamp_t=column_ifexists('DisconnectTimestamp_t', ''),
    Event_s=column_ifexists('Event_s', ''),
    IpFirewall_b=column_ifexists('IpFirewall_b', ''),
    OriginBytes_d=column_ifexists('OriginBytes_d', ''),
    OriginPort_d=column_ifexists('OriginPort_d', ''),
    OriginProto_s=column_ifexists('OriginProto_s', ''),
    OriginTcpRtt_d=column_ifexists('OriginTcpRtt_d', ''),
    OriginTlsCipher_s=column_ifexists('OriginTlsCipher_s', ''),
    OriginTlsFingerprint_s=column_ifexists('OriginTlsFingerprint_s', ''),
    OriginTlsMode_s=column_ifexists('OriginTlsMode_s', ''),
    OriginTlsProtocol_s=column_ifexists('OriginTlsProtocol_s', ''),
    OriginTlsStatus_s=column_ifexists('OriginTlsStatus_s', ''),
    ProxyProtocol_s=column_ifexists('ProxyProtocol_s', ''),
    Status_d=column_ifexists('Status_d', ''),
    Timestamp_t=column_ifexists('Timestamp_t', ''),
    Action_s=column_ifexists('Action_s', ''),
    ClientASNDescription_s=column_ifexists('ClientASNDescription_s', ''),
    ClientRefererHost_s=column_ifexists('ClientRefererHost_s', ''),
    ClientRefererPath_s=column_ifexists('ClientRefererPath_s', ''),
    ClientRefererQuery_s=column_ifexists('ClientRefererQuery_s', ''),
    ClientRefererScheme_s=column_ifexists('ClientRefererScheme_s', ''),
    ClientRequestQuery_s=column_ifexists('ClientRequestQuery_s', ''),
    ClientRequestScheme_s=column_ifexists('ClientRequestScheme_s', ''),
    Datetime_t=column_ifexists('Datetime_t', ''),
    Kind_s=column_ifexists('Kind_s', ''),
    MatchIndex_d=column_ifexists('MatchIndex_d', ''),
    OriginatorRayID_s=column_ifexists('OriginatorRayID_s', ''),
    RuleID_s=column_ifexists('RuleID_s', ''),
    Source_s=column_ifexists('Source_s', '')
| extend
    SrcDvcType=iff(isempty(ClientDeviceType_s), iff(isempty(Source_s), '', Source_s), ClientDeviceType_s),
    TlsCipher=iff(isempty(ClientSSLCipher_s), iff(isempty(ClientTlsCipher_s), '', ClientTlsCipher_s), ClientSSLCipher_s),
    TlsVersion=iff(isempty(ClientSSLProtocol_s), iff(isempty(ClientTlsProtocol_s), '', ClientTlsProtocol_s), ClientSSLProtocol_s),
    DvcAction=iff(isempty(FirewallMatchesActions_s), iff(isempty(Event_s), iff(isempty(Action_s), '', Action_s), Event_s), FirewallMatchesActions_s),
    NetworkRuleName=iff(isempty(FirewallMatchesRuleIDs_s), iff(isempty(RuleID_s), '', RuleID_s), FirewallMatchesRuleIDs_s),
    ClientRequestBytes_d=column_ifexists('ClientRequestBytes_d', column_ifexists('ClientBytes_d', '')),
    ClientSrcPort_d=column_ifexists('ClientSrcPort_d', column_ifexists('ClientPort_d', '')),
    EdgeResponseBytes_d=column_ifexists('EdgeResponseBytes_d', column_ifexists('OriginBytes_d', ''))
| project-rename
    SrcBytes=ClientRequestBytes_d,
    SrcPortNumber=ClientSrcPort_d,
    DstBytes=EdgeResponseBytes_d,
    BotScore=BotScore_d,
    BotScoreSrc=BotScoreSrc_s,
    CacheCacheStatus=CacheCacheStatus_s,
    CacheResponseBytes=CacheResponseBytes_d,
    CacheResponseStatus=CacheResponseStatus_d,
    CacheTieredFill=CacheTieredFill_b,
    ClientASN=ClientASN_d,
    SrcGeoCountry=ClientCountry_s,
    SrcIpAddr=ClientIP_s,
    ClientIPClass=ClientIPClass_s,
    HttpRequestHeaderHost=ClientRequestHost_s,
    HttpRequestMethod=ClientRequestMethod_s,
    ClientRequestPath=ClientRequestPath_s,
    ClientRequestProtocol=ClientRequestProtocol_s,
    HttpReferrerOriginal=ClientRequestReferer_s,
    ClientRequestURI=ClientRequestURI_s,
    HttpUserAgentOriginal=ClientRequestUserAgent_s,
    ClientXRequestedWith=ClientXRequestedWith_s,
    EdgeColoCode=EdgeColoCode_s,
    EdgeColoID=EdgeColoID_d,
    EdgeEndTimestamp=EdgeEndTimestamp_t,
    EdgePathingOp=EdgePathingOp_s,
    EdgePathingSrc=EdgePathingSrc_s,
    EdgePathingStatus=EdgePathingStatus_s,
    EdgeRateLimitAction=EdgeRateLimitAction_s,
    EdgeRateLimitID=EdgeRateLimitID_d,
    EdgeRequestHost=EdgeRequestHost_s,
    EdgeResponseCompressionRatio=EdgeResponseCompressionRatio_d,
    HttpContentType=EdgeResponseContentType_s,
    EdgeResponseStatus=EdgeResponseStatus_d,
    EdgeServerIP=EdgeServerIP_s,
    EdgeStartTimestamp=EdgeStartTimestamp_t,
    FirewallMatchesSources=FirewallMatchesSources_s,
    DstIpAddr=OriginIP_s,
    OriginResponseBytes=OriginResponseBytes_d,
    OriginResponseHTTPExpires=OriginResponseHTTPExpires_s,
    OriginResponseHTTPLastModified=OriginResponseHTTPLastModified_s,
    HttpStatusCode=OriginResponseStatus_d,
    OriginResponseTime=OriginResponseTime_d,
    OriginSSLProtocol=OriginSSLProtocol_s,
    ParentRayID=ParentRayID_s,
    RayID=RayID_s,
    SecurityLevel=SecurityLevel_s,
    WAFAction=WAFAction_s,
    WAFFlags=WAFFlags_s,
    WAFMatchedVar=WAFMatchedVar_s,
    WAFProfile=WAFProfile_s,
    WAFRuleID=WAFRuleID_s,
    WAFRuleMessage=WAFRuleMessage_s,
    WorkerCPUTime=WorkerCPUTime_d,
    WorkerStatus=WorkerStatus_s,
    WorkerSubrequest=WorkerSubrequest_b,
    WorkerSubrequestCount=WorkerSubrequestCount_d,
    ZoneID=ZoneID_d,
    Application=Application_s,
    ClientMatchedIpFirewall=ClientMatchedIpFirewall_s,
    NetworkProtocol=ClientProto_s,
    ClientTcpRtt=ClientTcpRtt_d,
    ClientTlsClientHelloServerName=ClientTlsClientHelloServerName_s,
    ClientTlsStatus=ClientTlsStatus_s,
    ColoCode=ColoCode_s,
    ConnectTimestamp=ConnectTimestamp_t,
    DisconnectTimestamp=DisconnectTimestamp_t,
    IpFirewall=IpFirewall_b,
    DstPortNumber=OriginPort_d,
    OriginProto=OriginProto_s,
    OriginTcpRtt=OriginTcpRtt_d,
    OriginTlsCipher=OriginTlsCipher_s,
    OriginTlsFingerprint=OriginTlsFingerprint_s,
    OriginTlsMode=OriginTlsMode_s,
    OriginTlsProtocol=OriginTlsProtocol_s,
    OriginTlsStatus=OriginTlsStatus_s,
    ProxyProtocol=ProxyProtocol_s,
    EventResult=Status_d,
    Timestamp=Timestamp_t,
    ClientASNDescription=ClientASNDescription_s,
    ClientRefererHost=ClientRefererHost_s,
    ClientRefererPath=ClientRefererPath_s,
    ClientRefererQuery=ClientRefererQuery_s,
    ClientRefererScheme=ClientRefererScheme_s,
    ClientRequestQuery=ClientRequestQuery_s,
    ClientRequestScheme=ClientRequestScheme_s,
    Datetime=Datetime_t,
    EventSubType=Kind_s,
    MatchIndex=MatchIndex_d,
    OriginatorRayID=OriginatorRayID_s
| project-away 
    ClientDeviceType_s,
    Source_s,
    ClientSSLCipher_s,
    ClientTlsCipher_s,
    ClientSSLProtocol_s,
    ClientTlsProtocol_s,
    FirewallMatchesActions_s,
    Event_s,
    Action_s,
    FirewallMatchesRuleIDs_s,
    RuleID_s