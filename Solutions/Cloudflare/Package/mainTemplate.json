{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for Cloudflare"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Cloudflare",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "Cloudflare",
    "_solutionVersion": "3.0.2",
    "solutionId": "cloudflare.cloudflare_sentinel",
    "_solutionId": "[variables('solutionId')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "CloudflareDefinition",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "CloudflareDefinitionConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "uiConfigId2": "CloudflareDataConnector",
    "_uiConfigId2": "[variables('uiConfigId2')]",
    "dataConnectorContentId2": "CloudflareDataConnector",
    "_dataConnectorContentId2": "[variables('dataConnectorContentId2')]",
    "dataConnectorId2": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
    "_dataConnectorId2": "[variables('dataConnectorId2')]",
    "dataConnectorTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId2'))))]",
    "dataConnectorVersion2": "1.0.0",
    "_dataConnectorcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId2'),'-', variables('dataConnectorVersion2'))))]",
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','Cloudflare')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'Cloudflare')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('Cloudflare-Parser')))]",
      "parserVersion1": "1.0.0",
      "parserContentId1": "Cloudflare-Parser"
    },
    "workbookVersion1": "1.0",
    "workbookContentId1": "CloudflareWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "huntingQueryObject1": {
      "huntingQueryVersion1": "1.0.0",
      "_huntingQuerycontentId1": "5d72f483-929a-498a-b840-dff7deed2116",
      "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('5d72f483-929a-498a-b840-dff7deed2116')))]"
    },
    "huntingQueryObject2": {
      "huntingQueryVersion2": "1.0.0",
      "_huntingQuerycontentId2": "20ef3865-fd1f-44a4-ac8f-8d026cf954e0",
      "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('20ef3865-fd1f-44a4-ac8f-8d026cf954e0')))]"
    },
    "huntingQueryObject3": {
      "huntingQueryVersion3": "1.0.0",
      "_huntingQuerycontentId3": "d72d0055-ae52-43b5-859e-db72e5ef183a",
      "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('d72d0055-ae52-43b5-859e-db72e5ef183a')))]"
    },
    "huntingQueryObject4": {
      "huntingQueryVersion4": "1.0.0",
      "_huntingQuerycontentId4": "a6f1938f-2f87-446c-83ac-624c277cfd32",
      "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('a6f1938f-2f87-446c-83ac-624c277cfd32')))]"
    },
    "huntingQueryObject5": {
      "huntingQueryVersion5": "1.0.0",
      "_huntingQuerycontentId5": "7c8f0bed-b25c-4d48-9afa-c505e141bf4b",
      "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('7c8f0bed-b25c-4d48-9afa-c505e141bf4b')))]"
    },
    "huntingQueryObject6": {
      "huntingQueryVersion6": "1.0.0",
      "_huntingQuerycontentId6": "e1a9febc-6b37-47e6-b5a7-0eec7638ba82",
      "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('e1a9febc-6b37-47e6-b5a7-0eec7638ba82')))]"
    },
    "huntingQueryObject7": {
      "huntingQueryVersion7": "1.0.0",
      "_huntingQuerycontentId7": "eb7b88ab-47b1-483f-95b3-2b315d98d465",
      "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('eb7b88ab-47b1-483f-95b3-2b315d98d465')))]"
    },
    "huntingQueryObject8": {
      "huntingQueryVersion8": "1.0.0",
      "_huntingQuerycontentId8": "8a72cdb0-97d9-4547-9eca-1bdea2ccd796",
      "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('8a72cdb0-97d9-4547-9eca-1bdea2ccd796')))]"
    },
    "huntingQueryObject9": {
      "huntingQueryVersion9": "1.0.0",
      "_huntingQuerycontentId9": "9fc7d945-0e82-4664-aca0-dc121a5cd7be",
      "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('9fc7d945-0e82-4664-aca0-dc121a5cd7be')))]"
    },
    "huntingQueryObject10": {
      "huntingQueryVersion10": "1.0.0",
      "_huntingQuerycontentId10": "0be3ddc1-99db-4153-ba3c-2c1e5c82560d",
      "huntingQueryTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('0be3ddc1-99db-4153-ba3c-2c1e5c82560d')))]"
    },
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "a7ce6135-9d55-4f14-b058-adc2e920a4fa",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'a7ce6135-9d55-4f14-b058-adc2e920a4fa')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('a7ce6135-9d55-4f14-b058-adc2e920a4fa')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','a7ce6135-9d55-4f14-b058-adc2e920a4fa','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "729c6d21-fad9-4a6a-9c7f-482393c95957",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '729c6d21-fad9-4a6a-9c7f-482393c95957')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('729c6d21-fad9-4a6a-9c7f-482393c95957')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','729c6d21-fad9-4a6a-9c7f-482393c95957','-', '1.0.0')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "ef877d68-755f-4cf1-ac1d-f336e395667c",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'ef877d68-755f-4cf1-ac1d-f336e395667c')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('ef877d68-755f-4cf1-ac1d-f336e395667c')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','ef877d68-755f-4cf1-ac1d-f336e395667c','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "fc50076a-0275-43d5-b9dd-38346c061f67",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'fc50076a-0275-43d5-b9dd-38346c061f67')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('fc50076a-0275-43d5-b9dd-38346c061f67')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','fc50076a-0275-43d5-b9dd-38346c061f67','-', '1.0.0')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.0",
      "_analyticRulecontentId5": "40554544-6e4a-4413-8d14-bf2de939c5d9",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '40554544-6e4a-4413-8d14-bf2de939c5d9')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('40554544-6e4a-4413-8d14-bf2de939c5d9')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','40554544-6e4a-4413-8d14-bf2de939c5d9','-', '1.0.0')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.0",
      "_analyticRulecontentId6": "7313352a-09f6-4a84-88bd-6f17f1cbeb8f",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '7313352a-09f6-4a84-88bd-6f17f1cbeb8f')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('7313352a-09f6-4a84-88bd-6f17f1cbeb8f')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','7313352a-09f6-4a84-88bd-6f17f1cbeb8f','-', '1.0.0')))]"
    },
    "analyticRuleObject7": {
      "analyticRuleVersion7": "1.0.1",
      "_analyticRulecontentId7": "f32142b1-4bcb-45c0-92e4-2ddc18768522",
      "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'f32142b1-4bcb-45c0-92e4-2ddc18768522')]",
      "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('f32142b1-4bcb-45c0-92e4-2ddc18768522')))]",
      "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','f32142b1-4bcb-45c0-92e4-2ddc18768522','-', '1.0.1')))]"
    },
    "analyticRuleObject8": {
      "analyticRuleVersion8": "1.0.0",
      "_analyticRulecontentId8": "dcb797cd-a4cd-4306-897b-7991f71d7e27",
      "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'dcb797cd-a4cd-4306-897b-7991f71d7e27')]",
      "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('dcb797cd-a4cd-4306-897b-7991f71d7e27')))]",
      "_analyticRulecontentProductId8": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','dcb797cd-a4cd-4306-897b-7991f71d7e27','-', '1.0.0')))]"
    },
    "analyticRuleObject9": {
      "analyticRuleVersion9": "1.0.0",
      "_analyticRulecontentId9": "f53fe2a9-96b5-454c-827e-cf1764a67fb0",
      "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'f53fe2a9-96b5-454c-827e-cf1764a67fb0')]",
      "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('f53fe2a9-96b5-454c-827e-cf1764a67fb0')))]",
      "_analyticRulecontentProductId9": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','f53fe2a9-96b5-454c-827e-cf1764a67fb0','-', '1.0.0')))]"
    },
    "analyticRuleObject10": {
      "analyticRuleVersion10": "1.0.0",
      "_analyticRulecontentId10": "4d9d00b9-31a6-49e4-88c1-9e68277053ac",
      "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4d9d00b9-31a6-49e4-88c1-9e68277053ac')]",
      "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4d9d00b9-31a6-49e4-88c1-9e68277053ac')))]",
      "_analyticRulecontentProductId10": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','4d9d00b9-31a6-49e4-88c1-9e68277053ac','-', '1.0.0')))]"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "Cloudflare (Using Blob Container) (via Codeless Connector Framework)",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "CloudflareDefinition",
                  "title": "Cloudflare (Using Blob Container) (via Codeless Connector Framework)",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": " The Cloudflare data connector provides the capability to ingest Cloudflare logs into Microsoft Sentinel using the Cloudflare Logpush and Azure Blob Storage. Refer to [Cloudflare documentation](https://developers.cloudflare.com/logs/about/)for more information.",
                  "graphQueriesTableName": "CloudflareV2_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total events received",
                      "legend": "Cloudflare logs",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Cloudflare Logs",
                      "query": "{{graphQueriesTableName}}\n | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n|summarize Time = max(TimeGenerated)\n|where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": true,
                          "action": false
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Create a storage account and a container",
                        "description": "Before setting up logpush in Cloudflare, first create a storage account and a container in Microsoft Azure. Use [this guide](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction) to know more about Container and Blob. Follow the steps in the [documentation](https://learn.microsoft.com/en-us/azure/storage/common/storage-account-create?tabs=azure-portal) to create an Azure Storage account."
                      },
                      {
                        "name": "Generate a Blob SAS URL",
                        "description": "Create and Write permissions are required. Refer the [documentation](https://learn.microsoft.com/en-us/azure/ai-services/translator/document-translation/how-to-guides/create-sas-tokens?tabs=Containers) to know more about Blob SAS token and url."
                      },
                      {
                        "name": "Collecting logs from Cloudflare to your Blob container",
                        "description": "Follow the steps in the [documentation](https://developers.cloudflare.com/logs/get-started/enable-destinations/azure/) for collecting logs from Cloudflare to your Blob container."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "title": "Connect Cloudflare Logs to Microsoft Sentinel",
                      "description": "To enable Cloudflare logs for Microsoft Sentinel, provide the required information below and click on Connect.\n>",
                      "instructions": [
                        {
                          "parameters": {
                            "tenantId": "[subscription().tenantId]",
                            "name": "principalId",
                            "appId": "4f05ce56-95b6-4612-9d98-a45c8cc33f9f"
                          },
                          "type": "ServicePrincipalIDTextBox_test"
                        },
                        {
                          "parameters": {
                            "label": "The Blob container's URL you want to collect data from",
                            "type": "text",
                            "name": "blobContainerUri",
                            "validations": {
                              "required": true
                            }
                          },
                          "type": "Textbox"
                        },
                        {
                          "parameters": {
                            "label": "The Blob container's storage account resource group name",
                            "type": "text",
                            "name": "StorageAccountResourceGroupName",
                            "validations": {
                              "required": true
                            }
                          },
                          "type": "Textbox"
                        },
                        {
                          "parameters": {
                            "label": "The Blob container's storage account location",
                            "type": "text",
                            "name": "StorageAccountLocation",
                            "validations": {
                              "required": true
                            }
                          },
                          "type": "Textbox"
                        },
                        {
                          "parameters": {
                            "label": "The Blob container's storage account subscription id",
                            "type": "text",
                            "name": "StorageAccountSubscription",
                            "validations": {
                              "required": true
                            }
                          },
                          "type": "Textbox"
                        },
                        {
                          "parameters": {
                            "label": "The event grid topic name of the blob container's storage account if exist. else keep empty.",
                            "description": "The data flow using event grid to send 'blob-created event' notifications. There could be only one event grid topic for each storage account.\nGo to your blob container's storage account and look in the 'Events' section. If you already have a topic, please provide it's name. Else, keep the text box empty.",
                            "type": "text",
                            "name": "EGSystemTopicName",
                            "validations": {
                              "required": false
                            }
                          },
                          "type": "Textbox"
                        },
                        {
                          "parameters": {
                            "label": "toggle",
                            "name": "toggle"
                          },
                          "type": "ConnectionToggleButton"
                        }
                      ]
                    }
                  ],
                  "isConnectivityCriteriasMatchSome": false
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "CloudflareDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-Cloudflare": {
                    "columns": [
                      {
                        "name": "AccountID",
                        "type": "string"
                      },
                      {
                        "name": "BytesReceived",
                        "type": "int"
                      },
                      {
                        "name": "BytesSent",
                        "type": "int"
                      },
                      {
                        "name": "ClientTCPHandshakeDurationMs",
                        "type": "int"
                      },
                      {
                        "name": "ClientTLSCipher",
                        "type": "string"
                      },
                      {
                        "name": "ClientTLSHandshakeDurationMs",
                        "type": "int"
                      },
                      {
                        "name": "ClientTLSVersion",
                        "type": "string"
                      },
                      {
                        "name": "ConnectionCloseReason",
                        "type": "string"
                      },
                      {
                        "name": "ConnectionReuse",
                        "type": "boolean"
                      },
                      {
                        "name": "DestinationTunnelID",
                        "type": "string"
                      },
                      {
                        "name": "DetectedProtocol",
                        "type": "string"
                      },
                      {
                        "name": "DeviceID",
                        "type": "string"
                      },
                      {
                        "name": "DeviceName",
                        "type": "string"
                      },
                      {
                        "name": "EgressColoName",
                        "type": "string"
                      },
                      {
                        "name": "EgressIP",
                        "type": "string"
                      },
                      {
                        "name": "EgressPort",
                        "type": "int"
                      },
                      {
                        "name": "EgressRuleID",
                        "type": "string"
                      },
                      {
                        "name": "EgressRuleName",
                        "type": "string"
                      },
                      {
                        "name": "Email",
                        "type": "string"
                      },
                      {
                        "name": "IngressColoName",
                        "type": "string"
                      },
                      {
                        "name": "Offramp",
                        "type": "string"
                      },
                      {
                        "name": "OriginIP",
                        "type": "string"
                      },
                      {
                        "name": "OriginPort",
                        "type": "int"
                      },
                      {
                        "name": "OriginTLSCertificateIssuer",
                        "type": "string"
                      },
                      {
                        "name": "OriginTLSCertificateValidationResult",
                        "type": "string"
                      },
                      {
                        "name": "OriginTLSCipher",
                        "type": "string"
                      },
                      {
                        "name": "OriginTLSHandshakeDurationMs",
                        "type": "int"
                      },
                      {
                        "name": "OriginTLSVersion",
                        "type": "string"
                      },
                      {
                        "name": "Protocol",
                        "type": "string"
                      },
                      {
                        "name": "RegistrationID",
                        "type": "string"
                      },
                      {
                        "name": "RuleEvaluationDurationMs",
                        "type": "int"
                      },
                      {
                        "name": "SessionEndTime",
                        "type": "datetime"
                      },
                      {
                        "name": "SessionID",
                        "type": "string"
                      },
                      {
                        "name": "SessionStartTime",
                        "type": "datetime"
                      },
                      {
                        "name": "SourceIP",
                        "type": "string"
                      },
                      {
                        "name": "SourceInternalIP",
                        "type": "string"
                      },
                      {
                        "name": "SourcePort",
                        "type": "int"
                      },
                      {
                        "name": "UserID",
                        "type": "string"
                      },
                      {
                        "name": "CPUTimeMs",
                        "type": "int"
                      },
                      {
                        "name": "DispatchNamespace",
                        "type": "string"
                      },
                      {
                        "name": "Entrypoint",
                        "type": "string"
                      },
                      {
                        "name": "Event",
                        "type": "string"
                      },
                      {
                        "name": "EventTimestampMs",
                        "type": "int"
                      },
                      {
                        "name": "EventType",
                        "type": "string"
                      },
                      {
                        "name": "Exceptions",
                        "type": "string"
                      },
                      {
                        "name": "Logs",
                        "type": "string"
                      },
                      {
                        "name": "Outcome",
                        "type": "string"
                      },
                      {
                        "name": "ScriptName",
                        "type": "string"
                      },
                      {
                        "name": "ScriptTags",
                        "type": "string"
                      },
                      {
                        "name": "ScriptVersion",
                        "type": "string"
                      },
                      {
                        "name": "WallTimeMs",
                        "type": "int"
                      },
                      {
                        "name": "ClientAddress",
                        "type": "string"
                      },
                      {
                        "name": "Error",
                        "type": "string"
                      },
                      {
                        "name": "PTY",
                        "type": "string"
                      },
                      {
                        "name": "Payload",
                        "type": "string"
                      },
                      {
                        "name": "ProgramFinishDatetime",
                        "type": "string"
                      },
                      {
                        "name": "ProgramID",
                        "type": "string"
                      },
                      {
                        "name": "ProgramStartDatetime",
                        "type": "string"
                      },
                      {
                        "name": "ProgramType",
                        "type": "string"
                      },
                      {
                        "name": "ServerAddress",
                        "type": "string"
                      },
                      {
                        "name": "SessionFinishDatetime",
                        "type": "string"
                      },
                      {
                        "name": "SessionStartDatetime",
                        "type": "string"
                      },
                      {
                        "name": "TargetID",
                        "type": "string"
                      },
                      {
                        "name": "UserEmail",
                        "type": "string"
                      },
                      {
                        "name": "Username",
                        "type": "string"
                      },
                      {
                        "name": "Body",
                        "type": "string"
                      },
                      {
                        "name": "BodyLength",
                        "type": "int"
                      },
                      {
                        "name": "DestAddr",
                        "type": "string"
                      },
                      {
                        "name": "Headers",
                        "type": "string"
                      },
                      {
                        "name": "Host",
                        "type": "string"
                      },
                      {
                        "name": "Method",
                        "type": "string"
                      },
                      {
                        "name": "Password",
                        "type": "string"
                      },
                      {
                        "name": "R2Path",
                        "type": "string"
                      },
                      {
                        "name": "Referrer",
                        "type": "string"
                      },
                      {
                        "name": "SinkholeID",
                        "type": "string"
                      },
                      {
                        "name": "SrcAddr",
                        "type": "string"
                      },
                      {
                        "name": "Timestamp",
                        "type": "string"
                      },
                      {
                        "name": "URI",
                        "type": "string"
                      },
                      {
                        "name": "URL",
                        "type": "string"
                      },
                      {
                        "name": "UserAgent",
                        "type": "string"
                      },
                      {
                        "name": "AttackCampaignID",
                        "type": "string"
                      },
                      {
                        "name": "AttackID",
                        "type": "string"
                      },
                      {
                        "name": "AttackVector",
                        "type": "string"
                      },
                      {
                        "name": "ColoCity",
                        "type": "string"
                      },
                      {
                        "name": "ColoCode",
                        "type": "string"
                      },
                      {
                        "name": "ColoCountry",
                        "type": "string"
                      },
                      {
                        "name": "ColoGeoHash",
                        "type": "string"
                      },
                      {
                        "name": "ColoName",
                        "type": "string"
                      },
                      {
                        "name": "Datetime",
                        "type": "string"
                      },
                      {
                        "name": "DestinationASN",
                        "type": "int"
                      },
                      {
                        "name": "DestinationASNName",
                        "type": "string"
                      },
                      {
                        "name": "DestinationCountry",
                        "type": "string"
                      },
                      {
                        "name": "DestinationGeoHash",
                        "type": "string"
                      },
                      {
                        "name": "DestinationPort",
                        "type": "int"
                      },
                      {
                        "name": "Direction",
                        "type": "string"
                      },
                      {
                        "name": "GREChecksum",
                        "type": "int"
                      },
                      {
                        "name": "GREEtherType",
                        "type": "int"
                      },
                      {
                        "name": "GREHeaderLength",
                        "type": "int"
                      },
                      {
                        "name": "GREKey",
                        "type": "int"
                      },
                      {
                        "name": "GRESequenceNumber",
                        "type": "int"
                      },
                      {
                        "name": "GREVersion",
                        "type": "int"
                      },
                      {
                        "name": "ICMPChecksum",
                        "type": "int"
                      },
                      {
                        "name": "ICMPCode",
                        "type": "int"
                      },
                      {
                        "name": "ICMPType",
                        "type": "int"
                      },
                      {
                        "name": "IPDestinationAddress",
                        "type": "string"
                      },
                      {
                        "name": "IPDestinationSubnet",
                        "type": "string"
                      },
                      {
                        "name": "IPFragmentOffset",
                        "type": "int"
                      },
                      {
                        "name": "IPHeaderLength",
                        "type": "int"
                      },
                      {
                        "name": "IPMoreFragments",
                        "type": "int"
                      },
                      {
                        "name": "IPProtocol",
                        "type": "int"
                      },
                      {
                        "name": "IPProtocolName",
                        "type": "string"
                      },
                      {
                        "name": "IPSourceAddress",
                        "type": "string"
                      },
                      {
                        "name": "IPSourceSubnet",
                        "type": "string"
                      },
                      {
                        "name": "IPTTL",
                        "type": "int"
                      },
                      {
                        "name": "IPTTLBuckets",
                        "type": "int"
                      },
                      {
                        "name": "IPTotalLength",
                        "type": "int"
                      },
                      {
                        "name": "IPTotalLengthBuckets",
                        "type": "int"
                      },
                      {
                        "name": "IPv4Checksum",
                        "type": "int"
                      },
                      {
                        "name": "IPv4DSCP",
                        "type": "int"
                      },
                      {
                        "name": "IPv4DontFragment",
                        "type": "int"
                      },
                      {
                        "name": "IPv4ECN",
                        "type": "int"
                      },
                      {
                        "name": "IPv4Identification",
                        "type": "int"
                      },
                      {
                        "name": "IPv4Options",
                        "type": "string"
                      },
                      {
                        "name": "IPv6DSCP",
                        "type": "int"
                      },
                      {
                        "name": "IPv6ECN",
                        "type": "int"
                      },
                      {
                        "name": "IPv6ExtensionHeaders",
                        "type": "string"
                      },
                      {
                        "name": "IPv6FlowLabel",
                        "type": "int"
                      },
                      {
                        "name": "IPv6Identification",
                        "type": "int"
                      },
                      {
                        "name": "MitigationReason",
                        "type": "string"
                      },
                      {
                        "name": "MitigationScope",
                        "type": "string"
                      },
                      {
                        "name": "MitigationSystem",
                        "type": "string"
                      },
                      {
                        "name": "ProtocolState",
                        "type": "string"
                      },
                      {
                        "name": "RuleID",
                        "type": "string"
                      },
                      {
                        "name": "RuleName",
                        "type": "string"
                      },
                      {
                        "name": "RulesetID",
                        "type": "string"
                      },
                      {
                        "name": "RulesetOverrideID",
                        "type": "string"
                      },
                      {
                        "name": "SampleInterval",
                        "type": "int"
                      },
                      {
                        "name": "SourceASN",
                        "type": "int"
                      },
                      {
                        "name": "SourceASNName",
                        "type": "string"
                      },
                      {
                        "name": "SourceCountry",
                        "type": "string"
                      },
                      {
                        "name": "SourceGeoHash",
                        "type": "string"
                      },
                      {
                        "name": "TCPAcknowledgementNumber",
                        "type": "int"
                      },
                      {
                        "name": "TCPChecksum",
                        "type": "int"
                      },
                      {
                        "name": "TCPDataOffset",
                        "type": "int"
                      },
                      {
                        "name": "TCPFlags",
                        "type": "int"
                      },
                      {
                        "name": "TCPFlagsString",
                        "type": "string"
                      },
                      {
                        "name": "TCPMSS",
                        "type": "int"
                      },
                      {
                        "name": "TCPOptions",
                        "type": "string"
                      },
                      {
                        "name": "TCPSACKBlocks",
                        "type": "string"
                      },
                      {
                        "name": "TCPSACKPermitted",
                        "type": "int"
                      },
                      {
                        "name": "TCPSequenceNumber",
                        "type": "int"
                      },
                      {
                        "name": "TCPTimestampECR",
                        "type": "int"
                      },
                      {
                        "name": "TCPTimestampValue",
                        "type": "int"
                      },
                      {
                        "name": "TCPUrgentPointer",
                        "type": "int"
                      },
                      {
                        "name": "TCPWindowScale",
                        "type": "int"
                      },
                      {
                        "name": "TCPWindowSize",
                        "type": "int"
                      },
                      {
                        "name": "UDPChecksum",
                        "type": "int"
                      },
                      {
                        "name": "UDPPayloadLength",
                        "type": "int"
                      },
                      {
                        "name": "Verdict",
                        "type": "string"
                      },
                      {
                        "name": "Action",
                        "type": "string"
                      },
                      {
                        "name": "DestinationIP",
                        "type": "string"
                      },
                      {
                        "name": "SignatureID",
                        "type": "int"
                      },
                      {
                        "name": "SignatureMessage",
                        "type": "string"
                      },
                      {
                        "name": "SignatureRevision",
                        "type": "int"
                      },
                      {
                        "name": "ApplicationIDs",
                        "type": "int"
                      },
                      {
                        "name": "ApplicationNames",
                        "type": "string"
                      },
                      {
                        "name": "CategoryIDs",
                        "type": "int"
                      },
                      {
                        "name": "CategoryNames",
                        "type": "string"
                      },
                      {
                        "name": "DestinationIPContinentCode",
                        "type": "string"
                      },
                      {
                        "name": "DestinationIPCountryCode",
                        "type": "string"
                      },
                      {
                        "name": "OverrideIP",
                        "type": "string"
                      },
                      {
                        "name": "OverridePort",
                        "type": "int"
                      },
                      {
                        "name": "PolicyID",
                        "type": "string"
                      },
                      {
                        "name": "PolicyName",
                        "type": "string"
                      },
                      {
                        "name": "ProxyEndpoint",
                        "type": "string"
                      },
                      {
                        "name": "SNI",
                        "type": "string"
                      },
                      {
                        "name": "SourceIPContinentCode",
                        "type": "string"
                      },
                      {
                        "name": "SourceIPCountryCode",
                        "type": "string"
                      },
                      {
                        "name": "TransportProtocol",
                        "type": "string"
                      },
                      {
                        "name": "VirtualNetworkID",
                        "type": "string"
                      },
                      {
                        "name": "VirtualNetworkName",
                        "type": "string"
                      },
                      {
                        "name": "BlockedFileHash",
                        "type": "string"
                      },
                      {
                        "name": "BlockedFileName",
                        "type": "string"
                      },
                      {
                        "name": "BlockedFileReason",
                        "type": "string"
                      },
                      {
                        "name": "BlockedFileSize",
                        "type": "int"
                      },
                      {
                        "name": "BlockedFileType",
                        "type": "string"
                      },
                      {
                        "name": "DownloadMatchedDlpProfileEntries",
                        "type": "string"
                      },
                      {
                        "name": "DownloadMatchedDlpProfiles",
                        "type": "string"
                      },
                      {
                        "name": "DownloadedFileNames",
                        "type": "string"
                      },
                      {
                        "name": "FileInfo",
                        "type": "string"
                      },
                      {
                        "name": "ForensicCopyStatus",
                        "type": "string"
                      },
                      {
                        "name": "HTTPHost",
                        "type": "string"
                      },
                      {
                        "name": "HTTPMethod",
                        "type": "string"
                      },
                      {
                        "name": "HTTPStatusCode",
                        "type": "int"
                      },
                      {
                        "name": "HTTPVersion",
                        "type": "string"
                      },
                      {
                        "name": "IsIsolated",
                        "type": "boolean"
                      },
                      {
                        "name": "PrivateAppAUD",
                        "type": "string"
                      },
                      {
                        "name": "Quarantined",
                        "type": "boolean"
                      },
                      {
                        "name": "RedirectTargetURI",
                        "type": "string"
                      },
                      {
                        "name": "Referer",
                        "type": "string"
                      },
                      {
                        "name": "RequestID",
                        "type": "string"
                      },
                      {
                        "name": "UntrustedCertificateAction",
                        "type": "string"
                      },
                      {
                        "name": "UploadMatchedDlpProfileEntries",
                        "type": "string"
                      },
                      {
                        "name": "UploadMatchedDlpProfiles",
                        "type": "string"
                      },
                      {
                        "name": "UploadedFileNames",
                        "type": "string"
                      },
                      {
                        "name": "AuthoritativeNameServerIPs",
                        "type": "string"
                      },
                      {
                        "name": "CNAMECategoryIDs",
                        "type": "int"
                      },
                      {
                        "name": "CNAMECategoryNames",
                        "type": "string"
                      },
                      {
                        "name": "CNAMEs",
                        "type": "string"
                      },
                      {
                        "name": "CNAMEsReversed",
                        "type": "string"
                      },
                      {
                        "name": "ColoID",
                        "type": "int"
                      },
                      {
                        "name": "CustomResolveDurationMs",
                        "type": "int"
                      },
                      {
                        "name": "CustomResolverAddress",
                        "type": "string"
                      },
                      {
                        "name": "CustomResolverPolicyID",
                        "type": "string"
                      },
                      {
                        "name": "CustomResolverPolicyName",
                        "type": "string"
                      },
                      {
                        "name": "CustomResolverResponse",
                        "type": "string"
                      },
                      {
                        "name": "DoHSubdomain",
                        "type": "string"
                      },
                      {
                        "name": "DoTSubdomain",
                        "type": "string"
                      },
                      {
                        "name": "DstIP",
                        "type": "string"
                      },
                      {
                        "name": "DstPort",
                        "type": "int"
                      },
                      {
                        "name": "EDEErrors",
                        "type": "int"
                      },
                      {
                        "name": "InitialCategoryIDs",
                        "type": "int"
                      },
                      {
                        "name": "InitialCategoryNames",
                        "type": "string"
                      },
                      {
                        "name": "InitialResolvedIPs",
                        "type": "string"
                      },
                      {
                        "name": "InternalDNSFallbackStrategy",
                        "type": "string"
                      },
                      {
                        "name": "InternalDNSRCode",
                        "type": "int"
                      },
                      {
                        "name": "InternalDNSViewID",
                        "type": "string"
                      },
                      {
                        "name": "InternalDNSZoneID",
                        "type": "string"
                      },
                      {
                        "name": "IsResponseCached",
                        "type": "boolean"
                      },
                      {
                        "name": "Location",
                        "type": "string"
                      },
                      {
                        "name": "LocationID",
                        "type": "string"
                      },
                      {
                        "name": "MatchedCategoryIDs",
                        "type": "int"
                      },
                      {
                        "name": "MatchedCategoryNames",
                        "type": "string"
                      },
                      {
                        "name": "MatchedIndicatorFeedIDs",
                        "type": "int"
                      },
                      {
                        "name": "MatchedIndicatorFeedNames",
                        "type": "string"
                      },
                      {
                        "name": "QueryCategoryIDs",
                        "type": "int"
                      },
                      {
                        "name": "QueryCategoryNames",
                        "type": "string"
                      },
                      {
                        "name": "QueryID",
                        "type": "string"
                      },
                      {
                        "name": "QueryIndicatorFeedIDs",
                        "type": "int"
                      },
                      {
                        "name": "QueryIndicatorFeedNames",
                        "type": "string"
                      },
                      {
                        "name": "QueryName",
                        "type": "string"
                      },
                      {
                        "name": "QueryNameReversed",
                        "type": "string"
                      },
                      {
                        "name": "QuerySize",
                        "type": "int"
                      },
                      {
                        "name": "QueryType",
                        "type": "int"
                      },
                      {
                        "name": "QueryTypeName",
                        "type": "string"
                      },
                      {
                        "name": "RCode",
                        "type": "int"
                      },
                      {
                        "name": "RData",
                        "type": "string"
                      },
                      {
                        "name": "RequestContextCategoryIDs",
                        "type": "int"
                      },
                      {
                        "name": "RequestContextCategoryNames",
                        "type": "string"
                      },
                      {
                        "name": "ResolvedIPCategoryIDs",
                        "type": "int"
                      },
                      {
                        "name": "ResolvedIPCategoryNames",
                        "type": "string"
                      },
                      {
                        "name": "ResolvedIPContinentCodes",
                        "type": "string"
                      },
                      {
                        "name": "ResolvedIPCountryCodes",
                        "type": "string"
                      },
                      {
                        "name": "ResolverDecision",
                        "type": "string"
                      },
                      {
                        "name": "ResourceRecords",
                        "type": "string"
                      },
                      {
                        "name": "ResourceRecordsJSON",
                        "type": "string"
                      },
                      {
                        "name": "SrcIP",
                        "type": "string"
                      },
                      {
                        "name": "SrcIPContinentCode",
                        "type": "string"
                      },
                      {
                        "name": "SrcIPCountryCode",
                        "type": "string"
                      },
                      {
                        "name": "SrcPort",
                        "type": "int"
                      },
                      {
                        "name": "TimeZone",
                        "type": "string"
                      },
                      {
                        "name": "TimeZoneInferredMethod",
                        "type": "string"
                      },
                      {
                        "name": "AlertID",
                        "type": "string"
                      },
                      {
                        "name": "AlertReasons",
                        "type": "string"
                      },
                      {
                        "name": "Attachments",
                        "type": "string"
                      },
                      {
                        "name": "CC",
                        "type": "string"
                      },
                      {
                        "name": "CCName",
                        "type": "string"
                      },
                      {
                        "name": "FinalDisposition",
                        "type": "string"
                      },
                      {
                        "name": "From",
                        "type": "string"
                      },
                      {
                        "name": "FromName",
                        "type": "string"
                      },
                      {
                        "name": "Links",
                        "type": "string"
                      },
                      {
                        "name": "MessageDeliveryMode",
                        "type": "string"
                      },
                      {
                        "name": "MessageID",
                        "type": "string"
                      },
                      {
                        "name": "Origin",
                        "type": "string"
                      },
                      {
                        "name": "OriginalSender",
                        "type": "string"
                      },
                      {
                        "name": "ReplyTo",
                        "type": "string"
                      },
                      {
                        "name": "ReplyToName",
                        "type": "string"
                      },
                      {
                        "name": "SMTPEnvelopeFrom",
                        "type": "string"
                      },
                      {
                        "name": "SMTPEnvelopeTo",
                        "type": "string"
                      },
                      {
                        "name": "SMTPHeloServerIP",
                        "type": "string"
                      },
                      {
                        "name": "SMTPHeloServerIPAsName",
                        "type": "string"
                      },
                      {
                        "name": "SMTPHeloServerIPAsNumber",
                        "type": "string"
                      },
                      {
                        "name": "SMTPHeloServerIPGeo",
                        "type": "string"
                      },
                      {
                        "name": "SMTPHeloServerName",
                        "type": "string"
                      },
                      {
                        "name": "Subject",
                        "type": "string"
                      },
                      {
                        "name": "ThreatCategories",
                        "type": "string"
                      },
                      {
                        "name": "To",
                        "type": "string"
                      },
                      {
                        "name": "ToName",
                        "type": "string"
                      },
                      {
                        "name": "ClientResponseCode",
                        "type": "int"
                      },
                      {
                        "name": "ClusterID",
                        "type": "string"
                      },
                      {
                        "name": "EDNSSubnet",
                        "type": "string"
                      },
                      {
                        "name": "EDNSSubnetLength",
                        "type": "int"
                      },
                      {
                        "name": "QueryDO",
                        "type": "boolean"
                      },
                      {
                        "name": "QueryRD",
                        "type": "boolean"
                      },
                      {
                        "name": "QueryTCP",
                        "type": "boolean"
                      },
                      {
                        "name": "ResponseCached",
                        "type": "boolean"
                      },
                      {
                        "name": "ResponseCachedStale",
                        "type": "boolean"
                      },
                      {
                        "name": "ResponseReason",
                        "type": "string"
                      },
                      {
                        "name": "UpstreamIP",
                        "type": "string"
                      },
                      {
                        "name": "UpstreamResponseCode",
                        "type": "int"
                      },
                      {
                        "name": "UpstreamResponseTimeMs",
                        "type": "int"
                      },
                      {
                        "name": "ForensicCopyID",
                        "type": "string"
                      },
                      {
                        "name": "GatewayRequestID",
                        "type": "string"
                      },
                      {
                        "name": "Phase",
                        "type": "string"
                      },
                      {
                        "name": "TriggeredRuleID",
                        "type": "string"
                      },
                      {
                        "name": "ClientVersion",
                        "type": "string"
                      },
                      {
                        "name": "DeviceManufacturer",
                        "type": "string"
                      },
                      {
                        "name": "DeviceModel",
                        "type": "string"
                      },
                      {
                        "name": "DeviceSerialNumber",
                        "type": "string"
                      },
                      {
                        "name": "DeviceType",
                        "type": "string"
                      },
                      {
                        "name": "OSVersion",
                        "type": "string"
                      },
                      {
                        "name": "PostureCheckName",
                        "type": "string"
                      },
                      {
                        "name": "PostureCheckType",
                        "type": "string"
                      },
                      {
                        "name": "PostureEvaluatedResult",
                        "type": "boolean"
                      },
                      {
                        "name": "PostureExpectedJSON",
                        "type": "string"
                      },
                      {
                        "name": "PostureReceivedJSON",
                        "type": "string"
                      },
                      {
                        "name": "UserUID",
                        "type": "string"
                      },
                      {
                        "name": "AssetDisplayName",
                        "type": "string"
                      },
                      {
                        "name": "AssetExternalID",
                        "type": "string"
                      },
                      {
                        "name": "AssetLink",
                        "type": "string"
                      },
                      {
                        "name": "AssetMetadata",
                        "type": "string"
                      },
                      {
                        "name": "DetectedTimestamp",
                        "type": "string"
                      },
                      {
                        "name": "FindingTypeDisplayName",
                        "type": "string"
                      },
                      {
                        "name": "FindingTypeID",
                        "type": "string"
                      },
                      {
                        "name": "FindingTypeSeverity",
                        "type": "string"
                      },
                      {
                        "name": "InstanceID",
                        "type": "string"
                      },
                      {
                        "name": "IntegrationDisplayName",
                        "type": "string"
                      },
                      {
                        "name": "IntegrationID",
                        "type": "string"
                      },
                      {
                        "name": "IntegrationPolicyVendor",
                        "type": "string"
                      },
                      {
                        "name": "Decision",
                        "type": "string"
                      },
                      {
                        "name": "DomainName",
                        "type": "string"
                      },
                      {
                        "name": "Type",
                        "type": "string"
                      },
                      {
                        "name": "ActionResult",
                        "type": "boolean"
                      },
                      {
                        "name": "ActionType",
                        "type": "string"
                      },
                      {
                        "name": "ActorEmail",
                        "type": "string"
                      },
                      {
                        "name": "ActorID",
                        "type": "string"
                      },
                      {
                        "name": "ActorIP",
                        "type": "string"
                      },
                      {
                        "name": "ActorType",
                        "type": "string"
                      },
                      {
                        "name": "ID",
                        "type": "string"
                      },
                      {
                        "name": "Interface",
                        "type": "string"
                      },
                      {
                        "name": "Metadata",
                        "type": "string"
                      },
                      {
                        "name": "NewValue",
                        "type": "string"
                      },
                      {
                        "name": "OldValue",
                        "type": "string"
                      },
                      {
                        "name": "OwnerID",
                        "type": "string"
                      },
                      {
                        "name": "ResourceID",
                        "type": "string"
                      },
                      {
                        "name": "ResourceType",
                        "type": "string"
                      },
                      {
                        "name": "When",
                        "type": "string"
                      },
                      {
                        "name": "Allowed",
                        "type": "boolean"
                      },
                      {
                        "name": "AppDomain",
                        "type": "string"
                      },
                      {
                        "name": "AppUUID",
                        "type": "string"
                      },
                      {
                        "name": "Connection",
                        "type": "string"
                      },
                      {
                        "name": "Country",
                        "type": "string"
                      },
                      {
                        "name": "CreatedAt",
                        "type": "string"
                      },
                      {
                        "name": "IPAddress",
                        "type": "string"
                      },
                      {
                        "name": "PurposeJustificationPrompt",
                        "type": "string"
                      },
                      {
                        "name": "PurposeJustificationResponse",
                        "type": "string"
                      },
                      {
                        "name": "RayID",
                        "type": "string"
                      },
                      {
                        "name": "TemporaryAccessApprovers",
                        "type": "string"
                      },
                      {
                        "name": "TemporaryAccessDuration",
                        "type": "int"
                      },
                      {
                        "name": "ClientASN",
                        "type": "int"
                      },
                      {
                        "name": "ClientASNDescription",
                        "type": "string"
                      },
                      {
                        "name": "ClientCountry",
                        "type": "string"
                      },
                      {
                        "name": "ClientIP",
                        "type": "string"
                      },
                      {
                        "name": "ClientIPClass",
                        "type": "string"
                      },
                      {
                        "name": "ClientRefererHost",
                        "type": "string"
                      },
                      {
                        "name": "ClientRefererPath",
                        "type": "string"
                      },
                      {
                        "name": "ClientRefererQuery",
                        "type": "string"
                      },
                      {
                        "name": "ClientRefererScheme",
                        "type": "string"
                      },
                      {
                        "name": "ClientRequestHost",
                        "type": "string"
                      },
                      {
                        "name": "ClientRequestMethod",
                        "type": "string"
                      },
                      {
                        "name": "ClientRequestPath",
                        "type": "string"
                      },
                      {
                        "name": "ClientRequestProtocol",
                        "type": "string"
                      },
                      {
                        "name": "ClientRequestQuery",
                        "type": "string"
                      },
                      {
                        "name": "ClientRequestScheme",
                        "type": "string"
                      },
                      {
                        "name": "ClientRequestUserAgent",
                        "type": "string"
                      },
                      {
                        "name": "ContentScanObjResults",
                        "type": "string"
                      },
                      {
                        "name": "ContentScanObjSizes",
                        "type": "int"
                      },
                      {
                        "name": "ContentScanObjTypes",
                        "type": "string"
                      },
                      {
                        "name": "Description",
                        "type": "string"
                      },
                      {
                        "name": "EdgeColoCode",
                        "type": "string"
                      },
                      {
                        "name": "EdgeResponseStatus",
                        "type": "int"
                      },
                      {
                        "name": "Kind",
                        "type": "string"
                      },
                      {
                        "name": "LeakedCredentialCheckResult",
                        "type": "string"
                      },
                      {
                        "name": "MatchIndex",
                        "type": "int"
                      },
                      {
                        "name": "OriginResponseStatus",
                        "type": "int"
                      },
                      {
                        "name": "OriginatorRayID",
                        "type": "string"
                      },
                      {
                        "name": "Ref",
                        "type": "string"
                      },
                      {
                        "name": "Source",
                        "type": "string"
                      },
                      {
                        "name": "BotDetectionIDs",
                        "type": "int"
                      },
                      {
                        "name": "BotDetectionTags",
                        "type": "string"
                      },
                      {
                        "name": "BotScore",
                        "type": "int"
                      },
                      {
                        "name": "BotScoreSrc",
                        "type": "string"
                      },
                      {
                        "name": "BotTags",
                        "type": "string"
                      },
                      {
                        "name": "CacheCacheStatus",
                        "type": "string"
                      },
                      {
                        "name": "CacheReserveUsed",
                        "type": "boolean"
                      },
                      {
                        "name": "CacheResponseBytes",
                        "type": "int"
                      },
                      {
                        "name": "CacheResponseStatus",
                        "type": "int"
                      },
                      {
                        "name": "CacheTieredFill",
                        "type": "boolean"
                      },
                      {
                        "name": "ClientCity",
                        "type": "string"
                      },
                      {
                        "name": "ClientDeviceType",
                        "type": "string"
                      },
                      {
                        "name": "ClientLatitude",
                        "type": "string"
                      },
                      {
                        "name": "ClientLongitude",
                        "type": "string"
                      },
                      {
                        "name": "ClientMTLSAuthCertFingerprint",
                        "type": "string"
                      },
                      {
                        "name": "ClientMTLSAuthStatus",
                        "type": "string"
                      },
                      {
                        "name": "ClientRegionCode",
                        "type": "string"
                      },
                      {
                        "name": "ClientRequestBytes",
                        "type": "int"
                      },
                      {
                        "name": "ClientRequestReferer",
                        "type": "string"
                      },
                      {
                        "name": "ClientRequestSource",
                        "type": "string"
                      },
                      {
                        "name": "ClientRequestURI",
                        "type": "string"
                      },
                      {
                        "name": "ClientSSLCipher",
                        "type": "string"
                      },
                      {
                        "name": "ClientSSLProtocol",
                        "type": "string"
                      },
                      {
                        "name": "ClientSrcPort",
                        "type": "int"
                      },
                      {
                        "name": "ClientTCPRTTMs",
                        "type": "int"
                      },
                      {
                        "name": "ClientXRequestedWith",
                        "type": "string"
                      },
                      {
                        "name": "Cookies",
                        "type": "string"
                      },
                      {
                        "name": "EdgeCFConnectingO2O",
                        "type": "boolean"
                      },
                      {
                        "name": "EdgeColoID",
                        "type": "int"
                      },
                      {
                        "name": "EdgeEndTimestamp",
                        "type": "string"
                      },
                      {
                        "name": "EdgePathingOp",
                        "type": "string"
                      },
                      {
                        "name": "EdgePathingSrc",
                        "type": "string"
                      },
                      {
                        "name": "EdgePathingStatus",
                        "type": "string"
                      },
                      {
                        "name": "EdgeRequestHost",
                        "type": "string"
                      },
                      {
                        "name": "EdgeResponseBodyBytes",
                        "type": "int"
                      },
                      {
                        "name": "EdgeResponseBytes",
                        "type": "int"
                      },
                      {
                        "name": "EdgeResponseCompressionRatio",
                        "type": "string"
                      },
                      {
                        "name": "EdgeResponseContentType",
                        "type": "string"
                      },
                      {
                        "name": "EdgeServerIP",
                        "type": "string"
                      },
                      {
                        "name": "EdgeStartTimestamp",
                        "type": "string"
                      },
                      {
                        "name": "EdgeTimeToFirstByteMs",
                        "type": "int"
                      },
                      {
                        "name": "JA3Hash",
                        "type": "string"
                      },
                      {
                        "name": "JA4",
                        "type": "string"
                      },
                      {
                        "name": "JA4Signals",
                        "type": "string"
                      },
                      {
                        "name": "OriginDNSResponseTimeMs",
                        "type": "int"
                      },
                      {
                        "name": "OriginRequestHeaderSendDurationMs",
                        "type": "int"
                      },
                      {
                        "name": "OriginResponseBytes",
                        "type": "int"
                      },
                      {
                        "name": "OriginResponseDurationMs",
                        "type": "int"
                      },
                      {
                        "name": "OriginResponseHTTPExpires",
                        "type": "string"
                      },
                      {
                        "name": "OriginResponseHTTPLastModified",
                        "type": "string"
                      },
                      {
                        "name": "OriginResponseHeaderReceiveDurationMs",
                        "type": "int"
                      },
                      {
                        "name": "OriginSSLProtocol",
                        "type": "string"
                      },
                      {
                        "name": "OriginTCPHandshakeDurationMs",
                        "type": "int"
                      },
                      {
                        "name": "ParentRayID",
                        "type": "string"
                      },
                      {
                        "name": "RequestHeaders",
                        "type": "string"
                      },
                      {
                        "name": "ResponseHeaders",
                        "type": "string"
                      },
                      {
                        "name": "SecurityAction",
                        "type": "string"
                      },
                      {
                        "name": "SecurityActions",
                        "type": "string"
                      },
                      {
                        "name": "SecurityRuleDescription",
                        "type": "string"
                      },
                      {
                        "name": "SecurityRuleID",
                        "type": "string"
                      },
                      {
                        "name": "SecurityRuleIDs",
                        "type": "string"
                      },
                      {
                        "name": "SecuritySources",
                        "type": "string"
                      },
                      {
                        "name": "SmartRouteColoID",
                        "type": "int"
                      },
                      {
                        "name": "UpperTierColoID",
                        "type": "int"
                      },
                      {
                        "name": "WAFAttackScore",
                        "type": "int"
                      },
                      {
                        "name": "WAFRCEAttackScore",
                        "type": "int"
                      },
                      {
                        "name": "WAFSQLiAttackScore",
                        "type": "int"
                      },
                      {
                        "name": "WAFXSSAttackScore",
                        "type": "int"
                      },
                      {
                        "name": "WorkerCPUTime",
                        "type": "int"
                      },
                      {
                        "name": "WorkerScriptName",
                        "type": "string"
                      },
                      {
                        "name": "WorkerStatus",
                        "type": "string"
                      },
                      {
                        "name": "WorkerSubrequest",
                        "type": "boolean"
                      },
                      {
                        "name": "WorkerSubrequestCount",
                        "type": "int"
                      },
                      {
                        "name": "WorkerWallTimeUs",
                        "type": "int"
                      },
                      {
                        "name": "ZoneName",
                        "type": "string"
                      },
                      {
                        "name": "ClientIPASN",
                        "type": "int"
                      },
                      {
                        "name": "ClientIPASNDescription",
                        "type": "string"
                      },
                      {
                        "name": "ClientIPCountry",
                        "type": "string"
                      },
                      {
                        "name": "LastKnownGoodColoCode",
                        "type": "string"
                      },
                      {
                        "name": "CSPDirective",
                        "type": "string"
                      },
                      {
                        "name": "PageURL",
                        "type": "string"
                      },
                      {
                        "name": "URLContainsCDNCGIPath",
                        "type": "boolean"
                      },
                      {
                        "name": "URLHost",
                        "type": "string"
                      },
                      {
                        "name": "Application",
                        "type": "string"
                      },
                      {
                        "name": "ClientBytes",
                        "type": "int"
                      },
                      {
                        "name": "ClientMatchedIpFirewall",
                        "type": "string"
                      },
                      {
                        "name": "ClientPort",
                        "type": "int"
                      },
                      {
                        "name": "ClientProto",
                        "type": "string"
                      },
                      {
                        "name": "ClientTcpRtt",
                        "type": "int"
                      },
                      {
                        "name": "ClientTlsClientHelloServerName",
                        "type": "string"
                      },
                      {
                        "name": "ClientTlsProtocol",
                        "type": "string"
                      },
                      {
                        "name": "ClientTlsStatus",
                        "type": "string"
                      },
                      {
                        "name": "ConnectTimestamp",
                        "type": "string"
                      },
                      {
                        "name": "DisconnectTimestamp",
                        "type": "string"
                      },
                      {
                        "name": "IpFirewall",
                        "type": "boolean"
                      },
                      {
                        "name": "OriginBytes",
                        "type": "int"
                      },
                      {
                        "name": "OriginProto",
                        "type": "string"
                      },
                      {
                        "name": "OriginTcpRtt",
                        "type": "int"
                      },
                      {
                        "name": "OriginTlsFingerprint",
                        "type": "string"
                      },
                      {
                        "name": "OriginTlsMode",
                        "type": "string"
                      },
                      {
                        "name": "OriginTlsProtocol",
                        "type": "string"
                      },
                      {
                        "name": "OriginTlsStatus",
                        "type": "string"
                      },
                      {
                        "name": "ProxyProtocol",
                        "type": "string"
                      },
                      {
                        "name": "Status",
                        "type": "int"
                      },
                      {
                        "name": "EventDetails",
                        "type": "dynamic"
                      },
                      {
                        "name": "IP",
                        "type": "string"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-Cloudflare"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend TimeGenerated = now(), LogType = tostring(Type) | project TimeGenerated, AccountID, BytesReceived, BytesSent, ClientTCPHandshakeDurationMs, ClientTLSCipher, ClientTLSHandshakeDurationMs, ClientTLSVersion, ConnectionCloseReason, ConnectionReuse, DestinationTunnelID, DetectedProtocol, DeviceID, DeviceName, EgressColoName, EgressIP, EgressPort, EgressRuleID, EgressRuleName, Email, IngressColoName, Offramp, OriginIP, OriginPort, OriginTLSCertificateIssuer, OriginTLSCertificateValidationResult, OriginTLSCipher, OriginTLSVersion, Protocol, RegistrationID, RuleEvaluationDurationMs, SessionEndTime, SessionID, SessionStartTime, SourceIP, SourceInternalIP, SourcePort, UserID, CPUTimeMs, DispatchNamespace, Entrypoint, Event, EventTimestampMs, EventType, Exceptions, Logs, Outcome, ScriptName, ScriptTags, ScriptVersion, WallTimeMs, ClientAddress, Error, PTY, Payload, ProgramFinishDatetime, ProgramID, ProgramStartDatetime, ProgramType, ServerAddress, SessionFinishDatetime, SessionStartDatetime, TargetID, UserEmail, Username, Body, BodyLength, DestAddr, Headers, Host, Method, Password, R2Path, Referrer, SinkholeID, SrcAddr, Timestamp, URI, URL, UserAgent, AttackCampaignID, AttackID, AttackVector, ColoCity, ColoCode, ColoCountry, ColoGeoHash, ColoName, Datetime, DestinationASN, DestinationASNName, DestinationCountry, DestinationGeoHash, DestinationPort, Direction, GREChecksum, GREEtherType, GREHeaderLength, GREKey, GRESequenceNumber, GREVersion, ICMPChecksum, ICMPCode, ICMPType, IPDestinationAddress, IPDestinationSubnet, IPFragmentOffset, IPHeaderLength, IPMoreFragments, IPProtocol, IPProtocolName, IPSourceAddress, IPSourceSubnet, IPTTL, IPTTLBuckets, IPTotalLength, IPTotalLengthBuckets, IPv4Checksum, IPv4DSCP, IPv4DontFragment, IPv4ECN, IPv4Identification, IPv4Options, IPv6DSCP, IPv6ECN, IPv6ExtensionHeaders, IPv6FlowLabel, IPv6Identification, MitigationReason, MitigationScope, MitigationSystem, ProtocolState, RuleID, RuleName, RulesetID, RulesetOverrideID, SampleInterval, SourceASN, SourceASNName, SourceCountry, SourceGeoHash, TCPAcknowledgementNumber, TCPChecksum, TCPDataOffset, TCPFlags, TCPFlagsString, TCPMSS, TCPOptions, TCPSACKBlocks, TCPSACKPermitted, TCPSequenceNumber, TCPTimestampECR, TCPTimestampValue, TCPUrgentPointer, TCPWindowScale, TCPWindowSize, UDPChecksum, UDPPayloadLength, Verdict, Action, DestinationIP, SignatureID, SignatureMessage, SignatureRevision, ApplicationIDs, ApplicationNames, CategoryIDs, CategoryNames, DestinationIPContinentCode, DestinationIPCountryCode, OverrideIP, OverridePort, PolicyID, PolicyName, ProxyEndpoint, SNI, SourceIPContinentCode, SourceIPCountryCode, TransportProtocol, VirtualNetworkID, VirtualNetworkName, BlockedFileHash, BlockedFileName, BlockedFileReason, BlockedFileSize, BlockedFileType, DownloadMatchedDlpProfileEntries, DownloadMatchedDlpProfiles, DownloadedFileNames, FileInfo, ForensicCopyStatus, HTTPHost, HTTPMethod, HTTPStatusCode, HTTPVersion, IsIsolated, PrivateAppAUD, Quarantined, RedirectTargetURI, Referer, RequestID, UntrustedCertificateAction, UploadMatchedDlpProfileEntries, UploadMatchedDlpProfiles, UploadedFileNames, AuthoritativeNameServerIPs, CNAMECategoryIDs, CNAMECategoryNames, CNAMEs, CNAMEsReversed, ColoID, CustomResolveDurationMs, CustomResolverAddress, CustomResolverPolicyID, CustomResolverPolicyName, CustomResolverResponse, DoHSubdomain, DoTSubdomain, DstIP, DstPort, EDEErrors, InitialCategoryIDs, InitialCategoryNames, InitialResolvedIPs, InternalDNSFallbackStrategy, InternalDNSRCode, InternalDNSViewID, InternalDNSZoneID, IsResponseCached, Location, LocationID, MatchedCategoryIDs, MatchedCategoryNames, MatchedIndicatorFeedIDs, MatchedIndicatorFeedNames, QueryCategoryIDs, QueryCategoryNames, QueryID, QueryIndicatorFeedIDs, QueryIndicatorFeedNames, QueryName, QueryNameReversed, QuerySize, QueryType, QueryTypeName, RCode, RData, RequestContextCategoryIDs, RequestContextCategoryNames, ResolvedIPCategoryIDs, ResolvedIPCategoryNames, ResolvedIPContinentCodes, ResolvedIPCountryCodes, ResolverDecision, ResourceRecords, ResourceRecordsJSON, SrcIP, SrcIPContinentCode, SrcIPCountryCode, SrcPort, TimeZone, TimeZoneInferredMethod, AlertID, AlertReasons, Attachments, CC, CCName, FinalDisposition, From, FromName, Links, MessageDeliveryMode, MessageID, Origin, OriginalSender, ReplyTo, ReplyToName, SMTPEnvelopeFrom, SMTPEnvelopeTo, SMTPHeloServerIP, SMTPHeloServerIPAsName, SMTPHeloServerIPAsNumber, SMTPHeloServerIPGeo, SMTPHeloServerName, Subject, ThreatCategories, To, ToName, ClientResponseCode, ClusterID, EDNSSubnet, EDNSSubnetLength, QueryDO, QueryRD, QueryTCP, ResponseCached, ResponseCachedStale, ResponseReason, UpstreamIP, UpstreamResponseCode, UpstreamResponseTimeMs, ForensicCopyID, GatewayRequestID, Phase, TriggeredRuleID, ClientVersion, DeviceManufacturer, DeviceModel, DeviceSerialNumber, DeviceType, OSVersion, PostureCheckName, PostureCheckType, PostureEvaluatedResult, PostureExpectedJSON, PostureReceivedJSON, UserUID, AssetDisplayName, AssetExternalID, AssetLink, AssetMetadata, DetectedTimestamp, FindingTypeDisplayName, FindingTypeID, FindingTypeSeverity, InstanceID, IntegrationDisplayName, IntegrationID, IntegrationPolicyVendor, Decision, DomainName, ActionResult, ActionType, ActorEmail, ActorID, ActorIP, ActorType, ID, Interface, Metadata, NewValue, OldValue, OwnerID, ResourceID, ResourceType, When, Allowed, AppDomain, AppUUID, Connection, Country, CreatedAt, IPAddress, PurposeJustificationPrompt, PurposeJustificationResponse, RayID, TemporaryAccessApprovers, TemporaryAccessDuration, ClientASN, ClientASNDescription, ClientCountry, ClientIP, ClientIPClass, ClientRefererHost, ClientRefererPath, ClientRefererQuery, ClientRefererScheme, ClientRequestHost, ClientRequestMethod, ClientRequestPath, ClientRequestProtocol, ClientRequestQuery, ClientRequestScheme, ClientRequestUserAgent, ContentScanObjResults, ContentScanObjSizes, ContentScanObjTypes, Description, EdgeColoCode, EdgeResponseStatus, Kind, LeakedCredentialCheckResult, MatchIndex, OriginResponseStatus, OriginatorRayID, Ref, BotDetectionIDs, BotDetectionTags, BotScore, BotScoreSrc, BotTags, CacheCacheStatus, CacheReserveUsed, CacheResponseBytes, CacheResponseStatus, CacheTieredFill, ClientCity, ClientDeviceType, ClientLatitude, ClientLongitude, ClientMTLSAuthCertFingerprint, ClientMTLSAuthStatus, ClientRegionCode, ClientRequestBytes, ClientRequestReferer, ClientRequestSource, ClientRequestURI, ClientSSLCipher, ClientSSLProtocol, ClientSrcPort, ClientTCPRTTMs, ClientXRequestedWith, Cookies, EdgeCFConnectingO2O, EdgeColoID, EdgeEndTimestamp, EdgePathingOp, EdgePathingSrc, EdgePathingStatus, EdgeRequestHost, EdgeResponseBodyBytes, EdgeResponseBytes, EdgeResponseCompressionRatio, EdgeResponseContentType, EdgeServerIP, EdgeStartTimestamp, EdgeTimeToFirstByteMs, JA3Hash, JA4, JA4Signals, OriginDNSResponseTimeMs, OriginRequestHeaderSendDurationMs, OriginResponseBytes, OriginResponseDurationMs, OriginResponseHTTPExpires, OriginResponseHTTPLastModified, OriginResponseHeaderReceiveDurationMs, OriginSSLProtocol, OriginTCPHandshakeDurationMs, OriginTLSHandshakeDurationMs, ParentRayID, RequestHeaders, ResponseHeaders, SecurityAction, SecurityRuleDescription, SecurityRuleID, SecuritySources, SmartRouteColoID, UpperTierColoID, WAFAttackScore, WAFRCEAttackScore, WAFSQLiAttackScore, WAFXSSAttackScore, WorkerCPUTime, WorkerScriptName, WorkerStatus, WorkerSubrequest, WorkerSubrequestCount, WorkerWallTimeUs, ZoneName, ClientIPASN, ClientIPASNDescription, ClientIPCountry, LastKnownGoodColoCode, CSPDirective, PageURL, URLContainsCDNCGIPath, URLHost, Application, ClientBytes, ClientMatchedIpFirewall, ClientPort, ClientProto, ClientTcpRtt, ClientTlsClientHelloServerName, ClientTlsProtocol, ClientTlsStatus, ConnectTimestamp, DisconnectTimestamp, IpFirewall, OriginBytes, OriginProto, OriginTcpRtt, OriginTlsFingerprint, OriginTlsMode, OriginTlsProtocol, OriginTlsStatus, ProxyProtocol, Status, EventDetails, IP, LogType, Source, SecurityActions, SecurityRuleIDs",
                    "outputStream": "Custom-CloudflareV2_CL"
                  }
                ]
              }
            },
            {
              "name": "CloudflareV2_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "CloudflareV2_CL",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "AccountID",
                      "type": "string"
                    },
                    {
                      "name": "BytesReceived",
                      "type": "int"
                    },
                    {
                      "name": "BytesSent",
                      "type": "int"
                    },
                    {
                      "name": "ClientTCPHandshakeDurationMs",
                      "type": "int"
                    },
                    {
                      "name": "ClientTLSCipher",
                      "type": "string"
                    },
                    {
                      "name": "ClientTLSHandshakeDurationMs",
                      "type": "int"
                    },
                    {
                      "name": "ClientTLSVersion",
                      "type": "string"
                    },
                    {
                      "name": "ConnectionCloseReason",
                      "type": "string"
                    },
                    {
                      "name": "ConnectionReuse",
                      "type": "boolean"
                    },
                    {
                      "name": "DestinationTunnelID",
                      "type": "string"
                    },
                    {
                      "name": "DetectedProtocol",
                      "type": "string"
                    },
                    {
                      "name": "DeviceID",
                      "type": "string"
                    },
                    {
                      "name": "DeviceName",
                      "type": "string"
                    },
                    {
                      "name": "EgressColoName",
                      "type": "string"
                    },
                    {
                      "name": "EgressIP",
                      "type": "string"
                    },
                    {
                      "name": "EgressPort",
                      "type": "int"
                    },
                    {
                      "name": "EgressRuleID",
                      "type": "string"
                    },
                    {
                      "name": "EgressRuleName",
                      "type": "string"
                    },
                    {
                      "name": "Email",
                      "type": "string"
                    },
                    {
                      "name": "IngressColoName",
                      "type": "string"
                    },
                    {
                      "name": "Offramp",
                      "type": "string"
                    },
                    {
                      "name": "OriginIP",
                      "type": "string"
                    },
                    {
                      "name": "OriginPort",
                      "type": "int"
                    },
                    {
                      "name": "OriginTLSCertificateIssuer",
                      "type": "string"
                    },
                    {
                      "name": "OriginTLSCertificateValidationResult",
                      "type": "string"
                    },
                    {
                      "name": "OriginTLSCipher",
                      "type": "string"
                    },
                    {
                      "name": "OriginTLSHandshakeDurationMs",
                      "type": "int"
                    },
                    {
                      "name": "OriginTLSVersion",
                      "type": "string"
                    },
                    {
                      "name": "Protocol",
                      "type": "string"
                    },
                    {
                      "name": "RegistrationID",
                      "type": "string"
                    },
                    {
                      "name": "RuleEvaluationDurationMs",
                      "type": "int"
                    },
                    {
                      "name": "SessionEndTime",
                      "type": "datetime"
                    },
                    {
                      "name": "SessionID",
                      "type": "string"
                    },
                    {
                      "name": "SessionStartTime",
                      "type": "datetime"
                    },
                    {
                      "name": "SourceIP",
                      "type": "string"
                    },
                    {
                      "name": "SourceInternalIP",
                      "type": "string"
                    },
                    {
                      "name": "SourcePort",
                      "type": "int"
                    },
                    {
                      "name": "UserID",
                      "type": "string"
                    },
                    {
                      "name": "CPUTimeMs",
                      "type": "int"
                    },
                    {
                      "name": "DispatchNamespace",
                      "type": "string"
                    },
                    {
                      "name": "Entrypoint",
                      "type": "string"
                    },
                    {
                      "name": "Event",
                      "type": "string"
                    },
                    {
                      "name": "EventTimestampMs",
                      "type": "int"
                    },
                    {
                      "name": "EventType",
                      "type": "string"
                    },
                    {
                      "name": "Exceptions",
                      "type": "string"
                    },
                    {
                      "name": "Logs",
                      "type": "string"
                    },
                    {
                      "name": "Outcome",
                      "type": "string"
                    },
                    {
                      "name": "ScriptName",
                      "type": "string"
                    },
                    {
                      "name": "ScriptTags",
                      "type": "string"
                    },
                    {
                      "name": "ScriptVersion",
                      "type": "string"
                    },
                    {
                      "name": "WallTimeMs",
                      "type": "int"
                    },
                    {
                      "name": "ClientAddress",
                      "type": "string"
                    },
                    {
                      "name": "Error",
                      "type": "string"
                    },
                    {
                      "name": "PTY",
                      "type": "string"
                    },
                    {
                      "name": "Payload",
                      "type": "string"
                    },
                    {
                      "name": "ProgramFinishDatetime",
                      "type": "string"
                    },
                    {
                      "name": "ProgramID",
                      "type": "string"
                    },
                    {
                      "name": "ProgramStartDatetime",
                      "type": "string"
                    },
                    {
                      "name": "ProgramType",
                      "type": "string"
                    },
                    {
                      "name": "ServerAddress",
                      "type": "string"
                    },
                    {
                      "name": "SessionFinishDatetime",
                      "type": "string"
                    },
                    {
                      "name": "SessionStartDatetime",
                      "type": "string"
                    },
                    {
                      "name": "TargetID",
                      "type": "string"
                    },
                    {
                      "name": "UserEmail",
                      "type": "string"
                    },
                    {
                      "name": "Username",
                      "type": "string"
                    },
                    {
                      "name": "Body",
                      "type": "string"
                    },
                    {
                      "name": "BodyLength",
                      "type": "int"
                    },
                    {
                      "name": "DestAddr",
                      "type": "string"
                    },
                    {
                      "name": "Headers",
                      "type": "string"
                    },
                    {
                      "name": "Host",
                      "type": "string"
                    },
                    {
                      "name": "Method",
                      "type": "string"
                    },
                    {
                      "name": "Password",
                      "type": "string"
                    },
                    {
                      "name": "R2Path",
                      "type": "string"
                    },
                    {
                      "name": "Referrer",
                      "type": "string"
                    },
                    {
                      "name": "SinkholeID",
                      "type": "string"
                    },
                    {
                      "name": "SrcAddr",
                      "type": "string"
                    },
                    {
                      "name": "Timestamp",
                      "type": "string"
                    },
                    {
                      "name": "URI",
                      "type": "string"
                    },
                    {
                      "name": "URL",
                      "type": "string"
                    },
                    {
                      "name": "UserAgent",
                      "type": "string"
                    },
                    {
                      "name": "AttackCampaignID",
                      "type": "string"
                    },
                    {
                      "name": "AttackID",
                      "type": "string"
                    },
                    {
                      "name": "AttackVector",
                      "type": "string"
                    },
                    {
                      "name": "ColoCity",
                      "type": "string"
                    },
                    {
                      "name": "ColoCode",
                      "type": "string"
                    },
                    {
                      "name": "ColoCountry",
                      "type": "string"
                    },
                    {
                      "name": "ColoGeoHash",
                      "type": "string"
                    },
                    {
                      "name": "ColoName",
                      "type": "string"
                    },
                    {
                      "name": "Datetime",
                      "type": "string"
                    },
                    {
                      "name": "DestinationASN",
                      "type": "int"
                    },
                    {
                      "name": "DestinationASNName",
                      "type": "string"
                    },
                    {
                      "name": "DestinationCountry",
                      "type": "string"
                    },
                    {
                      "name": "DestinationGeoHash",
                      "type": "string"
                    },
                    {
                      "name": "DestinationPort",
                      "type": "int"
                    },
                    {
                      "name": "Direction",
                      "type": "string"
                    },
                    {
                      "name": "GREChecksum",
                      "type": "int"
                    },
                    {
                      "name": "GREEtherType",
                      "type": "int"
                    },
                    {
                      "name": "GREHeaderLength",
                      "type": "int"
                    },
                    {
                      "name": "GREKey",
                      "type": "int"
                    },
                    {
                      "name": "GRESequenceNumber",
                      "type": "int"
                    },
                    {
                      "name": "GREVersion",
                      "type": "int"
                    },
                    {
                      "name": "ICMPChecksum",
                      "type": "int"
                    },
                    {
                      "name": "ICMPCode",
                      "type": "int"
                    },
                    {
                      "name": "ICMPType",
                      "type": "int"
                    },
                    {
                      "name": "IPDestinationAddress",
                      "type": "string"
                    },
                    {
                      "name": "IPDestinationSubnet",
                      "type": "string"
                    },
                    {
                      "name": "IPFragmentOffset",
                      "type": "int"
                    },
                    {
                      "name": "IPHeaderLength",
                      "type": "int"
                    },
                    {
                      "name": "IPMoreFragments",
                      "type": "int"
                    },
                    {
                      "name": "IPProtocol",
                      "type": "int"
                    },
                    {
                      "name": "IPProtocolName",
                      "type": "string"
                    },
                    {
                      "name": "IPSourceAddress",
                      "type": "string"
                    },
                    {
                      "name": "IPSourceSubnet",
                      "type": "string"
                    },
                    {
                      "name": "IPTTL",
                      "type": "int"
                    },
                    {
                      "name": "IPTTLBuckets",
                      "type": "int"
                    },
                    {
                      "name": "IPTotalLength",
                      "type": "int"
                    },
                    {
                      "name": "IPTotalLengthBuckets",
                      "type": "int"
                    },
                    {
                      "name": "IPv4Checksum",
                      "type": "int"
                    },
                    {
                      "name": "IPv4DSCP",
                      "type": "int"
                    },
                    {
                      "name": "IPv4DontFragment",
                      "type": "int"
                    },
                    {
                      "name": "IPv4ECN",
                      "type": "int"
                    },
                    {
                      "name": "IPv4Identification",
                      "type": "int"
                    },
                    {
                      "name": "IPv4Options",
                      "type": "string"
                    },
                    {
                      "name": "IPv6DSCP",
                      "type": "int"
                    },
                    {
                      "name": "IPv6ECN",
                      "type": "int"
                    },
                    {
                      "name": "IPv6ExtensionHeaders",
                      "type": "string"
                    },
                    {
                      "name": "IPv6FlowLabel",
                      "type": "int"
                    },
                    {
                      "name": "IPv6Identification",
                      "type": "int"
                    },
                    {
                      "name": "MitigationReason",
                      "type": "string"
                    },
                    {
                      "name": "MitigationScope",
                      "type": "string"
                    },
                    {
                      "name": "MitigationSystem",
                      "type": "string"
                    },
                    {
                      "name": "ProtocolState",
                      "type": "string"
                    },
                    {
                      "name": "RuleID",
                      "type": "string"
                    },
                    {
                      "name": "RuleName",
                      "type": "string"
                    },
                    {
                      "name": "RulesetID",
                      "type": "string"
                    },
                    {
                      "name": "RulesetOverrideID",
                      "type": "string"
                    },
                    {
                      "name": "SampleInterval",
                      "type": "int"
                    },
                    {
                      "name": "SourceASN",
                      "type": "int"
                    },
                    {
                      "name": "SourceASNName",
                      "type": "string"
                    },
                    {
                      "name": "SourceCountry",
                      "type": "string"
                    },
                    {
                      "name": "SourceGeoHash",
                      "type": "string"
                    },
                    {
                      "name": "TCPAcknowledgementNumber",
                      "type": "int"
                    },
                    {
                      "name": "TCPChecksum",
                      "type": "int"
                    },
                    {
                      "name": "TCPDataOffset",
                      "type": "int"
                    },
                    {
                      "name": "TCPFlags",
                      "type": "int"
                    },
                    {
                      "name": "TCPFlagsString",
                      "type": "string"
                    },
                    {
                      "name": "TCPMSS",
                      "type": "int"
                    },
                    {
                      "name": "TCPOptions",
                      "type": "string"
                    },
                    {
                      "name": "TCPSACKBlocks",
                      "type": "string"
                    },
                    {
                      "name": "TCPSACKPermitted",
                      "type": "int"
                    },
                    {
                      "name": "TCPSequenceNumber",
                      "type": "int"
                    },
                    {
                      "name": "TCPTimestampECR",
                      "type": "int"
                    },
                    {
                      "name": "TCPTimestampValue",
                      "type": "int"
                    },
                    {
                      "name": "TCPUrgentPointer",
                      "type": "int"
                    },
                    {
                      "name": "TCPWindowScale",
                      "type": "int"
                    },
                    {
                      "name": "TCPWindowSize",
                      "type": "int"
                    },
                    {
                      "name": "UDPChecksum",
                      "type": "int"
                    },
                    {
                      "name": "UDPPayloadLength",
                      "type": "int"
                    },
                    {
                      "name": "Verdict",
                      "type": "string"
                    },
                    {
                      "name": "Action",
                      "type": "string"
                    },
                    {
                      "name": "DestinationIP",
                      "type": "string"
                    },
                    {
                      "name": "SignatureID",
                      "type": "int"
                    },
                    {
                      "name": "SignatureMessage",
                      "type": "string"
                    },
                    {
                      "name": "SignatureRevision",
                      "type": "int"
                    },
                    {
                      "name": "ApplicationIDs",
                      "type": "int"
                    },
                    {
                      "name": "ApplicationNames",
                      "type": "string"
                    },
                    {
                      "name": "CategoryIDs",
                      "type": "int"
                    },
                    {
                      "name": "CategoryNames",
                      "type": "string"
                    },
                    {
                      "name": "DestinationIPContinentCode",
                      "type": "string"
                    },
                    {
                      "name": "DestinationIPCountryCode",
                      "type": "string"
                    },
                    {
                      "name": "OverrideIP",
                      "type": "string"
                    },
                    {
                      "name": "OverridePort",
                      "type": "int"
                    },
                    {
                      "name": "PolicyID",
                      "type": "string"
                    },
                    {
                      "name": "PolicyName",
                      "type": "string"
                    },
                    {
                      "name": "ProxyEndpoint",
                      "type": "string"
                    },
                    {
                      "name": "SNI",
                      "type": "string"
                    },
                    {
                      "name": "SourceIPContinentCode",
                      "type": "string"
                    },
                    {
                      "name": "SourceIPCountryCode",
                      "type": "string"
                    },
                    {
                      "name": "TransportProtocol",
                      "type": "string"
                    },
                    {
                      "name": "VirtualNetworkID",
                      "type": "string"
                    },
                    {
                      "name": "VirtualNetworkName",
                      "type": "string"
                    },
                    {
                      "name": "BlockedFileHash",
                      "type": "string"
                    },
                    {
                      "name": "BlockedFileName",
                      "type": "string"
                    },
                    {
                      "name": "BlockedFileReason",
                      "type": "string"
                    },
                    {
                      "name": "BlockedFileSize",
                      "type": "int"
                    },
                    {
                      "name": "BlockedFileType",
                      "type": "string"
                    },
                    {
                      "name": "DownloadMatchedDlpProfileEntries",
                      "type": "string"
                    },
                    {
                      "name": "DownloadMatchedDlpProfiles",
                      "type": "string"
                    },
                    {
                      "name": "DownloadedFileNames",
                      "type": "string"
                    },
                    {
                      "name": "FileInfo",
                      "type": "string"
                    },
                    {
                      "name": "ForensicCopyStatus",
                      "type": "string"
                    },
                    {
                      "name": "HTTPHost",
                      "type": "string"
                    },
                    {
                      "name": "HTTPMethod",
                      "type": "string"
                    },
                    {
                      "name": "HTTPStatusCode",
                      "type": "int"
                    },
                    {
                      "name": "HTTPVersion",
                      "type": "string"
                    },
                    {
                      "name": "IsIsolated",
                      "type": "boolean"
                    },
                    {
                      "name": "PrivateAppAUD",
                      "type": "string"
                    },
                    {
                      "name": "Quarantined",
                      "type": "boolean"
                    },
                    {
                      "name": "RedirectTargetURI",
                      "type": "string"
                    },
                    {
                      "name": "Referer",
                      "type": "string"
                    },
                    {
                      "name": "RequestID",
                      "type": "string"
                    },
                    {
                      "name": "UntrustedCertificateAction",
                      "type": "string"
                    },
                    {
                      "name": "UploadMatchedDlpProfileEntries",
                      "type": "string"
                    },
                    {
                      "name": "UploadMatchedDlpProfiles",
                      "type": "string"
                    },
                    {
                      "name": "UploadedFileNames",
                      "type": "string"
                    },
                    {
                      "name": "AuthoritativeNameServerIPs",
                      "type": "string"
                    },
                    {
                      "name": "CNAMECategoryIDs",
                      "type": "int"
                    },
                    {
                      "name": "CNAMECategoryNames",
                      "type": "string"
                    },
                    {
                      "name": "CNAMEs",
                      "type": "string"
                    },
                    {
                      "name": "CNAMEsReversed",
                      "type": "string"
                    },
                    {
                      "name": "ColoID",
                      "type": "int"
                    },
                    {
                      "name": "CustomResolveDurationMs",
                      "type": "int"
                    },
                    {
                      "name": "CustomResolverAddress",
                      "type": "string"
                    },
                    {
                      "name": "CustomResolverPolicyID",
                      "type": "string"
                    },
                    {
                      "name": "CustomResolverPolicyName",
                      "type": "string"
                    },
                    {
                      "name": "CustomResolverResponse",
                      "type": "string"
                    },
                    {
                      "name": "DoHSubdomain",
                      "type": "string"
                    },
                    {
                      "name": "DoTSubdomain",
                      "type": "string"
                    },
                    {
                      "name": "DstIP",
                      "type": "string"
                    },
                    {
                      "name": "DstPort",
                      "type": "int"
                    },
                    {
                      "name": "EDEErrors",
                      "type": "int"
                    },
                    {
                      "name": "InitialCategoryIDs",
                      "type": "int"
                    },
                    {
                      "name": "InitialCategoryNames",
                      "type": "string"
                    },
                    {
                      "name": "InitialResolvedIPs",
                      "type": "string"
                    },
                    {
                      "name": "InternalDNSFallbackStrategy",
                      "type": "string"
                    },
                    {
                      "name": "InternalDNSRCode",
                      "type": "int"
                    },
                    {
                      "name": "InternalDNSViewID",
                      "type": "string"
                    },
                    {
                      "name": "InternalDNSZoneID",
                      "type": "string"
                    },
                    {
                      "name": "IsResponseCached",
                      "type": "boolean"
                    },
                    {
                      "name": "Location",
                      "type": "string"
                    },
                    {
                      "name": "LocationID",
                      "type": "string"
                    },
                    {
                      "name": "MatchedCategoryIDs",
                      "type": "int"
                    },
                    {
                      "name": "MatchedCategoryNames",
                      "type": "string"
                    },
                    {
                      "name": "MatchedIndicatorFeedIDs",
                      "type": "int"
                    },
                    {
                      "name": "MatchedIndicatorFeedNames",
                      "type": "string"
                    },
                    {
                      "name": "QueryCategoryIDs",
                      "type": "int"
                    },
                    {
                      "name": "QueryCategoryNames",
                      "type": "string"
                    },
                    {
                      "name": "QueryID",
                      "type": "string"
                    },
                    {
                      "name": "QueryIndicatorFeedIDs",
                      "type": "int"
                    },
                    {
                      "name": "QueryIndicatorFeedNames",
                      "type": "string"
                    },
                    {
                      "name": "QueryName",
                      "type": "string"
                    },
                    {
                      "name": "QueryNameReversed",
                      "type": "string"
                    },
                    {
                      "name": "QuerySize",
                      "type": "int"
                    },
                    {
                      "name": "QueryType",
                      "type": "int"
                    },
                    {
                      "name": "QueryTypeName",
                      "type": "string"
                    },
                    {
                      "name": "RCode",
                      "type": "int"
                    },
                    {
                      "name": "RData",
                      "type": "string"
                    },
                    {
                      "name": "RequestContextCategoryIDs",
                      "type": "int"
                    },
                    {
                      "name": "RequestContextCategoryNames",
                      "type": "string"
                    },
                    {
                      "name": "ResolvedIPCategoryIDs",
                      "type": "int"
                    },
                    {
                      "name": "ResolvedIPCategoryNames",
                      "type": "string"
                    },
                    {
                      "name": "ResolvedIPContinentCodes",
                      "type": "string"
                    },
                    {
                      "name": "ResolvedIPCountryCodes",
                      "type": "string"
                    },
                    {
                      "name": "ResolverDecision",
                      "type": "string"
                    },
                    {
                      "name": "ResourceRecords",
                      "type": "string"
                    },
                    {
                      "name": "ResourceRecordsJSON",
                      "type": "string"
                    },
                    {
                      "name": "SrcIP",
                      "type": "string"
                    },
                    {
                      "name": "SrcIPContinentCode",
                      "type": "string"
                    },
                    {
                      "name": "SrcIPCountryCode",
                      "type": "string"
                    },
                    {
                      "name": "SrcPort",
                      "type": "int"
                    },
                    {
                      "name": "TimeZone",
                      "type": "string"
                    },
                    {
                      "name": "TimeZoneInferredMethod",
                      "type": "string"
                    },
                    {
                      "name": "AlertID",
                      "type": "string"
                    },
                    {
                      "name": "AlertReasons",
                      "type": "string"
                    },
                    {
                      "name": "Attachments",
                      "type": "string"
                    },
                    {
                      "name": "CC",
                      "type": "string"
                    },
                    {
                      "name": "CCName",
                      "type": "string"
                    },
                    {
                      "name": "FinalDisposition",
                      "type": "string"
                    },
                    {
                      "name": "From",
                      "type": "string"
                    },
                    {
                      "name": "FromName",
                      "type": "string"
                    },
                    {
                      "name": "Links",
                      "type": "string"
                    },
                    {
                      "name": "MessageDeliveryMode",
                      "type": "string"
                    },
                    {
                      "name": "MessageID",
                      "type": "string"
                    },
                    {
                      "name": "Origin",
                      "type": "string"
                    },
                    {
                      "name": "OriginalSender",
                      "type": "string"
                    },
                    {
                      "name": "ReplyTo",
                      "type": "string"
                    },
                    {
                      "name": "ReplyToName",
                      "type": "string"
                    },
                    {
                      "name": "SMTPEnvelopeFrom",
                      "type": "string"
                    },
                    {
                      "name": "SMTPEnvelopeTo",
                      "type": "string"
                    },
                    {
                      "name": "SMTPHeloServerIP",
                      "type": "string"
                    },
                    {
                      "name": "SMTPHeloServerIPAsName",
                      "type": "string"
                    },
                    {
                      "name": "SMTPHeloServerIPAsNumber",
                      "type": "string"
                    },
                    {
                      "name": "SMTPHeloServerIPGeo",
                      "type": "string"
                    },
                    {
                      "name": "SMTPHeloServerName",
                      "type": "string"
                    },
                    {
                      "name": "Subject",
                      "type": "string"
                    },
                    {
                      "name": "ThreatCategories",
                      "type": "string"
                    },
                    {
                      "name": "To",
                      "type": "string"
                    },
                    {
                      "name": "ToName",
                      "type": "string"
                    },
                    {
                      "name": "ClientResponseCode",
                      "type": "int"
                    },
                    {
                      "name": "ClusterID",
                      "type": "string"
                    },
                    {
                      "name": "EDNSSubnet",
                      "type": "string"
                    },
                    {
                      "name": "EDNSSubnetLength",
                      "type": "int"
                    },
                    {
                      "name": "QueryDO",
                      "type": "boolean"
                    },
                    {
                      "name": "QueryRD",
                      "type": "boolean"
                    },
                    {
                      "name": "QueryTCP",
                      "type": "boolean"
                    },
                    {
                      "name": "ResponseCached",
                      "type": "boolean"
                    },
                    {
                      "name": "ResponseCachedStale",
                      "type": "boolean"
                    },
                    {
                      "name": "ResponseReason",
                      "type": "string"
                    },
                    {
                      "name": "UpstreamIP",
                      "type": "string"
                    },
                    {
                      "name": "UpstreamResponseCode",
                      "type": "int"
                    },
                    {
                      "name": "UpstreamResponseTimeMs",
                      "type": "int"
                    },
                    {
                      "name": "ForensicCopyID",
                      "type": "string"
                    },
                    {
                      "name": "GatewayRequestID",
                      "type": "string"
                    },
                    {
                      "name": "Phase",
                      "type": "string"
                    },
                    {
                      "name": "TriggeredRuleID",
                      "type": "string"
                    },
                    {
                      "name": "ClientVersion",
                      "type": "string"
                    },
                    {
                      "name": "DeviceManufacturer",
                      "type": "string"
                    },
                    {
                      "name": "DeviceModel",
                      "type": "string"
                    },
                    {
                      "name": "DeviceSerialNumber",
                      "type": "string"
                    },
                    {
                      "name": "DeviceType",
                      "type": "string"
                    },
                    {
                      "name": "OSVersion",
                      "type": "string"
                    },
                    {
                      "name": "PostureCheckName",
                      "type": "string"
                    },
                    {
                      "name": "PostureCheckType",
                      "type": "string"
                    },
                    {
                      "name": "PostureEvaluatedResult",
                      "type": "boolean"
                    },
                    {
                      "name": "PostureExpectedJSON",
                      "type": "string"
                    },
                    {
                      "name": "PostureReceivedJSON",
                      "type": "string"
                    },
                    {
                      "name": "UserUID",
                      "type": "string"
                    },
                    {
                      "name": "AssetDisplayName",
                      "type": "string"
                    },
                    {
                      "name": "AssetExternalID",
                      "type": "string"
                    },
                    {
                      "name": "AssetLink",
                      "type": "string"
                    },
                    {
                      "name": "AssetMetadata",
                      "type": "string"
                    },
                    {
                      "name": "DetectedTimestamp",
                      "type": "string"
                    },
                    {
                      "name": "FindingTypeDisplayName",
                      "type": "string"
                    },
                    {
                      "name": "FindingTypeID",
                      "type": "string"
                    },
                    {
                      "name": "FindingTypeSeverity",
                      "type": "string"
                    },
                    {
                      "name": "InstanceID",
                      "type": "string"
                    },
                    {
                      "name": "IntegrationDisplayName",
                      "type": "string"
                    },
                    {
                      "name": "IntegrationID",
                      "type": "string"
                    },
                    {
                      "name": "IntegrationPolicyVendor",
                      "type": "string"
                    },
                    {
                      "name": "Decision",
                      "type": "string"
                    },
                    {
                      "name": "DomainName",
                      "type": "string"
                    },
                    {
                      "name": "LogType",
                      "type": "string"
                    },
                    {
                      "name": "ActionResult",
                      "type": "boolean"
                    },
                    {
                      "name": "ActionType",
                      "type": "string"
                    },
                    {
                      "name": "ActorEmail",
                      "type": "string"
                    },
                    {
                      "name": "ActorID",
                      "type": "string"
                    },
                    {
                      "name": "ActorIP",
                      "type": "string"
                    },
                    {
                      "name": "ActorType",
                      "type": "string"
                    },
                    {
                      "name": "ID",
                      "type": "string"
                    },
                    {
                      "name": "Interface",
                      "type": "string"
                    },
                    {
                      "name": "Metadata",
                      "type": "string"
                    },
                    {
                      "name": "NewValue",
                      "type": "string"
                    },
                    {
                      "name": "OldValue",
                      "type": "string"
                    },
                    {
                      "name": "OwnerID",
                      "type": "string"
                    },
                    {
                      "name": "ResourceID",
                      "type": "string"
                    },
                    {
                      "name": "ResourceType",
                      "type": "string"
                    },
                    {
                      "name": "When",
                      "type": "string"
                    },
                    {
                      "name": "Allowed",
                      "type": "boolean"
                    },
                    {
                      "name": "AppDomain",
                      "type": "string"
                    },
                    {
                      "name": "AppUUID",
                      "type": "string"
                    },
                    {
                      "name": "Connection",
                      "type": "string"
                    },
                    {
                      "name": "Country",
                      "type": "string"
                    },
                    {
                      "name": "CreatedAt",
                      "type": "string"
                    },
                    {
                      "name": "IPAddress",
                      "type": "string"
                    },
                    {
                      "name": "PurposeJustificationPrompt",
                      "type": "string"
                    },
                    {
                      "name": "PurposeJustificationResponse",
                      "type": "string"
                    },
                    {
                      "name": "RayID",
                      "type": "string"
                    },
                    {
                      "name": "TemporaryAccessApprovers",
                      "type": "string"
                    },
                    {
                      "name": "TemporaryAccessDuration",
                      "type": "int"
                    },
                    {
                      "name": "ClientASN",
                      "type": "int"
                    },
                    {
                      "name": "ClientASNDescription",
                      "type": "string"
                    },
                    {
                      "name": "ClientCountry",
                      "type": "string"
                    },
                    {
                      "name": "ClientIP",
                      "type": "string"
                    },
                    {
                      "name": "ClientIPClass",
                      "type": "string"
                    },
                    {
                      "name": "ClientRefererHost",
                      "type": "string"
                    },
                    {
                      "name": "ClientRefererPath",
                      "type": "string"
                    },
                    {
                      "name": "ClientRefererQuery",
                      "type": "string"
                    },
                    {
                      "name": "ClientRefererScheme",
                      "type": "string"
                    },
                    {
                      "name": "ClientRequestHost",
                      "type": "string"
                    },
                    {
                      "name": "ClientRequestMethod",
                      "type": "string"
                    },
                    {
                      "name": "ClientRequestPath",
                      "type": "string"
                    },
                    {
                      "name": "ClientRequestProtocol",
                      "type": "string"
                    },
                    {
                      "name": "ClientRequestQuery",
                      "type": "string"
                    },
                    {
                      "name": "ClientRequestScheme",
                      "type": "string"
                    },
                    {
                      "name": "ClientRequestUserAgent",
                      "type": "string"
                    },
                    {
                      "name": "ContentScanObjResults",
                      "type": "string"
                    },
                    {
                      "name": "ContentScanObjSizes",
                      "type": "int"
                    },
                    {
                      "name": "ContentScanObjTypes",
                      "type": "string"
                    },
                    {
                      "name": "Description",
                      "type": "string"
                    },
                    {
                      "name": "EdgeColoCode",
                      "type": "string"
                    },
                    {
                      "name": "EdgeResponseStatus",
                      "type": "int"
                    },
                    {
                      "name": "Kind",
                      "type": "string"
                    },
                    {
                      "name": "LeakedCredentialCheckResult",
                      "type": "string"
                    },
                    {
                      "name": "MatchIndex",
                      "type": "int"
                    },
                    {
                      "name": "OriginResponseStatus",
                      "type": "int"
                    },
                    {
                      "name": "OriginatorRayID",
                      "type": "string"
                    },
                    {
                      "name": "Ref",
                      "type": "string"
                    },
                    {
                      "name": "Source",
                      "type": "string"
                    },
                    {
                      "name": "BotDetectionIDs",
                      "type": "int"
                    },
                    {
                      "name": "BotDetectionTags",
                      "type": "string"
                    },
                    {
                      "name": "BotScore",
                      "type": "int"
                    },
                    {
                      "name": "BotScoreSrc",
                      "type": "string"
                    },
                    {
                      "name": "BotTags",
                      "type": "string"
                    },
                    {
                      "name": "CacheCacheStatus",
                      "type": "string"
                    },
                    {
                      "name": "CacheReserveUsed",
                      "type": "boolean"
                    },
                    {
                      "name": "CacheResponseBytes",
                      "type": "int"
                    },
                    {
                      "name": "CacheResponseStatus",
                      "type": "int"
                    },
                    {
                      "name": "CacheTieredFill",
                      "type": "boolean"
                    },
                    {
                      "name": "ClientCity",
                      "type": "string"
                    },
                    {
                      "name": "ClientDeviceType",
                      "type": "string"
                    },
                    {
                      "name": "ClientLatitude",
                      "type": "string"
                    },
                    {
                      "name": "ClientLongitude",
                      "type": "string"
                    },
                    {
                      "name": "ClientMTLSAuthCertFingerprint",
                      "type": "string"
                    },
                    {
                      "name": "ClientMTLSAuthStatus",
                      "type": "string"
                    },
                    {
                      "name": "ClientRegionCode",
                      "type": "string"
                    },
                    {
                      "name": "ClientRequestBytes",
                      "type": "int"
                    },
                    {
                      "name": "ClientRequestReferer",
                      "type": "string"
                    },
                    {
                      "name": "ClientRequestSource",
                      "type": "string"
                    },
                    {
                      "name": "ClientRequestURI",
                      "type": "string"
                    },
                    {
                      "name": "ClientSSLCipher",
                      "type": "string"
                    },
                    {
                      "name": "ClientSSLProtocol",
                      "type": "string"
                    },
                    {
                      "name": "ClientSrcPort",
                      "type": "int"
                    },
                    {
                      "name": "ClientTCPRTTMs",
                      "type": "int"
                    },
                    {
                      "name": "ClientXRequestedWith",
                      "type": "string"
                    },
                    {
                      "name": "Cookies",
                      "type": "string"
                    },
                    {
                      "name": "EdgeCFConnectingO2O",
                      "type": "boolean"
                    },
                    {
                      "name": "EdgeColoID",
                      "type": "int"
                    },
                    {
                      "name": "EdgeEndTimestamp",
                      "type": "string"
                    },
                    {
                      "name": "EdgePathingOp",
                      "type": "string"
                    },
                    {
                      "name": "EdgePathingSrc",
                      "type": "string"
                    },
                    {
                      "name": "EdgePathingStatus",
                      "type": "string"
                    },
                    {
                      "name": "EdgeRequestHost",
                      "type": "string"
                    },
                    {
                      "name": "EdgeResponseBodyBytes",
                      "type": "int"
                    },
                    {
                      "name": "EdgeResponseBytes",
                      "type": "int"
                    },
                    {
                      "name": "EdgeResponseCompressionRatio",
                      "type": "string"
                    },
                    {
                      "name": "EdgeResponseContentType",
                      "type": "string"
                    },
                    {
                      "name": "EdgeServerIP",
                      "type": "string"
                    },
                    {
                      "name": "EdgeStartTimestamp",
                      "type": "string"
                    },
                    {
                      "name": "EdgeTimeToFirstByteMs",
                      "type": "int"
                    },
                    {
                      "name": "JA3Hash",
                      "type": "string"
                    },
                    {
                      "name": "JA4",
                      "type": "string"
                    },
                    {
                      "name": "JA4Signals",
                      "type": "string"
                    },
                    {
                      "name": "OriginDNSResponseTimeMs",
                      "type": "int"
                    },
                    {
                      "name": "OriginRequestHeaderSendDurationMs",
                      "type": "int"
                    },
                    {
                      "name": "OriginResponseBytes",
                      "type": "int"
                    },
                    {
                      "name": "OriginResponseDurationMs",
                      "type": "int"
                    },
                    {
                      "name": "OriginResponseHTTPExpires",
                      "type": "string"
                    },
                    {
                      "name": "OriginResponseHTTPLastModified",
                      "type": "string"
                    },
                    {
                      "name": "OriginResponseHeaderReceiveDurationMs",
                      "type": "int"
                    },
                    {
                      "name": "OriginSSLProtocol",
                      "type": "string"
                    },
                    {
                      "name": "OriginTCPHandshakeDurationMs",
                      "type": "int"
                    },
                    {
                      "name": "ParentRayID",
                      "type": "string"
                    },
                    {
                      "name": "RequestHeaders",
                      "type": "string"
                    },
                    {
                      "name": "ResponseHeaders",
                      "type": "string"
                    },
                    {
                      "name": "SecurityAction",
                      "type": "string"
                    },
                    {
                      "name": "SecurityActions",
                      "type": "string"
                    },
                    {
                      "name": "SecurityRuleDescription",
                      "type": "string"
                    },
                    {
                      "name": "SecurityRuleID",
                      "type": "string"
                    },
                    {
                      "name": "SecurityRuleIDs",
                      "type": "string"
                    },
                    {
                      "name": "SecuritySources",
                      "type": "string"
                    },
                    {
                      "name": "SmartRouteColoID",
                      "type": "int"
                    },
                    {
                      "name": "UpperTierColoID",
                      "type": "int"
                    },
                    {
                      "name": "WAFAttackScore",
                      "type": "int"
                    },
                    {
                      "name": "WAFRCEAttackScore",
                      "type": "int"
                    },
                    {
                      "name": "WAFSQLiAttackScore",
                      "type": "int"
                    },
                    {
                      "name": "WAFXSSAttackScore",
                      "type": "int"
                    },
                    {
                      "name": "WorkerCPUTime",
                      "type": "int"
                    },
                    {
                      "name": "WorkerScriptName",
                      "type": "string"
                    },
                    {
                      "name": "WorkerStatus",
                      "type": "string"
                    },
                    {
                      "name": "WorkerSubrequest",
                      "type": "boolean"
                    },
                    {
                      "name": "WorkerSubrequestCount",
                      "type": "int"
                    },
                    {
                      "name": "WorkerWallTimeUs",
                      "type": "int"
                    },
                    {
                      "name": "ZoneName",
                      "type": "string"
                    },
                    {
                      "name": "ClientIPASN",
                      "type": "int"
                    },
                    {
                      "name": "ClientIPASNDescription",
                      "type": "string"
                    },
                    {
                      "name": "ClientIPCountry",
                      "type": "string"
                    },
                    {
                      "name": "LastKnownGoodColoCode",
                      "type": "string"
                    },
                    {
                      "name": "CSPDirective",
                      "type": "string"
                    },
                    {
                      "name": "PageURL",
                      "type": "string"
                    },
                    {
                      "name": "URLContainsCDNCGIPath",
                      "type": "boolean"
                    },
                    {
                      "name": "URLHost",
                      "type": "string"
                    },
                    {
                      "name": "Application",
                      "type": "string"
                    },
                    {
                      "name": "ClientBytes",
                      "type": "int"
                    },
                    {
                      "name": "ClientMatchedIpFirewall",
                      "type": "string"
                    },
                    {
                      "name": "ClientPort",
                      "type": "int"
                    },
                    {
                      "name": "ClientProto",
                      "type": "string"
                    },
                    {
                      "name": "ClientTcpRtt",
                      "type": "int"
                    },
                    {
                      "name": "ClientTlsClientHelloServerName",
                      "type": "string"
                    },
                    {
                      "name": "ClientTlsProtocol",
                      "type": "string"
                    },
                    {
                      "name": "ClientTlsStatus",
                      "type": "string"
                    },
                    {
                      "name": "ConnectTimestamp",
                      "type": "string"
                    },
                    {
                      "name": "DisconnectTimestamp",
                      "type": "string"
                    },
                    {
                      "name": "IpFirewall",
                      "type": "boolean"
                    },
                    {
                      "name": "OriginBytes",
                      "type": "int"
                    },
                    {
                      "name": "OriginProto",
                      "type": "string"
                    },
                    {
                      "name": "OriginTcpRtt",
                      "type": "int"
                    },
                    {
                      "name": "OriginTlsFingerprint",
                      "type": "string"
                    },
                    {
                      "name": "OriginTlsMode",
                      "type": "string"
                    },
                    {
                      "name": "OriginTlsProtocol",
                      "type": "string"
                    },
                    {
                      "name": "OriginTlsStatus",
                      "type": "string"
                    },
                    {
                      "name": "ProxyProtocol",
                      "type": "string"
                    },
                    {
                      "name": "Status",
                      "type": "int"
                    },
                    {
                      "name": "EventDetails",
                      "type": "dynamic"
                    },
                    {
                      "name": "IP",
                      "type": "string"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "CloudflareDefinition",
          "title": "Cloudflare (Using Blob Container) (via Codeless Connector Framework)",
          "publisher": "Microsoft",
          "descriptionMarkdown": " The Cloudflare data connector provides the capability to ingest Cloudflare logs into Microsoft Sentinel using the Cloudflare Logpush and Azure Blob Storage. Refer to [Cloudflare documentation](https://developers.cloudflare.com/logs/about/)for more information.",
          "graphQueriesTableName": "CloudflareV2_CL",
          "graphQueries": [
            {
              "metricName": "Total events received",
              "legend": "Cloudflare logs",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "Cloudflare Logs",
              "query": "{{graphQueriesTableName}}\n | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n|summarize Time = max(TimeGenerated)\n|where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true,
                  "action": false
                }
              }
            ],
            "customs": [
              {
                "name": "Create a storage account and a container",
                "description": "Before setting up logpush in Cloudflare, first create a storage account and a container in Microsoft Azure. Use [this guide](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction) to know more about Container and Blob. Follow the steps in the [documentation](https://learn.microsoft.com/en-us/azure/storage/common/storage-account-create?tabs=azure-portal) to create an Azure Storage account."
              },
              {
                "name": "Generate a Blob SAS URL",
                "description": "Create and Write permissions are required. Refer the [documentation](https://learn.microsoft.com/en-us/azure/ai-services/translator/document-translation/how-to-guides/create-sas-tokens?tabs=Containers) to know more about Blob SAS token and url."
              },
              {
                "name": "Collecting logs from Cloudflare to your Blob container",
                "description": "Follow the steps in the [documentation](https://developers.cloudflare.com/logs/get-started/enable-destinations/azure/) for collecting logs from Cloudflare to your Blob container."
              }
            ]
          },
          "instructionSteps": [
            {
              "title": "Connect Cloudflare Logs to Microsoft Sentinel",
              "description": "To enable Cloudflare logs for Microsoft Sentinel, provide the required information below and click on Connect.\n>",
              "instructions": [
                {
                  "parameters": {
                    "tenantId": "[subscription().tenantId]",
                    "name": "principalId",
                    "appId": "4f05ce56-95b6-4612-9d98-a45c8cc33f9f"
                  },
                  "type": "ServicePrincipalIDTextBox_test"
                },
                {
                  "parameters": {
                    "label": "The Blob container's URL you want to collect data from",
                    "type": "text",
                    "name": "blobContainerUri",
                    "validations": {
                      "required": true
                    }
                  },
                  "type": "Textbox"
                },
                {
                  "parameters": {
                    "label": "The Blob container's storage account resource group name",
                    "type": "text",
                    "name": "StorageAccountResourceGroupName",
                    "validations": {
                      "required": true
                    }
                  },
                  "type": "Textbox"
                },
                {
                  "parameters": {
                    "label": "The Blob container's storage account location",
                    "type": "text",
                    "name": "StorageAccountLocation",
                    "validations": {
                      "required": true
                    }
                  },
                  "type": "Textbox"
                },
                {
                  "parameters": {
                    "label": "The Blob container's storage account subscription id",
                    "type": "text",
                    "name": "StorageAccountSubscription",
                    "validations": {
                      "required": true
                    }
                  },
                  "type": "Textbox"
                },
                {
                  "parameters": {
                    "label": "The event grid topic name of the blob container's storage account if exist. else keep empty.",
                    "description": "The data flow using event grid to send 'blob-created event' notifications. There could be only one event grid topic for each storage account.\nGo to your blob container's storage account and look in the 'Events' section. If you already have a topic, please provide it's name. Else, keep the text box empty.",
                    "type": "text",
                    "name": "EGSystemTopicName",
                    "validations": {
                      "required": false
                    }
                  },
                  "type": "Textbox"
                },
                {
                  "parameters": {
                    "label": "toggle",
                    "name": "toggle"
                  },
                  "type": "ConnectionToggleButton"
                }
              ]
            }
          ],
          "isConnectivityCriteriasMatchSome": false
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cloudflare",
          "email": "support@cloudflare.com",
          "tier": "Partner",
          "link": "https://support.cloudflare.com"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "Cloudflare (Using Blob Container) (via Codeless Connector Framework)",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "connectorDefinitionName": {
              "defaultValue": "Cloudflare (Using Blob Container) (via Codeless Connector Framework)",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "principalId": {
              "defaultValue": "principalId",
              "type": "securestring",
              "minLength": 1
            },
            "blobContainerUri": {
              "defaultValue": "blobContainerUri",
              "type": "securestring",
              "minLength": 1
            },
            "StorageAccountResourceGroupName": {
              "defaultValue": "StorageAccountResourceGroupName",
              "type": "securestring",
              "minLength": 1
            },
            "StorageAccountLocation": {
              "defaultValue": "StorageAccountLocation",
              "type": "securestring",
              "minLength": 1
            },
            "StorageAccountSubscription": {
              "defaultValue": "StorageAccountSubscription",
              "type": "securestring",
              "minLength": 1
            },
            "EGSystemTopicName": {
              "defaultValue": "",
              "type": "securestring"
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]",
            "connectorName": "sentinel-connector",
            "blobContainerUriPart": "[concat('.blob.core', '.windows.net')]",
            "storageAccountName": "[[split(split(parameters('blobContainerUri'), 'https://')[1], variables('blobContainerUriPart'))[0]]",
            "blobContainerName": "[[split(split(parameters('blobContainerUri'), concat(variables('blobContainerUriPart'), '/'))[1], '/')[0]]",
            "queueName": "[[concat(variables('connectorName'), '-notification')]",
            "dlqName": "[[concat(variables('connectorName'), '-dlq')]",
            "storageAccountId": "[[resourceId(parameters('StorageAccountResourceGroupName'), 'Microsoft.Storage/storageAccounts', variables('storageAccountName'))]",
            "notificationQueueResourceId": "[[resourceId(parameters('StorageAccountResourceGroupName'), 'Microsoft.Storage/storageAccounts/queueServices/queues', variables('storageAccountName'), 'default', variables('queueName'))]",
            "dlqResourceId": "[[resourceId(parameters('StorageAccountResourceGroupName'), 'Microsoft.Storage/storageAccounts/queueServices/queues', variables('storageAccountName'), 'default', variables('dlqName'))]",
            "EGSystemTopicDefaultName": "[[format('eg-system-topic-{0}-{1}', variables('connectorName'), parameters('innerWorkspace'))]",
            "EGSystemTopicName": "[[if(empty(parameters('EGSystemTopicName')), variables('EGSystemTopicDefaultName'), parameters('EGSystemTopicName'))]",
            "EGTopicResourceId": "[[resourceId(parameters('StorageAccountResourceGroupName'), 'Microsoft.EventGrid/systemTopics', variables('EGSystemTopicName'))]",
            "EgSubscriptionName": "[[format('{0}-{1}', variables('connectorName'), 'blobcreatedevents')]",
            "EgSubscriptionResourceId": "[[resourceId(parameters('StorageAccountResourceGroupName'), 'Microsoft.EventGrid/systemTopics/eventSubscriptions', variables('EGSystemTopicName'), variables('EgSubscriptionName'))]",
            "storageBlobContributorRoleId": "[[subscriptionResourceId(parameters('StorageAccountSubscription'), 'Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')]",
            "storageQueueContributorRoleId": "[[subscriptionResourceId(parameters('StorageAccountSubscription'), 'Microsoft.Authorization/roleDefinitions', '974c5e8b-45b9-4653-ba55-5f855dd0fb88')]",
            "blobRaGuid": "[[guid(variables('storageAccountName'), variables('blobContainerName'))]",
            "notificationQueueRaGuid": "[[guid(variables('storageAccountName'), variables('queueName'))]",
            "dlqRaGuid": "[[guid(variables('storageAccountName'), variables('dlqName'))]",
            "blobRoleAssignmentResourceId": "[[resourceId(parameters('StorageAccountResourceGroupName'), 'Microsoft.Storage/storageAccounts/blobServices/containers/providers/roleAssignments', variables('storageAccountName'), 'default', variables('blobContainerName'), 'Microsoft.Authorization', variables('blobRaGuid'))]",
            "notificationQueueRoleAssignmentResourceId": "[[resourceId(parameters('StorageAccountResourceGroupName'), 'Microsoft.Storage/storageAccounts/queueServices/queues/providers/roleAssignments', variables('storageAccountName'), 'default', variables('queueName'), 'Microsoft.Authorization', variables('notificationQueueRaGuid'))]",
            "dlqRoleAssignmentResourceId": "[[resourceId(parameters('StorageAccountResourceGroupName'), 'Microsoft.Storage/storageAccounts/queueServices/queues/providers/roleAssignments', variables('storageAccountName'), 'default', variables('dlqName'), 'Microsoft.Authorization', variables('dlqRaGuid'))]",
            "nestedDeploymentName": "CreateDataFlowResources",
            "nestedDeploymentId": "[[resourceId(parameters('StorageAccountResourceGroupName'), 'Microsoft.Resources/deployments', variables('nestedDeploymentName'))]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2021-04-01",
              "name": "[[variables('nestedDeploymentName')]",
              "properties": {
                "mode": "Incremental",
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "resources": [
                    {
                      "type": "Microsoft.Storage/storageAccounts/queueServices/queues",
                      "apiVersion": "2021-04-01",
                      "name": "[[concat(variables('storageAccountName'), '/default/', variables('queueName'))]",
                      "dependsOn": [],
                      "properties": {}
                    },
                    {
                      "type": "Microsoft.Storage/storageAccounts/queueServices/queues",
                      "apiVersion": "2021-04-01",
                      "name": "[[concat(variables('storageAccountName'), '/default/', variables('dlqName'))]",
                      "dependsOn": [],
                      "properties": {}
                    },
                    {
                      "type": "Microsoft.EventGrid/systemTopics",
                      "apiVersion": "2022-06-15",
                      "name": "[[variables('EGSystemTopicName')]",
                      "location": "[[parameters('StorageAccountLocation')]",
                      "properties": {
                        "source": "[[variables('storageAccountId')]",
                        "topicType": "microsoft.storage.storageaccounts"
                      },
                      "condition": "[[empty(parameters('EGSystemTopicName'))]"
                    },
                    {
                      "type": "Microsoft.EventGrid/systemTopics/eventSubscriptions",
                      "apiVersion": "2023-12-15-preview",
                      "name": "[[format('{0}/{1}', variables('EGSystemTopicName'), variables('EgSubscriptionName'))]",
                      "dependsOn": [
                        "[[format('Microsoft.EventGrid/systemTopics/{0}', variables('EGSystemTopicName'))]"
                      ],
                      "properties": {
                        "destination": {
                          "endpointType": "StorageQueue",
                          "properties": {
                            "queueName": "[[variables('queueName')]",
                            "resourceId": "[[variables('storageAccountId')]"
                          }
                        },
                        "filter": {
                          "includedEventTypes": [
                            "Microsoft.Storage.BlobCreated"
                          ],
                          "subjectBeginsWith": "[[format('{0}/{1}', '/blobServices/default/containers', variables('blobContainerName'))]"
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Storage/storageAccounts/blobServices/containers/providers/roleAssignments",
                      "apiVersion": "2018-01-01-preview",
                      "name": "[[concat(variables('storageAccountName'), '/default/', variables('blobContainerName'), '/Microsoft.Authorization/', variables('blobRaGuid'))]",
                      "properties": {
                        "roleDefinitionId": "[[variables('storageBlobContributorRoleId')]",
                        "principalId": "[[parameters('principalId')]"
                      }
                    },
                    {
                      "type": "Microsoft.Storage/storageAccounts/queueServices/queues/providers/roleAssignments",
                      "apiVersion": "2018-01-01-preview",
                      "name": "[[concat(variables('storageAccountName'), '/default/', variables('queueName'), '/Microsoft.Authorization/',  variables('notificationQueueRaGuid'))]",
                      "dependsOn": [
                        "[[variables('notificationQueueResourceId')]"
                      ],
                      "properties": {
                        "roleDefinitionId": "[[variables('storageQueueContributorRoleId')]",
                        "principalId": "[[parameters('principalId')]"
                      }
                    },
                    {
                      "type": "Microsoft.Storage/storageAccounts/queueServices/queues/providers/roleAssignments",
                      "apiVersion": "2018-01-01-preview",
                      "name": "[[concat(variables('storageAccountName'), '/default/', variables('dlqName'), '/Microsoft.Authorization/', variables('dlqRaGuid'))]",
                      "dependsOn": [
                        "[[variables('dlqResourceId')]"
                      ],
                      "properties": {
                        "roleDefinitionId": "[[variables('storageQueueContributorRoleId')]",
                        "principalId": "[[parameters('principalId')]"
                      }
                    }
                  ]
                }
              },
              "subscriptionId": "[[parameters('StorageAccountSubscription')]",
              "resourceGroup": "[[parameters('StorageAccountResourceGroupName')]"
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'CloudflareUsingBlob', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "StorageAccountBlobContainer",
              "properties": {
                "connectorDefinitionName": "CloudflareDefinition",
                "dataType": "CloudflareV2_CL",
                "dcrConfig": {
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]",
                  "streamName": "Custom-Cloudflare"
                },
                "auth": {
                  "type": "ServicePrincipal"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ],
                  "format": "json",
                  "isGzipCompressed": true
                },
                "request": {
                  "QueueUri": "[[uri(concat('https://', variables('storageAccountName'), '.queue.core', '.windows.net', '/'), variables('queueName'))]",
                  "DlqUri": "[[uri(concat('https://', variables('storageAccountName'), '.queue.core', '.windows.net', '/'), variables('dlqName'))]"
                }
              },
              "dependsOn": [
                "[[variables('nestedDeploymentId')]"
              ]
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Cloudflare data connector with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId2')]",
                  "title": "[DEPRECATED] Cloudflare (using Azure Functions)",
                  "publisher": "Cloudflare",
                  "descriptionMarkdown": "The Cloudflare data connector provides the capability to ingest [Cloudflare logs](https://developers.cloudflare.com/logs/) into Microsoft Sentinel using the Cloudflare Logpush and Azure Blob Storage. Refer to [Cloudflare  documentation](https://developers.cloudflare.com/logs/logpush) for more information.\n\n<p><span style='color:red; font-weight:bold;'>NOTE</span>: This data connector has been deprecated, consider moving to the CCF data connector available in the solution which replaces ingestion via the <a href='https://learn.microsoft.com/en-us/azure/azure-monitor/logs/custom-logs-migrate' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>.</p>",
                  "additionalRequirementBanner": ">This data connector depends on a parser based on a Kusto Function to work as expected [**Cloudflare**](https://aka.ms/sentinel-CloudflareDataConnector-parser) which is deployed with the Microsoft Sentinel Solution.",
                  "graphQueries": [
                    {
                      "metricName": "Cloudflare logs",
                      "legend": "Cloudflare_CL",
                      "baseQuery": "Cloudflare_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All Cloudflare logs",
                      "query": "Cloudflare_CL\n| sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "Cloudflare_CL",
                      "lastDataReceivedQuery": "Cloudflare_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Cloudflare_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(1d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "Azure Blob Storage connection string and container name",
                        "description": "Azure Blob Storage connection string and container name where the logs are pushed to by Cloudflare Logpush. [See the documentation to learn more about creating Azure Blob Storage container.](https://learn.microsoft.com/azure/storage/blobs/storage-quickstart-blobs-portal)"
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This connector uses Azure Functions to connect to the Azure Blob Storage API to pull logs into Microsoft Sentinel. This might result in additional costs for data ingestion and for storing data in Azure Blob Storage costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) and [Azure Blob Storage pricing page](https://azure.microsoft.com/pricing/details/storage/blobs/) for details."
                    },
                    {
                      "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                    },
                    {
                      "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**Cloudflare**](https://aka.ms/sentinel-CloudflareDataConnector-parser) which is deployed with the Microsoft Sentinel Solution."
                    },
                    {
                      "description": "**STEP 1 - Configuration of the Cloudflare Logpush**\n\nSee documentation to [setup Cloudflare Logpush to Microsoft Azure](https://developers.cloudflare.com/logs/logpush/logpush-dashboard)"
                    },
                    {
                      "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Cloudflare data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following), as well as Azure Blob Storage connection string and container name, readily available.",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Primary Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "description": "Use this method for automated deployment of the Cloudflare data connector using an ARM Template.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-CloudflareDataConnector-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Azure Blob Storage Container Name**, **Azure Blob Storage Connection String**, **Microsoft Sentinel Workspace Id**, **Microsoft Sentinel Shared Key**\n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**.\n5. Click **Purchase** to deploy.",
                      "title": "Option 1 - Azure Resource Manager (ARM) Template"
                    },
                    {
                      "description": "Use the following step-by-step instructions to deploy the Cloudflare data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                      "title": "Option 2 - Manual Deployment of Azure Functions"
                    },
                    {
                      "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/create-first-function-vs-code-python) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-CloudflareDataConnector-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. CloudflareXX).\n\n\te. **Select a runtime:** Choose Python 3.11.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
                    },
                    {
                      "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select **+ New application setting**.\n3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tCONTAINER_NAME\n\t\tAZURE_STORAGE_CONNECTION_STRING\n\t\tWORKSPACE_ID\n\t\tSHARED_KEY\n\t\tlogAnalyticsUri (Optional)\n - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://WORKSPACE_ID.ods.opinsights.azure.us`. \n4. Once all application settings have been entered, click **Save**."
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
                "contentId": "[variables('_dataConnectorContentId2')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "contentKind": "DataConnector",
        "displayName": "[DEPRECATED] Cloudflare (using Azure Functions)",
        "contentProductId": "[variables('_dataConnectorcontentProductId2')]",
        "id": "[variables('_dataConnectorcontentProductId2')]",
        "version": "[variables('dataConnectorVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId2')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion2')]",
        "source": {
          "kind": "Solution",
          "name": "Cloudflare",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cloudflare",
          "email": "support@cloudflare.com",
          "tier": "Partner",
          "link": "https://support.cloudflare.com"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "[DEPRECATED] Cloudflare (using Azure Functions)",
          "publisher": "Cloudflare",
          "descriptionMarkdown": "The Cloudflare data connector provides the capability to ingest [Cloudflare logs](https://developers.cloudflare.com/logs/) into Microsoft Sentinel using the Cloudflare Logpush and Azure Blob Storage. Refer to [Cloudflare  documentation](https://developers.cloudflare.com/logs/logpush) for more information.\n\n<p><span style='color:red; font-weight:bold;'>NOTE</span>: This data connector has been deprecated, consider moving to the CCF data connector available in the solution which replaces ingestion via the <a href='https://learn.microsoft.com/en-us/azure/azure-monitor/logs/custom-logs-migrate' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>.</p>",
          "graphQueries": [
            {
              "metricName": "Cloudflare logs",
              "legend": "Cloudflare_CL",
              "baseQuery": "Cloudflare_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "Cloudflare_CL",
              "lastDataReceivedQuery": "Cloudflare_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "Cloudflare_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(1d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "All Cloudflare logs",
              "query": "Cloudflare_CL\n| sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "Azure Blob Storage connection string and container name",
                "description": "Azure Blob Storage connection string and container name where the logs are pushed to by Cloudflare Logpush. [See the documentation to learn more about creating Azure Blob Storage container.](https://learn.microsoft.com/azure/storage/blobs/storage-quickstart-blobs-portal)"
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This connector uses Azure Functions to connect to the Azure Blob Storage API to pull logs into Microsoft Sentinel. This might result in additional costs for data ingestion and for storing data in Azure Blob Storage costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) and [Azure Blob Storage pricing page](https://azure.microsoft.com/pricing/details/storage/blobs/) for details."
            },
            {
              "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
            },
            {
              "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**Cloudflare**](https://aka.ms/sentinel-CloudflareDataConnector-parser) which is deployed with the Microsoft Sentinel Solution."
            },
            {
              "description": "**STEP 1 - Configuration of the Cloudflare Logpush**\n\nSee documentation to [setup Cloudflare Logpush to Microsoft Azure](https://developers.cloudflare.com/logs/logpush/logpush-dashboard)"
            },
            {
              "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Cloudflare data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following), as well as Azure Blob Storage connection string and container name, readily available.",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Primary Key"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "description": "Use this method for automated deployment of the Cloudflare data connector using an ARM Template.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-CloudflareDataConnector-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Azure Blob Storage Container Name**, **Azure Blob Storage Connection String**, **Microsoft Sentinel Workspace Id**, **Microsoft Sentinel Shared Key**\n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**.\n5. Click **Purchase** to deploy.",
              "title": "Option 1 - Azure Resource Manager (ARM) Template"
            },
            {
              "description": "Use the following step-by-step instructions to deploy the Cloudflare data connector manually with Azure Functions (Deployment via Visual Studio Code).",
              "title": "Option 2 - Manual Deployment of Azure Functions"
            },
            {
              "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/create-first-function-vs-code-python) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-CloudflareDataConnector-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. CloudflareXX).\n\n\te. **Select a runtime:** Choose Python 3.11.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
            },
            {
              "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select **+ New application setting**.\n3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tCONTAINER_NAME\n\t\tAZURE_STORAGE_CONNECTION_STRING\n\t\tWORKSPACE_ID\n\t\tSHARED_KEY\n\t\tlogAnalyticsUri (Optional)\n - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://WORKSPACE_ID.ods.opinsights.azure.us`. \n4. Once all application settings have been entered, click **Save**."
            }
          ],
          "id": "[variables('_uiConfigId2')]",
          "additionalRequirementBanner": ">This data connector depends on a parser based on a Kusto Function to work as expected [**Cloudflare**](https://aka.ms/sentinel-CloudflareDataConnector-parser) which is deployed with the Microsoft Sentinel Solution."
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Cloudflare Data Parser with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "Cloudflare",
                "query": "let Cloudflare_view = view() {\n  Cloudflare_CL\n  | extend\n      ClientDeviceType = tostring(column_ifexists(\"ClientDeviceType_s\", column_ifexists(\"Source_s\", \"\"))),\n      TlsCipher = tostring(column_ifexists(\"ClientSSLCipher_s\", column_ifexists(\"ClientTlsCipher_s\", \"\"))),\n      TlsVersion = tostring(column_ifexists(\"ClientSSLProtocol_s\", column_ifexists(\"ClientTlsProtocol_s\", \"\"))),\n      DvcAction = tostring(column_ifexists(\"FirewallMatchesActions_s\", column_ifexists(\"Event_s\", column_ifexists(\"Action_s\", \"\")))),\n      NetworkRuleName = tostring(column_ifexists(\"FirewallMatchesRuleIDs_s\", column_ifexists(\"RuleID_s\", \"\"))),\n      SrcBytes = toint(column_ifexists(\"ClientRequestBytes_d\", column_ifexists(\"ClientBytes_d\", \"\"))),\n      SrcPortNumber = toint(column_ifexists(\"ClientSrcPort_d\", column_ifexists(\"ClientPort_d\", \"\"))),\n      DstBytes = toint(column_ifexists(\"EdgeResponseBytes_d\", column_ifexists(\"OriginBytes_d\", \"\"))),\n      BotScore = toint(column_ifexists(\"BotScore_d\", \"\")),\n      BotScoreSrc = tostring(column_ifexists(\"BotScoreSrc_s\", \"\")),\n      CacheCacheStatus = tostring(column_ifexists(\"CacheCacheStatus_s\", \"\")),\n      CacheResponseBytes = toint(column_ifexists(\"CacheResponseBytes_d\", \"\")),\n      CacheResponseStatus = toint(column_ifexists(\"CacheResponseStatus_d\", \"\")),\n      CacheTieredFill = tobool(column_ifexists(\"CacheTieredFill_b\", \"\")),\n      ClientASN = toint(column_ifexists(\"ClientASN_d\", \"\")),\n      SrcGeoCountry = tostring(column_ifexists(\"ClientCountry_s\", \"\")),\n      SrcIpAddr = tostring(column_ifexists(\"ClientIP_s\", \"\")),\n      ClientIPClass = tostring(column_ifexists(\"ClientIPClass_s\", \"\")),\n      HttpRequestHeaderHost = tostring(column_ifexists(\"ClientRequestHost_s\", \"\")),\n      HttpRequestMethod = tostring(column_ifexists(\"ClientRequestMethod_s\", \"\")),\n      ClientRequestPath = tostring(column_ifexists(\"ClientRequestPath_s\", \"\")),\n      ClientRequestProtocol = tostring(column_ifexists(\"ClientRequestProtocol_s\", \"\")),\n      HttpReferrerOriginal = tostring(column_ifexists(\"ClientRequestReferer_s\", \"\")),\n      ClientRequestURI = tostring(column_ifexists(\"ClientRequestURI_s\", \"\")),\n      HttpUserAgentOriginal = tostring(column_ifexists(\"ClientRequestUserAgent_s\", \"\")),\n      ClientXRequestedWith = tostring(column_ifexists(\"ClientXRequestedWith_s\", \"\")),\n      EdgeColoCode = tostring(column_ifexists(\"EdgeColoCode_s\", \"\")),\n      EdgeColoID = toint(column_ifexists(\"EdgeColoID_d\", \"\")),\n      EdgeEndTimestamp = todatetime(column_ifexists(\"EdgeEndTimestamp_t\", \"\")),\n      EdgePathingOp = tostring(column_ifexists(\"EdgePathingOp_s\", \"\")),\n      EdgePathingSrc = tostring(column_ifexists(\"EdgePathingSrc_s\", \"\")),\n      EdgePathingStatus = tostring(column_ifexists(\"EdgePathingStatus_s\", \"\")),\n      EdgeRateLimitAction = tostring(column_ifexists(\"EdgeRateLimitAction_s\", \"\")),\n      EdgeRateLimitID = toint(column_ifexists(\"EdgeRateLimitID_d\", \"\")),\n      EdgeRequestHost = tostring(column_ifexists(\"EdgeRequestHost_s\", \"\")),\n      EdgeResponseCompressionRatio = toint(column_ifexists(\"EdgeResponseCompressionRatio_d\", \"\")),\n      HttpContentType = tostring(column_ifexists(\"EdgeResponseContentType_s\", \"\")),\n      EdgeResponseStatus = toint(column_ifexists(\"EdgeResponseStatus_d\", \"\")),\n      EdgeServerIP = tostring(column_ifexists(\"EdgeServerIP_s\", \"\")),\n      EdgeStartTimestamp = todatetime(column_ifexists(\"EdgeStartTimestamp_t\", \"\")),\n      FirewallMatchesSources = tostring(column_ifexists(\"FirewallMatchesSources_s\", \"\")),\n      DstIpAddr = tostring(column_ifexists(\"OriginIP_s\", \"\")),\n      OriginResponseBytes = toint(column_ifexists(\"OriginResponseBytes_d\", \"\")),\n      OriginResponseHTTPExpires = tostring(column_ifexists(\"OriginResponseHTTPExpires_s\", \"\")),\n      OriginResponseHTTPLastModified = tostring(column_ifexists(\"OriginResponseHTTPLastModified_s\", \"\")),\n      HttpStatusCode = toint(column_ifexists(\"OriginResponseStatus_d\", \"\")),\n      OriginResponseTime = toint(column_ifexists(\"OriginResponseTime_d\", \"\")),\n      OriginSSLProtocol = tostring(column_ifexists(\"OriginSSLProtocol_s\", \"\")),\n      ParentRayID = tostring(column_ifexists(\"ParentRayID_s\", \"\")),\n      RayID = tostring(column_ifexists(\"RayID_s\", \"\")),\n      SecurityLevel = tostring(column_ifexists(\"SecurityLevel_s\", \"\")),\n      WAFAction = tostring(column_ifexists(\"WAFAction_s\", \"\")),\n      WAFFlags = tostring(column_ifexists(\"WAFFlags_s\", \"\")),\n      WAFMatchedVar = tostring(column_ifexists(\"WAFMatchedVar_s\", \"\")),\n      WAFProfile = tostring(column_ifexists(\"WAFProfile_s\", \"\")),\n      WAFRuleID = tostring(column_ifexists(\"WAFRuleID_s\", \"\")),\n      WAFRuleMessage = tostring(column_ifexists(\"WAFRuleMessage_s\", \"\")),\n      WorkerCPUTime = toint(column_ifexists(\"WorkerCPUTime_d\", \"\")),\n      WorkerStatus = tostring(column_ifexists(\"WorkerStatus_s\", \"\")),\n      WorkerSubrequest = tobool(column_ifexists(\"WorkerSubrequest_b\", \"\")),\n      WorkerSubrequestCount = toint(column_ifexists(\"WorkerSubrequestCount_d\", \"\")),\n      ZoneID = toint(column_ifexists(\"ZoneID_d\", \"\")),\n      Application = tostring(column_ifexists(\"Application_s\", \"\")),\n      ClientMatchedIpFirewall = tostring(column_ifexists(\"ClientMatchedIpFirewall_s\", \"\")),\n      NetworkProtocol = tostring(column_ifexists(\"ClientProto_s\", \"\")),\n      ClientTcpRtt = toint(column_ifexists(\"ClientTcpRtt_d\", \"\")),\n      ClientTlsClientHelloServerName = tostring(column_ifexists(\"ClientTlsClientHelloServerName_s\", \"\")),\n      ClientTlsStatus = tostring(column_ifexists(\"ClientTlsStatus_s\", \"\")),\n      ColoCode = tostring(column_ifexists(\"ColoCode_s\", \"\")),\n      ConnectTimestamp = todatetime(column_ifexists(\"ConnectTimestamp_t\", \"\")),\n      DisconnectTimestamp = todatetime(column_ifexists(\"DisconnectTimestamp_t\", \"\")),\n      IpFirewall = tobool(column_ifexists(\"IpFirewall_b\", \"\")),\n      DstPortNumber = toint(column_ifexists(\"OriginPort_d\", \"\")),\n      OriginProto = tostring(column_ifexists(\"OriginProto_s\", \"\")),\n      OriginTcpRtt = toint(column_ifexists(\"OriginTcpRtt_d\", \"\")),\n      OriginTlsCipher = tostring(column_ifexists(\"OriginTlsCipher_s\", \"\")),\n      OriginTlsFingerprint = tostring(column_ifexists(\"OriginTlsFingerprint_s\", \"\")),\n      OriginTlsMode = tostring(column_ifexists(\"OriginTlsMode_s\", \"\")),\n      OriginTlsProtocol = tostring(column_ifexists(\"OriginTlsProtocol_s\", \"\")),\n      OriginTlsStatus = tostring(column_ifexists(\"OriginTlsStatus_s\", \"\")),\n      ProxyProtocol = tostring(column_ifexists(\"ProxyProtocol_s\", \"\")),\n      EventResult = toint(column_ifexists(\"Status_d\", \"\")),\n      Timestamp = todatetime(column_ifexists(\"Timestamp_t\", \"\")),\n      ClientASNDescription = tostring(column_ifexists(\"ClientASNDescription_s\", \"\")),\n      ClientRefererHost = tostring(column_ifexists(\"ClientRefererHost_s\", \"\")),\n      ClientRefererPath = tostring(column_ifexists(\"ClientRefererPath_s\", \"\")),\n      ClientRefererQuery = tostring(column_ifexists(\"ClientRefererQuery_s\", \"\")),\n      ClientRefererScheme = tostring(column_ifexists(\"ClientRefererScheme_s\", \"\")),\n      ClientRequestQuery = tostring(column_ifexists(\"ClientRequestQuery_s\", \"\")),\n      ClientRequestScheme = tostring(column_ifexists(\"ClientRequestScheme_s\", \"\")),\n      Datetime = todatetime(column_ifexists(\"Datetime_t\", \"\")),\n      EventSubType = tostring(column_ifexists(\"Kind_s\", \"\")),\n      MatchIndex = toint(column_ifexists(\"MatchIndex_d\", \"\")),\n      OriginatorRayID = tostring(column_ifexists(\"OriginatorRayID_s\", \"\")),\n      TimeGenerated = column_ifexists('TimeGenerated', '')\n};\nlet Cloudflarev2_view = view() {\n  CloudflareV2_CL\n  | extend\n      ClientDeviceType = tostring(column_ifexists(\"ClientDeviceType\", column_ifexists(\"Source\", \"\"))),\n      TlsCipher = tostring(column_ifexists(\"ClientSSLCipher\", column_ifexists(\"ClientTlsCipher\", \"\"))),\n      TlsVersion = tostring(column_ifexists(\"ClientSSLProtocol\", column_ifexists(\"ClientTlsProtocol\", \"\"))),\n      DvcAction = tostring(column_ifexists(\"FirewallMatchesActions\", column_ifexists(\"Event\", column_ifexists(\"Action\", \"\")))),\n      NetworkRuleName = tostring(column_ifexists(\"FirewallMatchesRuleIDs\", column_ifexists(\"RuleID\", \"\"))),\n      SrcBytes = toint(column_ifexists(\"ClientRequestBytes\", column_ifexists(\"ClientBytes\", \"\"))),\n      SrcPortNumber = toint(column_ifexists(\"ClientSrcPort\", column_ifexists(\"ClientPort\", \"\"))),\n      DstBytes = toint(column_ifexists(\"EdgeResponseBytes\", column_ifexists(\"OriginBytes\", \"\"))),\n      BotScore = toint(column_ifexists(\"BotScore\", \"\")),\n      BotScoreSrc = tostring(column_ifexists(\"BotScoreSrc\", \"\")),\n      CacheCacheStatus = tostring(column_ifexists(\"CacheCacheStatus\", \"\")),\n      CacheResponseBytes = toint(column_ifexists(\"CacheResponseBytes\", \"\")),\n      CacheResponseStatus = toint(column_ifexists(\"CacheResponseStatus\", \"\")),\n      CacheTieredFill = tobool(column_ifexists(\"CacheTieredFill\", \"\")),\n      ClientASN = toint(column_ifexists(\"ClientASN\", \"\")),\n      SrcGeoCountry = tostring(column_ifexists(\"ClientCountry\", \"\")),\n      SrcIpAddr = tostring(column_ifexists(\"ClientIP\", \"\")),\n      ClientIPClass = tostring(column_ifexists(\"ClientIPClass\", \"\")),\n      HttpRequestHeaderHost = tostring(column_ifexists(\"ClientRequestHost\", \"\")),\n      HttpRequestMethod = tostring(column_ifexists(\"ClientRequestMethod\", \"\")),\n      ClientRequestPath = tostring(column_ifexists(\"ClientRequestPath\", \"\")),\n      ClientRequestProtocol = tostring(column_ifexists(\"ClientRequestProtocol\", \"\")),\n      HttpReferrerOriginal = tostring(column_ifexists(\"ClientRequestReferer\", \"\")),\n      ClientRequestURI = tostring(column_ifexists(\"ClientRequestURI\", \"\")),\n      HttpUserAgentOriginal = tostring(column_ifexists(\"ClientRequestUserAgent\", \"\")),\n      ClientXRequestedWith = tostring(column_ifexists(\"ClientXRequestedWith\", \"\")),\n      EdgeColoCode = tostring(column_ifexists(\"EdgeColoCode\", \"\")),\n      EdgeColoID = toint(column_ifexists(\"EdgeColoID\", \"\")),\n      EdgeEndTimestamp = todatetime(column_ifexists(\"EdgeEndTimestamp\", \"\")),\n      EdgePathingOp = tostring(column_ifexists(\"EdgePathingOp\", \"\")),\n      EdgePathingSrc = tostring(column_ifexists(\"EdgePathingSrc\", \"\")),\n      EdgePathingStatus = tostring(column_ifexists(\"EdgePathingStatus\", \"\")),\n      EdgeRateLimitAction = tostring(column_ifexists(\"EdgeRateLimitAction\", \"\")),\n      EdgeRateLimitID = toint(column_ifexists(\"EdgeRateLimitID\", \"\")),\n      EdgeRequestHost = tostring(column_ifexists(\"EdgeRequestHost\", \"\")),\n      EdgeResponseCompressionRatio = toint(column_ifexists(\"EdgeResponseCompressionRatio\", \"\")),\n      HttpContentType = tostring(column_ifexists(\"EdgeResponseContentType\", \"\")),\n      EdgeResponseStatus = toint(column_ifexists(\"EdgeResponseStatus\", \"\")),\n      EdgeServerIP = tostring(column_ifexists(\"EdgeServerIP\", \"\")),\n      EdgeStartTimestamp = todatetime(column_ifexists(\"EdgeStartTimestamp\", \"\")),\n      FirewallMatchesSources = tostring(column_ifexists(\"FirewallMatchesSources\", \"\")),\n      DstIpAddr = tostring(column_ifexists(\"OriginIP\", \"\")),\n      OriginResponseBytes = toint(column_ifexists(\"OriginResponseBytes\", \"\")),\n      OriginResponseHTTPExpires = tostring(column_ifexists(\"OriginResponseHTTPExpires\", \"\")),\n      OriginResponseHTTPLastModified = tostring(column_ifexists(\"OriginResponseHTTPLastModified\", \"\")),\n      HttpStatusCode = toint(column_ifexists(\"OriginResponseStatus\", \"\")),\n      OriginResponseTime = toint(column_ifexists(\"OriginResponseTime\", \"\")),\n      OriginSSLProtocol = tostring(column_ifexists(\"OriginSSLProtocol\", \"\")),\n      ParentRayID = tostring(column_ifexists(\"ParentRayID\", \"\")),\n      RayID = tostring(column_ifexists(\"RayID\", \"\")),\n      SecurityLevel = tostring(column_ifexists(\"SecurityLevel\", \"\")),\n      WAFAction = tostring(column_ifexists(\"WAFAction\", \"\")),\n      WAFFlags = tostring(column_ifexists(\"WAFFlags\", \"\")),\n      WAFMatchedVar = tostring(column_ifexists(\"WAFMatchedVar\", \"\")),\n      WAFProfile = tostring(column_ifexists(\"WAFProfile\", \"\")),\n      WAFRuleID = tostring(column_ifexists(\"WAFRuleID\", \"\")),\n      WAFRuleMessage = tostring(column_ifexists(\"WAFRuleMessage\", \"\")),\n      WorkerCPUTime = toint(column_ifexists(\"WorkerCPUTime\", \"\")),\n      WorkerStatus = tostring(column_ifexists(\"WorkerStatus\", \"\")),\n      WorkerSubrequest = tobool(column_ifexists(\"WorkerSubrequest\", \"\")),\n      WorkerSubrequestCount = toint(column_ifexists(\"WorkerSubrequestCount\", \"\")),\n      ZoneID = toint(column_ifexists(\"ZoneID\", \"\")),\n      Application = tostring(column_ifexists(\"Application\", \"\")),\n      ClientMatchedIpFirewall = tostring(column_ifexists(\"ClientMatchedIpFirewall\", \"\")),\n      NetworkProtocol = tostring(column_ifexists(\"ClientProto\", \"\")),\n      ClientTcpRtt = toint(column_ifexists(\"ClientTcpRtt\", \"\")),\n      ClientTlsClientHelloServerName = tostring(column_ifexists(\"ClientTlsClientHelloServerName\", \"\")),\n      ClientTlsStatus = tostring(column_ifexists(\"ClientTlsStatus\", \"\")),\n      ColoCode = tostring(column_ifexists(\"ColoCode\", \"\")),\n      ConnectTimestamp = todatetime(column_ifexists(\"ConnectTimestamp\", \"\")),\n      DisconnectTimestamp = todatetime(column_ifexists(\"DisconnectTimestamp\", \"\")),\n      IpFirewall = tobool(column_ifexists(\"IpFirewall\", \"\")),\n      DstPortNumber = toint(column_ifexists(\"OriginPort\", \"\")),\n      OriginProto = tostring(column_ifexists(\"OriginProto\", \"\")),\n      OriginTcpRtt = toint(column_ifexists(\"OriginTcpRtt\", \"\")),\n      OriginTlsCipher = tostring(column_ifexists(\"OriginTlsCipher\", \"\")),\n      OriginTlsFingerprint = tostring(column_ifexists(\"OriginTlsFingerprint\", \"\")),\n      OriginTlsMode = tostring(column_ifexists(\"OriginTlsMode\", \"\")),\n      OriginTlsProtocol = tostring(column_ifexists(\"OriginTlsProtocol\", \"\")),\n      OriginTlsStatus = tostring(column_ifexists(\"OriginTlsStatus\", \"\")),\n      ProxyProtocol = tostring(column_ifexists(\"ProxyProtocol\", \"\")),\n      EventResult = toint(column_ifexists(\"Status\", \"\")),\n      Timestamp = todatetime(column_ifexists(\"Timestamp\", \"\")),\n      ClientASNDescription = tostring(column_ifexists(\"ClientASNDescription\", \"\")),\n      ClientRefererHost = tostring(column_ifexists(\"ClientRefererHost\", \"\")),\n      ClientRefererPath = tostring(column_ifexists(\"ClientRefererPath\", \"\")),\n      ClientRefererQuery = tostring(column_ifexists(\"ClientRefererQuery\", \"\")),\n      ClientRefererScheme = tostring(column_ifexists(\"ClientRefererScheme\", \"\")),\n      ClientRequestQuery = tostring(column_ifexists(\"ClientRequestQuery\", \"\")),\n      ClientRequestScheme = tostring(column_ifexists(\"ClientRequestScheme\", \"\")),\n      Datetime = todatetime(column_ifexists(\"Datetime\", \"\")),\n      EventSubType = tostring(column_ifexists(\"Kind\", \"\")),\n      MatchIndex = toint(column_ifexists(\"MatchIndex\", \"\")),\n      OriginatorRayID = tostring(column_ifexists(\"OriginatorRayID\", \"\")),\n      TimeGenerated = column_ifexists('TimeGenerated', '')\n};\nunion isfuzzy=true (Cloudflare_view), (Cloudflarev2_view)\n  | project ClientDeviceType, TlsCipher, DvcAction, TlsVersion, NetworkRuleName, SrcBytes, SrcPortNumber, DstBytes, BotScore, BotScoreSrc, CacheCacheStatus, CacheResponseBytes, CacheResponseStatus, CacheTieredFill, ClientASN, SrcGeoCountry, SrcIpAddr, ClientIPClass, HttpRequestHeaderHost, HttpRequestMethod, ClientRequestPath, ClientRequestProtocol, HttpReferrerOriginal, ClientRequestURI, HttpUserAgentOriginal, ClientXRequestedWith, EdgeColoCode, EdgeColoID, EdgeEndTimestamp, EdgePathingOp, EdgePathingSrc, EdgePathingStatus, EdgeRateLimitAction, EdgeRateLimitID, EdgeRequestHost, EdgeResponseCompressionRatio, HttpContentType, EdgeResponseStatus, EdgeServerIP, EdgeStartTimestamp, FirewallMatchesSources, DstIpAddr, OriginResponseBytes, OriginResponseHTTPExpires, OriginResponseHTTPLastModified, HttpStatusCode, OriginResponseTime, OriginSSLProtocol, ParentRayID, RayID, SecurityLevel, WAFAction, WAFFlags, WAFMatchedVar, WAFProfile, WAFRuleID, WAFRuleMessage, WorkerCPUTime, WorkerStatus, WorkerSubrequest, WorkerSubrequestCount, ZoneID, Application, ClientMatchedIpFirewall, NetworkProtocol, ClientTcpRtt, ClientTlsClientHelloServerName, ClientTlsStatus, ColoCode, ConnectTimestamp, DisconnectTimestamp, IpFirewall, DstPortNumber, OriginProto, OriginTcpRtt, OriginTlsCipher, OriginTlsFingerprint, OriginTlsMode, OriginTlsProtocol, OriginTlsStatus, ProxyProtocol, EventResult, Timestamp, ClientASNDescription, ClientRefererHost, ClientRefererPath, ClientRefererQuery, ClientRefererScheme, ClientRequestQuery, ClientRequestScheme, Datetime, EventSubType, MatchIndex, OriginatorRayID, TimeGenerated\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'Cloudflare')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "Cloudflare",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "Cloudflare",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Cloudflare",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "Cloudflare",
        "query": "let Cloudflare_view = view() {\n  Cloudflare_CL\n  | extend\n      ClientDeviceType = tostring(column_ifexists(\"ClientDeviceType_s\", column_ifexists(\"Source_s\", \"\"))),\n      TlsCipher = tostring(column_ifexists(\"ClientSSLCipher_s\", column_ifexists(\"ClientTlsCipher_s\", \"\"))),\n      TlsVersion = tostring(column_ifexists(\"ClientSSLProtocol_s\", column_ifexists(\"ClientTlsProtocol_s\", \"\"))),\n      DvcAction = tostring(column_ifexists(\"FirewallMatchesActions_s\", column_ifexists(\"Event_s\", column_ifexists(\"Action_s\", \"\")))),\n      NetworkRuleName = tostring(column_ifexists(\"FirewallMatchesRuleIDs_s\", column_ifexists(\"RuleID_s\", \"\"))),\n      SrcBytes = toint(column_ifexists(\"ClientRequestBytes_d\", column_ifexists(\"ClientBytes_d\", \"\"))),\n      SrcPortNumber = toint(column_ifexists(\"ClientSrcPort_d\", column_ifexists(\"ClientPort_d\", \"\"))),\n      DstBytes = toint(column_ifexists(\"EdgeResponseBytes_d\", column_ifexists(\"OriginBytes_d\", \"\"))),\n      BotScore = toint(column_ifexists(\"BotScore_d\", \"\")),\n      BotScoreSrc = tostring(column_ifexists(\"BotScoreSrc_s\", \"\")),\n      CacheCacheStatus = tostring(column_ifexists(\"CacheCacheStatus_s\", \"\")),\n      CacheResponseBytes = toint(column_ifexists(\"CacheResponseBytes_d\", \"\")),\n      CacheResponseStatus = toint(column_ifexists(\"CacheResponseStatus_d\", \"\")),\n      CacheTieredFill = tobool(column_ifexists(\"CacheTieredFill_b\", \"\")),\n      ClientASN = toint(column_ifexists(\"ClientASN_d\", \"\")),\n      SrcGeoCountry = tostring(column_ifexists(\"ClientCountry_s\", \"\")),\n      SrcIpAddr = tostring(column_ifexists(\"ClientIP_s\", \"\")),\n      ClientIPClass = tostring(column_ifexists(\"ClientIPClass_s\", \"\")),\n      HttpRequestHeaderHost = tostring(column_ifexists(\"ClientRequestHost_s\", \"\")),\n      HttpRequestMethod = tostring(column_ifexists(\"ClientRequestMethod_s\", \"\")),\n      ClientRequestPath = tostring(column_ifexists(\"ClientRequestPath_s\", \"\")),\n      ClientRequestProtocol = tostring(column_ifexists(\"ClientRequestProtocol_s\", \"\")),\n      HttpReferrerOriginal = tostring(column_ifexists(\"ClientRequestReferer_s\", \"\")),\n      ClientRequestURI = tostring(column_ifexists(\"ClientRequestURI_s\", \"\")),\n      HttpUserAgentOriginal = tostring(column_ifexists(\"ClientRequestUserAgent_s\", \"\")),\n      ClientXRequestedWith = tostring(column_ifexists(\"ClientXRequestedWith_s\", \"\")),\n      EdgeColoCode = tostring(column_ifexists(\"EdgeColoCode_s\", \"\")),\n      EdgeColoID = toint(column_ifexists(\"EdgeColoID_d\", \"\")),\n      EdgeEndTimestamp = todatetime(column_ifexists(\"EdgeEndTimestamp_t\", \"\")),\n      EdgePathingOp = tostring(column_ifexists(\"EdgePathingOp_s\", \"\")),\n      EdgePathingSrc = tostring(column_ifexists(\"EdgePathingSrc_s\", \"\")),\n      EdgePathingStatus = tostring(column_ifexists(\"EdgePathingStatus_s\", \"\")),\n      EdgeRateLimitAction = tostring(column_ifexists(\"EdgeRateLimitAction_s\", \"\")),\n      EdgeRateLimitID = toint(column_ifexists(\"EdgeRateLimitID_d\", \"\")),\n      EdgeRequestHost = tostring(column_ifexists(\"EdgeRequestHost_s\", \"\")),\n      EdgeResponseCompressionRatio = toint(column_ifexists(\"EdgeResponseCompressionRatio_d\", \"\")),\n      HttpContentType = tostring(column_ifexists(\"EdgeResponseContentType_s\", \"\")),\n      EdgeResponseStatus = toint(column_ifexists(\"EdgeResponseStatus_d\", \"\")),\n      EdgeServerIP = tostring(column_ifexists(\"EdgeServerIP_s\", \"\")),\n      EdgeStartTimestamp = todatetime(column_ifexists(\"EdgeStartTimestamp_t\", \"\")),\n      FirewallMatchesSources = tostring(column_ifexists(\"FirewallMatchesSources_s\", \"\")),\n      DstIpAddr = tostring(column_ifexists(\"OriginIP_s\", \"\")),\n      OriginResponseBytes = toint(column_ifexists(\"OriginResponseBytes_d\", \"\")),\n      OriginResponseHTTPExpires = tostring(column_ifexists(\"OriginResponseHTTPExpires_s\", \"\")),\n      OriginResponseHTTPLastModified = tostring(column_ifexists(\"OriginResponseHTTPLastModified_s\", \"\")),\n      HttpStatusCode = toint(column_ifexists(\"OriginResponseStatus_d\", \"\")),\n      OriginResponseTime = toint(column_ifexists(\"OriginResponseTime_d\", \"\")),\n      OriginSSLProtocol = tostring(column_ifexists(\"OriginSSLProtocol_s\", \"\")),\n      ParentRayID = tostring(column_ifexists(\"ParentRayID_s\", \"\")),\n      RayID = tostring(column_ifexists(\"RayID_s\", \"\")),\n      SecurityLevel = tostring(column_ifexists(\"SecurityLevel_s\", \"\")),\n      WAFAction = tostring(column_ifexists(\"WAFAction_s\", \"\")),\n      WAFFlags = tostring(column_ifexists(\"WAFFlags_s\", \"\")),\n      WAFMatchedVar = tostring(column_ifexists(\"WAFMatchedVar_s\", \"\")),\n      WAFProfile = tostring(column_ifexists(\"WAFProfile_s\", \"\")),\n      WAFRuleID = tostring(column_ifexists(\"WAFRuleID_s\", \"\")),\n      WAFRuleMessage = tostring(column_ifexists(\"WAFRuleMessage_s\", \"\")),\n      WorkerCPUTime = toint(column_ifexists(\"WorkerCPUTime_d\", \"\")),\n      WorkerStatus = tostring(column_ifexists(\"WorkerStatus_s\", \"\")),\n      WorkerSubrequest = tobool(column_ifexists(\"WorkerSubrequest_b\", \"\")),\n      WorkerSubrequestCount = toint(column_ifexists(\"WorkerSubrequestCount_d\", \"\")),\n      ZoneID = toint(column_ifexists(\"ZoneID_d\", \"\")),\n      Application = tostring(column_ifexists(\"Application_s\", \"\")),\n      ClientMatchedIpFirewall = tostring(column_ifexists(\"ClientMatchedIpFirewall_s\", \"\")),\n      NetworkProtocol = tostring(column_ifexists(\"ClientProto_s\", \"\")),\n      ClientTcpRtt = toint(column_ifexists(\"ClientTcpRtt_d\", \"\")),\n      ClientTlsClientHelloServerName = tostring(column_ifexists(\"ClientTlsClientHelloServerName_s\", \"\")),\n      ClientTlsStatus = tostring(column_ifexists(\"ClientTlsStatus_s\", \"\")),\n      ColoCode = tostring(column_ifexists(\"ColoCode_s\", \"\")),\n      ConnectTimestamp = todatetime(column_ifexists(\"ConnectTimestamp_t\", \"\")),\n      DisconnectTimestamp = todatetime(column_ifexists(\"DisconnectTimestamp_t\", \"\")),\n      IpFirewall = tobool(column_ifexists(\"IpFirewall_b\", \"\")),\n      DstPortNumber = toint(column_ifexists(\"OriginPort_d\", \"\")),\n      OriginProto = tostring(column_ifexists(\"OriginProto_s\", \"\")),\n      OriginTcpRtt = toint(column_ifexists(\"OriginTcpRtt_d\", \"\")),\n      OriginTlsCipher = tostring(column_ifexists(\"OriginTlsCipher_s\", \"\")),\n      OriginTlsFingerprint = tostring(column_ifexists(\"OriginTlsFingerprint_s\", \"\")),\n      OriginTlsMode = tostring(column_ifexists(\"OriginTlsMode_s\", \"\")),\n      OriginTlsProtocol = tostring(column_ifexists(\"OriginTlsProtocol_s\", \"\")),\n      OriginTlsStatus = tostring(column_ifexists(\"OriginTlsStatus_s\", \"\")),\n      ProxyProtocol = tostring(column_ifexists(\"ProxyProtocol_s\", \"\")),\n      EventResult = toint(column_ifexists(\"Status_d\", \"\")),\n      Timestamp = todatetime(column_ifexists(\"Timestamp_t\", \"\")),\n      ClientASNDescription = tostring(column_ifexists(\"ClientASNDescription_s\", \"\")),\n      ClientRefererHost = tostring(column_ifexists(\"ClientRefererHost_s\", \"\")),\n      ClientRefererPath = tostring(column_ifexists(\"ClientRefererPath_s\", \"\")),\n      ClientRefererQuery = tostring(column_ifexists(\"ClientRefererQuery_s\", \"\")),\n      ClientRefererScheme = tostring(column_ifexists(\"ClientRefererScheme_s\", \"\")),\n      ClientRequestQuery = tostring(column_ifexists(\"ClientRequestQuery_s\", \"\")),\n      ClientRequestScheme = tostring(column_ifexists(\"ClientRequestScheme_s\", \"\")),\n      Datetime = todatetime(column_ifexists(\"Datetime_t\", \"\")),\n      EventSubType = tostring(column_ifexists(\"Kind_s\", \"\")),\n      MatchIndex = toint(column_ifexists(\"MatchIndex_d\", \"\")),\n      OriginatorRayID = tostring(column_ifexists(\"OriginatorRayID_s\", \"\")),\n      TimeGenerated = column_ifexists('TimeGenerated', '')\n};\nlet Cloudflarev2_view = view() {\n  CloudflareV2_CL\n  | extend\n      ClientDeviceType = tostring(column_ifexists(\"ClientDeviceType\", column_ifexists(\"Source\", \"\"))),\n      TlsCipher = tostring(column_ifexists(\"ClientSSLCipher\", column_ifexists(\"ClientTlsCipher\", \"\"))),\n      TlsVersion = tostring(column_ifexists(\"ClientSSLProtocol\", column_ifexists(\"ClientTlsProtocol\", \"\"))),\n      DvcAction = tostring(column_ifexists(\"FirewallMatchesActions\", column_ifexists(\"Event\", column_ifexists(\"Action\", \"\")))),\n      NetworkRuleName = tostring(column_ifexists(\"FirewallMatchesRuleIDs\", column_ifexists(\"RuleID\", \"\"))),\n      SrcBytes = toint(column_ifexists(\"ClientRequestBytes\", column_ifexists(\"ClientBytes\", \"\"))),\n      SrcPortNumber = toint(column_ifexists(\"ClientSrcPort\", column_ifexists(\"ClientPort\", \"\"))),\n      DstBytes = toint(column_ifexists(\"EdgeResponseBytes\", column_ifexists(\"OriginBytes\", \"\"))),\n      BotScore = toint(column_ifexists(\"BotScore\", \"\")),\n      BotScoreSrc = tostring(column_ifexists(\"BotScoreSrc\", \"\")),\n      CacheCacheStatus = tostring(column_ifexists(\"CacheCacheStatus\", \"\")),\n      CacheResponseBytes = toint(column_ifexists(\"CacheResponseBytes\", \"\")),\n      CacheResponseStatus = toint(column_ifexists(\"CacheResponseStatus\", \"\")),\n      CacheTieredFill = tobool(column_ifexists(\"CacheTieredFill\", \"\")),\n      ClientASN = toint(column_ifexists(\"ClientASN\", \"\")),\n      SrcGeoCountry = tostring(column_ifexists(\"ClientCountry\", \"\")),\n      SrcIpAddr = tostring(column_ifexists(\"ClientIP\", \"\")),\n      ClientIPClass = tostring(column_ifexists(\"ClientIPClass\", \"\")),\n      HttpRequestHeaderHost = tostring(column_ifexists(\"ClientRequestHost\", \"\")),\n      HttpRequestMethod = tostring(column_ifexists(\"ClientRequestMethod\", \"\")),\n      ClientRequestPath = tostring(column_ifexists(\"ClientRequestPath\", \"\")),\n      ClientRequestProtocol = tostring(column_ifexists(\"ClientRequestProtocol\", \"\")),\n      HttpReferrerOriginal = tostring(column_ifexists(\"ClientRequestReferer\", \"\")),\n      ClientRequestURI = tostring(column_ifexists(\"ClientRequestURI\", \"\")),\n      HttpUserAgentOriginal = tostring(column_ifexists(\"ClientRequestUserAgent\", \"\")),\n      ClientXRequestedWith = tostring(column_ifexists(\"ClientXRequestedWith\", \"\")),\n      EdgeColoCode = tostring(column_ifexists(\"EdgeColoCode\", \"\")),\n      EdgeColoID = toint(column_ifexists(\"EdgeColoID\", \"\")),\n      EdgeEndTimestamp = todatetime(column_ifexists(\"EdgeEndTimestamp\", \"\")),\n      EdgePathingOp = tostring(column_ifexists(\"EdgePathingOp\", \"\")),\n      EdgePathingSrc = tostring(column_ifexists(\"EdgePathingSrc\", \"\")),\n      EdgePathingStatus = tostring(column_ifexists(\"EdgePathingStatus\", \"\")),\n      EdgeRateLimitAction = tostring(column_ifexists(\"EdgeRateLimitAction\", \"\")),\n      EdgeRateLimitID = toint(column_ifexists(\"EdgeRateLimitID\", \"\")),\n      EdgeRequestHost = tostring(column_ifexists(\"EdgeRequestHost\", \"\")),\n      EdgeResponseCompressionRatio = toint(column_ifexists(\"EdgeResponseCompressionRatio\", \"\")),\n      HttpContentType = tostring(column_ifexists(\"EdgeResponseContentType\", \"\")),\n      EdgeResponseStatus = toint(column_ifexists(\"EdgeResponseStatus\", \"\")),\n      EdgeServerIP = tostring(column_ifexists(\"EdgeServerIP\", \"\")),\n      EdgeStartTimestamp = todatetime(column_ifexists(\"EdgeStartTimestamp\", \"\")),\n      FirewallMatchesSources = tostring(column_ifexists(\"FirewallMatchesSources\", \"\")),\n      DstIpAddr = tostring(column_ifexists(\"OriginIP\", \"\")),\n      OriginResponseBytes = toint(column_ifexists(\"OriginResponseBytes\", \"\")),\n      OriginResponseHTTPExpires = tostring(column_ifexists(\"OriginResponseHTTPExpires\", \"\")),\n      OriginResponseHTTPLastModified = tostring(column_ifexists(\"OriginResponseHTTPLastModified\", \"\")),\n      HttpStatusCode = toint(column_ifexists(\"OriginResponseStatus\", \"\")),\n      OriginResponseTime = toint(column_ifexists(\"OriginResponseTime\", \"\")),\n      OriginSSLProtocol = tostring(column_ifexists(\"OriginSSLProtocol\", \"\")),\n      ParentRayID = tostring(column_ifexists(\"ParentRayID\", \"\")),\n      RayID = tostring(column_ifexists(\"RayID\", \"\")),\n      SecurityLevel = tostring(column_ifexists(\"SecurityLevel\", \"\")),\n      WAFAction = tostring(column_ifexists(\"WAFAction\", \"\")),\n      WAFFlags = tostring(column_ifexists(\"WAFFlags\", \"\")),\n      WAFMatchedVar = tostring(column_ifexists(\"WAFMatchedVar\", \"\")),\n      WAFProfile = tostring(column_ifexists(\"WAFProfile\", \"\")),\n      WAFRuleID = tostring(column_ifexists(\"WAFRuleID\", \"\")),\n      WAFRuleMessage = tostring(column_ifexists(\"WAFRuleMessage\", \"\")),\n      WorkerCPUTime = toint(column_ifexists(\"WorkerCPUTime\", \"\")),\n      WorkerStatus = tostring(column_ifexists(\"WorkerStatus\", \"\")),\n      WorkerSubrequest = tobool(column_ifexists(\"WorkerSubrequest\", \"\")),\n      WorkerSubrequestCount = toint(column_ifexists(\"WorkerSubrequestCount\", \"\")),\n      ZoneID = toint(column_ifexists(\"ZoneID\", \"\")),\n      Application = tostring(column_ifexists(\"Application\", \"\")),\n      ClientMatchedIpFirewall = tostring(column_ifexists(\"ClientMatchedIpFirewall\", \"\")),\n      NetworkProtocol = tostring(column_ifexists(\"ClientProto\", \"\")),\n      ClientTcpRtt = toint(column_ifexists(\"ClientTcpRtt\", \"\")),\n      ClientTlsClientHelloServerName = tostring(column_ifexists(\"ClientTlsClientHelloServerName\", \"\")),\n      ClientTlsStatus = tostring(column_ifexists(\"ClientTlsStatus\", \"\")),\n      ColoCode = tostring(column_ifexists(\"ColoCode\", \"\")),\n      ConnectTimestamp = todatetime(column_ifexists(\"ConnectTimestamp\", \"\")),\n      DisconnectTimestamp = todatetime(column_ifexists(\"DisconnectTimestamp\", \"\")),\n      IpFirewall = tobool(column_ifexists(\"IpFirewall\", \"\")),\n      DstPortNumber = toint(column_ifexists(\"OriginPort\", \"\")),\n      OriginProto = tostring(column_ifexists(\"OriginProto\", \"\")),\n      OriginTcpRtt = toint(column_ifexists(\"OriginTcpRtt\", \"\")),\n      OriginTlsCipher = tostring(column_ifexists(\"OriginTlsCipher\", \"\")),\n      OriginTlsFingerprint = tostring(column_ifexists(\"OriginTlsFingerprint\", \"\")),\n      OriginTlsMode = tostring(column_ifexists(\"OriginTlsMode\", \"\")),\n      OriginTlsProtocol = tostring(column_ifexists(\"OriginTlsProtocol\", \"\")),\n      OriginTlsStatus = tostring(column_ifexists(\"OriginTlsStatus\", \"\")),\n      ProxyProtocol = tostring(column_ifexists(\"ProxyProtocol\", \"\")),\n      EventResult = toint(column_ifexists(\"Status\", \"\")),\n      Timestamp = todatetime(column_ifexists(\"Timestamp\", \"\")),\n      ClientASNDescription = tostring(column_ifexists(\"ClientASNDescription\", \"\")),\n      ClientRefererHost = tostring(column_ifexists(\"ClientRefererHost\", \"\")),\n      ClientRefererPath = tostring(column_ifexists(\"ClientRefererPath\", \"\")),\n      ClientRefererQuery = tostring(column_ifexists(\"ClientRefererQuery\", \"\")),\n      ClientRefererScheme = tostring(column_ifexists(\"ClientRefererScheme\", \"\")),\n      ClientRequestQuery = tostring(column_ifexists(\"ClientRequestQuery\", \"\")),\n      ClientRequestScheme = tostring(column_ifexists(\"ClientRequestScheme\", \"\")),\n      Datetime = todatetime(column_ifexists(\"Datetime\", \"\")),\n      EventSubType = tostring(column_ifexists(\"Kind\", \"\")),\n      MatchIndex = toint(column_ifexists(\"MatchIndex\", \"\")),\n      OriginatorRayID = tostring(column_ifexists(\"OriginatorRayID\", \"\")),\n      TimeGenerated = column_ifexists('TimeGenerated', '')\n};\nunion isfuzzy=true (Cloudflare_view), (Cloudflarev2_view)\n  | project ClientDeviceType, TlsCipher, DvcAction, TlsVersion, NetworkRuleName, SrcBytes, SrcPortNumber, DstBytes, BotScore, BotScoreSrc, CacheCacheStatus, CacheResponseBytes, CacheResponseStatus, CacheTieredFill, ClientASN, SrcGeoCountry, SrcIpAddr, ClientIPClass, HttpRequestHeaderHost, HttpRequestMethod, ClientRequestPath, ClientRequestProtocol, HttpReferrerOriginal, ClientRequestURI, HttpUserAgentOriginal, ClientXRequestedWith, EdgeColoCode, EdgeColoID, EdgeEndTimestamp, EdgePathingOp, EdgePathingSrc, EdgePathingStatus, EdgeRateLimitAction, EdgeRateLimitID, EdgeRequestHost, EdgeResponseCompressionRatio, HttpContentType, EdgeResponseStatus, EdgeServerIP, EdgeStartTimestamp, FirewallMatchesSources, DstIpAddr, OriginResponseBytes, OriginResponseHTTPExpires, OriginResponseHTTPLastModified, HttpStatusCode, OriginResponseTime, OriginSSLProtocol, ParentRayID, RayID, SecurityLevel, WAFAction, WAFFlags, WAFMatchedVar, WAFProfile, WAFRuleID, WAFRuleMessage, WorkerCPUTime, WorkerStatus, WorkerSubrequest, WorkerSubrequestCount, ZoneID, Application, ClientMatchedIpFirewall, NetworkProtocol, ClientTcpRtt, ClientTlsClientHelloServerName, ClientTlsStatus, ColoCode, ConnectTimestamp, DisconnectTimestamp, IpFirewall, DstPortNumber, OriginProto, OriginTcpRtt, OriginTlsCipher, OriginTlsFingerprint, OriginTlsMode, OriginTlsProtocol, OriginTlsStatus, ProxyProtocol, EventResult, Timestamp, ClientASNDescription, ClientRefererHost, ClientRefererPath, ClientRefererQuery, ClientRefererScheme, ClientRequestQuery, ClientRequestScheme, Datetime, EventSubType, MatchIndex, OriginatorRayID, TimeGenerated\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'Cloudflare')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "Cloudflare",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cloudflare",
          "email": "support@cloudflare.com",
          "tier": "Partner",
          "link": "https://support.cloudflare.com"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Cloudflare Workbook with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Gain insights into Cloudflare events. You will get visibility on your Cloudflare web traffic, security, reliability."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"**NOTE**: This workbook depends on a parser based on a Kusto Function to work as expected [**Cloudflare**](https://aka.ms/sentinel-CloudflareDataConnector-parse) which is deployed with the Microsoft Sentinel Solution.\"},\"name\":\"text - 0\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"2088f290-65ee-4357-badb-55ce732a5004\",\"cellValue\":\"tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Cloudflare Web Traffic Overview\",\"subTarget\":\"cloudflare_web_traffic_overview\",\"style\":\"link\"},{\"id\":\"25df6ee6-dcf7-4aa2-b90e-50f8a4b6548d\",\"cellValue\":\"tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Cloudflare Security Overview\",\"subTarget\":\"cloudflare_security_overview\",\"style\":\"link\"},{\"id\":\"a2108bc6-5769-4c86-a5c0-201f531ed929\",\"cellValue\":\"tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Cloudflare Reliability Summary\",\"subTarget\":\"cloudflare_reliability_summary\",\"style\":\"link\"}]},\"name\":\"links - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"c64d5d3d-90c6-484a-ab88-c70652b75b6e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":172800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL\\n| summarize count() by ClientDeviceType_s\",\"size\":0,\"title\":\"Traffic Type\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_web_traffic_overview\"},\"customWidth\":\"25\",\"name\":\"Traffic Type\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL\\n| summarize count() by ClientRequestProtocol_s\",\"size\":0,\"title\":\"HTTP Protocols\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_web_traffic_overview\"},\"customWidth\":\"25\",\"name\":\"HTTP Protocols\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL\\n| summarize count() by ClientRequestMethod_s\",\"size\":0,\"title\":\"Request Methods\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_web_traffic_overview\"},\"customWidth\":\"25\",\"name\":\"Request Methods\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL\\n| extend EdgeResponseContentType = iif(isempty(EdgeResponseContentType_s),\\\"empty\\\",EdgeResponseContentType_s )\\n| summarize count() by EdgeResponseContentType\",\"size\":0,\"title\":\"Content Types\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_web_traffic_overview\"},\"customWidth\":\"25\",\"name\":\"Content Types\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL\\n| summarize Count=count() by ClientRequestURI_s\\n| sort by Count | project-rename ClientRequestURI=ClientRequestURI_s | take 50\",\"size\":0,\"title\":\"Top Requested URIs\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_web_traffic_overview\"},\"customWidth\":\"25\",\"name\":\"Top Requested URIs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL\\n| summarize Count=count() by ClientIP_s\\n| sort by Count | take 50 | project-rename  ClientIP=ClientIP_s\",\"size\":0,\"title\":\"Top Traffic IPs\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_web_traffic_overview\"},\"customWidth\":\"25\",\"name\":\"Top Traffic IPs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL\\n| extend ClientRequestReferer = iif(isempty(ClientRequestReferer_s),\\\"empty\\\",ClientRequestReferer_s )\\n| summarize Count=count() by ClientRequestReferer\\n| sort by Count | take 50\\n\",\"size\":0,\"title\":\"Top Referer\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_web_traffic_overview\"},\"customWidth\":\"25\",\"name\":\"Top Referer\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL\\n| summarize Count=count() by ClientIPClass_s | project-rename ClientIPClass=ClientIPClass_s\\n| sort by Count | take 50\\n\",\"size\":0,\"title\":\"Top Traffic Types\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_web_traffic_overview\"},\"customWidth\":\"25\",\"name\":\"Top Traffic Types\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL\\n| summarize Count=count() by ClientRequestUserAgent_s | project-rename ClientRequestUserAgent=ClientRequestUserAgent_s\\n| sort by Count | take 50\",\"size\":0,\"title\":\"Top User Agents\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ClientRequestUserAgent\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"75%\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_web_traffic_overview\"},\"name\":\"Top User Agents\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let total_number_of_requests =\\nCloudflare_CL\\n| summarize Count=count()\\n| extend title=\\\"Total Number Of Requests\\\";\\n\\nlet threats_stopped =\\nCloudflare_CL \\n| extend threat=case(EdgePathingSrc_s ==\\\"user\\\" and EdgePathingOp_s == \\\"ban\\\" and EdgePathingStatus_s has \\\"ip\\\" ,\\\"IP Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\",\\\"Country Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"zl\\\", \\\"Routed by Zone Lockdown\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ua\\\", \\\"Blocked User Agent\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"rateLimit\\\", \\\"Blocked by Rate Limiting\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Blocked by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"chl\\\", \\\"Challenged by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"bic\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Browser Integrity Check\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ip\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaErr\\\", \\\"CAPTCHA Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaFail\\\", \\\"CAPTCHA Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaNew\\\", \\\"New CAPTCHA\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlErr\\\", \\\"Java Script Challenge Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlFail\\\", \\\"Java Script Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlNew\\\", \\\"New Java Script Challenge\\\", EdgePathingSrc_s==\\\"protect\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"17ddos\\\", \\\"L7 DDos Mitigation\\\",\\\"\\\")\\n| where isnotempty(threat) | summarize Count=count()\\n| extend title=\\\"Stopped Threats\\\";\\n\\nlet result_table = union total_number_of_requests, threats_stopped; \\nresult_table \\n| sort by Count\\n\\n\",\"size\":0,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2,\"size\":\"auto\"}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_security_overview\"},\"customWidth\":\"33\",\"name\":\"Req_Threats_title\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend threat=case(EdgePathingSrc_s ==\\\"user\\\" and EdgePathingOp_s == \\\"ban\\\" and EdgePathingStatus_s has \\\"ip\\\" ,\\\"IP Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\",\\\"Country Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"zl\\\", \\\"Routed by Zone Lockdown\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ua\\\", \\\"Blocked User Agent\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"rateLimit\\\", \\\"Blocked by Rate Limiting\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Blocked by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"chl\\\", \\\"Challenged by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"bic\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Browser Integrity Check\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ip\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaErr\\\", \\\"CAPTCHA Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaFail\\\", \\\"CAPTCHA Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaNew\\\", \\\"New CAPTCHA\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlErr\\\", \\\"Java Script Challenge Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlFail\\\", \\\"Java Script Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlNew\\\", \\\"New Java Script Challenge\\\", EdgePathingSrc_s==\\\"protect\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"17ddos\\\", \\\"L7 DDos Mitigation\\\",\\\"\\\")\\n| where isnotempty(threat)\\n| summarize Count=count() by threat\",\"size\":0,\"title\":\"Top Threats\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2,\"size\":\"auto\"}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_security_overview\"},\"customWidth\":\"33\",\"name\":\"Top Threats\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let total_number_of_requests =\\nCloudflare_CL\\n| summarize Count=count()\\n| extend title=\\\"Total Number Of Requests\\\";\\n\\nlet threats_stopped =\\nCloudflare_CL \\n| extend threat=case(EdgePathingSrc_s ==\\\"user\\\" and EdgePathingOp_s == \\\"ban\\\" and EdgePathingStatus_s has \\\"ip\\\" ,\\\"IP Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\",\\\"Country Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"zl\\\", \\\"Routed by Zone Lockdown\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ua\\\", \\\"Blocked User Agent\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"rateLimit\\\", \\\"Blocked by Rate Limiting\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Blocked by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"chl\\\", \\\"Challenged by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"bic\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Browser Integrity Check\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ip\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaErr\\\", \\\"CAPTCHA Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaFail\\\", \\\"CAPTCHA Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaNew\\\", \\\"New CAPTCHA\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlErr\\\", \\\"Java Script Challenge Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlFail\\\", \\\"Java Script Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlNew\\\", \\\"New Java Script Challenge\\\", EdgePathingSrc_s==\\\"protect\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"17ddos\\\", \\\"L7 DDos Mitigation\\\",\\\"\\\")\\n| where isnotempty(threat) | summarize Count=count()\\n| extend title=\\\"Stopped Threats\\\";\\n\\nlet result_table = union total_number_of_requests, threats_stopped; \\nresult_table \\n| sort by Count\\n\\n\",\"size\":0,\"title\":\"Requests vs Threats\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2,\"size\":\"auto\"}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_security_overview\"},\"customWidth\":\"33\",\"name\":\"Requests vs Threats\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend threat=case(EdgePathingSrc_s ==\\\"user\\\" and EdgePathingOp_s == \\\"ban\\\" and EdgePathingStatus_s has \\\"ip\\\" ,\\\"IP Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\",\\\"Country Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"zl\\\", \\\"Routed by Zone Lockdown\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ua\\\", \\\"Blocked User Agent\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"rateLimit\\\", \\\"Blocked by Rate Limiting\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Blocked by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"chl\\\", \\\"Challenged by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"bic\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Browser Integrity Check\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ip\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaErr\\\", \\\"CAPTCHA Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaFail\\\", \\\"CAPTCHA Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaNew\\\", \\\"New CAPTCHA\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlErr\\\", \\\"Java Script Challenge Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlFail\\\", \\\"Java Script Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlNew\\\", \\\"New Java Script Challenge\\\", EdgePathingSrc_s==\\\"protect\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"17ddos\\\", \\\"L7 DDos Mitigation\\\",\\\"\\\")\\n| where isnotempty(threat)\\n| make-series Trend = count() on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain};\",\"size\":0,\"title\":\"Threats Over Time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2,\"size\":\"auto\"}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_security_overview\"},\"customWidth\":\"33\",\"name\":\"Threats Over Time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend threat=case(EdgePathingSrc_s ==\\\"user\\\" and EdgePathingOp_s == \\\"ban\\\" and EdgePathingStatus_s has \\\"ip\\\" ,\\\"IP Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\",\\\"Country Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"zl\\\", \\\"Routed by Zone Lockdown\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ua\\\", \\\"Blocked User Agent\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"rateLimit\\\", \\\"Blocked by Rate Limiting\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Blocked by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"chl\\\", \\\"Challenged by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"bic\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Browser Integrity Check\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ip\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaErr\\\", \\\"CAPTCHA Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaFail\\\", \\\"CAPTCHA Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaNew\\\", \\\"New CAPTCHA\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlErr\\\", \\\"Java Script Challenge Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlFail\\\", \\\"Java Script Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlNew\\\", \\\"New Java Script Challenge\\\", EdgePathingSrc_s==\\\"protect\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"17ddos\\\", \\\"L7 DDos Mitigation\\\",\\\"\\\")\\n| where isnotempty(threat)\\n| summarize count() by ClientCountry_s | project-rename Country=ClientCountry_s | take 20\",\"size\":0,\"title\":\"Top Threat Countries\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2,\"size\":\"auto\"}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_security_overview\"},\"customWidth\":\"33\",\"name\":\"Top Threat Countries\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend threat=case(EdgePathingSrc_s ==\\\"user\\\" and EdgePathingOp_s == \\\"ban\\\" and EdgePathingStatus_s has \\\"ip\\\" ,\\\"IP Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\",\\\"Country Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"zl\\\", \\\"Routed by Zone Lockdown\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ua\\\", \\\"Blocked User Agent\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"rateLimit\\\", \\\"Blocked by Rate Limiting\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Blocked by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"chl\\\", \\\"Challenged by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"bic\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Browser Integrity Check\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ip\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaErr\\\", \\\"CAPTCHA Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaFail\\\", \\\"CAPTCHA Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaNew\\\", \\\"New CAPTCHA\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlErr\\\", \\\"Java Script Challenge Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlFail\\\", \\\"Java Script Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlNew\\\", \\\"New Java Script Challenge\\\", EdgePathingSrc_s==\\\"protect\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"17ddos\\\", \\\"L7 DDos Mitigation\\\",\\\"\\\")\\n| where isnotempty(threat)\\n| summarize count() by ClientIP_s | project-rename ClientIP=ClientIP_s\",\"size\":0,\"title\":\"Top Threat Client IPs\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2,\"size\":\"auto\"}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_security_overview\"},\"customWidth\":\"33\",\"name\":\"Top Threat Client IPs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend threat=case(EdgePathingSrc_s ==\\\"user\\\" and EdgePathingOp_s == \\\"ban\\\" and EdgePathingStatus_s has \\\"ip\\\" ,\\\"IP Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\",\\\"Country Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"zl\\\", \\\"Routed by Zone Lockdown\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ua\\\", \\\"Blocked User Agent\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"rateLimit\\\", \\\"Blocked by Rate Limiting\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Blocked by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"chl\\\", \\\"Challenged by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"bic\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Browser Integrity Check\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ip\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaErr\\\", \\\"CAPTCHA Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaFail\\\", \\\"CAPTCHA Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaNew\\\", \\\"New CAPTCHA\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlErr\\\", \\\"Java Script Challenge Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlFail\\\", \\\"Java Script Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlNew\\\", \\\"New Java Script Challenge\\\", EdgePathingSrc_s==\\\"protect\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"17ddos\\\", \\\"L7 DDos Mitigation\\\",\\\"\\\")\\n| where isnotempty(threat)\\n| summarize Count=count() by ClientRequestURI_s | project-rename ClientRequestURI=ClientRequestURI_s\",\"size\":0,\"title\":\"Top Threat URIs\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2,\"size\":\"auto\"}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_security_overview\"},\"customWidth\":\"33\",\"name\":\"Top Threat URIs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend threat=case(EdgePathingSrc_s ==\\\"user\\\" and EdgePathingOp_s == \\\"ban\\\" and EdgePathingStatus_s has \\\"ip\\\" ,\\\"IP Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\",\\\"Country Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"zl\\\", \\\"Routed by Zone Lockdown\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ua\\\", \\\"Blocked User Agent\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"rateLimit\\\", \\\"Blocked by Rate Limiting\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Blocked by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"chl\\\", \\\"Challenged by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"bic\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Browser Integrity Check\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ip\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaErr\\\", \\\"CAPTCHA Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaFail\\\", \\\"CAPTCHA Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaNew\\\", \\\"New CAPTCHA\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlErr\\\", \\\"Java Script Challenge Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlFail\\\", \\\"Java Script Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlNew\\\", \\\"New Java Script Challenge\\\", EdgePathingSrc_s==\\\"protect\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"17ddos\\\", \\\"L7 DDos Mitigation\\\",\\\"\\\")\\n| where isnotempty(threat)\\n| summarize Count=count() by ClientRequestUserAgent_s | project-rename ClientRequestUserAgent=ClientRequestUserAgent_s\",\"size\":0,\"title\":\"Top Threat User Agents\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2,\"size\":\"auto\"}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_security_overview\"},\"customWidth\":\"33\",\"name\":\"Top Threat User Agents\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend threat=case(EdgePathingSrc_s ==\\\"user\\\" and EdgePathingOp_s == \\\"ban\\\" and EdgePathingStatus_s has \\\"ip\\\" ,\\\"IP Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\",\\\"Country Block\\\",EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"zl\\\", \\\"Routed by Zone Lockdown\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ua\\\", \\\"Blocked User Agent\\\", EdgePathingSrc_s==\\\"user\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"rateLimit\\\", \\\"Blocked by Rate Limiting\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Blocked by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"filterBasedFirewall\\\" and EdgePathingOp_s==\\\"chl\\\", \\\"Challenged by Filter Based Firewall\\\", EdgePathingSrc_s==\\\"bic\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"unknown\\\", \\\"Browser Integrity Check\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ctry\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"hot\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"ip\\\", \\\"Blocked Hotlink\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaErr\\\", \\\"CAPTCHA Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaFail\\\", \\\"CAPTCHA Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"captchaNew\\\", \\\"New CAPTCHA\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlErr\\\", \\\"Java Script Challenge Error\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlFail\\\", \\\"Java Script Challenge Failed\\\", EdgePathingSrc_s==\\\"macro\\\" and EdgePathingOp_s==\\\"chl\\\" and EdgePathingStatus_s==\\\"jschlNew\\\", \\\"New Java Script Challenge\\\", EdgePathingSrc_s==\\\"protect\\\" and EdgePathingOp_s==\\\"ban\\\" and EdgePathingStatus_s==\\\"17ddos\\\", \\\"L7 DDos Mitigation\\\",\\\"\\\")\\n| where isnotempty(threat)\\n| summarize Count=count() by EdgePathingStatus_s | project-rename EdgePathingStatus=EdgePathingStatus_s\",\"size\":0,\"title\":\"Top Threat User Agents\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2,\"size\":\"auto\"}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_security_overview\"},\"customWidth\":\"33\",\"name\":\"Top Threat User Agents - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let 5xx = Cloudflare_CL \\n| where tostring(EdgeResponseStatus_d) startswith \\\"5\\\"\\n| summarize Count=count()\\n| extend title=\\\"5xx Errors (Edge)\\\";\\n\\nlet 4xx = Cloudflare_CL \\n| where tostring(EdgeResponseStatus_d) startswith \\\"4\\\"\\n| summarize Count=count()\\n| extend title=\\\"4xx Errors (Edge)\\\";\\n\\nlet 3xx = Cloudflare_CL \\n| where tostring(EdgeResponseStatus_d) startswith \\\"3\\\"\\n| summarize Count=count()\\n| extend title=\\\"3xx Errors (Edge)\\\";\\n\\nlet result_table = union 5xx, 4xx, 3xx; \\nresult_table \\n| sort by Count\\n\\n\",\"size\":0,\"title\":\"ERRORS Counts (Edge)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_reliability_summary\"},\"customWidth\":\"33\",\"name\":\"Errors (Edge)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend response_error_type= case(tostring(EdgeResponseStatus_d) startswith \\\"2\\\" , \\\"2xx\\\", tostring(EdgeResponseStatus_d) startswith \\\"3\\\" , \\\"3xx\\\", tostring(EdgeResponseStatus_d) startswith \\\"4\\\" , \\\"4xx\\\", tostring(EdgeResponseStatus_d) startswith \\\"5\\\" , \\\"5xx\\\",\\\"\\\")\\n| where isnotempty(response_error_type)\\n| summarize Count=count() by response_error_type\",\"size\":0,\"title\":\"Edge Response Error Ratio\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_reliability_summary\"},\"customWidth\":\"33\",\"name\":\"Edge Response Error Ratio\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend response_error_type= case(tostring(OriginResponseStatus_d) startswith \\\"2\\\" , \\\"2xx\\\", tostring(OriginResponseStatus_d) startswith \\\"3\\\" , \\\"3xx\\\", tostring(OriginResponseStatus_d) startswith \\\"4\\\" , \\\"4xx\\\", tostring(OriginResponseStatus_d) startswith \\\"5\\\" , \\\"5xx\\\",\\\"\\\")\\n| where isnotempty(response_error_type)\\n| summarize Count=count() by response_error_type\",\"size\":0,\"title\":\"Origin Response Error Ratio\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_reliability_summary\"},\"customWidth\":\"33\",\"name\":\"Origin Response Error Ratio\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend response_error_type= case(tostring(EdgeResponseStatus_d) startswith \\\"2\\\" , \\\"2xx\\\", tostring(EdgeResponseStatus_d) startswith \\\"3\\\" , \\\"3xx\\\", tostring(EdgeResponseStatus_d) startswith \\\"4\\\" , \\\"4xx\\\", tostring(EdgeResponseStatus_d) startswith \\\"5\\\" , \\\"5xx\\\",\\\"\\\")\\n| where isnotempty(response_error_type)\\n| make-series Trend = count() on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by response_error_type;\",\"size\":0,\"title\":\"Edge Response Status Over Time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_reliability_summary\"},\"customWidth\":\"50\",\"name\":\"Edge Response Status Over Time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Cloudflare_CL \\n| extend response_error_type= case(tostring(OriginResponseStatus_d) startswith \\\"2\\\" , \\\"2xx\\\", tostring(OriginResponseStatus_d) startswith \\\"3\\\" , \\\"3xx\\\", tostring(OriginResponseStatus_d) startswith \\\"4\\\" , \\\"4xx\\\", tostring(OriginResponseStatus_d) startswith \\\"5\\\" , \\\"5xx\\\",\\\"\\\")\\n| where isnotempty(response_error_type)\\n| make-series Trend = count() on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by response_error_type;\",\"size\":0,\"title\":\"Origin Response Status Over Time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"cloudflare_reliability_summary\"},\"customWidth\":\"50\",\"name\":\"Origin Response Status Over Time\"}],\"fromTemplateId\":\"sentinel-CloudflareWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=CloudflareWorkbook; logoFileName=cloudflare.svg; description=Gain insights into Cloudflare events. You will get visibility on your Cloudflare web traffic, security, reliability.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=Cloudflare; templateRelativePath=Cloudflare.json; subtitle=; provider=Cloudflare}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "Cloudflare_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "CloudflareDataConnector",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject1').huntingQueryTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareClientErrors_HuntingQueries Hunting Query with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject1').huntingQueryVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cloudflare_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare - Client errors",
                "category": "Hunting Queries",
                "query": "Cloudflare\n| where TimeGenerated > ago(24h)\n| where HttpStatusCode between(400..499)\n| extend IPCustomEntity = SrcIpAddr\n| extend UrlCustomEntity = ClientRequestURI\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for client related errors."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133,T1498"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1),'/'))))]",
              "properties": {
                "description": "Cloudflare Hunting Query 1",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1)]",
                "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject1').huntingQueryVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
        "contentKind": "HuntingQuery",
        "displayName": "Cloudflare - Client errors",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject2').huntingQueryTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareClientTlsErrors_HuntingQueries Hunting Query with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject2').huntingQueryVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cloudflare_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare - Client TLS errors",
                "category": "Hunting Queries",
                "query": "let err_tls = dynamic(['UNKNOWN', 'INTERNAL_ERROR', 'INVALID_CONFIG', 'INVALID_SNI', 'HANDSHAKE_FAILED']);\nCloudflare\n| where TimeGenerated > ago(24h)\n| where ClientTlsStatus in~ (err_tls)\n| extend IPCustomEntity = SrcIpAddr\n| extend UrlCustomEntity = ClientRequestURI\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for client TLS errors."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133,T1498"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2),'/'))))]",
              "properties": {
                "description": "Cloudflare Hunting Query 2",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject2')._huntingQuerycontentId2)]",
                "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject2').huntingQueryVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
        "contentKind": "HuntingQuery",
        "displayName": "Cloudflare - Client TLS errors",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject2')._huntingQuerycontentId2,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject3').huntingQueryTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareFilesRequested_HuntingQueries Hunting Query with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject3').huntingQueryVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cloudflare_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare - Files requested",
                "category": "Hunting Queries",
                "query": "Cloudflare\n| where TimeGenerated > ago(24h)\n| extend File = extract(@'\\/(\\w+\\.\\w+)', 1, ClientRequestURI)\n| summarize count() by File, SrcIpAddr\n| extend IPCustomEntity = SrcIpAddr\n| extend FileCustomEntity = File\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for files requested."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3),'/'))))]",
              "properties": {
                "description": "Cloudflare Hunting Query 3",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject3')._huntingQuerycontentId3)]",
                "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject3').huntingQueryVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
        "contentKind": "HuntingQuery",
        "displayName": "Cloudflare - Files requested",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject3')._huntingQuerycontentId3,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject4').huntingQueryTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareRareUAs_HuntingQueries Hunting Query with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject4').huntingQueryVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cloudflare_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare - Rare user agents",
                "category": "Hunting Queries",
                "query": "Cloudflare\n| where TimeGenerated > ago(24h)\n| where isnotempty(HttpUserAgentOriginal)\n| summarize count() by HttpUserAgentOriginal, SrcIpAddr\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches rare user agent strings."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4),'/'))))]",
              "properties": {
                "description": "Cloudflare Hunting Query 4",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject4')._huntingQuerycontentId4)]",
                "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject4').huntingQueryVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
        "contentKind": "HuntingQuery",
        "displayName": "Cloudflare - Rare user agents",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject4')._huntingQuerycontentId4,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject5').huntingQueryTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareServerErrors_HuntingQueries Hunting Query with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject5').huntingQueryVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cloudflare_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare - Server errors",
                "category": "Hunting Queries",
                "query": "Cloudflare\n| where TimeGenerated > ago(24h)\n| where HttpStatusCode between(500..599)\n| extend IPCustomEntity = SrcIpAddr\n| extend UrlCustomEntity = ClientRequestURI\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for server related errors."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133,T1498"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5),'/'))))]",
              "properties": {
                "description": "Cloudflare Hunting Query 5",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject5')._huntingQuerycontentId5)]",
                "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject5').huntingQueryVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
        "contentKind": "HuntingQuery",
        "displayName": "Cloudflare - Server errors",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject5')._huntingQuerycontentId5,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject6').huntingQueryTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareServerTlsErrors_HuntingQueries Hunting Query with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject6').huntingQueryVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cloudflare_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare - Server TLS errors",
                "category": "Hunting Queries",
                "query": "let err_tls = dynamic(['UNKNOWN', 'INTERNAL_ERROR', 'INVALID_CONFIG', 'INVALID_SNI', 'HANDSHAKE_FAILED']);\nCloudflare\n| where TimeGenerated > ago(24h)\n| where OriginTlsStatus in~ (err_tls)\n| extend IPCustomEntity = SrcIpAddr\n| extend UrlCustomEntity = ClientRequestURI\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for server TLS errors."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133,T1498"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6),'/'))))]",
              "properties": {
                "description": "Cloudflare Hunting Query 6",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject6')._huntingQuerycontentId6)]",
                "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject6').huntingQueryVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
        "contentKind": "HuntingQuery",
        "displayName": "Cloudflare - Server TLS errors",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject6')._huntingQuerycontentId6,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject7').huntingQueryTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareTopNetworkRules_HuntingQueries Hunting Query with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject7').huntingQueryVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cloudflare_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare - Top Network rules",
                "category": "Hunting Queries",
                "query": "Cloudflare\n| where TimeGenerated > ago(24h)\n| where isnotempty(NetworkRuleName)\n| summarize count() by NetworkRuleName, EdgeRequestHost\n| order by count_\n| extend CloudAppCustomEntity = EdgeRequestHost\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches top network rules triggered."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7),'/'))))]",
              "properties": {
                "description": "Cloudflare Hunting Query 7",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject7')._huntingQuerycontentId7)]",
                "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject7').huntingQueryVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
        "contentKind": "HuntingQuery",
        "displayName": "Cloudflare - Top Network rules",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject7')._huntingQuerycontentId7,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject8').huntingQueryTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareTopWafRules_HuntingQueries Hunting Query with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject8').huntingQueryVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cloudflare_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare - Top WAF rules",
                "category": "Hunting Queries",
                "query": "Cloudflare\n| where TimeGenerated > ago(24h)\n| where isnotempty(WAFRuleID)\n| summarize count() by WAFRuleID, WAFRuleMessage, EdgeRequestHost\n| order by count_\n| extend CloudAppCustomEntity = EdgeRequestHost\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches top WAF rules triggered."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8),'/'))))]",
              "properties": {
                "description": "Cloudflare Hunting Query 8",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject8')._huntingQuerycontentId8)]",
                "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject8').huntingQueryVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
        "contentKind": "HuntingQuery",
        "displayName": "Cloudflare - Top WAF rules",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject8')._huntingQuerycontentId8,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject9').huntingQueryTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareUnexpectedCountries_HuntingQueries Hunting Query with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject9').huntingQueryVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cloudflare_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare - Unexpected countries",
                "category": "Hunting Queries",
                "query": "Cloudflare\n| where TimeGenerated > ago(24h)\n| summarize count() by SrcGeoCountry, SrcIpAddr\n| extend IPCustomEntity = SrcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches requests by country and helps to identify requests coming from unexpected countries."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9),'/'))))]",
              "properties": {
                "description": "Cloudflare Hunting Query 9",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject9')._huntingQuerycontentId9)]",
                "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject9').huntingQueryVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
        "contentKind": "HuntingQuery",
        "displayName": "Cloudflare - Unexpected countries",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject9')._huntingQuerycontentId9,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject10').huntingQueryTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareUnexpectedEdgeResponse_HuntingQueries Hunting Query with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject10').huntingQueryVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Cloudflare_Hunting_Query_10",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Cloudflare - Unexpected edge response",
                "category": "Hunting Queries",
                "query": "Cloudflare\n| where TimeGenerated > ago(24h)\n| where HttpStatusCode != EdgeResponseStatus\n| extend IPCustomEntity = SrcIpAddr\n| extend UrlCustomEntity = ClientRequestURI\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for unexpected EdgeResponseStatus values."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1190,T1133"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject10')._huntingQuerycontentId10),'/'))))]",
              "properties": {
                "description": "Cloudflare Hunting Query 10",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject10')._huntingQuerycontentId10)]",
                "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject10').huntingQueryVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
        "contentKind": "HuntingQuery",
        "displayName": "Cloudflare - Unexpected edge response",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject10')._huntingQuerycontentId10,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject10')._huntingQuerycontentId10,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareBadClientIp_AnalyticalRules Analytics Rule with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects requests from IP with bad reputation index.",
                "displayName": "Cloudflare - Bad client IP",
                "enabled": false,
                "query": "let ip_reputation = dynamic(['unknown', 'badHost', 'greylist', 'securityScanner', 'scan', 'tor']);\nCloudflare\n| where ClientIPClass in~ (ip_reputation)\n| extend IPCustomEntity = SrcIpAddr\n| extend UrlCustomEntity = ClientRequestURI\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CloudflareDataConnector",
                    "dataTypes": [
                      "Cloudflare"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "UrlCustomEntity"
                      }
                    ],
                    "entityType": "URL"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "Cloudflare Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cloudflare - Bad client IP",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareEmptyUA_AnalyticalRules Analytics Rule with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects requests where user agent is empty.",
                "displayName": "Cloudflare - Empty user agent",
                "enabled": false,
                "query": "Cloudflare\n| where isempty(HttpUserAgentOriginal)\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CloudflareDataConnector",
                    "dataTypes": [
                      "Cloudflare"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "Cloudflare Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cloudflare - Empty user agent",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareMultipleErrorsSource_AnalyticalRules Analytics Rule with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects multiple failure requests from single source in short timeframe.",
                "displayName": "Cloudflare - Multiple error requests from single source",
                "enabled": false,
                "query": "let threshold = 100;\nCloudflare\n| where HttpRequestMethod =~ 'GET'\n| summarize err_cnt = count() by SrcIpAddr, bin(TimeGenerated, 5m)\n| where err_cnt > threshold\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CloudflareDataConnector",
                    "dataTypes": [
                      "Cloudflare"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "Cloudflare Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cloudflare - Multiple error requests from single source",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareMultipleUAs_AnalyticalRules Analytics Rule with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects requests with different user agents from one source in short timeframe.",
                "displayName": "Cloudflare - Multiple user agents for single source",
                "enabled": false,
                "query": "let threshold = 10;\nCloudflare\n| where isnotempty(HttpUserAgentOriginal)\n| summarize d_ua = dcount(HttpUserAgentOriginal) by SrcIpAddr, bin(TimeGenerated, 3m)\n| where d_ua > threshold\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CloudflareDataConnector",
                    "dataTypes": [
                      "Cloudflare"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "Cloudflare Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cloudflare - Multiple user agents for single source",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareUnexpectedCountry_AnalyticalRules Analytics Rule with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects requests from countries which are in blocklist.",
                "displayName": "Cloudflare - Client request from country in blocklist",
                "enabled": false,
                "query": "let bl_countries = dynamic(['cn', 'hk']);\nCloudflare\n| where SrcGeoCountry in~ (bl_countries)\n| extend IPCustomEntity = SrcIpAddr\n| extend UrlCustomEntity = ClientRequestURI\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CloudflareDataConnector",
                    "dataTypes": [
                      "Cloudflare"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "UrlCustomEntity"
                      }
                    ],
                    "entityType": "URL"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "Cloudflare Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cloudflare - Client request from country in blocklist",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareUnexpectedPost_AnalyticalRules Analytics Rule with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects post requests to unusual extensions.",
                "displayName": "Cloudflare - Unexpected POST requests",
                "enabled": false,
                "query": "Cloudflare\n| where HttpRequestMethod in~ ('POST', 'PUT')\n| where tostring(HttpStatusCode) startswith '2'\n| where DstBytes != 0 or SrcBytes != 0\n| extend fe = extract(@'.*(\\.\\w+)$', 1, ClientRequestURI)\n| where fe in~ ('.jpg', '.jpeg', '.gif', '.png', '.icon', '.ico', '.xml', '.swf', '.svg', '.ppt', '.pttx', '.doc', '.docx', '.rtf', '.pdf', '.tif', '.zip', '.mov')\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CloudflareDataConnector",
                    "dataTypes": [
                      "Cloudflare"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence",
                  "CommandAndControl"
                ],
                "techniques": [
                  "T1505",
                  "T1071"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "Cloudflare Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cloudflare - Unexpected POST requests",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject7').analyticRuleTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareUnexpectedRequest_AnalyticalRules Analytics Rule with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject7').analyticRuleVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects client requests to unusual client request.",
                "displayName": "Cloudflare - Unexpected client request",
                "enabled": false,
                "query": "Cloudflare\n| where HttpRequestMethod =~ 'GET'\n| where DstBytes != 0 or SrcBytes != 0\n| where ClientRequestURI has_any ('/admin', '/admin.php', 'wp-admin', '.htaccess', '/etc/shadow', '/etc/passwd', '/etc/hosts', '/etc/ssh/') \n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CloudflareDataConnector",
                    "dataTypes": [
                      "Cloudflare"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject7').analyticRuleId7,'/'))))]",
              "properties": {
                "description": "Cloudflare Analytics Rule 7",
                "parentId": "[variables('analyticRuleObject7').analyticRuleId7]",
                "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject7').analyticRuleVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cloudflare - Unexpected client request",
        "contentProductId": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "id": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject8').analyticRuleTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareUnexpectedUrl_AnalyticalRules Analytics Rule with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject8').analyticRuleVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects client requests to unusual URI.",
                "displayName": "Cloudflare - Unexpected URI",
                "enabled": false,
                "query": "Cloudflare\n| where HttpRequestMethod =~ 'GET'\n| where DstBytes != 0 or SrcBytes != 0\n| where ClientRequestURI matches regex @'(127\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})|(10\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})|(172\\.1[6-9]\\.\\d{1,3}\\.\\d{1,3})|(172\\.2[0-9]\\.\\d{1,3}\\.\\d{1,3})|(172\\.3[0-1]\\.\\d{1,3}\\.\\d{1,3})|(192\\.168\\.\\d{1,3}\\.\\d{1,3})'\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CloudflareDataConnector",
                    "dataTypes": [
                      "Cloudflare"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject8').analyticRuleId8,'/'))))]",
              "properties": {
                "description": "Cloudflare Analytics Rule 8",
                "parentId": "[variables('analyticRuleObject8').analyticRuleId8]",
                "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject8').analyticRuleVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cloudflare - Unexpected URI",
        "contentProductId": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "id": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject9').analyticRuleTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareWafThreatAllowed_AnalyticalRules Analytics Rule with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject9').analyticRuleVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects WAF \"Allowed\" action on threat events.",
                "displayName": "Cloudflare - WAF Allowed threat",
                "enabled": false,
                "query": "Cloudflare\n| where isnotempty(WAFRuleID) or isnotempty(WAFRuleMessage)\n| where WAFAction =~ 'Allow'\n| extend IPCustomEntity = SrcIpAddr\n| extend UrlCustomEntity = ClientRequestURI\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CloudflareDataConnector",
                    "dataTypes": [
                      "Cloudflare"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "UrlCustomEntity"
                      }
                    ],
                    "entityType": "URL"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject9').analyticRuleId9,'/'))))]",
              "properties": {
                "description": "Cloudflare Analytics Rule 9",
                "parentId": "[variables('analyticRuleObject9').analyticRuleId9]",
                "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject9').analyticRuleVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cloudflare - WAF Allowed threat",
        "contentProductId": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "id": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject10').analyticRuleTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CloudflareXSSProbingPattern_AnalyticalRules Analytics Rule with template version 3.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject10').analyticRuleVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects XSS probing patterns.",
                "displayName": "Cloudflare - XSS probing pattern in request",
                "enabled": false,
                "query": "let s_threshold = 3;\nCloudflare\n| where HttpRequestMethod in~ ('POST', 'PUT')\n| extend susp_ch = countof(ClientRequestURI, '%00')\n| where ClientRequestURI matches regex @'(alert\\()|(alert\\%28)|(String\\.fromCharCode\\()|(expression\\(alert)' or susp_ch > s_threshold\n| extend IPCustomEntity = SrcIpAddr\n| extend UrlCustomEntity = ClientRequestURI\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CloudflareDataConnector",
                    "dataTypes": [
                      "Cloudflare"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1190",
                  "T1133"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "UrlCustomEntity"
                      }
                    ],
                    "entityType": "URL"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject10').analyticRuleId10,'/'))))]",
              "properties": {
                "description": "Cloudflare Analytics Rule 10",
                "parentId": "[variables('analyticRuleObject10').analyticRuleId10]",
                "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject10').analyticRuleVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "Cloudflare",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cloudflare",
                  "email": "support@cloudflare.com",
                  "tier": "Partner",
                  "link": "https://support.cloudflare.com"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
        "contentKind": "AnalyticsRule",
        "displayName": "Cloudflare - XSS probing pattern in request",
        "contentProductId": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "id": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.2",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Cloudflare",
        "publisherDisplayName": "Cloudflare",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Cloudflare/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.cloudflare.com/\">Cloudflare</a> solution provides the capability to ingest <a href=\"https://developers.cloudflare.com/logs/\">Cloudflare logs</a> into Microsoft Sentinel using the Cloudflare Logpush and Azure Blob Storage. Refer to <a href=\"https://developers.cloudflare.com/logs/about/\">Cloudflare documentation</a> for more information.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ol type=\"a\">\n<li><a href=\"https://docs.microsoft.com/azure/azure-monitor/logs/data-collector-api\">Azure Monitor HTTP Data Collector API</a></li>\n</ol>\n<p>b.<a href=\"https://azure.microsoft.com/services/functions/#overview\">Azure Functions</a></p>\n<ol type=\"a\" start=\"3\">\n<li><a href=\"https://learn.microsoft.com/en-us/azure/sentinel/create-codeless-connector\">Codeless Connector Framework</a></li>\n</ol>\n<p><span style='color:red; font-weight:bold;'>NOTE</span>: Microsoft recommends installation of \"CloudflareDefinition\" (via Codeless Connector Framework). This connector is build on the Codeless Connector Framework (CCF), which uses the Log Ingestion API, which replaces ingestion via the <a href='https://aka.ms/Sentinel-Logs_migration' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>. CCF-based data connectors also support <a href='https://aka.ms/Sentinel-DCR_Overview' style='color:#1890F1;'>Data Collection Rules</a> (DCRs) offering transformations and enrichment.</p>\n<p><span style='color:red; font-weight:bold;'>Important</span>: While the updated connector(s) can coexist with their legacy versions, running them together will result in duplicated data ingestion. You can disable the older versions of these connectors to avoid duplication of data..</p>\n<p><strong>Data Connectors:</strong> 2, <strong>Parsers:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 10, <strong>Hunting Queries:</strong> 10</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Azure_Sentinel.svg\"width=\"75px\"height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Cloudflare",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cloudflare",
          "email": "support@cloudflare.com",
          "tier": "Partner",
          "link": "https://support.cloudflare.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId2')]",
              "version": "[variables('dataConnectorVersion2')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
              "version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
              "version": "[variables('huntingQueryObject2').huntingQueryVersion2]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject3')._huntingQuerycontentId3]",
              "version": "[variables('huntingQueryObject3').huntingQueryVersion3]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject4')._huntingQuerycontentId4]",
              "version": "[variables('huntingQueryObject4').huntingQueryVersion4]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject5')._huntingQuerycontentId5]",
              "version": "[variables('huntingQueryObject5').huntingQueryVersion5]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject6')._huntingQuerycontentId6]",
              "version": "[variables('huntingQueryObject6').huntingQueryVersion6]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject7')._huntingQuerycontentId7]",
              "version": "[variables('huntingQueryObject7').huntingQueryVersion7]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject8')._huntingQuerycontentId8]",
              "version": "[variables('huntingQueryObject8').huntingQueryVersion8]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject9')._huntingQuerycontentId9]",
              "version": "[variables('huntingQueryObject9').huntingQueryVersion9]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject10')._huntingQuerycontentId10]",
              "version": "[variables('huntingQueryObject10').huntingQueryVersion10]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
            }
          ]
        },
        "firstPublishDate": "2021-10-20",
        "providers": [
          "Cloudflare"
        ],
        "categories": {
          "domains": [
            "Networking",
            "Security - Network"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
