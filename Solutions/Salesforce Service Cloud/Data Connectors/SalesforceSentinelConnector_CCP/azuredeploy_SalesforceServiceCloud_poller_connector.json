{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for Salesforce Service Cloud"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "Salesforce Service Cloud",
    "_solutionVersion": "3.0.3",
    "solutionId": "azuresentinel.azure-sentinel-solution-salesforceservicecloud",
    "_solutionId": "[variables('solutionId')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "SalesforceServiceCloudCCPDefinition",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "SalesforceServiceCloudCCPDefinitionConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "Salesforce Service Cloud (via CCP) – Preview",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "SalesforceServiceCloudCCPDefinition",
                  "title": "Salesforce Service Cloud (via CCP) – Preview",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": "The Salesforce Service Cloud data connector provides the capability to ingest information about your Salesforce operational events into Microsoft Sentinel through the REST API. The connector provides ability to review events in your org on an accelerated basis, get [event log files](https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/event_log_file_hourly_overview.htm) in hourly increments for recent activity.",
                  "graphQueriesTableName": "SalesforceServiceCloudV2_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "Salesforce Service Cloud EventLogFile Events",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Get a sample of Salesforce Service Cloud Event Log File Events",
                      "query": "{{graphQueriesTableName}}\n| take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n|summarize Time = max  (TimeGenerated)\n|where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Salesforce Service Cloud API access",
                        "description": "Access to the Salesforce Service Cloud API through a Connected App is required."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Follow [Create a Connected App in Salesforce for OAuth](https://help.salesforce.com/s/articleView?id=platform.ev_relay_create_connected_app.htm&type=5) and [Configure a Connected App for the OAuth 2.0 Client Credentials Flow](https://help.salesforce.com/s/articleView?id=xcloud.connected_app_client_credentials_setup.htm&type=5) to create a Connected App with access to the Salesforce Service Cloud API. Through those instructions, you should get the Consumer Key and Consumer Secret.\n For Salesforce Domain name, Go to Setup, type My Domain in the Quick Find box, and select My Domain to view your domain details. Make sure to enter the domain name without a trailing slash (e.g., https://your-domain.my.salesforce.com). Fill the form bellow with that information.",
                      "instructions": [
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Salesforce Domain Name",
                            "placeholder": "Salesforce Domain Name",
                            "type": "text",
                            "name": "salesforceDomainName",
                            "validations": {
                              "required": true
                            }
                          }
                        },
                        {
                          "type": "Dropdown",
                          "parameters": {
                            "label": "Log Collection Interval",
                            "name": "queryType",
                            "required": true,
                            "type": "text",
                            "placeholder": "Select a Interval type",
                            "options": [
                              {
                                "key": "SELECT Id,EventType,LogDate,Interval,CreatedDate,LogFile,LogFileLength FROM EventLogFile WHERE Interval='Hourly' and CreatedDate>{_QueryWindowStartTime} and CreatedDate<{_QueryWindowEndTime}",
                                "text": "Hourly"
                              },
                              {
                                "key": "SELECT Id,EventType,LogDate,CreatedDate,LogFile,LogFileLength FROM EventLogFile WHERE CreatedDate>{_QueryWindowStartTime} and CreatedDate<{_QueryWindowEndTime}",
                                "text": "Daily"
                              }
                            ]
                          }
                        },
                        {
                          "type": "OAuthForm",
                          "parameters": {
                            "clientIdLabel": "Consumer Key",
                            "clientSecretLabel": "Consumer Secret",
                            "clientIdPlaceholder": "Enter Connected App Consumer Key",
                            "clientSecretPlaceholder": "Enter Connected App Consumer Secret",
                            "connectButtonLabel": "Connect",
                            "disconnectButtonLabel": "Disconnect"
                          }
                        }
                      ],
                      "title": "Connect to Salesforce Service Cloud API to start collecting event logs in Microsoft Sentinel"
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "SalesforceServiceCloudDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-SalesforceServiceCloudV2_CL": {
                    "columns": [
                      {
                        "name": "REQUEST_SIZE",
                        "type": "string"
                      },
                      {
                        "name": "EXEC_TIME",
                        "type": "string"
                      },
                      {
                        "name": "ACTION",
                        "type": "string"
                      },
                      {
                        "name": "PLATFORM_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "OS_NAME",
                        "type": "string"
                      },
                      {
                        "name": "OS_VERSION",
                        "type": "string"
                      },
                      {
                        "name": "TIMESTAMP",
                        "type": "string"
                      },
                      {
                        "name": "STATUS_CODE",
                        "type": "string"
                      },
                      {
                        "name": "EVENT_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "REFERRER_URI",
                        "type": "string"
                      },
                      {
                        "name": "USER_AGENT",
                        "type": "string"
                      },
                      {
                        "name": "BROWSER_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "TIME",
                        "type": "string"
                      },
                      {
                        "name": "RESPONSE_SIZE",
                        "type": "string"
                      },
                      {
                        "name": "DEVICE_ID",
                        "type": "string"
                      },
                      {
                        "name": "DEVICE_MODEL",
                        "type": "string"
                      },
                      {
                        "name": "SOURCE_IP",
                        "type": "string"
                      },
                      {
                        "name": "CLIENT_IP",
                        "type": "string"
                      },
                      {
                        "name": "SUCCESS",
                        "type": "string"
                      },
                      {
                        "name": "URI",
                        "type": "string"
                      },
                      {
                        "name": "URL",
                        "type": "string"
                      },
                      {
                        "name": "CLIENT_NAME",
                        "type": "string"
                      },
                      {
                        "name": "USER_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "USER_INITIATED_LOGOUT",
                        "type": "string"
                      },
                      {
                        "name": "USER_ID_DERIVED",
                        "type": "string"
                      },
                      {
                        "name": "USER_ID",
                        "type": "string"
                      },
                      {
                        "name": "USER_EMAIL",
                        "type": "string"
                      },
                      {
                        "name": "USER",
                        "type": "string"
                      },
                      {
                        "name": "URI_ID_DERIVED",
                        "type": "string"
                      },
                      {
                        "name": "UI_EVENT_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "UI_EVENT_TIMESTAMP",
                        "type": "string"
                      },
                      {
                        "name": "UI_EVENT_SOURCE",
                        "type": "string"
                      },
                      {
                        "name": "UI_EVENT_SEQUENCE_NUM",
                        "type": "string"
                      },
                      {
                        "name": "UI_EVENT_ID",
                        "type": "string"
                      },
                      {
                        "name": "TLS_PROTOCOL",
                        "type": "string"
                      },
                      {
                        "name": "TIMESTAMP_DERIVED",
                        "type": "datetime"
                      },
                      {
                        "name": "TARGET_UI_ELEMENT",
                        "type": "string"
                      },
                      {
                        "name": "SORT",
                        "type": "string"
                      },
                      {
                        "name": "SESSION_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "SESSION_LEVEL",
                        "type": "string"
                      },
                      {
                        "name": "SESSION_KEY",
                        "type": "string"
                      },
                      {
                        "name": "SEARCH_QUERY",
                        "type": "string"
                      },
                      {
                        "name": "SDK_VERSION",
                        "type": "string"
                      },
                      {
                        "name": "SDK_APP_VERSION",
                        "type": "string"
                      },
                      {
                        "name": "SDK_APP_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "RUN_TIME",
                        "type": "string"
                      },
                      {
                        "name": "ROWS_PROCESSED",
                        "type": "string"
                      },
                      {
                        "name": "ROW_COUNT",
                        "type": "string"
                      },
                      {
                        "name": "RESOLUTION_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "REQUEST_STATUS",
                        "type": "string"
                      },
                      {
                        "name": "REQUEST_ID",
                        "type": "string"
                      },
                      {
                        "name": "REPORT_ID_DERIVED",
                        "type": "string"
                      },
                      {
                        "name": "REPORT_ID",
                        "type": "string"
                      },
                      {
                        "name": "RENDERING_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "RELATED_LIST",
                        "type": "string"
                      },
                      {
                        "name": "RECORD_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "RECORD_ID",
                        "type": "string"
                      },
                      {
                        "name": "QUIDDITY",
                        "type": "string"
                      },
                      {
                        "name": "QUERY_ID",
                        "type": "string"
                      },
                      {
                        "name": "PREVPAGE_URL",
                        "type": "string"
                      },
                      {
                        "name": "PREVPAGE_ENTITY_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "PREVPAGE_ENTITY_ID",
                        "type": "string"
                      },
                      {
                        "name": "PREVPAGE_CONTEXT",
                        "type": "string"
                      },
                      {
                        "name": "PREVPAGE_APP_NAME",
                        "type": "string"
                      },
                      {
                        "name": "PREFIXES_SEARCHED",
                        "type": "string"
                      },
                      {
                        "name": "PARENT_UI_ELEMENT",
                        "type": "string"
                      },
                      {
                        "name": "PAGE_URL",
                        "type": "string"
                      },
                      {
                        "name": "PAGE_START_TIME",
                        "type": "string"
                      },
                      {
                        "name": "PAGE_ENTITY_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "PAGE_ENTITY_ID",
                        "type": "string"
                      },
                      {
                        "name": "PAGE_CONTEXT",
                        "type": "string"
                      },
                      {
                        "name": "PAGE_APP_NAME",
                        "type": "string"
                      },
                      {
                        "name": "ORIGIN",
                        "type": "string"
                      },
                      {
                        "name": "ORGANIZATION_ID",
                        "type": "string"
                      },
                      {
                        "name": "NUM_RESULTS",
                        "type": "string"
                      },
                      {
                        "name": "NUMBER_SOQL_QUERIES",
                        "type": "string"
                      },
                      {
                        "name": "NUMBER_FIELDS",
                        "type": "string"
                      },
                      {
                        "name": "NUMBER_EXCEPTION_FILTERS",
                        "type": "string"
                      },
                      {
                        "name": "NUMBER_COLUMNS",
                        "type": "string"
                      },
                      {
                        "name": "NUMBER_BUCKETS",
                        "type": "string"
                      },
                      {
                        "name": "METHOD_NAME",
                        "type": "string"
                      },
                      {
                        "name": "METHOD",
                        "type": "string"
                      },
                      {
                        "name": "MEDIA_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "LOGIN_STATUS",
                        "type": "string"
                      },
                      {
                        "name": "LOGIN_KEY",
                        "type": "string"
                      },
                      {
                        "name": "HTTP_METHOD",
                        "type": "string"
                      },
                      {
                        "name": "GRANDPARENT_UI_ELEMENT",
                        "type": "string"
                      },
                      {
                        "name": "ENTRY_POINT",
                        "type": "string"
                      },
                      {
                        "name": "ENTITY_NAME",
                        "type": "string"
                      },
                      {
                        "name": "ENTITY",
                        "type": "string"
                      },
                      {
                        "name": "EFFECTIVE_PAGE_TIME",
                        "type": "string"
                      },
                      {
                        "name": "DURATION",
                        "type": "string"
                      },
                      {
                        "name": "DISPLAY_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "DEVICE_SESSION_ID",
                        "type": "string"
                      },
                      {
                        "name": "DEVICE_PLATFORM",
                        "type": "string"
                      },
                      {
                        "name": "DB_TOTAL_TIME",
                        "type": "string"
                      },
                      {
                        "name": "DB_CPU_TIME",
                        "type": "string"
                      },
                      {
                        "name": "DB_BLOCKS",
                        "type": "string"
                      },
                      {
                        "name": "CPU_TIME",
                        "type": "string"
                      },
                      {
                        "name": "CONNECTION_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "COMPONENT_NAME",
                        "type": "string"
                      },
                      {
                        "name": "CLIENT_VERSION",
                        "type": "string"
                      },
                      {
                        "name": "CLIENT_ID",
                        "type": "string"
                      },
                      {
                        "name": "CIPHER_SUITE",
                        "type": "string"
                      },
                      {
                        "name": "CALLOUT_TIME",
                        "type": "string"
                      },
                      {
                        "name": "BROWSER_VERSION",
                        "type": "string"
                      },
                      {
                        "name": "BROWSER_NAME",
                        "type": "string"
                      },
                      {
                        "name": "AVERAGE_ROW_SIZE",
                        "type": "string"
                      },
                      {
                        "name": "APP_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "APP_NAME",
                        "type": "string"
                      },
                      {
                        "name": "API_VERSION",
                        "type": "string"
                      },
                      {
                        "name": "API_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "ARTICLE_VERSION_ID",
                        "type": "string"
                      },
                      {
                        "name": "ARTICLE_VERSION",
                        "type": "string"
                      },
                      {
                        "name": "ARTICLE_STATUS",
                        "type": "string"
                      },
                      {
                        "name": "ARTICLE_ID",
                        "type": "string"
                      },
                      {
                        "name": "ANALYTICS_MODE",
                        "type": "string"
                      },
                      {
                        "name": "BATCH_ID",
                        "type": "string"
                      },
                      {
                        "name": "CLICKED_RECORD_ID",
                        "type": "string"
                      },
                      {
                        "name": "CLASS_NAME",
                        "type": "string"
                      },
                      {
                        "name": "COMPONENT_ID_DERIVED",
                        "type": "string"
                      },
                      {
                        "name": "COMPONENT_ID",
                        "type": "string"
                      },
                      {
                        "name": "CONTROLLER_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "CONTEXT",
                        "type": "string"
                      },
                      {
                        "name": "CONSOLE_ID_DERIVED",
                        "type": "string"
                      },
                      {
                        "name": "CONSOLE_ID",
                        "type": "string"
                      },
                      {
                        "name": "CLIENT_INFO",
                        "type": "string"
                      },
                      {
                        "name": "DST_BYTES",
                        "type": "string"
                      },
                      {
                        "name": "DST_USER",
                        "type": "string"
                      },
                      {
                        "name": "DST_USER_SID",
                        "type": "string"
                      },
                      {
                        "name": "DST_USER_SID_DERIVED",
                        "type": "string"
                      },
                      {
                        "name": "DATA",
                        "type": "string"
                      },
                      {
                        "name": "DASHBOARD_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "DASHBOARD_ID_DERIVED",
                        "type": "string"
                      },
                      {
                        "name": "DASHBOARD_ID",
                        "type": "string"
                      },
                      {
                        "name": "DASHBOARD_COMPONENT_ID",
                        "type": "string"
                      },
                      {
                        "name": "DVC_ACTION",
                        "type": "string"
                      },
                      {
                        "name": "DVC_OS",
                        "type": "string"
                      },
                      {
                        "name": "DVC_OS_NAME",
                        "type": "string"
                      },
                      {
                        "name": "DVC_OS_VERSION",
                        "type": "string"
                      },
                      {
                        "name": "DELIVERY_LOCATION",
                        "type": "string"
                      },
                      {
                        "name": "DELIVERY_ID",
                        "type": "string"
                      },
                      {
                        "name": "DOCUMENT_ID_DERIVED",
                        "type": "string"
                      },
                      {
                        "name": "DOCUMENT_ID",
                        "type": "string"
                      },
                      {
                        "name": "ENTITY_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "ENTITY_ID",
                        "type": "string"
                      },
                      {
                        "name": "FILE_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "FILE_PREVIEW_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "EXCEPTION_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "EXCEPTION_MESSAGE",
                        "type": "string"
                      },
                      {
                        "name": "EPT",
                        "type": "string"
                      },
                      {
                        "name": "EVENT_COUNT",
                        "type": "string"
                      },
                      {
                        "name": "EVENT_END_TIME",
                        "type": "string"
                      },
                      {
                        "name": "EVENT_RESULT",
                        "type": "string"
                      },
                      {
                        "name": "FILE_SIZE",
                        "type": "string"
                      },
                      {
                        "name": "HTTP_REFERRER_ORIGINAL",
                        "type": "string"
                      },
                      {
                        "name": "HTTP_USER_AGENT_ORIGINAL",
                        "type": "string"
                      },
                      {
                        "name": "HTTP_USER_AGENT",
                        "type": "string"
                      },
                      {
                        "name": "LOG_GROUP_ID",
                        "type": "string"
                      },
                      {
                        "name": "LIMIT_USAGE_PERCENT",
                        "type": "string"
                      },
                      {
                        "name": "LICENSE_CONTEXT",
                        "type": "string"
                      },
                      {
                        "name": "LAST_VERSION",
                        "type": "string"
                      },
                      {
                        "name": "LANGUAGE",
                        "type": "string"
                      },
                      {
                        "name": "JOB_ID",
                        "type": "string"
                      },
                      {
                        "name": "IS_SUCCESS",
                        "type": "string"
                      },
                      {
                        "name": "IS_SECURE",
                        "type": "string"
                      },
                      {
                        "name": "IS_SCHEDULED",
                        "type": "string"
                      },
                      {
                        "name": "IS_NEW",
                        "type": "string"
                      },
                      {
                        "name": "IS_MOBILE",
                        "type": "string"
                      },
                      {
                        "name": "IS_LONG_RUNNING_REQUEST",
                        "type": "string"
                      },
                      {
                        "name": "IS_GUEST",
                        "type": "string"
                      },
                      {
                        "name": "IS_FIRST_REQUEST",
                        "type": "string"
                      },
                      {
                        "name": "IS_ERROR",
                        "type": "string"
                      },
                      {
                        "name": "IS_API",
                        "type": "string"
                      },
                      {
                        "name": "IS_AJAX_REQUEST",
                        "type": "string"
                      },
                      {
                        "name": "MANAGED_PACKAGE_NAMESPACE",
                        "type": "string"
                      },
                      {
                        "name": "HTTP_HEADERS",
                        "type": "string"
                      },
                      {
                        "name": "NETWORK_DURATION",
                        "type": "string"
                      },
                      {
                        "name": "NAME",
                        "type": "string"
                      },
                      {
                        "name": "NUMBER_FAILURES",
                        "type": "string"
                      },
                      {
                        "name": "NUM_CLICKS",
                        "type": "string"
                      },
                      {
                        "name": "OPERATION_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "NUM_SESSIONS",
                        "type": "string"
                      },
                      {
                        "name": "PAGE_NAME",
                        "type": "string"
                      },
                      {
                        "name": "QUERY",
                        "type": "string"
                      },
                      {
                        "name": "REQUEST_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "REPORT_DESCRIPTION",
                        "type": "string"
                      },
                      {
                        "name": "REOPEN_COUNT",
                        "type": "string"
                      },
                      {
                        "name": "RELATED_ENTITY_ID",
                        "type": "string"
                      },
                      {
                        "name": "RECORD_ID_DERIVED",
                        "type": "string"
                      },
                      {
                        "name": "READ_TIME",
                        "type": "string"
                      },
                      {
                        "name": "RANK",
                        "type": "string"
                      },
                      {
                        "name": "SRC_BYTES",
                        "type": "string"
                      },
                      {
                        "name": "SRC_DVC_ID",
                        "type": "string"
                      },
                      {
                        "name": "SRC_DVC_MODEL_NAME",
                        "type": "string"
                      },
                      {
                        "name": "SRC_IP_ADDR",
                        "type": "string"
                      },
                      {
                        "name": "SRC_NAT_IP_ADDR",
                        "type": "string"
                      },
                      {
                        "name": "SESSION_ID",
                        "type": "string"
                      },
                      {
                        "name": "SITE_ID",
                        "type": "string"
                      },
                      {
                        "name": "SHARING_PERMISSION",
                        "type": "string"
                      },
                      {
                        "name": "SHARING_OPERATION",
                        "type": "string"
                      },
                      {
                        "name": "SHARED_WITH_ENTITY_ID",
                        "type": "string"
                      },
                      {
                        "name": "URL_ORIGINAL",
                        "type": "string"
                      },
                      {
                        "name": "WAVE_TIMESTAMP",
                        "type": "string"
                      },
                      {
                        "name": "WAVE_SESSION_ID",
                        "type": "string"
                      },
                      {
                        "name": "VIEW_STATE_SIZE",
                        "type": "string"
                      },
                      {
                        "name": "VERSION_ID_DERIVED",
                        "type": "string"
                      },
                      {
                        "name": "VERSION_ID",
                        "type": "string"
                      },
                      {
                        "name": "TRIGGER_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "TRIGGER_NAME",
                        "type": "string"
                      },
                      {
                        "name": "TRIGGER_ID",
                        "type": "string"
                      },
                      {
                        "name": "TRANSACTION_TYPE",
                        "type": "string"
                      },
                      {
                        "name": "TOTAL_TIME",
                        "type": "string"
                      },
                      {
                        "name": "TAB_ID",
                        "type": "string"
                      },
                      {
                        "name": "STACK_TRACE",
                        "type": "string"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-SalesforceServiceCloudV2_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend TimeGenerated = TIMESTAMP_DERIVED, TimestampDerived=tostring(TIMESTAMP_DERIVED) | project-rename RequestSize=REQUEST_SIZE, ExecTime=EXEC_TIME, Action=ACTION, PlatformType=PLATFORM_TYPE, OsName=OS_NAME, OsVersion=OS_VERSION, Timestamp=TIMESTAMP, StatusCode=STATUS_CODE, EventType=EVENT_TYPE, ReferrerUri=REFERRER_URI, UserAgent=USER_AGENT, BrowserType=BROWSER_TYPE, Time=TIME, ResponseSize=RESPONSE_SIZE, DeviceId=DEVICE_ID, DeviceModel=DEVICE_MODEL, SourceIp=SOURCE_IP, ClientIp=CLIENT_IP, Success=SUCCESS, Uri=URI, Url=URL, ClientName=CLIENT_NAME, UserType=USER_TYPE, UserInitiatedLogout=USER_INITIATED_LOGOUT, UserIdDerived=USER_ID_DERIVED, UserId=USER_ID, UserEmail=USER_EMAIL, User=USER, UriIdDerived=URI_ID_DERIVED, UiEventType=UI_EVENT_TYPE, UiEventTimestamp=UI_EVENT_TIMESTAMP, UiEventSource=UI_EVENT_SOURCE, UiEventSequenceNum=UI_EVENT_SEQUENCE_NUM, UiEventId=UI_EVENT_ID, TlsProtocol=TLS_PROTOCOL, TargetUiElement=TARGET_UI_ELEMENT, Sort=SORT, SessionType=SESSION_TYPE, SessionLevel=SESSION_LEVEL, SessionKey=SESSION_KEY, SearchQuery=SEARCH_QUERY, SdkVersion=SDK_VERSION, SdkAppVersion=SDK_APP_VERSION, SdkAppType=SDK_APP_TYPE, RunTime=RUN_TIME, RowsProcessed=ROWS_PROCESSED, RowCount=ROW_COUNT, ResolutionType=RESOLUTION_TYPE, RequestStatus=REQUEST_STATUS, RequestId=REQUEST_ID, ReportIdDerived=REPORT_ID_DERIVED, ReportId=REPORT_ID, RenderingType=RENDERING_TYPE, RelatedList=RELATED_LIST, RecordType=RECORD_TYPE, RecordId=RECORD_ID, Quiddity=QUIDDITY, QueryId=QUERY_ID, PrevpageUrl=PREVPAGE_URL, PrevpageEntityType=PREVPAGE_ENTITY_TYPE, PrevpageEntityId=PREVPAGE_ENTITY_ID, PrevpageContext=PREVPAGE_CONTEXT, PrevpageAppName=PREVPAGE_APP_NAME, PrefixesSearched=PREFIXES_SEARCHED, ParentUiElement=PARENT_UI_ELEMENT, PageUrl=PAGE_URL, PageStartTime=PAGE_START_TIME, PageEntityType=PAGE_ENTITY_TYPE, PageEntityId=PAGE_ENTITY_ID, PageContext=PAGE_CONTEXT, PageAppName=PAGE_APP_NAME, Origin=ORIGIN, OrganizationId=ORGANIZATION_ID, NumResults=NUM_RESULTS, NumberSoqlQueries=NUMBER_SOQL_QUERIES, NumberFields=NUMBER_FIELDS, NumberExceptionFilters=NUMBER_EXCEPTION_FILTERS, NumberColumns=NUMBER_COLUMNS, NumberBuckets=NUMBER_BUCKETS, MethodName=METHOD_NAME, Method=METHOD, MediaType=MEDIA_TYPE, LoginStatus=LOGIN_STATUS, LoginKey=LOGIN_KEY, HttpMethod=HTTP_METHOD, GrandparentUiElement=GRANDPARENT_UI_ELEMENT, EntryPoint=ENTRY_POINT, EntityName=ENTITY_NAME, Entity=ENTITY, EffectivePageTime=EFFECTIVE_PAGE_TIME, Duration=DURATION, DisplayType=DISPLAY_TYPE, DeviceSessionId=DEVICE_SESSION_ID, DevicePlatform=DEVICE_PLATFORM, DbTotalTime=DB_TOTAL_TIME, DbCpuTime=DB_CPU_TIME, DbBlocks=DB_BLOCKS, CpuTime=CPU_TIME, ConnectionType=CONNECTION_TYPE, ComponentName=COMPONENT_NAME, ClientVersion=CLIENT_VERSION, ClientId=CLIENT_ID, CipherSuite=CIPHER_SUITE, CalloutTime=CALLOUT_TIME, BrowserVersion=BROWSER_VERSION, BrowserName=BROWSER_NAME, AverageRowSize=AVERAGE_ROW_SIZE, AppType=APP_TYPE, AppName=APP_NAME, ApiVersion=API_VERSION, ApiType=API_TYPE, ArticleVersionId=ARTICLE_VERSION_ID, ArticleVersion=ARTICLE_VERSION, ArticleStatus=ARTICLE_STATUS, ArticleId=ARTICLE_ID, AnalyticsMode=ANALYTICS_MODE, BatchId=BATCH_ID, ClickedRecordId=CLICKED_RECORD_ID, ClassName=CLASS_NAME, ComponentIdDerived=COMPONENT_ID_DERIVED, ComponentId=COMPONENT_ID, ControllerType=CONTROLLER_TYPE, Context=CONTEXT, ConsoleIdDerived=CONSOLE_ID_DERIVED, ConsoleId=CONSOLE_ID, ClientInfo=CLIENT_INFO, DstBytes=DST_BYTES, DstUser=DST_USER, DstUserSid=DST_USER_SID, DstUserSidDerived=DST_USER_SID_DERIVED, Data=DATA, DashboardType=DASHBOARD_TYPE, DashboardIdDerived=DASHBOARD_ID_DERIVED, DashboardId=DASHBOARD_ID, DashboardComponentId=DASHBOARD_COMPONENT_ID, DvcAction=DVC_ACTION, DvcOS=DVC_OS, DvcOSName=DVC_OS_NAME, DvcOSVersion=DVC_OS_VERSION, DeliveryLocation=DELIVERY_LOCATION, DeliveryId=DELIVERY_ID, DocumentIdDerived=DOCUMENT_ID_DERIVED, DocumentId=DOCUMENT_ID, EntityType=ENTITY_TYPE, EntityId=ENTITY_ID, FileType=FILE_TYPE, FilePreviewType=FILE_PREVIEW_TYPE, ExceptionType=EXCEPTION_TYPE, ExceptionMessage=EXCEPTION_MESSAGE, Ept=EPT, EventCount=EVENT_COUNT, EventEndTime=EVENT_END_TIME, EventResult=EVENT_RESULT, FileSize=FILE_SIZE, HttpReferrerOriginal=HTTP_REFERRER_ORIGINAL, HttpUserAgentOriginal=HTTP_USER_AGENT_ORIGINAL, HttpUserAgent=HTTP_USER_AGENT, LogGroupId=LOG_GROUP_ID, LimitUsagePercent=LIMIT_USAGE_PERCENT, LicenseContext=LICENSE_CONTEXT, LastVersion=LAST_VERSION, Language=LANGUAGE, JobId=JOB_ID, IsSuccess=IS_SUCCESS, IsSecure=IS_SECURE, IsScheduled=IS_SCHEDULED, IsNew=IS_NEW, IsMobile=IS_MOBILE, IsLongRunningRequest=IS_LONG_RUNNING_REQUEST, IsGuest=IS_GUEST, IsFirstRequest=IS_FIRST_REQUEST, IsError=IS_ERROR, IsApi=IS_API, IsAjaxRequest=IS_AJAX_REQUEST, ManagedPackageNamespace=MANAGED_PACKAGE_NAMESPACE, HttpHeaders=HTTP_HEADERS, NetworkDuration=NETWORK_DURATION, Name=NAME, NumberFailures=NUMBER_FAILURES, NumClicks=NUM_CLICKS, OperationType=OPERATION_TYPE, NumSessions=NUM_SESSIONS, PageName=PAGE_NAME, Query=QUERY, RequestType=REQUEST_TYPE, ReportDescription=REPORT_DESCRIPTION, ReopenCount=REOPEN_COUNT, RelatedEntityId=RELATED_ENTITY_ID, RecordIdDerived=RECORD_ID_DERIVED, ReadTime=READ_TIME, Rank=RANK, SrcBytes=SRC_BYTES, SrcDvcId=SRC_DVC_ID, SrcDvcModelName=SRC_DVC_MODEL_NAME, SrcIpAddr=SRC_IP_ADDR, SrcNatIpAddr=SRC_NAT_IP_ADDR, SessionId=SESSION_ID, SiteId=SITE_ID, SharingPermission=SHARING_PERMISSION, SharingOperation=SHARING_OPERATION, SharedWithEntityId=SHARED_WITH_ENTITY_ID, UrlOriginal=URL_ORIGINAL, WaveTimestamp=WAVE_TIMESTAMP, WaveSessionId=WAVE_SESSION_ID, ViewStateSize=VIEW_STATE_SIZE, VersionIdDerived=VERSION_ID_DERIVED, VersionId=VERSION_ID, TriggerType=TRIGGER_TYPE, TriggerName=TRIGGER_NAME, TriggerId=TRIGGER_ID, TransactionType=TRANSACTION_TYPE, TotalTime=TOTAL_TIME, TabId=TAB_ID, StackTrace=STACK_TRACE | project-away TIMESTAMP_DERIVED",
                    "outputStream": "Custom-SalesforceServiceCloudV2_CL"
                  }
                ]
              }
            },
            {
              "name": "SalesforceServiceCloudV2_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "SalesforceServiceCloudV2_CL",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "Datetime",
                      "isDefaultDisplay": true,
                      "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                    },
                    {
                      "name": "RequestSize",
                      "type": "string"
                    },
                    {
                      "name": "ExecTime",
                      "type": "string"
                    },
                    {
                      "name": "Action",
                      "type": "string"
                    },
                    {
                      "name": "PlatformType",
                      "type": "string"
                    },
                    {
                      "name": "OsName",
                      "type": "string"
                    },
                    {
                      "name": "OsVersion",
                      "type": "string"
                    },
                    {
                      "name": "Timestamp",
                      "type": "string"
                    },
                    {
                      "name": "StatusCode",
                      "type": "string"
                    },
                    {
                      "name": "EventType",
                      "type": "string"
                    },
                    {
                      "name": "ReferrerUri",
                      "type": "string"
                    },
                    {
                      "name": "UserAgent",
                      "type": "string"
                    },
                    {
                      "name": "BrowserType",
                      "type": "string"
                    },
                    {
                      "name": "Time",
                      "type": "string"
                    },
                    {
                      "name": "ResponseSize",
                      "type": "string"
                    },
                    {
                      "name": "DeviceId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceModel",
                      "type": "string"
                    },
                    {
                      "name": "SourceIp",
                      "type": "string"
                    },
                    {
                      "name": "ClientIp",
                      "type": "string"
                    },
                    {
                      "name": "Success",
                      "type": "string"
                    },
                    {
                      "name": "Uri",
                      "type": "string"
                    },
                    {
                      "name": "Url",
                      "type": "string"
                    },
                    {
                      "name": "ClientName",
                      "type": "string"
                    },
                    {
                      "name": "UserType",
                      "type": "string"
                    },
                    {
                      "name": "UserInitiatedLogout",
                      "type": "string"
                    },
                    {
                      "name": "UserIdDerived",
                      "type": "string"
                    },
                    {
                      "name": "UserId",
                      "type": "string"
                    },
                    {
                      "name": "UserEmail",
                      "type": "string"
                    },
                    {
                      "name": "User",
                      "type": "string"
                    },
                    {
                      "name": "UriIdDerived",
                      "type": "string"
                    },
                    {
                      "name": "UiEventType",
                      "type": "string"
                    },
                    {
                      "name": "UiEventTimestamp",
                      "type": "string"
                    },
                    {
                      "name": "UiEventSource",
                      "type": "string"
                    },
                    {
                      "name": "UiEventSequenceNum",
                      "type": "string"
                    },
                    {
                      "name": "UiEventId",
                      "type": "string"
                    },
                    {
                      "name": "TlsProtocol",
                      "type": "string"
                    },
                    {
                      "name": "TimestampDerived",
                      "type": "string"
                    },
                    {
                      "name": "TargetUiElement",
                      "type": "string"
                    },
                    {
                      "name": "Sort",
                      "type": "string"
                    },
                    {
                      "name": "SessionType",
                      "type": "string"
                    },
                    {
                      "name": "SessionLevel",
                      "type": "string"
                    },
                    {
                      "name": "SessionKey",
                      "type": "string"
                    },
                    {
                      "name": "SearchQuery",
                      "type": "string"
                    },
                    {
                      "name": "SdkVersion",
                      "type": "string"
                    },
                    {
                      "name": "SdkAppVersion",
                      "type": "string"
                    },
                    {
                      "name": "SdkAppType",
                      "type": "string"
                    },
                    {
                      "name": "RunTime",
                      "type": "string"
                    },
                    {
                      "name": "RowsProcessed",
                      "type": "string"
                    },
                    {
                      "name": "RowCount",
                      "type": "string"
                    },
                    {
                      "name": "ResolutionType",
                      "type": "string"
                    },
                    {
                      "name": "RequestStatus",
                      "type": "string"
                    },
                    {
                      "name": "RequestId",
                      "type": "string"
                    },
                    {
                      "name": "ReportIdDerived",
                      "type": "string"
                    },
                    {
                      "name": "ReportId",
                      "type": "string"
                    },
                    {
                      "name": "RenderingType",
                      "type": "string"
                    },
                    {
                      "name": "RelatedList",
                      "type": "string"
                    },
                    {
                      "name": "RecordType",
                      "type": "string"
                    },
                    {
                      "name": "RecordId",
                      "type": "string"
                    },
                    {
                      "name": "Quiddity",
                      "type": "string"
                    },
                    {
                      "name": "QueryId",
                      "type": "string"
                    },
                    {
                      "name": "PrevpageUrl",
                      "type": "string"
                    },
                    {
                      "name": "PrevpageEntityType",
                      "type": "string"
                    },
                    {
                      "name": "PrevpageEntityId",
                      "type": "string"
                    },
                    {
                      "name": "PrevpageContext",
                      "type": "string"
                    },
                    {
                      "name": "PrevpageAppName",
                      "type": "string"
                    },
                    {
                      "name": "PrefixesSearched",
                      "type": "string"
                    },
                    {
                      "name": "ParentUiElement",
                      "type": "string"
                    },
                    {
                      "name": "PageUrl",
                      "type": "string"
                    },
                    {
                      "name": "PageStartTime",
                      "type": "string"
                    },
                    {
                      "name": "PageEntityType",
                      "type": "string"
                    },
                    {
                      "name": "PageEntityId",
                      "type": "string"
                    },
                    {
                      "name": "PageContext",
                      "type": "string"
                    },
                    {
                      "name": "PageAppName",
                      "type": "string"
                    },
                    {
                      "name": "Origin",
                      "type": "string"
                    },
                    {
                      "name": "OrganizationId",
                      "type": "string"
                    },
                    {
                      "name": "NumResults",
                      "type": "string"
                    },
                    {
                      "name": "NumberSoqlQueries",
                      "type": "string"
                    },
                    {
                      "name": "NumberFields",
                      "type": "string"
                    },
                    {
                      "name": "NumberExceptionFilters",
                      "type": "string"
                    },
                    {
                      "name": "NumberColumns",
                      "type": "string"
                    },
                    {
                      "name": "NumberBuckets",
                      "type": "string"
                    },
                    {
                      "name": "MethodName",
                      "type": "string"
                    },
                    {
                      "name": "Method",
                      "type": "string"
                    },
                    {
                      "name": "MediaType",
                      "type": "string"
                    },
                    {
                      "name": "LoginStatus",
                      "type": "string"
                    },
                    {
                      "name": "LoginKey",
                      "type": "string"
                    },
                    {
                      "name": "HttpMethod",
                      "type": "string"
                    },
                    {
                      "name": "GrandparentUiElement",
                      "type": "string"
                    },
                    {
                      "name": "EntryPoint",
                      "type": "string"
                    },
                    {
                      "name": "EntityName",
                      "type": "string"
                    },
                    {
                      "name": "Entity",
                      "type": "string"
                    },
                    {
                      "name": "EffectivePageTime",
                      "type": "string"
                    },
                    {
                      "name": "Duration",
                      "type": "string"
                    },
                    {
                      "name": "DisplayType",
                      "type": "string"
                    },
                    {
                      "name": "DeviceSessionId",
                      "type": "string"
                    },
                    {
                      "name": "DevicePlatform",
                      "type": "string"
                    },
                    {
                      "name": "DbTotalTime",
                      "type": "string"
                    },
                    {
                      "name": "DbCpuTime",
                      "type": "string"
                    },
                    {
                      "name": "DbBlocks",
                      "type": "string"
                    },
                    {
                      "name": "CpuTime",
                      "type": "string"
                    },
                    {
                      "name": "ConnectionType",
                      "type": "string"
                    },
                    {
                      "name": "ComponentName",
                      "type": "string"
                    },
                    {
                      "name": "ClientVersion",
                      "type": "string"
                    },
                    {
                      "name": "ClientId",
                      "type": "string"
                    },
                    {
                      "name": "CipherSuite",
                      "type": "string"
                    },
                    {
                      "name": "CalloutTime",
                      "type": "string"
                    },
                    {
                      "name": "BrowserVersion",
                      "type": "string"
                    },
                    {
                      "name": "BrowserName",
                      "type": "string"
                    },
                    {
                      "name": "AverageRowSize",
                      "type": "string"
                    },
                    {
                      "name": "AppType",
                      "type": "string"
                    },
                    {
                      "name": "AppName",
                      "type": "string"
                    },
                    {
                      "name": "ApiVersion",
                      "type": "string"
                    },
                    {
                      "name": "ApiType",
                      "type": "string"
                    },
                    {
                      "name": "ArticleVersionId",
                      "type": "string"
                    },
                    {
                      "name": "ArticleVersion",
                      "type": "string"
                    },
                    {
                      "name": "ArticleStatus",
                      "type": "string"
                    },
                    {
                      "name": "ArticleId",
                      "type": "string"
                    },
                    {
                      "name": "AnalyticsMode",
                      "type": "string"
                    },
                    {
                      "name": "BatchId",
                      "type": "string"
                    },
                    {
                      "name": "ClickedRecordId",
                      "type": "string"
                    },
                    {
                      "name": "ClassName",
                      "type": "string"
                    },
                    {
                      "name": "ComponentIdDerived",
                      "type": "string"
                    },
                    {
                      "name": "ComponentId",
                      "type": "string"
                    },
                    {
                      "name": "ControllerType",
                      "type": "string"
                    },
                    {
                      "name": "Context",
                      "type": "string"
                    },
                    {
                      "name": "ConsoleIdDerived",
                      "type": "string"
                    },
                    {
                      "name": "ConsoleId",
                      "type": "string"
                    },
                    {
                      "name": "ClientInfo",
                      "type": "string"
                    },
                    {
                      "name": "DstBytes",
                      "type": "string"
                    },
                    {
                      "name": "DstUser",
                      "type": "string"
                    },
                    {
                      "name": "DstUserSid",
                      "type": "string"
                    },
                    {
                      "name": "DstUserSidDerived",
                      "type": "string"
                    },
                    {
                      "name": "Data",
                      "type": "string"
                    },
                    {
                      "name": "DashboardType",
                      "type": "string"
                    },
                    {
                      "name": "DashboardIdDerived",
                      "type": "string"
                    },
                    {
                      "name": "DashboardId",
                      "type": "string"
                    },
                    {
                      "name": "DashboardComponentId",
                      "type": "string"
                    },
                    {
                      "name": "DvcAction",
                      "type": "string"
                    },
                    {
                      "name": "DvcOS",
                      "type": "string"
                    },
                    {
                      "name": "DvcOSName",
                      "type": "string"
                    },
                    {
                      "name": "DvcOSVersion",
                      "type": "string"
                    },
                    {
                      "name": "DeliveryLocation",
                      "type": "string"
                    },
                    {
                      "name": "DeliveryId",
                      "type": "string"
                    },
                    {
                      "name": "DocumentIdDerived",
                      "type": "string"
                    },
                    {
                      "name": "DocumentId",
                      "type": "string"
                    },
                    {
                      "name": "EntityType",
                      "type": "string"
                    },
                    {
                      "name": "EntityId",
                      "type": "string"
                    },
                    {
                      "name": "FileType",
                      "type": "string"
                    },
                    {
                      "name": "FilePreviewType",
                      "type": "string"
                    },
                    {
                      "name": "ExceptionType",
                      "type": "string"
                    },
                    {
                      "name": "ExceptionMessage",
                      "type": "string"
                    },
                    {
                      "name": "Ept",
                      "type": "string"
                    },
                    {
                      "name": "EventCount",
                      "type": "string"
                    },
                    {
                      "name": "EventEndTime",
                      "type": "string"
                    },
                    {
                      "name": "EventResult",
                      "type": "string"
                    },
                    {
                      "name": "FileSize",
                      "type": "string"
                    },
                    {
                      "name": "HttpReferrerOriginal",
                      "type": "string"
                    },
                    {
                      "name": "HttpUserAgentOriginal",
                      "type": "string"
                    },
                    {
                      "name": "HttpUserAgent",
                      "type": "string"
                    },
                    {
                      "name": "LogGroupId",
                      "type": "string"
                    },
                    {
                      "name": "LimitUsagePercent",
                      "type": "string"
                    },
                    {
                      "name": "LicenseContext",
                      "type": "string"
                    },
                    {
                      "name": "LastVersion",
                      "type": "string"
                    },
                    {
                      "name": "Language",
                      "type": "string"
                    },
                    {
                      "name": "JobId",
                      "type": "string"
                    },
                    {
                      "name": "IsSuccess",
                      "type": "string"
                    },
                    {
                      "name": "IsSecure",
                      "type": "string"
                    },
                    {
                      "name": "IsScheduled",
                      "type": "string"
                    },
                    {
                      "name": "IsNew",
                      "type": "string"
                    },
                    {
                      "name": "IsMobile",
                      "type": "string"
                    },
                    {
                      "name": "IsLongRunningRequest",
                      "type": "string"
                    },
                    {
                      "name": "IsGuest",
                      "type": "string"
                    },
                    {
                      "name": "IsFirstRequest",
                      "type": "string"
                    },
                    {
                      "name": "IsError",
                      "type": "string"
                    },
                    {
                      "name": "IsApi",
                      "type": "string"
                    },
                    {
                      "name": "IsAjaxRequest",
                      "type": "string"
                    },
                    {
                      "name": "ManagedPackageNamespace",
                      "type": "string"
                    },
                    {
                      "name": "HttpHeaders",
                      "type": "string"
                    },
                    {
                      "name": "NetworkDuration",
                      "type": "string"
                    },
                    {
                      "name": "Name",
                      "type": "string"
                    },
                    {
                      "name": "NumberFailures",
                      "type": "string"
                    },
                    {
                      "name": "NumClicks",
                      "type": "string"
                    },
                    {
                      "name": "OperationType",
                      "type": "string"
                    },
                    {
                      "name": "NumSessions",
                      "type": "string"
                    },
                    {
                      "name": "PageName",
                      "type": "string"
                    },
                    {
                      "name": "Query",
                      "type": "string"
                    },
                    {
                      "name": "RequestType",
                      "type": "string"
                    },
                    {
                      "name": "ReportDescription",
                      "type": "string"
                    },
                    {
                      "name": "ReopenCount",
                      "type": "string"
                    },
                    {
                      "name": "RelatedEntityId",
                      "type": "string"
                    },
                    {
                      "name": "RecordIdDerived",
                      "type": "string"
                    },
                    {
                      "name": "ReadTime",
                      "type": "string"
                    },
                    {
                      "name": "Rank",
                      "type": "string"
                    },
                    {
                      "name": "SrcBytes",
                      "type": "string"
                    },
                    {
                      "name": "SrcDvcId",
                      "type": "string"
                    },
                    {
                      "name": "SrcDvcModelName",
                      "type": "string"
                    },
                    {
                      "name": "SrcIpAddr",
                      "type": "string"
                    },
                    {
                      "name": "SrcNatIpAddr",
                      "type": "string"
                    },
                    {
                      "name": "SessionId",
                      "type": "string"
                    },
                    {
                      "name": "SiteId",
                      "type": "string"
                    },
                    {
                      "name": "SharingPermission",
                      "type": "string"
                    },
                    {
                      "name": "SharingOperation",
                      "type": "string"
                    },
                    {
                      "name": "SharedWithEntityId",
                      "type": "string"
                    },
                    {
                      "name": "UrlOriginal",
                      "type": "string"
                    },
                    {
                      "name": "WaveTimestamp",
                      "type": "string"
                    },
                    {
                      "name": "WaveSessionId",
                      "type": "string"
                    },
                    {
                      "name": "ViewStateSize",
                      "type": "string"
                    },
                    {
                      "name": "VersionIdDerived",
                      "type": "string"
                    },
                    {
                      "name": "VersionId",
                      "type": "string"
                    },
                    {
                      "name": "TriggerType",
                      "type": "string"
                    },
                    {
                      "name": "TriggerName",
                      "type": "string"
                    },
                    {
                      "name": "TriggerId",
                      "type": "string"
                    },
                    {
                      "name": "TransactionType",
                      "type": "string"
                    },
                    {
                      "name": "TotalTime",
                      "type": "string"
                    },
                    {
                      "name": "TabId",
                      "type": "string"
                    },
                    {
                      "name": "StackTrace",
                      "type": "string"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "SalesforceServiceCloudCCPDefinition",
          "title": "Salesforce Service Cloud (via CCP) – Preview",
          "publisher": "Microsoft",
          "descriptionMarkdown": "The Salesforce Service Cloud data connector provides the capability to ingest information about your Salesforce operational events into Microsoft Sentinel through the REST API. The connector provides ability to review events in your org on an accelerated basis, get [event log files](https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/event_log_file_hourly_overview.htm) in hourly increments for recent activity.",
          "graphQueriesTableName": "SalesforceServiceCloudV2_CL",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "Salesforce Service Cloud EventLogFile Events",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "Get a sample of Salesforce Service Cloud Event Log File Events",
              "query": "{{graphQueriesTableName}}\n| take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n|summarize Time = max  (TimeGenerated)\n|where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "name": "Salesforce Service Cloud API access",
                "description": "Access to the Salesforce Service Cloud API through a Connected App is required."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Follow [Create a Connected App in Salesforce for OAuth](https://help.salesforce.com/s/articleView?id=platform.ev_relay_create_connected_app.htm&type=5) and [Configure a Connected App for the OAuth 2.0 Client Credentials Flow](https://help.salesforce.com/s/articleView?id=xcloud.connected_app_client_credentials_setup.htm&type=5) to create a Connected App with access to the Salesforce Service Cloud API. Through those instructions, you should get the Consumer Key and Consumer Secret.\n For Salesforce Domain name, Go to Setup, type My Domain in the Quick Find box, and select My Domain to view your domain details. Make sure to enter the domain name without a trailing slash (e.g., https://your-domain.my.salesforce.com). Fill the form bellow with that information.",
              "instructions": [
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "Salesforce Domain Name",
                    "placeholder": "Salesforce Domain Name",
                    "type": "text",
                    "name": "salesforceDomainName",
                    "validations": {
                      "required": true
                    }
                  }
                },
                {
                  "type": "Dropdown",
                  "parameters": {
                    "label": "Log Collection Interval",
                    "name": "queryType",
                    "required": true,
                    "type": "text",
                    "placeholder": "Select a Interval type",
                    "options": [
                      {
                        "key": "SELECT Id,EventType,LogDate,Interval,CreatedDate,LogFile,LogFileLength FROM EventLogFile WHERE Interval='Hourly' and CreatedDate>{_QueryWindowStartTime} and CreatedDate<{_QueryWindowEndTime}",
                        "text": "Hourly"
                      },
                      {
                        "key": "SELECT Id,EventType,LogDate,CreatedDate,LogFile,LogFileLength FROM EventLogFile WHERE CreatedDate>{_QueryWindowStartTime} and CreatedDate<{_QueryWindowEndTime}",
                        "text": "Daily"
                      }
                    ]
                  }
                },
                {
                  "type": "OAuthForm",
                  "parameters": {
                    "clientIdLabel": "Consumer Key",
                    "clientSecretLabel": "Consumer Secret",
                    "clientIdPlaceholder": "Enter Connected App Consumer Key",
                    "clientSecretPlaceholder": "Enter Connected App Consumer Secret",
                    "connectButtonLabel": "Connect",
                    "disconnectButtonLabel": "Disconnect"
                  }
                }
              ],
              "title": "Connect to Salesforce Service Cloud API to start collecting event logs in Microsoft Sentinel"
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com/"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "Salesforce Service Cloud (via CCP) – Preview",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "clientId": {
              "defaultValue": "-NA-",
              "type": "securestring",
              "minLength": 4
            },
            "clientSecret": {
              "defaultValue": "-NA-",
              "type": "securestring",
              "minLength": 4
            },
            "salesforceDomainName": {
              "defaultValue": "Enter salesforceDomainName value",
              "type": "securestring",
              "minLength": 4
            },
            "connectorDefinitionName": {
              "defaultValue": "Salesforce Service Cloud (via CCP) – Preview",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "queryType": {
              "defaultValue": "queryType",
              "type": "array",
              "minLength": 1
            },
            "AuthorizationCode": {
              "defaultValue": "-NA-",
              "type": "securestring",
              "minLength": 1
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com/"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'SalesforceServiceCloudPolling', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "SalesforceServiceCloudCCPDefinition",
                "dataType": "SalesforceServiceCloudV2_CL",
                "dcrConfig": {
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]",
                  "streamName": "Custom-SalesforceServiceCloudV2_CL"
                },
                "auth": {
                  "type": "OAuth2",
                  "ClientSecret": "[[parameters('clientSecret')]",
                  "ClientId": "[[parameters('clientId')]",
                  "TokenEndpoint": "[[concat(parameters('salesforceDomainName'), '/services/oauth2/token')]",
                  "tokenEndpointHeaders": {
                    "Accept": "application/json",
                    "Content-Type": "application/x-www-form-urlencoded"
                  },
                  "TokenEndpointQueryParameters": {},
                  "grantType": "client_credentials"
                },
                "request": {
                  "apiEndpoint": "[[concat(parameters('salesforceDomainName'),'/services/data/v44.0/query')]",
                  "httpMethod": "GET",
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "rateLimitQPS": 10,
                  "queryWindowInMin": 60,
                  "retryCount": 3,
                  "timeoutInSeconds": 60,
                  "headers": {
                    "Accept": "application/json",
                    "User-Agent": "Scuba"
                  },
                  "queryParameters": {
                    "q": "[[parameters('queryType')[0]]"
                  }
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.records"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "NextPageUrl",
                  "nextPageTokenJsonPath": "$.nextRecordsUrl",
                  "nextPageUrl": "[[parameters('salesforceDomainName')]",
                  "isNextPageTokenRelativeUrl": true
                },
                "stepInfo": {
                  "stepType": "Nested",
                  "nextSteps": [
                    {
                      "stepId": "fetchLogFileData",
                      "stepPlaceholdersParsingKql": "source | project res = parse_json(data) | project logFileUrl = res.LogFile"
                    }
                  ]
                },
                "stepCollectorConfigs": {
                  "fetchLogFileData": {
                    "shouldJoinNestedData": true,
                    "joinedDataStepName": "LogData",
                    "request": {
                      "httpMethod": "GET",
                      "apiEndpoint": "[[concat(parameters('salesforceDomainName'), '$logFileUrl$')]",
                      "headers": {
                        "Accept": "application/json",
                        "User-Agent": "Scuba"
                      }
                    },
                    "response": {
                      "format": "csv",
                      "eventsJsonPaths": [
                        "$"
                      ],
                      "HasCsvHeader": true
                    }
                  }
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.3",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Salesforce Service Cloud",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Salesforce%20Service%20Cloud/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.salesforce.com/in/products/service-cloud/overview/\">Salesforce Service Cloud</a> solution for Microsoft Sentinel enables you to ingest Service Cloud events into Microsoft Sentinel.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ol type=\"a\">\n<li><p><a href=\"https://docs.microsoft.com/azure/azure-monitor/logs/data-collector-api\">Azure Monitor HTTP Data Collector API</a></p>\n</li>\n<li><p><a href=\"https://azure.microsoft.com/services/functions/#overview\">Azure Functions</a></p>\n</li>\n</ol>\n<p><strong>Data Connectors:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/salesforce_logo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Salesforce Service Cloud",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            }
          ]
        },
        "firstPublishDate": "2022-05-16",
        "providers": [
          "Salesforce"
        ],
        "categories": {
          "domains": [
            "Cloud Provider"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
