{
	"type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
	"apiVersion": "2022-09-01-preview",
	"name": "{{workspace}}/Microsoft.SecurityInsights/GCPAuditLogsDefinition",
	"location": "{{location}}",
	"kind": "Customizable",
	"properties": {
		"connectorUiConfig": {
			"id": "GCPAuditLogsDefinition",
			"title": "GCP Pub/Sub Audit Logs",
			"publisher": "Microsoft",
			"descriptionMarkdown": "The Google Cloud Platform (GCP) audit logs, ingested from Microsoft Sentinel's connector, enables you to capture three types of audit logs: admin activity logs, data access logs, and access transparency logs. Google cloud audit logs record a trail that practitioners can use to monitor access and detect potential threats across Google Cloud Platform (GCP) resources.",
			"graphQueries": [
				{
					"metricName": "Total audit events received",
					"legend": "GCP Audit Logs",
					"baseQuery": "GCPAuditLogsV2_CL"
				},
				{
					"metricName": "Total Transparency events received",
					"legend": "GCP Audit Logs",
					"baseQuery": "GCPTransparencyLogsV2_CL"
				}
			],
			"sampleQueries": [
				{
					"description": "Get Sample of GCP Audit Logs",
					"query": "GCPAuditLogsV2_CL\n | take 10"
				},
				{
					"description": "Get Sample of GCP Audit Logs",
					"query": "GCPTransparencyLogsV2_CL\n | take 10"
				}
			],
			"dataTypes": [
				{
					"name": "GCPAuditLogsV2_CL",
					"lastDataReceivedQuery": "GCPAuditLogsV2_CL\n | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
				},
				{
					"name": "GCPTransparencyLogsV2_CL",
					"lastDataReceivedQuery": "GCPTransparencyLogsV2_CL\n | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
				}
			],
			"connectivityCriteria": [
				{
					"type": "HasDataConnectors"
				}
			],
			"availability": {
				"status": 1,
				"isPreview": false
			},
			"permissions": {
				"resourceProvider": [
					{
						"provider": "Microsoft.OperationalInsights/workspaces",
						"permissionsDisplayText": "Read and Write permissions are required.",
						"providerDisplayName": "Workspace",
						"scope": "Workspace",
						"requiredPermissions": {
							"read": true,
							"write": true,
							"delete": true,
							"action": false
						}
					}
				]
			},
			"instructionSteps": [
				{
					"instructions": [
						{
							"type": "MarkdownControlEnvBased",
							"parameters": {
								"prodScript": "#### 1. Setup the GCP environment \n Ensure to have the following resources from the GCP Console:\n Project ID, Project Name, GCP Subscription name for the project, Workload Identity Pool ID, Workspace Identity Provider ID, and a Service Account to establish the connection.\n For more information, refer the [Connector tutorial](https://github.com/v-svankam/harshaccp/blob/main/ReadmeAudit.md) for log setup and authentication setup tutorial.\n\n Find the Log set up script [**here**](https://github.com/v-svankam/harshaccp/blob/main/GcpCloudAuditLogSetup.tf)\n & the Authentication set up script [**here**](https://github.com/Azure/Azure-Sentinel/tree/master/DataConnectors/GCP/Terraform/sentinel_resources_creation/GCPInitialAuthenticationSetup)",
								"govScript": "#### 1. Setup the GCP environment \n Ensure to have the following resources from the GCP Console:\n Project ID, Project Name, GCP Subscription name for the project, Workload Identity Pool ID, Workspace Identity Provider ID, and a Service Account to establish the connection.\n For more information, refer the [Connector tutorial](https://github.com/v-svankam/harshaccp/blob/main/ReadmeAudit.md) for log setup and authentication setup tutorial.\n\n Find the Log set up script [**here**](https://github.com/v-svankam/harshaccp/blob/main/GcpCloudAuditLogSetup.tf)\n & the Authentication set up script [**here**](https://github.com/Azure/Azure-Sentinel/tree/master/DataConnectors/GCP/Terraform/sentinel_resources_creation_gov/GCPInitialAuthenticationSetupGov)"
							}
						},
						{
							"type": "CopyableLabel",
							"parameters": {
								"label": "Tenant ID: A unique identifier that is used as an input in the Terraform configuration within a GCP environment.",
								"fillWith": [
									"TenantId"
								],
								"name": "TenantId",
								"disabled": true
							}
						},
						{
							"type": "Markdown",
							"parameters": {
								"content": "#### 2. Enable Cloud Audit logs \n In the Google Cloud Console, enable cloud logging if not enabled previously, and save the changes. Navigate to Cloud Audit section and click on Add origin to create backends as per link provided below. \n\n Reference Link: [Link to documentation](https://cloud.google.com/logging/docs/audit)"
							}
						},
						{
							"type": "Markdown",
							"parameters": {
								"content": "#### 3. Connect new collectors \n To enable GCP Cloud Audit Logs for Microsoft Sentinel, click on Add new collector button, provide the required information in the pop up and click on Connect."
							}
						},
						{
							"type": "GCPGrid",
							"parameters": {}
						},
						{
							"type": "GCPContextPane",
							"parameters": {}
						}
					],
					"title": "Connect GCP Audit Logs to Microsoft Sentinel\n"
				}
			]
		}
	}
}