{
    "name": "FireworkCustomDCR",
    "apiVersion": "2021-09-01-preview",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "{{workspaceLocation}}",
    "properties": {
        "streamDeclarations": {
            "Custom-FireworkEventsStream": {
                "columns": [
                    {
                        "name": "timestamp",
                        "type": "string"
                    },
                    {
                        "name": "timestamp_formatted",
                        "type": "string"
                    },
                    {
                        "name": "first_crawled_at",
                        "type": "string"
                    },
                    {
                        "name": "materialized_at",
                        "type": "string"
                    },
                    {
                        "name": "url",
                        "type": "string"
                    },
                    {
                        "name": "event_title",
                        "type": "string"
                    },
                    {
                        "name": "event_type",
                        "type": "string"
                    },
                    {
                        "name": "source",
                        "type": "string"
                    },
                    {
                        "name": "source_name",
                        "type": "string"
                    },
                    {
                        "name": "id",
                        "type": "string"
                    },
                    {
                        "name": "keyword",
                        "type": "string"
                    },
                    {
                        "name": "category_name",
                        "type": "string"
                    },
                    {
                        "name": "content_preview",
                        "type": "dynamic"
                    },
                    {
                        "name": "content",
                        "type": "string"
                    },
                    {
                        "name": "alert_content",
                        "type": "string"
                    },
                    {
                        "name": "highlights",
                        "type": "dynamic"
                    },
                    {
                        "name": "risk",
                        "type": "dynamic"
                    },
                    {
                        "name": "tags",
                        "type": "dynamic"
                    },
                    {
                        "name": "related",
                        "type": "dynamic"
                    },
                    {
                        "name": "user_risk_score",
                        "type": "int"
                    },
                    {
                        "name": "user_notes",
                        "type": "string"
                    },
                    {
                        "name": "data",
                        "type": "dynamic"
                    },
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "external_url",
                        "type": "string"
                    },
                    {
                        "name": "identifiers",
                        "type": "dynamic"
                    },
                    {
                        "name": "sort",
                        "type": "string"
                    },
                    {
                        "name": "asset_uuids",
                        "type": "dynamic"
                    },
                    {
                        "name": "code",
                        "type": "dynamic"
                    },
                    {
                        "name": "author_id",
                        "type": "string"
                    },
                    {
                        "name": "project_name",
                        "type": "string"
                    },
                    {
                        "name": "sha",
                        "type": "string"
                    },
                    {
                        "name": "actor",
                        "type": "string"
                    },
                    {
                        "name": "victim_name",
                        "type": "string"
                    }
                ]
            }
        },
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceResourceId": "{{workspaceResourceId}}",
                    "name": "clv2ws1"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-FireworkEventsStream"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source\n| extend\n    TimeGenerated = iff(not(isempty(timestamp)), todatetime(timestamp), now()),\n    EventVendor = \"Flare\",\n    EventProduct = \"Firework\",\n    EventSchemaVersion = \"0.1\",\n     EventSeverity = case(\n        toint(risk.score) == 1, \"Informational\",\n        toint(risk.score) == 2, \"Low\",\n        toint(risk.score) == 3, \"Medium\",\n        toint(risk.score) == 4, \"High\",\n        toint(risk.score) == 5, \"Critical\",\n        \"Informational\"\n    ),\n        EventOriginalUid = uid,\n    EventOriginalType = event_type,\n    RiskScore = toint(risk.score),\n     Url = url\n",
                "outputStream": "Custom-FireworkV2_CL"
            }
        ],
        "dataCollectionEndpointId": "{{dataCollectionEndpointId}}"
    }
}
