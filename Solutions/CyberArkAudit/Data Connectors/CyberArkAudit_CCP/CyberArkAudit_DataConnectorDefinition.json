{
  "name": "CyberArkAuditCCPDefinition",
  "apiVersion": "2022-09-01-preview",
  "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
  "location": "{{location}}",
  "kind": "Customizable",
  "properties": {
    "connectorUiConfig": {
      "id": "CyberArkAuditCCPDefinition",
      "title": "CyberArk Audit (using REST API)",
      "publisher": "Microsoft",
      "descriptionMarkdown": "The [CyberArk Audit](https://docs.cyberark.com/Audit/Latest/en/Content/Resources/_TopNav/cc_Home.htm) data connector enables Microsoft Sentinel to ingest security event logs and other events from the CyberArk Audit service via REST API. This integration helps you detect potential security risks, monitor user activity, analyze collaboration patterns, troubleshoot configuration issues, and gain deeper insights into your environment.",
      "graphQueriesTableName": "CyberArkAuditV2_CL",
      "graphQueries": [
        {
          "metricName": "Total data received",
          "legend": "CyberArk Audit Events",
          "baseQuery": "{{graphQueriesTableName}}"
        }
      ],
      "sampleQueries": [
        {
          "description": "CyberArk Audit Events - All Activities.",
          "query": "{{graphQueriesTableName}}\n | sort by TimeGenerated desc"
        }
      ],
      "dataTypes": [
        {
          "name": "{{graphQueriesTableName}}",
          "lastDataReceivedQuery": "{{graphQueriesTableName}}\n|summarize Time = max  (TimeGenerated)\n|where isnotempty(Time)"
        }
      ],
      "connectivityCriteria": [
        {
          "type": "HasDataConnectors"
        }
      ],
      "permissions": {
        "resourceProvider": [
          {
            "provider": "Microsoft.OperationalInsights/workspaces",
            "permissionsDisplayText": "Read and Write permissions are required.",
            "providerDisplayName": "Workspace",
            "scope": "Workspace",
            "requiredPermissions": {
              "write": true,
              "read": true,
              "delete": true
            }
          }
        ],
        "customs": [
          {
            "name": "CyberArk Audit Service Platform",
            "description": "Access to perform required configurations in CyberArk Audit platform"
          }
        ]
      },
      "instructionSteps": [
        {
          "description": "Create and configure an OAuth2 server web app in Identity Administration",
          "instructions": [
            {
              "type": "Textbox",
              "parameters": {
                "label": "OAuth2 Server App Name",
                "required": true,
                "placeholder": "The name of the OAuth2 server web app",
                "type": "password",
                "name": "OAuth2ServerAppName"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Audit API Key",
                "required": true,
                "placeholder": "The API Key can be retrieved from the Audit service",
                "type": "password",
                "name": "AuditAPIKey"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Identity Endpoint",
                "required": true,
                "placeholder": "Identity Endpoint can be retrieved from the Audit service",
                "type": "text",
                "name": "CyberArkIdentityEndPoint"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Audit API Base URL",
                "required": true,
                "placeholder": "The API Base URL can be retrieved from the Audit service",
                "type": "text",
                "name": "CyberArkAPIBaseURL"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Audit Query Filter Action",
                "required": false,
                "placeholder": "The optional filter parameters for create Query call",
                "type": "text",
                "name": "AuditQueryFilterAction"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Audit Query Filter Application Code",
                "required": true,
                "placeholder": "The optional filter parameters for create Query call. For example, CSM, SIA",
                "type": "text",
                "name": "AuditQueryFilterApplicationCode"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Audit Query Filter Audit Type",
                "required": true,
                "placeholder": "The optional filter parameters for create Query call. For example, System Error, Failure",
                "type": "text",
                "name": "AuditQueryFilterAuditType"
              }
            },
            {
              "type": "OAuthForm",
              "parameters": {
                "clientIdLabel": "Oauth Username",
                "clientSecretLabel": "Oauth Password",
                "clientIdPlaceholder": "The service user created in Identity Administration",
                "clientSecretPlaceholder": "The user secret created in Identity Administration",
                "connectButtonLabel": "Connect",
                "disconnectButtonLabel": "Disconnect"
              }
            }
          ],
          "title": "Connect to Salesforce Service Cloud API to start collecting event logs in Microsoft Sentinel"
        }
      ]
    }
  }
}