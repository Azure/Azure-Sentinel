[
    {
      "name": "CyberArkAuditDCR",
      "apiVersion": "2021-09-01-preview",
      "type": "Microsoft.Insights/dataCollectionRules",
      "location": "{{location}}",
      "properties": {
        "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
        "streamDeclarations": {
          "Custom-CyberArkAuditV2": {
            "columns": [
              {
                "name": "uuid",
                "type": "string"
              },
              {
                "name": "tenantId",
                "type": "string"
              },
              {
                "name": "timestamp",
                "type": "long"
              },
              {
                "name": "username",
                "type": "string"
              },
              {
                "name": "applicationCode",
                "type": "string"
              },
              {
                "name": "auditCode",
                "type": "string"
              },
              {
                "name": "auditType",
                "type": "string"
              },
              {
                "name": "userId",
                "type": "string"
              },
              {
                "name": "action",
                "type": "string"
              },
              {
                "name": "source",
                "type": "string"
              },
              {
                "name": "actionType",
                "type": "string"
              },
              {
                "name": "component",
                "type": "string"
              },
              {
                "name": "serviceName",
                "type": "string"
              },
              {
                "name": "accessMethod",
                "type": "string"
              },
              {
                "name": "accountId",
                "type": "string"
              },
              {
                "name": "target",
                "type": "string"
              },
              {
                "name": "command",
                "type": "string"
              },
              {
                "name": "sessionId",
                "type": "string"
              },
              {
                "name": "message",
                "type": "string"
              },
              {
                "name": "customData",
                "type": "dynamic"
              },
              {
                "name": "cloudProvider",
                "type": "string"
              },
              {
                "name": "cloudWorkspacesAndRoles",
                "type": "dynamic"
              },
              {
                "name": "cloudIdentities",
                "type": "string"
              },
              {
                "name": "cloudAssets",
                "type": "string"
              },
              {
                "name": "safe",
                "type": "string"
              },
              {
                "name": "accountName",
                "type": "string"
              },
              {
                "name": "targetPlatform",
                "type": "string"
              },
              {
                "name": "targetAccount",
                "type": "string"
              },
              {
                "name": "identityType",
                "type": "string"
              },
              {
                "name": "correlationId",
                "type": "string"
              }
            ]
          }
        },
        "destinations": {
          "logAnalytics": [
            {
              "workspaceResourceId": "{{workspaceResourceId}}",
              "name": "clv2ws1"
            }
          ]
        },
        "dataFlows": [
          {
            "streams": ["Custom-CyberArkAuditV2"],
            "destinations": ["clv2ws1"],
            "transformKql": "source | project TimeGenerated = datetime(1970-01-01) + totimespan(timestamp * 1ms), Uuid=uuid, CyberArkTenantId=tenantId, Username=username, ApplicationCode=applicationCode, AuditCode=auditCode, AuditType=auditType, UserId=userId, Action=action, Source=source, ActionType=actionType, Component=component, ServiceName=serviceName, AccessMethod=accessMethod, AccountId=accountId, Target=target, Command=command, SessionId=sessionId, Message=message, CustomData=customData, CloudProvider=cloudProvider, CloudWorkspacesAndRoles=cloudWorkspacesAndRoles, CloudIdentities=cloudIdentities, CloudAssets=cloudAssets, Safe=safe, AccountName=accountName, TargetPlatform=targetPlatform, TargetAccount=targetAccount, IdentityType=identityType, CorrelationId=correlationId",
            "outputStream": "Custom-CyberArkAuditV2_CL"
          }
        ]
      }
    }
  ]