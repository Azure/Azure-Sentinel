[
    {
      "name": "CyberArkAuditDCR",
      "apiVersion": "2021-09-01-preview",
      "type": "Microsoft.Insights/dataCollectionRules",
      "location": "{{location}}",
      "properties": {
        "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
        "streamDeclarations": {
          "Custom-CyberArk_AuditEvents": {
            "columns": [
              {
                "name": "uuid",
                "type": "string"
              },
              {
                "name": "tenantId",
                "type": "string"
              },
              {
                "name": "timestamp",
                "type": "long"
              },
              {
                "name": "username",
                "type": "string"
              },
              {
                "name": "applicationCode",
                "type": "string"
              },
              {
                "name": "auditCode",
                "type": "string"
              },
              {
                "name": "auditType",
                "type": "string"
              },
              {
                "name": "userId",
                "type": "string"
              },
              {
                "name": "action",
                "type": "string"
              },
              {
                "name": "source",
                "type": "string"
              },
              {
                "name": "actionType",
                "type": "string"
              },
              {
                "name": "component",
                "type": "string"
              },
              {
                "name": "serviceName",
                "type": "string"
              },
              {
                "name": "accessMethod",
                "type": "string"
              },
              {
                "name": "accountId",
                "type": "string"
              },
              {
                "name": "target",
                "type": "string"
              },
              {
                "name": "command",
                "type": "string"
              },
              {
                "name": "sessionId",
                "type": "string"
              },
              {
                "name": "message",
                "type": "string"
              },
              {
                "name": "customData",
                "type": "dynamic"
              },
              {
                "name": "cloudProvider",
                "type": "string"
              },
              {
                "name": "cloudWorkspacesAndRoles",
                "type": "dynamic"
              },
              {
                "name": "cloudIdentities",
                "type": "string"
              },
              {
                "name": "cloudAssets",
                "type": "string"
              },
              {
                "name": "safe",
                "type": "string"
              },
              {
                "name": "accountName",
                "type": "string"
              },
              {
                "name": "targetPlatform",
                "type": "string"
              },
              {
                "name": "targetAccount",
                "type": "string"
              },
              {
                "name": "identityType",
                "type": "string"
              },
              {
                "name": "correlationId",
                "type": "string"
              }
            ]
          }
        },
        "destinations": {
          "logAnalytics": [
            {
              "workspaceResourceId": "{{workspaceResourceId}}",
              "name": "clv2ws1"
            }
          ]
        },
        "dataFlows": [
          {
            "streams": ["Custom-CyberArk_AuditEvents"],
            "destinations": ["clv2ws1"],
            "transformKql": "source | project TimeGenerated = datetime(1970-01-01) + totimespan(timestamp * 1ms), CyberArkTenantId=tenantId, accountName=accountName, action=action, accessMethod=accessMethod, actionType=actionType, applicationCode=applicationCode, auditCode=auditCode, auditType=auditType, correlationId=correlationId, cloudAssets=cloudAssets, cloudIdentities=cloudIdentities, cloudProvider=cloudProvider, cloudWorkspacesAndRoles=tostring(cloudWorkspacesAndRoles), command=command, component=component, customData=tostring(customData), identityType=identityType, message=message, target=target, timestamp=timestamp, targetPlatform=targetPlatform, targetAccount=targetAccount, safe=safe, sessionId=sessionId, serviceName=serviceName, source=source, userId=userId, username=username, uuid=uuid",
            "outputStream": "Custom-CyberArk_AuditEvents_CL"
          }
        ]
      }
    }
  ]