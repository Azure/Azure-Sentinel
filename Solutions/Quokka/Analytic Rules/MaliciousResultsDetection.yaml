id: 97ad71ed-e4c0-4f7a-b1a2-683108bece4f
name: Quokka - Malicious Results Detected
description: |
  'Detects if there are any malicious results in the app events coming from organization devices.'
severity: Medium
status : Available
requiredDataConnectors:
  - connectorId: QscoutAppEventsCCFDefinition
    dataTypes:
      - QscoutAppEvents_CL
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitialAccess
  - Execution
  - Persistence
  - PrivilegeEscalation
  - DefenseEvasion
  - CredentialAccess
  - Discovery
  - Collection
  - CommandAndControl
  - Impact
relevantTechniques:
  - T1406
  - T1409
  - T1414
  - T1417
  - T1418
  - T1422
  - T1424
  - T1429
  - T1430
  - T1471
  - T1474
  - T1481
  - T1509
  - T1512
  - T1513
  - T1516
  - T1517
  - T1532
  - T1541
  - T1544
  - T1582
  - T1616
  - T1617
  - T1623
  - T1624
  - T1625
  - T1627
  - T1628
  - T1629
  - T1630
  - T1631
  - T1633
  - T1634
  - T1635
  - T1636
  - T1638
  - T1640
  - T1641
  - T1642
  - T1643
query: |
  let timeRange = 1h;
  let appEventsWithMaliciousResults = QscoutAppEvents_CL
  | extend AccountCustomEntity = tostring(org_id)
  | where TimeGenerated >= ago(timeRange)
  | where result_type == 'maliciousness'
  | where isnotempty(results.entries);
  appEventsWithMaliciousResults
  | mv-expand entry = results.entries
  | project
      TimeGenerated,
      AccountCustomEntity,
      app_id,
      mdm_source,
      mdm_device_id,
      package,
      platform,
      version,
      rule_id = tostring(entry.ruleId),
      desription = tostring(entry.description),
      threat_level = toint(entry.threatLevel),
      threat_types = tostring(entry.threatTypes)
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: AccountCustomEntity
version: 1.0.0
kind: Scheduled
